{% extends "base.html" %}
{% block content %}

<style>
  .kpi { display: inline-block; width: 22%; margin: 1%; padding: 20px; background: #f4f4f4; border-radius: 8px; text-align: center; }
  .bar { height: 20px; background: #4CAF50; border-radius: 5px; }
  .chart-container { margin: 20px 0; }
  .pie { width: 150px; height: 150px; border-radius: 50%; background: conic-gradient(#4CAF50 0% {{subscriptions_by_plan.0.count|default:0}}%, #2196F3 {{subscriptions_by_plan.0.count|default:0}}% 100%); margin: auto; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { border: 1px solid #ddd; padding: 8px; }
  th { background: #f2f2f2; }
</style>

<h2>ğŸ“Š Admin Analytics Dashboard</h2>
<!-- <form method="get">
  <label>Filter Type:</label>
  <select name="filter_type" onchange="this.form.submit()">
    <option value="all" {% if filter_type == "all" %}selected{% endif %}>All Time</option>
    <option value="year" {% if filter_type == "year" %}selected{% endif %}>By Year</option>
    <option value="month" {% if filter_type == "month" %}selected{% endif %}>By Month</option>
    <option value="custom" {% if filter_type == "custom" %}selected{% endif %}>Custom</option>
  </select>

  <div>
    <label>Year:</label>
    <input type="number" name="year" value="{{ selected_year }}">
  </div>

  <div>
    <label>Month:</label>
    <input type="number" name="month" min="1" max="12" value="{{ selected_month }}">
  </div>

  <div>
    <label>From:</label>
    <input type="date" name="from_date" value="{{ from_date }}">
    <label>To:</label>
    <input type="date" name="to_date" value="{{ to_date }}">
  </div>

  <button type="submit">Apply</button>
</form> -->


<!-- KPIs -->
<div class="kpi">ğŸ‘¥ Total Users<br><b>{{ total_users }}</b></div>
<div class="kpi">âœ… Active Users<br><b>{{ active_users }}</b></div>
<div class="kpi">âŒ Inactive Users<br><b>{{ inactive_users }}</b></div>
<div class="kpi">ğŸ’° Total Revenue<br><b>â‚¹{{ total_revenue }}</b></div>

<hr>

<h3>ğŸ‘¥ User Analytics</h3>
<p>Superusers: {{ superusers }} | Regular: {{ regular_users }}</p>
<p>Users with Profile Images: {{ users_with_profile_image }}</p>

<div class="chart-container">
  <h4>Users by Industry</h4>
  <table>
    <tr><th>Industry</th><th>Users</th></tr>
    {% for i in users_by_industry %}
    <tr><td>{{ i.industry }}</td><td>{{ i.count }}</td></tr>
    {% endfor %}
  </table>
</div>

<hr>

<h3>ğŸ“¦ Subscription Analytics</h3>
<table>
  <tr><th>Status</th><th>Count</th></tr>
  {% for s in subscription_status %}
  <tr><td>{{ s.status }}</td><td>{{ s.count }}</td></tr>
  {% endfor %}
</table>

<div class="chart-container">
  <h4>Subscriptions by Plan</h4>
  <table>
    <tr><th>Plan</th><th>Count</th></tr>
    {% for p in subscriptions_by_plan %}
    <tr><td>{{ p.plan__name }}</td><td>{{ p.count }}</td></tr>
    {% endfor %}
  </table>
</div>

<hr>

<h3>ğŸ’° Revenue Analytics</h3>
<p>Average Payment: â‚¹{{ avg_payment|default:"0" }}</p>
<h4>Top Paying Users</h4>
<table>
  <tr><th>User</th><th>Total Paid</th></tr>
  {% for u in top_paying_users %}
  <tr><td>{{ u.subscription__user__email }}</td><td>â‚¹{{ u.total }}</td></tr>
  {% endfor %}
</table>

<hr>

<h3>ğŸ“± Device Analytics</h3>
<p>Total Devices: {{ total_devices }} | Avg Devices/User: {{ avg_devices_per_user|floatformat:2 }}</p>

<hr>

<h3>ğŸ“ Training Analytics</h3>
<p>Total Trainings: {{ total_trainings }} | Active: {{ active_trainings }}</p>
<table>
  <tr><th>Category</th><th>Count</th></tr>
  {% for t in trainings_by_category %}
  <tr><td>{{ t.category }}</td><td>{{ t.count }}</td></tr>
  {% endfor %}
</table>

<hr>

<h3>ğŸ“ Blog Analytics</h3>
<p>Total Blogs: {{ total_blogs }} | Published: {{ published_blogs }}</p>
<table>
  <tr><th>Category</th><th>Count</th></tr>
  {% for b in blogs_by_category %}
  <tr><td>{{ b.category }}</td><td>{{ b.count }}</td></tr>
  {% endfor %}
</table>

<hr>

<h3>ğŸ“© Contact Analytics</h3>
<p>Total Inquiries: {{ total_inquiries }}</p>
<table>
  <tr><th>Subject</th><th>Count</th></tr>
  {% for c in inquiries_by_subject %}
  <tr><td>{{ c.subject }}</td><td>{{ c.count }}</td></tr>
  {% endfor %}
</table>

{% endblock %}
