{% extends "login_base.html" %}

{% block content %}
<div class="main-content">
    <h2 class="page-title no-print">Transaction List</h2>

    <!-- Search + Action buttons container -->
    <div class="search-actions no-print">
        <form method="get" class="search-form">
            <input type="text" name="q" placeholder="Search by Order ID, Payment ID, Amount, or User Email" value="{{ query }}">
            <button type="submit">Search</button>
            <a href="{% url 'transaction_list' %}" class="reset-btn">Reset</a>
        </form>

        <div class="table-actions">
            <form action="{% url 'clear_all_transactions' %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="clear-btn" onclick="return confirm('Are you sure you want to delete ALL transactions?');">Clear All</button>
            </form>
            <button type="button" class="print-btn" onclick="printTable()">Print</button>
        </div>
    </div>

    <!-- Table -->
    <div id="transaction-table" class="table-card">
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                          <th>S.No.</th>
                        <th>Order ID</th>
                        <th>Payment ID</th>
                        <th>User</th>
                        <th>Amount</th>
                        <th>Currency</th>
                        <th>Created At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for txn in transactions %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ txn.razorpay_order_id }}</td>
                        <td>{{ txn.razorpay_payment_id|default:"N/A" }}</td>
                        <td>{{ txn.subscription.user.email }}</td>
                        <td>{{ txn.amount }}</td>
                        <td>{{ txn.currency }}</td>
                        <td>{{ txn.created_at|date:"M d, Y h:i A" }}</td>
                        <td>
                            <form action="{% url 'delete_transaction' txn.pk %}" method="post" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this transaction?');">
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7" class="no-transactions">No transactions found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
/* Common Styles */
.page-title { 
    font-size: 28px; 
    font-weight: 700; 
    color: #1560bd; 
    margin-bottom: 20px; 
}

/* Search and action container */
.search-actions { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 10px; 
    align-items: center; 
    margin-bottom: 15px; 
}

/* Search form */
.search-form { 
    display: flex; 
    gap: 10px; 
    flex: 1; 
}

.search-form input { 
    flex: 1; 
    min-width: 220px; 
    padding: 8px 12px; 
    border-radius: 6px; 
    border: 1px solid #1560bd; 
    background-color: #e6f0ff; 
}

.search-form button { 
    padding: 8px 16px; 
    border-radius: 6px; 
    background-color: #1560bd; 
    color: #fff; 
    border: none; 
    cursor: pointer; 
    transition: 0.3s; 
}

.search-form button:hover { 
    background-color: #0f3f80; 
}

/* Reset button */
.reset-btn { 
    padding: 8px 16px; 
    border-radius: 6px; 
    background-color: #6c757d; 
    color: #fff; 
    text-decoration: none; 
    transition: 0.3s; 
}

.reset-btn:hover { 
    background-color: #5a6268; 
}

/* Table action buttons container */
.table-actions { 
    display: flex; 
    gap: 10px; 
}

/* Clear and print buttons */
.clear-btn, .print-btn { 
    padding: 8px 16px; 
    border-radius: 6px; 
    border: none; 
    cursor: pointer; 
    font-weight: 500; 
    transition: 0.3s; 
}

.clear-btn { 
    background-color: #ff4d4f; 
    color: #fff; 
}

.clear-btn:hover { 
    background-color: #d9363e; 
}

.print-btn { 
    background-color: #28a745; 
    color: #fff; 
}

.print-btn:hover { 
    background-color: #1e7e34; 
}

/* Table card container */
.table-card { 
    background: #fff; 
    border-radius: 12px; 
    box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
    overflow: hidden; 
}

.table-responsive { 
    overflow-x: auto; 
}

table { 
    width: 100%; 
    border-collapse: collapse; 
    font-size: 14px; 
}

/* Table header */
thead th { 
    background: linear-gradient(#1560bd,#000040); 
    color: #fff; 
    font-weight: 600; 
    padding: 14px 10px; 
    position: sticky; 
    top: 0; 
    text-align: left; 
    border-right: 1px solid #ccc; 
}

thead th:last-child { 
    border-right: none; 
}

/* Table body */
tbody td { 
    padding: 12px 10px; 
    border-bottom: 1px solid #dcdcdc; 
    border-right: 1px solid #dcdcdc; 
}

tbody td:last-child { 
    border-right: none; 
}

/* Alternating row colors */
tbody tr:nth-child(odd) { 
    background-color: #fff; 
}

tbody tr:nth-child(even) { 
    background-color: #e6f0ff; 
}



/* Delete button */
.delete-btn { 
    padding: 6px 12px; 
    border-radius: 6px; 
    background-color: #ff4d4f; 
    color: #fff; 
    border: none; 
    cursor: pointer; 
    transition: 0.3s; 
}

.delete-btn:hover { 
    background-color: #d9363e; 
    transform: translateY(-1px); 
}

/* Empty row message */
.no-transactions { 
    text-align: center; 
    font-style: italic; 
    color: #6c757d; 
    padding: 20px 0; 
}

/* Mobile responsiveness */
@media (max-width: 768px) {
    .search-actions { 
        flex-direction: column; 
        align-items: stretch; 
    }
    .search-form { 
        flex-direction: column; 
    }
    .table-actions { 
        flex-direction: column; 
    }
    .search-form input, .search-form button, .reset-btn, .clear-btn, .print-btn { 
        width: 100%; 
    }
}

/* Print only table in landscape */
@media print {
    @page { 
        size: landscape; 
        margin: 10mm; 
    }

    body * { 
        visibility: hidden;  /* hide everything */ 
    }

    #transaction-table, #transaction-table * { 
        visibility: visible;  /* show only table */ 
         overflow: visible !important;
    max-height: none !important;
    height: auto !important;
    }

    #transaction-table { 
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
    }

    .table-responsive { 
        overflow-x: visible; 
    }

    table, th, td { 
        border: 1px solid #dcdcdc; 
    }

    tbody tr:nth-child(odd) { 
        background-color: #e6f0ff !important; 
    }

    tbody tr:nth-child(even) { 
        background-color: #ffffff !important; 
    }

    .table-card { 
        box-shadow: none; 
        border-radius: 0; 
    }
}

</style>

<script>
function printTable() {
    window.print();
}
</script>

{% endblock %}
