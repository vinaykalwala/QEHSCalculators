{% extends 'login_base.html' %}
{% block title %}Profile{% endblock %}
{% block content %}
<div class="main-content">

{% if not edit_mode %}
    <!-- Display User Info -->
    <h2>Profile</h2>
    {% if user.profile_image %}
        <p><img src="{{ user.profile_image.url }}" width="150" height="150" /></p>
    {% endif %}
    <p><strong>First Name:</strong> {{ user.first_name }}</p>
    <p><strong>Last Name:</strong> {{ user.last_name }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Phone:</strong> {{ user.phone }}</p>
    <p><strong>Company:</strong> {{ user.company_name }}</p>
    <p><strong>Designation:</strong> {{ user.designation }}</p>
    <p><strong>Address:</strong> {{ user.address }}</p>
    <p><strong>Industry:</strong> {{ user.industry }}</p>
    <p><strong>Purpose:</strong> {{ user.purpose }}</p>

    <a href="?edit=1"><button>Edit Profile</button></a>

    <!-- Active Subscription -->
    <h3>Active Subscription</h3>
    {% if active_subscription %}
        <p><strong>Plan:</strong> {{ active_subscription.plan.name }}</p>
        <p><strong>Status:</strong> {{ active_subscription.status }}</p>
        <p><strong>Start Date:</strong> {{ active_subscription.start_date }}</p>
        <p><strong>End Date:</strong> {{ active_subscription.end_date }}</p>
        <p><strong>Devices Allowed:</strong> {{ active_subscription.plan.device_limit }}</p>
    {% else %}
        <p>No active subscription</p>
    {% endif %}

    <!-- All Subscriptions -->
<h3>All Subscriptions</h3>
<ul>
    {% for sub in subscriptions %}
        <li>
            Plan: 
            {% if sub.plan %}
                {{ sub.plan.name }}
            {% else %}
                N/A
            {% endif %}
             | Status: {{ sub.status }} | Start: {{ sub.start_date }} | End: {{ sub.end_date }} | Amount Paid: ₹{{ sub.amount_paid }}
        </li>
    {% empty %}
        <li>No subscriptions</li>
    {% endfor %}
</ul>


    <!-- Devices -->
    <h3>Devices</h3>
    <ul>
        {% for device in devices %}
            <li>{{ device.device_id }} | Last Seen: {{ device.last_seen }}</li>
        {% empty %}
            <li>No devices registered</li>
        {% endfor %}
    </ul>

    <!-- Transactions -->
    <h3>Transactions</h3>
    <ul>
        {% for txn in transactions %}
            <li>
                Order ID: {{ txn.razorpay_order_id }} | 
                Payment ID: {{ txn.razorpay_payment_id }} | 
                Amount: ₹{{ txn.amount }} | 
                Currency: {{ txn.currency }} | 
                Date: {{ txn.created_at }}
            </li>
        {% empty %}
            <li>No transactions</li>
        {% endfor %}
    </ul>

{% else %}
    <!-- Edit Profile Form -->
    <h2>Edit Profile</h2>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Update Profile</button>
    </form>
{% endif %}

</div>
{% endblock %}
