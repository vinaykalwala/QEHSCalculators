{% extends 'base.html' %}
{% block title %}No-Overpressure Vent Area Formula (All-Liquid Venting){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No-Overpressure Vent Area Formula (All-Liquid Venting)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            {% comment %} display: flex; {% endcomment %}
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            {% comment %} overflow-y: auto; {% endcomment %}
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Input rows for side-by-side fields */
         .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            {% comment %} margin-bottom: 15px; {% endcomment %}
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
       
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>No-Overpressure Vent Area Formula (All-Liquid Venting)</h1>
            <p>Calculate the vent area required to prevent overpressure in liquid storage tanks</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="QT">Heat Input (Q<sub>T</sub>) (kW)</label>
                        <input type="number" id="QT" class="form-input" min="0" step="0.001" placeholder="e.g., 500">
                    </div>
                    <div class="form-group">
                        <label for="vfa">Liquid Specific Volume (v<sub>fa</sub>) (m³/kg)</label>
                        <input type="number" id="vfa" class="form-input" min="0" step="0.000001" placeholder="e.g., 0.001">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="G">Mass Flux (G) (kg/m²s)</label>
                        <input type="number" id="G" class="form-input" min="0" step="0.001" placeholder="e.g., 1000">
                    </div>
                    <div class="form-group">
                        <label for="vf">Vapor Specific Volume (v<sub>f</sub>) (m³/kg)</label>
                        <input type="number" id="vf" class="form-input" min="0" step="0.001" placeholder="e.g., 1.5">
                    </div>
                </div>
                <div class="form-group">
                    <label for="hfa">Latent Heat of Vaporization (h<sub>fa</sub>) (kJ/kg)</label>
                    <input type="number" id="hfa" class="form-input" min="0" step="0.001" placeholder="e.g., 2257">
                </div>
                
                <button class="calculate-btn" onclick="calculateVentArea()">Calculate Vent Area</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Vent Area</strong> required to prevent overpressure. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Required Vent Area</h2>
                    </div>
                    <div class="rate-display">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Vent Area (m²)</div></div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Small</span><span>Optimal</span><span>Moderate</span><span>Large</span><span>Very Large</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Vent Area Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    This tool calculates the <strong>Vent Area</strong> required to prevent overpressure in liquid storage tanks,
                    ensuring safe pressure relief in various industrial applications.
                </p>
            </div>

            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Heat Input (Q<sub>T</sub>):</strong> Constant external heat input to the system (kW).</li>
                    <li><strong>Liquid Specific Volume (v<sub>fa</sub>):</strong> Volume occupied by liquid per unit mass (m³/kg).</li>
                    <li><strong>Mass Flux (G):</strong> Mass flow rate per unit area (kg/m²s).</li>
                    <li><strong>Vapor Specific Volume (v<sub>f</sub>):</strong> Volume occupied by vapor per unit mass (m³/kg).</li>
                    <li><strong>Latent Heat of Vaporization (h<sub>fa</sub>):</strong> Energy required to convert liquid to vapor (kJ/kg).</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>📊 Interpretation</h3>
                <p>
                    <b>Vent Area Size Guidelines:</b>
                </p>
                <ul class="note-list">
                    <li><span class="good">Below 0.01 m²</span> → Small vent area, may indicate an undersized valve</li>
                    <li><span class="average">0.01-0.1 m²</span> → Optimal range for most industrial applications</li>
                    <li><span class="bad">Above 0.1 m²</span> → Large vent area, may indicate an oversized valve</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>🔑 Key Applications</h3>
                <ul class="note-list">
                    <li><strong>Chemical Storage Tanks:</strong> Prevents pressure buildup due to temperature fluctuations.</li>
                    <li><strong>Petroleum and Gas Industries:</strong> Ensures safe venting in fuel storage tanks.</li>
                    <li><strong>Fire Safety Systems:</strong> Designs emergency venting for tanks exposed to fire hazards.</li>
                    <li><strong>Boiler and Steam Systems:</strong> Regulates pressure in industrial boilers.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>✅ Validation Rules & Input Constraints</h3>
                <ul class="note-list">
                    <li><strong>Heat Input (Q<sub>T</sub>):</strong> Must be > 0 kW (typical 1-100,000 kW)</li>
                    <li><strong>Liquid Specific Volume (v<sub>fa</sub>):</strong> Must be > 0 m³/kg (typical 0.0008-0.002 m³/kg)</li>
                    <li><strong>Mass Flux (G):</strong> Must be > 0 kg/m²s (typical 100-10,000 kg/m²s)</li>
                    <li><strong>Vapor Specific Volume (v<sub>f</sub>):</strong> Must be > 0 m³/kg (typical 0.5-10 m³/kg)</li>
                    <li><strong>Latent Heat of Vaporization (h<sub>fa</sub>):</strong> Must be > 0 kJ/kg (typical 200-2,500 kJ/kg)</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
          document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
        function calculateVentArea() {
            // Get input values
            let QT = parseFloat(document.getElementById("QT").value);
            let vfa = parseFloat(document.getElementById("vfa").value);
            let G = parseFloat(document.getElementById("G").value);
            let vf = parseFloat(document.getElementById("vf").value);
            let hfa = parseFloat(document.getElementById("hfa").value);
            
            // Reset error messages
            document.getElementById("resultError").classList.add("hidden");
            document.getElementById("resultValue").classList.add("hidden");
            document.getElementById("placeholder").classList.add("hidden");
            
            // Validation checks
            let errorMessages = [];
            
            // Check for empty fields
            if (isNaN(QT) || isNaN(vfa) || isNaN(G) || isNaN(vf) || isNaN(hfa)) {
                errorMessages.push("All fields must be filled with numeric values.");
            }
            
            // Check for positive values
            if (QT <= 0) errorMessages.push("Heat Input (Q<sub>T</sub>) must be greater than 0.");
            if (vfa <= 0) errorMessages.push("Liquid Specific Volume (v<sub>fa</sub>) must be greater than 0.");
            if (G <= 0) errorMessages.push("Mass Flux (G) must be greater than 0.");
            if (vf <= 0) errorMessages.push("Vapor Specific Volume (v<sub>f</sub>) must be greater than 0.");
            if (hfa <= 0) errorMessages.push("Latent Heat of Vaporization (h<sub>fa</sub>) must be greater than 0.");
            
            // Check for realistic ranges
            if (QT > 100000) errorMessages.push("Heat Input (Q<sub>T</sub>) seems unusually high (>100,000 kW). Please verify.");
            if (vfa > 0.1) errorMessages.push("Liquid Specific Volume (v<sub>fa</sub>) seems unusually high (>0.1 m³/kg). Please verify.");
            if (G > 50000) errorMessages.push("Mass Flux (G) seems unusually high (>50,000 kg/m²s). Please verify.");
            if (vf > 100) errorMessages.push("Vapor Specific Volume (v<sub>f</sub>) seems unusually high (>100 m³/kg). Please verify.");
            if (hfa > 5000) errorMessages.push("Latent Heat of Vaporization (h<sub>fa</sub>) seems unusually high (>5,000 kJ/kg). Please verify.");
            
            // Check for division by zero scenarios
            if (G * vf * hfa === 0) {
                errorMessages.push("Calculation error: Division by zero would occur. Please check your inputs.");
            }
            
            // Display errors if any
            if (errorMessages.length > 0) {
                document.getElementById("errorMessage").innerHTML = errorMessages.join("<br>");
                document.getElementById("resultError").classList.remove("hidden");
                return;
            }
            
            // Calculate Ao using the formula: Ao = (QT * vfa) / (G * vf * hfa)
            let Ao = (QT * vfa) / (G * vf * hfa);
            
            // Display result
            document.getElementById("rateValue").textContent = Ao.toFixed(6);
            
            // Set meter fill based on result
            let meterPercentage = Math.min(100, Math.max(5, (Math.log10(Ao + 0.001) + 3) * 20));
            document.getElementById("meterFill").style.width = meterPercentage + "%";
            
            // Set meter color based on safety level
            if (Ao < 0.01) {
                document.getElementById("meterFill").style.background = "#2ecc71"; // Green (safe)
            } else if (Ao < 0.1) {
                document.getElementById("meterFill").style.background = "#f39c12"; // Orange (moderate)
            } else {
                document.getElementById("meterFill").style.background = "#e74c3c"; // Red (concerning)
            }
            
            // Provide feedback based on result
            let feedback = "";
            if (Ao < 0.001) {
                feedback = "The calculated vent area is very small. This may indicate an undersized vent valve that could fail to relieve pressure adequately during an overpressure event. Consider verifying your inputs or consulting with a safety engineer.";
            } else if (Ao < 0.01) {
                feedback = "The calculated vent area is within the optimal range for many industrial applications. This size should provide adequate pressure relief while maintaining system efficiency.";
            } else if (Ao < 0.1) {
                feedback = "The calculated vent area is moderately large. This may be appropriate for high-capacity systems but could indicate potential overdesign. Verify that all input parameters are accurate.";
            } else {
                feedback = "The calculated vent area is very large. This may indicate an oversized vent valve or potentially unrealistic input parameters. Please double-check your values, especially heat input and mass flux.";
            }
            
            document.getElementById("feedbackContent").textContent = feedback;
            
            // Show result section
            document.getElementById("resultValue").classList.remove("hidden");
        }
        
        function printReport() {
            window.print();
        }
        
        // Allow Enter key to trigger calculation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                calculateVentArea();
            }
        });
    </script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used (for your code comments)
// Formula for No-Overpressure Vent Area (All-Liquid Venting):
// Ao = (QT * vfa) / (G * vf * hfa)
//
// Where:
//   Ao  = Required Vent Area (m²)
//   QT  = Heat Input (kW) → must be converted to kJ/s
//   vfa = Liquid Specific Volume (m³/kg)
//   G   = Mass Flux (kg/m²s)
//   vf  = Vapor Specific Volume (m³/kg)
//   hfa = Latent Heat of Vaporization (kJ/kg)

2. Detailed Input Validation Rules
Heat Input (QT) (kW)

Must be > 0

Typical Range: 1 – 100,000 kW (fire exposure to tanks is usually <50,000 kW for most chemical/petroleum installations)

Max Validation: Cap warning at 100,000 kW

Decimals: Up to 3 allowed

Liquid Specific Volume (vfa) (m³/kg)

Must be > 0

Typical Range: 0.0008 – 0.002 m³/kg (most organic liquids/water-like density)

Max Validation: If >0.1, flag as unrealistic

Decimals: Up to 6

Mass Flux (G) (kg/m²·s)

Must be > 0

Typical Range: 100 – 10,000 kg/m²·s (per API 2000)

Max Validation: >50,000 → warning

Decimals: Up to 3

Vapor Specific Volume (vf) (m³/kg)

Must be > 0

Typical Range: 0.5 – 10 m³/kg

Max Validation: >100 → warning

Decimals: Up to 3

Latent Heat of Vaporization (hfa) (kJ/kg)

Must be > 0

Typical Range: 200 – 2,500 kJ/kg (water ~2257 kJ/kg)

Max Validation: >5,000 → warning

Decimals: Up to 3

3. Output Validation Logic

Ao < 0.001 m²: Too small – risk of undersized venting → non-compliant under NFPA/API

0.001 ≤ Ao < 0.01 m²: Small but potentially acceptable for lab/low-risk systems

0.01 ≤ Ao < 0.1 m²: Optimal range for industrial tank vents

0.1 ≤ Ao < 1.0 m²: Large vent, may indicate overdesign or extreme scenario → verify inputs

Ao ≥ 1.0 m²: Very large vent area, likely unrealistic → warn user {% endcomment %}