{% extends 'base.html' %}
{% block title %}PPE Stock Level Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPE Stock Level Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 480px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .stock-status {
            font-size: 24px;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .adequate { color: #2e7d32; }
        .low { color: #f9a825; }
        .critical { color: #c62828; }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>PPE Stock Level Calculator</h1>
            <p>Calculate your current Personal Protective Equipment inventory level</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="initialStock">Initial Stock (S<sub>initial</sub>) - Units:</label>
                    <input type="number" id="initialStock" class="form-input" min="0" placeholder="e.g., 500">
                </div>
                <div class="form-group">
                    <label for="ordersReceived">Orders Received (O) - Units:</label>
                    <input type="number" id="ordersReceived" class="form-input" min="0" placeholder="e.g., 200">
                </div>
                <div class="form-group">
                    <label for="unitsUsed">Units Used (U) - Units:</label>
                    <input type="number" id="unitsUsed" class="form-input" min="0" placeholder="e.g., 350">
                </div>
                
                <button class="calculate-btn" onclick="calculateStock()">Calculate Current Stock</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                     <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate your <strong>Current PPE Stock Level</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>PPE Stock Level</h2>
                    </div>
                    
                    <div class="rate-display">
                        <div class="rate-value" id="stockValue">0</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Current PPE units in stock</div>
                    </div>
                    
                    <div id="stockStatus" class="stock-status"></div>

                    <div class="result-feedback">
                        <div class="feedback-title">Stock Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

<!-- Notes Section -->
<div class="note-section">

    <!-- 1. About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>PPE Stock Level Calculator</strong> determines your current inventory of Personal Protective Equipment 
            based on <b>Initial Stock</b>, <b>Orders Received</b>, and <b>Units Used</b>. 
            It helps ensure safety compliance and avoid shortages by providing real-time stock assessments.
        </p>
    </div>

    <!-- 2. Parameters -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Initial Stock (S<sub>initial</sub>):</strong> Starting PPE quantity in inventory.</li>
            <li><strong>Orders Received (O):</strong> New PPE units added to inventory.</li>
            <li><strong>Units Used (U):</strong> PPE units consumed or distributed.</li>
         
        </ul>
    </div>

    <!-- 3. Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>All inputs must be <b>non-negative whole numbers</b> (no decimals or text).</li>
            <li><b>Initial Stock:</b> 0 – 1,000,000 units.</li>
            <li><b>Orders Received:</b> 0 – 500,000 units.</li>
            <li><b>Units Used:</b> 0 – 1,000,000 units.</li>
            <li><b>Cross-check:</b> Units Used ≤ (Initial Stock + Orders Received).</li>
            <li>All values cannot be zero simultaneously.</li>
        </ul>
    </div>

    <!-- 4. Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <p>The calculator provides stock assessment messages exactly as shown in the results:</p>
        <ul class="note-list">
            <li><b>0 units:</b> ❌ OUT OF STOCK → ⚠️ CRITICAL: You have no PPE items in stock. Immediate ordering is required.</li>
            <li><b>1–19 units:</b> ⚠️ CRITICALLY LOW STOCK → ⚠️ CRITICAL: PPE stock is dangerously low. Emergency order required.</li>
            <li><b>20–49 units:</b> ⚠️ LOW STOCK → 🔶 WARNING: PPE stock is getting low. Place a new order soon.</li>
            <li><b>≥ 50 units:</b> ✅ ADEQUATE STOCK → ✅ GOOD: Your PPE stock level is adequate. Continue monitoring usage.</li>
        </ul>
    </div>

    <!-- 5. Standards -->
    <!-- Governing Principle Card -->
<div class="note-card">
    <h3>📏 Governing Principle</h3>
    <p>
        There is no single, universal standard for a <strong>PPE Stock Level Calculator</strong>. Organizations typically use 
        widely accepted principles of inventory management, guided by broader occupational health and safety (OHS) standards.
    </p>

    <h3>Relevant Standards & Guidance</h3>
    <ul class="note-list">
        <li><strong>ISO 45001:</strong> Framework for managing OHS risks, including ensuring necessary PPE is available. While it does not prescribe stock level formulas, it emphasizes robust inventory management.</li>
        <li><strong>OSHA & Other Regulations:</strong> Employers must provide and ensure proper PPE use. Calculators help prevent stockouts and ensure compliance.</li>
        <li><strong>Healthcare Guidance:</strong> Tools like CDC’s <em>PPE Burn Rate Calculator</em> demonstrate industry-specific calculators designed to project PPE needs based on usage patterns.</li>
        <li><strong>General Inventory Management Principles:</strong> Standard supply chain practices, safety stock calculations, lead times, and usage rates inform PPE stock calculations.</li>
    </ul>
<br>
    <h3>Key Factors Influencing Calculations</h3>
    <ul class="note-list">
        <li><strong>Usage Rate:</strong> Speed of PPE consumption.</li>
        <li><strong>Lead Time:</strong> Time for new PPE to arrive after ordering.</li>
        <li><strong>Safety Stock:</strong> Surplus to prevent shortages during unexpected demand or delays.</li>
        <li><strong>Storage Conditions:</strong> Shelf life and degradation of PPE items.</li>
        <li><strong>Risk Assessment:</strong> Potential severity of stockouts, particularly in high-risk environments.</li>
    </ul>

    <p>
        In summary, a PPE stock level calculator is based on established inventory and safety management principles, but it is not governed by a single definitive standard.
    </p>
</div>
<!-- Conclusion Card -->
<div class="note-card">
    <h3>📌 Conclusion</h3>
    <p>
        The PPE Stock Level Calculator helps organizations monitor and manage their PPE inventory efficiently. 
        By accounting for initial stock, orders received, and units used, it ensures adequate safety supplies, 
        prevents stockouts, and supports workplace safety compliance.
    </p>
</div>

</div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateStock() {
    const initialStock = document.getElementById('initialStock').value.trim();
    const ordersReceived = document.getElementById('ordersReceived').value.trim();
    const unitsUsed = document.getElementById('unitsUsed').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // Convert to numbers for validation
    const initStock = parseFloat(initialStock);
    const orders = parseFloat(ordersReceived);
    const used = parseFloat(unitsUsed);

    // --- Validation Rules ---
    // General numeric checks
    if (initialStock === "" || isNaN(initStock)) {
        errors.push("👉 Please enter a valid Initial Stock (whole number).");
    } else if (!Number.isInteger(initStock) || initStock < 0) {
        errors.push("👉 Initial Stock must be a non-negative whole number.");
    } else if (initStock > 1000000) {
        errors.push("👉 Initial Stock cannot exceed 1,000,000 units.");
    }

    if (ordersReceived === "" || isNaN(orders)) {
        errors.push("👉 Please enter a valid Orders Received (whole number).");
    } else if (!Number.isInteger(orders) || orders < 0) {
        errors.push("👉 Orders Received must be a non-negative whole number.");
    } else if (orders > 500000) {
        errors.push("👉 Orders Received cannot exceed 500,000 units.");
    }

    if (unitsUsed === "" || isNaN(used)) {
        errors.push("👉 Please enter a valid Units Used (whole number).");
    } else if (!Number.isInteger(used) || used < 0) {
        errors.push("👉 Units Used must be a non-negative whole number.");
    } else if (used > 1000000) {
        errors.push("👉 Units Used cannot exceed 1,000,000 units.");
    }

    // Cross-field logic
    if (!isNaN(initStock) && !isNaN(orders) && !isNaN(used)) {
        if (used > (initStock + orders)) {
            errors.push("👉 Units Used cannot exceed Initial Stock + Orders Received.");
        }
        if (initStock === 0 && orders === 0 && used === 0) {
            errors.push("👉 All values cannot be zero. Please enter valid stock data.");
        }
    }

    // --- Error Handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Safe Calculations ---
    const currentStock = initStock + orders - used;
    document.getElementById('stockValue').textContent = currentStock.toFixed(0);

    const stockStatus = document.getElementById('stockStatus');
    let feedback;

    // --- Stock level assessment ---
    if (currentStock <= 0) {
        stockStatus.textContent = "❌ OUT OF STOCK";
        stockStatus.className = "stock-status critical";
        feedback = "⚠️ CRITICAL: You have no PPE items in stock. Immediate ordering is required.";
    } else if (currentStock < 20) {
        stockStatus.textContent = "⚠️ CRITICALLY LOW STOCK";
        stockStatus.className = "stock-status critical";
        feedback = "⚠️ CRITICAL: PPE stock is dangerously low. Emergency order required.";
    } else if (currentStock < 50) {
        stockStatus.textContent = "⚠️ LOW STOCK";
        stockStatus.className = "stock-status low";
        feedback = "🔶 WARNING: PPE stock is getting low. Place a new order soon.";
    } else {
        stockStatus.textContent = "✅ ADEQUATE STOCK";
        stockStatus.className = "stock-status adequate";
        feedback = "✅ GOOD: Your PPE stock level is adequate. Continue monitoring usage.";
    }

    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used (to keep in code as comment)
/*
Formula Used:
--------------
Current PPE Stock = Initial Stock (S_initial) + Orders Received (O) – Units Used (U)

Validation Principles:
----------------------
1. All inputs must be non-negative whole numbers (units cannot be negative or fractional).
2. Units Used (U) ≤ (Initial Stock + Orders Received).
3. Inputs must fall within realistic operational ranges (based on audit practices).
4. Outputs must reflect meaningful PPE stock categories (Adequate, Low, Critical).
*/

2. Detailed Input Validation Rules (QEHS & Fire Safety Practice)
a. General Rules (All Inputs)

Must be whole numbers only (PPE units are countable, not fractional).

Must be ≥ 0 (negative PPE stock is illogical).

Should not exceed 1,000,000 units (reasonable upper threshold for most organizations; beyond that, flag as outlier for data entry error).

No exponential or scientific notation allowed.

Must not contain text, spaces, or special characters.

b. Initial Stock (S<sub>initial</sub>)

Range: 0 – 1,000,000 units.

Represents starting balance; if > 1,000,000, likely a data entry error.

Required field.

c. Orders Received (O)

Range: 0 – 500,000 units.

Cannot be negative.

Required field.

If value is suspiciously high (e.g., > 500,000 units), issue warning → may indicate bulk import error.

d. Units Used (U)

Range: 0 – 1,000,000 units.

Cannot exceed S<sub>initial</sub> + O.

Required field.

Must be logical → usage should not exceed available stock.

e. Cross-Field Validations

U ≤ (S_initial + O)

If all inputs are 0 → show error: "All values cannot be zero. Please enter valid stock data."

If Orders Received = 0 and Units Used > Initial Stock → invalid scenario.

3. Output Validation & Threshold Explanations
Current Stock Calculation:

Current Stock = S_initial + O – U

Thresholds (aligned with OSHA/NFPA best practice stock management for critical PPE):

Adequate Stock (≥ 50 units): Enough PPE to cover short-term operations.

Low Stock (20–49 units): Stock is dropping; order planning required.

Critical Stock (1–19 units): Immediate risk of running out; emergency order needed.

Out of Stock (0 units): Non-compliance and unsafe situation. {% endcomment %}