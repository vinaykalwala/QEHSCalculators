{% extends 'base.html' %}
{% block title %}BS 6759 Valves Minimum Orifice Area For Liquids Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS 6759 Valves Minimum Orifice Area For Liquids Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            {% comment %} display: flex; {% endcomment %}
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            {% comment %} overflow-y: auto; {% endcomment %}
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        
        .error {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
            display: block;
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
            font-size: 18px;
            margin-bottom: 20px;
        }

        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
    

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>BS 6759 Valves Minimum Orifice Area For Liquids Calculator</h1>
            <p>Calculate the minimum orifice area required for liquid flow through a pressure relief valve</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                <div class="form-group">
                    <label for="massFlow">Mass Flow Rate (·πÅ) [kg/h]</label>
                    <input type="number" id="massFlow" class="form-input" min="0.01" placeholder="e.g., 1000">
                    <span class="error" id="massFlowError"></span>
                </div>
                <div class="form-group">
                    <label for="Kd">Coefficient of Discharge (Kd)</label>
                    <input type="number" id="Kd" class="form-input" min="0.01" max="1" step="0.01" placeholder="e.g., 0.65">
                    <span class="error" id="KdError"></span>
                </div>
                 </div>
                 <div class="input-row">
                <div class="form-group">
                    <label for="Kv">Viscosity Correction Factor (Kv)</label>
                    <input type="number" id="Kv" class="form-input" min="0.01" step="0.01" placeholder="e.g., 1.0">
                    <span class="error" id="KvError"></span>
                </div>
                <div class="form-group">
                    <label for="density">Density (œÅ) [kg/m¬≥]</label>
                    <input type="number" id="density" class="form-input" min="0.01" placeholder="e.g., 1000">
                    <span class="error" id="densityError"></span>
                </div>
                </div>
                <div class="form-group">
                    <label for="pressureDiff">Pressure Difference (ŒîP) [bar]</label>
                    <input type="number" id="pressureDiff" class="form-input" min="0.01" placeholder="e.g., 10">
                    <span class="error" id="pressureDiffError"></span>
                </div>
                
                <button class="calculate-btn" onclick="calculateOrificeArea()">Calculate Orifice Area</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/3148/3148975.png" alt="Valve illustration">
                    <p>This tool will calculate the <strong>Minimum Orifice Area</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Minimum Orifice Area</h2>
                    </div>
                    <div class='rate-display'>
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">mm¬≤</div></div>

                    <div class="result-feedback">
                        <div class="feedback-title">Calculation Details</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    This calculator determines the <strong>minimum orifice area</strong> required for liquid flow through a pressure relief valve according to BS 6759 standards.
                </p>
            </div>
            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Explained</h3>
                <ul class="note-list">
                    <li><strong>A‚ÇÄ (Flow Area):</strong> The minimum required opening size for liquid discharge.</li>
                    <li><strong>·πÅ (Mass Flow Rate):</strong> The amount of liquid passing per hour.</li>
                    <li><strong>Kd (Coefficient of Discharge):</strong> A correction factor based on valve design.</li>
                    <li><strong>Kv (Viscosity Factor):</strong> Accounts for the effect of fluid viscosity.</li>
                    <li><strong>œÅ (Density):</strong> The mass per unit volume of the liquid.</li>
                    <li><strong>ŒîP (Pressure Difference):</strong> The driving force of fluid discharge.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üìã About BS 6759</h3>
                <p><strong>BS 6759</strong> is a British Standard that specifies requirements for the performance, design, and testing of safety valves used in pressurized systems. It ensures that safety valves operate reliably to prevent overpressure in boilers, pipelines, and industrial equipment.</p>
            </div>
            
            <div class="note-card">
                <h3>‚ùì Why 1.61 in the Formula?</h3>
                <p>The constant <strong>1.61</strong> is an empirical factor derived from standardized flow calculations. It accounts for unit conversions and flow characteristics in practical engineering applications.</p>
            </div>
            
            <div class="note-card">
                <h3>üè≠ Real-Life Applications</h3>
                <ul class="note-list">
                    <li><strong>Safety Valves in Chemical Plants:</strong> Prevents overpressure accidents.</li>
                    <li><strong>Refineries & Oil Industry:</strong> Ensures safe fluid discharge.</li>
                    <li><strong>Fire Protection Systems:</strong> Calculates required nozzle sizes.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>‚úÖ Conclusion</h3>
                <p>This formula plays a crucial role in ensuring the safe design of relief systems. Proper selection of valve orifice size prevents failures and protects equipment.</p>
            </div>
        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateOrificeArea() {
            const massFlow = document.getElementById('massFlow').value.trim();
            const Kd = document.getElementById('Kd').value.trim();
            const Kv = document.getElementById('Kv').value.trim();
            const density = document.getElementById('density').value.trim();
            const pressureDiff = document.getElementById('pressureDiff').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            // Reset error messages
            document.getElementById("massFlowError").innerText = "";
            document.getElementById("KdError").innerText = "";
            document.getElementById("KvError").innerText = "";
            document.getElementById("densityError").innerText = "";
            document.getElementById("pressureDiffError").innerText = "";

            let errors = [];
            
            // Validation with explanations
            if (massFlow === "") {
                errors.push("üëâ Please enter the mass flow rate.");
                document.getElementById("massFlowError").innerText = "Mass flow rate must be greater than 0.";
            } else if (parseFloat(massFlow) <= 0) {
                errors.push("üëâ Mass flow rate must be greater than 0.");
                document.getElementById("massFlowError").innerText = "Mass flow rate must be greater than 0. It represents the amount of fluid passing per unit time.";
            }
            
            if (Kd === "") {
                errors.push("üëâ Please enter the coefficient of discharge.");
                document.getElementById("KdError").innerText = "Coefficient of discharge is required.";
            } else if (parseFloat(Kd) <= 0 || parseFloat(Kd) > 1) {
                errors.push("üëâ Coefficient of discharge must be between 0 and 1.");
                document.getElementById("KdError").innerText = "Coefficient of discharge (Kd) must be between 0 and 1. It defines efficiency of fluid discharge.";
            }
            
            if (Kv === "") {
                errors.push("üëâ Please enter the viscosity correction factor.");
                document.getElementById("KvError").innerText = "Viscosity correction factor is required.";
            } else if (parseFloat(Kv) <= 0) {
                errors.push("üëâ Viscosity correction factor must be greater than 0.");
                document.getElementById("KvError").innerText = "Viscosity correction factor (Kv) must be greater than 0. It accounts for fluid resistance effects.";
            }
            
            if (density === "") {
                errors.push("üëâ Please enter the density.");
                document.getElementById("densityError").innerText = "Density is required.";
            } else if (parseFloat(density) <= 0) {
                errors.push("üëâ Density must be greater than 0.");
                document.getElementById("densityError").innerText = "Density (œÅ) must be greater than 0. It determines fluid mass per unit volume.";
            }
            
            if (pressureDiff === "") {
                errors.push("üëâ Please enter the pressure difference.");
                document.getElementById("pressureDiffError").innerText = "Pressure difference is required.";
            } else if (parseFloat(pressureDiff) <= 0) {
                errors.push("üëâ Pressure difference must be greater than 0.");
                document.getElementById("pressureDiffError").innerText = "Pressure difference (ŒîP) must be greater than 0. It drives fluid through the valve.";
            }

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // Perform calculation
            const m = parseFloat(massFlow);
            const kd = parseFloat(Kd);
            const kv = parseFloat(Kv);
            const p = parseFloat(density);
            const dp = parseFloat(pressureDiff);
            
            const orificeArea = m / (1.61 * kd * kv * Math.sqrt(p * dp));
            
            // Display result
            document.getElementById('rateValue').textContent = orificeArea.toFixed(4);
            
            // Provide feedback based on the result
            let feedback = `Based on your inputs:
            <ul>
                <li>Mass Flow Rate: ${m} kg/h</li>
                <li>Coefficient of Discharge: ${kd}</li>
                <li>Viscosity Correction Factor: ${kv}</li>
                <li>Density: ${p} kg/m¬≥</li>
                <li>Pressure Difference: ${dp} bar</li>
            </ul>
            The calculated minimum orifice area is <strong>${orificeArea.toFixed(4)} mm¬≤</strong>.`;
            
            document.getElementById('feedbackContent').innerHTML = feedback;

            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}