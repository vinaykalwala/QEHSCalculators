{% extends 'base.html' %}
{% block title %}Bit Wear and Efficiency Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bit Wear and Efficiency Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
           <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}
    
        <div class="calculator-header">
            <h1>Bit Wear and Efficiency Calculator</h1>
            <p>Calculate your drill bit efficiency by comparing performance of new versus worn bits</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="ropNew">ROP with New Bit (ft/hr or m/hr)</label>
                    <input type="number" id="ropNew" class="form-input" min="0.1" step="0.1" placeholder="e.g., 50.5">
                </div>
                <div class="form-group">
                    <label for="ropWorn">ROP with Worn Bit (ft/hr or m/hr)</label>
                    <input type="number" id="ropWorn" class="form-input" min="0.1" step="0.1" placeholder="e.g., 35.2">
                </div>
                
                <button class="calculate-btn" onclick="calculateBitEfficiency()">Calculate Bit Efficiency</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Bit Efficiency</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Bit Efficiency</h2></div>
                    <div class="rate-value" id="rateValue">0.00%</div>
                    <div class="rate-label">Efficiency percentage of worn bit compared to new bit</div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Excellent</span><span>Good</span><span>Moderate</span><span>Poor</span><span>Critical</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Bit Condition Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

       <!-- Notes Section -->
<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Bit Wear and Efficiency Calculator</strong> evaluates drill bit performance by 
            comparing its <strong>Rate of Penetration (ROP)</strong> when new versus when worn. 
            It helps drilling engineers monitor bit degradation, determine efficiency, 
            and plan timely bit replacements to optimize drilling costs and minimize downtime.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>ROP with New Bit:</strong> Drilling rate achieved using a new bit (ft/hr or m/hr).</li>
            <li><strong>ROP with Worn Bit:</strong> Drilling rate after the bit has experienced wear (ft/hr or m/hr).</li>
            <li><strong>Bit Efficiency (%):</strong> Ratio of ROP with worn bit to ROP with new bit, multiplied by 100.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📝 Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>ROP with New Bit:</strong> Must be greater than 0 and ≤ 1000 ft/hr or m/hr.</li>
            <li><strong>ROP with Worn Bit:</strong> Must be greater than 0 and ≤ 1000 ft/hr or m/hr.</li>
            <li><strong>Consistency Check:</strong> ROP (worn) should not exceed ROP (new).</li>
            <li><strong>Efficiency Output:</strong> Valid range is between 0% and 100%.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>Efficiency ≥ 80% → ✅ Bit in good condition.</li>
            <li>Efficiency 50–79% → ⚠️ Moderate wear detected. Monitor closely.</li>
            <li>Efficiency 20–49% → 🔶 Significant wear. Replacement recommended soon.</li>
            <li>Efficiency &lt; 20% → 🚨 Critical wear! Immediate replacement required.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            The evaluation of <strong>Bit Wear and Efficiency</strong> is guided by industry-recognized 
            standards and methodologies, primarily established by the 
            <strong>International Association of Drilling Contractors (IADC)</strong> and the 
            <strong>American Petroleum Institute (API)</strong>. These standards ensure consistency, 
            reliability, and safety in drilling operations.
        </p>
        <ul class="note-list">
            <li><strong>IADC Dull Grading System:</strong> Defines a uniform coding method to evaluate bit wear, 
                grading the cutting structure from 0 (no wear) to 8 (complete wear).</li>
            <li><strong>Mechanical Specific Energy (MSE):</strong> Quantifies drilling efficiency by calculating 
                the energy required to remove a unit volume of rock. A rise in MSE indicates bit dulling.</li>
            <li><strong>API RP 7G-2 and API Spec 7-2:</strong> Provide design, manufacturing, and evaluation 
                requirements for drill bits and drill stem elements.</li>
        </ul>
        <p>
            Together, these standards form the engineering foundation for performance tracking, 
            predictive maintenance, and optimization of drilling efficiency in real-world operations.
        </p>
    </div>

    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <p>
            This calculator assists in determining the remaining performance potential of a drill bit 
            by computing efficiency and wear levels. 
            By following IADC and API practices, it ensures improved drilling safety, cost-effectiveness, 
            and operational reliability.
        </p>
    </div>

</div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateBitEfficiency() {
    const ropNew = document.getElementById('ropNew').value.trim();
    const ropWorn = document.getElementById('ropWorn').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Validation Rules ---
    // ROP New Bit: must be >0 and realistic
    if (ropNew === "" || isNaN(ropNew) || parseFloat(ropNew) <= 0 || parseFloat(ropNew) > 1000) {
        errors.push("👉 ROP with new bit must be greater than 0 and ≤ 1000 (ft/hr or m/hr).");
    }

    // ROP Worn Bit: must be >0 and realistic
    if (ropWorn === "" || isNaN(ropWorn) || parseFloat(ropWorn) <= 0 || parseFloat(ropWorn) > 1000) {
        errors.push("👉 ROP with worn bit must be greater than 0 and ≤ 1000 (ft/hr or m/hr).");
    }

    // Logical consistency: worn ROP must not exceed new ROP
    if (errors.length === 0 && parseFloat(ropWorn) > parseFloat(ropNew)) {
        errors.push("👉 ROP with worn bit cannot exceed ROP with new bit.");
    }

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Formula ---
    // Efficiency (%) = (ROP_worn / ROP_new) * 100
    const newROP = parseFloat(ropNew);
    const wornROP = parseFloat(ropWorn);
    const efficiency = (wornROP / newROP) * 100;

    // Reject absurd results
    if (efficiency <= 0 || efficiency > 100) {
        errorMessage.innerHTML = "👉 Invalid efficiency result. Please check inputs.";
        errorBox.classList.remove("hidden");
        return;
    }

    // Display efficiency
    document.getElementById('rateValue').textContent = efficiency.toFixed(2) + "%";

    // --- Output Assessment ---
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (efficiency >= 80) {
        meterWidth = '20%'; 
        meterColor = '#27ae60';
        feedback = '✅ Bit in good condition.';
    } else if (efficiency >= 50) {
        meterWidth = '50%'; 
        meterColor = '#f39c12';
        feedback = '⚠️ Moderate wear detected. Monitor closely.';
    } else if (efficiency >= 20) {
        meterWidth = '75%'; 
        meterColor = '#e67e22';
        feedback = '🔶 Significant wear. Replacement recommended soon.';
    } else {
        meterWidth = '90%'; 
        meterColor = '#e74c3c';
        feedback = '🚨 Critical wear! Immediate replacement required.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}



{% comment %} 
1. Formula and Real-World Safety Perspective

Formula applied (from your code):

Bit Efficiency
(
%
)
=
ROP
worn
ROP
new
×
100
Bit Efficiency(%)=
ROP
new
	​

ROP
worn
	​

	​

×100

Where:

ROP (Rate of Penetration) = Drilling speed in ft/hr or m/hr.

New Bit ROP = Benchmark performance when bit is new.

Worn Bit ROP = Current performance.

⚠️ Why this matters in QEHS/Fire Safety:

Poor bit efficiency → longer drilling times → more heat generation, vibration, equipment stress.

In mining, tunneling, or oil/gas, this can raise fire hazard risk (sparks, frictional heat) and occupational safety risks (bit failure, unexpected downtime, emergency evacuations).

Tracking efficiency ensures preventive maintenance, cost savings, and reduced risk of catastrophic equipment failure.

2. Input Validation Rules
Input	Unit	Validation Rules	Compliance Rationale
ROP New Bit	ft/hr or m/hr	- Must be > 0
- Must be ≤ 1000 (drilling machines rarely exceed 500 m/hr)
- Up to 1 decimal allowed	Prevents division by zero; ensures realistic performance
ROP Worn Bit	ft/hr or m/hr	- Must be > 0
- Must be ≤ ROP New
- Must be ≤ 1000
- Up to 1 decimal allowed	Prevents unrealistic worn bit “outperforming” new bit; ensures data consistency
Cross-field dependency	–	ROP Worn ≤ ROP New	Ensures logical consistency
Unit Consistency	–	Both inputs must use same unit (ft/hr or m/hr)	Prevents skewed results
3. Edge Case Validations

ROP New = 0 → division by zero → reject.

ROP Worn > ROP New → invalid.

Both ROPs extremely low (<1 m/hr) → warn user about unrealistic drilling scenario.

Efficiency > 100% → reject.

Efficiency < 5% → mark as critical, as bit is effectively unusable.

4. Output Validation & Thresholds

≥ 80% → ✅ Excellent / Good condition.

50–79% → ⚠️ Moderate wear, monitor closely.

20–49% → ❌ Poor condition, replacement strongly advised.

< 20% → 🔴 Critical, immediate replacement required.

This aligns with ISO 14224 reliability reporting, where equipment performance degradation is tracked in defined thresholds. {% endcomment %}