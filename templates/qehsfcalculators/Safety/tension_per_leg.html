{% extends 'base.html' %}
{% block title %}Tension Per Leg Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tension Per Leg Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px; /* Fixed Height */
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px; /* Fixed Height */
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        .sub-results {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }

        .sub-result-item {
            text-align: center;
        }
        
        .sub-result-value {
            font-size: 20px;
            font-weight: 600;
            color: #34495e;
        }

        .sub-result-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Tension Per Leg Calculator</h1>
            <p>Calculate the true tension on each sling leg to ensure safe lifting operations and proper equipment selection.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Rigging Parameters</h2>
                <div class="form-group">
                    <label for="totalLoad">Total Load (W) [kg]</label>
                    <input type="number" id="totalLoad" class="form-input" placeholder="e.g., 10000">
                </div>
                <div class="form-group">
                    <label for="numLegs">Number of Legs (N)</label>
                    <input type="number" id="numLegs" class="form-input" placeholder="e.g., 4">
                </div>
                <div class="form-group">
                    <label for="slingLength">Sling Length (L) [m]</label>
                    <input type="number" id="slingLength" class="form-input" placeholder="e.g., 5">
                </div>
                <div class="form-group">
                    <label for="verticalHeight">Vertical Height (H) [m]</label>
                    <input type="number" id="verticalHeight" class="form-input" placeholder="e.g., 4">
                </div>
                <button class="calculate-btn" onclick="calculateTension()">Calculate Tension</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Crane lifting illustration">
                    <p>Enter your load and rigging geometry to calculate the tension per leg and assess the safety of the lift angle.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" id="rateLabel">Tension Per Leg (kg)</div>
                    
                    <div class="sub-results">
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="tensionFactor">0.00</div>
                            <div class="sub-result-label">Tension Factor (L/H)</div>
                        </div>
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="weightPerLeg">0 kg</div>
                            <div class="sub-result-label">Weight per Leg</div>
                        </div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Safe</span><span>Good</span><span>Caution</span><span>Danger</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Lift Safety Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    This calculator is used to determine the tension per leg of a lifting sling. Accurate tension
                    calculations are essential for safe lifting operations, preventing overloading and ensuring
                    the correct sling type is used. It helps in selecting the appropriate lifting equipment and
                    minimizes the risk of accidents, equipment failure, and workplace hazards.
                </p>
            </div>
        
            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <p>
                    The calculation is based on several key factors that influence the tension in each sling leg:
                </p>
                <ul class="note-list">
                    <li><strong>Total Load (W):</strong> The overall weight of the object being lifted, measured in kilograms.
                        This includes the weight of the load itself and any additional forces acting on it.</li>
                    <li><strong>Sling Length (L):</strong> The length of each individual sling leg, measured in meters. A longer
                        sling affects the load distribution and lifting angle.</li>
                    <li><strong>Number of Legs (N):</strong> The total number of sling legs supporting the load. More sling legs
                        generally help distribute the load more evenly, reducing individual leg tension.</li>
                    <li><strong>Vertical Height (H):</strong> The height from the lifting point to the load, measured in meters.
                        A shorter vertical height increases the angle of the sling, leading to higher tension in each leg.</li>
                </ul>
            </div>

            <div class="note-card">
        <h3>⚠️ Input Validation Rules</h3>
                <ul>
                    <li>👉 <strong>Total Load (W):</strong> Must be a number greater than 0 and not exceed 500,000 kg.</li>
                    <li>👉 <strong>Sling Length (L):</strong> Must be a number greater than 0 (in meters).</li>
                    <li>👉 <strong>Vertical Height (H):</strong> Must be a number greater than 0, and cannot be greater than
                        Sling Length (L).</li>
                    <li>👉 <strong>Number of Legs (N):</strong> Must be a whole number between 1 and 6 (most rigging setups use
                        2–6 legs).</li>
                    <li>👉 All inputs must be numeric (no text, blank values, or symbols).</li>
                </ul>
            </div>
            
           <div class="note-card">
    <h3>📌 Output Validations</h3>
    <p>The calculator evaluates the sling angle using the <strong>Tension Factor (L/H)</strong> and provides feedback:</p>
    <ul>
        <li>(Tension Factor ≤ 1.155 | Angle ≥ 60°) <strong>✅ Safe Angle:</strong> The sling angle is optimal. Each leg requires a Working Load Limit (WLL) of at least the calculated value.</li>
        <li>(Tension Factor ≤ 1.414 | Angle 45°–60°) <strong>👍 Good Angle:</strong> The sling angle is acceptable. Each leg requires a WLL of at least the calculated value.</li>
        <li>(Tension Factor ≤ 2.0 | Angle 30°–45°) <strong>🟡 Caution:</strong> Sling angle is low, increasing tension significantly. Each leg requires a WLL of at least the calculated value.</li>
        <li>(Tension Factor > 2.0 | Angle < 30°) <strong>❌ Danger:</strong> Sling angle is below 30°. Tension is dangerously high. <strong>Do not attempt this lift.</strong> Increase the vertical height (H).</li>
    </ul>
</div>

          <div class="note-card">
    <h3>📏 Governing Principle</h3>
    <p>
        A Tension Per Leg calculator is a practical tool used in rigging and lifting operations to determine the force on each sling leg. It is guided by fundamental physics principles and safety standards such as those set by OSHA, as well as manufacturer guidelines and industry best practices. This ensures that slings are not overloaded and lifting operations are safe.
    </p>
    <h3>Key Principles</h3>
    <ul class="note-list">
        <li><strong>Vertical Hitch:</strong> When a sling is perfectly vertical, the load is evenly shared among the sling legs.</li>
        <li><strong>Angled Sling:</strong> When slings are at an angle, each leg experiences higher tension due to the geometry of the setup.</li>
        <li><strong>Tension Factor:</strong> Represents how much the sling angle increases the tension in each leg. It is based on manufacturer charts or simple geometric calculations.</li>
    </ul><br>
    <h3>How to Use the Calculator</h3>
    <ul class="note-list">
        <li>Enter the total weight of the load you plan to lift.</li>
        <li>Specify the number of sling legs supporting the load.</li>
        <li>Provide the sling length and vertical height of the lift.</li>
        <li>Click the “Calculate” button to determine the tension on each leg.</li>
        <li>Review the safety assessment provided to ensure the lift angle is within safe limits and that the slings have adequate capacity.</li>
    </ul><br>
    <h3>Importance of Standards</h3>
    <ul class="note-list">
        <li><strong>Safety Regulations:</strong> OSHA and other safety bodies provide guidelines to prevent overloading and accidents.</li>
        <li><strong>Manufacturer Guidelines:</strong> Slings must be used according to rated capacities provided by manufacturers.</li>
        <li><strong>Industry Practices:</strong> Following these calculations ensures a safe lifting margin and reduces the risk of sling failure.</li>
    </ul>
</div>

        
            <div class="note-card">
                <h3>✅ Conclusion</h3>
                <p>
                    The calculated <strong>tension per leg</strong> helps in determining the appropriate sling rating
                    required for a safe lift. If the tension exceeds the Working Load Limit (WLL) of the selected sling,
                    adjustments must be made, such as increasing the number of legs, using longer slings, or reducing the
                    total load. Proper load distribution and correct sling selection are critical to preventing failures
                    and ensuring a safe lifting operation.
                </p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if (document.getElementById('printDate')) {
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateTension() {
            const W_val = document.getElementById('totalLoad').value.trim();
            const N_val = document.getElementById('numLegs').value.trim();
            const L_val = document.getElementById('slingLength').value.trim();
            const H_val = document.getElementById('verticalHeight').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // --- INPUT VALIDATIONS ---
            if (W_val === '' || isNaN(W_val) || parseFloat(W_val) <= 0) {
                errors.push("👉 Total Load must be a number > 0.");
            } else if (parseFloat(W_val) > 500000) {
                errors.push("👉 Total Load exceeds practical safe lifting capacity (>500,000 kg).");
            }

            if (L_val === '' || isNaN(L_val) || parseFloat(L_val) <= 0) {
                errors.push("👉 Sling Length must be a number > 0.");
            }

            if (H_val === '' || isNaN(H_val) || parseFloat(H_val) <= 0) {
                errors.push("👉 Vertical Height must be a number > 0.");
            }

            const N = parseFloat(N_val);
            if (N_val === '' || isNaN(N) || N <= 0) {
                errors.push("👉 Number of Legs must be a number > 0.");
            } else if (!Number.isInteger(N)) {
                errors.push("👉 Number of Legs must be a whole number.");
            } else if (N > 6) {
                errors.push("👉 Number of Legs cannot exceed 6 (most rigging configurations use 2–6 legs).");
            }

            if (parseFloat(H_val) > parseFloat(L_val)) {
                errors.push("👉 Height (H) cannot be greater than Length (L). This is a physical impossibility for a sling in tension.");
            }

            // --- ERROR HANDLING ---
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // --- CALCULATION ---
            const W = parseFloat(W_val);
            const L = parseFloat(L_val);
            const H = parseFloat(H_val);

            const weightPerLeg = W / N;
            const tensionFactor = L / H;
            const tensionPerLeg = weightPerLeg * tensionFactor;

            if (!isFinite(tensionPerLeg) || tensionPerLeg <= 0) {
                errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your inputs.";
                errorBox.classList.remove("hidden");
                resultValue.classList.add("hidden");
                return;
            }

            // --- OUTPUTS ---
            document.getElementById('rateValue').textContent = tensionPerLeg.toFixed(2);
            document.getElementById('tensionFactor').textContent = tensionFactor.toFixed(3);
            document.getElementById('weightPerLeg').textContent = weightPerLeg.toFixed(2) + ' kg';

            // --- SAFETY ASSESSMENT ---
            const meterFill = document.getElementById('meterFill');
            const requiredWLL = Math.ceil(tensionPerLeg);
            let meterWidth, meterColor, feedback;

            if (tensionFactor <= 1.155) { // Angle >= 60 deg
                meterWidth = '20%';
                meterColor = '#2ecc71'; // Green
                feedback = `✅ <strong>Safe Angle.</strong> The sling angle is optimal. Each leg requires a Working Load Limit (WLL) of at least <strong>${requiredWLL} kg</strong>.`;
            } else if (tensionFactor <= 1.414) { // Angle >= 45 deg
                meterWidth = '45%';
                meterColor = '#f1c40f'; // Yellow
                feedback = `👍 <strong>Good Angle.</strong> The sling angle is acceptable. Each leg requires a WLL of at least <strong>${requiredWLL} kg</strong>.`;
            } else if (tensionFactor <= 2.0) { // Angle >= 30 deg
                meterWidth = '70%';
                meterColor = '#e67e22'; // Orange
                feedback = `🟡 <strong>Caution.</strong> Sling angle is low, increasing tension significantly. Each leg requires a WLL of at least <strong>${requiredWLL} kg</strong>.`;
            } else { // Angle < 30 deg
                meterWidth = '95%';
                meterColor = '#e74c3c'; // Red
                feedback = `❌ <strong>Danger!</strong> Sling angle is below 30°. Tension is dangerously high. <strong>Do not attempt this lift.</strong> Increase the vertical height (H).`;
            }

            meterFill.style.width = meterWidth;
            meterFill.style.backgroundColor = meterColor;
            document.getElementById('feedbackContent').innerHTML = feedback;

            placeholder.classList.add("hidden");
            resultValue.classList.remove("hidden");
        }

        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            window.print();
        }
    </script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 
🔎 1. Real-World Analysis of Inputs, Outputs & Formula

Formula Used:

𝑇
=
𝑊
×
𝐿
𝑁
×
𝐻
T=
N×H
W×L
	​


where:

𝑊
W = Total Load (kg)

𝑁
N = Number of sling legs

𝐿
L = Sling length (m)

𝐻
H = Vertical height (m)

Tension Factor (L/H) = multiplier effect caused by sling angle.

Output (T) = tension per sling leg.

✅ This matches the standard rigging formula for symmetrical multi-leg lifts.
❌ However, real-world compliance demands strict validation of input ranges to avoid unsafe assumptions.

✅ 2. Comprehensive Input Validation Rules

a) Total Load (W) [kg]

Must be > 0.

Upper limit: usually ≤ 500,000 kg for crane rigging calculators (beyond this → heavy lift engineering study required).

Allow up to 1 decimal place for smaller loads, but usually integers.

Units must be in kg (not tonnes or lbs) unless conversion is built in.

b) Number of Legs (N)

Must be an integer between 1 and 4 (standard sling configurations).

4 legs exist in theory but are rarely effective (load isn’t evenly shared).

Non-integers not allowed.

c) Sling Length (L) [m]

Must be > 0.

Practical range: ≥ H and ≤ 100 m (since sling must be longer than vertical height).

Allow 1 decimal place.

d) Vertical Height (H) [m]

Must be > 0.

Must be ≤ L (geometrically required).

Practical range: 0.5 m ≤ H ≤ 100 m.

⚠️ 3. Edge Case Validations

Division by Zero: if N=0 or H=0 → invalid.

L < H: not physically possible, should trigger error.

Very small H (flat angle slings): Tension skyrockets → must warn user if 
𝐿
/
𝐻
>
2
L/H>2.

Extreme W with few legs (e.g., 100-ton load on 1 leg): warn for unsafe lift.

Non-integer N: reject (rigging legs can’t be fractional).

📊 4. Output Validations & Thresholds

Safe Range:

Tension per leg ≤ (W/N), and Tension Factor ≤ 1.2 → ✅ Safe.

Good Range:

Tension Factor between 1.21 – 1.5 → 👍 Good, but monitor angles.

Caution Range:

Tension Factor between 1.51 – 2.0 → ⚠️ Caution, unsafe sling angle (< 30°).

Danger Range:

Tension Factor > 2.0 → ❌ Dangerous, reject lift (extreme sling angle).
-->