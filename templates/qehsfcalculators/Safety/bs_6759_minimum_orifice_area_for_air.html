{% extends 'base.html' %}
{% block title %}BS-6759 Minimum Orifice Area for Air{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS-6759 Minimum Orifice Area for Air</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>BS-6759 Minimum Orifice Area for Air</h1>
            <p>Calculate the minimum orifice area required for air safety valves based on BS 6759 standard</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="volumetricFlow">Volumetric Flow Rate (V̇) (l/s)</label>
                    <input type="number" id="volumetricFlow" class="form-input" min="0" step="any" placeholder="e.g., 100">
                </div>
                <div class="form-group">
                    <label for="pressure">Absolute Relieving Pressure (Pᵣ) (bar a)</label>
                    <input type="number" id="pressure" class="form-input" min="0" step="any" placeholder="e.g., 10">
                </div>
                <div class="form-group">
                    <label for="kdr">Derated Coefficient of Discharge (Kdr)</label>
                    <input type="number" id="kdr" class="form-input" min="0.01" max="1" step="0.01" placeholder="e.g., 0.85" value="0.85">
                </div>
                <div class="form-group">
                    <label for="temperature">Inlet Temperature (T) (K)</label>
                    <input type="number" id="temperature" class="form-input" min="0" step="any" placeholder="e.g., 288" value="288">
                </div>
                
                <button class="calculate-btn" onclick="calculateOrificeArea()">Calculate Orifice Area</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Minimum Orifice Area for Air</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Minimum Orifice Area</h2>
                    </div>
                    <div class='rate-display'>
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">mm²</div></div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

      <!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>BS-6759 Minimum Orifice Area for Air Calculator</strong> helps determine the minimum required orifice area for safety valves in air systems according to the BS 6759 standard.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Volumetric Flow Rate (V̇):</strong> The total air volume that needs to be discharged per second (l/s).</li>
            <li><strong>Absolute Relieving Pressure (Pᵣ):</strong> The system pressure at which the valve will relieve air (bar a).</li>
            <li><strong>Derated Coefficient of Discharge (Kdr):</strong> A correction factor accounting for discharge efficiency (0–1).</li>
            <li><strong>Inlet Temperature (T):</strong> The temperature of the air entering the valve, measured in Kelvin (K).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📝 Input Validations</h3>
        <ul class="note-list">
            <li><strong>Volumetric Flow Rate (V̇):</strong> Must be > 0 l/s. Warning if > 100,000 l/s.</li>
            <li><strong>Pressure (Pᵣ):</strong> Must be > 1 bar a. Warning if > 400 bar a.</li>
            <li><strong>Derated Coefficient of Discharge (Kdr):</strong> Must be between 0.01 and 1.00.</li>
            <li><strong>Inlet Temperature (T):</strong> Must be ≥ 200 K and ≤ 2000 K.</li>
            <li><strong>Cross-Checks:</strong> Unrealistic area sizes (&lt;1 mm² or &gt;10,000 mm²) trigger warnings.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>Orifice Area &lt; 1 mm²: ⚠️ Unrealistically small; check input values.</li>
            <li>Orifice Area 1–50 mm²: ⚠️ Small; ensure sufficient for safe air discharge.</li>
            <li>Orifice Area 50–2000 mm²: ✅ Optimal; within typical BS 6759 range for safety valves.</li>
            <li>Orifice Area 2000–10000 mm²: ❌ Large; verify against system design requirements.</li>
            <li>Orifice Area &gt; 10000 mm²: ❌ Extremely large; likely input or unit error.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            The calculation of the minimum required orifice area for air, particularly in the context of safety valves, is outlined in BS 6759. This standard specifically addresses safety valves for steam, air/gases, and liquids.
        </p>
        <h3>How it Works</h3>
        <ul class="note-list">
            <li><strong>Calculation Formula:</strong> Uses the BS-6759 air formula to compute the minimum orifice area based on volumetric flow, pressure, Kdr, and inlet temperature.</li>
            <li><strong>Flow Estimation:</strong> Ensures that the calculated area allows adequate air discharge to prevent overpressure in the system.</li>
        </ul>
        <br>
        <h3>Relevant Standards & Guidelines</h3>
        <ul class="note-list">
            <li><strong>BS 6759 (UK):</strong> Specifies design, performance, and testing requirements for safety valves.</li>
            <li><strong>ISO 4126:</strong> Standard for safety valves in gases, steam, and liquids.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <p>
            This tool helps engineers and technicians determine the minimum orifice area required for a safety valve in air systems. Proper valve sizing enhances safety, efficiency, and compliance with industrial safety standards.
        </p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
});

function calculateOrificeArea() {
    const volumetricFlow = document.getElementById('volumetricFlow').value.trim();
    const pressure = document.getElementById('pressure').value.trim();
    const kdr = document.getElementById('kdr').value.trim();
    const temperature = document.getElementById('temperature').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    const V = parseFloat(volumetricFlow);
    const P = parseFloat(pressure);
    const K = parseFloat(kdr);
    const T = parseFloat(temperature);

    // === Input Validations ===
    if (isNaN(V) || V <= 0) errors.push("👉 Volumetric Flow Rate must be greater than 0 l/s.");
    else if (V > 100000) errors.push("👉 Flow rate exceeds realistic limits (>100,000 l/s). Check units.");

    if (isNaN(P) || P <= 0) errors.push("👉 Absolute Relieving Pressure must be greater than 0 bar a.");
    else if (P < 1) errors.push("👉 Pressure cannot be less than 1 bar absolute (vacuum).");
    else if (P > 400) errors.push("👉 Pressure above 400 bar a is outside BS 6759 scope. Check units.");

    if (isNaN(K) || K < 0.01 || K > 1) errors.push("👉 Derated Coefficient of Discharge (Kdr) must be between 0.01 and 1.00.");

    if (isNaN(T) || T < 200 || T > 2000) errors.push("👉 Inlet Temperature must be between 200 K and 2000 K.");

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // === Calculation ===
    const orificeArea = (V / (0.193 * P * K)) * Math.sqrt(T / 288);

    document.getElementById('rateValue').textContent = orificeArea.toFixed(4);

    // === Output Feedback ===
    let feedback;
    if (orificeArea < 1) feedback = '⚠️ Unrealistically small; check input values.';
    else if (orificeArea < 50) feedback = '⚠️ Small; ensure sufficient for safe air discharge.';
    else if (orificeArea <= 2000) feedback = '✅ Optimal; within typical BS 6759 range for safety valves.';
    else if (orificeArea <= 10000) feedback = '❌ Large; verify against system design requirements.';
    else feedback = '❌ Extremely large; likely input or unit error.';

    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

function printReport() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>


</body>
</html>
{% endblock %}



{% comment %} 
1. Formula (with comment for future code)

The calculator currently uses:

𝐴
=
𝑉
0.193
×
𝑃
×
𝐾
×
𝑇
288
A=
0.193×P×K
V
	​

×
288
T
	​

	​


Where:

𝐴
A = Minimum Orifice Area (mm²)

𝑉
V = Volumetric Flow Rate (l/s)

𝑃
P = Absolute Relieving Pressure (bar a)

𝐾
K = Derated Coefficient of Discharge (0–1)

𝑇
T = Inlet Temperature (K)

/* 
Formula Reference (BS 6759 - Air Safety Valves):
A = (V / (0.193 * P * K)) * sqrt(T / 288)

Where:
- V = Volumetric Flow Rate (l/s), must be > 0
- P = Absolute Relieving Pressure (bar a), must be > 1 bar a
- K = Derated Coefficient of Discharge, range 0.01–1.00
- T = Absolute Temperature (K), must be ≥ 200 K (approx -73 °C), typically 250–350 K

Units:
- Orifice Area returned in mm²
*/

2. Detailed Input Validation Rules (Industry-Based)
Parameter	Range/Validation	Why it matters (Compliance/Safety)
Volumetric Flow (V̇)	> 0, typically 1 – 100,000 l/s	Zero or negative flow is physically meaningless; unrealistic high flows may indicate input error or wrong unit.
Pressure (Pᵣ)	> 1 bar a, max practical ~ 400 bar a	Below 1 bar absolute is impossible (vacuum). Extremely high pressures suggest wrong units (e.g., MPa instead of bar).
Kdr (Coefficient of Discharge)	0.01 – 1.00, default 0.85	Defined by valve design. Outside this range violates BS 6759, API RP 520.
Temperature (T)	≥ 200 K and ≤ 2000 K	Absolute zero (0 K) impossible. Typical engineering ranges are 250–350 K. Extreme outliers must be flagged.
Cross-field checks	If V̇ is very high but Pᵣ is very low → area explodes → flag unrealistic.	Prevents misleading results that would fail audits.
Decimals	Allow up to 4 decimals, round output to 2–4	Prevents false precision in reports. {% endcomment %}