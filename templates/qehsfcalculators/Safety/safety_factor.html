{% extends 'base.html' %}
{% block title %}Safety Factor calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 250px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
       
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
 <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Safety Factor (SF) Calculator</h1>
        <p>Evaluate the safety margin of materials and structures by comparing ultimate stress and allowable stress.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="ultimateStress">Ultimate Stress (σᵤ) (MPa)</label>
                <input type="number" id="ultimateStress" class="form-input" min="0" step="0.1" placeholder="e.g., 400">
            </div>
            <div class="form-group">
                <label for="allowableStress">Allowable Stress (σₐ) (MPa)</label>
                <input type="number" id="allowableStress" class="form-input" min="0" step="0.1" placeholder="e.g., 200">
            </div>
            <button class="calculate-btn" onclick="calculateSafetyFactor()">Calculate Safety Factor</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Safety Factor Illustration">
                <p>This tool will calculate <strong>Safety Factor</strong>. Enter your data to see results and insights here.</p>
            </div>
            
            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>
            
            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Safety Factor Result</h2>
                </div>
                <div class="rate-value" id="safetyFactorValue">0</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">
                    Safety Factor (SF)
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
       <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
        The <strong>Safety Factor (SF) Calculator</strong> is a quick engineering tool used to evaluate the margin of safety in a material or structure. 
        It works by dividing the <em>Ultimate Stress (σᵤ)</em> of a material by the <em>Allowable Stress (σₐ)</em>. 
    </p>
    <p>
        The result indicates how much stronger a material is compared to the stress it is permitted to carry in design. 
    </p>
    <p>
        This calculator helps engineers and designers ensure that components, machines, and structures remain within safe operating limits, 
        reducing the likelihood of failures during use.
    </p>
</div>


        <div class="note-card">
            <h3>⚙️ Parameters Used</h3>
            <ul class="note-list">
                <li><strong>Ultimate Stress (σᵤ):</strong> The maximum stress a material can withstand before failure.</li>
                <li><strong>Allowable Stress (σₐ):</strong> The stress limit set for safe design, considering uncertainties.</li>
            </ul>
        </div>

       <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Ultimate Stress (σᵤ):</strong> 
            <ul>
                <li>Must be a numeric value to ensure accurate calculations.</li>
                <li>Must be greater than 0 MPa; negative or zero values are physically impossible and unsafe.</li>
                <li>Should fall within a realistic range depending on material type (e.g., metals: 100–2000 MPa; concrete: 20–60 MPa). Values far outside these ranges are flagged as potential input errors.</li>
                <li>Decimals are allowed up to 1 place for practical precision (e.g., 405.5 MPa).</li>
            </ul>
        </li>
        <li><strong>Allowable Stress (σₐ):</strong> 
            <ul>
                <li>Must be numeric; non-numeric values are invalid.</li>
                <li>Must be greater than 0 MPa; zero or negative values are invalid and would cause division by zero errors.</li>
                <li>Should always be less than or equal to Ultimate Stress; if σₐ &gt; σᵤ, the Safety Factor would be below 1, which is unsafe.</li>
                <li>Typical range depends on design standards (e.g., 10–1000 MPa), ensuring results are realistic and code-compliant.</li>
                <li>Decimals allowed up to 1 place for accurate calculations.</li>
            </ul>
        </li>
        <li><strong>Logical Combination (Safety Factor):</strong> 
            <ul>
                <li>Extreme values (e.g., SF &gt; 10) are flagged to alert the user to possible input errors.</li>
                <li>SF &lt; 1 is flagged as unsafe, indicating that the material or structure cannot safely handle the applied load.</li>
            </ul>
        </li>
        <li><strong>Missing or Invalid Inputs:</strong>
            <ul>
                <li>Empty fields, zero, negative, or non-numeric inputs are invalid and prevent calculation.</li>
                <li>Ensures that only valid and realistic values are used, supporting safety compliance and audit-ready reporting.</li>
            </ul>
        </li>
        <li><strong>Edge Cases & Outliers:</strong>
            <ul>
                <li>Division by zero is prevented by ensuring σₐ &gt; 0.</li>
                <li>Unrealistic high values (e.g., σᵤ &gt; 10,000 MPa or σₐ &gt; 1,000 MPa) are flagged.</li>
                <li>Decimals beyond 1 place may trigger a warning for precision, ensuring the result is meaningful and compliant.</li>
            </ul>
        </li>
    </ul>
    <p>
        These validation rules ensure that all inputs are physically realistic, code-compliant (ASME, ISO 2394, OSHA, ISO 45001), 
        and suitable for accurate calculation of Safety Factor. They also prevent errors, support audit documentation, and enhance workplace safety by avoiding unsafe material use.
    </p>
</div>


       <div class="note-card">
    <h3>📊 Output Validations</h3>
    <ul class="note-list">
        <li><span class="bad">Safety Factor &lt; 1:</span> ❌ Unsafe – the material or structure is likely to fail under load. Immediate review or redesign is required.</li>
        <li><span class="average">Safety Factor between 1 and 2:</span> ⚠️ Risky – minimal safety margin. Suitable only for non-critical applications and requires careful monitoring to ensure safe operation.</li>
        <li><span class="good">Safety Factor &gt; 2:</span> ✅ Safe – conservative and reliable design. The material or structure has an adequate safety buffer, compliant with engineering standards and regulatory guidelines.</li>
    </ul>
    <p>
        These output validations ensure that the calculated safety levels are meaningful, actionable, and aligned with recognized engineering, occupational safety, and fire safety standards. They support audit documentation and help prevent unsafe material use.
    </p>
</div>


      <div class="note-card">
    <h3>📋 Standards & Compliance</h3>
    <p>
        The <strong>Safety Factor Calculator</strong> adheres to recognized engineering, occupational safety, and fire safety standards, ensuring reliable and audit-ready results:
    </p>
    <ul class="note-list">
        <li><strong>ASME Codes:</strong> Applies safety factor principles for pressure vessels, mechanical components, and industrial equipment design.</li>
        <li><strong>ISO 2394:</strong> Follows general reliability and structural safety guidelines for buildings, bridges, and engineered systems.</li>
        <li><strong>ISO 45001 & OSHA Guidelines:</strong> Supports workplace safety by ensuring structural integrity and reducing the risk of accidents or failures.</li>
        <li><strong>NFPA Standards:</strong> Assists in evaluating material and structural safety under fire or emergency conditions, relevant to fire prevention and emergency planning.</li>
        <li><strong>ILO Safety Principles:</strong> Considers international occupational safety norms to maintain safe operational environments.</li>
        <li><strong>Audit & Reporting:</strong> Provides validated safety factors with clear thresholds, suitable for internal audits, regulatory compliance, and risk assessment documentation.</li>
    </ul>
</div>


       <div class="note-card">
    <h3>🏁 Conclusion</h3>
    <p>
        The <strong>Safety Factor Calculator</strong> offers a quick way to verify design safety. 
        Use it to confirm that materials and structures operate within acceptable limits and maintain required safety margins.
    </p>
</div>

    </div>
</div>

<script>
function calculateSafetyFactor() {
    const ultimateStress = parseFloat(document.getElementById('ultimateStress').value);
    const allowableStress = parseFloat(document.getElementById('allowableStress').value);
    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const feedbackContent = document.getElementById('feedbackContent');

    let errors = [];

    // --- Mandatory & Numeric Check ---
    if (isNaN(ultimateStress)) errors.push("👉 Ultimate Stress must be a numeric value.");
    if (isNaN(allowableStress)) errors.push("👉 Allowable Stress must be a numeric value.");

    // --- Positive Check ---
    if (ultimateStress <= 0) errors.push("👉 Ultimate Stress must be greater than 0 MPa.");
    if (allowableStress <= 0) errors.push("👉 Allowable Stress must be greater than 0 MPa (cannot be zero).");

    // --- Realistic Range Check ---
    if (ultimateStress > 10000) errors.push("⚠️ Ultimate Stress unusually high (>10,000 MPa). Verify input.");
    if (allowableStress > 1000) errors.push("⚠️ Allowable Stress unusually high (>1,000 MPa). Verify input.");

    // --- Logical Consistency ---
    if (!isNaN(ultimateStress) && !isNaN(allowableStress)) {
        if (allowableStress > ultimateStress) errors.push("❌ Allowable Stress cannot exceed Ultimate Stress.");
    }

    // --- Stop and display errors ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculate Safety Factor ---
    const safetyFactor = ultimateStress / allowableStress;
    document.getElementById('safetyFactorValue').textContent = safetyFactor.toFixed(2);

    // --- Feedback based on SF ---
    let feedback = "";
    let color = "";
if (safetyFactor < 1) {
    feedback = "❌ Unsafe – the material or structure is likely to fail under load. Immediate review or redesign is required.";
    color = "red";
} else if (safetyFactor >= 1 && safetyFactor <= 2) {
    feedback = "⚠️ Risky – minimal safety margin. Suitable only for non-critical applications and requires careful monitoring to ensure safe operation.";
    color = "orange";
} else {
    feedback = "✅ Safe – conservative and reliable design. The material or structure has an adequate safety buffer, compliant with engineering standards and regulatory guidelines.";
    color = "green";
}

    // --- Extreme SF Warning ---
    if (safetyFactor > 10) {
        feedback += " ⚠️ SF unusually high (>10). Check inputs.";
    }

    feedbackContent.innerHTML = `<strong style="color:${color}">${feedback}</strong>`;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1️⃣ Input Analysis (QEHS / Fire Safety Perspective)
Input	Units	Meaning	QEHS Perspective
Ultimate Stress (σᵤ)	MPa	Max stress before failure	Must be realistic for the material; used to verify structure integrity and prevent catastrophic failure
Allowable Stress (σₐ)	MPa	Max stress allowed in design	Must reflect design codes and safety margins (ASME, ISO 2394); cannot be zero or negative

Calculation Formula:

𝑆
𝐹
=
Ultimate Stress (σᵤ)
Allowable Stress (σₐ)
SF=
Allowable Stress (σₐ)
Ultimate Stress (σᵤ)
	​


SF < 1 → Unsafe

SF 1–2 → Risky

SF > 2 → Safe

From a QEHS standpoint, this metric is critical for preventing structural failures, which could cause injuries, fatalities, or property damage.

2️⃣ Recommended Input Validation Rules
Ultimate Stress (σᵤ)

Must be numeric

Must be > 0 MPa

Typical range depends on material:

Metals: 100 – 2000 MPa

Concrete: 20 – 60 MPa

Extreme outliers (> 10,000 MPa) flagged

Allowed 1 decimal place

Unit must be MPa

Allowable Stress (σₐ)

Must be numeric

Must be > 0 MPa (cannot be zero → division by zero)

Typical range depends on design codes: 10 – 1000 MPa

Must be logically less than σᵤ (otherwise SF < 1 invalid)

Allowed 1 decimal place

Unit must be MPa

Logical Combination Rules

SF = σᵤ / σₐ

Extreme SF values (SF > 10) flagged → could indicate input error

SF < 0.5 flagged → unrealistic / unsafe

3️⃣ Output Validation Logic and Thresholds
SF Range	Feedback	Rationale
SF < 1	❌ Unsafe – material will likely fail	Violates fundamental safety principle; structure at immediate risk
1 ≤ SF ≤ 2	⚠️ Risky – minimal margin of safety	Acceptable only in non-critical applications; closer monitoring required
SF > 2	✅ Safe – conservative design	Meets industrial safety standards (ISO 2394, ASME)

Compliance Note:

Ensures KPI is reportable for audits

Prevents misinterpretation in OSHA/ISO 45001 risk assessments

4️⃣ Edge Case Validations

Division by zero → Allowable Stress = 0 → block calculation

Negative numbers → unrealistic for stress

Extremely high SF → SF > 10 → warn user

σₐ > σᵤ → SF < 1 → unsafe

Non-numeric inputs → block calculation

Empty inputs → block calculation

Decimals beyond 1 place → warn user (optional)

7️⃣ Why Each Validation is Essential (Compliance Rationale)

Numeric & Positive Check → Prevents invalid, non-engineering inputs.

Zero Allowable Stress → Avoids division by zero errors.

Logical Consistency (σₐ ≤ σᵤ) → Ensures safety factor is physically meaningful.

Range Checks → Prevent unrealistic outliers; ensures compliance with ASME, ISO, NFPA, OSHA safety design codes.

Extreme SF Warning → Flags input mistakes that could skew audit reporting.

Decimal Limits → Maintains realistic precision for safety-critical calculations. -->