{% extends 'base.html' %}
{% block title %}ASME (API RP 520) Valves - Reynolds Number Imperial Units Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASME (API RP 520) Valves - Reynolds Number Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Flow Type Indicator */
        .flow-indicator {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            position: relative;
        }
        
        .flow-marker {
            width: 30%;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .flow-marker.laminar {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .flow-marker.transitional {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .flow-marker.turbulent {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .current-flow {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
     
        
        .laminar-flow { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .transitional-flow { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .turbulent-flow { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        @media (max-width: 420px) {
    .result-card {
        min-height: auto !important;
        padding: 20px 15px !important;
    }
    
    .rate-value {
        font-size: 32px !important;
    }
    
    .flow-indicator {
        flex-direction: column;
        gap: 8px;
    }
    
    .flow-marker {
        width: 100% !important;
        margin-bottom: 5px;
    }
    
    .current-flow {
        position: static !important;
        transform: none !important;
        margin-top: 15px;
        width: 100%;
        text-align: center;
    }
    
    .result-feedback {
        padding: 12px !important;
    }
    
    .feedback-title {
        font-size: 14px;
    }
    
    .feedback-content {
        font-size: 13px;
    }
    
    .print-btn {
        padding: 10px 15px !important;
        font-size: 14px !important;
    }
}

/* Also add this for slightly larger screens */
@media (max-width: 600px) and (min-width: 421px) {
    .flow-marker {
        font-size: 12px;
        padding: 8px 5px;
    }
    
    .current-flow {
        bottom: -25px;
        font-size: 12px;
        padding: 6px 12px;
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>ASME (API RP 520) Valves - Reynolds Number Imperial Units Calculator</h1>
            <p>Calculate Reynolds Number for valve flow analysis in Imperial Units</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="specificGravity">Specific Gravity (G)</label>
                    <input type="number" id="specificGravity" class="form-input" min="0.01" step="0.01" placeholder="e.g., 0.85">
                </div>
                <div class="form-group">
                    <label for="volumeFlow">Volume Flow (V̇) (U.S. gal/min)</label>
                    <input type="number" id="volumeFlow" class="form-input" min="0.01" step="0.01" placeholder="e.g., 100">
                </div>
                <div class="form-group">
                    <label for="viscosity">Dynamic Viscosity (μ) (cP)</label>
                    <input type="number" id="viscosity" class="form-input" min="0.01" step="0.01" placeholder="e.g., 1.2">
                </div>
                <div class="form-group">
                    <label for="dischargeArea">Discharge Area (A₀) (in²)</label>
                    <input type="number" id="dischargeArea" class="form-input" min="0.01" step="0.01" placeholder="e.g., 0.5">
                </div>
                
                <button class="calculate-btn" onclick="calculateReynoldsNumber()">Calculate Rₑ</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Reynolds Number (Rₑ)</strong>. Enter your data to see results and flow regime classification.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                     <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Reynolds Number (Rₑ)</h2></div>
                    <div class="rate-value" id="reValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Dimensionless Quantity</div>

                    <div class="flow-indicator">
                        <div class="flow-marker laminar">Laminar<br>Rₑ < 2000</div>
                        <div class="flow-marker transitional">Transitional<br>2000 ≤ Rₑ ≤ 4000</div>
                        <div class="flow-marker turbulent">Turbulent<br>Rₑ > 4000</div>
                        <div class="current-flow" id="currentFlowIndicator"></div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Flow Regime Classification</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    This calculator determines the <strong>Reynolds Number (Rₑ)</strong> for ASME (API RP 520) valves using Imperial units. 
                    The Reynolds number helps classify the flow regime as <strong>laminar, transitional, or turbulent</strong>, which is critical for proper valve sizing and fluid dynamics analysis.
                </p>
            </div>
            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Specific Gravity (G):</strong> The ratio of fluid density to the density of water.</li>
                    <li><strong>Volume Flow (V̇) (U.S. gal/min):</strong> The volumetric flow rate of the fluid through the valve.</li>
                    <li><strong>Dynamic Viscosity (μ) (cP):</strong> A measure of a fluid's resistance to flow.</li>
                    <li><strong>Discharge Area (A₀) (in²):</strong> The effective area through which the fluid is discharged.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>📊 Interpretation</h3>
                <ul class="note-list">
                    <li><span class="laminar-flow">Rₑ < 2000</span> → Laminar Flow (Smooth and Predictable)</li>
                    <li><span class="transitional-flow">2000 ≤ Rₑ ≤ 4000</span> → Transitional Flow (Unstable and Mixed)</li>
                    <li><span class="turbulent-flow">Rₑ > 4000</span> → Turbulent Flow (Chaotic and High Energy)</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>🏭 ASME (API RP 520) Standard</h3>
                <p>
                    <strong>ASME (API RP 520)</strong> stands for American Society of Mechanical Engineers (American Petroleum Institute Recommended Practice 520). 
                    It provides guidelines for designing and installing pressure relief systems to protect equipment from excessive pressure 
                    in industries like oil & gas, chemical processing, and power generation.
                </p>
            </div>
            
            
            <div class="note-card">
                <h3>🔍 Applications</h3>
                <ul class="note-list">
                    <li>Valve Flow Analysis: Determines whether the fluid flow is laminar or turbulent.</li>
                    <li>Pipeline and Process Flow Assessment: Helps in designing systems with optimal flow conditions.</li>
                    <li>Fluid Dynamics in Safety Valves: Ensures efficient discharge and proper sizing of pressure relief devices.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>🌍 Input Constraints</h3>
                    <ul>
                     <li><strong>Specific Gravity must be positive:</strong> Ensures a valid fluid density comparison.</li>
                     <li><strong>Volume Flow must be greater than zero:</strong> Prevents invalid flow calculations.</li>
                     <li><strong>Dynamic Viscosity must be greater than zero:</strong> Ensures realistic fluid behavior.</li>
                     <li><strong>Discharge Area must be greater than zero:</strong> A required factor for flow calculations.</li>
                     <li><strong>Reynolds Number Classification:</strong>
                    <ul>
                      <li><strong>Re &lt; 2000:</strong> Laminar Flow (Smooth and Predictable).</li>
                      <li><strong>2000 ≤ Re ≤ 4000:</strong> Transitional Flow (Unstable and Mixed).</li>
                      <li><strong>Re &gt; 4000:</strong> Turbulent Flow (Chaotic and High Energy).</li>
                    </ul>
                    </li>
                   </ul>
            </div>
            <div class="note-card">
  <h3>🛡️ Input Validation Rules</h3>
  <ul class="note-list">
    <li><strong>Specific Gravity (G):</strong> 0.1 – 2.0 (dimensionless)</li>
    <li><strong>Volume Flow (V̇):</strong> 0.01 – 1,000,000 U.S. gal/min</li>
    <li><strong>Dynamic Viscosity (μ):</strong> 0.01 – 100,000 cP</li>
    <li><strong>Discharge Area (A₀):</strong> 0.01 – 10,000 in²</li>
    <li>⚠️ Unrealistic combinations (huge flow + tiny area) will be flagged.</li>
    <li>⚠️ Constant <code>2800</code> is a **unit conversion factor**, NOT Euler’s “e”.</li>
  </ul>
</div>

             <div class="note-card">
                <h3>📌 Conclusion</h3>
                    <p>This tool assists engineers and fluid mechanics specialists in determining the <strong>Reynolds Number (Re)</strong> for valve and piping systems. Proper analysis of the flow regime helps in optimizing system efficiency, selecting appropriate valves, and ensuring safe and reliable operation.</p>
            </div>
        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateReynoldsNumber() {
    const G = parseFloat(document.getElementById('specificGravity').value.trim());
    const V = parseFloat(document.getElementById('volumeFlow').value.trim());
    const μ = parseFloat(document.getElementById('viscosity').value.trim());
    const A = parseFloat(document.getElementById('dischargeArea').value.trim());

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    let errors = [];

    // === INPUT VALIDATION ===
    if (isNaN(G) || G <= 0) errors.push("👉 Specific Gravity must be > 0 (recommended 0.1–2.0).");
    else if (G < 0.1 || G > 2.0) errors.push("👉 Specific Gravity outside realistic range (0.1–2.0).");

    if (isNaN(V) || V <= 0) errors.push("👉 Volume Flow must be > 0.");
    else if (V > 1e6) errors.push("👉 Volume Flow too high (>1,000,000 gpm).");

    if (isNaN(μ) || μ <= 0) errors.push("👉 Dynamic Viscosity must be > 0.");
    else if (μ < 0.01) errors.push("👉 Viscosity too low (<0.01 cP).");
    else if (μ > 100000) errors.push("👉 Viscosity too high (>100,000 cP).");

    if (isNaN(A) || A <= 0) errors.push("👉 Discharge Area must be > 0.");
    else if (A < 0.01) errors.push("👉 Discharge Area too small (<0.01 in²).");
    else if (A > 10000) errors.push("👉 Discharge Area too large (>10,000 in²).");

    // Cross-field check
    if (V > 100000 && A < 1) {
        errors.push("👉 Unrealistic: very high flow with tiny discharge area. Recheck inputs.");
    }

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // === CALCULATION ===
    let Re = (2800 * G * V) / (μ * Math.sqrt(A));
    if (Re > 1e9) Re = 1e9; // cap to avoid meaningless overflow

    document.getElementById('reValue').textContent = Re.toFixed(2);

    // === FLOW CLASSIFICATION ===
    let flowType, feedback, indicatorPosition, indicatorColor;

    if (Re < 2000) {
        flowType = "Laminar Flow";
        feedback = "Smooth and orderly flow, typical of viscous fluids or low flow rates.";
        indicatorPosition = "15%";
        indicatorColor = "#4caf50";
    } else if (Re >= 2000 && Re <= 4000) {
        flowType = "Transitional Flow";
        feedback = "Unstable regime. API/ASME recommend designing away from this region.";
        indicatorPosition = "50%";
        indicatorColor = "#ff9800";
    } else {
        flowType = "Turbulent Flow";
        feedback = "Chaotic, mixing flow. Common in relief valves, ensures discharge capacity.";
        indicatorPosition = "85%";
        indicatorColor = "#f44336";
    }

    // Update flow indicator
    const indicator = document.getElementById('currentFlowIndicator');
    indicator.textContent = flowType;
    indicator.style.left = indicatorPosition;
    indicator.style.backgroundColor = indicatorColor;
    indicator.style.color = "white";

    // Update feedback
    document.getElementById('feedbackContent').textContent = feedback;

    // Show results
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}

{% comment %} 
🔢 1. Formula (Imperial Units)

From API RP 520 (Imperial adaptation):

𝑅
𝑒
=
2800
⋅
𝐺
⋅
𝑉
𝜇
⋅
𝐴
Re=
μ⋅
A
	​

2800⋅G⋅V
	​


Re → Reynolds Number (dimensionless)

G → Specific Gravity (dimensionless, ≥ 0.1 typical fluids)

V → Volumetric Flow Rate (U.S. gallons per minute)

μ → Dynamic Viscosity (centipoise, cP)

A → Discharge Area (square inches, in²)

2800 → Conversion constant (unit correction factor; not Euler’s e).

👉 Keep this formula in your code as a comment for engineers/auditors.

🛠 2. Input Validation Rules (Based on QEHS & API RP 520 Practice)
Specific Gravity (G)

Min: 0.1 (light gases/fluids below this are rare in relief valve service)

Max: 2.0 (dense fluids like heavy oils; >2 is unrealistic for pressure relief service)

Decimals: up to 3

Volume Flow (V̇, gal/min)

Min: 0.01 gpm (to prevent divide-by-zero)

Max: 1,000,000 gpm (upper bound for refinery/utility-scale flows; beyond this → unrealistic for relief valves)

Decimals: up to 2

Dynamic Viscosity (μ, cP)

Min: 0.01 cP (lower bound, lighter than most gases)

Max: 100,000 cP (very viscous materials like tar; API doesn’t recommend Reynolds-based analysis beyond this)

Decimals: up to 2

Discharge Area (A, in²)

Min: 0.01 in² (tiny orifice)

Max: 10,000 in² (very large vent; above this is structural, not valve sizing)

Decimals: up to 3

Cross-Field Dependencies

Large V with tiny A → unrealistic (should trigger warning).

Very high μ with high G and small A → calculation possible, but result interpretation must be flagged (“viscous regime – caution”).

⚠️ 3. Edge Case Validations

Zero/negative inputs → blocked.

Extremely high Reynolds (>1e9) → cap at 1e9 to prevent meaningless results.

μ > 10,000 cP → allow but warn: “Reynolds interpretation unreliable for highly viscous fluids.”

Tiny discharge area (<0.05 in²) with huge flow → flag as “unrealistic sizing”.

✅ 4. Output Validation Logic (Flow Regimes)

Re < 2000 → Laminar (smooth, predictable).

2000 ≤ Re ≤ 4000 → Transitional (unstable; avoid in design).

Re > 4000 → Turbulent (expected in safety valve operation).

From a compliance standpoint:

These thresholds are industry standard (API/ASME).

Safety audits require reporting not only the value but the classification.

Transitional region is flagged because ASME/API recommend designing away from it. {% endcomment %}


/*
 FORMULA (API RP 520 - Imperial Units)
 Re = (2800 * G * V) / (μ * sqrt(A))
 where:
   G = Specific Gravity (dimensionless, 0.1–2.0 typical)
   V = Volumetric Flow (U.S. gal/min, 0.01–1,000,000)
   μ = Dynamic Viscosity (cP, 0.01–100,000)
   A = Discharge Area (in², 0.01–10,000)
   2800 = Conversion constant (NOT Euler’s e)
*/