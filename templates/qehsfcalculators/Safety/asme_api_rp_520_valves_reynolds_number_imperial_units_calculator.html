{% extends 'base.html' %}
{% block title %}ASME (API RP 520) Valves - Reynolds Number Imperial Units Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASME (API RP 520) Valves - Reynolds Number Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Flow Type Indicator */
        .flow-indicator {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            position: relative;
        }
        
        .flow-marker {
            width: 30%;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .flow-marker.laminar {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .flow-marker.transitional {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .flow-marker.turbulent {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .current-flow {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
     
        
        .laminar-flow { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .transitional-flow { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .turbulent-flow { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>ASME (API RP 520) Valves - Reynolds Number Imperial Units Calculator</h1>
            <p>Calculate Reynolds Number for valve flow analysis in Imperial Units</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="specificGravity">Specific Gravity (G)</label>
                    <input type="number" id="specificGravity" class="form-input" min="0.01" step="0.01" placeholder="e.g., 0.85">
                </div>
                <div class="form-group">
                    <label for="volumeFlow">Volume Flow (VÃá) (U.S. gal/min)</label>
                    <input type="number" id="volumeFlow" class="form-input" min="0.01" step="0.01" placeholder="e.g., 100">
                </div>
                <div class="form-group">
                    <label for="viscosity">Dynamic Viscosity (Œº) (cP)</label>
                    <input type="number" id="viscosity" class="form-input" min="0.01" step="0.01" placeholder="e.g., 1.2">
                </div>
                <div class="form-group">
                    <label for="dischargeArea">Discharge Area (A‚ÇÄ) (in¬≤)</label>
                    <input type="number" id="dischargeArea" class="form-input" min="0.01" step="0.01" placeholder="e.g., 0.5">
                </div>
                
                <button class="calculate-btn" onclick="calculateReynoldsNumber()">Calculate R‚Çë</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/943/943773.png" alt="Fluid dynamics illustration">
                    <p>This tool will calculate the <strong>Reynolds Number (R‚Çë)</strong>. Enter your data to see results and flow regime classification.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                     <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Reynolds Number (R‚Çë)</h2></div>
                    <div class="rate-value" id="reValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Dimensionless Quantity</div>

                    <div class="flow-indicator">
                        <div class="flow-marker laminar">Laminar<br>R‚Çë < 2000</div>
                        <div class="flow-marker transitional">Transitional<br>2000 ‚â§ R‚Çë ‚â§ 4000</div>
                        <div class="flow-marker turbulent">Turbulent<br>R‚Çë > 4000</div>
                        <div class="current-flow" id="currentFlowIndicator"></div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Flow Regime Classification</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    This calculator determines the <strong>Reynolds Number (R‚Çë)</strong> for ASME (API RP 520) valves using Imperial units. 
                    The Reynolds number helps classify the flow regime as <strong>laminar, transitional, or turbulent</strong>, which is critical for proper valve sizing and fluid dynamics analysis.
                </p>
            </div>
            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Specific Gravity (G):</strong> The ratio of fluid density to the density of water.</li>
                    <li><strong>Volume Flow (VÃá) (U.S. gal/min):</strong> The volumetric flow rate of the fluid through the valve.</li>
                    <li><strong>Dynamic Viscosity (Œº) (cP):</strong> A measure of a fluid's resistance to flow.</li>
                    <li><strong>Discharge Area (A‚ÇÄ) (in¬≤):</strong> The effective area through which the fluid is discharged.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üìä Interpretation</h3>
                <ul class="note-list">
                    <li><span class="laminar-flow">R‚Çë < 2000</span> ‚Üí Laminar Flow (Smooth and Predictable)</li>
                    <li><span class="transitional-flow">2000 ‚â§ R‚Çë ‚â§ 4000</span> ‚Üí Transitional Flow (Unstable and Mixed)</li>
                    <li><span class="turbulent-flow">R‚Çë > 4000</span> ‚Üí Turbulent Flow (Chaotic and High Energy)</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>üè≠ ASME (API RP 520) Standard</h3>
                <p>
                    <strong>ASME (API RP 520)</strong> stands for American Society of Mechanical Engineers (American Petroleum Institute Recommended Practice 520). 
                    It provides guidelines for designing and installing pressure relief systems to protect equipment from excessive pressure 
                    in industries like oil & gas, chemical processing, and power generation.
                </p>
            </div>
            
            
            <div class="note-card">
                <h3>üîç Applications</h3>
                <ul class="note-list">
                    <li>Valve Flow Analysis: Determines whether the fluid flow is laminar or turbulent.</li>
                    <li>Pipeline and Process Flow Assessment: Helps in designing systems with optimal flow conditions.</li>
                    <li>Fluid Dynamics in Safety Valves: Ensures efficient discharge and proper sizing of pressure relief devices.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>üåç Validations & Input Constraints</h3>
                    <ul>
                     <li><strong>Specific Gravity must be positive:</strong> Ensures a valid fluid density comparison.</li>
                     <li><strong>Volume Flow must be greater than zero:</strong> Prevents invalid flow calculations.</li>
                     <li><strong>Dynamic Viscosity must be greater than zero:</strong> Ensures realistic fluid behavior.</li>
                     <li><strong>Discharge Area must be greater than zero:</strong> A required factor for flow calculations.</li>
                     <li><strong>Reynolds Number Classification:</strong>
                    <ul>
                      <li><strong>Re &lt; 2000:</strong> Laminar Flow (Smooth and Predictable).</li>
                      <li><strong>2000 ‚â§ Re ‚â§ 4000:</strong> Transitional Flow (Unstable and Mixed).</li>
                      <li><strong>Re &gt; 4000:</strong> Turbulent Flow (Chaotic and High Energy).</li>
                    </ul>
                    </li>
                   </ul>
            </div>
             <div class="note-card">
                <h3>üìå Conclusion</h3>
                    <p>This tool assists engineers and fluid mechanics specialists in determining the <strong>Reynolds Number (Re)</strong> for valve and piping systems. Proper analysis of the flow regime helps in optimizing system efficiency, selecting appropriate valves, and ensuring safe and reliable operation.</p>
            </div>
        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateReynoldsNumber() {
            const specificGravity = document.getElementById('specificGravity').value.trim();
            const volumeFlow = document.getElementById('volumeFlow').value.trim();
            const viscosity = document.getElementById('viscosity').value.trim();
            const dischargeArea = document.getElementById('dischargeArea').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];
            
            // Validate inputs
            if (specificGravity === "") {
                errors.push("üëâ Please enter the specific gravity.");
            } else if (parseFloat(specificGravity) <= 0) {
                errors.push("üëâ Specific gravity must be greater than 0.");
            }
            
            if (volumeFlow === "") {
                errors.push("üëâ Please enter the volume flow.");
            } else if (parseFloat(volumeFlow) <= 0) {
                errors.push("üëâ Volume flow must be greater than 0.");
            }
            
            if (viscosity === "") {
                errors.push("üëâ Please enter the dynamic viscosity.");
            } else if (parseFloat(viscosity) <= 0) {
                errors.push("üëâ Dynamic viscosity must be greater than 0.");
            }
            
            if (dischargeArea === "") {
                errors.push("üëâ Please enter the discharge area.");
            } else if (parseFloat(dischargeArea) <= 0) {
                errors.push("üëâ Discharge area must be greater than 0.");
            }

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // Calculate Reynolds Number
            const G = parseFloat(specificGravity);
            const V = parseFloat(volumeFlow);
            const Œº = parseFloat(viscosity);
            const A = parseFloat(dischargeArea);
            
            const Re = (2800 * G * V) / (Œº * Math.sqrt(A));
            
            document.getElementById('reValue').textContent = Re.toFixed(4);

            // Determine flow regime and set feedback
            let flowType, feedback, indicatorPosition, indicatorColor;
            
            if (Re < 2000) {
                flowType = "Laminar Flow";
                feedback = "The flow is smooth and orderly with parallel layers. This is typical for highly viscous fluids or low flow rates.";
                indicatorPosition = "15%";
                indicatorColor = "#4caf50";
            } else if (Re >= 2000 && Re <= 4000) {
                flowType = "Transitional Flow";
                feedback = "The flow is unstable and may fluctuate between laminar and turbulent characteristics. This region is often avoided in design.";
                indicatorPosition = "50%";
                indicatorColor = "#ff9800";
            } else {
                flowType = "Turbulent Flow";
                feedback = "The flow is chaotic with mixing and eddies. This is common in high-velocity flows and less viscous fluids.";
                indicatorPosition = "85%";
                indicatorColor = "#f44336";
            }
            
            // Update flow indicator
            const indicator = document.getElementById('currentFlowIndicator');
            indicator.textContent = flowType;
            indicator.style.left = indicatorPosition;
            indicator.style.backgroundColor = indicatorColor;
            indicator.style.color = "white";
            
            // Update feedback
            document.getElementById('feedbackContent').textContent = feedback;

            // Show results
            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}