{% extends 'base.html' %}
{% block title %}Mud Pump Output Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mud Pump Output Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Mud Pump Output Calculator</h1>
            <p>Calculate the efficiency of mud circulation by determining the pump output in gallons per minute (GPM)</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="pumpStrokes">Pump Strokes per Minute (N)</label>
                    <input type="number" id="pumpStrokes" class="form-input" min="0" placeholder="e.g., 50">
                </div>
                <div class="form-group">
                    <label for="pumpVolume">Pump Volume per Stroke (V) (cubic inches)</label>
                    <input type="number" id="pumpVolume" class="form-input" min="0" placeholder="e.g., 100">
                </div>
                
                <button class="calculate-btn" onclick="calculatePumpOutput()">Calculate Pump Output</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Pump illustration">
                    <p>This tool will calculate the <strong>Mud Pump Output</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Mud Pump Output</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Gallons per Minute (GPM)</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Mud Pump Output Calculator</strong> determines the efficiency of mud circulation by calculating the pump output in gallons per minute (GPM). This is a critical parameter in drilling operations, as it ensures proper mud circulation to maintain wellbore stability and remove cuttings.
                </p>
            </div>


            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Pump Strokes per Minute (N):</strong> The number of strokes the pump makes in one minute</li>
                    <li><strong>Pump Volume per Stroke (V):</strong> The amount of fluid displaced by the pump in a single stroke, measured in cubic inches</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>✅ Input Validations</h3>
    <ul class="note-list">
        <li><strong>Pump Strokes per Minute (N):</strong> Must be integer value between 1–500 spm (mechanical safety limits)</li>
        <li><strong>Pump Strokes Type:</strong> Integer values only, no decimals allowed</li>
        <li><strong>Pump Strokes Minimum:</strong> Must be > 0 (pump must be operating)</li>
        <li><strong>Pump Strokes Maximum:</strong> Cannot exceed 500 spm (mechanical design limit)</li>
        <li><strong>Pump Volume per Stroke (V):</strong> Must be between 10–2000 cubic inches (realistic pump capacity)</li>
        <li><strong>Pump Volume Minimum:</strong> Must be > 0 cubic inches</li>
        <li><strong>Pump Volume Maximum:</strong> Cannot exceed 2000 in³ (large triplex pump capacity)</li>
        <li><strong>Pump Volume Precision:</strong> Maximum 1 decimal place allowed for accuracy</li>
        <li><strong>Required Fields:</strong> Both pump strokes and volume must be provided</li>
    </ul>
</div>
<div class="note-card">
    <h3>🔎 Output Validations</h3>
    <ul class="note-list">
        <li><strong>Output < 150 GPM:</strong> ❌ Poor circulation – risk of inadequate cuttings removal and wellbore issues</li>
        <li><strong>150 ≤ Output < 300 GPM:</strong> ⚠️ Moderate circulation – monitor hole cleaning closely</li>
        <li><strong>300 ≤ Output ≤ 500 GPM:</strong> ✅ Good circulation – suitable for most drilling operations</li>
        <li><strong>Output > 500 GPM:</strong> ✅ Excellent circulation – optimal for efficient cuttings removal and wellbore stability</li>
    </ul>
</div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        There is no single official standard for mud pump output calculators, but the calculations are based on fundamental engineering principles and are commonly referenced within the oil and gas industry, most notably by standards from the American Petroleum Institute (API). The mud pump output calculation method depends on the type of pump being used, specifically whether it is a duplex (double-acting) or triplex (single-acting) pump. The formulas take into account a pump's key physical parameters, such as liner diameter, stroke length, strokes per minute, and volumetric efficiency.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Core Principles for Calculation</h3>
    <p>
        The American Petroleum Institute (API) provides standards and recommended practices for drilling equipment, and while it doesn't standardize a single calculator, the industry widely applies API-recognized engineering formulas for these calculations.
    </p>
    <p>
        The two most important parameters for any mud pump are:
    </p>
    <ul class="note-list">
        <li><b>Displacement:</b> The volume of fluid pumped per unit of time.</li>
        <li><b>Pressure:</b> The resistance the pump is operating against.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Key Formulas</h3>
    <p>
        Different formulas are used depending on the pump type:
    </p>
    <ul class="note-list">
        <li><b>Triplex mud pump output:</b> This calculation is based on the pump having three single-acting pistons.<br>
        Output(bbl/stk) = 0.000243 × (liner diameter)² × (stroke length) × Efficiency</li>
        <li><b>Duplex mud pump output:</b> This calculation is for a double-acting pump with two pistons and has a more complex formula to account for the piston rod volume.<br>
        Output(bbl/stk) = 0.000162 × (stroke length) × [2 × (liner diameter)² - (rod diameter)²] × Efficiency</li>
    </ul>
    <p>
        In both formulas, the efficiency value is a decimal (e.g., 98% is 0.98) that accounts for volumetric losses.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Relevant API Practices</h3>
    <p>
        Though no single API standard covers only pump output calculators, the calculations are fundamental to the practices detailed in API standards that govern the use and maintenance of drilling equipment:
    </p>
    <ul class="note-list">
        <li><b>API Recommended Practice 7L:</b> Covers procedures for the inspection, maintenance, and repair of drilling equipment, which assumes a proper understanding of pump performance.</li>
        <li><b>API Recommended Practice 13B-1:</b> Details procedures for field testing drilling fluids, where mud pump performance is a critical factor.</li>
    </ul>
</div>
<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines the <strong>mud pump output in gallons per minute (GPM)</strong> to evaluate 
        circulation efficiency in drilling operations. By accurately calculating the fluid displacement rate, 
        it ensures proper mud circulation for effective cuttings removal and wellbore stability, supporting 
        safe drilling practices and preventing well control incidents through optimal hydraulic management.
    </p>
</div>

        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculatePumpOutput() {
    const pumpStrokes = document.getElementById('pumpStrokes').value.trim();
    const pumpVolume = document.getElementById('pumpVolume').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // ------------------- VALIDATION RULES -------------------
    // Pump Strokes per Minute (N)
    if (pumpStrokes === "" || isNaN(pumpStrokes)) {
        errors.push("👉 Please enter pump strokes per minute (numeric only).");
    } else if (!Number.isInteger(Number(pumpStrokes))) {
        errors.push("👉 Pump strokes must be an integer (no decimals allowed).");
    } else if (parseInt(pumpStrokes) <= 0) {
        errors.push("👉 Pump strokes must be greater than zero.");
    } else if (parseInt(pumpStrokes) > 500) {
        errors.push("👉 Pump strokes cannot exceed 500 (mechanical safety limit).");
    }

    // Pump Volume per Stroke (V)
    if (pumpVolume === "" || isNaN(pumpVolume)) {
        errors.push("👉 Please enter pump volume per stroke (numeric only).");
    } else if (parseFloat(pumpVolume) <= 0) {
        errors.push("👉 Pump volume must be greater than zero.");
    } else if (parseFloat(pumpVolume) < 10) {
        errors.push("👉 Pump volume below 10 in³ is not realistic.");
    } else if (parseFloat(pumpVolume) > 2000) {
        errors.push("👉 Pump volume cannot exceed 2000 in³ (design limit).");
    } else if (!/^\d+(\.\d{1})?$/.test(pumpVolume)) {
        errors.push("👉 Pump volume can have at most 1 decimal place.");
    }

    // Error Handling
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ------------------- CALCULATION -------------------
    const strokes = parseInt(pumpStrokes);
    const volume = parseFloat(pumpVolume);

    // Formula: Q = (N * V) / 231
    const pumpOutput = (strokes * volume) / 231;

    // Cross-check maximum safe GPM
    if (pumpOutput > 4300) {
        errorMessage.innerHTML = "⚠️ Calculated GPM exceeds practical field capacity. Check inputs.";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Display result
    document.getElementById('rateValue').textContent = pumpOutput.toFixed(2);

    // Feedback assessment
    let feedback = "";
    if (pumpOutput > 500) {
        feedback = "✅ Excellent circulation – optimal for efficient cuttings removal and wellbore stability.";
    } else if (pumpOutput >= 300) {
        feedback = "✅ Good circulation – suitable for most drilling operations.";
    } else if (pumpOutput >= 150) {
        feedback = "⚠️ Moderate circulation – monitor hole cleaning closely.";
    } else {
        feedback = "❌ Poor circulation – risk of inadequate cuttings removal and wellbore issues.";
    }

    document.getElementById('feedbackContent').textContent = feedback;

    // Show result
    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}


        function printReport() {
            window.print();
        }

        // Allow Enter key to trigger calculation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                calculatePumpOutput();
            }
        });
    </script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used
// Formula for Mud Pump Output:
// Q = (N × V) ÷ 231
// Where:
// N = Pump Strokes per Minute (spm)
// V = Pump Volume per Stroke (cubic inches)
// 231 = conversion factor (1 US gallon = 231 cubic inches)
// Output = Gallons per Minute (GPM)


✅ This formula is correct and aligns with API Recommended Practice 13D and industry drilling standards.

2. Input Validation Rules (Real-world QEHS + Fire Safety)
Pump Strokes per Minute (N)

Allowed range: 1 – 500 spm

<1 is physically meaningless (pump not operating).

500 exceeds typical mud pump mechanical design and may be unsafe.

Decimals: Not allowed (must be integer).

Units: strokes/minute.

Cross-check: If strokes = 0, output = 0 → acceptable only if pump intentionally idle.

Pump Volume per Stroke (V)

Allowed range: 10 – 2000 in³/stroke

Below 10 in³ is unrealistic (even smallest liners exceed this).

Above 2000 in³ per stroke exceeds large triplex pump cylinder capacity.

Decimals: Up to 1 decimal place allowed (some pump volumes may be fractional due to liner wear).

Units: cubic inches.

Cross-check: If volume = 0 → meaningless, disallow.

Output (Q in GPM)

Theoretical output range: 1 – ~4300 GPM
(calculated: 500 spm × 2000 in³ ÷ 231 ≈ 4329 GPM).

Performance banding:

<150 GPM → Poor circulation, safety risk.

150–300 GPM → Moderate.

300–500 GPM → Good.

500 GPM → Excellent.

Values beyond ~4300 should be flagged as input error. {% endcomment %}