{% extends 'base.html' %}
{% block title %}Safety Valve Opening Force With The Spring Housing Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Valve Opening Force With The Spring Housing Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .force-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .force-label { 
            color: #7f8c8d; 
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Safety Valve Opening Force With The Spring Housing Calculator</h1>
            <p>Calculate the required opening force for a safety valve with spring housing</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="pressure">Fluid Inlet Pressure (P<sub>V</sub>) (Pa):</label>
                    <input type="number" id="pressure" class="form-input" min="0" placeholder="e.g., 500000">
                </div>
                <div class="form-group">
                    <label for="nozzleArea">Nozzle Area (A<sub>N</sub>) (m¬≤):</label>
                    <input type="number" id="nozzleArea" class="form-input" min="0.0001" step="0.0001" placeholder="e.g., 0.005">
                </div>
                <div class="form-group">
                    <label for="backPressure">Backpressure (P<sub>B</sub>) (Pa):</label>
                    <input type="number" id="backPressure" class="form-input" min="0" placeholder="e.g., 100000">
                </div>
                
                <button class="calculate-btn" onclick="calculateOpeningForce()">Calculate Opening Force</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Required Opening Force for a Safety Valve</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:30px;">
                        <h2>Required Opening Force</h2>
                    </div>
                    <div class="force-value" id="forceValue">0.00</div>
                    <div class="force-label">Newtons (N)</div>

                    <div class="result-feedback">
                        <div class="feedback-title"> Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <!-- About -->
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Safety Valve Opening Force with the spring housing Calculator</strong> determines the required force to open a safety valve with spring housing, considering fluid pressure, nozzle area, and backpressure. This calculation is essential for proper valve sizing, ensuring system safety, and preventing dangerous overpressure scenarios in industrial applications.
                </p>
            </div>

            <!-- Parameters Used -->
            <div class="note-card">
                <h3>‚öô Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Fluid Inlet Pressure (P<sub>V</sub>):</strong> The pressure exerted by the fluid at the inlet of the safety valve (Pascal/Pa).</li>
                    <li><strong>Nozzle Area (A<sub>N</sub>):</strong> The effective cross-sectional area of the valve nozzle through which fluid flows (m¬≤).</li>
                    <li><strong>Backpressure (P<sub>B</sub>):</strong> The pressure present at the outlet of the valve, which affects the opening force (Pascal/Pa).</li>
                </ul>
            </div>

            <!-- Input Validation Rules -->
            <div class="note-card">
                <h3>‚úÖ Input Validations</h3>
                <ul class="note-list">
                    <li><b>Fluid Inlet Pressure:</b> Must be a non-negative number (0 ‚Äì 10,000,000 Pa).</li>
                    <li><b>Nozzle Area:</b> Must be a positive number greater than 0.0001 m¬≤ (0.0001 ‚Äì 1 m¬≤).</li>
                    <li><b>Backpressure:</b> Must be a non-negative number (0 ‚Äì 10,000,000 Pa).</li>
                    <li><b>Cross-check:</b> Inlet pressure should be greater than backpressure for proper valve operation.</li>
                    <li><b>Compliance:</b> Validations follow ASME, API, and ISO standards for pressure relief devices.</li>
                </ul>
            </div>
<div class="note-card">
  <h3>üìä Output Validations</h3>
  <ul class="note-list">
    <li><strong>F<sub>S</sub> &lt; 50 N:</strong> ‚ö†Ô∏è <strong>Low Opening Force</strong> ‚Äî May not reliably actuate the valve under process conditions.</li>
    <li><strong>50 N ‚â§ F<sub>S</sub> ‚â§ 5000 N:</strong> ‚úÖ <strong>Standard Opening Force</strong> ‚Äî Within normal industrial valve design range.</li>
    <li><strong>5000 N &lt; F<sub>S</sub> ‚â§ 50000 N:</strong> ‚ùå <strong>High Opening Force</strong> ‚Äî Verify actuator selection and mechanical design suitability.</li>
    <li><strong>F<sub>S</sub> &gt; 50000 N:</strong> üö® <strong>Unrealistic Opening Force</strong> ‚Äî Likely due to input error or incorrect valve sizing.</li>
  </ul>
</div>

<div class="note-card">
    <h3>üìê Governing Principle</h3>
    <p>
        The standards governing safety valve calculations, including the spring opening force, are primarily the American Society of Mechanical Engineers (ASME) Boiler and Pressure Vessel Code and the European standard, ISO 4126. The specific section of the code and the governing formulas depend on the valve's application.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">ASME Boiler and Pressure Vessel Code</h3>
    <p>
        The ASME code is the primary standard in the United States and is split into different sections based on application:
    </p>
    <ul class="note-list">
        <li><b>ASME Section I:</b> Pertains to safety relief valves used for boiler applications.</li>
        <li><b>ASME Section VIII:</b> Covers valves for unfired pressure vessels.</li>
    </ul>
    <p>
        ASME also relies on guidance from the American Petroleum Institute (API) standard API 520, which details methods for calculating required relief loads and sizing valves for a variety of conditions, including backpressure.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">ISO 4126</h3>
    <p>
        This standard specifies the general requirements for safety valves in Europe and internationally. It covers direct-loaded spring valves and provides the terms and definitions used in the calculation, such as set pressure, overpressure, and backpressure.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">The Spring Force Calculation</h3>
    <p>
        The opening force of a spring-loaded safety valve is determined by the balance between the spring force and the inlet pressure acting on the valve disc. The calculation is not based on a single "calculator" standard, but is derived from the fundamental principles of physics and prescribed by industry codes like ASME.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Key Forces at Play</h3>
    <ul class="note-list">
        <li><b>Closing force:</b> The spring force (F<sub>s</sub>) compresses the disc against the nozzle and is adjustable via a screw.</li>
        <li><b>Opening force:</b> The inlet pressure acting on the nozzle seat area (P √ó A<sub>N</sub>).</li>
        <li><b>Backpressure forces:</b> The force from superimposed and built-up backpressure on the outlet side, which either assists or opposes the spring force depending on the valve type (conventional or balanced).</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">How the Standard Applies</h3>
    <p>
        ASME and ISO standards incorporate these physical principles by defining the conditions under which the valve must operate. This includes specifying the set pressure, overpressure, and blowdown requirements. For example, the ASME code certifies a manufacturer's capacity rating after testing, which incorporates the valve's unique geometric properties and spring performance.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Standardized Calculators</h3>
    <p>
        While the underlying principles are standardized, calculations are often performed using manufacturer-specific software. These tools integrate certified coefficients of discharge and valve characteristics, allowing engineers to determine the correct valve size and spring settings based on the requirements of the relevant code.
    </p>
</div>
            <!-- Conclusion -->
            <div class="note-card">
                <h3>üìù Conclusion</h3>
                <p>
                    This tool assists engineers and technicians in determining the required opening force for a safety valve, ensuring proper functionality and compliance with industrial safety standards. Accurate force calculation is critical for preventing system overpressure and enhancing operational safety in pressurized environments.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateOpeningForce() {
    const pressure = document.getElementById('pressure').value.trim();
    const nozzleArea = document.getElementById('nozzleArea').value.trim();
    const backPressure = document.getElementById('backPressure').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Validation Rules ---
    // Fluid Inlet Pressure (P_V)
    if (pressure === "" || isNaN(pressure)) {
        errors.push("üëâ Please enter the fluid inlet pressure.");
    } else if (parseFloat(pressure) < 0) {
        errors.push("üëâ Fluid inlet pressure cannot be negative.");
    } else if (parseFloat(pressure) > 10000000) {
        errors.push("üëâ Fluid inlet pressure cannot exceed 10,000,000 Pa (100 bar).");
    }

    // Nozzle Area (A_N)
    if (nozzleArea === "" || isNaN(nozzleArea)) {
        errors.push("üëâ Please enter the nozzle area.");
    } else if (parseFloat(nozzleArea) < 0.0001) {
        errors.push("üëâ Nozzle area too small (minimum 0.0001 m¬≤).");
    } else if (parseFloat(nozzleArea) > 1) {
        errors.push("üëâ Nozzle area cannot exceed 1 m¬≤.");
    }

    // Backpressure (P_B)
    if (backPressure === "" || isNaN(backPressure)) {
        errors.push("üëâ Please enter the backpressure.");
    } else if (parseFloat(backPressure) < 0) {
        errors.push("üëâ Backpressure cannot be negative.");
    } else if (parseFloat(backPressure) > 10000000) {
        errors.push("üëâ Backpressure cannot exceed 10,000,000 Pa (100 bar).");
    }

    // Cross-field validation
    if (pressure !== "" && backPressure !== "" && parseFloat(pressure) <= parseFloat(backPressure)) {
        errors.push("üëâ Fluid inlet pressure must be greater than backpressure for valve operation.");
    }

    // --- Error Handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Safe Calculations ---
    const P_V = parseFloat(pressure);
    const A_N = parseFloat(nozzleArea);
    const P_B = parseFloat(backPressure);

    // Formula
    const F_S = (P_V - P_B) * A_N;

    // Protect against negative force
    if (F_S <= 0) {
        errorMessage.innerHTML = "‚ö†Ô∏è Invalid force result. Check inputs.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    document.getElementById('forceValue').textContent = F_S.toFixed(4);

    let feedback;

    // --- Output thresholds ---
    if (F_S < 50) {
        feedback = '‚ö†Ô∏è <strong>Low Opening Force:</strong> May not reliably actuate the valve under process conditions.';
    } else if (F_S <= 5000) {
        feedback = '‚úÖ <strong>Standard Opening Force:</strong> Within normal industrial valve design range.';
    } else if (F_S <= 50000) {
        feedback = '‚ùå <strong>High Opening Force:</strong> Verify actuator selection and mechanical design suitability.';
    } else {
        feedback = 'üö® <strong>Unrealistic Opening Force:</strong> Likely due to input error or incorrect valve sizing.';
    }

    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}