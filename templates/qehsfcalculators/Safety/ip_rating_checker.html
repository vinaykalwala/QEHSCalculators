{% extends 'base.html' %}
{% block title %}IP Rating Checker{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Rating Checker</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
       .select-wrapper {
    position: relative;
    width: 100%;
}

.form-select {
    width: 100%;
    padding: 14px 16px;
    border: 1px solid #ddd;
    border-radius: 10px;
    background: #f9fbfd;
    font-size: 16px;
    transition: all 0.3s;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    cursor: pointer;
}

.select-wrapper::after {
    content: "‚ñº";
    font-size: 0.9rem;
    color: #1560bd;
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
}

/* üîπ Responsive adjustments for small screens */
@media screen and (max-width: 425px) {
    .form-select {
        padding: 10px 12px;
        font-size: 14px;
        border-radius: 8px;
    }

    .select-wrapper::after {
        font-size: 0.75rem;
        right: 10px;
    }
}
        .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: flex-start;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .ip-result-heading {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
            padding-bottom: 10px;
        }
        
        .ip-rating-display {
            font-size: 32px;
            font-weight: 700;
            color: #2980b9;
            margin: 15px 0;
            text-align: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .ip-description {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        
        .ip-description strong {
            color: #2c3e50;
        }
        
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>IP Rating Checker</h1>
            <p>Check the Ingress Protection rating for electrical enclosures</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="solids">Solids Protection (1 to 6)</label>
                    <div class="select-wrapper">
                        <select class="form-select" id="solids">
                            <option value="" selected>Select solids protection level</option>
                            <option value="1">1 - Protection against solid objects over 50mm</option>
                            <option value="2">2 - Protection against solid objects over 12mm</option>
                            <option value="3">3 - Protection against solid objects over 2.5mm</option>
                            <option value="4">4 - Protection against solid objects over 1mm</option>
                            <option value="5">5 - Dust protected</option>
                            <option value="6">6 - Dust tight</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="liquids">Liquids Protection (1 to 8, 9K)</label>
                    <div class="select-wrapper">
                        <select class="form-select" id="liquids">
                            <option value="" selected>Select liquids protection level</option>
                            <option value="1">1 - Protection against dripping water</option>
                            <option value="2">2 - Protection against dripping water (tilted)</option>
                            <option value="3">3 - Protection against spraying water</option>
                            <option value="4">4 - Protection against splashing water</option>
                            <option value="5">5 - Protection against water jets</option>
                            <option value="6">6 - Protection against powerful water jets</option>
                            <option value="7">7 - Protection against immersion (1m, 30min)</option>
                            <option value="8">8 - Protection against continuous immersion</option>
                            <option value="9K">9K - Protection against high-pressure/steam cleaning</option>
                        </select>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="checkIPRating()">Check IP Rating</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                  <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">

                    <p>This tool will check the <strong>IP Rating</strong> based on your selection of solids and liquids protection levels.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>IP Rating Result</h2>
                    </div>
                    
                    <div class="ip-rating-display" id="ipRatingValue">IP00</div>
                    
                    <div class="ip-description">
                        <div class="feedback-title">Solids Protection</div>
                        <div class="feedback-content" id="solidsDescription"></div>
                    </div>
                    
                    <div class="ip-description">
                        <div class="feedback-title">Liquids Protection</div>
                        <div class="feedback-content" id="liquidsDescription"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
        
            <!-- üìò ABOUT THIS CALCULATOR -->
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>IP Rating Checker</strong> evaluates an enclosure‚Äôs ability to protect electrical or electronic
                    components
                    against the intrusion of solid objects and liquids. It helps users interpret the IP (Ingress Protection)
                    code
                    based on two digits ‚Äî one for solid protection and one for liquid resistance ‚Äî to determine how durable
                    and environment-ready a product is.
                </p>
            </div>
        
            <!-- ‚öô PARAMETERS USED -->
            <div class="note-card">
                <h3>‚öô Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>First Digit (Solids ‚Äì IPX):</strong> Represents protection against solid objects like dust or
                        debris (range: 0‚Äì6).</li>
                    <li><strong>Second Digit (Liquids ‚Äì IPY):</strong> Represents protection against water ingress (range: 0‚Äì8
                        or 9K).</li>
                </ul>
                <p><em>Each combination forms an IP code (e.g., IP67), which indicates the level of dust and water resistance
                        according to the IEC 60529 international standard.</em></p>
            </div>
        
            <!-- ‚úÖ INPUT VALIDATION RULES -->
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Solids Value:</strong> Must be an integer between 0‚Äì6.</li>
                    <li><strong>Liquids Value:</strong> Must be an integer between 0‚Äì8 or the special value ‚Äú9K‚Äù.</li>
                    <li><strong>Cross-check Rule:</strong> If liquids = ‚Äú9K‚Äù, solids must be 6 (dust-tight) for validity.</li>
                    <li><strong>Mandatory Inputs:</strong> Both digits must be entered to form a complete IP code.</li>
                    <li><strong>Zero Protection:</strong> A ‚Äò0‚Äô value in either field indicates no protection in that category.
                    </li>
                </ul>
                <p><em>These validation ranges align with <b>IEC 60529</b> and <b>EN 60529</b> for electrical enclosures.</em>
                </p>
            </div>
        
            <!-- üìä OUTPUT VALIDATIONS -->
            <div class="note-card">
                <h3>üìä Output Validations</h3>
                <ul class="note-list">
                    <li><strong>IP0X or IPX0:</strong> ‚ùå No protection ‚Äî unsafe for dust or moisture exposure.</li>
                    <li><strong>IP5X‚ÄìIP54:</strong> ‚ö†Ô∏è Moderate protection ‚Äî suitable for indoor or limited outdoor use.</li>
                    <li><strong>IP55‚ÄìIP65:</strong> ‚úÖ High protection ‚Äî resistant to dust and strong water jets; good for
                        outdoor equipment.</li>
                    <li><strong>IP66‚ÄìIP68:</strong> üü¢ Excellent protection ‚Äî fully dust-tight, resistant to immersion or
                        continuous water contact.</li>
                    <li><strong>IP69K:</strong> üîµ Superior protection ‚Äî resists high-pressure, high-temperature water jets
                        (used in automotive and industrial washdowns).</li>
                </ul>
                <p><em>The result feedback displays the same protection descriptions dynamically along with the IP rating value
                        (e.g., ‚ÄúIP67 ‚Üí Dust tight and protected against immersion up to 1m for 30min‚Äù).</em></p>
            </div>
        
            <!-- üìê GOVERNING PRINCIPLE -->
            <div class="note-card">
                <h3>üìê Governing Principle</h3>
                <p>
                    An <strong>IP Rating Checker</strong> is based on the international standard <b>IEC 60529</b>, titled
                    ‚ÄúDegrees of protection provided by enclosures,‚Äù which defines how to test and rate the resistance of
                    electrical enclosures to solid objects (like dust) and liquids (like water). This standard enables
                    manufacturers to certify products for various environmental conditions and helps consumers understand
                    the level of protection offered by different devices.
                </p>
        
                <p>
                    <strong>What IP Ratings Mean:</strong><br>
                    An IP rating consists of two digits (e.g., IP67):
                    ‚Ä¢ The first digit (IPX) indicates protection against solid objects.
                    ‚Ä¢ The second digit (IPY) indicates protection against liquid ingress.
                    A higher number in either position means greater protection.
                </p>
        
                <p>
                    <strong>The Standard‚Äôs Purpose:</strong><br>
                    IEC 60529 was developed by the <b>International Electrotechnical Commission (IEC)</b>
                    to provide a uniform testing and grading method for enclosures used in electrical and electronic devices.
                    It ensures clarity for designers, regulators, and consumers in understanding protection performance.
                    This standard is globally recognized, especially across Europe, and aids in the marketing and classification
                    of electrical products.
                </p>
        
                <p>
                    <strong>Examples of Application:</strong><br>
                    Manufacturers apply IEC 60529 when designing outdoor lighting, control panels, or industrial machinery
                    to ensure compliance with dust and water resistance requirements.
                    The standard covers products with a rated voltage not exceeding 72.5 kV.
                </p>
            </div>
        
            <!-- üß© CONCLUSION -->
            <div class="note-card">
                <h3>üß© Conclusion</h3>
                <p>
                    The IP Rating Checker helps users understand the degree of protection provided by electrical enclosures
                    against dust and water, ensuring safety, reliability, and compliance with global standards like IEC 60529.
                    By identifying both solid and liquid resistance levels, organizations can select suitable protection grades
                    for different environmental applications, promoting safer product design and improved consumer awareness.
                </p>
            </div>
        
        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
        
        function checkIPRating() {
    const solids = document.getElementById('solids').value;
    const liquids = document.getElementById('liquids').value;

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];
    let warnings = [];

    // --- Solids Validation ---
    if (!solids) {
        errors.push("üëâ Please select a solids protection level (0‚Äì6).");
    } else if (!/^[0-6]$/.test(solids)) {
        errors.push("‚ùå Invalid solids value. Allowed range: 0‚Äì6.");
    }

    // --- Liquids Validation ---
    if (!liquids) {
        errors.push("üëâ Please select a liquids protection level (0‚Äì8 or 9K).");
    } else if (!/^([0-8]|9K)$/.test(liquids)) {
        errors.push("‚ùå Invalid liquids value. Allowed values: 0‚Äì8, 9K.");
    }

    // --- Cross-field Checks ---
    if (liquids === "9K" && solids !== "6") {
        warnings.push("‚ö†Ô∏è IP9K is normally certified only with Solids=6 (dust-tight).");
    }

    // --- Error Handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Descriptions ---
    let solidsDescription = "";
    let liquidsDescription = "";

    switch (solids) {
        case '0': solidsDescription = "No protection against solid objects."; break;
        case '1': solidsDescription = "Protection against solid objects >50mm (hands)."; break;
        case '2': solidsDescription = "Protection against solid objects >12mm (fingers)."; break;
        case '3': solidsDescription = "Protection against solid objects >2.5mm (tools, thick wires)."; break;
        case '4': solidsDescription = "Protection against solid objects >1mm (wires, small tools)."; break;
        case '5': solidsDescription = "Dust protected - limited ingress permitted."; break;
        case '6': solidsDescription = "Dust tight - complete protection against dust."; break;
    }

    switch (liquids) {
        case '0': liquidsDescription = "No protection against water."; break;
        case '1': liquidsDescription = "Protection against vertically falling drops of water."; break;
        case '2': liquidsDescription = "Protection against dripping water when tilted 15¬∞."; break;
        case '3': liquidsDescription = "Protection against spraying water up to 60¬∞ from vertical."; break;
        case '4': liquidsDescription = "Protection against splashing water from any direction."; break;
        case '5': liquidsDescription = "Protection against water jets (limited ingress allowed)."; break;
        case '6': liquidsDescription = "Protection against powerful water jets (e.g., ship decks)."; break;
        case '7': liquidsDescription = "Protection against immersion up to 1m for 30min."; break;
        case '8': liquidsDescription = "Protection against continuous immersion (per manufacturer)."; break;
        case '9K': liquidsDescription = "Protection against high-pressure, high-temperature water jets (steam cleaning)."; break;
    }

    // --- Output ---
    document.getElementById('ipRatingValue').textContent = `IP${solids}${liquids}`;
    document.getElementById('solidsDescription').textContent = solidsDescription;
    document.getElementById('liquidsDescription').textContent = liquidsDescription;

    if (warnings.length > 0) {
        errorMessage.innerHTML = warnings.join("<br>");
        errorBox.classList.remove("hidden");
    }

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}



{% comment %} 
1Ô∏è‚É£ Input Validation Rules (Industry-Compliant)

üìò Solids Protection (First Digit, IPx)*

Allowed Range: 0‚Äì6

Meaning: Indicates protection against access to hazardous parts and ingress of solid foreign objects.

Validation Rules:

Must be an integer (no decimals).

Allowed values: 0, 1, 2, 3, 4, 5, 6

Any other value = invalid (reject input).

0 means ‚ÄúNo protection‚Äù ‚Üí still valid as per IEC 60529.

üìò Liquids Protection (Second Digit, IP*x)

Allowed Range: 0‚Äì8, plus 9K (special high-pressure cleaning rating).

Validation Rules:

Must be an integer (0‚Äì8) or special string "9K".

No decimals.

0 = ‚ÄúNo protection‚Äù ‚Üí still valid.

If "9K" ‚Üí ensure solids value is not empty (9K cannot stand alone).

üìò Cross-Field Dependencies

Both fields must be selected for a valid rating.

Some combinations are possible but unusual:

IP69K (commonly used in automotive/food industry) requires solids = 6.

If user selects "9K" but solids ‚â† 6 ‚Üí show warning, not error.

Solids or liquids = 0 is valid, but warn user ‚Äú‚ö†Ô∏è No protection against solids/liquids.‚Äù

2Ô∏è‚É£ Output Validation Logic & Thresholds

Final IP Rating Formula:

IP Rating = "IP" + solidsDigit + liquidsDigit


Example: Solids = 5, Liquids = 4 ‚Üí IP54.

Threshold Explanation:

IP ratings are only valid if both digits conform to IEC 60529.

If invalid ‚Üí show ‚ùå Error.

If unusual (e.g., IP19K) ‚Üí show ‚ö†Ô∏è Warning: Rare/Non-standard combination.

Meaningful Outputs for Reports:

Always include textual explanation (already in your code).

Highlight if 0 protection is selected (‚Äú‚ö†Ô∏è This indicates NO protection‚Ä¶‚Äù).

3Ô∏è‚É£ Corrected JavaScript Code (with Validations + Comments)

Here‚Äôs your improved validation function with future-proofed comments:

/* ================================
   IEC 60529 IP Rating Calculator
   Validation Rules:
   - Solids: must be integer 0‚Äì6
   - Liquids: must be integer 0‚Äì8 or string "9K"
   - Both fields required
   - Cross-check: if Liquids = "9K", Solids should = 6
   - Formula: IP = "IP" + solids + liquids
   ================================ */ {% endcomment %}