{% extends 'base.html' %}
{% block title %}Velocity of Steam Passing Through an Orifice Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velocity of Steam Passing Through an Orifice Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            min-height: 420px; /* Match calc-card */
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input[readonly] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Velocity of Steam Passing Through an Orifice Calculator</h1>
            <p>Calculate the velocity of steam passing through an orifice based on its kinetic energy.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>System Parameters</h2>
                <div class="form-group">
                    <label for="kineticEnergy">Kinetic Energy (E)</label>
                    <input type="number" id="kineticEnergy" class="form-input" placeholder="Enter energy in kJ">
                </div>
                <div class="form-group">
                    <label for="mass">Mass of Fluid (m)</label>
                    <input type="number" id="mass" class="form-input" placeholder="Enter mass in kg">
                </div>
                 <div class="form-group">
                    <label for="gravity">Acceleration due to Gravity (g)</label>
                    <input type="number" id="gravity" class="form-input" value="9.80665" readonly>
                </div>
                 <div class="form-group">
                    <label for="joule">Joule's Equivalent (J)</label>
                    <input type="number" id="joule" class="form-input" value="101.972" readonly>
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate Velocity</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Engineering illustration">
                    <p>Enter the kinetic energy and mass to calculate the steam's velocity.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Steam Velocity (u)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label">m/s</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span>
                        <span>Optimal</span>
                        <span>High</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                     <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

     <div class="note-section">
    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator determines the <strong>velocity of steam</strong> passing through an orifice based on its kinetic energy.
            It is vital for engineers and operators to estimate steam flow rate, ensuring energy efficiency, optimal performance,
            and safety in industrial steam systems.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Velocity of the Fluid (u) (m/s):</strong> Steam flow speed through the orifice.</li>
            <li><strong>Kinetic Energy (E) (kJ):</strong> Energy possessed by the steam due to motion.</li>
            <li><strong>Mass of the Fluid (m) (kg):</strong> Total mass of steam passing through the orifice.</li>
            <li><strong>Acceleration due to Gravity (g) (m/s²):</strong> Standard constant, 9.80665 m/s².</li>
            <li><strong>Joule's Mechanical Equivalent (J) (m·kg/kJ):</strong> Conversion factor between heat and mechanical energy, 101.972 m·kg/kJ.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>📝 Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Kinetic Energy (E):</strong> Must be numeric, > 0 kJ.</li>
            <li><strong>Mass of Fluid (m):</strong> Must be numeric, > 0 kg.</li>
            <li><strong>Acceleration due to Gravity (g):</strong> Fixed at 9.80665 m/s² (read-only).</li>
            <li><strong>Joule's Equivalent (J):</strong> Fixed at 101.972 kJ/kg-cal (read-only).</li>
        </ul>
        <h3>💡 Allowed Decimals</h3>
        <ul class="note-list">
            <li>Kinetic Energy and Mass → up to 2 decimal places for measurement precision and engineering standards.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li><strong>&lt; 10 m/s (Low Velocity):</strong> ✅ Low velocity. Check steam pressure and system conditions.</li>
            <li><strong>10 – 100 m/s (Optimal Velocity):</strong> ✅ Optimal velocity. Steam is flowing efficiently.</li>
            <li><strong>&gt; 100 m/s (High Velocity):</strong> ❌ High velocity. Potential risk of excessive pressure loss and pipe erosion.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            A velocity of steam passing through an orifice calculator is not based on a single standard, but rather implements principles
            and equations from international standards like ISO 5167 and ASME standards (e.g., ASME MFC-3M-1989). These standards guide
            the design and use of orifice plates for flow measurement and are adapted for compressible flows like steam.
        </p>
        <ul class="note-list">
            <li><strong>ISO 5167 Series:</strong> Covers measurement of fluid flow using pressure differential devices, including orifice plates.</li>
            <li><strong>ASME Standards:</strong> Provide guidance for orifice flowmeters and flow measurement accuracy (MFC-3M, MFC-14M).</li>
            <li><strong>Key Principles:</strong> Energy conservation, compressible flow corrections, and discharge coefficients to account for real-world losses.</li>
        </ul>
        <p>
            Calculators adhere to these methods to ensure accurate and reliable steam velocity estimations for industrial applications.
        </p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <p>
            Accurately calculating steam velocity through an orifice ensures efficient energy use, prevents wastage,
            and enhances system performance. This tool is crucial for engineers and operators in industrial steam applications.
        </p>
    </div>
</div>


    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Set the current date for the report
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const printDate = document.getElementById('printDate');
        if (printDate) {
            printDate.textContent = now.toLocaleDateString('en-US', options);
        }
    });

    function calculateSteamVelocity() {
        const errorBox = document.getElementById('resultError');
        const errorMessage = document.getElementById('errorMessage');
        const placeholder = document.getElementById('placeholder');
        const resultValueBox = document.getElementById('resultValue');

        // Reset UI
        errorBox.classList.add('hidden');
        resultValueBox.classList.add('hidden');
        placeholder.classList.remove('hidden');

        let errors = [];

        // Helper function to validate positive numeric inputs
        function getVal(id, label) {
            const el = document.getElementById(id);
            const raw = el.value?.toString().trim();
            if (!raw) {
                errors.push(`👉 ${label} is required.`);
                return null;
            }
            const num = parseFloat(raw);
            if (isNaN(num) || num <= 0) {
                errors.push(`👉 Enter a valid positive number for ${label}.`);
                return null;
            }
            return num;
        }

        // --- INPUTS ---
        const E = getVal('kineticEnergy', 'Kinetic Energy (E) [kJ]');
        const m = getVal('mass', 'Mass of Fluid (m) [kg]');
        const g = 9.80665; // m/s² (constant)
        const J = 101.972; // kJ/kg-cal (constant)

        // Show errors if any
        if (errors.length > 0) {
            errorMessage.innerHTML = errors.join("<br>");
            errorBox.classList.remove("hidden");
            placeholder.classList.add('hidden');
            return;
        }

        // --- CALCULATION ---
        const u = Math.sqrt((2 * E * g * J) / m);

        if (!isFinite(u)) {
            errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your inputs.";
            errorBox.classList.remove("hidden");
            placeholder.classList.add('hidden');
            return;
        }

        // --- DISPLAY RESULTS ---
        placeholder.classList.add('hidden');
        resultValueBox.classList.remove('hidden');
        document.getElementById('rateValue').textContent = u.toFixed(2);

        // --- VELOCITY METER & FEEDBACK ---
        const meterFill = document.getElementById('meterFill');
        const minV = 0;
        const maxV = 150; // maximum velocity scale
        let pct = ((u - minV) / (maxV - minV)) * 100;
        pct = Math.max(0, Math.min(100, pct));
        meterFill.style.width = pct + '%';

        let feedback;
        if (u < 10) {
            meterFill.style.backgroundColor = '#f39c12'; // Yellow
            feedback = "✅ Low velocity. Check steam pressure and system conditions.";
        } else if (u <= 100) {
            meterFill.style.backgroundColor = '#2ecc71'; // Green
            feedback = "✅ Optimal velocity. Steam is flowing efficiently.";
        } else {
            meterFill.style.backgroundColor = '#e74c3c'; // Red
            feedback = "❌ High velocity. Potential risk of excessive pressure loss and pipe erosion.";
        }

        document.getElementById('feedbackContent').innerHTML = feedback;
    }

    // --- PRINT FUNCTION ---
    function printReport() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const printDate = document.getElementById('printDate');
        if (printDate) {
            printDate.textContent = now.toLocaleDateString('en-US', options);
        }
        window.print();
    }
</script>


</body>
</html>
{% endblock %}

<!-- 
1️⃣ Input Validation Rules (QEHS Perspective)
Parameter	Unit	Acceptable Range	Notes / Logical Checks
Kinetic Energy (E)	kJ	> 0, typical 1–500 kJ	Must be positive; physically, negative energy is invalid. Outliers should trigger warnings.
Mass of Fluid (m)	kg	> 0, typical 0.1–1000 kg	Cannot be zero or negative; extremely small or large values may be unrealistic for a steam orifice.
Acceleration due to Gravity (g)	m/s²	9.806 ± 0.1	Constant; read-only, should not be changed.
Joule's Equivalent (J)	kJ/kg-cal	~101.972	Constant; read-only, used for unit conversion.

Cross-field dependencies / logical consistency:

Kinetic energy must be consistent with the mass; for example, a very high E with very low m may produce unphysical velocities (>1000 m/s).

g and J are constants; no user input allowed.

Edge Cases:

Division by zero (mass = 0) → invalid.

Negative or zero kinetic energy → invalid.

Extremely high values → trigger warnings (velocity > 200 m/s).

2️⃣ Output Validation Logic
Velocity Range (m/s)	Feedback	QEHS Implication
u < 10	Low velocity. Check steam pressure conditions.	Steam may not achieve required system flow; underperformance risk.
10 ≤ u ≤ 100	Optimal velocity. Steam is flowing efficiently.	Safe operating range for typical steam systems.
u > 100	High velocity. Risk of excessive pressure loss and damage.	Potential for pipe erosion, noise, vibration, or unsafe pressure drops.

Additional Output Checks:

If u is NaN or Infinity → calculation invalid → prompt user to check inputs.
-->