{% extends 'base.html' %}
{% block title %}Velocity of Steam Passing Through an Orifice Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velocity of Steam Passing Through an Orifice Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input[readonly] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Velocity of Steam Passing Through an Orifice Calculator</h1>
            <p>Calculate the velocity of steam passing through an orifice based on its kinetic energy.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>System Parameters</h2>
                <div class="form-group">
                    <label for="kineticEnergy">Kinetic Energy (E)</label>
                    <input type="number" id="kineticEnergy" class="form-input" placeholder="Enter energy in kJ">
                </div>
                <div class="form-group">
                    <label for="mass">Mass of Fluid (m)</label>
                    <input type="number" id="mass" class="form-input" placeholder="Enter mass in kg">
                </div>
                 <div class="form-group">
                    <label for="gravity">Acceleration due to Gravity (g)</label>
                    <input type="number" id="gravity" class="form-input" value="9.80665" readonly>
                </div>
                 <div class="form-group">
                    <label for="joule">Joule's Equivalent (J)</label>
                    <input type="number" id="joule" class="form-input" value="101.972" readonly>
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate Velocity</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Engineering illustration">
                    <p>Enter the kinetic energy and mass to calculate the steam's velocity.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Steam Velocity (u)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label">m/s</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span>
                        <span>Optimal</span>
                        <span>High</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                     <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <!-- About Steam Velocity -->
            <div class="note-card">
                <h3>üìò About Steam Velocity Calculation</h3>
                <p>
                    This formula calculates the velocity of steam passing through an orifice based on its kinetic energy.
                    It is essential for engineers and operators to estimate steam flow rate, ensuring optimal performance,
                    energy efficiency, and safety in industrial steam systems.
                </p>
            </div>
        
            <!-- Parameters Explained -->
            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Explained</h3>
                <ul class="note-list">
                    <li><strong>Velocity of the Fluid (u) (m/s):</strong> The speed at which steam flows through the orifice.
                    </li>
                    <li><strong>Kinetic Energy (E) (kJ):</strong> The energy possessed by the steam due to its motion.</li>
                    <li><strong>Mass of the Fluid (m) (kg):</strong> The total mass of steam passing through the orifice.</li>
                    <li><strong>Acceleration due to Gravity (g) (m/s¬≤):</strong> A standard constant, 9.80665 m/s¬≤.</li>
                    <li><strong>Joule's Mechanical Equivalent (J) (m¬∑kg/kJ):</strong> The conversion factor between heat and
                        mechanical energy, 101.972 m¬∑kg/kJ.</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Kinetic Energy (E):</strong> Must be numeric, > 0 kJ; zero or negative values are non-physical and
                        indicate incorrect input.</li>
                    <li><strong>Mass of Fluid (m):</strong> Must be numeric, > 0 kg; zero or negative values are invalid for steam
                        flow calculations.</li>
                    <li><strong>Acceleration due to Gravity (g):</strong> Fixed at 9.80665 m/s¬≤ (read-only); ensures standard
                        gravitational influence.</li>
                    <li><strong>Joule's Equivalent (J):</strong> Fixed at 101.972 kJ/kg-cal (read-only); ensures energy unit
                        consistency.</li>
                </ul>
                <br>
                <h3>üí° Allowed Decimals</h3>
                <ul class="note-list">
                    <li>Kinetic Energy and Mass ‚Üí up to 2 decimal places to reflect measurement precision and engineering standards.
                    </li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üìä Output Validations</h3>
                <ul class="note-list">
                    <li><strong>&lt; 10 m/s (Low Velocity):</strong>
                        <ul>
                            <li>‚úÖ Assessment: Low velocity. Check steam pressure and system conditions.</li>
                            <li><em>Engineering Rationale:</em> Steam flow may be insufficient for system requirements; review
                                boiler and piping design.</li>
                        </ul>
                    </li>
            
                    <li><strong>10 ‚Äì 100 m/s (Optimal Velocity):</strong>
                        <ul>
                            <li>‚úÖ Assessment: Optimal velocity. Steam is flowing efficiently.</li>
                            <li><em>Engineering Rationale:</em> Steam flow within safe operating limits; system performs efficiently
                                without excessive pressure loss.</li>
                        </ul>
                    </li>
            
                    <li><strong>&gt; 100 m/s (High Velocity):</strong>
                        <ul>
                            <li>‚ùå Assessment: High velocity. Potential risk of excessive pressure loss and pipe erosion.</li>
                            <li><em>Engineering Rationale:</em> Immediate review recommended; ensure piping and orifice are rated
                                for high-speed steam to maintain safety compliance (OSHA, NFPA, ISO 45001).</li>
                        </ul>
                    </li>
                </ul>
            </div>

        
            <!-- Conclusion -->
            <div class="note-card">
                <h3>üìå Conclusion</h3>
                <p>
                    Accurate calculation of steam velocity through an orifice ensures efficient energy use, prevents wastage,
                    and enhances overall system performance.
                    This tool is crucial for engineers and operators in industrial steam applications.
                </p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Set the current date for the report
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const printDate = document.getElementById('printDate');
            if (printDate) {
                printDate.textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            // Reset UI
            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];

            // Helper function to validate inputs
            function getVal(id, label) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (!raw) {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num) || num <= 0) {
                    errors.push(`üëâ Enter a valid positive number for ${label}.`);
                    return null;
                }
                return num;
            }

            // Inputs
            const E = getVal('kineticEnergy', 'Kinetic Energy (E)');
            const m = getVal('mass', 'Mass of Fluid (m)');
            const g = 9.80665; // m/s¬≤
            const J = 101.972; // kJ/kg-cal

            // Show errors if any
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }

            // Calculation
            const u = Math.sqrt((2 * E * g * J) / m);

            if (!isFinite(u)) {
                errorMessage.innerHTML = "‚ùå Calculation resulted in an invalid number. Please check your inputs.";
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }

            // Show results
            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');
            document.getElementById('rateValue').textContent = u.toFixed(2);

            // Visual meter
            const meterFill = document.getElementById('meterFill');
            const minV = 0;
            const maxV = 150; // max velocity for scale
            let pct = ((u - minV) / (maxV - minV)) * 100;
            pct = Math.max(0, Math.min(100, pct));
            meterFill.style.width = pct + '%';

            // Interpretation & feedback
            let interpretation;
            if (u < 10) {
                meterFill.style.backgroundColor = '#f39c12'; // Yellow
                interpretation = "Low velocity. Check steam pressure and system conditions.";
            } else if (u <= 100) {
                meterFill.style.backgroundColor = '#2ecc71'; // Green
                interpretation = "Optimal velocity. Steam is flowing efficiently.";
            } else {
                meterFill.style.backgroundColor = '#e74c3c'; // Red
                interpretation = "High velocity. Potential risk of excessive pressure loss and pipe erosion.";
            }

            document.getElementById('feedbackContent').innerHTML = interpretation;
        }

        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const printDate = document.getElementById('printDate');
            if (printDate) {
                printDate.textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>

</body>
</html>
{% endblock %}

<!-- 
1Ô∏è‚É£ Input Validation Rules (QEHS Perspective)
Parameter	Unit	Acceptable Range	Notes / Logical Checks
Kinetic Energy (E)	kJ	> 0, typical 1‚Äì500 kJ	Must be positive; physically, negative energy is invalid. Outliers should trigger warnings.
Mass of Fluid (m)	kg	> 0, typical 0.1‚Äì1000 kg	Cannot be zero or negative; extremely small or large values may be unrealistic for a steam orifice.
Acceleration due to Gravity (g)	m/s¬≤	9.806 ¬± 0.1	Constant; read-only, should not be changed.
Joule's Equivalent (J)	kJ/kg-cal	~101.972	Constant; read-only, used for unit conversion.

Cross-field dependencies / logical consistency:

Kinetic energy must be consistent with the mass; for example, a very high E with very low m may produce unphysical velocities (>1000 m/s).

g and J are constants; no user input allowed.

Edge Cases:

Division by zero (mass = 0) ‚Üí invalid.

Negative or zero kinetic energy ‚Üí invalid.

Extremely high values ‚Üí trigger warnings (velocity > 200 m/s).

2Ô∏è‚É£ Output Validation Logic
Velocity Range (m/s)	Feedback	QEHS Implication
u < 10	Low velocity. Check steam pressure conditions.	Steam may not achieve required system flow; underperformance risk.
10 ‚â§ u ‚â§ 100	Optimal velocity. Steam is flowing efficiently.	Safe operating range for typical steam systems.
u > 100	High velocity. Risk of excessive pressure loss and damage.	Potential for pipe erosion, noise, vibration, or unsafe pressure drops.

Additional Output Checks:

If u is NaN or Infinity ‚Üí calculation invalid ‚Üí prompt user to check inputs.
-->