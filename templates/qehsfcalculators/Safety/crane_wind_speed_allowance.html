{% extends 'base.html' %}
{% block title %}Crane Wind Speed Allowance Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crane Wind Speed Allowance Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (min-width: 901px) {
            .calc-content { 
                flex-direction: row; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            order: 2;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for side-by-side fields */
        .input-row {
            {% comment %} display: flex; {% endcomment %}
            flex-direction: column;
            gap: 15px;
            {% comment %} margin-bottom: 15px; {% endcomment %}
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Mobile-specific adjustments */
        @media (max-width: 320px) {
            .calculator-container {
                padding: 10px;
            }
            
            .calculator-header h1 {
                font-size: 1.8rem;
            }
            
            .calculator-header p {
                font-size: 16px;
            }
            
            .calc-card, .result-card {
                padding: 20px 15px;
                border-radius: 12px;
            }
            
            .calc-card h2 {
                font-size: 1.4rem;
            }
            
            .form-input {
                padding: 12px 14px;
                font-size: 14px;
            }
            
            .calculate-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .result-placeholder img {
                max-width: 180px;
            }
            
            .rate-value {
                font-size: 36px;
            }
            
            .meter-labels span {
                font-size: 10px;
            }
            
            .note-card {
                padding: 15px 18px;
            }
            
            .note-card h3 {
                font-size: 16px;
            }
            
            .note-card p, .note-card li {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    <div class="calculator-container printable" id="printArea">

        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Crane Wind Speed Allowance Calculator</h1>
            <p>Determine safe crane operation limits under windy conditions</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                
                <div class="input-row">
                    <div class="form-group">
                        <label for="windSpeed">Wind Speed (m/s)</label>
                        <input type="number" id="windSpeed" class="form-input" min="0" step="any" placeholder="e.g., 10.5">
                    </div>
                    
                    <div class="form-group">
                        <label for="craneCapacity">Crane Capacity (tons)</label>
                        <input type="number" id="craneCapacity" class="form-input" min="0" step="any" placeholder="e.g., 50">
                    </div>
                </div>
                
                <div class="input-row">
                    <div class="form-group">
                        <label for="boomLength">Boom Length (m)</label>
                        <input type="number" id="boomLength" class="form-input" min="0" step="any" placeholder="e.g., 30">
                    </div>
                    
                    <div class="form-group">
                        <label for="loadWeight">Load Weight (kg)</label>
                        <input type="number" id="loadWeight" class="form-input" min="0" step="any" placeholder="e.g., 15000">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateWindAllowance()">Calculate</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2843/2843781.png" alt="Crane illustration">
                    <p>This tool will calculate the <strong>Wind Speed Allowance</strong> for crane operations. Enter your data to see results and safety recommendations.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Crane Wind Speed Allowance Results</h2>
                    </div>
                    
                    <div class="rate-display">
                        <div class="rate-value" id="windAllowance">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Wind Allowance Factor</div>
                    </div>
                    
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill" style="width: 0%; background-color: #e74c3c;"></div>
                    </div>
                    
                    <div class="meter-labels">
                        <span>Unsafe</span>
                        <span>Caution</span>
                        <span>Safe</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Operation Status</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Crane Wind Speed Allowance Calculator</strong> determines whether crane operations are safe under specific wind conditions. 
                    This helps in planning lifting operations and preventing accidents caused by excessive wind forces.
                </p>
            </div>

            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Wind Speed (m/s):</strong> The speed of wind impacting the crane during operation.</li>
                    <li><strong>Crane Capacity (tons):</strong> The maximum lifting capacity of the crane.</li>
                    <li><strong>Boom Length (m):</strong> The total length of the crane boom.</li>
                    <li><strong>Load Weight (kg):</strong> The weight of the object being lifted.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>üìä Interpretation</h3>
                <p>
                    <b>Operation Status:</b>
                </p>
                <ul class="note-list">
                    <li>Wind Allowance Factor < 0.5 ‚Üí <span class="bad">Unsafe: Wind speed is too high for safe crane operations</span></li>
                    <li>Wind Allowance Factor 0.5 - 1.5 ‚Üí <span class="average">Caution: Safe operation, but proceed with caution</span></li>
                    <li>Wind Allowance Factor > 1.5 ‚Üí <span class="good">Safe: Wind conditions are within acceptable limits</span></li>
                </ul>
            </div>

            <div class="note-card">
                <h3>üîç Real-Life Applications</h3>
                <p>
                    The wind speed allowance is essential in:
                </p>
                <ul class="note-list">
                    <li><strong>Construction Sites:</strong> Ensures worker safety and crane stability during lifts.</li>
                    <li><strong>Marine & Offshore Operations:</strong> Calculates wind effects on cranes used in ports and offshore platforms.</li>
                    <li><strong>Heavy Machinery:</strong> Helps determine operational limits under windy conditions.</li>
                    <li><strong>Regulatory Compliance:</strong> Ensures adherence to safety standards for crane operations.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules (Engineering Compliance)</h3>
                <ul class="note-list">
                    <li><strong>Wind Speed:</strong> > 0 m/s, ‚â§ 50 m/s (hurricane force winds)</li>
                    <li><strong>Crane Capacity:</strong> > 0 tons, ‚â§ 1000 tons (ultra-heavy cranes)</li>
                    <li><strong>Boom Length:</strong> > 0 m, ‚â§ 200 m (largest crane booms)</li>
                    <li><strong>Load Weight:</strong> > 0 kg, ‚â§ crane capacity</li>
                    <li><strong>No negative values:</strong> All inputs must be positive numbers</li>
                </ul>
                <p><b>Compliance Note:</b> These validations align with <b>OSHA 1926.1427, ASME B30.5, and ISO 4302</b> for crane safety and operations.</p>
            </div>

            <div class="note-card">
                <h3>üå¨Ô∏è The Beaufort Wind Scale</h3>
                <p><strong>This chart is intended as a general guide only</strong></p>
                <p>All conversion calculations are rounded to the nearest whole number. Accurate details relating to 
                    the working conditions of individual cranes must be obtained by reference to the crane 
                    specification manuals or other bulletins issued by the manufacturer of the crane concerned.</p>
                <div class="image-container" style="text-align: center; margin-top: 15px;">
                    <img src="{% static 'images/wind.png' %}" alt="Beaufort Wind Scale" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateWindAllowance() {
            const windSpeed = document.getElementById('windSpeed').value.trim();
            const craneCapacity = document.getElementById('craneCapacity').value.trim();
            const boomLength = document.getElementById('boomLength').value.trim();
            const loadWeight = document.getElementById('loadWeight').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // --------------------------
            // Input Validations (Safety Compliance)
            // --------------------------

            // Wind Speed
            if (windSpeed === "") {
                errors.push("üëâ Please enter Wind Speed.");
            } else {
                const num = parseFloat(windSpeed);
                if (isNaN(num)) {
                    errors.push("üëâ Wind Speed must be a number.");
                } else if (num <= 0) {
                    errors.push("üëâ Wind Speed must be > 0 m/s.");
                } else if (num > 50) {
                    errors.push("üëâ Wind Speed exceeds safe operational limits (>50 m/s).");
                }
            }

            // Crane Capacity
            if (craneCapacity === "") {
                errors.push("üëâ Please enter Crane Capacity.");
            } else {
                const num = parseFloat(craneCapacity);
                if (isNaN(num)) {
                    errors.push("üëâ Crane Capacity must be a number.");
                } else if (num <= 0) {
                    errors.push("üëâ Crane Capacity must be > 0 tons.");
                } else if (num > 1000) {
                    errors.push("üëâ Crane Capacity exceeds realistic limits (>1000 tons).");
                }
            }

            // Boom Length
            if (boomLength === "") {
                errors.push("üëâ Please enter Boom Length.");
            } else {
                const num = parseFloat(boomLength);
                if (isNaN(num)) {
                    errors.push("üëâ Boom Length must be a number.");
                } else if (num <= 0) {
                    errors.push("üëâ Boom Length must be > 0 m.");
                } else if (num > 200) {
                    errors.push("üëâ Boom Length exceeds maximum practical length (>200 m).");
                }
            }

            // Load Weight
            if (loadWeight === "") {
                errors.push("üëâ Please enter Load Weight.");
            } else {
                const num = parseFloat(loadWeight);
                if (isNaN(num)) {
                    errors.push("üëâ Load Weight must be a number.");
                } else if (num <= 0) {
                    errors.push("üëâ Load Weight must be > 0 kg.");
                } else if (parseFloat(craneCapacity) > 0 && num > (parseFloat(craneCapacity) * 1000)) {
                    errors.push("üëâ Load Weight cannot exceed Crane Capacity.");
                }
            }

            // --------------------------
            // Show errors if any
            // --------------------------
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // --------------------------
            // Calculation (validated inputs)
            // --------------------------
            const windSpeed_val = parseFloat(windSpeed);
            const craneCapacity_val = parseFloat(craneCapacity);
            const boomLength_val = parseFloat(boomLength);
            const loadWeight_val = parseFloat(loadWeight);

            // Formula: Wind Allowance = (craneCapacity¬≤) * ‚àö((1.2 * loadWeight) / (boomLength * windSpeed))
            const windAllowance = Math.pow(craneCapacity_val, 2) * Math.sqrt((1.2 * loadWeight_val) / (boomLength_val * windSpeed_val));

            // Update the result display
            document.getElementById('windAllowance').textContent = windAllowance.toFixed(2);

            // Update meter and feedback based on wind allowance value
            const meterFill = document.getElementById('meterFill');
            let feedback, meterWidth, meterColor;

            if (windAllowance < 0.5) {
                feedback = "‚ùå <strong>Unsafe:</strong> Wind speed is too high for safe crane operations. Do not proceed with lifting.";
                meterWidth = 15;
                meterColor = "#e74c3c";
            } else if (windAllowance < 1.5) {
                feedback = "‚ö†Ô∏è <strong>Caution:</strong> Safe operation, but proceed with caution. Monitor wind conditions continuously.";
                meterWidth = 50;
                meterColor = "#f39c12";
            } else {
                feedback = "‚úÖ <strong>Safe:</strong> Wind conditions are within acceptable limits. Standard safety protocols apply.";
                meterWidth = 85;
                meterColor = "#2ecc71";
            }

            // Update meter
            meterFill.style.width = meterWidth + '%';
            meterFill.style.backgroundColor = meterColor;

            // Update feedback
            document.getElementById('feedbackContent').innerHTML = feedback;

            // Show results
            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 

1. üìò Formula Used
ùê¥
ùëÖ
ùëá
=
‚àë
(
ùëÖ
ùëí
ùë†
ùëú
ùëô
ùë¢
ùë°
ùëñ
ùëú
ùëõ
¬†
ùëá
ùëñ
ùëö
ùëí
)
ùëÅ
ùë¢
ùëö
ùëè
ùëí
ùëü
¬†
ùëú
ùëì
¬†
ùêº
ùëõ
ùëê
ùëñ
ùëë
ùëí
ùëõ
ùë°
ùë†
ART=
Number¬†of¬†Incidents
‚àë(Resolution¬†Time)
	‚Äã


Where:

Resolution Time = time (hours, minutes, or days) taken to resolve each incident.

Number of Incidents (N): total count of recorded incidents.

This KPI is used in ISO 45001 / OSHA reports to measure response effectiveness.

2. ‚úÖ Input Validation Rules (QEHS / Fire Safety)
Inputs Needed

Total Resolution Time (hours or days)

Number of Incidents (integer count)

Validation Rules

Total Resolution Time

Must be > 0

Minimum: 0.1 hr (6 min)

Maximum: 8760 hr (1 year) ‚Äî values higher are flagged for verification.

Decimals allowed (e.g., 12.5 hr).

Number of Incidents

Must be an integer > 0.

Max: 10,000 (very large for corporate safety records).

Cross-field Validation

Division by zero not allowed (if N = 0 ‚Üí error).

ART should not exceed Total Resolution Time.

If ART < 0.1 hr ‚Üí flag as unrealistic.

3. ‚ö†Ô∏è Edge Case Validations

N = 0 ‚Üí Division by zero error ‚Üí must be blocked.

Total time < N ‚Üí Unrealistic (implies <1 hr for each issue) ‚Üí warning.

Extreme outlier (ART > 1 year per issue) ‚Üí flag for audit.

4. üìä Output Validation & Thresholds

Interpretation:

ART ‚â§ 24 hrs ‚Üí ‚úÖ Excellent response time.

ART 1‚Äì7 days ‚Üí ‚ö†Ô∏è Acceptable but needs monitoring.

ART > 7 days ‚Üí ‚ùå Poor ‚Äî delays in incident management.

(These ranges align with typical ISO 45001 OHSMS KPIs for incident response.)

5. üîß Corrected JavaScript Code (with Comments)
<script>
/*
üìò Formula:
ART = Total Resolution Time / Number of Incidents

‚úÖ Validation Rules:
- Total Resolution Time > 0, max 8760 hrs (1 year)
- Number of Incidents > 0, integer, max 10000
- Cross-check: ART cannot exceed Total Time
- No division by zero

‚ö†Ô∏è Edge Cases:
- N = 0 ‚Üí invalid
- ART < 0.1 hr ‚Üí unrealistic, flag
- ART > 8760 hrs ‚Üí unrealistic, flag
*/ {% endcomment %}