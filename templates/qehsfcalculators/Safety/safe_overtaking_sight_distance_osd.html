{% extends 'base.html' %}
{% block title %}Safe Overtaking Sight Distance (OSD) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safe Overtaking Sight Distance (OSD) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        /* Input rows for side-by-side fields */
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
       
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Safe Overtaking Sight Distance (OSD) Calculator</h1>
            <p>Calculate the minimum distance required for a vehicle to safely overtake another vehicle</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="vb">Overtaken Vehicle Speed (m/s)</label>
                        <input type="number" id="vb" class="form-input" min="0" placeholder="e.g., 15">
                    </div>
                    <div class="form-group">
                        <label for="v">Design Speed of Road (m/s)</label>
                        <input type="number" id="v" class="form-input" min="0" placeholder="e.g., 25">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="s">Spacing Between Vehicles (m)</label>
                        <input type="number" id="s" class="form-input" min="0" placeholder="e.g., 5">
                    </div>
                    <div class="form-group">
                        <label for="a">Acceleration of Overtaking Vehicle (m/s²)</label>
                        <input type="number" id="a" class="form-input" min="0" step="0.1" placeholder="e.g., 0.7">
                    </div>
                </div>
                <div class="form-group">
                    <label for="d4">Optional Safety Margin (m)</label>
                    <input type="number" id="d4" class="form-input" min="0" placeholder="e.g., 10 (optional)">
                </div>
                
                <button class="calculate-btn" onclick="calculateOSD()">Calculate OSD</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Safe Overtaking Sight Distance</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Safe Overtaking Sight Distance</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Distance (m)</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Short</span><span>Moderate</span><span>Average</span><span>Long</span><span>Very Long</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">OSD Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <!-- About -->
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Safe Overtaking Sight Distance (OSD) Calculator</strong> determines the minimum distance required for a vehicle to safely overtake another vehicle without causing danger to oncoming traffic. It is a vital parameter for road safety and highway design, ensuring sufficient space for overtaking maneuvers.
                </p>
            </div>

            <!-- Parameters Used -->
            <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Overtaken Vehicle Speed (m/s):</strong> The speed of the vehicle being overtaken. Higher speeds increase the overtaking distance required.</li>
                    <li><strong>Design Speed of Road (m/s):</strong> The speed limit or the intended speed for vehicles on the road. This affects the time and distance needed for overtaking maneuvers.</li>
                    <li><strong>Spacing Between Vehicles (m):</strong> The initial gap between the overtaking vehicle and the vehicle being overtaken. Greater spacing allows safer and smoother overtaking.</li>
                    <li><strong>Acceleration of Overtaking Vehicle (m/s²):</strong> The rate at which the overtaking vehicle gains speed. Higher acceleration reduces the time needed to complete the overtaking maneuver.</li>
                    <li><strong>Safety Margin (m) (Optional):</strong> An additional buffer added to the calculated distance to account for uncertainties and ensure safer overtaking.</li>
                </ul>
            </div>
<div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Overtaken Vehicle Speed:</strong> must be <strong>&gt; 0 m/s</strong> 
            (<em>typical: 5–40 m/s</em>). <span style="color:#e67e22; font-weight:bold;">⚠ Warning</span> if outside this range.</li>
        <li><strong>Design Speed of Road:</strong> must be <strong>&gt; 0 m/s</strong> 
            (<em>typical: 10–50 m/s</em>). <span style="color:#1560bd; font-weight:bold;">Must be greater</span> than overtaken vehicle speed.</li>
        <li><strong>Spacing Between Vehicles:</strong> must be <strong>&gt; 0 m</strong> 
            (<em>typical: 2–20 m</em>). <span style="color:#e67e22; font-weight:bold;">⚠ Warning</span> if outside this range.</li>
        <li><strong>Acceleration of Overtaking Vehicle:</strong> must be <strong>&gt; 0 m/s²</strong> 
            (<em>typical: 0.5–3.0 m/s²</em>). <span style="color:#e67e22; font-weight:bold;">⚠ Warning</span> if outside this range.</li>
        <li><strong>Safety Margin:</strong> must be <strong>≥ 0 m</strong>. 
            <span style="color:#e67e22; font-weight:bold;">⚠ Warning</span> if <strong>&gt; 50 m</strong>.</li>
        <li><strong>Decimals allowed:</strong> up to <strong>3 places</strong> for accuracy.</li>
    </ul>
</div>


<div class="note-card">
    <h3>✅ Output Validations</h3>
    <ul class="note-list">
        <li>OSD &lt; 100 m → <strong>Short</strong>: Low-speed overtaking scenarios (rural/local roads).</li>
        <li>100 ≤ OSD ≤ 200 m → <strong>Moderate</strong>: Typical for urban arterial roads.</li>
        <li>200 &lt; OSD ≤ 400 m → <strong>Average</strong>: Common for highways.</li>
        <li>400 &lt; OSD ≤ 600 m → <strong>Long</strong>: Suitable for high-speed/expressways.</li>
        <li>OSD &gt; 600 m → <strong>Very Long</strong>: Unusual, verify inputs and road conditions.</li>
        <li>⚠ Warning: OSD outside 50–1000 m → beyond accepted IRC/PIARC design range.</li>
    </ul>
</div>

<div class="note-card">
    <h3>📏 Standards</h3>
    <p>
        This calculator aligns with <strong>IRC (Indian Roads Congress)</strong>, 
        <strong>PIARC</strong>, and <strong>OSHA/ILO</strong> highway safety guidelines 
        to ensure overtaking sight distance assessments are reliable and safe for real-world applications.
    </p>
</div>

<!-- Conclusion -->
<div class="note-card">
    <h3>📝 Conclusion</h3>
    <p>
        The <strong>Safe Overtaking Sight Distance (OSD) Calculator</strong> provides a quick and reliable 
        way to estimate the minimum distance required for safe overtaking on highways and urban roads.  
        It helps engineers, safety professionals, and transport planners ensure that road designs and 
        overtaking zones meet <b>IRC, PIARC, and OSHA/ILO</b> safety guidelines.  
    </p>
    <p>
        While the formula captures essential parameters such as <i>vehicle speeds, spacing, acceleration, 
        and safety margins</i>, it should be used alongside <b>traffic surveys, site-specific conditions, 
        and professional judgment</b> before applying to real-world projects.  
    </p>
    <p>
        This tool is an <b>educational and planning aid</b>, not a substitute for detailed 
        <b>road safety audits</b> or <b>engineering design reviews</b>. For critical infrastructure, 
        results should always be validated against <b>national highway design standards</b> 
        and reviewed by licensed traffic/road safety experts.
    </p>
</div>

        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        
function calculateOSD() {
    const vb = parseFloat(document.getElementById('vb').value.trim());
    const v = parseFloat(document.getElementById('v').value.trim());
    const s = parseFloat(document.getElementById('s').value.trim());
    const a = parseFloat(document.getElementById('a').value.trim());
    const d4 = parseFloat(document.getElementById('d4').value.trim()) || 0;

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];
    let warnings = [];

    // ---- Input Validations ----
    if (isNaN(vb) || vb <= 0) {
        errors.push("👉 Overtaken Vehicle Speed must be > 0 m/s (typical: 5–40).");
    } else if (vb < 5 || vb > 40) {
        warnings.push("⚠️ Overtaken Vehicle Speed outside normal range (5–40 m/s).");
    }

    if (isNaN(v) || v <= 0) {
        errors.push("👉 Design Speed must be > 0 m/s (typical: 10–50).");
    } else if (v < 10 || v > 50) {
        warnings.push("⚠️ Design Speed outside normal range (10–50 m/s).");
    }

    if (isNaN(s) || s <= 0) {
        errors.push("👉 Spacing must be > 0 m (typical: 2–20).");
    } else if (s < 2 || s > 20) {
        warnings.push("⚠️ Spacing between vehicles outside safe range (2–20 m).");
    }

    if (isNaN(a) || a <= 0) {
        errors.push("👉 Acceleration must be > 0 m/s² (typical: 0.5–3.0).");
    } else if (a < 0.5 || a > 3) {
        warnings.push("⚠️ Acceleration outside realistic range (0.5–3.0 m/s²).");
    }

    if (isNaN(d4) || d4 < 0) {
        errors.push("👉 Safety Margin must be ≥ 0 m.");
    } else if (d4 > 50) {
        warnings.push("⚠️ Safety Margin unusually high (>50 m).");
    }

    if (!isNaN(v) && !isNaN(vb) && v <= vb) {
        errors.push("👉 Design Speed must be greater than Overtaken Vehicle Speed for safe overtaking.");
    }

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ---- OSD Calculation ----
    const reactionTime = 2; 
    const T = (14.4 * s) / a; 
    const d1 = vb * reactionTime; 
    const d2 = vb * T + 2 * s; 
    const d3 = v * T; 
    const osd = d1 + d2 + d3 + d4; 

    if (!isFinite(osd) || isNaN(osd)) {
        errorMessage.innerHTML = "👉 Calculation error: check inputs.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    if (osd < 50 || osd > 1000) {
        warnings.push("⚠️ Calculated OSD is outside typical design range (50–1000 m). Verify inputs.");
    }

    document.getElementById('rateValue').textContent = osd.toFixed(2);

    // ---- Meter & Feedback ----
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (osd < 100) {
        meterWidth = '20%'; meterColor = '#2ecc71';
        feedback = 'Short overtaking distance. Typically for low-speed scenarios.';
    } else if (osd <= 200) {
        meterWidth = '40%'; meterColor = '#27ae60';
        feedback = 'Moderate overtaking distance. Common for urban roads.';
    } else if (osd <= 400) {
        meterWidth = '60%'; meterColor = '#f39c12';
        feedback = 'Average overtaking distance. Suitable for most highway conditions.';
    } else if (osd <= 600) {
        meterWidth = '80%'; meterColor = '#e67e22';
        feedback = 'Long overtaking distance. Required for higher speed roads.';
    } else {
        meterWidth = '95%'; meterColor = '#e74c3c';
        feedback = 'Very long overtaking distance. Verify inputs and road conditions.';
    }

    if (warnings.length > 0) {
        feedback += " " + warnings.join(" ");
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}
        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Input Validation Rules (Real-world, Standards-Based)

From a QEHS/traffic safety standpoint, input ranges must reflect typical IRC/OSHA/ILO highway safety design assumptions:

Overtaken Vehicle Speed (vb, m/s)

Must be > 0

Typical range: 5 – 40 m/s (≈ 18–144 km/h)

Outliers: Flag if < 5 m/s (unlikely for overtaking) or > 40 m/s (beyond highway norms).

Design Speed of Road (v, m/s)

Must be > 0

Typical: 10 – 50 m/s (≈ 36–180 km/h)

Must be greater than vb (otherwise overtaking not possible).

Spacing Between Vehicles (s, m)

Must be > 0

Typical safe gap: 2 – 20 m

Outlier: < 2 m indicates tailgating, flag warning.

Acceleration of Overtaking Vehicle (a, m/s²)

Must be > 0

Practical range: 0.5 – 3.0 m/s²

< 0.5 m/s² → insufficient power to overtake

3.0 m/s² → unrealistic for most cars.

Optional Safety Margin (d4, m)

Must be ≥ 0

Typical: 0 – 20 m

50 m → over-conservative input, flag warning.

Decimals: Allow up to 3 places (precision needed in audits/engineering).

2. Output Validation Logic & Thresholds

The calculated OSD must be categorized meaningfully:

< 100 m → Short (low-speed overtaking, rural/local roads).

100 – 200 m → Moderate (urban arterial roads).

200 – 400 m → Average (common for highways).

400 – 600 m → Long (expressways).

> 600 m → Very Long, possibly unrealistic → verify inputs.

⚠ Warning rule: If OSD < 50 m or > 1000 m → outside accepted design range (IRC/PIARC).

3. Corrected JavaScript Code with Validations
/*
Formula Used:
OSD = d1 + d2 + d3 + d4
where:
  d1 = vb * t      → distance covered during driver reaction time (t = 2 s assumed)
  d2 = vb * T + 2s → distance during overtaking (T = overtaking time)
  d3 = v * T       → distance covered by opposing vehicle
  d4 = safety margin (optional)

Overtaking time (T) = (14.4 * s) / a

Validations Applied:
- vb: 5–40 m/s, must be > 0
- v: 10–50 m/s, must be > vb
- s: 2–20 m, must be > 0
- a: 0.5–3.0 m/s², must be > 0
- d4: ≥ 0, typical ≤ 50 m
- decimals allowed: up to 3 places
*/ {% endcomment %}
