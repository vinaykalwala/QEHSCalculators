{% extends 'base.html' %}
{% block title %}Remaining Corrosion Life Calculator (2){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Required Opening Force For A Balanced Safety Valve  Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
         .result-placeholder img {
            max-width: 350px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        @media (max-width: 768px) {
    .result-placeholder img {
        max-width: 80%;    /* Slightly smaller on tablets */
    }
}

@media (max-width: 480px) {
    .result-placeholder img {
        max-width: 100%;   /* Full width on small screens */
        margin-bottom: 15px;
    }
}
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
 <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Remaining Corrosion Life Calculator (2)</h1>
        <p>Estimate the remaining life of a component based on its thickness and corrosion rate.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="tActual">Actual Thickness (t<sub>actual</sub>) [inches]</label>
                <input type="number" id="tActual" class="form-input" min="0" step="any" placeholder="e.g., 0.5">
            </div>
            <div class="form-group">
                <label for="tRequired">Required Thickness (t<sub>required</sub>) [inches]</label>
                <input type="number" id="tRequired" class="form-input" min="0" step="any" placeholder="e.g., 0.3">
            </div>
            <div class="form-group">
                <label for="corrosionRate">Corrosion Rate [inches/year]</label>
                <input type="number" id="corrosionRate" class="form-input" min="0" step="any" placeholder="e.g., 0.02">
            </div>

            <button class="calculate-btn" onclick="calculateRemainingLife()">Calculate Remaining Life</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/corrosion.webp' %}" alt="Corrosion illustration">
                <p>This tool will calculate the <strong>Remaining Life</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Remaining Life Result</h2>
                </div>
                <div class="rate-value" id="lifeValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Years</div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
            <h3>📘 About This Calculator</h3>
            <p>
                The <strong>Remaining Corrosion Life Calculator</strong> estimates how many years a metal component can continue to operate safely before its thickness reaches the minimum required level. 
                It is widely used in <strong>predictive maintenance, structural integrity assessment, and risk management</strong>.
            </p>
        </div>

        <div class="note-card">
            <h3>⚙️ Parameters Used</h3>
            <ul class="note-list">
                <li><strong>Actual Thickness (t<sub>actual</sub>):</strong> The current thickness of the metal component.</li>
        <li><strong>Required Thickness (t<sub>required</sub>):</strong> The minimum acceptable thickness before failure risk increases.</li>
        <li><strong>Corrosion Rate:</strong> The rate at which the material is lost due to corrosion, measured in inches per year.</li>
        <li><strong>Remaining Life:</strong> The estimated time before the component reaches its required minimum thickness.</li>
        </div>

      <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li>
            <strong>Actual Thickness (t<sub>actual</sub>):</strong> 
            Must be a positive number greater than zero (<code>tActual > 0</code>). 
            Typical industrial range: 0.1 – 24 inches depending on piping, vessels, or structural steel. 
            Maximum of 2 decimal places allowed for measurement precision. 
            Values beyond typical range should trigger a verification warning.
        </li>
        <li>
            <strong>Required Thickness (t<sub>required</sub>):</strong> 
            Must be positive and less than or equal to the actual thickness (<code>0 &lt; tRequired ≤ tActual</code>). 
            Maximum of 2 decimal places allowed. 
            Ensures physical reality and compliance with design codes (ASME, API). 
            Values exceeding tActual are invalid and must be flagged.
        </li>
        <li>
            <strong>Corrosion Rate:</strong> 
            Must be a positive number (>0) in inches/year. 
            Typical ranges: 0.001 – 0.2 in/yr, depending on material, environment, and service conditions. 
            Maximum of 4 decimal places for engineering accuracy. 
            Extremely high values should trigger verification for unusual operating conditions.
        </li>
        <li>
            <strong>Logical & Cross-Field Checks:</strong> 
            <ul>
                <li>tActual must be ≥ tRequired.</li>
                <li>Remaining life calculation should not exceed realistic engineering limits (e.g., >100 years may indicate unrealistic input).</li>
                <li>Zero or negative corrosion rate is invalid and must be rejected.</li>
                <li>Assumes uniform corrosion; localized pitting or unexpected damage is not accounted for.</li>
            </ul>
        </li>
        <li>
            <strong>Compliance & Audit Considerations:</strong> 
            These validations ensure that the inputs are physically meaningful, compliant with OSHA, ISO 45001, NFPA, and API/ASME standards, and produce results suitable for safety audits and maintenance planning.
        </li>
    </ul>
</div>


       <div class="note-card">
    <h3>📊 Output Validation Rules</h3>
    <ul class="note-list">
        <li>
            <strong>Remaining Life &gt; 20 years:</strong> 
            ✅Safe : Component is considered safe for continued operation under current conditions. <br>
            Routine inspection and maintenance schedules should be followed. 
            Aligns with predictive maintenance and long-term safety planning.
        </li>
        <li>
            <strong>Remaining Life 5 – 20 years:</strong> 
            ⚠️ Moderate Risk: Component has usable life but requires closer monitoring. <br>
            Maintenance planning should be adjusted to ensure continued safety and compliance with ISO 55000 and OSHA standards.
        </li>
        <li>
            <strong>Remaining Life 0 – 5 years:</strong> 
            ⚠️ High Risk: Component is approaching critical thickness.<br> 
            Immediate review and maintenance or replacement planning is recommended to prevent failure. 
            Supports compliance with NFPA and ASME/ API inspection guidelines.
        </li>
        <li>
            <strong>Remaining Life &lt; 0 years:</strong> 
            ❌ Critical: Component is below minimum required thickness and may have failed. <br>
            Immediate corrective action is required. Operations should be suspended until repairs or replacements are completed. 
            Non-compliance may result in regulatory penalties and safety hazards.
        </li>
        <li>
            <strong>Edge Cases:</strong> 
            - Extremely high remaining life (&gt;100 years) may indicate unrealistic inputs; verify measurements and corrosion rate. <br>
            - Negative or zero corrosion rate inputs are invalid and must be corrected.
        </li>
    </ul>
</div>

      <div class="note-card">
    <h3>⚖️ Governing Principle</h3>
    <p>
        A corrosion life calculator is based on standards like 
        <strong>API 510 (Pressure Vessels)</strong> and <strong>API 570 (Piping Systems)</strong>, 
        which are widely recognized industry standards for mechanical integrity and inspection. 
        These standards outline procedures for calculating corrosion rates and estimating the remaining service life 
        of components using thickness measurements and required minimum thickness.
    </p>

    <h5>How it works (based on API 510/570):</h5>
    <ul class="note-list">
        <li><strong>Measure Thickness:</strong> A technician performs non-destructive testing, such as ultrasonic thickness measurement (UTM), to determine the current thickness of a component.</li>
        <li><strong>Determine Required Thickness:</strong> The required thickness is calculated using ASME-based design formulas to ensure safe operation under expected conditions.</li>
        <li><strong>Calculate Corrosion Rate:</strong> The corrosion rate is determined using historical thickness data, typically considering both long-term and short-term corrosion rates.</li>
        <li><strong>Predict Remaining Life:</strong> Using the current thickness and corrosion rate, the calculator predicts how long the component can safely operate before reaching its minimum allowable thickness.</li>
    </ul>

    <h5>Key Concepts in the Standards</h5>
    <ul class="note-list">
        <li><strong>Half-Life Principle:</strong> The next inspection should occur within half of the calculated remaining life or a maximum of 10 years, whichever is earlier.</li>
        <li><strong>Long-Term (LT) and Short-Term (ST) Rates:</strong> Calculated based on different time intervals between thickness measurements to track the corrosion trend.</li>
        <li><strong>Remaining Service Life (RSL):</strong> The estimated time a component can continue to operate safely based on current conditions and the applicable standards.</li>
    </ul>
</div>



        <div class="note-card">
            <h3>Conclusion</h3>
            <p>
                Calculating remaining corrosion life helps engineers <strong>plan maintenance, extend service life, and ensure safety</strong> of critical assets.
            </p>
        </div>
    </div>
</div>

<script>
function calculateRemainingLife() {
    const tActualInput = document.getElementById('tActual').value.trim();
    const tRequiredInput = document.getElementById('tRequired').value.trim();
    const corrosionRateInput = document.getElementById('corrosionRate').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Parse Inputs ---
    const tActual = parseFloat(tActualInput);
    const tRequired = parseFloat(tRequiredInput);
    const corrosionRate = parseFloat(corrosionRateInput);

    // --- Validation: Actual Thickness ---
    if (tActualInput === "" || isNaN(tActual) || tActual <= 0) {
        errors.push("👉 Actual Thickness must be a positive number (>0).");
    } else if (!/^\d+(\.\d{1,2})?$/.test(tActualInput)) {
        errors.push("👉 Actual Thickness can have maximum 2 decimal places.");
    } else if (tActual > 24) {
        errors.push("⚠️ Actual Thickness unusually high (>24 inches); verify design.");
    }

    // --- Validation: Required Thickness ---
    if (tRequiredInput === "" || isNaN(tRequired) || tRequired <= 0) {
        errors.push("👉 Required Thickness must be a positive number (>0).");
    } else if (!/^\d+(\.\d{1,2})?$/.test(tRequiredInput)) {
        errors.push("👉 Required Thickness can have maximum 2 decimal places.");
    } else if (!isNaN(tActual) && tRequired > tActual) {
        errors.push("❌ Required Thickness cannot exceed Actual Thickness.");
    }

    // --- Validation: Corrosion Rate ---
    if (corrosionRateInput === "" || isNaN(corrosionRate) || corrosionRate <= 0) {
        errors.push("👉 Corrosion Rate must be a positive number (>0).");
    } else if (!/^\d+(\.\d{1,4})?$/.test(corrosionRateInput)) {
        errors.push("👉 Corrosion Rate can have maximum 4 decimal places.");
    } else if (corrosionRate > 0.2) {
        errors.push("⚠️ Corrosion Rate unusually high (>0.2 in/yr); verify data source.");
    }

    // --- Display errors ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculation ---
    const remainingLife = (tActual - tRequired) / corrosionRate;

    document.getElementById('lifeValue').textContent = remainingLife.toFixed(2);

    // --- Feedback ---
    let feedback = "";
    if (remainingLife < 0) {
        feedback = "❌ <strong>Critical:</strong> Component is below minimum required thickness and may have failed. ";
    } else if (remainingLife <= 5) {
        feedback = "⚠️ <strong>High Risk:</strong> Component is approaching critical thickness.";
    } else if (remainingLife <= 20) {
        feedback = "⚠️ <strong>Moderate Risk:</strong> Component has usable life but requires closer monitoring. ";
    } else {
        feedback = "✅ <strong>Safe:</strong>  Component is considered safe for continued operation under current conditions.";
    }

    document.getElementById('feedbackContent').innerHTML = feedback;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 1️⃣ Input Analysis & Real-World Considerations
Input	Unit	Purpose	Real-World Relevance
tActual	inches	Current measured thickness of the component	Ensures structural integrity; critical in pressure vessels, pipelines, storage tanks.
tRequired	inches	Minimum allowable thickness before failure risk increases	Regulatory compliance: thickness below minimum can trigger unsafe operation alerts.
corrosionRate	inches/year	Rate of thickness loss due to corrosion	Needed to predict remaining life; must be based on inspection, corrosion coupons, or monitoring.

Calculation formula:

Remaining Life (years)
=
𝑡
actual
−
𝑡
required
corrosion rate
Remaining Life (years)=
corrosion rate
t
actual
	​

−t
required
	​

	​


Simple, linear corrosion model.

Assumes uniform corrosion (common assumption in audits unless localized pitting data is available).

Safety-critical: negative or zero remaining life triggers immediate maintenance / shutdown actions.

2️⃣ Recommended Input Validation Rules (QEHS & Fire Safety Standards)
2.1 Actual Thickness (tActual)

Must be > 0.

Typical industrial thickness: 0.1 – 24 inches depending on piping, vessels, or structural steel.

Maximum decimal places: 2 (for audit/measurement precision).

Units: inches or mm (consistent with corrosion data).

2.2 Required Thickness (tRequired)

Must be > 0.

Must be ≤ Actual Thickness.

Typical minimum thickness depends on design code (ASME B31.3, API, ISO standards).

Decimal precision: 2.

2.3 Corrosion Rate

Must be > 0 (negative corrosion rates are nonsensical).

Realistic typical ranges:

Low corrosion: 0.001 – 0.01 in/yr

Moderate: 0.01 – 0.05 in/yr

High: 0.05 – 0.2 in/yr (extreme cases, e.g., marine, chemical processing)

Max decimal places: 4 for engineering accuracy.

2.4 Cross-Field / Logical Checks

tActual < tRequired → invalid

Remaining life > 100 years → flag as unrealistic

Remaining life < 0 → component at risk/failure

Extremely high corrosion rate relative to thickness → alert for possible input error or accelerated corrosion

3️⃣ Output Validation Logic & Thresholds
Remaining Life (years)	Meaning / Assessment
> 20	✅ Safe: Component can continue operation with routine inspection.
5 – 20	⚠️ Moderate Risk: Schedule maintenance or closer monitoring.
0 – 5	⚠️ High Risk: Component approaching critical minimum thickness; plan repair/replacement.
< 0	❌ Critical: Component already below minimum safe thickness; immediate action required.

Notes:

Thresholds align with ISO 55000 / predictive maintenance KPIs.

Alerts ensure compliance with OSHA & NFPA for pressure-containing systems.

Reporting negative or extremely high remaining life must trigger review for audit compliance.

4️⃣ Edge Case Validations
Edge Case	Handling
Division by zero (corrosionRate = 0)	Reject input; display error: “Corrosion rate must be > 0”
Negative values	Reject input; cannot have negative thickness or rate
tActual < tRequired	Reject input; violates physical and safety reality
Remaining life > 100 years	Display warning: “Unrealistic remaining life; verify inputs”
Extremely high corrosionRate (> 0.2 in/yr)	Warning: “High corrosion rate; verify data source”
Non-numeric input	Reject input; prompt for numeric value
Decimal precision exceeded	Round or reject; ensure 2 decimals for thickness, 4 for corrosion rate

7️⃣ Why These Validations are Essential

Protect Personnel & Equipment: Avoid operating unsafe components.

Audit Compliance: Ensures inputs and outputs align with ISO, NFPA, OSHA standards.

Avoid Miscalculations: Prevent division by zero, negative remaining life, or unrealistic outputs.

Predictive Maintenance: Provides accurate KPIs for maintenance scheduling.

Regulatory Reporting: Ensures values are realistic and defensible in safety audits. -->