{% extends 'base.html' %}
{% block title %}Steam Consumption To Provide Tank Heat Losses Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
     
            @media screen and (max-width: 768px) {
    .calculator-header h1 {
        font-size: 1.5rem; /* smaller font for mobile */
        margin-bottom: 8px;
        text-align: center; /* optional: center the heading on mobile */
    }
}
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 250px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
       
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
  <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Steam Consumption Calculator For Tank Heat Losses Calculator</h1>
        <p>Estimate the required steam flow to compensate for heat losses in tanks.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator Input -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="heatLoss">Heat Loss (Q) in kW</label>
                <input type="number" id="heatLoss" class="form-input" min="0" placeholder="e.g., 150">
            </div>
            <button class="calculate-btn" onclick="calculateSteamFlow()">Calculate Steam Flow</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Steam illustration">
                <p>This tool will calculate <strong>Steam Flow Rate</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Steam Flow Result</h2>
                </div>
                <div class="rate-value" id="steamFlowValue">0</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">
                    kg/s
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
        The <strong>Steam Consumption Calculator</strong> estimates the mean steam flow rate required to compensate for heat losses in tanks and vessels. It provides engineers, safety professionals, and plant operators with a quick and reliable way to determine how much steam is needed to maintain target temperatures, ensuring process efficiency and safety.  
    </p>
    <p>
        This tool is particularly useful in <strong>industrial processes</strong> such as chemical manufacturing, food processing, and pharmaceutical production, where maintaining precise temperature control is critical. Additionally, it aids in <strong>fire safety and protection systems</strong> by helping to prevent overheating in tanks storing flammable or temperature-sensitive substances.  
    </p>
  
</div>


       <div class="note-card">
    <h3>⚙️ Parameters Used</h3>
    <ul class="note-list">
        <li>
            <strong>Q (Heat Loss in kW):</strong> This represents the total amount of heat energy lost from the tank or vessel per unit time. Heat can be lost through the tank sides, the surface, and any exposed fittings or pipes. Accurately estimating Q is critical because it directly determines the steam flow required to maintain the desired temperature. Factors affecting Q include tank insulation, ambient temperature, surface area, and the temperature difference between the tank contents and the surrounding environment.
        </li>
    </ul>
</div>


       <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Heat Loss (Q, kW):</strong> Must be entered as a numeric value representing total heat lost from the tank or vessel per unit time. Cannot be empty, zero, or negative.</li>
        <li><strong>Numeric Range:</strong> Acceptable range: 0 < Q ≤ 10,000 kW. Values above 10,000 kW are flagged as unusually high and should be verified.</li>
        <li><strong>Decimal Precision:</strong> Up to 2 decimal places are allowed for precision in engineering calculations. Inputs like 123.45 are valid; 123.456 is invalid.</li>
        <li><strong>Unit of Measure:</strong> Input must be in kilowatts (kW). Conversion from other units (e.g., kcal/h, BTU/h) must be done prior to entry to ensure accurate calculation.</li>
        <li><strong>Mandatory Field:</strong> The input cannot be left empty; empty input triggers an error.</li>
        <li><strong>Positive Check:</strong> Q must be strictly greater than 0. Zero or negative values are physically impossible.</li>
        <li><strong>Maximum Threshold:</strong> Inputs exceeding 10,000 kW trigger a warning for potential unrealistic tank or system design.</li>
        <li><strong>Logical Consistency / Cross-field Dependency:</strong> The resulting steam flow must not exceed practical system limits (>10 kg/s); if it does, a warning must be displayed to verify inputs and system parameters.</li>
        <li><strong>Edge Case Handling:</strong> 
            <ul>
                <li>Empty or null input → error message</li>
                <li>Zero Q → error message</li>
                <li>Negative Q → error message</li>
                <li>Non-numeric input → error message</li>
                <li>Extremely high input (>10,000 kW) → warning message</li>
            </ul>
        </li>
        <li><strong>Pressure Assumption:</strong> Calculation assumes atmospheric pressure conditions. If operating under pressurized steam systems, enthalpy must be adjusted accordingly; otherwise, a warning should be displayed.</li>
        <li><strong>Input Format Enforcement:</strong> Only numeric characters and one optional decimal point allowed; no letters or special symbols.</li>
    </ul>
</div>


        <div class="note-card">
    <h3>📊 Output Validations</h3>
    <ul class="note-list">
        <li>
            <span class="good">Steam Flow &lt; 0.1 kg/s:</span> ✅ Very low heat loss. Steam requirement is minimal and well within safe operational limits.<br> Suitable for small tanks or well-insulated systems.
        </li>
        <li>
            <span class="average">Steam Flow 0.1 – 1 kg/s:</span> ⚠️ Normal steam requirements. Represents typical operational conditions in industrial tanks.<br> Users should verify that system capacity, insulation, and energy supply are adequate. Ensure compliance with occupational safety and fire prevention standards.
        </li>
        <li>
            <span class="bad">Steam Flow &gt; 1 kg/s:</span> ❌ High steam requirement. Indicates significant heat loss or large-scale tank systems.<br> This may stress system capacity, increase energy consumption, or present safety risks. Users should verify tank design, insulation, and process safety compliance. Consider auditing for potential fire safety or occupational hazards.
        </li>
        <li>
            <strong>Extreme Outliers:</strong> Any calculated steam flow exceeding 10 kg/s should trigger an alert. Such values are likely unrealistic or indicate incorrect inputs, system design issues, or safety risks.
        </li>
    </ul>
</div>

    <div class="note-card">
    <h3>📋 Standards & Compliance</h3>
    <p>
        This calculator aligns with recognized occupational safety, fire safety, and industrial process standards to ensure reliable and audit-ready results:
    </p>
    <ul class="note-list">
        <li><strong>OSHA / ISO 45001:</strong> Ensures workplace safety by preventing operational hazards associated with excessive steam flow or tank overheating.</li>
        <li><strong>NFPA Standards:</strong> Supports fire prevention by identifying high-heat areas and maintaining safe temperature control in tanks storing flammable or temperature-sensitive substances.</li>
        <li><strong>ILO Guidelines:</strong> Provides safe operational limits for personnel exposure to high-temperature equipment and steam systems.</li>
        <li><strong>Industrial Process Standards:</strong> Ensures calculations follow best practices for energy efficiency, steam consumption, and thermal system design.</li>
        <li><strong>Audit & Reporting:</strong> Input validation, edge-case handling, and output thresholds guarantee that the calculated KPIs are suitable for inclusion in safety reports and regulatory audits.</li>
        <li><strong>Data Integrity:</strong> All inputs are checked for realism and consistency, preventing misreporting and supporting compliance with internal and external safety standards.</li>
    </ul>
</div>

        <div class="note-card">
            <h3>🏁 Conclusion</h3>
            <p>
                By using this calculator, engineers and safety professionals can estimate the required steam flow to maintain proper tank temperatures, prevent overheating, and ensure safe operation of industrial and fire protection systems.
            </p>
        </div>
    </div>
</div>

<script>
function calculateSteamFlow() {
    const Q = parseFloat(document.getElementById('heatLoss').value);
    const enthalpy = 2256.7; // kJ/kg

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const feedbackContent = document.getElementById('feedbackContent');

    let errors = [];

    // --- Mandatory & Numeric Check ---
    if (isNaN(Q)) errors.push("👉 Heat Loss (Q) must be a number.");
    if (Q <= 0) errors.push("👉 Heat Loss (Q) must be greater than 0 kW.");

    // --- Maximum Threshold Check ---
    if (Q > 10000) errors.push("⚠️ Heat Loss unusually high (>10,000 kW). Verify input.");

    // --- Stop and display errors if any ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculate Steam Flow ---
    const steamFlow = Q / enthalpy; // kg/s
    document.getElementById('steamFlowValue').textContent = steamFlow.toFixed(5);

    // --- Feedback based on flow ---
    let feedback = "";
    let color = "";

    if (steamFlow < 0.1) {
        feedback = "✅ Very low heat loss. Steam requirement is minimal and well within safe operational limits.";
        color = "green";
    } else if (steamFlow >= 0.1 && steamFlow <= 1) {
        feedback = "⚠️ Normal steam requirements. Represents typical operational conditions in industrial tanks.";
        color = "orange";
    } else {
        feedback = " ❌ High steam requirement. Indicates significant heat loss or large-scale tank systems. ";
        color = "red";
    }

    feedbackContent.innerHTML = `<strong style="color:${color}">${feedback}</strong>`;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1️⃣ Input Validation Rules (QEHS/Fire Safety Perspective)
Parameter: Heat Loss (Q, kW)
Validation Type	Rule	Reason / Compliance
Mandatory	Must be entered, cannot be empty	Missing input would produce invalid steam flow; safety audits require all calculations to have valid inputs
Numeric	Must be a number	Non-numeric values break the calculation and can mislead engineers
Positive	Q > 0	Zero or negative heat loss is physically impossible; prevents misleading results
Maximum Threshold	Q ≤ 10,000 kW (example upper bound for industrial tanks)	Extremely high values likely indicate input error; NFPA/OSHA requires checking for unrealistic system design parameters
Decimal Precision	Up to 2 decimals allowed	Ensures meaningful engineering precision without excessive rounding errors
Logical Consistency	Cross-check: Steam flow = Q / 2256.7 kJ/kg. Extremely high steam flow (>10 kg/s) should trigger warning	Prevents system overload or unrealistic operational scenarios

Additional Notes:

Ensure units are in kW, not kcal/h or BTU/h. Conversion errors are common in audits.

If working under pressurized steam systems, the enthalpy of vaporization should be adjusted; warn user if atmospheric assumption is violated.

2️⃣ Output Validation Logic (Steam Flow kg/s)
Output Range	Assessment	QEHS Explanation
< 0.1 kg/s	✅ Very low heat loss, safe operation	Minimal steam requirement; normal in small tanks or well-insulated systems
0.1 – 1 kg/s	⚠️ Normal steam requirement; check system capacity	Typical industrial range; ensures process control is maintained
> 1 kg/s	❌ High steam requirement; verify heat loss	Could indicate large tanks, insulation failure, or calculation error; safety audit flags high energy usage and fire risk

Key Considerations:

Steam flow must not exceed system capacity — exceeding pressure/flow limits can violate OSHA/ISO 45001 and NFPA safety requirements.

Include warnings for unrealistic combinations (e.g., small tanks with huge Q).

3️⃣ Edge Case Handling
Case	Handling
Empty input	Show error: “Heat Loss must be entered”
Q ≤ 0	Show error: “Heat Loss must be positive”
Non-numeric input	Show error: “Heat Loss must be a number”
Extremely high Q (>10,000 kW)	Show warning: “Value unusually high; verify tank parameters”
Extreme steam flow (>10 kg/s)	Warn user: “Calculated steam flow unusually high; check inputs”
Division by zero	Not applicable here (enthalpy is constant), but if enthalpy is dynamic, check for zero

6️⃣ Compliance & Safety Justification

Mandatory & numeric validation: Ensures accurate reporting; required by OSHA and ISO 45001 for operational safety records.

Positive Q only: Physical principle; negative heat loss is impossible.

Maximum thresholds / outlier checks: Prevents design or input errors that could cause unsafe steam supply; aligns with NFPA fire safety audits.

Logical consistency (steam flow): Prevents calculations exceeding system capacity; ensures ILO safety compliance for occupational hazards.

Output color-coded feedback: Quick risk assessment for engineers; standard in QEHS KPI reporting. -->