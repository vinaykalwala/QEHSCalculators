{% extends 'base.html' %}
{% block title %}Inverse Square Law Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inverse Square Law Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .unit-label {
            color: #7f8c8d;
            font-size: 14px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Inverse Square Law Calculator</h1>
            <p>Calculate radiation intensity at different distances from a source</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="intensity2">Known Intensity (I₂)</label>
                    <input type="number" id="intensity2" class="form-input" min="0" step="any" placeholder="e.g., 100">
                </div>
                <div class="form-group">
                    <label for="distance1">Distance (R₁)</label>
                    <input type="number" id="distance1" class="form-input" min="0.0001" step="any" placeholder="e.g., 5">
                </div>
                <div class="form-group">
                    <label for="distance2">Reference Distance (R₂)</label>
                    <input type="number" id="distance2" class="form-input" min="0.0001" step="any" placeholder="e.g., 10">
                </div>
                
                <button class="calculate-btn" onclick="calculateIntensity()">Calculate Intensity</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Radiation Intensity</strong> using the Inverse Square Law. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Calculated Radiation Intensity</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Intensity at R₁ (I₁)</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Intensity Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Inverse Square Law Calculator</strong> determines radiation intensity at different distances from a source, 
                    which is crucial for assessing radiation exposure and energy distribution in various applications.
                </p>
            </div>

            <div class="note-card">
                <h3>❓ What is the Inverse Square Law?</h3>
                <p>
                    The inverse square law is a principle in physics stating that a physical quantity (such as light, sound, gravity, 
                    or electromagnetic force) decreases in intensity proportionally to the square of the distance from the source.
                </p>
            </div>

            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Known Intensity (I₂):</strong> The radiation intensity at the reference distance R₂</li>
                    <li><strong>Distance (R₁):</strong> The distance from the source where intensity needs to be calculated</li>
                    <li><strong>Reference Distance (R₂):</strong> The distance from the source where intensity I₂ is known</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>📊 Interpretation</h3>
                <p>
                    The calculated intensity shows how radiation diminishes with distance:
                </p>
                <ul class="note-list">
                    <li>If R₁ > R₂, intensity will decrease</li>
                    <li>If R₁ < R₂, intensity will increase</li>
                    <li>The relationship follows an inverse square pattern</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>🌍 Real-Life Applications</h3>
                <ul class="note-list">
                    <li><strong>Radiation Safety</strong> - Determining safe distances from radiation sources</li>
                    <li><strong>Medical Imaging</strong> - Adjusting X-ray and MRI intensities for accurate diagnostics</li>
                    <li><strong>Astrophysics</strong> - Measuring the intensity of light from stars and celestial objects</li>
                    <li><strong>Lighting Design</strong> - Optimizing light distribution in photography and architecture</li>
                    <li><strong>Wireless Communication</strong> - Calculating signal strength at different distances</li>
                </ul>
            </div>

            <div class="note-card">
    <h3>✅ Validation Rules</h3>
    <ul class="note-list">
        <li><b>Known Intensity (I₂):</b> Must be between 0.01 and 1e8 (µSv/h or consistent unit)</li>
        <li><b>Distance R₁:</b> Must be between 0.0001 m and 10,000 m</li>
        <li><b>Reference Distance R₂:</b> Must be between 0.0001 m and 10,000 m</li>
        <li><b>Cross-check:</b> R₁ and R₂ cannot be equal</li>
        <li><b>Units:</b> All distances and intensities must use consistent units</li>
    </ul>
</div>

            
            <div class="note-card">
                <h3>📋 Safety Considerations</h3>
                <p>
                    This calculator belongs to the Safety sector because calculating radiation intensity using the Inverse Square Law 
                    helps in determining safe distances, minimizing exposure risks, and ensuring compliance with radiation safety standards.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateIntensity() {
    const intensity2 = document.getElementById('intensity2').value.trim();
    const distance1 = document.getElementById('distance1').value.trim();
    const distance2 = document.getElementById('distance2').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Validation Rules ---
    // Known Intensity (I₂)
    if (intensity2 === "" || isNaN(intensity2)) {
        errors.push("👉 Please enter the known intensity (I₂).");
    } else if (parseFloat(intensity2) <= 0) {
        errors.push("👉 Known intensity (I₂) must be greater than 0.");
    } else if (parseFloat(intensity2) < 0.01 || parseFloat(intensity2) > 1e8) {
        errors.push("👉 Known intensity (I₂) must be between 0.01 and 1e8 (µSv/h or consistent units).");
    }

    // Distance 1 (R₁)
    if (distance1 === "" || isNaN(distance1)) {
        errors.push("👉 Please enter the distance R₁.");
    } else if (parseFloat(distance1) <= 0) {
        errors.push("👉 Distance R₁ must be greater than 0.");
    } else if (parseFloat(distance1) < 0.0001 || parseFloat(distance1) > 10000) {
        errors.push("👉 Distance R₁ must be between 0.0001 m and 10,000 m.");
    }

    // Distance 2 (R₂)
    if (distance2 === "" || isNaN(distance2)) {
        errors.push("👉 Please enter the reference distance R₂.");
    } else if (parseFloat(distance2) <= 0) {
        errors.push("👉 Reference distance R₂ must be greater than 0.");
    } else if (parseFloat(distance2) < 0.0001 || parseFloat(distance2) > 10000) {
        errors.push("👉 Reference distance R₂ must be between 0.0001 m and 10,000 m.");
    }

    // Cross-field validation
    if (distance1 !== "" && distance2 !== "" && parseFloat(distance1) === parseFloat(distance2)) {
        errors.push("👉 Distance R₁ and reference distance R₂ cannot be the same.");
    }

    // --- Error Handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Safe Calculations ---
    const I2 = parseFloat(intensity2);
    const R1 = parseFloat(distance1);
    const R2 = parseFloat(distance2);

    const I1 = I2 * (Math.pow(R2, 2) / Math.pow(R1, 2));

    document.getElementById('rateValue').textContent = I1.toFixed(6);

    let feedback = "";
    let feedbackColor = "black";

    if (R1 > R2) {
        feedback = `✅ Intensity decreases with increasing distance. At ${R1.toFixed(2)} units, the intensity is ${(I1 / I2 * 100).toFixed(2)}% of the intensity at ${R2.toFixed(2)} units.`;
        feedbackColor = "green";
    } else if (R1 < R2) {
        feedback = `⚠️ Warning: Intensity increases at closer distances. At ${R1.toFixed(2)} units, the intensity is ${(I1 / I2 * 100).toFixed(2)}% higher than at ${R2.toFixed(2)} units. Ensure radiation safety precautions.`;
        feedbackColor = "orange";
    }

    document.getElementById('feedbackContent').innerHTML = feedback;
    document.getElementById('feedbackContent').style.color = feedbackColor;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

{% comment %} 

1. Formula Used

The inverse square law formula applied in your calculator is correct:

I₁ = I₂ × (R₂² / R₁²)


I₁ → Radiation intensity at distance R₁

I₂ → Known radiation intensity at distance R₂

R₁ → Target distance from the source

R₂ → Reference distance from the source

2. Input Validation Rules (QEHS / Fire Safety Perspective)

These follow ICRP, OSHA, and NFPA 801 radiation safety principles:

Known Intensity (I₂)

Must be > 0 (cannot have negative or zero radiation intensity).

Practical lower bound: ≥ 0.01 µSv/h (very low background radiation).

Practical upper bound: ≤ 1e8 µSv/h (extreme sources, but prevents absurd entries).

Allow up to 6 decimal places for precision.

Distance (R₁, R₂)

Must be > 0 (distance cannot be zero or negative).

Practical lower bound: ≥ 0.0001 m (0.1 mm) → avoids division by zero.

Practical upper bound: ≤ 10,000 m (10 km) (beyond this, radiation intensity is negligible).

Maximum 6 decimals allowed.

Cross-check: R₁ ≠ R₂ (if equal, formula degenerates into I₁ = I₂).

Units of Measure

All distances must be in the same unit (meters recommended).

Intensities should be in consistent units (e.g., µSv/h, W/m², cd, depending on application).

3. Output Validation Logic

Result must always be positive (no negative intensity possible).

If R₁ > R₂ → intensity decreases (output should be ≤ I₂).

If R₁ < R₂ → intensity increases (output should be ≥ I₂).

Show result with up to 6 decimals.

Provide safety interpretation:

✅ Safe trend if moving farther.

⚠️ Warning if moving closer (higher risk of overexposure).

/*
Formula Reference:
I₁ = I₂ × (R₂² / R₁²)

Validation Rules:
- I₂ > 0 (0.01 ≤ I₂ ≤ 1e8)
- R₁, R₂ > 0 (0.0001 ≤ R ≤ 10,000)
- R₁ ≠ R₂
- All values must be numeric with up to 6 decimals
*/

{% endcomment %}