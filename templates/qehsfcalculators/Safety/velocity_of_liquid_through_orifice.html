{% extends 'base.html' %}
{% block title %}Velocity of Liquid through orifice calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velocity of Liquid through orifice calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            min-height: 420px; /* Match calc-card */
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
            justify-content: center;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
         .form-input[readonly] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Velocity of Liquid through orifice calculator</h1>
            <p>Calculate the exit velocity of a fluid from an orifice based on fluid height.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>System Parameters</h2>
                <div class="form-group">
                    <label for="height">Pressure Head (h)</label>
                    <input type="number" id="height" class="form-input" placeholder="Enter height in meters">
                </div>
                <div class="form-group">
                    <label for="gravity">Gravitational Constant (g)</label>
                    <input type="number" id="gravity" class="form-input" value="9.81" readonly>
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate Velocity</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Engineering illustration">
                    <p>Enter the pressure head to calculate the velocity of the liquid exiting the orifice.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Liquid Velocity (u)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label">m/s</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span>
                        <span>Moderate</span>
                        <span>High</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                       <div class="btn-wrapper">
                            <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                        </div>
                </div>
            </div>
        </div>

        <div class="note-section">
        
            <!-- üìò ABOUT THIS CALCULATOR -->
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Velocity of Liquid Through an Orifice Calculator</strong> estimates the exit speed of a liquid
                    as it passes through an orifice or nozzle,
                    based on fundamental principles of fluid mechanics and international standards like ISO 5167.
                    It is widely used in hydraulic design, process engineering, and flow measurement systems.
                </p>
                <p>
                    This calculator simplifies practical velocity estimation by applying the conservation of energy principle
                    and pressure drop relationships across the orifice.
                </p>
            </div>
        
            <!-- ‚öô PARAMETERS USED -->
            <div class="note-card">
                <h3>‚öô Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Pressure Head (h):</strong> The vertical height of fluid above the orifice (m), representing the
                        potential energy driving flow.</li>
                    <li><strong>Gravitational Acceleration (g):</strong> Constant 9.81 m/s¬≤ ‚Äî the rate of acceleration due to
                        gravity.</li>
                </ul>
                <p><em>These two parameters are sufficient for theoretical velocity computation under ideal discharge
                        conditions.</em></p>
            </div>
        
            <!-- ‚úÖ INPUT VALIDATION RULES -->
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Pressure Head (h):</strong> Must be ‚â• 0 m (no negative or imaginary values).</li>
                    <li><strong>Empty Field:</strong> Pressure head cannot be blank.</li>
                    <li><strong>Non-Numeric Input:</strong> Rejected to ensure physical validity.</li>
                    <li><strong>Zero Head:</strong> Results in zero velocity (valid but yields no flow).</li>
                </ul>
                <p><em>Input checks ensure realistic parameters consistent with hydraulic system measurements.</em></p>
            </div>
        
            <!-- üìä OUTPUT VALIDATIONS -->
            <div class="note-card">
                <h3>üìä Output Validations</h3>
                <p>The resulting velocity is assessed according to the following performance thresholds:</p>
                <ul class="note-list">
                    <li><strong>Velocity ‚â§ 3 m/s:</strong> ‚úÖ Low Velocity ‚Äì Safe and controlled fluid outflow.</li>
                    <li><strong>3 &lt; Velocity ‚â§ 10 m/s:</strong> ‚ö†Ô∏è Moderate Velocity ‚Äì Typical flow for industrial or process
                        systems.</li>
                    <li><strong>Velocity &gt; 10 m/s:</strong> ‚ùå High Velocity ‚Äì Rapid discharge; apply caution in design or
                        operation.</li>
                </ul>
                <p><em>These same qualitative results are displayed beside the output value in the live calculator
                        interface.</em></p>
            </div>
        
            <!-- üìê GOVERNING PRINCIPLE -->
            <div class="note-card">
                <h3>üìê Governing Principle</h3>
                <p>
                    A calculator for liquid velocity through an orifice generally follows <strong>ISO 5167</strong>,
                    an international standard governing the use of differential-pressure devices ‚Äî including orifice plates,
                    nozzles,
                    and Venturi tubes ‚Äî for flow measurement. Specific implementations may reference parts of ISO 5167 or
                    related
                    <strong>ASME MFC</strong> standards.
                </p>
        
                <p><strong>Key Standards:</strong></p>
                <ul class="note-list">
                    <li><strong>ISO 5167:</strong> Defines geometry, installation, and operating conditions for orifice-type
                        flow devices used to measure flow rates in pipes.</li>
                    <li><strong>ASME MFC:</strong> Documents such as ASME MFC-14M establish design and installation requirements
                        for integrated orifice flowmeters.</li>
                </ul>
        
                <p><strong>How the Standard is Applied:</strong></p>
                <ul class="note-list">
                    <li><strong>Energy Conservation:</strong> Velocity is derived from Bernoulli‚Äôs principle, which relates
                        pressure, velocity, and elevation.</li>
                    <li><strong>Differential Pressure:</strong> An orifice plate produces a pressure drop (P‚ÇÅ and P‚ÇÇ) used to
                        compute flow rate and velocity.</li>
                    <li><strong>Discharge Coefficient (C·¥Ö):</strong> Accounts for real-world losses from friction and flow
                        contraction,
                        ensuring measured flow aligns with theoretical predictions.</li>
                    <li><strong>Geometric Ratios:</strong> ISO 5167 defines the orifice-to-pipe diameter ratio (d/D) for
                        precision in flow measurement.</li>
                </ul>
            </div>
        
            <!-- üß© CONCLUSION -->
            <div class="note-card">
                <h3>üß© Conclusion</h3>
                <p>
                    The Velocity Through Orifice Calculator applies Bernoulli‚Äôs principle in line with ISO 5167 methodology
                    to provide accurate theoretical velocity estimates.
                    In engineering practice, discharge coefficients and geometric corrections per ISO 5167 or ASME MFC standards
                    are applied for real-world conditions.
                    Understanding these parameters ensures accurate flow measurement, safer designs, and energy-efficient fluid
                    systems.
                </p>
            </div>
        
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            // Assuming an element with id 'printDate' exists in your included header/footer
            if (document.getElementById('printDate')) {
                 document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];
            function getVal(id, label, opts = {}) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (raw === '') {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num)) {
                    errors.push(`üëâ Enter a valid number for ${label}.`);
                    return null;
                }
                if (num < 0) {
                    errors.push(`üëâ ${label} cannot be negative.`);
                    return null;
                }
                return num;
            }

            const height = getVal('height', 'Pressure Head');

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }
            
            const gravity = 9.81;
            const velocity = Math.sqrt(2 * gravity * height);

            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = velocity.toFixed(2);
            
            const meterFill = document.getElementById('meterFill');
            const maxV = 20; // Set a reasonable max velocity for the visual scale
            let pct = (velocity / maxV) * 100;
            pct = Math.max(0, Math.min(100, pct));
            meterFill.style.width = pct + '%';
            
            let interpretation;
            if (velocity <= 3) {
                meterFill.style.backgroundColor = '#2ecc71'; // Green
                interpretation = "<span class='good'>‚úÖ <strong>Low Velocity:</strong> Safe and controlled fluid outflow.</span>";
            } else if (velocity <= 10) {
                meterFill.style.backgroundColor = '#f39c12'; // Yellow
                interpretation = "<span class='average'>‚ö†Ô∏è <strong>Moderate Velocity:</strong> A standard flow speed for many applications.</span>";
            } else {
                meterFill.style.backgroundColor = '#e74c3c'; // Red
                interpretation = "<span class='bad'>‚ùå <strong>High Velocity:</strong> Rapid fluid discharge. Handle with caution!</span>";
            }
            
            document.getElementById('feedbackContent').innerHTML = interpretation;
        }
        
        function printReport() {
             // Update date just before printing if needed
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}