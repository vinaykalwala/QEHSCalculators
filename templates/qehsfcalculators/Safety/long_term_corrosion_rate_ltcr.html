{% extends 'base.html' %}
{% block title %}Long-Term Corrosion Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long-Term Corrosion Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 520px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Long-Term Corrosion Rate Calculator</h1>
            <p>Calculate the rate of material degradation over time to support predictive maintenance strategies</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="initialThickness">Initial Thickness [inches]</label>
                    <input type="number" id="initialThickness" class="form-input" min="0" step="0.1" placeholder="e.g., 0.5">
                </div>
                <div class="form-group">
                    <label for="actualThickness">Actual Thickness [inches]</label>
                    <input type="number" id="actualThickness" class="form-input" min="0" step="0.01" placeholder="e.g., 0.4">
                </div>
                <div class="form-group">
                    <label for="timePeriod">Time Period [years]</label>
                    <input type="number" id="timePeriod" class="form-input" min="0" step="1" placeholder="e.g., 5">
                </div>
                
                <button class="calculate-btn" onclick="calculateLTCR()">Calculate LTCR</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Corrosion illustration">
                    <p>This tool will calculate the <strong>Long-Term Corrosion Rate</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Long-Term Corrosion Rate</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">inches per year</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>High</span><span>Very High</span><span>Extreme</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Corrosion Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
<div class="note-section">

  <!-- üìò ABOUT -->
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      The <strong>Long-Term Corrosion Rate Calculator</strong> determines the rate at which material thickness
      is reducing per year, helping assess material degradation over time and supporting predictive maintenance strategies.
    </p>
  </div>

  <!-- ‚öôÔ∏è PARAMETERS USED -->
  <div class="note-card">
    <h3>‚öôÔ∏è Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Initial Thickness:</strong> The thickness of the material when first measured (inches)</li>
      <li><strong>Actual Thickness:</strong> The current measured thickness of the material (inches)</li>
      <li><strong>Time Period:</strong> The duration between initial and current measurements (years)</li>
    </ul>
  </div>

  <!-- ‚úÖ INPUT VALIDATION RULES -->
  <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>Initial Thickness:</b> > 0, ‚â§ 10 in, up to 4 decimals</li>
      <li><b>Actual Thickness:</b> > 0, ‚â§ Initial Thickness, up to 4 decimals</li>
      <li><b>Time Period:</b> > 0, between 0.1 ‚Äì 100 years, up to 2 decimals</li>
      <li><b>Cross-check:</b> Actual Thickness cannot exceed Initial Thickness</li>
      <li><b>Safety Alert:</b> If thickness loss > 80%, flag warning (possible unsafe condition)</li>
      <li><b>Edge Cases:</b> Prevent division by zero, negative rates, or unrealistic corrosion (>0.1 in/yr)</li>
      <li><b>Units:</b> Thickness in inches, Time in years, LTCR in inches/year</li>
    </ul>
  </div>

  <!-- üßæ OUTPUT VALIDATIONS -->
  <div class="note-card">
    <h3>üßæ Output Validations</h3>
    <ul class="note-list">
      <li>The calculated LTCR is displayed along with feedback to interpret material condition.</li>
      <li><b>Assessment / Feedback Messages:</b></li>
      <ul class="note-sublist">
        <li>&lt; 0.002 ‚Üí ‚úÖ Low Corrosion Rate: Good condition. Regular monitoring recommended.</li>
        <li>0.002 ‚Äì 0.005 ‚Üí ‚ö†Ô∏è Moderate Corrosion Rate: Monitor more frequently and plan maintenance.</li>
        <li>0.005 ‚Äì 0.01 ‚Üí ‚ö†Ô∏è High Corrosion Rate: Inspection and preventive action needed soon.</li>
        <li>0.01 ‚Äì 0.02 ‚Üí ‚ùå Very High Corrosion Rate: Immediate inspection required.</li>
        <li>&gt; 0.02 ‚Üí ‚ùå Extreme Corrosion Rate: Immediate corrective action or replacement required.</li>
      </ul>
      <li>Feedback messages appear alongside the result to guide maintenance and safety actions.</li>
    </ul>
  </div>

  <!-- ‚öñÔ∏è GOVERNING PRINCIPLE -->
  <div class="note-card">
    <h3>‚öñÔ∏è Governing Principle</h3>
    <p>
      A Long-Term Corrosion Rate (LTCR) calculator is based on the API 510 standard, which provides guidelines 
      and formulas for calculating short-term and long-term corrosion rates used in determining remaining life 
      and inspection intervals for in-service pressure vessels.
    </p>
    <ul class="note-list">
      <li><strong>API 510 Standard:</strong> Developed by the American Society of Mechanical Engineers (ASME) for the in-service inspection, repair, alteration, and re-rating of pressure vessels.</li>
      <li><strong>Corrosion Rate Formulas:</strong> Specific formulas are provided to calculate long-term and short-term corrosion rates based on historical thickness measurements.</li>
      <li><strong>Purpose:</strong> Rates estimate metal loss over time, crucial for calculating remaining life of equipment and setting inspection schedules.</li>
      <li><strong>Application:</strong> API-certified inspectors, often with corrosion specialists, use these rates to predict future corrosion, especially when process conditions have changed.</li>
    </ul>
  </div>

  <!-- üèÅ CONCLUSION -->
  <div class="note-card">
    <h3>üèÅ Conclusion</h3>
    <p>
      This calculator provides a reliable LTCR metric with corresponding feedback messages that reflect material degradation. 
      By interpreting results according to the assessments, companies can plan maintenance, monitor component health, 
      and take timely corrective actions to ensure safety and structural integrity.
    </p>
  </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateLTCR() {
    const initialThickness = document.getElementById('initialThickness').value.trim();
    const actualThickness = document.getElementById('actualThickness').value.trim();
    const timePeriod = document.getElementById('timePeriod').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Validation Rules ---
    // 1. Required fields
    if (!initialThickness) errors.push("Initial Thickness is required.");
    if (!actualThickness) errors.push("Actual Thickness is required.");
    if (!timePeriod) errors.push("Time Period is required.");

    // Parse values
    const initial = parseFloat(initialThickness);
    const actual = parseFloat(actualThickness);
    const time = parseFloat(timePeriod);

    // 2. Numeric & positive
    if (initial <= 0 || isNaN(initial)) {
        errors.push("Initial Thickness must be a positive number > 0.");
    } else if (initial > 10) {
        errors.push("Initial Thickness should be ‚â§ 10 inches (per industrial practice).");
    }

    if (actual <= 0 || isNaN(actual)) {
        errors.push("Actual Thickness must be a positive number > 0.");
    } else if (actual > initial) {
        errors.push("Actual Thickness cannot exceed Initial Thickness.");
    }

    if (time <= 0 || isNaN(time)) {
        errors.push("Time Period must be a positive number > 0.");
    } else if (time < 0.1) {
        errors.push("Time Period too small (<0.1 year). Use longer interval for reliable measurement.");
    } else if (time > 100) {
        errors.push("Time Period should not exceed 100 years.");
    }

    // 3. Safety-specific checks
    if (initial && actual && (initial - actual) / initial > 0.8) {
        errors.push("Warning: More than 80% thickness loss detected. Component may be unsafe.");
    }

    // --- If errors, display ---
    if (errors.length > 0) {
        errorBox.classList.remove('hidden');
        resultValue.classList.add('hidden');
        placeholder.classList.add('hidden');
        errorMessage.innerHTML = errors.join('<br>');
        return;
    }

    // --- Calculation ---
    errorBox.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');

    const ltcr = (initial - actual) / time;

    // Output
    document.getElementById('rateValue').textContent = ltcr.toFixed(6);

    // --- Classification Logic ---
    const meterFill = document.getElementById('meterFill');
    const feedbackContent = document.getElementById('feedbackContent');

    let meterWidth = 0;
    let meterColor = '#2ecc71';
    let feedbackText = '';

    if (ltcr < 0.002) {
        meterWidth = 10;
        meterColor = '#2ecc71';
        feedbackText = "‚úÖ Low Corrosion Rate: Good condition. Regular monitoring recommended.";
    } else if (ltcr < 0.005) {
        meterWidth = 30;
        meterColor = '#f1c40f';
        feedbackText = "‚ö†Ô∏è Moderate Corrosion Rate: Monitor more frequently and plan maintenance.";
    } else if (ltcr < 0.01) {
        meterWidth = 60;
        meterColor = '#e67e22';
        feedbackText = "‚ö†Ô∏è High Corrosion Rate: Inspection and preventive action needed soon.";
    } else if (ltcr < 0.02) {
        meterWidth = 80;
        meterColor = '#e74c3c';
        feedbackText = "‚ùå Very High Corrosion Rate: Immediate inspection required.";
    } else {
        meterWidth = 100;
        meterColor = '#c0392b';
        feedbackText = "‚ùå Extreme Corrosion Rate: Immediate corrective action or replacement required.";
    }

    // Apply meter
    meterFill.style.width = meterWidth + '%';
    meterFill.style.background = meterColor;
    feedbackContent.innerHTML = feedbackText;
}


        function printReport() {
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

{% comment %} 
1. Formula (to keep in code as comment)
/*
Formula: Long-Term Corrosion Rate (LTCR)

LTCR = (Initial Thickness ‚Äì Actual Thickness) / Time Period

Where:
- Initial Thickness = baseline thickness when installed/first measured (inches)
- Actual Thickness = current measured thickness after exposure (inches)
- Time Period = years between measurements

Units: inches per year (in/yr)
*/

2. Input Validation Rules (Real-World QEHS Perspective)
Initial Thickness [inches]

Must be > 0 (cannot have zero or negative thickness).

Acceptable range: 0.01 ‚Äì 10 inches (per API/NACE; most industrial piping/walls <10").

Decimals allowed up to 4 places for precision.

Logical dependency: Must be greater than or equal to Actual Thickness.

Actual Thickness [inches]

Must be > 0.

Acceptable range: 0.001 ‚Äì Initial Thickness.

Cannot be greater than Initial Thickness.

Decimals allowed up to 4 places.

If thickness loss > 80% of initial, trigger warning, since component may already be unsafe.

Time Period [years]

Must be > 0 (no zero or negative).

Range: 0.1 ‚Äì 100 years (practical service life).

Decimals allowed up to 2 places (e.g., 0.25 years = 3 months).

Extremely small time periods (<0.1 yr) ‚Üí warning (measurement reliability low).

Cross-dependency: Time period must not be unreasonably small if material loss is very high (flag suspicious input).

3. Output Validation Logic & Thresholds

Corrosion Rate Classification (inches/year) ‚Äî aligned with NACE/API 570:

< 0.002 in/yr ‚Üí Low (safe, minimal monitoring).

0.002 ‚Äì 0.005 in/yr ‚Üí Moderate (monitoring frequency ‚Üë).

0.005 ‚Äì 0.01 in/yr ‚Üí High (schedule preventive maintenance).

0.01 ‚Äì 0.02 in/yr ‚Üí Very High (inspection and mitigation required).

> 0.02 in/yr ‚Üí Extreme (critical degradation, immediate action).

Validation:

Result must not be negative (handled by input rules).

Result should be displayed with 6 decimals for precision.

Warning if corrosion rate is unrealistically high (>0.1 in/yr) (likely bad input or catastrophic failure). {% endcomment %}