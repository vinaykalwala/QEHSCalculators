{% extends 'base.html' %}
{% block title %}Excavation Slope Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excavation Slope Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
              .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 480px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 480px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
            text-align: left;
        }
        
        .result-value p {
            margin: 12px 0;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .result-value span {
            font-weight: 600;
            color: #1560bd;
        }
        
        .soil-description {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .soil-description h4 {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .soil-description p { 
            color: #34495e; 
            margin: 8px 0;
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        .select-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
}

.form-select {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    appearance: none;            /* removes default arrow */
    -webkit-appearance: none;    /* for Safari */
    -moz-appearance: none;       /* for Firefox */
    background: #fff;
    font-size: 1rem;
    cursor: pointer;
}

/* Custom dropdown arrow */
.select-wrapper::after {
    content: "▼";   /* Unicode arrow */
    font-size: 0.9rem;
    color: #1560bd;
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none; /* lets clicks pass through */
}

    </style>
</head>
<body>
      <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Excavation Slope Calculator</h1>
            <p>Calculate the required slope for excavation based on soil type and dimensions</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="soil-type">Select Soil Type</label>
                     <div class="select-wrapper">
                    <select id="soil-type" class="form-select">
                        <option value="">-- Select Soil Type --</option>
                        <option value="a">Type A Soil</option>
                        <option value="b">Type B Soil</option>
                        <option value="c">Type C Soil</option>
                        <option value="d">Stable Rock</option>
                    </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="height">Height of Excavation (meters)</label>
                    <input type="number" id="height" class="form-input" min="0.1" max="6" step="0.1" placeholder="e.g., 3.5">
                </div>
                <div class="form-group">
                    <label for="width">Width of Excavation (meters)</label>
                    <input type="number" id="width" class="form-input" min="0.1" max="6" step="0.1" placeholder="e.g., 2.0">
                </div>
                
                <button class="calculate-btn" onclick="calculateSlope()">Calculate Slope Requirement</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Excavation Slope Requirements</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Excavation Slope Results</h2></div>
                    <p>Soil Type: <span id="resultSoilType"></span></p>
                    <p>Recommended Slope Ratio: <span id="resultSlopeRatio"></span></p>
                    <p>Slope Angle: <span id="resultSlopeAngle"></span></p>
                    <p>Top Width: <span id="resultTopWidth"></span></p>
                    
                    <div class="soil-description" id="soilDescription">
                        <h4>Soil Description</h4>
                        <p id="soilDescText"></p>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Excavation Slope Calculator</strong> helps determine the appropriate slope for excavation based on soil type and dimensions to ensure safety and prevent collapses.
                </p>
                <h3>❓ What is Excavation Slope?</h3>
                <p>Excavation slope refers to the angle at which the sides of an excavation are cut to prevent soil collapse. The required slope depends on soil type and is regulated by safety standards like OSHA.</p>

            </div>
            
          
            
            <div class="note-card">
    <h3>⚙️ Parameters Used</h3>
    <ul class="note-list">
        <li><strong>Soil Type:</strong> Classification based on cohesiveness and stability (A, B, C, or Stable Rock)</li><br>
        <h3>📊 Soil Types and Characteristics</h3>
        <h3>Type A Soil:</h3>
        <p><strong>Description:</strong> Cohesive soils with Unconfined Compressive Strength (UCS) ≥ 1.5 tsf (144 kPa). Examples: Clay, silty clay, cemented soils.</p>
        <p><strong>Examples:</strong> Clay, silty clay, sandy clay, clay loam, silty clay loam, sandy clay loam, cemented soils such as caliche and hardpan.</p>
        
        <h3>Type B Soil:</h3>
        <p><strong>Description:</strong> Cohesive soils with Unconfined Compressive Strength (UCS) 0.5–1.5 tsf. Examples: silt loam, angular gravel.</p>
        <p><strong>Examples:</strong> Angular gravel, silt, silt loam, sandy loam, silty clay loam, sandy clay loam.</p>
        
        <h3>Type C Soil:</h3>
        <p><strong>Description:</strong> Weak soils with Unconfined Compressive Strength (UCS) ≤ 0.5 tsf. Examples: sand, gravel, submerged soils.</p>
        <p><strong>Examples:</strong> Gravel, sand, loamy sand, submerged soil, or soil from which water is freely seeping.</p>
        
        <h3>Stable Rock:</h3>
        <p><strong>Description:</strong> Stable rock has a vertical height-to-depth ratio with a 90° slope angle.</p>
        <p><strong>Examples:</strong> Bedrock, unfractured rock.</p>

        <li><strong>Height of Excavation:</strong> Depth of the excavation (in meters)</li>
        <li><strong>Width of Excavation:</strong> Bottom width of the excavation (in meters)</li>
    </ul>
</div>

           <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <p>To ensure safe and accurate excavation slope calculations, all inputs are validated according to OSHA 29 CFR 1926 Subpart P and ISO 45001 excavation safety principles. Detailed rules are as follows:</p>
    <ul class="note-list">
        <li><strong>Soil Type:</strong> Must select one of the predefined soil types: Type A, Type B, Type C, or Stable Rock. This prevents invalid classifications that could result in unsafe slope recommendations. Stable Rock always has a vertical slope (90°).</li>
        <li><strong>Height of Excavation:</strong> Depth must be between 0.5 m and 6 m. Depths <0.5 m are allowed but will show a warning, as protective measures may not legally be required. Depths >6 m are disallowed in this calculator, as engineered protective systems are required beyond that. Height must be numeric, positive, and may include decimals (0.1 m resolution).</li>
        <li><strong>Width of Excavation:</strong> Bottom width must be between 0.5 m and 6 m. Widths below 0.5 m are impractical for safe access. Widths above 6 m require site-specific engineered design. Must be numeric, positive, and may include decimals (0.1 m resolution).</li>
        <li><strong>No Empty Fields:</strong> All inputs are mandatory. Calculation cannot proceed if any field is blank.</li>
        <li><strong>Stable Rock Handling:</strong> If Stable Rock is selected, slope ratio and angle are ignored, as sides are vertical. Top width = Bottom width.</li>
        <li><strong>Cross-field Consistency:</strong> Top width is always calculated as ≥ bottom width. For sloped soils, Top Width = Bottom Width + (2 × Height × Slope Ratio). Ensures geometric correctness and safety.</li>
        <li><strong>Edge Case Validations:</strong> 
            <ul>
                <li>Negative or zero values for height or width are invalid.</li>
                <li>Extremely shallow excavations (<0.5 m) are allowed but trigger a warning note.</li>
                <li>Decimals beyond one decimal place are rounded to 0.1 m resolution for calculation consistency.</li>
            </ul>
        </li>
      
    </ul>
    <p><b>Purpose:</b> These rules ensure that the calculator provides realistic, safe, and audit-compliant results for excavation planning.</p>
    <p><b>Regulatory Alignment:</b> The validations comply with <strong>OSHA 29 CFR 1926 Subpart P</strong> for excavation safety and <strong>ISO 45001</strong> occupational health and safety principles.</p>
</div>
<div class="note-card">
    <h3>📊 Output Validation</h3>
    <p>
        All excavation slope calculations are clearly presented and easy to interpret. Outputs are always audit-ready and user-friendly.
    </p>
    <ul class="note-list">
        <li><strong>Soil Type:</strong> Full description of the selected soil (Type A, B, C, or Stable Rock).</li>
        <li><strong>Slope Ratio:</strong> Calculated based on soil type, or <em>“Vertical – No slope required”</em> for Stable Rock.</li>
        <li><strong>Slope Angle:</strong> Displayed in degrees (°) according to soil classification.</li>
        <li><strong>Top Width:</strong> Always ≥ bottom width. Calculated as <em>Bottom Width + (2 × Height × Slope Ratio)</em>, except for Stable Rock where Top Width = Bottom Width.</li>
        <li><strong>Justification:</strong> Provides clear explanation for the recommended slope and top width.</li>
    </ul>
    <p>
        <strong>Purpose:</strong> Ensures all results are safe, realistic, and clearly documented for practical use.
    </p>
</div>

<div class="note-card">
    <h3>📏 Governing Principle</h3>
    <p>
        An <strong>Excavation Slope Calculator</strong> is not tied to a single standard but is used in accordance with multiple national and international standards to ensure safe excavation practices. The key standards informing safe slope determination include:
    </p>
    <ul class="note-list">
        <li><strong>OSHA Excavation Standard (United States):</strong> Part of the Occupational Safety and Health Act of 1970, this standard provides regulations for safe working conditions, including specific guidelines for sloping and benching based on soil type (Types A, B, C, etc.).</li>
        <li><strong>IS 3764 (Indian Standard):</strong> Establishes requirements for carrying out excavation work safely, covering various excavation types such as trenches, cellars, and borrow pits.</li>
        <li><strong>DIN 4124 (German Standard):</strong> Provides clear guidelines for safe slope angles in excavations, emphasizing soil type, groundwater, and surrounding loads.</li>
    </ul>
    <p>
        <h3>Application of Standards via Calculators:</h3>
    </p>
    <ul class="note-list">
        <li><strong>Determining Maximum Safe Slopes:</strong> Using soil classification (Type A, B, C), the calculator provides the allowable slope angle or height-to-depth ratio to prevent collapse.</li>
        <li><strong>Ensuring Compliance:</strong> By entering project-specific data, the calculator verifies that the excavation design meets OSHA, IS 3764, or DIN 4124 safety requirements.</li>
        <li><strong>Assessing Risk:</strong> Helps evaluate collapse risks by identifying slopes that are too steep (dangerous) or too shallow (inefficient).</li>
    </ul>
    <p>
        Using these principles, the excavation slope calculator acts as a practical, audit-ready tool for engineers and safety professionals to design excavations that prioritize worker safety and regulatory compliance.
    </p>
</div>

            
          <div class="note-card">
    <h3>🏁 Conclusion</h3>
    <p>
        The <strong>Excavation Slope Calculator</strong> helps determine safe excavation slopes based on soil type, height, and bottom width. It ensures worker safety, prevents wall collapses, and supports compliance with <strong>OSHA 29 CFR 1926 Subpart P</strong> and <strong>ISO 45001</strong> standards. The tool provides clear, soil-specific guidance and audit-ready results for practical use on construction sites.
    </p>
</div>


        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateSlope() {
    const soilType = document.getElementById('soil-type').value;
    const height = document.getElementById('height').value.trim();
    const width = document.getElementById('width').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // ============================
    // VALIDATION RULES (OSHA/ISO)
    // ============================

    // Soil Type validation
    if (!soilType) {
        errors.push("👉 Soil type must be selected (A, B, C, or Stable Rock).");
    }

    // Height validation
    if (height === "") {
        errors.push("👉 Excavation height (depth) is required.");
    } else {
        const h = parseFloat(height);
        if (isNaN(h) || h <= 0) {
            errors.push("👉 Height of Excavation must be a number greater than 0.");
        } else if (h < 0.5) {
            errors.push("⚠️ Height of Excavation is very shallow (<0.5 m). Excavation may not need sloping but calculation allowed.");
        } else if (h > 6) {
            errors.push("👉 Height of Excavation cannot exceed 6 meters without engineered protective system (OSHA rule).");
        }
    }

    // Width validation
    if (width === "") {
        errors.push("👉 Excavation bottom width is required.");
    } else {
        const w = parseFloat(width);
        if (isNaN(w) || w <= 0) {
            errors.push("👉Width of Excavation  must be a number greater than 0.");
        } else if (w < 0.5) {
            errors.push("👉 Bottom width must be at least 0.5 meters (practical safety limit).");
        } else if (w > 6) {
            errors.push("👉 Width of Excavation  cannot exceed 6 meters in this calculator.");
        }
    }

    // ============================
    // ERROR HANDLING
    // ============================
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ============================
    // CALCULATION
    // ============================
    const H = parseFloat(height);
    const W = parseFloat(width);
    
    let slopeRatio, slopeAngle, soilTypeName, soilDescription;
    
    switch(soilType) {
        case "a":
            slopeRatio = 0.75;
            slopeAngle = 53;
            soilTypeName = "Type A Soil";
            soilDescription = "Cohesive soils with UCS ≥ 1.5 tsf (144 kPa). Examples: Clay, silty clay, cemented soils.";
            break;
        case "b":
            slopeRatio = 1;
            slopeAngle = 45;
            soilTypeName = "Type B Soil";
            soilDescription = "Cohesive soils with UCS 0.5–1.5 tsf. Examples: silt loam, angular gravel.";
            break;
        case "c":
            slopeRatio = 1.5;
            slopeAngle = 34;
            soilTypeName = "Type C Soil";
            soilDescription = "Weak soils with UCS ≤ 0.5 tsf. Examples: sand, gravel, submerged soils.";
            break;
        case "d":
            slopeRatio = 0;
            slopeAngle = 90;
            soilTypeName = "Stable Rock";
            soilDescription = "Unfractured bedrock. Can be cut vertically.";
            break;
        default:
            errorMessage.innerHTML = "❌ Invalid soil type selected.";
            errorBox.classList.remove("hidden");
            resultValue.classList.add("hidden");
            return;
    }
    
    // Calculate top width
    let topWidth;
    if (soilType === "d") {
        topWidth = W; // Stable rock has vertical sides
    } else {
        topWidth = (2 * H * slopeRatio) + W;
    }

    // ============================
    // DISPLAY RESULTS
    // ============================
    document.getElementById('resultSoilType').textContent = soilTypeName;
    
    if (soilType === "d") {
        document.getElementById('resultSlopeRatio').textContent = "Vertical (0:1) - No slope required";
        document.getElementById('resultTopWidth').textContent = W.toFixed(2) + " meters (same as bottom width)";
    } else {
        document.getElementById('resultSlopeRatio').textContent = slopeRatio + ":1";
        document.getElementById('resultTopWidth').textContent = topWidth.toFixed(2) + " meters";
    }
    
    document.getElementById('resultSlopeAngle').textContent = slopeAngle + "°";
    document.getElementById('soilDescText').textContent = soilDescription;
    
    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}




{% comment %} 
1. Formula & Calculation Logic

According to OSHA 29 CFR 1926 Subpart P (Excavations):

Type A Soil → Slope ¾H:1V (≈53°)

Type B Soil → Slope 1H:1V (45°)

Type C Soil → Slope 1½H:1V (≈34°)

Stable Rock → Vertical wall (90°)

Top Width Formula:

Top Width = Bottom Width + (2 × Height × Slope Ratio)


(Except Stable Rock, where Top Width = Bottom Width)

2. Input Validation Rules (QEHS-Compliant)
Soil Type

Must be one of: A, B, C, Stable Rock.

Mandatory field (cannot be empty).

Prevents invalid classification that could lead to collapse.

Height (Excavation Depth in meters)

Minimum: 0.5 m (practical safety threshold; OSHA requires protective measures at >1.2 m, but calculators must handle smaller).

Maximum: 6 m (standard max for simple sloping; >6 m usually requires engineering design).

Decimals allowed: Up to 1 decimal place (0.1 m resolution).

Must be numeric, positive, and realistic.

If depth < 1.2 m → warning note that protective measures may not be legally required, but calculator still works.

Width (Bottom Width in meters)

Minimum: 0.5 m (anything less is impractical/unusable).

Maximum: 6 m (beyond this requires site-specific design).

Decimals allowed: Up to 1 decimal place.

Must be numeric, positive, and realistic.

Cross-field Dependencies

If Soil = Stable Rock → ignore slope ratio and angle (always vertical).

Top width must always be ≥ bottom width.

3. Edge Case Validations

Empty fields → Show error before calculation.

Negative or zero values → Reject as invalid.

Height = 0 → Not a valid excavation.

Width = 0 → Unsafe/impossible trench.

Extremely shallow (<0.5 m) → Allow, but add warning note.

Stable Rock + slope ratio → Force slope = vertical.

4. Output Validation

Outputs must always show:

Soil type (full description).

Slope ratio (or “Vertical – No slope required”).

Slope angle (°).

Top width (≥ bottom width).

OSHA/ISO justification (for audits).

5. Corrected JavaScript with Validation Comments

Here’s an updated version of your validation logic (with OSHA/QEHS comments for future reference):

/*
========================================
Excavation Slope Calculator Validations
Author: QEHS/Fire Safety Expert
Standards: OSHA 29 CFR 1926 Subpart P, ISO 45001
Formula: TopWidth = BottomWidth + (2 × Height × SlopeRatio)
Slope Ratios:
  Type A: 0.75H:1V (≈53°)
  Type B: 1H:1V (45°)
  Type C: 1.5H:1V (≈34°)
  Stable Rock: Vertical (90°)
========================================
*/ {% endcomment %}