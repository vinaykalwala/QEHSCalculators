{% extends 'base.html' %}
{% block title %}Average Individual Risk Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Average Individual Risk Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            {% comment %} display: flex; {% endcomment %}
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Average Individual Risk Calculator</h1>
            <p>Calculate the probability of fatality for an individual within an exposed population</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="fatalities">Number of Fatalities</label>
                    <input type="number" id="fatalities" class="form-input" min="0" placeholder="e.g., 5">
                </div>
                <div class="form-group">
                    <label for="population">Population at Risk</label>
                    <input type="number" id="population" class="form-input" min="1" placeholder="e.g., 10000">
                </div>
                
                <button class="calculate-btn" onclick="calculateRisk()">Calculate Risk</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Average Individual Risk</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:30px;">
                        <h2>Average Individual Risk</h2>
                    </div>
                    <div class="rate-display">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Probability of fatality per individual</div></div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>High</span><span>Very High</span><span>Extreme</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Risk Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

<!-- Notes Section -->
<!-- Notes Section -->
<div class="note-section">

    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Average Individual Risk Calculator</strong> measures the probability of fatality 
            for an individual within an exposed population, providing a standardized way to compare 
            risks across different scenarios such as workplace safety, public health, transportation, 
            and emergency planning.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Number of Fatalities (F):</strong> Total deaths occurring in the population.</li>
            <li><strong>Population at Risk (P):</strong> Total number of people exposed to the hazard.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><b>Fatalities:</b> Integer, 0 – 1,000,000 (cannot exceed population).</li>
            <li><b>Population:</b> Integer, 1 – 1,000,000,000.</li>
            <li><b>Cross-check:</b> Fatalities ≤ Population.</li>
            <li><b>Units:</b> Both values represent counts of people (no decimals allowed).</li>
            <li><b>Compliance:</b> Validations follow ISO 31000, OSHA, NFPA, and EPA thresholds.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <p>
            The <strong>Average Individual Risk</strong> is interpreted using the same thresholds and 
            feedback displayed in the results section:
        </p>
        <ul class="note-list">
            <li><strong>R = 0:</strong> ✅ Zero fatalities reported – excellent safety record.</li>
            <li><strong>R &lt; 0.001:</strong> ✅ Low risk – within typical safety thresholds.</li>
            <li><strong>0.001 ≤ R &lt; 0.01:</strong> 🔵 Moderate risk – consider safety enhancements.</li>
            <li><strong>0.01 ≤ R &lt; 0.1:</strong> ⚠️ High risk – significant safety improvements needed.</li>
            <li><strong>R ≥ 0.1:</strong> ❌ Extremely high risk – immediate intervention required.</li>
        </ul>
        <p>
            Additionally, results are expressed as <b>risk per 100,000 people</b> for epidemiological and safety benchmarks.
        </p>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📚 Governing Principle</h3>
        <p>
            While a generic "Average Individual Risk Calculator" isn't tied to a single standard, different risk calculators for specific purposes are based on varying standards from different organizations. For a definitive answer, the type of risk being calculated must be specified.
        </p>
        <p><strong>Common types of average individual risk calculators:</strong></p>
        <ul class="note-list">
            <li><b style="color: #1976d2;">Cardiovascular disease (CVD) risk calculator</b><br>
                • WHO/ISH Risk Prediction Charts (2019 update)<br>
                • ACC/AHA ASCVD Risk Estimator Plus<br>
                • Framingham Heart Study Risk Functions
            </li>
            <li><b style="color: #1976d2;">Workplace individual risk calculator</b><br>
                • ISO 31000 Risk Management Guidelines<br>
                • Health and Safety Executive (HSE) 5-Step Risk Assessment Methodology
            </li>
            <li><b style="color: #1976d2;">Airborne infection risk calculator (AIRC)</b><br>
                • Based on ASHRAE Standards for air quality and aerosol transmission.
            </li>
            <li><b style="color: #1976d2;">Engineering and safety risk calculators</b><br>
                • Quantitative Risk Assessment (QRA) frameworks<br>
                • IEC/ISO 31010 Risk Assessment Techniques
            </li>
        </ul>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>🧾 Conclusion</h3>
        <p>
            The <strong>Average Individual Risk Calculator</strong> provides a quick and quantitative understanding 
            of safety and exposure levels. It aligns with key principles from ISO 31000, OSHA, and NFPA standards 
            to promote proactive risk management.  
            Whether applied to engineering, healthcare, or public safety, this tool supports data-driven decisions 
            that minimize hazards and enhance human protection.
        </p>
    </div>

</div>



    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
function calculateRisk() {
    const fatalities = document.getElementById('fatalities').value.trim();
    const population = document.getElementById('population').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Validation Rules (based on ISO 31000, OSHA, NFPA) ---
    // Fatalities
    if (fatalities === "" || isNaN(fatalities)) {
        errors.push("👉 Please enter the number of fatalities.");
    } else if (!Number.isInteger(parseFloat(fatalities))) {
        errors.push("👉 Fatalities must be a whole number (no decimals).");
    } else if (parseInt(fatalities) < 0) {
        errors.push("👉 Fatalities cannot be negative.");
    } else if (parseInt(fatalities) > 1000000) {
        errors.push("👉 Fatalities cannot exceed 1,000,000 (out of range).");
    }

    // Population
    if (population === "" || isNaN(population)) {
        errors.push("👉 Please enter the population at risk.");
    } else if (!Number.isInteger(parseFloat(population))) {
        errors.push("👉 Population must be a whole number (no decimals).");
    } else if (parseInt(population) <= 0) {
        errors.push("👉 Population must be greater than 0.");
    } else if (parseInt(population) > 1000000000) {
        errors.push("👉 Population cannot exceed 1,000,000,000 (out of range).");
    }

    // Cross-field dependency
    if (fatalities !== "" && population !== "" && parseInt(fatalities) > parseInt(population)) {
        errors.push("👉 Fatalities cannot exceed population.");
    }

    // --- Error Handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Safe Calculations ---
    const numFatalities = parseInt(fatalities);
    const pop = parseInt(population);

    // Formula: R = F / P
    const risk = numFatalities / pop;
    const riskPer100k = risk * 100000;

    document.getElementById('rateValue').textContent = risk.toFixed(6);

    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;
    
    // --- Output thresholds ---
    if (risk === 0) {
        meterWidth = '5%'; 
        meterColor = '#27ae60';
        feedback = '✅ Zero fatalities reported - excellent safety record.';
    } else if (risk < 0.001) {
        meterWidth = '20%'; 
        meterColor = '#2ecc71';
        feedback = '✅ Low risk - within typical safety thresholds.';
    } else if (risk < 0.01) {
        meterWidth = '40%'; 
        meterColor = '#f1c40f';
        feedback = '🔵 Moderate risk - consider safety enhancements.';
    } else if (risk < 0.1) {
        meterWidth = '65%'; 
        meterColor = '#e67e22';
        feedback = '⚠️ High risk - significant safety improvements needed.';
    } else {
        meterWidth = '95%'; 
        meterColor = '#e74c3c';
        feedback = '❌ Extremely high risk - immediate intervention required.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;

    // Add contextual risk info
    feedback += `<br><br>Risk per 100,000 people: ${riskPer100k.toFixed(2)}`;
    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}

{% comment %} 
1. Formula Analysis (QEHS / Fire Safety)

📌 Formula:

𝑅
=
𝐹
𝑃
R=
P
F
	​


Where:

R = Average Individual Risk (probability of fatality per person)

F = Number of fatalities (integer, ≥ 0)

P = Population at risk (integer, > 0)

📌 Derived Output:

𝑅
100
𝑘
=
𝑅
×
100
,
000
R
100k
	​

=R×100,000

This expresses risk per 100,000 people (commonly used in epidemiology, OSHA reports, NFPA safety benchmarks).

2. Input Validation Rules (Based on Industry Practice)
Fatalities

Type: Integer (no decimals).

Range: 0 – 1,000,000 (upper bound to avoid unrealistic data entry).

Logic: Cannot be negative, cannot exceed the population.

Population at Risk

Type: Integer.

Range: 1 – 1,000,000,000 (to cover cities, national populations, but prevent nonsense entries).

Logic: Must be greater than 0.

Cross-Field Dependency

Fatalities ≤ Population.

If Fatalities = Population → Risk = 1 (100%) → must show as Extreme / Catastrophic.

3. Output Validation & Thresholds

🔎 Based on ISO 31000, OSHA, EPA guidelines:

Risk Value (R)	Risk per 100k	Category	Interpretation
0	0	Zero Risk	No fatalities recorded
< 0.001	< 100	Low Risk	Acceptable, within OSHA thresholds
0.001 – 0.01	100 – 1,000	Moderate Risk	Needs monitoring
0.01 – 0.1	1,000 – 10,000	High Risk	Safety improvements required
> 0.1	> 10,000	Extreme Risk	Not acceptable – immediate action {% endcomment %}