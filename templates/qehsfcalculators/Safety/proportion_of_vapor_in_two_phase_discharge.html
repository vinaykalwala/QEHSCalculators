{% extends 'base.html' %}
{% block title %}Proportion of Vapor in Two-Phase Discharge Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Proportion of Vapor in Two-Phase Discharge</h1>
        <p>Estimate the vapor fraction in a fluid after expansion through a valve or pressure reduction system.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="hf1">Enthalpy of Liquid Before Valve (h<sub>f1</sub>) (kJ/kg)</label>
                <input type="number" id="hf1" class="form-input" min="0" placeholder="e.g., 300">
            </div>
            <div class="form-group">
                <label for="hf2">Enthalpy of Liquid After Valve (h<sub>f2</sub>) (kJ/kg)</label>
                <input type="number" id="hf2" class="form-input" min="0" placeholder="e.g., 250">
            </div>
            <div class="form-group">
                <label for="hfg2">Enthalpy of Evaporation After Valve (h<sub>fg2</sub>) (kJ/kg)</label>
                <input type="number" id="hfg2" class="form-input" min="0" placeholder="e.g., 200">
            </div>
            
            <button class="calculate-btn" onclick="calculateVaporProportion()">Calculate Vapor Proportion (n)</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Phase illustration">
                <p>This tool will calculate the <strong>Proportion of Vapor (n)</strong>. Enter your data to see results and insights here.</p>
            </div>
            
            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>
            
            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Vapor Proportion Result</h2>
                </div>
                <div class="rate-value" id="vaporProportionValue">0.0000</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">
                    fraction of vapor in the discharge
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Phase Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
        The <strong>Proportion of Vapor Calculator</strong> is a specialized tool designed for engineers, process operators, and safety professionals to estimate the fraction of a liquid that converts into vapor in a two-phase discharge scenario. 
    </p>
    <p>
        This situation commonly occurs in steam systems, pressure-reducing valves, safety relief valves, and industrial processes where a fluid undergoes rapid expansion. Understanding the vapor fraction is crucial for optimizing system efficiency, ensuring safety, and preventing equipment damage due to unexpected phase changes.
    </p>
    <p>
        By analyzing the energy changes before and after expansion, this calculator provides insights into the physical behavior of the fluid without requiring manual calculations or complex thermodynamic charts. 
        It helps users make informed decisions on process control, equipment design, and operational safety.
    </p>
    <p>
        Key applications include:
        <ul>
            <li>Design and sizing of safety and relief valves to handle expected vapor formation.</li>
            <li>Evaluation of boiler, turbine, or refrigeration system performance.</li>
            <li>Predicting and mitigating risks associated with flashing, cavitation, or two-phase flow in pipelines.</li>
            <li>Improving energy efficiency by understanding phase change dynamics in thermal systems.</li>
        </ul>
    </p>
</div>

        <div class="note-card">
            <h3>❓ What is Proportion of Vapor?</h3>
            <p>
                It is a measure of how much of the liquid has transformed into vapor in a two-phase discharge system. This metric is essential for analyzing steam flow, pressure relief devices, and phase-change processes.
            </p>
        </div>
        <div class="note-card">
            <h3>⚙️ Parameters Used</h3>
            <ul class="note-list">
                <li><strong>Enthalpy Before Valve (h<sub>f1</sub>):</strong> Energy content of the liquid before expansion.</li>
                <li><strong>Enthalpy After Valve (h<sub>f2</sub>):</strong> Energy content of the remaining liquid after expansion.</li>
                <li><strong>Evaporation Enthalpy (h<sub>fg2</sub>):</strong> Energy needed to convert the remaining liquid into vapor.</li>
            </ul>
        </div>
               
       <div class="note-card">
    <h3>📊 Interpretation</h3>
    <ul class="note-list">
        <li><span class="good">0</span> → Fully liquid: no vapor formed. System is safe, no flashing or vapor-related risk.</li>
        <li><span class="average">0 &lt; n &lt; 1</span> → Two-phase mixture: partial vaporization. Normal in controlled expansions; ensure pressure relief devices can handle mixed phase.</li>
        <li><span class="bad">1</span> → Fully vaporized: all liquid converted to vapor. High vapor fraction; verify equipment limits and potential pressure spikes.</li>
        <li><span class="warning">n &lt; 0 or n &gt; 1</span> → Physically unrealistic. Inputs may be inconsistent; check enthalpy values and units before proceeding.</li>
    </ul>
</div>

<div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>hf1 (Enthalpy Before Valve):</strong> Must be a positive number and greater than hf2. Ensures energy decreases during expansion.</li>
        <li><strong>hf2 (Enthalpy After Valve):</strong> Must be a positive number and less than hf1. Prevents physically impossible outcomes.</li>
        <li><strong>hfg2 (Evaporation Enthalpy):</strong> Must be positive. Avoids division by zero and ensures meaningful vapor fraction calculation.</li>
        <li><strong>Check resulting n:</strong> Should always be between 0 and 1. Values outside this range indicate inconsistent inputs or unrealistic scenarios.</li>
        <li><strong>Extreme Value Checks:</strong> hf1 or hfg2 unusually high (e.g., >5000 kJ/kg) should trigger a warning to verify units and fluid type.</li>
        <li><strong>Cross-field consistency:</strong> hf1 > hf2, and all values >0; ensures calculations comply with thermodynamic and QEHS standards.</li>
    </ul>
</div>

        <div class="note-card">
            <h3>💡 Important Note</h3>
            <p>
                Understanding vapor proportion helps in designing safety valves, controlling phase changes in steam systems, and ensuring efficiency in industrial processes without exposing the process to unsafe operating conditions.
            </p>
        </div>
    </div>
</div>

<script>
function calculateVaporProportion() {
    const hf1 = parseFloat(document.getElementById("hf1").value);
    const hf2 = parseFloat(document.getElementById("hf2").value);
    const hfg2 = parseFloat(document.getElementById("hfg2").value);

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const feedbackContent = document.getElementById('feedbackContent');

    let errors = [];

    // Basic validations
    if (isNaN(hf1) || hf1 <= 0) errors.push("👉 hf1 must be a positive number.");
    if (isNaN(hf2) || hf2 <= 0) errors.push("👉 hf2 must be a positive number.");
    if (isNaN(hfg2) || hfg2 <= 0) errors.push("👉 hfg2 must be a positive number.");

    // Logical validations
    if (!isNaN(hf1) && !isNaN(hf2) && hf1 <= hf2) {
        errors.push("👉 hf1 must be greater than hf2.");
    }

    // Extreme value checks (industry guidelines / audit perspective)
    if (hf1 > 5000) errors.push("⚠️ hf1 unusually high; verify units and fluid type.");
    if (hfg2 > 3000) errors.push("⚠️ hfg2 unusually high; verify units and fluid type.");

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Calculate n
    const n = (hf1 - hf2) / hfg2;

    // Output feedback
    let feedback = "";
    let color = "";

    if (n < 0 || n > 1) {
        feedback = "❌ Invalid result: Check input values.";
        color = "red";
    } else if (n === 0) {
        feedback = "💧 Fully liquid: no vapor formed.";
        color = "blue";
    } else if (n > 0 && n < 1) {
        feedback = "🌫️ Two-phase mixture: partial vaporization.";
        color = "green";
    } else if (n === 1) {
        feedback = "🔥 Fully vaporized: all liquid converted to vapor.";
        color = "orange";
    }

    document.getElementById('vaporProportionValue').textContent = n.toFixed(4);
    feedbackContent.innerHTML = `<strong style="color:${color}">${feedback}</strong>`;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Detailed Input Validation Rules (QEHS Perspective)
Input	Unit	Acceptable Range	Notes / Compliance Reason
hf1 – Enthalpy of liquid before valve	kJ/kg	>0, typically 50–5000 kJ/kg depending on fluid	Must be positive; ensures meaningful thermodynamic state. Negative or zero values are physically impossible and could mislead hazard assessments.
hf2 – Enthalpy of liquid after valve	kJ/kg	>0, <hf1	hf2 must be smaller than hf1 (energy decreases after expansion). Ensures energy balance and avoids unrealistic negative vapor fractions.
hfg2 – Enthalpy of vaporization after valve	kJ/kg	>0, realistic upper limit depends on fluid (e.g., 50–3000 kJ/kg for water/steam)	Must be positive; division by zero would invalidate calculation. Prevents unrealistic vapor fractions and ensures safety design inputs are correct.
Cross-field Dependencies

hf1 must always be greater than hf2.

Resulting n = (hf1 − hf2)/hfg2 must be between 0 and 1; values outside indicate input inconsistencies.

2. Output Validation Logic and Thresholds

n < 0: Physically impossible; indicates incorrect inputs.

0 ≤ n < 1: Valid two-phase mixture; partial vaporization.

n = 0: Fully liquid; no vapor formed.

n = 1: Fully vaporized; liquid entirely converted to vapor.

n > 1: Impossible; check input values.

Compliance Perspective:
Ensures that calculated KPIs (vapor fraction) are realistic, which is critical in safety valve sizing, two-phase flow hazard analysis, and process audits. Unrealistic values can lead to unsafe process conditions or noncompliance with NFPA, OSHA, or ISO 45001 requirements.

3. Edge Case Validations

Division by zero: If hfg2 ≤ 0 → reject calculation.

hf1 ≤ hf2 → reject; violates physical laws of energy reduction during expansion.

n < 0 or n > 1 → warning: check inputs.

Extremely high or low inputs (outliers): flag for verification. For example:

hf1 > 5000 kJ/kg (for water/steam) → unusual

hfg2 > 3000 kJ/kg → may indicate wrong units or fluid selection

Why: Prevents unsafe assumptions, protects equipment and personnel, ensures compliance with safety standards. -->