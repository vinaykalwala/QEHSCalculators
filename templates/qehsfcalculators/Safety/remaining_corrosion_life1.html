{% extends 'base.html' %}
{% block title %}Remaining Corrosion Life Calculator (1){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Required Opening Force For A Balanced Safety Valve  Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 350px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        @media (max-width: 768px) {
    .result-placeholder img {
        max-width: 80%;    /* Slightly smaller on tablets */
    }
}

@media (max-width: 480px) {
    .result-placeholder img {
        max-width: 100%;   /* Full width on small screens */
        margin-bottom: 15px;
    }
}
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
 <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Remaining Corrosion Life Calculator (1)</h1>
        <p>Calculate the <strong>Remaining Life (years)</strong> of a material based on its corrosion allowance and corrosion rate.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="remainingAllowance">Remaining Corrosion Allowance [inches]</label>
                <input type="number" id="remainingAllowance" class="form-input" min="0" step="any" placeholder="e.g., 0.5">
            </div>

            <div class="form-group">
                <label for="corrosionRate">Corrosion Rate [inches/year]</label>
                <input type="number" id="corrosionRate" class="form-input" min="0" step="any" placeholder="e.g., 0.05">
            </div>

            <button class="calculate-btn" onclick="calculateRemainingLife()">Calculate Remaining Life</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/corrosion.webp' %}" alt="Corrosion illustration">
                <p>This tool will calculate the <strong>Remaining Life</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">‚ùå</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Remaining Life Result</h2>
                </div>
                <div class="rate-value" id="lifeValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Years</div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
       <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
        The <strong>Remaining Corrosion Life Calculator</strong> provides an estimate of the remaining service life of metallic equipment and structures based on their current corrosion condition. By considering the existing material thickness and the expected corrosion rate, this tool helps engineers and maintenance teams make informed decisions about inspections, maintenance schedules, and replacements. Accurate assessment of remaining life is crucial for ensuring structural integrity, operational safety, and regulatory compliance, while also minimizing the risk of unexpected failures and optimizing operational costs. This calculator is widely applicable across industries including oil & gas, chemical processing, marine, and infrastructure, where corrosion can significantly impact equipment performance and safety.
    </p>
</div>

      <div class="note-card">
    <h3>‚öôÔ∏è Parameters Used</h3>
    <ul class="note-list">
        <li><strong>Remaining Corrosion Allowance:</strong> Represents the thickness of material still available before reaching its minimum safe limit, indicating how much the component can endure further degradation.</li>
        <li><strong>Corrosion Rate:</strong> Reflects the speed at which the material is deteriorating due to corrosion, based on historical data or industry-standard predictions.</li>
        <li><strong>Remaining Life:</strong> Provides an estimate of how long the material is expected to safely perform under current conditions, helping prioritize maintenance and replacement planning.</li>
    </ul>
</div>


      <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Remaining Corrosion Allowance:</strong> Must be numeric, ‚â• 0 and ‚â§ 5 inches; negative or excessively high values are physically unrealistic and may indicate unit errors or incorrect design.</li>
        <li><strong>Corrosion Rate:</strong> Must be numeric, > 0 and ‚â§ 0.5 inches/year; zero, negative, or extremely high values indicate non-physical or abnormal conditions.</li>
        <li><strong>Cross-field Check:</strong> Calculated Remaining Life should not exceed 50 years; values beyond this range may indicate inconsistent or incorrect input combinations.</li>
    </ul>
    <br>
    <h3>üí° Allowed Decimals</h3>
    <ul class="note-list">
        <li>Remaining Corrosion Allowance and Corrosion Rate ‚Üí up to 2 decimal places to reflect measurement precision and industry standards.</li>
    </ul>
</div>

<div class="note-card">
    <h3>üìä Output Validations</h3>
    <ul class="note-list">
        <li><strong>&gt; 10 years (Long Remaining  Life):</strong>
            <ul>
                <li>‚úÖ Assessment: Material is in good condition.</li>
                <li><em>Maintenance Rationale:</em> Routine inspections sufficient; aligns with standard inspection intervals (API 581, ISO 15156).</li>
            </ul>
        </li>

        <li><strong>5 ‚Äì 10 years (Moderate Remaining  Life):</strong>
            <ul>
                <li>‚ö†Ô∏è Assessment: Monitor and plan maintenance in advance.</li>
                <li><em>Maintenance Rationale:</em> Ensures safety margins and avoids unexpected failures; supports proactive risk-based inspection (RBI) methodology.</li>
            </ul>
        </li>

        <li><strong>2 ‚Äì 5 years (Short Remaining  Life):</strong>
            <ul>
                <li>‚ö†Ô∏è Assessment: Immediate planning required; prioritize inspections and maintenance.</li>
                <li><em>Maintenance Rationale:</em> Ensures personnel safety and regulatory compliance; prevents potential structural failures.</li>
            </ul>
        </li>

        <li><strong>&lt; 2 years (Critical Remaining  Life):</strong>
            <ul>
                <li>‚ùå Assessment: Urgent repair or replacement required; high risk of catastrophic failure.</li>
                <li><em>Maintenance Rationale:</em> Immediate action required to comply with OSHA, NFPA, and industrial safety standards.</li>
            </ul>
        </li>
    </ul>
</div>


        <div class="note-card">
            <h3>üìè Standards & Compliance</h3>
            <p>
                This calculation aligns with industrial safety and predictive maintenance standards, including:
            </p>
            <ul class="note-list">
                <li><strong>API 581</strong> ‚Äì Risk-Based Inspection for Equipment Integrity</li>
                <li><strong>ASME B31.3/B31.1</strong> ‚Äì Process Piping Integrity Guidelines</li>
                <li><strong>NACE MR0175/ISO 15156</strong> ‚Äì Materials for Corrosion Resistance</li>
                <li><strong>OSHA & NFPA Guidelines</strong> ‚Äì Safety compliance for industrial plants</li>
            </ul>
        </div>

        <div class="note-card">
            <h3>Conclusion</h3>
            <p>
                Regular monitoring and calculation of <strong>remaining corrosion life</strong> ensures prolonged service life, safety compliance, and reduced risk of structural failures. Timely maintenance or replacement is critical for plant reliability.
            </p>
        </div>
    </div>
</div>

<script>
function calculateRemainingLife() {
    const remainingAllowance = parseFloat(document.getElementById("remainingAllowance").value);
    const corrosionRate = parseFloat(document.getElementById("corrosionRate").value);

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

   // Input validations
if (isNaN(remainingAllowance)) 
    errors.push("üëâ Remaining Corrosion Allowance must be numeric (0 ‚Äì 5 inches).");
else if (remainingAllowance < 0) 
    errors.push("üëâ Remaining Corrosion Allowance cannot be negative (min 0 inches).");
else if (remainingAllowance > 5) 
    errors.push("‚ö†Ô∏è Remaining Corrosion Allowance unusually high; expected range: 0 ‚Äì 5 inches. Verify units/design.");

if (isNaN(corrosionRate)) 
    errors.push("üëâ Corrosion Rate must be numeric (>0 ‚Äì 0.5 inches/year).");
else if (corrosionRate <= 0) 
    errors.push("üëâ Corrosion Rate must be greater than 0 inches/year.");
else if (corrosionRate > 0.5) 
    errors.push("‚ö†Ô∏è Corrosion Rate unusually high; expected range: 0 ‚Äì 0.5 inches/year. Verify measurements or input units.");

// Cross-field validation: unrealistic life
if (!isNaN(remainingAllowance) && !isNaN(corrosionRate) && corrosionRate > 0) {
    const estimatedLife = remainingAllowance / corrosionRate;
    if (estimatedLife > 50) 
        errors.push(`‚ö†Ô∏è Calculated Remaining Life (${estimatedLife.toFixed(2)} years) exceeds industrial plausibility (>50 years). Check Remaining Corrosion Allowance and Corrosion Rate inputs.`);
}

    // Display errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }
 
    // Calculation
    const remainingLife = remainingAllowance / corrosionRate;
    document.getElementById('lifeValue').textContent = remainingLife.toFixed(2);

    // Feedback
    let feedback = "";
    let feedbackColor = "black";
    if (remainingLife > 10) {
        feedback = "‚úÖ <strong>Long Remaining Life:</strong> Material is in good condition.";
        feedbackColor = "green";
    } else if (remainingLife > 5) {
        feedback = "‚ö†Ô∏è <strong>Moderate Remaining Life:</strong> Monitor and plan maintenance in advance.";
        feedbackColor = "orange";
    } else if (remainingLife > 2) {
        feedback = "‚ö†Ô∏è <strong>Short Remaining Life:</strong> Immediate planning required; prioritize inspections and maintenance.";
        feedbackColor = "red";
    } else {
        feedback = "‚ùå <strong>Critical Remaining Life:</strong> Urgent repair or replacement required; high risk of catastrophic failure.";
        feedbackColor = "darkred";
    }

    document.getElementById('feedbackContent').innerHTML = feedback;
    document.getElementById('feedbackContent').style.color = feedbackColor;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 1Ô∏è‚É£ Detailed Input Validation Rules (QEHS/Fire Safety Perspective)
Input	Allowed Range	Units	Decimals	Rationale / Compliance Consideration
Remaining Corrosion Allowance	0 ‚Äì 5 inches (typical)	inches	0‚Äì2	Negative thickness is physically impossible; extremely high thickness (>5 in) may indicate wrong units or unrealistic design. Ensures structural integrity.
Corrosion Rate	0 < rate ‚â§ 0.5 in/year (typical industrial range)	inches/year	0‚Äì2	Must be positive; zero or negative is non-physical. Extremely high rates (>0.5 in/yr) indicate abnormal corrosion or incorrect input. Ensures predictive maintenance is realistic.
Cross-field	Remaining Life ‚â§ 50 years (industrially plausible max)	years	0‚Äì2	Protects against unrealistic combinations, e.g., very high allowance with tiny corrosion rate leading to excessive life estimate. Aligns with audit expectations.

Notes:

Units must be consistent: both inputs in inches and inches/year.

Decimal precision: maximum 2 decimals to reflect measurement accuracy.

Inputs must be numeric; non-numeric inputs are invalid.

2Ô∏è‚É£ Output Validation Logic and Thresholds
Remaining Life (years)	Assessment	Compliance / Safety Rationale
> 10	‚úÖ Long Remaining Life	Material is in good condition; routine inspection sufficient. Complies with standard inspection intervals (API 581, ISO 15156).
5 ‚Äì 10	‚ö†Ô∏è Moderate Remaining Life	Monitoring recommended; plan maintenance to avoid potential failures. Aligns with proactive risk-based inspection (RBI) methodology.
2 ‚Äì 5	‚ö†Ô∏è Short Remaining Life	Immediate planning required; increased inspection frequency and maintenance prioritization. Ensures personnel safety and regulatory compliance.
< 2	‚ùå Critical Remaining Life	Urgent replacement/repair needed; risk of catastrophic failure. Non-compliance with OSHA, NFPA, and industrial safety standards.

Edge thresholds:

Reaction to unrealistic outputs (e.g., >50 years) flagged for cross-check.

Provides actionable feedback consistent with QEHS auditing and predictive maintenance practices.

3Ô∏è‚É£ Edge Case Handling

Division by Zero:

If corrosionRate = 0 ‚Üí cannot divide ‚Üí throw error: "Corrosion Rate cannot be zero."

Negative inputs:

Physically impossible; must be flagged.

Extremely high remaining allowance or corrosion rate:

Flag with warning: "Value unusually high; please verify units or design."

Unrealistic combination:

Remaining Life > 50 years ‚Üí alert: "Calculated life exceeds industrial plausibility."

Non-numeric input:

Reject and display error: "Input must be numeric." -->