{% extends 'base.html' %}
{% block title %}Pore Pressure Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
   <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Pore Pressure Calculator</h1>
        <p>Estimate the pressure exerted by fluids within the pores of a rock formation at a given depth.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="fluidDensity">Fluid Density (ppg)</label>
                <input type="number" id="fluidDensity" class="form-input" min="0" placeholder="e.g., 10">
            </div>
            <div class="form-group">
                <label for="depth">Depth (m)</label>
                <input type="number" id="depth" class="form-input" min="0" placeholder="e.g., 3000">
            </div>
            <button class="calculate-btn" onclick="calculatePorePressure()">Calculate Pore Pressure</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Pressure illustration">
                <p>This tool will calculate the <strong>Pore Pressure</strong>. Enter your data to see results and insights here.</p>
            </div>
            
            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>
            
            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Pore Pressure Result</h2>
                </div>
                <div class="rate-value" id="porePressureValue">0.000</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">
                    Pressure in Megapascals (MPa)
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Interpretation</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
            <h3>📘 About This Calculator</h3>
            <p>
                The <strong>Pore Pressure Calculator</strong> is a specialized tool for engineers, geologists, and drilling professionals to estimate the pressure exerted by formation fluids at a given depth. 
            </p>
            <p>
                This is critical for wellbore stability, safe drilling operations, and preventing uncontrolled fluid influx (kicks) or blowouts. By entering fluid density and depth, users can quickly evaluate expected pressures and plan drilling mud weights accordingly.
            </p>
            <p>
                Key applications include:
                <ul>
                    <li>Safe drilling mud weight determination.</li>
                    <li>Wellbore stability assessment.</li>
                    <li>Reservoir and formation pressure evaluation.</li>
                    <li>Mitigation of formation collapse and kick hazards.</li>
                </ul>
            </p>
        </div>

        <div class="note-card">
            <h3>❓ What is Pore Pressure?</h3>
            <p>
                Pore pressure is the pressure exerted by fluids within the pores of a rock formation. It is influenced by fluid density, depth, and gravity, and is a key parameter in drilling, reservoir engineering, and geomechanics.
            </p>
        </div>

        <div class="note-card">
            <h3>⚙️ Parameters Used</h3>
            <ul class="note-list">
                  <li><strong>Fluid Density:</strong> The density of the fluid (in pounds per gallon, ppg) directly impacts pressure.</li>
        <li><strong>Depth:</strong> Greater depths result in increased pore pressure due to the weight of overlying fluid columns.</li>
        <li><strong>Gravity:</strong> Acts as a force that influences the hydrostatic pressure exerted at different depths.</li>
           </ul>
        </div>

       <div class="note-card">
    <h3>📊 Interpretation</h3>
    <ul class="note-list">
        <li><span class="good">Low Pressure (&lt;10 MPa):</span> Shallow formation or low-density fluid. Safe for standard drilling operations. Verify mud weight to ensure wellbore stability.</li>
        <li><span class="average">Moderate Pressure (10–30 MPa):</span> Typical for deeper formations. Requires correct mud weight and monitoring of well control to prevent kicks or minor wellbore instability.</li>
        <li><span class="bad">High Pressure (&gt;30 MPa):</span> High risk of blowout, formation fracturing, or wellbore collapse. Implement enhanced well control measures and follow emergency response protocols.</li>
        <li><span class="warning">Unrealistic Values:</span> Negative pressures or excessively high results indicate input errors or unit inconsistencies. Recheck fluid density and depth.</li>
    </ul>
</div>

<div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Fluid Density (ppg):</strong> Must be numeric, >0, and within typical drilling range (5–20 ppg). Values outside this range trigger a warning.</li>
        <li><strong>Depth (m):</strong> Must be numeric, >0, and realistic for drilling operations (0–10,000 m). Values above 10,000 m trigger a warning for verification.</li>
        <li><strong>Decimals Allowed:</strong> Fluid density up to 2 decimal places; depth up to 1 decimal place for precision.</li>
        <li><strong>Cross-field Consistency:</strong> Both density and depth must be positive; calculated pore pressure should also be positive.</li>
        <li><strong>Extreme Values:</strong> Fluid density &gt;20 ppg or depth &gt;10,000 m are considered outliers and should prompt user verification to avoid unsafe drilling assumptions.</li>
        <li><strong>Logical Consistency:</strong> Inputs must represent physically plausible drilling scenarios. For example, very shallow depth with extremely high density is unlikely.</li>
    </ul>
</div>

        <div class="note-card">
            <h3>💡 Important Note</h3>
            <p>
                Accurate pore pressure estimation is essential for safe drilling, well control, and reservoir management. Always validate inputs against formation data and use this as an estimation tool.
            </p>
        </div>
    </div>
</div>

<script>
function calculatePorePressure() {
    const fluidDensity = parseFloat(document.getElementById("fluidDensity").value);
    const depth = parseFloat(document.getElementById("depth").value);
    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const feedbackContent = document.getElementById('feedbackContent');

    let errors = [];

    // --- Basic Validations ---
    if (isNaN(fluidDensity)) errors.push("👉 Fluid density must be a number.");
    if (isNaN(depth)) errors.push("👉 Depth must be a number.");
    if (fluidDensity <= 0) errors.push("👉 Fluid density must be greater than 0.");
    if (depth <= 0) errors.push("👉 Depth must be greater than 0.");

    // --- Industry Range Checks ---
    if (fluidDensity < 5 || fluidDensity > 20) {
        errors.push("⚠️ Fluid density outside typical range (5–20 ppg). Verify input.");
    }
    if (depth > 10000) {
        errors.push("⚠️ Depth unusually high (>10,000 m). Verify formation depth.");
    }

    // --- Stop and display errors ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculation ---
    const gravity = 9.81; // m/s²
    const fluidDensity_kgm3 = fluidDensity * 119.83; // ppg -> kg/m³
    const porePressure_Pa = fluidDensity_kgm3 * gravity * depth;
    const porePressure_MPa = porePressure_Pa / 1e6;

    document.getElementById('porePressureValue').textContent = porePressure_MPa.toFixed(3);

    // --- Output Feedback ---
    let feedback = "";
    let color = "";

    if (porePressure_MPa < 10) {
        feedback = "✅ Low Pressure: Safe for standard drilling operations.";
        color = "green";
    } else if (porePressure_MPa >= 10 && porePressure_MPa <= 30) {
        feedback = "⚠️ Moderate Pressure: Ensure appropriate mud weight and well control.";
        color = "orange";
    } else {
        feedback = "❌ High Pressure: Risk of blowout or formation fracture. Take safety precautions.";
        color = "red";
    }

    feedbackContent.innerHTML = `<strong style="color:${color}">${feedback}</strong>`;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1️⃣ Input Analysis and QEHS Perspective
Input	Units	Typical Range (Industry Standard)	QEHS/Fire Safety Considerations
Fluid Density	ppg (pounds per gallon)	5 – 20 ppg	Fluids outside this range are unusual and may indicate incorrect data entry or incompatible mud type. Extremely dense fluids increase hydrostatic pressure and risk fracturing formations, affecting wellbore safety.
Depth	meters	0 – 10,000 m	Depths exceeding 10,000 m are rare for standard drilling. Input errors can cause misleading high-pressure calculations, impacting operational safety.
Gravity	m/s²	9.81	Standard; not user-input. Ensures proper hydrostatic calculation.

Calculation Formula:

Pore Pressure (Pa)
=
𝜌
⋅
𝑔
⋅
ℎ
Pore Pressure (Pa)=ρ⋅g⋅h

Where:

𝜌
ρ = fluid density in kg/m³ (1 ppg ≈ 119.83 kg/m³)

𝑔
g = gravity, 9.81 m/s²

ℎ
h = depth in meters

QEHS Implications:

Provides estimation of wellbore hydrostatic pressure.

Helps prevent blowouts (overpressure) or well collapse (underpressure).

Essential for audits and compliance with drilling safety standards (ISO 45001, OSHA, NFPA guidelines for high-risk processes).

2️⃣ Input Validation Rules (Comprehensive)
Fluid Density

Must be numeric, >0.

Minimum threshold: 5 ppg (typical drilling fluids).

Maximum threshold: 20 ppg (extreme mud density).

Acceptable decimals: up to 2 decimal places.

Units must be specified and consistent.

Depth

Must be numeric, >0.

Minimum threshold: 0 m.

Maximum threshold: 10,000 m (typical deep wells).

Acceptable decimals: 0–1 decimal place.

Cross-field consistency: Ensure depth corresponds to realistic well formation type (optional check if formation type is provided).

Logical Dependencies

Fluid density >0 and Depth >0.

Pore pressure must be positive; negative results indicate invalid input combination.

Edge Case Handling

Division by zero is not applicable here but avoid zero or negative density/depth.

Extremely high values should trigger warnings (e.g., density >20 ppg, depth >10,000 m).

Non-numeric inputs must throw errors.

3️⃣ Output Validation Logic
Pore Pressure (MPa)	Interpretation	QEHS/Compliance Action
<10 MPa	Low pressure	Safe; standard drilling procedures. Verify mud density if unusually low.
10 – 30 MPa	Moderate pressure	Normal; ensure correct mud weight and well control measures.
>30 MPa	High pressure	Critical; high risk of blowout or formation fracture. Emergency procedures, audit checks, and reinforced safety measures required.

Why this matters:

Ensures operators understand risks before drilling.

Aligns with NFPA/ISO guidelines for high-hazard operations.

Prevents underestimation or overestimation that could lead to safety incidents. -->