{% extends 'base.html' %}
{% block title %}Mean Temperature Difference B/W Primary and secondary Fluid Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mean Temperature Difference B/W Primary and secondary Fluid Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Mean Temperature Difference B/W Primary and secondary Fluid Calculator</h1>
            <p>Calculate the mean temperature difference between primary and secondary fluids in heat exchangers</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="q">Heat Transfer Rate (Q̇) [W]</label>
                    <input type="number" id="q" class="form-input" step="any" placeholder="e.g., 5000">
                </div>
                <div class="form-group">
                    <label for="u">Heat Transfer Coefficient (U) [W/m²°C]</label>
                    <input type="number" id="u" class="form-input" step="any" min="0" placeholder="e.g., 250">
                </div>
                <div class="form-group">
                    <label for="a">Heating Area (A) [m²]</label>
                    <input type="number" id="a" class="form-input" step="any" min="0" placeholder="e.g., 10">
                </div>
                
                <button class="calculate-btn" onclick="calculateMeanTemperatureDifference()">Calculate ΔTₘ</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Temperature illustration">
                    <p>This tool will calculate the <strong>Mean Temperature Difference (ΔTₘ)</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:40px;">
                        <h2>Mean Temperature Difference (ΔTₘ)</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">°C</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>High</span><span>Very High</span><span>Extreme</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Mean Temperature Difference Calculator</strong> determines the average temperature 
                    difference between primary and secondary fluids, which is essential for analyzing heat transfer 
                    efficiency in heat exchangers and thermal systems.
                </p>
            </div>


            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Heat Transfer Rate (Q̇):</strong> The total heat energy transferred per unit time, measured in watts (W)</li>
                    <li><strong>Heat Transfer Coefficient (U):</strong> A measure of how well heat is conducted through a material, expressed in W/m²°C</li>
                    <li><strong>Heating Area (A):</strong> The surface area available for heat exchange, measured in square meters (m²)</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>✅ Input Validations</h3>
    <ul class="note-list">
        <li><strong>Heat Transfer Rate (Q̇):</strong> Must be between 1–1,000,000,000 W (engineering measurement range)</li>
        <li><strong>Heat Transfer Rate Minimum:</strong> Must be > 0 W (meaningful heat transfer)</li>
        <li><strong>Heat Transfer Rate Maximum:</strong> Cannot exceed 1 GW (extreme power plant limits)</li>
        <li><strong>Heat Transfer Coefficient (U):</strong> Must be between 0.1–10,000 W/m²°C (realistic material properties)</li>
        <li><strong>Heat Transfer Coefficient Minimum:</strong> Must be > 0 W/m²°C (positive conductivity)</li>
        <li><strong>Heating Area (A):</strong> Must be between 0.001–100,000 m² (practical heat exchanger sizes)</li>
        <li><strong>Heating Area Minimum:</strong> Must be > 0 m² (positive surface area)</li>
        <li><strong>Division Prevention:</strong> U × A cannot be zero (prevents mathematical errors)</li>
    </ul>
</div>
<div class="note-card">
    <h3>🔎 Output Validations</h3>
    <ul class="note-list">
        <li><strong>ΔTₘ < 10 °C:</strong> ⚠️ Poor heat transfer - Review system design</li>
        <li><strong>10 ≤ ΔTₘ < 20 °C:</strong> ⚠️ Low efficiency - System may require optimization</li>
        <li><strong>20 ≤ ΔTₘ ≤ 50 °C:</strong> ✅ Acceptable performance - Normal operating range</li>
        <li><strong>50 < ΔTₘ ≤ 100 °C:</strong> ✅ High efficiency - System performing well</li>
        <li><strong>ΔTₘ > 100 °C:</strong> ⚠️ Very high ΔTₘ - Confirm no thermal stress risks</li>
    </ul>
</div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        The standard for calculating the mean temperature difference between fluids in a heat exchanger is the Logarithmic Mean Temperature Difference (LMTD), which provides a more accurate representation of the non-linear temperature changes that occur in a heat transfer process. The calculation method is derived from fundamental principles of heat transfer and is applicable to heat exchangers, following standards set by engineering and physics principles.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Why LMTD is the Standard</h3>
    <ul class="note-list">
        <li><b>Accuracy:</b> The LMTD method accounts for the non-linear change in the temperature of the secondary fluid (the fluid being heated or cooled).</li>
        <li><b>Foundation in Newton's Law of Cooling:</b> The LMTD method is based on Newton's Law of Cooling, which states that the rate of heat transfer depends on the temperature difference between the hot and cold fluids.</li>
        <li><b>Versatility:</b> It is a versatile and widely used method for calculating heat transfer in devices like heat exchangers, which are essential components in many industrial and everyday applications.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">LMTD vs. Other Methods</h3>
    <ul class="note-list">
        <li><b>Arithmetic Mean Temperature Difference (AMTD):</b> While AMTD is a simpler, less accurate method, it is sometimes used as an approximation for cases where the temperature difference is small.</li>
        <li><b>Effectiveness-NTU (ε-NTU) Method:</b> This is another alternative approach to calculating heat exchanger performance, which uses an effectiveness parameter (ε) and the Number of Transfer Units (NTU).</li>
    </ul>

    <p>
        In summary, the standard approach for determining the mean temperature difference between fluids in a heat exchanger is the LMTD, as it provides a more accurate and detailed calculation based on established principles of heat transfer.
    </p>
</div>
<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines the <strong>Mean Temperature Difference (ΔTₘ)</strong> between primary and secondary 
        fluids to evaluate heat exchanger performance and thermal system efficiency. By accurately calculating the 
        driving force for heat transfer, it supports proper heat exchanger design, ensures thermal system safety, 
        and helps optimize energy efficiency in industrial processes while maintaining compliance with thermal 
        engineering standards.
    </p>
</div>
            
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateMeanTemperatureDifference() {
    const q = document.getElementById('q').value.trim();
    const u = document.getElementById('u').value.trim();
    const a = document.getElementById('a').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const rateValue = document.getElementById('rateValue');
    const meterFill = document.getElementById('meterFill');
    const feedbackContent = document.getElementById('feedbackContent');

    // Reset UI
    errorBox.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');

    // Check empty
    if (!q || !u || !a) {
        errorBox.classList.remove('hidden');
        errorMessage.innerHTML = "❌ Please fill in all required fields.";
        return;
    }

    const Q = parseFloat(q);
    const U = parseFloat(u);
    const A = parseFloat(a);

    // Check valid numbers
    if (isNaN(Q) || isNaN(U) || isNaN(A)) {
        errorBox.classList.remove('hidden');
        errorMessage.innerHTML = "❌ All values must be valid numbers.";
        return;
    }

    // Range validations
    if (Q <= 0 || Q > 1e9) {
        errorBox.classList.remove('hidden');
        errorMessage.innerHTML = "❌ Heat Transfer Rate (Q̇) must be between 1 and 1,000,000,000 W.";
        return;
    }
    if (U < 0.1 || U > 10000) {
        errorBox.classList.remove('hidden');
        errorMessage.innerHTML = "❌ Heat Transfer Coefficient (U) must be between 0.1 and 10,000 W/m²°C.";
        return;
    }
    if (A < 0.001 || A > 100000) {
        errorBox.classList.remove('hidden');
        errorMessage.innerHTML = "❌ Heating Area (A) must be between 0.001 and 100,000 m².";
        return;
    }

    // Cross-check denominator
    if (U * A === 0) {
        errorBox.classList.remove('hidden');
        errorMessage.innerHTML = "❌ Invalid inputs: denominator (U × A) cannot be zero.";
        return;
    }

    // Calculate ΔTₘ
    const deltaTm = Q / (U * A);

    if (!isFinite(deltaTm) || deltaTm < 0) {
        errorBox.classList.remove('hidden');
        errorMessage.innerHTML = "❌ Invalid result: ΔTₘ could not be calculated.";
        return;
    }

    // Display result
    rateValue.textContent = deltaTm.toFixed(2);

    // Meter visualization
    let fillPercentage;
    if (deltaTm < 10) {
        fillPercentage = (deltaTm / 10) * 15;
        meterFill.style.background = '#e74c3c';
        feedbackContent.innerHTML = "⚠️ Poor heat transfer. Review system design.";
    } else if (deltaTm < 20) {
        fillPercentage = 15 + ((deltaTm - 10) / 10) * 15;
        meterFill.style.background = '#f39c12';
        feedbackContent.innerHTML = "⚠️ Low efficiency. System may require optimization.";
    } else if (deltaTm <= 50) {
        fillPercentage = 30 + ((deltaTm - 20) / 30) * 30;
        meterFill.style.background = '#3498db';
        feedbackContent.innerHTML = "✅ Acceptable performance. Normal operating range.";
    } else if (deltaTm <= 100) {
        fillPercentage = 60 + ((deltaTm - 50) / 50) * 20;
        meterFill.style.background = '#2ecc71';
        feedbackContent.innerHTML = "✅ High efficiency. System performing well.";
    } else {
        fillPercentage = 80 + Math.min(20, ((deltaTm - 100) / 400) * 20);
        meterFill.style.background = '#27ae60';
        feedbackContent.innerHTML = "⚠️ Very high ΔTₘ. Confirm no thermal stress risks.";
    }
    meterFill.style.width = `${fillPercentage}%`;

    resultValue.classList.remove('hidden');
}

        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used

Mean Temperature Difference (ΔTₘ) in this calculator is simplified as:

Δ
𝑇
𝑚
=
𝑄
𝑈
×
𝐴
ΔT
m
	​

=
U×A
Q
	​


Where:

Q = Heat Transfer Rate [W]

U = Heat Transfer Coefficient [W/m²°C]

A = Heating Surface Area [m²]

2. Detailed Input Validation Rules

Heat Transfer Rate (Q̇)

Must be > 0

Acceptable range: 1 W – 1,000,000,000 W (1 GW)

Below 1 W is negligible in engineering terms.

Above 1 GW is extreme (used only in large power plants).

Allow up to 2 decimal places.

Unit: W

Heat Transfer Coefficient (U)

Must be > 0

Acceptable range: 0.1 – 10,000 W/m²°C

Below 0.1 = unrealistic insulation-level transfer.

Above 10,000 = beyond industrial reality.

Allow up to 2 decimals.

Unit: W/m²°C

Heating Area (A)

Must be > 0

Acceptable range: 0.001 – 100,000 m²

Below 0.001 = smaller than lab-scale exchangers.

Above 100,000 = unrealistic for most industries.

Allow up to 3 decimals.

Unit: m²

Cross-field logical checks

𝑈
×
𝐴
U×A must never be 0 (division by zero).

ΔTₘ result must be physically meaningful (not negative, infinite, or NaN).

Extremely small ΔTₘ (< 1 °C) = practically negligible heat transfer.

3. Output Thresholds and Interpretation

These should guide your safety/efficiency classification:

< 10 °C → Poor / Ineffective system (potential safety/energy inefficiency risk)

10–20 °C → Low efficiency (system needs review)

20–50 °C → Acceptable / Normal operating range

50–100 °C → High efficiency, good performance

> 100 °C → Very high driving force; confirm not excessive (thermal stress or safety hazards possible in vessels, per ASME/TEMA)

4. Corrected JavaScript Validation Function
/*
Formula:
ΔTₘ = Q / (U × A)

Validation Rules:
- Q (Heat Transfer Rate): >0, range 1–1,000,000,000 W
- U (Heat Transfer Coefficient): >0, range 0.1–10,000 W/m²°C
- A (Heating Area): >0, range 0.001–100,000 m²
- Cross-check: U × A ≠ 0
- Output ΔTₘ must be finite, non-negative
*/ {% endcomment %}