{% extends 'base.html' %}
{% block title %}Tori-Spherical Head Radius Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tori-Spherical Head Radius Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        .sub-results {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }

        .sub-result-item {
            text-align: center;
        }
        
        .sub-result-value {
            font-size: 20px;
            font-weight: 600;
            color: #34495e;
        }

        .sub-result-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Tori-Spherical Head Radius Calculator</h1>
            <p>Calculate the standard design radii for a torispherical head based on its outer diameter, essential for pressure vessel design.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Vessel Diameter</h2>
                <div class="form-group">
                    <label for="outerDiameter">Outer Diameter (OD) [inches]</label>
                    <input type="number" id="outerDiameter" class="form-input" placeholder="e.g., 48">
                </div>
                <button class="calculate-btn" onclick="calculateRadii()">Calculate Radii</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Pressure vessel illustration">
                    <p>Enter the vessel's outer diameter to compute the corresponding Spherical, Crown, and Knuckle radii.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.0000</div>
                    <div class="rate-label" id="rateLabel">Spherical Radius (L) [inches]</div>
                    
                    <div class="sub-results">
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="crownRadius">0.0000 in</div>
                            <div class="sub-result-label">Crown Radius (CR)</div>
                        </div>
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="knuckleRadius">0.0000 in</div>
                            <div class="sub-result-label">Knuckle Radius (KR)</div>
                        </div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Calculation Status</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This tool calculates the three primary design radii of a standard <strong>torispherical head</strong>, 
            a common end closure for cylindrical pressure vessels. Accurate determination of these radii is fundamental 
            for stress analysis, material specification, and ensuring the structural integrity of the vessel under pressure.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Outer Diameter (OD):</strong> Diameter of the cylindrical shell, in inches.</li>
            <li><strong>Spherical Radius (L):</strong> Radius of the spherical portion of the head. <br><b>Formula: L = OD</b></li>
            <li><strong>Crown Radius (CR):</strong> Radius of the crown portion. <br><b>Formula: CR = OD</b></li>
            <li><strong>Knuckle Radius (KR):</strong> Radius of the toroidal section connecting cylinder and crown. <br><b>Formula: KR = 0.17 × OD</b></li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>📝 Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Outer Diameter (OD) [inches]:</strong> Must be a positive number (> 0). Typical industrial range: 12 – 1000 inches.</li>
            <li>Blank, non-numeric, or negative values → flagged as invalid.</li>
            <li>Extremely small (<12 in) or extremely large (>1000 in) values → ⚠️ Warning: Check input realism.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>If input is invalid → <strong>👉 Outer Diameter must be a positive number.</strong></li>
            <li>Spherical Radius (L) = OD, displayed with <strong>4 decimal places</strong>.</li>
            <li>Crown Radius (CR) = 1 × OD, displayed with <strong>4 decimal places</strong>.</li>
            <li>Knuckle Radius (KR) = 0.17 × OD, displayed with <strong>4 decimal places</strong>.</li>
            <li>If calculation produces NaN or infinite → <strong>❌ Calculation resulted in an invalid number. Please check your input.</strong></li>
            <li>Feedback: ✅ <strong>Calculation Successful.</strong> Standard design radii are shown above.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            A Torispherical Head Radius Calculator uses formulas and dimensions defined by American Society of Mechanical Engineers (ASME) standards, primarily in ASME Code Section VIII, Division 1, which outlines the design and requirements for pressure vessels, including the geometry of these heads. 
        </p>
        <ul class="note-list">
            <li><strong>Crown Radius (L):</strong> The radius of the spherical portion of the head. </li>
            <li><strong>Knuckle Radius (r):</strong> The smaller, toroidal (doughnut-shaped) radius that transitions from the crown to the cylinder.</li>
            <li><strong>Diameter (D):</strong> The diameter of the associated cylindrical shell.</li>
            <li><strong>Standard Ratios:</strong> The standards specify standard relationships between the crown radius and the cylinder diameter (e.g., L = 1.0D for a typical flanged and dished head), and the knuckle radius to the crown radius (e.g., r/L = 0.06).</li>
            <li>ASME standards ensure safe, reliable, and interoperable pressure vessel designs across industries.</li>
        </ul>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <p>
            Accurate calculation of torispherical head radii ensures safe, efficient, and durable pressure vessel design. 
            Engineers can rely on these standardized formulas to prevent structural failures, optimize material usage, and comply with industry codes.
        </p>
    </div>
</div>
    </div>

   <script>
    document.addEventListener('DOMContentLoaded', function () {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
    });

    function calculateRadii() {
        const od_val = document.getElementById('outerDiameter').value.trim();

        const errorBox = document.getElementById('resultError');
        const errorMessage = document.getElementById('errorMessage');
        const placeholder = document.getElementById('placeholder');
        const resultValue = document.getElementById('resultValue');
        const feedbackContent = document.getElementById('feedbackContent');

        let errors = [];
        let warnings = [];

        const outerDiameter = parseFloat(od_val);

        // --- INPUT VALIDATION ---
        if (od_val === '' || isNaN(outerDiameter) || outerDiameter <= 0) {
            errors.push("❌ Outer Diameter must be a positive number.");
        } else if (outerDiameter < 12 || outerDiameter > 1000) {
            warnings.push("⚠️ Outer Diameter is outside the typical industrial range (12–1000 inches). Check input realism.");
        }

        // --- ERROR HANDLING ---
        if (errors.length > 0) {
            errorMessage.innerHTML = errors.join("<br>");
            errorBox.classList.remove("hidden");
            placeholder.classList.add("hidden");
            resultValue.classList.add("hidden");
            return;
        } else {
            errorBox.classList.add("hidden");
        }

        // --- WARNING HANDLING ---
        if (warnings.length > 0) {
            errorMessage.innerHTML = warnings.join("<br>");
            errorBox.classList.remove("hidden");
        } else {
            errorBox.classList.add("hidden");
        }

        // --- CALCULATION ---
        const sphericalRadius = outerDiameter;          // L = OD
        const crownRadius = outerDiameter;              // CR = 1 × OD
        const knuckleRadius = 0.17 * outerDiameter;    // KR = 0.17 × OD

        // --- CALCULATION ERROR CHECK ---
        if (!isFinite(sphericalRadius) || !isFinite(crownRadius) || !isFinite(knuckleRadius)) {
            errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your input.";
            errorBox.classList.remove("hidden");
            resultValue.classList.add("hidden");
            return;
        }

        // --- DISPLAY RESULTS ---
        document.getElementById('rateValue').textContent = sphericalRadius.toFixed(4) + ' in';
        document.getElementById('crownRadius').textContent = crownRadius.toFixed(4) + ' in';
        document.getElementById('knuckleRadius').textContent = knuckleRadius.toFixed(4) + ' in';
        feedbackContent.innerHTML = '✅ <strong>Calculation Successful.</strong> Standard design radii are shown above.';

        placeholder.classList.add("hidden");
        resultValue.classList.remove("hidden");
    }

    // --- PRINT REPORT ---
    function printReport() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
        window.print();
    }
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (QEHS Perspective)

Outer Diameter (OD) [inches]:

Type: Positive number (float allowed).

Range: Typically 12 in – 240 in (for industrial pressure vessels). Anything smaller or excessively large should trigger a warning.

Decimals: Up to 4 decimal places allowed.

Logical Consistency:

Must be greater than zero.

Cannot be smaller than the minimum practical diameter for a pressure vessel.

Cross-field dependencies: If there were a wall thickness field, OD must be greater than wall thickness.

Edge Cases:

Zero → invalid

Negative numbers → invalid

Extremely large numbers (>1000 in) → flag as unrealistic.

Reason: Ensures safe design dimensions for pressure vessels and compliance with ASME Boiler & Pressure Vessel Code, ISO 9001 design criteria, and NFPA safety standards.

2. Output Validation Logic & Thresholds

Spherical Radius (L): Must equal the OD. Always positive.

Crown Radius (CR): CR = 1 × OD (acceptable ±5% tolerance).

Knuckle Radius (KR): KR = 0.17 × OD (or 0.25 × OD for some designs). Must be > 0.

Feedback:

✅ Green: Calculation successful, values are physically realistic.

⚠️ Orange/Red: If inputs are outside recommended ranges, warn user about unusual vessel geometry.

Reason: Correct radii ensure structural integrity and prevent failure during pressurization. Wrong dimensions may lead to unsafe pressure stresses and non-compliance during audits.
-->