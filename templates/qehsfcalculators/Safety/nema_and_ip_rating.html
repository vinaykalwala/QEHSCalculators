{% extends 'base.html' %}
{% block title %}NEMA and IP Rating Reference{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEMA and IP Rating Reference</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .select-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .form-select {
            width: 100%;
            padding: 14px 16px;
            border-radius: 10px;
            border: 1px solid #ddd;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .select-wrapper::after {
            content: "▼";
            font-size: 0.9rem;
            color: #1560bd;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: flex-start;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
            text-align: left;
        }
        
        .rating-title {
            font-size: 24px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .rating-definition {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #3498db;
            margin-bottom: 20px;
        }
        
        .definition-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .definition-content { 
            color: #34495e;
            line-height: 1.6;
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>NEMA and IP Rating Reference</h1>
            <p>Explore definitions and protection levels for NEMA and IP enclosure ratings</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Select Rating Type</h2>
                <div class="form-group">
                    <label for="ratingType">Rating System</label>
                    <div class="select-wrapper">
                        <select id="ratingType" class="form-select">
                            <option value="nema">NEMA Rating</option>
                            <option value="ip">IP Rating</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="ratingSelect">Select Rating</label>
                    <div class="select-wrapper">
                        <select id="ratingSelect" class="form-select">
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="getDefinition()">Get Definition</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>Select a rating type and specific rating to see its definition and protection level.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="rating-title" id="ratingTitle"></div>
                    
                    <div class="rating-definition">
                        <div class="definition-title">Definition & Protection Level</div>
                        <div class="definition-content" id="ratingDefinition"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Definition</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Tool</h3>
                <p>
                    The <strong>NEMA and IP Rating Reference</strong> provides definitions and protection levels for electrical enclosure ratings used in various industries to ensure equipment safety and durability.
                </p>
            </div>

            <div class="note-card">
                <h3>❓ What are NEMA and IP Ratings?</h3>
                <p>
                    NEMA (National Electrical Manufacturers Association) and IP (Ingress Protection) ratings classify the degree of protection provided by electrical enclosures against environmental factors.
                </p>
            </div>

            <div class="note-card">
                <h3>📊 Key Differences</h3>
                <ul class="note-list">
                    <li><strong>NEMA Ratings:</strong> Used mainly in North America. Consider protection against water, solid objects, corrosion, gases, and hazardous environments.</li>
                    <li><strong>IP Ratings:</strong> Used worldwide. Focus specifically on protection against water and solid objects with a two-digit code system.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>🌍 Applications</h3>
                <ul class="note-list">
                    <li><strong>Industrial Equipment</strong> - Protecting motors, control panels, and switches</li>
                    <li><strong>Outdoor Lighting</strong> - Ensuring fixtures withstand weather conditions</li>
                    <li><strong>Consumer Electronics</strong> - Water and dust resistance for devices</li>
                    <li><strong>Hazardous Locations</strong> - Equipment for explosive environments</li>
                    <li><strong>Medical Devices</strong> - Protection against liquids and contaminants</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>📋 Industry Standards</h3>
                <p>
                    NEMA standards are developed by the National Electrical Manufacturers Association, while IP ratings are defined by international standard IEC 60529. Many products feature both ratings to address global markets.
                </p>
            </div>
            
            <div class="note-card">
                <h3>⚠️ Important Note</h3>
                <p>
                    <em>This reference tool is for educational purposes only. While it provides general guidance on NEMA and IP ratings, it does not provide a direct conversion between the two systems. Always consult the specific product specifications and applicable standards for critical applications.</em>
                </p>
            </div>
            <div class="note-card">
  <h3>✅ Validation Rules Applied</h3>
  <ul class="note-list">
    <li>Rating Type must be either <strong>NEMA</strong> or <strong>IP</strong> (mandatory).</li>
    <li>Rating Selection must match the official standard keys (no free text).</li>
    <li>NEMA valid set: 1, 2, 3, 3R, 3S, 4, 4X, 5, 6, 6P, 7, 9, 12, 13.</li>
    <li>IP format: IP00–IP68 or IP69K only (IEC 60529 standard).</li>
    <li>Cross-field check: IP ratings cannot be chosen under NEMA and vice versa.</li>
    <li>Empty or tampered selections trigger an error message.</li>
    <li>Definitions validated against NEMA 250 and IEC 60529 standards.</li>
  </ul>
</div>

        </div>
    </div>

    <script>
        // Rating databases
        const nemaRatings = {
            "NEMA 1": "Enclosures constructed for indoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment and to provide a degree of protection against falling dirt.",
            "NEMA 2": "Enclosures constructed for indoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment and to provide a degree of protection against falling dirt and dripping non-corrosive liquids.",
            "NEMA 3": "Enclosures constructed for either indoor or outdoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt, rain, sleet, snow, and windblown dust; and that will be undamaged by the external formation of ice on the enclosure.",
            "NEMA 3R": "Enclosures constructed for either indoor or outdoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt, rain, sleet, and snow; and that will be undamaged by the external formation of ice on the enclosure.",
            "NEMA 3S": "Enclosures constructed for either indoor or outdoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt, rain, sleet, snow, and windblown dust; and in which the external mechanism(s) remain operable when ice laden.",
            "NEMA 4": "Enclosures constructed for either indoor or outdoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt, rain, sleet, snow, windblown dust, splashing water, and hose-directed water; and that will be undamaged by the external formation of ice on the enclosure.",
            "NEMA 4X": "Enclosures constructed for either indoor or outdoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt, rain, sleet, snow, windblown dust, splashing water, hose-directed water, and corrosion; and that will be undamaged by the external formation of ice on the enclosure.",
            "NEMA 5": "Enclosures constructed for indoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt; against settling airborne dust, lint, fibers, and flyings; and to provide a degree of protection against dripping and lightly splashing liquids.",
            "NEMA 6": "Enclosures constructed for either indoor or outdoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt; against hose-directed water and the entry of water during occasional temporary submersion at a limited depth; and that will be undamaged by the external formation of ice on the enclosure.",
            "NEMA 6P": "Enclosures constructed for either indoor or outdoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt; against hose-directed water and the entry of water during prolonged submersion at a limited depth; and that will be undamaged by the external formation of ice on the enclosure.",
            "NEMA 7": "Enclosures constructed for indoor use in hazardous locations classified as Class I, Division 1, Groups A, B, C, or D to contain an internal explosion without causing an external hazard.",
            "NEMA 9": "Enclosures constructed for indoor use in hazardous locations classified as Class II, Division 1, Groups E, F, or G to prevent the ignition of combustible dust.",
            "NEMA 12": "Enclosures constructed (without knockouts) for indoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt; against circulating dust, lint, fibers, and flyings; and against dripping and lightly splashing liquids.",
            "NEMA 13": "Enclosures constructed for indoor use to provide a degree of protection to personnel against incidental contact with the enclosed equipment; to provide a degree of protection against falling dirt; against circulating dust, lint, fibers, and flyings; and against the spraying, splashing, and seepage of water, oil, and noncorrosive coolants."
        };

        const ipRatings = {
            "IP00": "No protection against solid objects or liquids.",
            "IP10": "Protected against solid objects larger than 50mm (e.g., accidental hand contact). No protection against liquids.",
            "IP11": "Protected against solid objects larger than 50mm. Protected against condensation and dripping water.",
            "IP12": "Protected against solid objects larger than 50mm. Protected against dripping water when tilted up to 15°.",
            "IP20": "Protected against solid objects larger than 12.5mm (e.g., fingers). No protection against liquids.",
            "IP21": "Protected against solid objects larger than 12.5mm. Protected against condensation and dripping water.",
            "IP22": "Protected against solid objects larger than 12.5mm. Protected against dripping water when tilted up to 15°.",
            "IP23": "Protected against solid objects larger than 12.5mm. Protected against spraying water up to 60° from vertical.",
            "IP30": "Protected against solid objects larger than 2.5mm (e.g., tools and wires). No protection against liquids.",
            "IP31": "Protected against solid objects larger than 2.5mm. Protected against condensation and dripping water.",
            "IP32": "Protected against solid objects larger than 2.5mm. Protected against dripping water when tilted up to 15°.",
            "IP33": "Protected against solid objects larger than 2.5mm. Protected against spraying water up to 60° from vertical.",
            "IP34": "Protected against solid objects larger than 2.5mm. Protected against splashing water from all directions.",
            "IP40": "Protected against solid objects larger than 1mm (e.g., small tools and wires). No protection against liquids.",
            "IP41": "Protected against solid objects larger than 1mm. Protected against condensation and dripping water.",
            "IP42": "Protected against solid objects larger than 1mm. Protected against dripping water when tilted up to 15°.",
            "IP43": "Protected against solid objects larger than 1mm. Protected against spraying water up to 60° from vertical.",
            "IP44": "Protected against solid objects larger than 1mm. Protected against splashing water from all directions.",
            "IP50": "Protected against dust (limited ingress). No protection against liquids.",
            "IP54": "Protected against dust (limited ingress). Protected against splashing water from all directions.",
            "IP55": "Protected against dust (limited ingress). Protected against water jets from any direction.",
            "IP56": "Protected against dust (limited ingress). Protected against powerful water jets from any direction.",
            "IP57": "Protected against dust (limited ingress). Protected against immersion in water between 15cm and 1m depth.",
            "IP58": "Protected against dust (limited ingress). Protected against continuous immersion in water under specified conditions.",
            "IP60": "Dust-tight (no ingress of dust). No protection against liquids.",
            "IP65": "Dust-tight. Protected against water jets from any direction.",
            "IP66": "Dust-tight. Protected against powerful water jets from any direction.",
            "IP67": "Dust-tight. Protected against immersion in water between 15cm and 1m depth.",
            "IP68": "Dust-tight. Protected against continuous immersion in water under specified conditions.",
            "IP69K": "Dust-tight. Protected against high-pressure, high-temperature water jets from any direction."
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateRatings();
        });

        // Populate ratings based on selected type
        function populateRatings() {
            const ratingType = document.getElementById('ratingType').value;
            const ratingSelect = document.getElementById('ratingSelect');
            ratingSelect.innerHTML = '';

            let options = [];
            if (ratingType === 'nema') {
                options = Object.keys(nemaRatings);
            } else {
                options = Object.keys(ipRatings);
            }

            options.forEach(rating => {
                const option = document.createElement('option');
                option.value = rating;
                option.textContent = rating;
                ratingSelect.appendChild(option);
            });
        }

        // Get definition for selected rating
        function validateInputs(ratingType, selectedRating) {
    // Check mandatory fields
    if (!ratingType) {
        showError("Rating type is required (NEMA or IP).");
        return false;
    }

    if (!selectedRating) {
        showError("Please select a rating.");
        return false;
    }

    // Validate rating type
    if (ratingType !== "nema" && ratingType !== "ip") {
        showError("Invalid rating type selected.");
        return false;
    }

    // Validate selected rating format based on type
    if (ratingType === "ip") {
        const ipPattern = /^IP([0-6][0-9]|69K)$/;
        if (!ipPattern.test(selectedRating)) {
            showError("Invalid IP rating format (IEC 60529).");
            return false;
        }
        if (!ipRatings[selectedRating]) {
            showError("Definition not found for selected IP rating.");
            return false;
        }
    }

    if (ratingType === "nema") {
        const nemaPattern = /^NEMA (1|2|3|3R|3S|4|4X|5|6|6P|7|9|12|13)$/;
        if (!nemaPattern.test(selectedRating)) {
            showError("Invalid NEMA rating format (NEMA 250).");
            return false;
        }
        if (!nemaRatings[selectedRating]) {
            showError("Definition not found for selected NEMA rating.");
            return false;
        }
    }

    return true;
}

// Updated definition fetcher
function getDefinition() {
    const ratingType = document.getElementById('ratingType').value;
    const selectedRating = document.getElementById('ratingSelect').value;

    // Reset display
    document.getElementById('placeholder').classList.add('hidden');
    document.getElementById('resultError').classList.add('hidden');
    document.getElementById('resultValue').classList.add('hidden');

    // Validate
    if (!validateInputs(ratingType, selectedRating)) return;

    let definition = "";
    let title = "";

    if (ratingType === 'nema') {
        definition = nemaRatings[selectedRating];
        title = selectedRating + " Definition";
    } else {
        definition = ipRatings[selectedRating];
        title = selectedRating + " Rating Definition";
    }

    document.getElementById('ratingTitle').textContent = title;
    document.getElementById('ratingDefinition').textContent = definition;
    document.getElementById('resultValue').classList.remove('hidden');
}

        // Show error message
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('resultError').classList.remove('hidden');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
        // Print function
        function printReport() {
            window.print();
        }

        // Listen for changes in rating type
        document.getElementById('ratingType').addEventListener('change', function() {
            populateRatings();
        });
    </script>
</body>
</html>
{% endblock %}

{% comment %} 
1. Analysis of Inputs, Outputs, and Formula

Inputs:

ratingType → nema or ip

ratingSelect → a dropdown of ratings (e.g., NEMA 4X, IP67).

Outputs:

Definition text explaining protection levels.

Formula/Calculation:

There’s no mathematical formula; it’s a lookup-based reference tool (database of NEMA/IP descriptions).

From a QEHS/fire safety standpoint: This is consistent with IEC 60529 (IP) and NEMA 250 (NEMA ratings).

2. Comprehensive Validation Rules
For Inputs

✅ Rating Type (ratingType):

Allowed values: nema, ip

Mandatory field (cannot be blank)

Case-sensitive lock (must be lowercase to match logic)

✅ Rating Selection (ratingSelect):

Must match a key in the database (nemaRatings or ipRatings).

Cannot be empty.

No free text allowed (must come from dropdown list only).

Cross-field dependency:

If ratingType = nema, selection must be from nemaRatings.

If ratingType = ip, selection must be from ipRatings.

For Outputs

Definition must exist in the dictionary.

Error if mapping is missing (e.g., user tampers with dropdown in dev tools).

IP format validation:

Must start with "IP" followed by 2 digits (0–69) or 69K.

First digit (solids) range: 0–6

Second digit (liquids) range: 0–9 or K

NEMA format validation:

Must start with "NEMA" and have valid number/letter suffix (e.g., 1, 4X, 6P).

Allowed set: {1, 2, 3, 3R, 3S, 4, 4X, 5, 6, 6P, 7, 9, 12, 13}.

3. Edge Case Validations

❌ Empty selection → Show error.

❌ Invalid value (manipulated dropdown via dev tools) → Show error.

❌ Wrong pairing (e.g., ratingType = ip but NEMA 4 chosen) → Show error.

❌ Unknown key → “Definition not found” error.

❌ Print with no rating selected → Prevent and show warning.

4. Output Validation Logic

Ensure definitions comply with IEC 60529 and NEMA 250.

No conversion between NEMA & IP (since standards are not equivalent).

Validation ensures definitions displayed in audits/reports are traceable to recognized standards.

5. Corrected JavaScript Code (with Compliance Comments)
// =====================
// Validation & Compliance Logic
// =====================
// Formula: Lookup-based reference
// Rule: ratingType ∈ {nema, ip}
// Rule: ratingSelect must match dictionary key
// Rule: IP rating format: /^IP([0-6][0-9]|69K)$/
// Rule: NEMA rating format: /^NEMA (1|2|3|3R|3S|4|4X|5|6|6P|7|9|12|13)$/
// Standard references: IEC 60529 (IP), NEMA 250 (NEMA) {% endcomment %}
