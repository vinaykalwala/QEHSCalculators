{% extends 'base.html' %}
{% block title %}Job Safety Analysis Frequency Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Safety Analysis Frequency Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
    flex: 1;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    padding: 30px;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
    border: 2px solid #1560bd;
    min-height: 420px;
    max-height: 420px;
    overflow-y: auto;
    justify-content: flex-start;
    align-items: center;
    text-align: center;
}

.calc-card {
    flex: 1;
    background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
    color: #fff;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
    height: 420px;
    overflow-y: auto;
}
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Job Safety Analysis Frequency (JSAF) Calculator</h1>
            <p>Calculate how often Job Safety Analyses are performed per 1 million work hours</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="jobSafetyAnalyses">Total Job Safety Analyses Conducted</label>
                    <input type="number" id="jobSafetyAnalyses" class="form-input" min="0" placeholder="e.g., 150">
                </div>
                <div class="form-group">
                    <label for="totalHoursWorked">Total Employee Work Hours</label>
                    <input type="number" id="totalHoursWorked" class="form-input" min="1" placeholder="e.g., 500000">
                </div>
                
                <button class="calculate-btn" onclick="calculateJSAF()">Calculate JSAF</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Job Safety Analysis Frequency (JSAF)</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Job Safety Analysis Frequency (JSAF)</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">per million work hours</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Needs Improvement</span><span>Good</span><span>Excellent</span><span>Outstanding</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">JSAF Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
        
            <!-- üìò ABOUT THIS CALCULATOR -->
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Job Safety Analysis Frequency (JSAF) Calculator</strong> evaluates how often Job Safety Analyses
                    (JSAs) are performed
                    within a defined number of work hours. A higher JSAF indicates a more proactive and preventive safety
                    culture within an organization.
                    It helps quantify the effort toward hazard identification and control planning across various industries.
                </p>
            </div>
        
            <!-- ‚öô PARAMETERS USED -->
            <div class="note-card">
                <h3>‚öô Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Total Job Safety Analyses (JSAs):</strong> The total number of JSAs conducted during a reporting
                        period.</li>
                    <li><strong>Total Work Hours:</strong> The total number of employee work hours logged during the same
                        period.</li>
                    <li><strong>Scaling Factor (1,000,000):</strong> Used to normalize results per one million work hours for
                        consistency with industry metrics.</li>
                </ul>
                <p><em>These inputs help compare safety performance across teams, projects, or companies, regardless of
                        workforce size.</em></p>
            </div>
        
            <!-- ‚úÖ INPUT VALIDATION RULES -->
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Total JSAs:</strong> Must be a whole number between 0 and 10,000 (no decimals).</li>
                    <li><strong>Total Work Hours:</strong> Must be between 1 and 10,000,000,000.</li>
                    <li><strong>No negative or zero values:</strong> Negative or zero inputs invalidate the result.</li>
                    <li><strong>Cross-field check:</strong> Extremely high JSAs with very low hours trigger a warning.</li>
                    <li><strong>Upper limit check:</strong> JSAF > 1000 prompts review for input accuracy.</li>
                </ul>
                <p><em>All rules are aligned with occupational safety analytics best practices, ensuring meaningful and
                        comparable results.</em></p>
            </div>
        
            <!-- üìä OUTPUT VALIDATIONS -->
            <div class="note-card">
                <h3>üìä Output Validations</h3>
                <ul class="note-list">
                    <li><strong>JSAF = 0:</strong> üî¥ No JSAs conducted ‚Äì critical improvement needed.</li>
                    <li><strong>JSAF &lt; 50:</strong> üî¥ Needs improvement ‚Äì insufficient safety planning activity.</li>
                    <li><strong>50 ‚â§ JSAF &lt; 100:</strong> üü° Good, but can improve ‚Äì moderate proactive safety engagement.
                    </li>
                    <li><strong>100 ‚â§ JSAF &lt; 150:</strong> üü¢ Excellent ‚Äì meets safety best practice benchmarks.</li>
                    <li><strong>JSAF ‚â• 150:</strong> üåü Outstanding ‚Äì exemplary safety culture and prevention commitment.</li>
                </ul>
                <p><em>These classifications mirror the feedback logic displayed beside the result for consistent interpretation
                        of safety performance.</em></p>
            </div>
        
            <!-- üìê GOVERNING PRINCIPLE -->
            <div class="note-card">
                <h3>üìê Governing Principle</h3>
                <p>
                    A <strong>‚ÄúJob Safety Analysis Frequency (JSAF) Calculator‚Äù</strong> does not appear to be a recognized or
                    standardized term in the occupational safety field.
                    It is most likely an internal or company-specific metric. The correct standardized term is
                    <b>Job Safety Analysis (JSA)</b>, which is a structured process for identifying hazards and implementing
                    controls.
                </p>
        
                <p>
                    <strong>No specific standard:</strong> There is no formal standard for a ‚ÄúJSAF Calculator.‚Äù
                    How frequently a JSA is performed depends on internal safety policies, often influenced by factors such as
                    injury history, job change rate, and hazard severity.
                </p>
        
                <p>
                    <strong>JSA best practices:</strong> The <b>Occupational Safety and Health Administration (OSHA)</b>
                    provides detailed guidance and
                    best practices for conducting JSAs (also known as Job Hazard Analyses), but does not define a calculation
                    method for frequency.
                </p>
        
                <p>
                    <strong>Internal company use:</strong> If a company uses a ‚ÄúJSAF Calculator,‚Äù it typically relies on an
                    internal
                    risk matrix considering factors such as:
                </p>
                <ul class="note-list">
                    <li> Frequency of the task: How often the job is performed.</li>
                    <li> Injury history: Past accident or incident rates.</li>
                    <li> Severity of potential hazards: Potential for serious injury or illness.</li>
                    <li> Changes to procedure or equipment: New materials, methods, or tools in use.</li>
                </ul>
        
                <p>
                    <strong>Contextual note:</strong> The acronym <b>JSAF</b> is also used for ‚ÄúJoint Semi-Automated Forces,‚Äù
                    a military simulation system unrelated to occupational safety ‚Äî confirming that it is not a globally
                    standardized safety metric.
                </p>
            </div>
        
            <!-- üß© CONCLUSION -->
            <div class="note-card">
                <h3>üß© Conclusion</h3>
                <p>
                    The JSAF Calculator provides organizations with a simplified, internal measure of safety engagement.
                    While it is not an official standard under OSHA or ISO frameworks, it helps assess how actively
                    hazard identification practices are performed. Higher JSAF values indicate a stronger preventive culture,
                    fostering improved workplace safety and regulatory readiness.
                </p>
            </div>
        
        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateJSAF() {
    const jobSafetyAnalyses = document.getElementById('jobSafetyAnalyses').value.trim();
    const totalHoursWorked = document.getElementById('totalHoursWorked').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    /* --------------------
       Input Validations
       -------------------- */

    // Job Safety Analyses (JSA) validation
    if (jobSafetyAnalyses === "" || isNaN(jobSafetyAnalyses)) {
        errors.push("üëâ Please enter the number of Job Safety Analyses (JSAs).");
    } else if (!Number.isInteger(parseFloat(jobSafetyAnalyses))) {
        errors.push("üëâ JSAs must be a whole number (no decimals).");
    } else if (parseInt(jobSafetyAnalyses) < 0) {
        errors.push("üëâ JSAs cannot be negative.");
    } else if (parseInt(jobSafetyAnalyses) > 10000) {
        errors.push("üëâ JSAs cannot exceed 10,000 (check input).");
    }

    // Total Hours Worked validation
    if (totalHoursWorked === "" || isNaN(totalHoursWorked)) {
        errors.push("üëâ Please enter the total employee work hours.");
    } else if (parseFloat(totalHoursWorked) <= 0) {
        errors.push("üëâ Total work hours must be greater than 0.");
    } else if (parseFloat(totalHoursWorked) > 10000000000) {
        errors.push("üëâ Total work hours cannot exceed 10,000,000,000 (check input).");
    }

    // Cross-field validation
    if (parseInt(jobSafetyAnalyses) > 0 && parseFloat(totalHoursWorked) < 1000) {
        errors.push("‚ö†Ô∏è Warning: Hours seem very low for the number of JSAs entered. Please verify data.");
    }

    // --- Error Handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Safe Calculation ---
    const numJSAs = parseInt(jobSafetyAnalyses);
    const hours = parseFloat(totalHoursWorked);

    /* Formula:
       JSAF = (Number of JSAs √ó 1,000,000) / Total Work Hours 
    */
    const jsaf = (numJSAs * 1000000) / hours;

    // Output display
    document.getElementById('rateValue').textContent = jsaf.toFixed(2);

    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    // Threshold feedback
    if (numJSAs === 0) {
        meterWidth = '10%';
        meterColor = '#e74c3c';
        feedback = 'üî¥ No JSAs conducted ‚Äì critical improvement needed!';
    } else if (jsaf < 50) {
        meterWidth = '25%'; 
        meterColor = '#e74c3c';
        feedback = 'üî¥ Needs Improvement ‚Äì JSAF is low, safety planning may be insufficient.';
    } else if (jsaf < 100) {
        meterWidth = '50%'; 
        meterColor = '#f1c40f';
        feedback = 'üü° Good, but improvement recommended. Increase JSA frequency.';
    } else if (jsaf < 150) {
        meterWidth = '75%'; 
        meterColor = '#2ecc71';
        feedback = 'üü¢ Excellent ‚Äì meeting best practices (100+ per million hours).';
    } else {
        meterWidth = '95%'; 
        meterColor = '#27ae60';
        feedback = 'üåü Outstanding ‚Äì highly proactive safety culture.';
    }

    // Extreme high result check
    if (jsaf > 1000) {
        feedback += '<br><br>‚ö†Ô∏è Note: JSAF is unusually high, please confirm inputs (possible hours under-reported).';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;

    feedback += `<br><br>You conducted ${numJSAs} JSAs over ${hours.toLocaleString()} work hours.`;
    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}



{% comment %} 
1Ô∏è‚É£ Formula Used (with comment-ready version)

Formula:

JSAF
=
Number¬†of¬†Job¬†Safety¬†Analyses¬†(JSAs)
√ó
1
,
000
,
000
Total¬†Employee¬†Work¬†Hours
JSAF=
Total¬†Employee¬†Work¬†Hours
Number¬†of¬†Job¬†Safety¬†Analyses¬†(JSAs)√ó1,000,000
	‚Äã


Comment-ready snippet (to keep inside your JS code):

/* 
Formula Reference:
JSAF = (Number of Job Safety Analyses √ó 1,000,000) / Total Work Hours

Meaning:
- Expresses how many JSAs are conducted per million hours worked.
- Higher values = stronger proactive safety culture.
- Lower values = possible gaps in risk assessment & safety planning.
*/

2Ô∏è‚É£ Detailed Input Validation Rules
A. Job Safety Analyses (JSAs)

Type: Integer only (whole numbers, no decimals).

Range: 0 ‚Äì 10,000

Reason: In real audits, even very large companies rarely exceed 10,000 JSAs in a reporting period.

Units: Count of JSAs.

Validation Rationale:

Negative or decimal JSAs are logically impossible.

Large outliers could indicate a data entry mistake.

B. Total Employee Work Hours

Type: Positive number (can be decimal, since fractional hours are possible).

Range: 1 ‚Äì 10,000,000,000 (10 billion)

Reason: Reflects practical global workforce scenarios (ILO benchmarking).

Units: Hours (not days or FTEs).

Validation Rationale:

Must not be zero ‚Üí division by zero risk.

Negative hours impossible.

Extremely high values indicate mis-entry (e.g., days entered instead of hours).

C. Cross-Field Dependency

If Job Safety Analyses = 0, JSAF will always be 0. This is valid, but the system should still return ‚ÄúNeeds Improvement.‚Äù

If JSAs > 0 but hours < 1,000, result will be unrealistically high. Flag as a warning in the feedback section: ‚Äú‚ö†Ô∏è Check: Very high JSAF may indicate that hours entered are too low for the given JSAs.‚Äù

3Ô∏è‚É£ Output Validation & Thresholds

Industry-based interpretation (aligned with ISO 45001 safety culture metrics, benchmarking reports, and OSHA Voluntary Protection Programs):

< 50 ‚Üí üî¥ Needs Improvement
Low JSAF suggests safety planning not integrated into routine operations.

50 ‚Äì 100 ‚Üí üü° Good
JSAs are happening, but not yet fully embedded.

100 ‚Äì 150 ‚Üí üü¢ Excellent
Best practice level; aligns with proactive organizations.

> 150 ‚Üí üåü Outstanding
Robust proactive culture, beyond compliance. {% endcomment %}