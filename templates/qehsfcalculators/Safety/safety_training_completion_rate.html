{% extends 'base.html' %}
{% block title %}Safety Training Completion Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Training Completion Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0px 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: transform 0.3s ease;
            height: 420px; /* Fixed Height */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px; /* Fixed Height */
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        .sub-results {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }

        .sub-result-item {
            text-align: center;
        }
        
        .sub-result-value {
            font-size: 20px;
            font-weight: 600;
            color: #34495e;
        }

        .sub-result-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        
.result-card::-webkit-scrollbar {
    width: 8px;
}

.result-card::-webkit-scrollbar-thumb {
    background: #1560bd;
    border-radius: 6px;
}

.result-card::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.result-card {
    justify-content: flex-start; /* align from top */
    align-items: stretch;
    min-height: 420px;
    text-align: center;
    overflow-y: auto;       /* Enable vertical scrolling */
    max-height: 450px;      /* Set max height to control output size */
    padding: 20px;          /* keep spacing */
}

    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Safety Training Completion Rate Calculator</h1>
            <p>Measure and track the effectiveness of your training programs by calculating the employee completion rate.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="employeesTrained">Number of Employees Who Completed Training</label>
                    <input type="number" id="employeesTrained" class="form-input" placeholder="e.g., 85">
                </div>
                <div class="form-group">
                    <label for="totalEmployees">Total Number of Employees Requiring Training</label>
                    <input type="number" id="totalEmployees" class="form-input" placeholder="e.g., 100">
                </div>
                <button class="calculate-btn" onclick="calculateTrainingRate()">Calculate Rate</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Training and compliance icon">
                    <p>Enter your training data to see the completion rate and assess the compliance level of your workforce.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.0%</div>
                    <div class="rate-label" id="rateLabel">Training Completion Rate</div>
                    
                    <div class="sub-results">
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="trainedCount">0</div>
                            <div class="sub-result-label">Trained</div>
                        </div>
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="totalCount">0</div>
                            <div class="sub-result-label">Total</div>
                        </div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Urgent Action</span><span>Needs Improvement</span><span>Good</span><span>Excellent</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The Safety Training Completion Rate quantifies the percentage of employees who have completed required
                    safety training programs. This metric helps organizations monitor compliance, track progress, and ensure
                    that employees are adequately prepared to maintain a safe working environment.
                </p>
            </div>
            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Number of Employees Trained:</strong> Total employees who successfully completed training.</li>
                    <li><strong>Total Employees:</strong> Total workforce required to undergo training.</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>📝 Input Validations</h3>
                <ul class="note-list">
                    <li><strong>Number of Employees Trained:</strong> Must be a whole number ≥ 0.
                        <br>Examples of invalid input: negative numbers, decimals, empty fields.
                    </li>
                    <li><strong>Total Number of Employees:</strong> Must be a whole number > 0.
                        <br>Examples of invalid input: zero, negative numbers, decimals, empty fields.
                    </li>
                    <li><strong>Logical Consistency:</strong> Number of trained employees cannot exceed total employees.
                        <br>This ensures the calculation is physically and administratively meaningful.
                    </li>
                    <li><strong>Edge Cases:</strong> Division by zero is prevented by ensuring total employees > 0.</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>📝 Output Validations</h3>
                <ul class="note-list">
                    <li><strong>Urgent Action (Red, &lt; 70%): </strong>
                                <br>🚨 <strong>Urgent Action Required.</strong> A completion rate below 70% indicates a significant
                                compliance gap and potential safety risk.</li>
                    <li><strong>Needs Improvement (Orange, 70–89%):</strong>
                        <br>⚠️ <strong>Needs Improvement.</strong> While many employees are trained, a rate below 90% leaves a
                        notable portion of the workforce uncovered.
                    </li>
                    <li><strong>Good Compliance (Yellow, 90–99%):</strong>
                        <br>👍 <strong>Good Compliance.</strong> A rate of 90% or higher is a strong indicator of a healthy safety
                        program. Aim for 100%.
                    </li>
                    <li><strong>Excellent Compliance (Green, 100%):</strong>
                        <br>✅ <strong>Excellent Compliance.</strong> 100% completion demonstrates an outstanding commitment to
                        safety and is the gold standard.
                    </li>
                </ul>
            
            </div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A safety training completion rate calculator follows internal business standards and is used to calculate the percentage of employees who have completed required safety training, rather than adhering to a single, universal external standard like those set by OSHA for incident rates. While no specific external "safety training completion rate standard" exists, its use is a common Key Performance Indicator (KPI) for gauging proactive safety commitment and performance against internal goals and regulatory compliance requirements.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">How a Safety Training Completion Rate Calculator Works</h3>
    <p>
        (Number of Employees Who Completed Training / Total Number of Employees Required to Complete Training) × 100%
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Purpose of the Calculator</h3>
    <ul class="note-list">
        <li><b>Measure Compliance:</b> To track and ensure compliance with mandatory safety training programs.</li>
        <li><b>Gauge Proactive Commitment:</b> To provide insight into an organization's proactive commitment to workplace safety and staff development.</li>
        <li><b>Identify Training Gaps:</b> To identify departments or teams that may require additional resources or focus to improve their completion rates.</li>
        <li><b>Set Performance Targets:</b> To establish targets for safety training and evaluate progress towards those goals.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Relation to Other Standards</h3>
    <ul class="note-list">
        <li><b>OSHA Standards:</b> While OSHA sets standards for recordkeeping of injuries and illnesses and has established formulas for calculating OSHA Incident Rates (like the TRIR and DART rates), it does not mandate a standard calculation for training completion rates, according to the provided search results.</li>
        <li><b>Internal Standards:</b> Organizations set their own baseline and target completion rates to align with regulatory requirements and internal safety objectives.</li>
        <li><b>KPI Benchmarking:</b> The completion rate itself acts as a Key Performance Indicator (KPI) to measure and improve the effectiveness of a company's safety program, with benchmarks often established by industry groups or within the company itself.</li>
    </ul>
</div>
            <div class="note-card">
                <h3>💡 Conclusion</h3>
                <p>
                    A higher Safety Training Completion Rate reflects a well-informed workforce and a strong safety culture. It
                    reduces risks of accidents, ensures regulatory compliance, and supports continuous improvement in workplace
                    safety.
                </p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateTrainingRate() {
            const trained_val = document.getElementById('employeesTrained').value.trim();
            const total_val = document.getElementById('totalEmployees').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // --- PARSE INPUTS ---
            const trained = parseFloat(trained_val);
            const total = parseFloat(total_val);

            // --- INPUT VALIDATION ---
            if (trained_val === '' || isNaN(trained) || trained < 0) {
                errors.push("👉 Number of Employees Trained must be a number ≥ 0.");
            } else if (!Number.isInteger(trained)) {
                errors.push("👉 Number of Employees Trained must be a whole number.");
            }

            if (total_val === '' || isNaN(total) || total <= 0) {
                errors.push("👉 Total Employees must be a number > 0.");
            } else if (!Number.isInteger(total)) {
                errors.push("👉 Total Employees must be a whole number.");
            }

            if (!isNaN(trained) && !isNaN(total) && trained > total) {
                errors.push("👉 Number of trained employees cannot exceed the total number of employees.");
            }

            // --- ERROR HANDLING ---
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // --- CALCULATION ---
            const trainingRate = (trained / total) * 100;

            if (!isFinite(trainingRate)) {
                errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your inputs.";
                errorBox.classList.remove("hidden");
                resultValue.classList.add("hidden");
                return;
            }

            // --- DISPLAY RESULTS ---
            document.getElementById('rateValue').textContent = trainingRate.toFixed(1) + '%';
            document.getElementById('trainedCount').textContent = trained;
            document.getElementById('totalCount').textContent = total;

            // --- ASSESSMENT ---
            const meterFill = document.getElementById('meterFill');
            let meterWidth, meterColor, feedback;

            if (trainingRate < 70) {
                meterWidth = '20%';
                meterColor = '#e74c3c'; // Red
                feedback = `🚨 <strong>Urgent Action Required.</strong> A completion rate below 70% indicates a significant compliance gap and potential safety risk.`;
            } else if (trainingRate < 90) {
                meterWidth = '45%';
                meterColor = '#e67e22'; // Orange
                feedback = `⚠️ <strong>Needs Improvement.</strong> While many employees are trained, a rate below 90% leaves a notable portion of the workforce uncovered.`;
            } else if (trainingRate < 100) {
                meterWidth = '70%';
                meterColor = '#f1c40f'; // Yellow
                feedback = `👍 <strong>Good Compliance.</strong> A rate of 90% or higher is a strong indicator of a healthy safety program. Aim for 100%.`;
            } else { // 100%
                meterWidth = '95%';
                meterColor = '#2ecc71'; // Green
                feedback = `✅ <strong>Excellent Compliance.</strong> 100% completion demonstrates an outstanding commitment to safety and is the gold standard.`;
            }

            meterFill.style.width = meterWidth;
            meterFill.style.backgroundColor = meterColor;
            document.getElementById('feedbackContent').innerHTML = feedback;

            placeholder.classList.add("hidden");
            resultValue.classList.remove("hidden");
        }

        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            window.print();
        }

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 
1️⃣ Input Validation Rules (QEHS Perspective)
Input Field	Validation	Acceptable Range / Rules	Why It's Essential
Employees Trained	Must be a number	≥ 0, whole number	Negative or decimal numbers are not meaningful; ensures realistic workforce count.
Total Employees	Must be a number	> 0, whole number	Cannot have zero or negative employees; required to calculate % correctly.
Logical Consistency	Employees Trained ≤ Total Employees	N/A	Prevents impossible scenarios, e.g., more trained than total employees.
Allowed Decimals	None (integers only)	Whole numbers only	Employee count must be discrete; fractions of a person are invalid.
Cross-field Dependencies	Trained cannot exceed total	N/A	Ensures KPI calculations are correct and audit-ready.

Edge Case Validations:

Division by zero → Total Employees = 0.

Unrealistic numbers → e.g., 1,000,000 employees in a small facility.

Negative inputs → e.g., -5 trained employees.

Trained > total → ensures compliance logic consistency.

2️⃣ Output Validation Logic & Thresholds
Training Rate (%)	Compliance Level	Feedback Message (as per script)	Color / Meter Indicator
0–69	Urgent Action	🚨 Low compliance, urgent training needed.	Red (critical)
70–89	Needs Improvement	⚠️ Moderate compliance, needs improvement.	Orange (caution)
90–100	Good / Excellent	✅ Excellent compliance and safety awareness.	Green (safe/high)

Notes:

The output must always be finite and valid (no NaN or Infinity).

The color-coded meter reinforces the level visually for audits and management dashboards. 
-->