{% extends 'base.html' %}
{% block title %}Maximum Inspection Interval Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maximum Inspection Interval Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 460px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .result-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: left;
            border-left: 4px solid #2980b9;
        }
        
        .result-item {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .result-value-item {
            font-weight: 600;
            color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Maximum Inspection Interval Calculator</h1>
            <p>Calculate the recommended inspection interval based on material thickness and corrosion rate</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="tActual">Actual Thickness (t<sub>actual</sub>) [inches]</label>
                    <input type="number" id="tActual" class="form-input" min="0" step="any" placeholder="e.g., 0.5">
                </div>
                <div class="form-group">
                    <label for="tRequired">Required Thickness (t<sub>required</sub>) [inches]</label>
                    <input type="number" id="tRequired" class="form-input" min="0" step="any" placeholder="e.g., 0.3">
                </div>
                <div class="form-group">
                    <label for="corrosionRate">Corrosion Rate [inches per year]</label>
                    <input type="number" id="corrosionRate" class="form-input" min="0" step="any" placeholder="e.g., 0.02">
                </div>
                
                <button class="calculate-btn" onclick="calculateInspectionInterval()">Calculate Interval</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Maximum Inspection Interval</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Inspection Interval Results</h2>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-item">
                            <span class="result-label">Remaining Life:</span>
                            <span class="result-value-item" id="remainingLife">0.00</span> years
                        </div>
                        <div class="result-item">
                            <span class="result-label">Maximum Inspection Interval:</span>
                            <span class="result-value-item" id="maxInterval">0.00</span> years
                        </div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Maximum Inspection Interval Calculator</strong> determines the recommended time between inspections 
                    based on the remaining life of a component and its corrosion rate.
                </p>
            </div>


            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Actual Thickness (t<sub>actual</sub>):</strong> The current thickness of the metal component</li>
                    <li><strong>Required Thickness (t<sub>required</sub>):</strong> The minimum acceptable thickness before failure risk increases</li>
                    <li><strong>Corrosion Rate:</strong> The rate at which material is lost due to corrosion, measured in inches per year</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>✅ Input Validations</h3>
    <ul class="note-list">
        <li><strong>Actual Thickness (t<sub>actual</sub>):</strong> Must be between 0.001–20 inches (practical industrial range)</li>
        <li><strong>Actual Thickness Minimum:</strong> Must be > 0 inches (positive measurement)</li>
        <li><strong>Actual Thickness Maximum:</strong> Cannot exceed 20 inches (industrial application limit)</li>
        <li><strong>Required Thickness (t<sub>required</sub>):</strong> Must be > 0 inches (positive minimum requirement)</li>
        <li><strong>Thickness Relationship:</strong> Actual thickness must be greater than required thickness</li>
        <li><strong>Corrosion Rate:</strong> Must be between 0.001–1.0 inches/year (NACE/API corrosion data range)</li>
        <li><strong>Corrosion Rate Minimum:</strong> Must be ≥ 0.001 inches/year (minimum detectable rate)</li>
        <li><strong>Corrosion Rate Maximum:</strong> Cannot exceed 1.0 inches/year (extreme corrosion limit)</li>
    </ul>
</div>
<div class="note-card">
    <h3>🔎 Output Validations</h3>
    <ul class="note-list">
        <li><strong>Maximum Interval < 2 years:</strong> 🔴 High Risk - Frequent inspections are required. Consider immediate repair/replacement.</li>
        <li><strong>2 ≤ Maximum Interval < 5 years:</strong> 🟡 Moderate Risk - Schedule inspections within this range</li>
        <li><strong>Maximum Interval ≥ 5 years:</strong> ✅Low Risk - Safe inspection interval. Standard maintenance schedule applies.</li>
    </ul>
</div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A maximum inspection interval calculator is based on standards such as API 510, API 581, API 653, and the National Board Inspection Code (NBIC), which provide methodologies for calculating remaining life based on corrosion rates and thickness measurements. These standards allow for risk-based inspection (RBI) assessments to determine appropriate inspection intervals, ensuring safety and compliance.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Key Standards & Principles</h3>
    <ul class="note-list">
        <li><b>API 510 and API 581:</b> These American Petroleum Institute (API) standards are used for pressure vessel inspection and provide methodologies for risk-based inspection (RBI).</li>
        <li><b>API 653:</b> This standard is for the inspection, repair, alteration, and reconstruction of storage tanks, also using principles of corrosion rate and thickness measurement to determine intervals.</li>
        <li><b>National Board Inspection Code (NBIC):</b> This code specifies inspection frequency for pressure vessels, often linking it to half the remaining life or established time limits.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">How It Works</h3>
    <ul class="note-list">
        <li><b>Corrosion Rate Calculation:</b> Calculators use the last inspection data and current thickness measurements to determine the rate of corrosion.</li>
        <li><b>Remaining Life Estimation:</b> By comparing current thickness to the required renewal thickness, the remaining safe operating life is calculated.</li>
        <li><b>Interval Factor:</b> A factor (e.g., 0.5) is applied to ensure conservative and safe inspection scheduling.</li>
        <li><b>RBI Assessments:</b> Instead of fixed intervals, RBI assessments allow for extended intervals based on the equipment's specific condition and risk factors, as outlined in standards like API 510 and API 581.</li>
    </ul>

    <p>
        In essence, a maximum inspection interval calculator is a tool that applies the principles and guidelines found in these industry standards to determine optimal, and potentially extended, inspection intervals for pressure equipment.
    </p>
</div>
<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines the <strong>maximum inspection interval</strong> based on material thickness 
        and corrosion rate to ensure equipment integrity and safety compliance. By calculating remaining life 
        and establishing appropriate inspection schedules, it supports proactive maintenance planning, prevents 
        equipment failures, and maintains compliance with API 510/570 standards for pressure equipment integrity 
        management.
    </p>
</div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateInspectionInterval() {
    const tActual = document.getElementById('tActual').value.trim();
    const tRequired = document.getElementById('tRequired').value.trim();
    const corrosionRate = document.getElementById('corrosionRate').value.trim();

    const resultElement = document.getElementById('resultValue');
    const errorElement = document.getElementById('resultError');
    const placeholderElement = document.getElementById('placeholder');

    // Reset display
    errorElement.classList.add('hidden');
    resultElement.classList.add('hidden');
    placeholderElement.classList.add('hidden');

    // Convert to numbers
    const tActualNum = parseFloat(tActual);
    const tRequiredNum = parseFloat(tRequired);
    const corrosionRateNum = parseFloat(corrosionRate);

    // Validation
    if (!tActual || !tRequired || !corrosionRate) {
        showError("All fields are required. Please enter values for all inputs.");
        return;
    }

    if (isNaN(tActualNum) || tActualNum <= 0 || tActualNum > 20) {
        showError("Actual thickness must be a positive number (0 < t_actual ≤ 20 inches).");
        return;
    }

    if (isNaN(tRequiredNum) || tRequiredNum <= 0) {
        showError("Required thickness must be a positive number.");
        return;
    }

    if (tActualNum <= tRequiredNum) {
        showError("Actual thickness must be greater than required thickness.");
        return;
    }

    if (isNaN(corrosionRateNum) || corrosionRateNum < 0.001 || corrosionRateNum > 1.0) {
        showError("Corrosion rate must be between 0.001 and 1.0 inches/year.");
        return;
    }

    // Calculations
    const remainingLife = (tActualNum - tRequiredNum) / corrosionRateNum;

    if (remainingLife <= 0) {
        showError("The equipment has already reached or passed the minimum thickness. Immediate action required.");
        return;
    }

    const maxInspectionInterval = Math.min(2 * remainingLife, 10);

    // Display results
    document.getElementById('remainingLife').textContent = remainingLife.toFixed(2);
    document.getElementById('maxInterval').textContent = maxInspectionInterval.toFixed(2);

    // Risk feedback
    let feedback = "";
    let feedbackColor = "";

    if (maxInspectionInterval < 2) {
        feedback = "⚠️ <strong>High Risk:</strong> Frequent inspections are required. Consider immediate repair/replacement.";
        feedbackColor = "#e74c3c";
    } else if (maxInspectionInterval >= 2 && maxInspectionInterval < 5) {
        feedback = "⚠️ <strong>Moderate Risk:</strong> Schedule inspections within this range.";
        feedbackColor = "#f39c12";
    } else {
        feedback = "✅ <strong>Low Risk:</strong> Safe inspection interval. Standard maintenance schedule applies.";
        feedbackColor = "#27ae60";
    }

    document.getElementById('feedbackContent').innerHTML = feedback;
    document.getElementById('feedbackContent').style.color = feedbackColor;

    resultElement.classList.remove('hidden');
}

        
        function showError(message) {
            const errorElement = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholderElement = document.getElementById('placeholder');
            
            placeholderElement.classList.add('hidden');
            errorMessage.textContent = message;
            errorElement.classList.remove('hidden');
        }
        
        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}

{% comment %} 
1. Formula Used (keep as code comment in your JS)
/*
FORMULA:
Remaining Life (years) = (t_actual – t_required) / corrosion_rate
Maximum Inspection Interval (years) = min(2 × Remaining Life, 10)

Where:
- t_actual = Actual measured thickness (inches)
- t_required = Minimum allowable thickness (inches)
- corrosion_rate = Corrosion rate (inches per year)

Notes:
- Based on API 510/570 guidance (remaining life & interval limits).
- Maximum inspection interval capped at 10 years for compliance.
- Interval limited to ½ of remaining life for safety margin.
*/

2. Detailed Input Validation Rules (QEHS/Fire Safety perspective)
Actual Thickness (t_actual)

Unit: inches (API, ASME standard practice).

Range: > 0 to <= 20 inches (practical upper bound for most industrial applications).

Decimals: up to 3 decimals (0.001 in = common UT gauge precision).

Logical: Must be strictly greater than required thickness.

Compliance rationale: Ensures measurement is realistic and not less than minimum safe thickness.

Required Thickness (t_required)

Unit: inches.

Range: > 0 to < t_actual.

Decimals: up to 3 decimals.

Cross-check: Cannot equal or exceed t_actual.

Compliance rationale: API/ASME requires minimum thickness always lower than actual; otherwise equipment is unsafe.

Corrosion Rate

Unit: inches per year (in/yr).

Range: 0.001 to 0.25 in/yr typical (per NACE/API datasets).

Upper Bound: Reject > 1.0 in/yr (unrealistic except for extreme cases).

Decimals: up to 4 decimals (fine-grain corrosion tracking).

Compliance rationale: Very low/zero values make remaining life infinite (not acceptable); very high values indicate failure.

3. Edge Case Validations

Zero corrosion rate → would cause division by zero → show error: “Corrosion rate cannot be zero; use minimum detectable rate per inspection code (≥0.001 in/yr).”

t_actual = t_required → Remaining life = 0 → error: “Equipment at failure thickness – immediate inspection/repair required.”

Negative remaining life (t_actual < t_required) → show error: “Equipment unsafe: thickness already below required minimum.”

Extremely large remaining life (>100 years) → warning: “Check corrosion rate value, interval capped by API to 10 years.”

Unrealistic thickness (e.g., >20 inches) → validation error.

4. Output Validation & Thresholds

Remaining Life < 2 years → High risk, immediate or frequent inspection required.

Remaining Life 2–5 years → Moderate risk, schedule regular inspection.

Remaining Life > 5 years (max 10) → Low risk, standard inspection cycle.

These thresholds are aligned with API 510/570 and RBI (Risk-Based Inspection) practices, where inspection interval is capped even if corrosion is low. {% endcomment %}