{% extends 'base.html' %}
{% block title %}No-Overpressure Vent Area Formula (External Heating){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No-Overpressure Vent Area Formula (External Heating)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            {% comment %} display: flex; {% endcomment %}
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            {% comment %} overflow-y: auto; {% endcomment %}
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Input rows for side-by-side fields */
         .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            {% comment %} margin-bottom: 15px; {% endcomment %}
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
       
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>No-Overpressure Vent Area Formula (External Heating)</h1>
            <p>Calculate the required vent area to prevent excessive pressure buildup due to external heating</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                <div class="form-group">
                    <label for="QT">Constant External Heat Input (Qₜ) [kJ/min]</label>
                    <input type="number" id="QT" class="form-input" min="0" step="0.001" placeholder="e.g., 1500">
                </div>
                <div class="form-group">
                    <label for="mo">Initial Mass (m₀) [kg]</label>
                    <input type="number" id="mo" class="form-input" min="0" step="0.001" placeholder="e.g., 500">
                </div>
              </div>
              <div class="input-row">
                <div class="form-group">
                    <label for="vfa">Specific Volume of Liquid (vₓₐ) [m³/kg]</label>
                    <input type="number" id="vfa" class="form-input" min="0" step="0.000001" placeholder="e.g., 0.001">
                </div>
                <div class="form-group">
                    <label for="G">Mass Flux (G) [kg/m²s]</label>
                    <input type="number" id="G" class="form-input" min="0" step="0.01" placeholder="e.g., 25">
                </div>
              </div>
              <div class="input-row">
                <div class="form-group">
                    <label for="V">Volume (V) [m³]</label>
                    <input type="number" id="V" class="form-input" min="0" step="0.001" placeholder="e.g., 10">
                </div>
                <div class="form-group">
                    <label for="hfa">Latent Heat of Vaporization (hₓₐ) [kJ/kg]</label>
                    <input type="number" id="hfa" class="form-input" min="0" step="0.1" placeholder="e.g., 2257">
                </div>
              </div>
                
                <button class="calculate-btn" onclick="calculateVentArea()">Calculate Vent Area</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Required Vent Area</strong> to prevent overpressure from external heating. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Required Vent Area</h2>
                    </div>
                    <div class="rate-display">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Vent Area (m²)</div></div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Small</span><span>Optimal</span><span>Moderate</span><span>Large</span><span>Very Large</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    This tool calculates the <strong>Required Vent Area</strong> to prevent overpressure in vessels exposed to external heating,
                    ensuring safe pressure relief in accordance with industry standards.
                </p>
            </div>

            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Constant External Heat Input (Qₜ):</strong> The external heat energy applied to the system (kJ/min).</li>
                    <li><strong>Initial Mass (m₀):</strong> The initial mass of the liquid present in the vessel (kg).</li>
                    <li><strong>Specific Volume of Liquid (vₓₐ):</strong> The specific volume of the liquid (m³/kg).</li>
                    <li><strong>Mass Flux (G):</strong> The rate of mass movement per unit area (kg/m²s).</li>
                    <li><strong>Volume (V):</strong> The total volume of the container (m³).</li>
                    <li><strong>Latent Heat of Vaporization (hₓₐ):</strong> The latent heat required to vaporize the liquid (kJ/kg).</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>✅ Input Validations</h3>
    <ul class="note-list">
        <li><strong>Constant External Heat Input (Qₜ):</strong> Must be between 1–100,000 kJ/min (industrial fire exposure range)</li>
        <li><strong>Heat Input Minimum:</strong> Must be > 0 kJ/min (positive heat flux required)</li>
        <li><strong>Initial Mass (m₀):</strong> Must be between 1–100,000 kg (tank capacity range)</li>
        <li><strong>Initial Mass Minimum:</strong> Must be > 0 kg (positive mass required)</li>
        <li><strong>Specific Volume (vₓₐ):</strong> Must be between 0.0001–10 m³/kg (fluid property range)</li>
        <li><strong>Specific Volume Minimum:</strong> Must be > 0 m³/kg (positive volume)</li>
        <li><strong>Mass Flux (G):</strong> Must be between 1–1,000 kg/m²·s (API 521 design limits)</li>
        <li><strong>Mass Flux Minimum:</strong> Must be > 0 kg/m²·s (positive flow rate)</li>
        <li><strong>Volume (V):</strong> Must be between 0.001–10,000 m³ (vessel size range)</li>
        <li><strong>Volume Minimum:</strong> Must be > 0 m³ (positive capacity)</li>
        <li><strong>Latent Heat (hₓₐ):</strong> Must be between 1–10,000 kJ/kg (fluid property limits)</li>
        <li><strong>Latent Heat Minimum:</strong> Must be > 0 kJ/kg (positive energy requirement)</li>
    </ul>
</div>
<div class="note-card">
    <h3>🔎 Output Validations</h3>
    <ul class="note-list">
        <li><strong>Vent Area < 0.001 m²:</strong> 🔴 Very small vent area — check inputs.</li>
        <li><strong>0.001 ≤ Vent Area < 0.01 m²:</strong> 🟢 Small/Optimal - Acceptable for small tanks & low heat flux</li>
        <li><strong>0.01 ≤ Vent Area < 0.1 m²:</strong> 🟡 Moderate - Expected in most industrial scenarios</li>
        <li><strong>0.1 ≤ Vent Area < 1.0 m²:</strong> 🟠 Large - High fire load or large inventory; review inputs</li>
        <li><strong>Vent Area ≥ 1.0 m²:</strong> 🔴 Very Large - Extreme condition; verify inputs and consult safety engineer</li>
    </ul>
</div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        The no-overpressure vent area formula for external heating is covered by the American Petroleum Institute (API) Standard 521, Pressure-relieving and Depressuring Systems. The calculations provided in API 521 are used to size pressure relief devices (PRDs) for vessels exposed to external fire.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Key Details from API 521</h3>
    <ul class="note-list">
        <li><b>Purpose:</b> To protect pressure vessels from overpressure caused by the heat input from an external fire.</li>
        <li><b>Scenario:</b> The formulas apply to emergency venting conditions, such as when an external fire engulfs a storage tank containing flammable liquids or gases.</li>
        <li><b>Heat input:</b> The standard provides formulas for calculating the rate of heat absorption due to fire exposure. For vessels with flammable liquids, the heat input causes vaporization, which is the primary source of overpressure.</li>
        <li><b>Wetted surface area:</b> Calculations often depend on the "wetted surface area" of the vessel—the portion of the vessel in contact with the liquid contents that is exposed to the fire.</li>
        <li><b>Basis of formulas:</b> The formulas in API 521 are based on a set of assumptions, which is why more rigorous, dynamic simulations may be needed for specific cases.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Why "No-Overpressure" Might Be Misleading</h3>
    <p>
        While API 521 is used for emergency venting due to external heating, the term "no-overpressure" is not technically correct in the context of pressure relief. The goal of a PRD is to prevent pressure from exceeding a maximum allowable value, but it does so by allowing a controlled amount of overpressure (typically 10% to 21% above the set pressure) to open and operate the device.
    </p>
    <p>
        The phrase "no-overpressure" is sometimes used colloquially or in simplified calculators, but the actual sizing standard (API 521) accounts for a regulated degree of overpressure during an emergency relief event.
    </p>
</div>
<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines the <strong>required vent area</strong> to prevent overpressure in vessels exposed 
        to external heating, ensuring safe pressure relief during fire exposure scenarios. By accurately sizing 
        vent areas based on thermodynamic principles and industry standards, it supports proper pressure management, 
        prevents catastrophic equipment failure, and maintains compliance with NFPA 30, API 521, and ISO 23251 
        requirements for fire protection and process safety.
    </p>
</div>
        </div>
    </div>

    <script>
         document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
        function calculateVentArea() {
    // Get input values
    let QT  = parseFloat(document.getElementById("QT").value);
    let mo  = parseFloat(document.getElementById("mo").value);
    let vfa = parseFloat(document.getElementById("vfa").value);
    let G   = parseFloat(document.getElementById("G").value);
    let V   = parseFloat(document.getElementById("V").value);
    let hfa = parseFloat(document.getElementById("hfa").value);

    // Reset error display
    document.getElementById("resultError").classList.add("hidden");
    document.getElementById("placeholder").classList.add("hidden");

    let errorMessage = "";

    // === Validation Rules ===
    // 1. Check completeness
    if ([QT, mo, vfa, G, V, hfa].some(isNaN)) {
        errorMessage = "⚠️ All fields must be filled with numeric values.";
    }

    // 2. Positive values only
    else if (QT <= 0) errorMessage = "Qₜ must be > 0 kJ/min.";
    else if (mo <= 0) errorMessage = "m₀ must be > 0 kg.";
    else if (vfa <= 0) errorMessage = "vₓₐ must be > 0 m³/kg.";
    else if (G <= 0) errorMessage = "G must be > 0 kg/m²·s.";
    else if (V <= 0) errorMessage = "V must be > 0 m³.";
    else if (hfa <= 0) errorMessage = "hₓₐ must be > 0 kJ/kg.";

    // 3. Realistic ranges (industry data)
    else if (QT > 100000) errorMessage = "Qₜ unusually high. Verify input.";
    else if (mo > 100000) errorMessage = "m₀ unusually high. Verify input.";
    else if (vfa > 10) errorMessage = "vₓₐ too large for typical fluids.";
    else if (G > 1000) errorMessage = "G exceeds practical design values.";
    else if (V > 10000) errorMessage = "V too large for standard vessels.";
    else if (hfa > 10000) errorMessage = "hₓₐ exceeds known fluid properties.";

    // Edge case: Prevent division by zero
    else if (G * V * hfa === 0) {
        errorMessage = "Invalid denominator (G·V·hₓₐ = 0). Check inputs.";
    }

    // Handle validation error
    if (errorMessage) {
        document.getElementById("errorMessage").innerText = errorMessage;
        document.getElementById("resultError").classList.remove("hidden");
        document.getElementById("resultValue").classList.add("hidden");
        return;
    }

    // === Calculation ===
    let Ao = (QT * mo * vfa) / (G * V * hfa);

    // Display result
    document.getElementById("rateValue").innerText = Ao.toFixed(6);
    document.getElementById("resultValue").classList.remove("hidden");

    // === Visualization ===
    let meterPercentage = Math.min(100, Math.max(0, (Math.log10(Ao + 0.001) + 3) * 20));
    document.getElementById("meterFill").style.width = meterPercentage + "%";

    if (Ao < 0.001) document.getElementById("meterFill").style.background = "linear-gradient(to right, #2e7d32, #4caf50)";
    else if (Ao < 0.01) document.getElementById("meterFill").style.background = "linear-gradient(to right, #4caf50, #8bc34a)";
    else if (Ao < 0.1) document.getElementById("meterFill").style.background = "linear-gradient(to right, #8bc34a, #ffeb3b)";
    else if (Ao < 1) document.getElementById("meterFill").style.background = "linear-gradient(to right, #ffeb3b, #ff9800)";
    else document.getElementById("meterFill").style.background = "linear-gradient(to right, #ff9800, #f44336)";

    // === Feedback ===
    let feedbackContent = "";
    if (Ao < 0.001) feedbackContent = "Very small vent area — check inputs.";
    else if (Ao < 0.01) feedbackContent = "Small/Optimal - Acceptable for small tanks & low heat flux";
    else if (Ao < 0.1) feedbackContent = " Moderate - Expected in most industrial scenarios";
    else if (Ao < 1) feedbackContent = " Large - High fire load or large inventory; review inputs";
    else feedbackContent = "Very large  — Extreme condition; verify inputs and consult safety engineer.";

    document.getElementById("feedbackContent").innerText = feedbackContent;
}

        
        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used (for code comment and documentation)
// Formula for Required Vent Area (Ao):
// Ao = (QT * mo * vfa) / (G * V * hfa)
//
// Where:
// QT  = Constant External Heat Input [kJ/min]
// mo  = Initial Mass of Liquid [kg]
// vfa = Specific Volume of Liquid [m³/kg]
// G   = Mass Flux [kg/m²·s]
// V   = Vessel Volume [m³]
// hfa = Latent Heat of Vaporization [kJ/kg]
//
// Purpose: Calculate minimum vent area to prevent
// overpressure during external fire/external heating
// in accordance with NFPA/OSHA process safety principles.

2. Input Validation Rules (QEHS & Fire Safety Practice)
Parameter	Meaning	Unit	Industry Typical Range	Validation Rules	Compliance Rationale
Qₜ	Constant External Heat Input	kJ/min	100 – 10,000 (industrial vessels, fire exposure)	>0, ≤100,000	Too low = unrealistic fire heat flux; too high = outlier. NFPA 30/ISO 23251 (fire exposure basis).
m₀	Initial Liquid Mass	kg	10 – 10,000	>0, ≤100,000	Negative/zero mass invalid; unusually high mass = check input vs tank size.
vₓₐ	Specific Volume	m³/kg	0.001 – 0.1 (water/chemicals)	>0, ≤10	Must stay within fluid thermophysical property ranges (NIST/engineering DB).
G	Mass Flux	kg/m²·s	5 – 100	>0, ≤1,000	Prevents division by zero; >1,000 would exceed practical relief vent design (API 521).
V	Vessel Volume	m³	1 – 100 (tanks)	>0, ≤10,000	Zero volume invalid; high values indicate unrealistic input.
hₓₐ	Latent Heat of Vaporization	kJ/kg	200 – 2,500	>0, ≤10,000	Negative/zero impossible; too high = beyond real fluids.
3. Output Validation & Thresholds

For vent area (Ao):

Range	Classification	Safety Meaning
< 0.001 m²	Very Small	Likely underestimation, possible unsafe venting.
0.001 – 0.01 m²	Small / Optimal	Acceptable for small tanks & low heat flux.
0.01 – 0.1 m²	Moderate	Expected in most industrial scenarios.
0.1 – 1.0 m²	Large	High fire load or large inventory; review inputs.
>1.0 m²	Very Large	Extreme condition; check input realism and consult safety engineer.

Compliance tie-in:
NFPA 68, API 521, ISO 28300 all recommend checking vent sizing against credible scenarios. The thresholds help flag unrealistic or extreme outcomes. {% endcomment %}