{% extends 'base.html' %}
{% block title %}Emergency Drill Success Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Drill Success Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
             .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }


        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
      <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Emergency Drill Success Rate Calculator</h1>
            <p>Calculate your emergency drill performance based on planned vs. completed drills</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="completedDrills">Number of Completed Drills</label>
                    <input type="number" id="completedDrills" class="form-input" min="0" placeholder="e.g., 8">
                </div>
                <div class="form-group">
                    <label for="plannedDrills">Number of Planned Drills</label>
                    <input type="number" id="plannedDrills" class="form-input" min="1" placeholder="e.g., 10">
                </div>
                
                <button class="calculate-btn" onclick="calculateSuccessRate()">Calculate Success Rate</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Emergency Drill Success Rate</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Emergency Drill Success Rate</h2>
                    </div>
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Percentage of drills successfully completed</div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Poor</span><span>Fair</span><span>Good</span><span>Very Good</span><span>Excellent</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Performance Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Emergency Drill Success Rate Calculator</strong> helps evaluate emergency preparedness by 
                    measuring the percentage of planned drills that were successfully completed.
                </p>
                                <p>Drill Success Rate is a key performance indicator that shows how effectively your organization is executing planned emergency drills and maintaining preparedness.</p>

            </div>
          
            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Completed Drills:</strong> The number of emergency drills that were actually carried out successfully.</li>
                    <li><strong>Planned Drills:</strong> The total number of drills that were scheduled to take place.</li>
                </ul>
            </div>
            
           
            <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <p>To ensure accurate and meaningful results, the following rules are applied to the Emergency Drill Success Rate Calculator inputs:</p>
    <ul class="note-list">
        <li><strong>Completed Drills:</strong> Must be a whole number (integer), ≥ 0, ≤ Planned Drills, with a realistic maximum of 100. This ensures logical consistency and prevents unrealistic entries. Decimal or negative values are invalid.</li>
        <li><strong>Planned Drills:</strong> Must be a whole number (integer), > 0, within a realistic range of 1–100. This prevents division by zero and unrealistic planning numbers.</li>
        <li><strong>No decimals:</strong> Both Completed and Planned Drills must be integers. Partial drills do not exist, and this preserves data integrity.</li>
        <li><strong>No negatives:</strong> Inputs cannot be negative, as negative drill counts are logically impossible.</li>
        <li><strong>Completed ≤ Planned:</strong> The number of drills completed cannot exceed the number planned. This prevents success rates above 100% and ensures logical consistency.</li>
        <li><strong>No division by zero:</strong> Planned Drills must not be 0, since dividing by zero is mathematically undefined.</li>
        <li><strong>Output:</strong> The Success Rate is shown as a percentage (0–100%) and rounded to 2 decimal places for clarity and readability.</li>
    </ul>
    <p><b>Purpose:</b> These validations ensure the calculator provides accurate, realistic, and reliable results, avoiding errors in input and calculation.</p>
    <p><b>Regulatory Alignment:</b> These rules follow international and industry standards including <strong>ISO 45001</strong> (occupational health and safety), <strong>NFPA 1600</strong> (disaster/emergency management), and <strong>OSHA</strong> emergency preparedness KPIs. Compliance with these standards ensures the results are meaningful for audits, reporting, and continuous improvement in emergency preparedness.</p>
</div>

 <div class="note-card">
    <h3>📊 Output Validations</h3>
    <p>This range represents the overall success rate of drill execution and emergency preparedness performance:</p>
    <ul class="note-list">
        <li>90–100% → 🌟 Excellent performance! Nearly all planned drills were completed successfully.</li>
        <li>75–89% → ✅ Good performance. Most drills completed as planned.</li>
        <li>60–74% → ⚠️ Fair performance. Room for improvement in drill execution.</li>
        <li>40–59% → 🚨 Poor performance. Review drill planning and execution processes.</li>
        <li>Below 40% → ❌ Critical failure. Immediate action required to improve emergency preparedness.</li>
    </ul>
</div>
<div class="note-card">
    <h3>📏 Governing Principle</h3>
    <p>
        There is no single, universal standard for an <strong>Emergency Drill Success Rate Calculator</strong>. The calculation and evaluation of success are dependent on an organization's specific industry, regulatory requirements, and internal objectives. Instead of a single standard, companies often use key performance indicators (KPIs) and frameworks from recognized standards and best practices to measure drill success.
    </p>

    <h3>Common Standards that Inform Drill Success Metrics</h3>
    <ul class="note-list">
        <li><strong>NFPA (National Fire Protection Association):</strong> NFPA codes like NFPA 101 (Life Safety Code) provide requirements for the frequency, documentation, and procedures of egress drills, especially in schools and healthcare facilities.</li>
        <li><strong>ISO 22301:</strong> The international standard for Business Continuity Management Systems (BCMS) that requires regular testing and exercises of continuity plans to assess resilience against threats such as cyberattacks and natural disasters.</li>
        <li><strong>OSHA (Occupational Safety and Health Administration):</strong> Mandates that employers conduct emergency drills and train employees for appropriate response actions.</li>
        <li><strong>Regulatory Bodies:</strong> Specific sectors, such as healthcare (Joint Commission) or oil & gas (OISD), have industry-specific standards for emergency preparedness and drills.</li>
    </ul>
<br>
    <h3>Key Metrics for Evaluating Drill Success</h3>
    <ul class="note-list">
        <li><strong>Time Benchmarks:</strong> Duration to evacuate, reach muster points, or complete drills.</li>
        <li><strong>Employee Performance:</strong> Adherence to roles, communication, and response accuracy during drills.</li>
        <li><strong>Completeness and Compliance:</strong> Whether all objectives and internal plans were followed.</li>
        <li><strong>Performance Against a Baseline:</strong> Comparing current results to previous drills for improvement tracking.</li>
        <li><strong>Drill Completion Rate:</strong> The percentage of scheduled drills completed within a specific period.</li>
    </ul>

   <br>

    <h3>How to Approach Your Own Calculation</h3>
    <ul class="note-list">
        <li><strong>Define Objectives:</strong> Identify goals such as reducing evacuation time or testing new protocols.</li>
        <li><strong>Establish KPIs:</strong> Determine measurable factors like communication efficiency or response accuracy.</li>
        <li><strong>Create an Evaluation Framework:</strong> Use checklists or rating systems inspired by NFPA, ISO, or internal standards.</li>
        <li><strong>Implement a Scoring System:</strong> Assign scores to each KPI and aggregate them into an overall success rating for a comprehensive assessment.</li>
    </ul>
</div>

<div class="note-card">
    <h3>📈 Conclusion</h3>
    <p>
        The Emergency Drill Success Rate Calculator provides a quick and reliable measure of your organization's emergency preparedness effectiveness. 
        A higher success rate indicates strong safety culture, proper planning, and consistent execution of emergency drills. 
        Regular monitoring of this rate helps ensure compliance with safety objectives, identify improvement areas, and strengthen overall response readiness. 
        Maintaining a success rate above <b>90%</b> reflects excellent preparedness and aligns with best practices for organizational safety performance.
    </p>
</div>

        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateSuccessRate() {
    const completedDrills = document.getElementById('completedDrills').value.trim();
    const plannedDrills = document.getElementById('plannedDrills').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // Completed Drills validation
    if (completedDrills === "") {
        errors.push("👉 Please enter the number of completed drills.");
    } else {
        const num = Number(completedDrills);
        if (isNaN(num) || num < 0) {
            errors.push("👉 Completed drills must be a whole number ≥ 0.");
        } else if (!Number.isInteger(num)) {
            errors.push("👉 Completed drills must be an integer value.");
        } else if (num > 100) {
            errors.push("👉 Completed drills seem unrealistically high (>100). Please verify.");
        }
    }

    // Planned Drills validation
    if (plannedDrills === "") {
        errors.push("👉 Please enter the number of planned drills.");
    } else {
        const num = Number(plannedDrills);
        if (isNaN(num) || num <= 0) {
            errors.push("👉 Planned drills must be a whole number greater than 0.");
        } else if (!Number.isInteger(num)) {
            errors.push("👉 Planned drills must be an integer value.");
        } else if (num > 100) {
            errors.push("👉 Planned drills seem unrealistically high (>100). Please verify.");
        }
    }

    // Cross-field validation
    if (completedDrills !== "" && plannedDrills !== "") {
        const c = Number(completedDrills);
        const p = Number(plannedDrills);
        if (c > p) {
            errors.push("👉 Completed drills cannot exceed planned drills.");
        }
    }

    // Handle errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Calculation
    const C = parseInt(completedDrills);
    const P = parseInt(plannedDrills);
    const successRate = (C / P) * 100;

    if (!isFinite(successRate) || successRate < 0) {
        errorMessage.innerHTML = "❌ Invalid calculation result. Please check inputs.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    document.getElementById('rateValue').textContent = successRate.toFixed(2) + "%";

    // Feedback thresholds
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (successRate >= 90) {
        meterWidth = '95%';
        meterColor = '#27ae60';
        feedback = '🌟 Excellent performance! Nearly all planned drills were completed successfully.';
    } else if (successRate >= 75) {
        meterWidth = '75%';
        meterColor = '#2ecc71';
        feedback = '✅ Good performance. Most drills completed as planned.';
    } else if (successRate >= 60) {
        meterWidth = '60%';
        meterColor = '#f1c40f';
        feedback = '⚠️ Fair performance. Room for improvement in drill execution.';
    } else if (successRate >= 40) {
        meterWidth = '45%';
        meterColor = '#e67e22';
        feedback = '🚨 Poor performance. Review drill planning and execution processes.';
    } else {
        meterWidth = '25%';
        meterColor = '#e74c3c';
        feedback = '❌ Critical failure. Immediate action required to improve emergency preparedness.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used

👉 Emergency Drill Success Rate (%)

Success Rate
=
(
Completed Drills
Planned Drills
)
×
100
Success Rate=(
Planned Drills
Completed Drills
	​

)×100

Completed Drills (C): Actual drills executed successfully.

Planned Drills (P): Drills scheduled as per annual/monthly safety plan.

Condition: 
𝑃
>
0
P>0, 
0
≤
𝐶
≤
𝑃
0≤C≤P.

This is the standard KPI formula used in ISO 45001:2018 clause 9.1 (performance evaluation) and in NFPA 1600 / OSHA emergency preparedness programs.

2. Detailed Input Validation Rules (based on QEHS/Fire Safety)
✅ Completed Drills

Must be a whole number (no decimals).

Minimum = 0 (can have zero drills completed).

Maximum = should not exceed Planned Drills.

Hard cap for practicality: ≤ 100 per year (for annual tracking; adjust if monthly/quarterly).

✅ Planned Drills

Must be a whole number.

Minimum = 1 (cannot plan zero drills).

Maximum = 100 (beyond this is unrealistic for most organizations).

Must be ≥ Completed Drills.

✅ Cross-Field Validations

Completed ≤ Planned (logical consistency).

No division by zero (Planned cannot be 0).

If Planned = 1 and Completed = 0, still valid (0% success).

✅ Units of Measure

Both values are counts (no units).

✅ Allowed Decimals

Inputs: integers only.

Outputs: success rate rounded to 2 decimals.

3. Output Validation Logic & Thresholds

These thresholds are industry-aligned:

≥ 90% → Excellent (ISO/OSHA benchmark for compliance & audit readiness).

75–89% → Good (acceptable, minor improvements).

60–74% → Fair (warning zone, may fail external audit).

40–59% → Poor (non-compliance risk, corrective action required).

< 40% → Critical Failure (serious safety risk, urgent intervention required).

This maps directly to audit scoring systems used in NFPA emergency preparedness evaluations.

4. Edge Cases & Handling

Completed = 0, Planned = 1 → Valid, returns 0%.

Completed = Planned → Always 100% (perfect compliance).

Planned = 0 → Invalid (blocked at validation).

Completed > Planned → Invalid (logical error).

Extreme values (e.g., 999) → Rejected with “too high, please verify.”

Decimals entered (e.g., 3.5) → Rejected, must be integer.

Negative inputs → Rejected immediately.

Empty fields → Prompted as required fields.

5. Corrected JavaScript Code (with comments)


/*
========================================
 Emergency Drill Success Rate Calculator
 Formula:
   Success Rate (%) = (Completed Drills / Planned Drills) * 100

 Validation Rules (ISO 45001 / NFPA / OSHA):
 - Completed Drills: integer, >= 0, <= Planned Drills, <= 100
 - Planned Drills: integer, > 0, realistic range 1–100
 - Completed Drills cannot exceed Planned Drills
 - No decimals, no negatives, no text
 - Division by zero not allowed (Planned > 0)
 - Output: 0–100%, rounded to 2 decimals
========================================
*/

{% endcomment %}