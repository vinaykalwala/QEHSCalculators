{% extends 'base.html' %}
{% block title %}2:1 Ellipsoidal Head Radius Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2:1 Ellipsoidal Head Radius Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
            justify-content: center;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>2:1 Ellipsoidal Head Radius Calculator</h1>
            <p>Calculate the spherical radius for pressure vessel head design.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Vessel Parameter</h2>
                <div class="form-group">
                    <label for="innerDiameter">Inner Diameter (ID) [inches]</label>
                    <input type="number" id="innerDiameter" class="form-input" placeholder="Enter Inner Diameter">
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Engineering illustration">
                    <p>Enter the inner diameter to calculate the spherical radius of the ellipsoidal head.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Spherical Radius (L)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.000</div>
                        <div class="rate-label">inches</div>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Summary</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                       <div class="btn-wrapper">
                            <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                        </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>2:1 Ellipsoidal Head Radius Calculator</strong> is a tool for pressure vessel design that determines the effective spherical radius (L) of a 2:1 ellipsoidal head. This calculation is a critical first step in applying ASME code formulas to determine the required thickness of the head to safely withstand internal pressure.
                </p>
            </div>
            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Inner Diameter (ID):</strong> The internal diameter of the cylindrical shell of the pressure vessel to which the head will be attached, measured in inches.</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li>The <strong>Inner Diameter (ID)</strong> must be a positive number greater than zero.</li>
                    <li>The calculator recommends using values within a realistic industrial range (6 to 600 inches) to prevent unrealistic design parameters.</li>
                    <li>Empty, zero, or negative inputs are considered invalid and will prevent the calculation.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>Output Validations</h3>
                 <p>The output provides a summary of the calculation and includes a safety check based on the input value:</p>
                <ul class="note-list">
                    <li><span class="good">‚úÖ The calculated spherical radius is based on an inner diameter of <strong>[Value] inches</strong>, applying the standard 90% approximation for 2:1 ellipsoidal heads.</span></li>
                    <li><span class="average">‚ö†Ô∏è <strong>Warning:</strong> Inner diameter is outside typical industrial range. Verify dimensions for safe design.</span> (This warning appears if the ID is outside the 6-600 inch range).</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>Governing Principle</h3>
                <p>
                    The calculation of the radius for a 2:1 ellipsoidal head is primarily governed by the <strong>ASME Boiler and Pressure Vessel Code, Section VIII, Division 1</strong>. Specifically, the formulas for calculating the thickness of 2:1 ellipsoidal heads are provided in paragraph <strong>UG-32(d)</strong> of this standard. Additionally, the general formulas for all elliptical heads within the dimensional scope are addressed in <strong>Appendix 1-4</strong>.
                </p>
            </div>
            <div class="note-card">
                <h3>Conclusion</h3>
                <p>
                    This calculator simplifies a fundamental step in pressure vessel head design according to ASME standards. By providing the effective spherical radius, it enables engineers to proceed with the necessary thickness calculations to ensure the vessel's structural integrity and safety. Always cross-reference final designs with the full ASME code for compliance.
                </p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            // Reset UI
            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];

            // Validation function
            function getVal(id, label, opts = {}) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();

                if (!raw) {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }

                const num = parseFloat(raw);

                if (isNaN(num) || num <= 0) {
                    errors.push(`üëâ Enter a valid positive number for ${label}.`);
                    return null;
                }

                if (opts.min !== undefined && num < opts.min) {
                    errors.push(`üëâ ${label} must be ‚â• ${opts.min} for typical applications.`);
                }

                if (opts.max !== undefined && num > opts.max) {
                    errors.push(`üëâ ${label} must be ‚â§ ${opts.max} for typical applications.`);
                }

                return num;
            }

            // Input: Inner Diameter with industrial limits
            const innerDiameter = getVal('innerDiameter', 'Inner Diameter');

            // Display errors if any
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove('hidden');
                placeholder.classList.add('hidden');
                return;
            }

            // Calculation: Spherical radius for 2:1 ellipsoidal head
            const sphericalRadius = innerDiameter * 0.9;

            // Display result
            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');
            document.getElementById('rateValue').textContent = sphericalRadius.toFixed(4);

            // Feedback message with warnings for extreme values
            let feedback = `<span class="good">‚úÖ The calculated spherical radius is based on an inner diameter of <strong>${innerDiameter} inches</strong>, applying the standard 90% approximation for 2:1 ellipsoidal heads.</span>`;

            if (innerDiameter < 6 || innerDiameter > 600) {
                feedback += ` <br><span class="average"><strong>‚ö†Ô∏è Warning:</strong> Inner diameter is outside typical industrial range. Verify dimensions for safe design.</span>`;
            }

            document.getElementById('feedbackContent').innerHTML = feedback;
        }

        // Print functionality
        function printReport() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>

</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (QEHS Perspective)
Input	Acceptable Range	Units	Decimal Handling	Cross-field / Logical Checks	Reason
Inner Diameter (ID)	> 0, typical industrial range 6‚Äì600 inches	inches	1‚Äì3 decimal places allowed	Must be realistic for pressure vessels; extremely small or huge diameters may indicate user error	Ensures design feasibility, avoids calculation errors, aligns with ASME Section VIII / NFPA vessel sizing norms

Additional Notes on Validation:

Prevents zero or negative values, which are physically impossible.

Alerts if input is extremely small (<6 in) or extremely large (>600 in) for industrial vessels.

Only numeric input accepted; blank or non-numeric entries are flagged.

Decimals are allowed but must be positive.

2. Output Validation Logic & Thresholds

Formula:

Spherical¬†Radius¬†
ùêø
=
ùêº
ùê∑
√ó
0.9
Spherical¬†Radius¬†L=ID√ó0.9

Output Checks:

L must be positive.

Feedback warning if ID is unrealistically small (<6 in) or too large (>600 in).

Provides clear confirmation for standard 2:1 ellipsoidal heads.

Rationale:

Prevents users from using vessel dimensions outside accepted engineering standards.

Provides audit-ready feedback messages for QEHS safety documentation.

3. Edge Cases to Handle
Edge Case	Handling
ID = 0	Reject input; alert ‚ÄúID must be positive‚Äù
Negative ID	Reject input; alert ‚ÄúID must be positive‚Äù
Extremely large ID (e.g., >600 in)	Show warning: ‚ÄúVerify input; unusually large diameter‚Äù
Non-numeric input	Reject and display ‚ÄúEnter valid numeric value‚Äù
Blank input	Prompt user to enter a value
-->