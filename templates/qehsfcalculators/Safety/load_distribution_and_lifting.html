{% extends 'base.html' %}
{% block title %}Load Distribution & Lifting Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Distribution & Lifting Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 480px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display:flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .tension-value {
            font-size: 36px;
            font-weight: 700;
            color: #2980b9;
            margin: 15px 0;
        }
        
        .tension-label {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Load Distribution & Lifting Calculator</h1>
            <p>Calculate the tension per sling for safe lifting operations</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="totalLoad">Total Load (W in kg)</label>
                    <input type="number" id="totalLoad" class="form-input" min="1" placeholder="e.g., 1000">
                </div>
                <div class="form-group">
                    <label for="slingCount">Number of Slings (n)</label>
                    <input type="number" id="slingCount" class="form-input" min="1" placeholder="e.g., 4">
                </div>
                <div class="form-group">
                    <label for="slingAngle">Sling Angle (Œ≤ in degrees)</label>
                    <input type="number" id="slingAngle" class="form-input" min="1" max="89" placeholder="e.g., 45">
                </div>
                
                <button class="calculate-btn" onclick="calculateLiftingTension()">Calculate Lifting Tension</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Lifting illustration">
                    <p>This tool will calculate the <strong>Lifting Sling Tension</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Lifting Sling Tension</h2>
                    </div>
                    <div class="rate-display">
                        <div class="tension-value" id="tensionValue">0.00</div>
                        <div class="tension-label" style="color:#2980b9; font-size:20px; font-weight:bold;">kg per sling</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Safety Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
 <div class="note-section">

  <!-- üìò ABOUT -->
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      The <strong>Load Distribution & Lifting Calculator</strong> determines the tension on each sling 
      when lifting a load, helping ensure safe lifting operations by preventing overloading of slings.
    </p>
  </div>

  <!-- ‚öôÔ∏è PARAMETERS USED -->
  <div class="note-card">
    <h3>‚öôÔ∏è Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Total Load (W):</strong> The overall weight being lifted (in kg)</li>
      <li><strong>Number of Slings (n):</strong> The number of slings supporting the load</li>
      <li><strong>Sling Angle (Œ≤):</strong> The angle at which the sling is attached (in degrees). A smaller angle increases tension.</li>
    </ul>
  </div>

  <!-- ‚úÖ INPUT VALIDATION RULES -->
  <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>Total Load (W):</b> 1 ‚Äì 1,000,000 kg, positive number, decimals allowed</li>
      <li><b>Number of Slings (n):</b> Integer between 1 ‚Äì 100</li>
      <li><b>Sling Angle (Œ≤):</b> 1 ‚Äì 89¬∞ (angles ‚â•90¬∞ are unsafe and invalid)</li>
      <li><b>Cross-Validation:</b> Formula denominator (n √ó cos Œ≤) must not be zero</li>
      <li><b>Output Check:</b> Tension is flagged as safe, caution, or unsafe based on sling share and angle</li>
    </ul>
  </div>

  <!-- üßæ OUTPUT VALIDATIONS -->
  <div class="note-card">
    <h3>üßæ Output Validations</h3>
    <ul class="note-list">
      <li>The calculated sling tension is displayed along with feedback to interpret safety.</li>
      <li><b>Assessment / Feedback Messages:</b></li>
      <ul class="note-sublist">
        <li>‚úÖ Good configuration: Sling tension close to vertical share, safe setup.</li>
        <li>‚ö†Ô∏è Caution: Increased tension due to angle. Monitor carefully.</li>
        <li>‚ùå Unsafe: Sling angle creates excessive tension. Reconfigure lift.</li>
      </ul>
      <li>Feedback messages appear alongside the result to guide safe lifting decisions.</li>
    </ul>
  </div>

  <!-- ‚öñÔ∏è GOVERNING PRINCIPLE -->
  <div class="note-card">
    <h3>‚öñÔ∏è Governing Principle</h3>
    <p>
      A "Load Distribution & Lifting Calculator" isn't tied to a single standard but adheres to various industry 
      and national standards, most notably ASME (American Society of Mechanical Engineers) for lifting equipment safety 
      and design, OSHA (Occupational Safety and Health Administration) for workplace safety regulations, and sometimes 
      Indian Standards (IS) for construction and material handling in India. The specific standard(s) applied depend on 
      the calculator's purpose and the geographic region or industry for which it was designed.
    </p>
    <ul class="note-list">
      <li><strong>ASME:</strong> The ASME B30 standards ensure lifting devices and equipment meet safety and performance requirements.</li>
      <li><strong>OSHA:</strong> Sets workplace safety standards; calculators ensure compliance to prevent accidents.</li>
      <li><strong>Indian Standards (IS):</strong> For example, IS 3177 for overhead lifting in India ensures proper load assessments and safe operations.</li>
      <li><strong>Design & Safety Factors:</strong> Calculators determine appropriate dimensions, material properties, and safety factors for lifting components.</li>
      <li><strong>Workplace Safety:</strong> Ensures calculations comply with OSHA regulations.</li>
      <li><strong>Regulatory Compliance:</strong> Ensures lifting operations meet national and regional safety laws and industry best practices.</li>
    </ul>
    <p>
      In summary, a load distribution and lifting calculator follows standards relevant to its application 
      (ASME, OSHA, IS) to ensure accuracy, safety, and regulatory compliance.
    </p>
  </div>

  <!-- üèÅ CONCLUSION -->
  <div class="note-card">
    <h3>üèÅ Conclusion</h3>
    <p>
      This calculator provides safe lifting guidance with corresponding feedback messages that reflect 
      tension distribution and potential risks. By interpreting results according to the assessments, 
      users can plan safe lifting operations, avoid overloading slings, and ensure compliance with safety regulations.
    </p>
  </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateLiftingTension() {
    const totalLoad = document.getElementById('totalLoad').value.trim();
    const slingCount = document.getElementById('slingCount').value.trim();
    const slingAngle = document.getElementById('slingAngle').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    /*
    VALIDATION RULES:
    - Total Load (W): 1 ‚Äì 1,000,000 kg (positive number, decimals allowed)
    - Sling Count (n): 1 ‚Äì 100 (integer only)
    - Sling Angle (Œ≤): 1 ‚Äì 89¬∞ (no zero or 90¬∞)
    - Cross-field: Ensure n* cos(Œ≤) ‚â† 0 (avoids division by zero)
    */

    // Total Load
    if (totalLoad === "" || isNaN(totalLoad)) {
        errors.push("üëâ Please enter the total load.");
    } else if (parseFloat(totalLoad) <= 0) {
        errors.push("üëâ Total load must be greater than 0 kg.");
    } else if (parseFloat(totalLoad) > 1000000) {
        errors.push("üëâ Total load cannot exceed 1,000,000 kg.");
    }

    // Sling Count
    if (slingCount === "" || isNaN(slingCount)) {
        errors.push("üëâ Please enter the number of slings.");
    } else if (!Number.isInteger(parseFloat(slingCount))) {
        errors.push("üëâ Number of slings must be a whole number.");
    } else if (parseInt(slingCount) <= 0) {
        errors.push("üëâ Number of slings must be at least 1.");
    } else if (parseInt(slingCount) > 100) {
        errors.push("üëâ Number of slings cannot exceed 100.");
    }

    // Sling Angle
    if (slingAngle === "" || isNaN(slingAngle)) {
        errors.push("üëâ Please enter the sling angle.");
    } else if (parseFloat(slingAngle) <= 0) {
        errors.push("üëâ Sling angle must be greater than 0¬∞.");
    } else if (parseFloat(slingAngle) >= 90) {
        errors.push("üëâ Sling angle must be less than 90¬∞.");
    }

    // Show errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join('<br>');
        errorBox.classList.remove('hidden');
        placeholder.classList.add('hidden');
        resultValue.classList.add('hidden');
        return;
    }

    errorBox.classList.add('hidden'); // hide error if none

    // Parse safe values
    const W = parseFloat(totalLoad);
    const n = parseInt(slingCount);
    const beta = parseFloat(slingAngle);
    const betaRad = beta * (Math.PI / 180);

    // Edge Case: Avoid division by zero
    if (n * Math.cos(betaRad) === 0) {
        errorMessage.innerHTML = "‚ö†Ô∏è Invalid configuration: sling angle too close to 90¬∞ or sling count invalid.";
        errorBox.classList.remove('hidden');
        return;
    }

    // Calculate tension
    const T = W / (n * Math.cos(betaRad));
    document.getElementById('tensionValue').textContent = T.toFixed(2);

    // Feedback based on load share
    let feedback = "";
    const verticalShare = W / n;

    if (T <= verticalShare * 1.1) {
        feedback = "‚úÖ <strong>Good configuration:</strong> Sling tension close to vertical share, safe setup.";
    } else if (T <= verticalShare * 2) {
        feedback = "‚ö†Ô∏è <strong>Caution:</strong> Increased tension due to angle. Monitor carefully.";
    } else {
        feedback = "‚ùå <strong>Unsafe:</strong> Sling angle creates excessive tension. Reconfigure lift.";
    }

    feedback += `<br><br>For ${n} slings at ${beta}¬∞, each sling experiences <strong>${T.toFixed(2)} kg</strong> of tension when lifting a ${W} kg load.`;

    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

{% comment %} 
üìê Formula (for commenting in code)
/*
FORMULA USED (based on rigging/lifting engineering principles):

T = W / (n * cos(Œ≤))

Where:
  T = Tension per sling (kg)
  W = Total Load (kg)
  n = Number of slings
  Œ≤ = Sling angle from vertical (degrees)

NOTES:
- As sling angle Œ≤ decreases, cos(Œ≤) decreases ‚Üí Tension per sling increases.
- At Œ≤ = 90¬∞, cos(Œ≤) = 0 ‚Üí tension approaches infinity (unsafe, prohibited).
- Reference: OSHA 29 CFR 1926.251, ASME B30.9, ISO 12480-1, NFPA 70E rigging guidance.
*/

‚úÖ Detailed Input Validation Rules (real-world QEHS/fire safety perspective)

Total Load (W in kg)

Unit: kilograms (kg)

Acceptable range: 1 ‚Äì 1,000,000 kg

Must be numeric, positive, and not exceed industry lifting limits.

Decimal values allowed (e.g., 1234.56 kg).

Validation reason: Negative or zero loads are nonsensical; overly large loads exceed safe working loads for most lifting systems.

Number of Slings (n)

Unit: count (no decimals)

Acceptable range: 1 ‚Äì 100 slings

Must be a whole integer.

Validation reason: Fractional slings aren‚Äôt possible; too many slings (>100) is unrealistic. OSHA/ASME usually consider up to 8‚Äì12 slings practical.

Sling Angle (Œ≤ in degrees)

Unit: degrees (¬∞ from vertical)

Acceptable range: 1 ‚Äì 89¬∞

Must be numeric, non-zero, and strictly less than 90¬∞.

Validation reason: Angles ‚â•90¬∞ ‚Üí infinite or undefined tension. Angles <1¬∞ unrealistic in practice (sling would be nearly vertical).

Decimal values allowed for precision.

‚ö†Ô∏è Output Validation & Safety Thresholds

Compare calculated T (kg per sling) against the theoretical vertical share W/n:

If T ‚âà W/n ‚Üí efficient, low-angle lift.

If T = 1.5‚Äì2√ó (W/n) ‚Üí moderate tension, caution.

If T > 2√ó (W/n) ‚Üí unsafe, reconfigure lift.

Suggested traffic-light thresholds (as in industry audits):

<50% of sling WLL ‚Üí Safe (green)

50‚Äì80% of sling WLL ‚Üí Caution (yellow)

>80% of sling WLL ‚Üí Unsafe (red, stop lifting) {% endcomment %}