{% extends 'base.html' %}
{% block title %}BS 6759 Valves Minimum Orifice Area For Hot Water Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS 6759 Valves Minimum Orifice Area Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
      
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>BS 6759 Valves Minimum Orifice Area For Hot Water Calculator</h1>
            <p>Calculate the minimum orifice area required for hot water discharge through safety relief valves</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="Q"><strong>Hot Water Heating Capacity (kW):</strong></label>
                    <input type="number" id="Q" class="form-input" min="0.01" step="0.01" placeholder="e.g., 1000" required>
                    <p id="errorQ" class="error"></p>
                </div>
                <div class="form-group">
                    <label for="PR"><strong>Absolute Relieving Pressure (bar a):</strong></label>
                    <input type="number" id="PR" class="form-input" min="0.01" step="0.01" placeholder="e.g., 10" required>
                    <p id="errorPR" class="error"></p>
                </div>
                <div class="form-group">
                    <label for="Kdr"><strong>Derated Coefficient of Discharge:</strong></label>
                    <input type="number" id="Kdr" class="form-input" step="0.01" placeholder="e.g., 0.65" min="0.01" max="1" required>
                    <p id="errorKdr" class="error"></p>
                </div>
                
                <button class="calculate-btn" onclick="calculateOrifice()">Calculate Orifice Area</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Minimum Orifice Area</strong> for hot water discharge. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Minimum Orifice Area</h2>
                    </div>
                    <div class='rate-display'>
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">mm²</div></div>

                    <div class="result-feedback">
                        <div class="feedback-title">System Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    This calculator determines the <strong>minimum orifice area</strong> required for hot water discharge through a safety relief valve, based on heating capacity, pressure, and discharge efficiency according to BS 6759 standards.
                </p>
            </div>
            <div class="note-card">
                <h3>❓ What is Orifice Area?</h3>
                <p>The orifice area is the minimum opening required for safe fluid discharge, measured in mm². It ensures proper pressure relief in heating systems.</p>
            </div>
            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Q (Heating Capacity):</strong> The energy (in kW) that the system can release as heat.</li>
                    <li><strong>PR (Absolute Relieving Pressure):</strong> The total pressure at which the valve releases hot water, measured in bar absolute.</li>
                    <li><strong>Kdr (Derated Coefficient of Discharge):</strong> A correction factor representing valve efficiency in real conditions (typically 0.65-0.85).</li>
                </ul>
            </div>
          
            
            <div class="note-card">
                <h3>🏭 Real-Life Applications</h3>
                <ul class="note-list">
                    <li><strong>Boiler Safety Systems:</strong> Ensures safe hot water discharge under excess pressure.</li>
                    <li><strong>Industrial Steam Systems:</strong> Protects pipelines and equipment from pressure build-up.</li>
                    <li><strong>HVAC and Heating Plants:</strong> Helps in designing safety mechanisms for heating units.</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>✅ Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Q (Heating Capacity):</strong> Must be 1–100,000 kW. Below 1 kW or above 100,000 kW is flagged.</li>
        <li><strong>PR (Absolute Relieving Pressure):</strong> Must be >1 bar a and ≤200 bar a. ≤1 bar a is invalid.</li>
        <li><strong>Kdr (Coefficient):</strong> Allowed 0.6–0.85 (typical). Must not exceed 1.0.</li>
        <li>Division by zero is prevented if PR or Kdr = 0.</li>
        <li>Calculated Orifice Area (Ao) > 1,000,000 mm² is flagged as unrealistic.</li>
    </ul>
</div>

            
            <div class="note-card">
                <h3>📋 About BS 6759</h3>
                <p><strong>BS 6759</strong> is a British Standard that specifies requirements for the performance, design, and testing of safety valves used in pressurized systems. It ensures that safety valves operate reliably to prevent overpressure in boilers, pipelines, and industrial equipment.</p>
            </div>
             <div class="note-card">
                <h3>✅ Conclusion</h3>
                 <p>This formula is a critical safety calculation for hot water relief valves, ensuring proper pressure control and system safety.</p>
            </div>
        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        
function calculateOrifice() {
    const Q = parseFloat(document.getElementById('Q').value.trim());
    const PR = parseFloat(document.getElementById('PR').value.trim());
    const Kdr = parseFloat(document.getElementById('Kdr').value.trim());

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // ✅ Validate Q (Heating Capacity)
    if (isNaN(Q) || Q <= 0) {
        errors.push("👉 Heating capacity (Q) must be greater than 0 kW.");
    } else if (Q < 1) {
        errors.push("👉 Q < 1 kW is unusually small. Check input.");
    } else if (Q > 100000) {
        errors.push("👉 Q > 100,000 kW is unrealistic for standard valves.");
    }

    // ✅ Validate PR (Absolute Pressure)
    if (isNaN(PR) || PR <= 0) {
        errors.push("👉 Absolute relieving pressure (PR) must be greater than 0 bar a.");
    } else if (PR <= 1) {
        errors.push("👉 PR must be greater than 1 bar a (above atmosphere).");
    } else if (PR > 200) {
        errors.push("👉 PR above 200 bar a is beyond standard hot water applications.");
    }

    // ✅ Validate Kdr (Coefficient)
    if (isNaN(Kdr) || Kdr <= 0) {
        errors.push("👉 Derated coefficient (Kdr) must be greater than 0.");
    } else if (Kdr > 1) {
        errors.push("👉 Kdr cannot exceed 1.0 (100% efficiency).");
    } else if (Kdr < 0.6) {
        errors.push("👉 Kdr < 0.6 is outside standard certified values. Check valve data.");
    }

    // Stop if errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ✅ Perform Calculation
    const Ao = Q / (0.329 * PR * Kdr);

    // ✅ Output Validation
    if (Ao > 1000000) {
        errorMessage.innerHTML = "👉 Calculated orifice area exceeds 1,000,000 mm². Inputs likely incorrect.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    document.getElementById('rateValue').textContent = Ao.toFixed(2);

    // ✅ Feedback messages
    let feedback = "";
    if (Ao < 10) {
        feedback = "⚠️ Very small orifice size. Verify availability of certified valves.";
    } else if (Ao < 100) {
        feedback = "✅ Standard orifice size. Most commercial valves can handle this.";
    } else if (Ao < 1000) {
        feedback = "⚠️ Medium/large orifice size. Confirm valve model compatibility.";
    } else {
        feedback = "⚠️ Large orifice size. Consider multiple valves for safety compliance.";
    }

    document.getElementById('feedbackContent').textContent = feedback;
    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


/*
Formula (BS 6759 Hot Water Relief Valves):
Ao = Q / (0.329 * PR * Kdr)

Where:
- Q   = Heating Capacity (kW) [1 – 100,000]
- PR  = Absolute Relieving Pressure (bar a) [> 1 to 200]
- Kdr = Derated Coefficient of Discharge (dimensionless) [0.6 – 0.85 typical]
- Ao  = Minimum Orifice Area (mm²)

Validation Rules:
1. Q must be > 0, realistic range 1–100,000 kW.
2. PR must be > 1 bar a (absolute), max ~200 bar.
3. Kdr between 0.01–1, but typically 0.60–0.85.
4. Prevent division by zero (PR or Kdr = 0).
5. Flag extreme Ao > 1,000,000 mm² as unrealistic.
*/


{% comment %} 

🔹 1. Formula Used

For BS 6759 hot water safety valves, the orifice area is calculated as:

𝐴
𝑜
=
𝑄
0.329
×
𝑃
𝑅
×
𝐾
𝑑
𝑟
A
o
	​

=
0.329×P
R
	​

×K
dr
	​

Q
	​


Where:

Q = Heating Capacity (kW)

PR = Absolute Relieving Pressure (bar a)

Kdr = Derated Coefficient of Discharge (dimensionless, ≤ 1)

Ao = Minimum Orifice Area (mm²)

⚠️ Note: Formula assumes hot water relief under BS 6759; constant 0.329 is derived from standard conversion factors.

🔹 2. Input Validation Rules (Industry Standards)

✅ Q – Hot Water Heating Capacity (kW)

Must be > 0 (0 means no heat load; negative is impossible).

Practical minimum: 1 kW (tiny systems).

Practical maximum: 100,000 kW (100 MW) for very large industrial plants.

Decimals allowed: 2 (to represent fractions of kW in lab cases).

✅ PR – Absolute Relieving Pressure (bar a)

Must be > 1 bar a (since absolute pressure includes atmosphere ~1 bar).

Maximum practical safety valve pressures in heating: 200 bar a (above this, you’re in special designs).

Allowed decimals: 2 (to allow precision).

⚠️ If PR ≤ 1, error: “Relieving pressure must be above atmospheric (1 bar a).”

✅ Kdr – Derated Coefficient of Discharge

Allowed range: 0.60 – 0.85 (most manufacturers per API / BS 6759).

Absolute min: 0.01 (but unrealistic).

Max: 1.0 (perfect efficiency, not achievable in reality).

Error if < 0.6: “Kdr below 0.6 is unsafe; check valve certification.”

🔹 3. Edge Case Validations

Division by Zero: if PR = 0 or Kdr = 0 → prevent calculation.

Extreme Outliers: if Ao > 1,000,000 mm² → warn user: “Unrealistic orifice size; check inputs.”

Negative Inputs: reject as invalid.

Empty Fields: prevent calculation and highlight missing inputs.

Logical Consistency:

Q must scale reasonably with PR (a 10 kW heater with 150 bar relief is unusual).

Kdr must be within certification ranges.

🔹 4. Output Validation & Thresholds

Meaningful ranges for Orifice Area (Ao):

< 10 mm² → Too small, check if valve size exists.

10 – 100 mm² → Typical small commercial valves.

100 – 1000 mm² → Medium / industrial valves.

> 1000 mm² → Large system, consider multiple valves.

> 100,000 mm² → Unreasonable → likely input error. {% endcomment %}