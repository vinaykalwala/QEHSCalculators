{% extends 'base.html' %}
{% block title %}Lost Time Case Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Time Case Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Lost Time Case Rate (LTC) Calculator</h1>
            <p>Calculate the rate of workplace incidents that result in lost work time</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="lostTimeCases">Number of Lost Time Cases</label>
                    <input type="number" id="lostTimeCases" class="form-input" min="0" placeholder="e.g., 5">
                </div>
                <div class="form-group">
                    <label for="laborHours">Number of Employee Labor Hours Worked</label>
                    <input type="number" id="laborHours" class="form-input" min="1" placeholder="e.g., 200000">
                </div>
                
                <button class="calculate-btn" onclick="calculateLTCRate()">Calculate LTC Rate</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Lost Time Case Rate (LTC)</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:20px;">
                        <h2>Lost Time Case Rate</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">per 200,000 labor hours</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Excellent</span><span>Moderate</span><span>High Risk</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Safety Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
<div class="note-section">

  <!-- 📘 ABOUT -->
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      The <strong>Lost Time Case Rate (LTC)</strong> calculator measures workplace safety by evaluating 
      the number of incidents that led to employees missing work. This metric is commonly used in 
      safety reports and compliance assessments.
    </p>
  </div>

  <!-- ⚙️ PARAMETERS USED -->
  <div class="note-card">
    <h3>⚙️ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Number of Lost Time Cases:</strong> Total incidents where employees were unable to return to work</li>
      <li><strong>Employee Labor Hours:</strong> Total hours worked by all employees over a given period</li>
    </ul>
  </div>

  <!-- ✅ INPUT VALIDATION RULES -->
  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>Lost Time Cases:</b> Must be a whole number, 0 – 10,000</li>
      <li><b>Labor Hours:</b> Must be positive, 1 – 100,000,000</li>
      <li><b>Cross Check:</b> Labor hours should be reasonably higher than lost time cases (minimum ~40 hours per case)</li>
      <li><b>Units:</b> Both values must be positive numbers</li>
      <li><b>Compliance:</b> Follows OSHA recordkeeping requirements</li>
    </ul>
  </div>

  <!-- 🧾 OUTPUT VALIDATIONS -->
  <div class="note-card">
    <h3>🧾 Output Validations</h3>
    <ul class="note-list">
      <li>The calculated LTC is displayed along with feedback to interpret safety performance.</li>
      <li><b>Assessment / Feedback Messages:</b></li>
      <ul class="note-sublist">
        <li>&lt; 1.0 → ✅ Excellent! Very low LTC rate, strong safety culture.</li>
        <li>1.0 – 3.0 → 🟡 Moderate Risk. Within industry averages, but can improve.</li>
        <li>&gt; 3.0 → 🔴 High Risk! High LTC rate, requires urgent corrective actions.</li>
      </ul>
      <li>Feedback messages appear alongside the result to guide safety monitoring and improvements.</li>
    </ul>
  </div>

  <!-- ⚖️ GOVERNING PRINCIPLE -->
  <div class="note-card">
    <h3>⚖️ Governing Principle</h3>
    <p>
      A Lost Time Case Rate (LTC) Calculator adheres to the standards set by the Occupational Safety and Health Administration (OSHA), 
      using a standardized calculation involving the number of lost-time incidents and total employee hours worked in a given period.
    </p>
    <ul class="note-list">
      <li><strong>The Standard:</strong> OSHA provides a uniform method to calculate LTC for consistent comparison of workplace safety across companies.</li>
      <li><strong>The Multiplier:</strong> 200,000 represents total hours worked by 100 employees working 40 hours/week for 50 weeks/year, giving a standardized base for comparison.</li>
      <li><strong>Purpose:</strong> 
        <ul>
          <li>Benchmarking: Enables consistent measurement and comparison of safety performance across industries.</li>
          <li>Trend Analysis: Helps track workplace accident trends over time to evaluate safety program effectiveness and improve protocols.</li>
        </ul>
      </li>
    </ul>
  </div>

  <!-- 🏁 CONCLUSION -->
  <div class="note-card">
    <h3>🏁 Conclusion</h3>
    <p>
      This calculator provides a reliable Lost Time Case Rate metric with corresponding feedback messages that reflect the organization's safety performance. 
      By interpreting results according to the provided assessments, companies can monitor trends, improve safety programs, and benchmark against industry standards.
    </p>
  </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateLTCRate() {
    const lostTimeCases = document.getElementById('lostTimeCases').value.trim();
    const laborHours = document.getElementById('laborHours').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    /*
    =====================
    📌 Input Validations
    =====================
    */

    // Lost Time Cases Validation
    if (lostTimeCases === "" || isNaN(lostTimeCases)) {
        errors.push("👉 Please enter the number of lost time cases.");
    } else if (!Number.isInteger(parseFloat(lostTimeCases))) {
        errors.push("👉 Lost time cases must be a whole number (no decimals).");
    } else if (parseInt(lostTimeCases) < 0) {
        errors.push("👉 Lost time cases cannot be negative.");
    } else if (parseInt(lostTimeCases) > 10000) {
        errors.push("👉 Lost time cases cannot exceed 10,000.");
    }

    // Labor Hours Validation
    if (laborHours === "" || isNaN(laborHours)) {
        errors.push("👉 Please enter the total labor hours worked.");
    } else if (parseFloat(laborHours) <= 0) {
        errors.push("👉 Labor hours must be greater than zero.");
    } else if (parseFloat(laborHours) > 100000000) {
        errors.push("👉 Labor hours cannot exceed 100,000,000.");
    } else if ((parseInt(lostTimeCases) > 0) && (parseFloat(laborHours) < parseInt(lostTimeCases) * 40)) {
        errors.push("👉 Labor hours seem too low compared to the number of lost time cases.");
    }

    // Show errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join('<br>');
        errorBox.classList.remove('hidden');
        placeholder.classList.add('hidden');
        resultValue.classList.add('hidden');
        return;
    }

    // Clear previous errors
    errorBox.classList.add('hidden');

    /*
    =====================
    📌 Calculation
    =====================
    */
    const ltcr = (parseInt(lostTimeCases) * 200000) / parseFloat(laborHours);

    // Cap display
    const safeLTCR = Math.min(ltcr, 9999.99);

    // Display result
    document.getElementById('rateValue').textContent = safeLTCR.toFixed(2);

    // Meter Fill
    const meterFill = document.getElementById('meterFill');
    let fillPercentage = Math.min(100, safeLTCR * 20);
    meterFill.style.width = fillPercentage + '%';

    if (safeLTCR < 1) {
        meterFill.style.background = 'linear-gradient(to right, #2ecc71, #27ae60)';
    } else if (safeLTCR >= 1 && safeLTCR <= 3) {
        meterFill.style.background = 'linear-gradient(to right, #f39c12, #e67e22)';
    } else {
        meterFill.style.background = 'linear-gradient(to right, #e74c3c, #c0392b)';
    }

    // Feedback
    const feedbackContent = document.getElementById('feedbackContent');
    if (safeLTCR < 1) {
        feedbackContent.innerHTML = "<span class='good'>✅ Excellent!</span> Very low LTC rate, strong safety culture.";
    } else if (safeLTCR >= 1 && safeLTCR <= 3) {
        feedbackContent.innerHTML = "<span class='average'>🟡 Moderate Risk.</span> Within industry averages, but can improve.";
    } else {
        feedbackContent.innerHTML = "<span class='bad'>🔴 High Risk!</span> High LTC rate, requires urgent corrective actions.";
    }

    // Show result
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

{% comment %} 
🔹 1. Formula (to add as code comment)
/*
📌 Formula: Lost Time Case Rate (LTCR)

LTCR = (Number of Lost Time Cases × 200,000) / Total Employee Labor Hours

Where:
- 200,000 = Benchmark set by OSHA (100 employees × 40 hrs/week × 50 weeks).
- Lost Time Cases = OSHA recordable cases with 1+ days away from work.
- Labor Hours = Sum of all employee hours worked in the same period.

Compliance Reference: OSHA Recordkeeping (29 CFR 1904), ILO Safety Metrics, ISO 45001 KPIs.
*/

🔹 2. Input Validation Rules (Real-World Standards)

Lost Time Cases (LTC):

Must be an integer (no decimals).

Range: 0 – 10,000 (practical for very large organizations).

Cannot exceed total number of employees (optional, if workforce data is available).

Logical dependency: If laborHours < 2000, LTC cases should realistically be ≤ 5 (to avoid anomalies).

Employee Labor Hours (LH):

Must be a positive number.

Range: 1 – 100,000,000 (large organizations, multi-year reporting).

Decimals allowed up to 2 places (e.g., fractional overtime hours).

Cannot be less than (LTC × 40) because each lost time case implies at least 1 lost workweek → acts as a plausibility check.

🔹 3. Output Validation & Thresholds

OSHA & Industry Benchmarks:

LTCR < 1.0 → Excellent (world-class, proactive safety).

1.0 ≤ LTCR ≤ 3.0 → Moderate Risk (industry average).

LTCR > 3.0 → High Risk (requires immediate action).

Output Constraints:

Always show two decimals (fixed precision).

Maximum display cap: 9999.99 (avoid rendering extreme outliers).

If division by zero risk arises (e.g., laborHours = 0), system must return an error, not a number. {% endcomment %}