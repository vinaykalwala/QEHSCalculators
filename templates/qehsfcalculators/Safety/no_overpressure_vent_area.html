{% extends 'base.html' %}
{% block title %}No-Overpressure Vent Area Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No-Overpressure Vent Area Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        
        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
        
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        
        /* Layout */
        .calc-content {
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }
        
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        /* Input rows for side-by-side fields */
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        
        .error {
            color: #e74c3c;
            font-size: 12px;
            display: block;
            font-weight: 500;
        }
        
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        
        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }
        
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }
        
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
          
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        
        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}
        
        <div class="calculator-header">
            <h1>No-Overpressure Vent Area Calculator</h1>
            <p>Calculate the required vent size for pressure relief in vessels handling pressurized or flammable liquids</p>
        </div>
        
        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="mo">Initial Mass (m<sub>o</sub>) (kg)</label>
                        <input type="number" id="mo" class="form-input" min="0" placeholder="e.g., 500">
                        <span class="error" id="error-mo"></span>
                    </div>
                    <div class="form-group">
                        <label for="q">Heat Release Rate (q) (kW)</label>
                        <input type="number" id="q" class="form-input" min="0" placeholder="e.g., 1000">
                        <span class="error" id="error-q"></span>
                    </div>
                </div>
                
                <div class="input-row">
                    <div class="form-group">
                        <label for="vfa">Specific Volume (v<sub>fa</sub>) (m¬≥/kg)</label>
                        <input type="number" id="vfa" class="form-input" min="0" step="0.001" placeholder="e.g., 0.001">
                        <span class="error" id="error-vfa"></span>
                    </div>
                    <div class="form-group">
                        <label for="G">Mass Flux (G) (kg/(m¬≤¬∑s))</label>
                        <input type="number" id="G" class="form-input" min="0" step="0.01" placeholder="e.g., 50">
                        <span class="error" id="error-G"></span>
                    </div>
                </div>
                
                <div class="input-row">
                    <div class="form-group">
                        <label for="V">Volume (V) (m¬≥)</label>
                        <input type="number" id="V" class="form-input" min="0" placeholder="e.g., 2">
                        <span class="error" id="error-V"></span>
                    </div>
                    <div class="form-group">
                        <label for="hfa">Latent Heat of Vaporization (h<sub>fa</sub>) (kJ/kg)</label>
                        <input type="number" id="hfa" class="form-input" min="0" placeholder="e.g., 2257">
                        <span class="error" id="error-hfa"></span>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateVentArea()">Calculate Vent Area</button>
            </div>
            
            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Safety illustration">
                    <p>This tool will calculate the <strong>No-Overpressure Vent Area</strong> for pressure relief. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Vent Area</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Area (m¬≤)</div>
                    </div>
                    
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Small</span><span>Optimal</span><span>Moderate</span><span>Large</span><span>Very Large</span>
                    </div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title"> Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    This tool calculates the <strong>No-Overpressure Vent Area</strong> required for pressure relief in vessels handling pressurized or flammable liquids. 
                    It ensures pressure is safely released without causing structural damage to the equipment.
                </p>
            </div>
            
            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Initial Mass (m<sub>o</sub>):</strong> The starting mass of the liquid inside the vessel, which influences how much vapor is generated (kg).</li>
                    <li><strong>Heat Release Rate (q):</strong> The amount of heat released per unit time, affecting vaporization rate (kW).</li>
                    <li><strong>Specific Volume (v<sub>fa</sub>):</strong> The space occupied by a unit mass of liquid, determining expansion under heat (m¬≥/kg).</li>
                    <li><strong>Mass Flux (G):</strong> The flow rate per unit area, affecting venting efficiency (kg/(m¬≤¬∑s)).</li>
                    <li><strong>Volume (V):</strong> The total vessel capacity, which impacts pressure accumulation (m¬≥).</li>
                    <li><strong>Latent Heat of Vaporization (h<sub>fa</sub>):</strong> The heat required to turn liquid into vapor, influencing venting needs (kJ/kg).</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>‚úÖ Input Validations</h3>
    <ul class="note-list">
        <li><strong>Initial Mass (m<sub>o</sub>):</strong> Must be between 1‚Äì1,000,000 kg (vessel capacity range)</li>
        <li><strong>Initial Mass Minimum:</strong> Must be > 0 kg (positive mass required)</li>
        <li><strong>Heat Release Rate (q):</strong> Must be between 10‚Äì1,000,000 kW (chemical/flammable scenarios)</li>
        <li><strong>Heat Release Rate Minimum:</strong> Must be > 0 kW (positive heat input)</li>
        <li><strong>Specific Volume (v<sub>fa</sub>):</strong> Must be between 0.0001‚Äì10 m¬≥/kg (physical consistency range)</li>
        <li><strong>Specific Volume Minimum:</strong> Must be > 0 m¬≥/kg (positive volume)</li>
        <li><strong>Mass Flux (G):</strong> Must be between 1‚Äì2000 kg/(m¬≤¬∑s) (NFPA/API guidance range)</li>
        <li><strong>Mass Flux Minimum:</strong> Must be > 0 kg/(m¬≤¬∑s) (positive flow rate)</li>
        <li><strong>Volume (V):</strong> Must be between 0.001‚Äì10,000 m¬≥ (lab reactors to refinery tanks)</li>
        <li><strong>Volume Minimum:</strong> Must be > 0 m¬≥ (positive vessel capacity)</li>
        <li><strong>Latent Heat (h<sub>fa</sub>):</strong> Must be between 100‚Äì3000 kJ/kg (water to hydrocarbons range)</li>
        <li><strong>Latent Heat Minimum:</strong> Must be > 0 kJ/kg (positive energy requirement)</li>
    </ul>
</div>
<div class="note-card">
    <h3>üîé Output Validations</h3>
    <ul class="note-list">
        <li><strong>Vent Area < 0.1 m¬≤:</strong> üü¢ Safe - Low venting requirement</li>
        <li><strong>0.1 ‚â§ Vent Area < 0.5 m¬≤:</strong> üü° Moderate venting required. Review safeguards.</li>
        <li><strong>0.5 ‚â§ Vent Area < 1.0 m¬≤:</strong> üü† Significant venting required. Recheck design capacity.</li>
        <li><strong>1.0 ‚â§ Vent Area < 5.0 m¬≤:</strong> üî¥ Large vent area needed! System review mandatory.</li>
        <li><strong>Vent Area ‚â• 5.0 m¬≤:</strong> üî¥ Unrealistic vent area (>5 m¬≤). Check input validity.</li>
    </ul>
</div>
<div class="note-card">
    <h3>üìê Governing Principle</h3>
    <p>
        The primary standards governing "no-overpressure" or low-pressure venting calculations for explosion protection are NFPA 68 and EN 14491/EN 14994. A truly "no-overpressure" situation is an ideal that is not possible in practice; these standards provide calculation methods to size vents that will keep the internal pressure during a deflagration below a specified, safe reduced pressure (P<sub>red</sub>).
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">NFPA 68: Standard on Explosion Protection by Deflagration Venting</h3>
    <p>
        This is the primary standard in North America and is widely recognized internationally. It provides scientifically validated formulas and guidelines for the design and implementation of explosion venting systems for combustible gases, vapors, mists, and dusts.
    </p>
    <ul class="note-list">
        <li><b>Purpose:</b> To size vents to safely release the combustion gases and pressures from a deflagration, minimizing structural damage to the enclosure.</li>
        <li><b>Key Parameters:</b> Calculates the required vent area (A<sub>v</sub>) based on factors like the deflagration index (K<sub>st</sub> or K<sub>g</sub>), the volume of the enclosure, the maximum unvented pressure (P<sub>max</sub>), and the desired reduced pressure (P<sub>red</sub>).</li>
        <li><b>Low Pressure Situations:</b> While the formulas may lose accuracy at extremely low pressures, the standard is the governing document for deflagration venting in industrial settings.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">European Union (ATEX) and EN Standards</h3>
    <p>
        This set of standards governs explosion protection for member states of the EU and other countries that adopt them. The relevant standards are:
    </p>
    <ul class="note-list">
        <li><b>EN 14491:</b> Specifies requirements for dust explosion venting protective systems, including vent sizing calculations.</li>
        <li><b>EN 14994:</b> Specifically addresses the calculation of explosion vents for gaseous mixtures.</li>
        <li><b>Purpose:</b> These standards provide methodologies for calculating the required vent area to keep internal pressure below a safe limit, considering factors like the dust explosion constant (K<sub>st</sub>), maximum explosion pressure (P<sub>max</sub>), and reduced explosion pressure (P<sub>red</sub>).</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">FM Global Property Loss Prevention Data Sheets</h3>
    <p>
        FM Global, an insurance company, provides its own set of engineering guidelines for its insured properties to reduce the risk of property loss.
    </p>
    <ul class="note-list">
        <li><b>Data Sheets:</b> These exacting standards, such as Data Sheet 7-76, cover the prevention and mitigation of combustible dust explosions and fires. The guidelines often reference and build upon consensus standards like NFPA but may have specific requirements for FM Global-insured facilities.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">API 2000 and API 520/521</h3>
    <p>
        These standards relate to pressure relief for tanks and pressure vessels, which is different from deflagration venting but may involve low-pressure devices.
    </p>
    <ul class="note-list">
        <li><b>API 2000:</b> Focuses on venting for atmospheric and low-pressure storage tanks, primarily covering breathing losses from liquid movement or temperature changes, as well as emergency venting from fire.</li>
        <li><b>API 520/521:</b> Focus on sizing and selecting pressure-relieving devices for pressure vessels, including safety valves. While they deal with overpressure, this is for different scenarios than a deflagration explosion.</li>
    </ul>

    <p>
        <strong>Key takeaway:</strong> For calculating a "no-overpressure" vent area for explosions (deflagrations), the primary authority is NFPA 68 in North America and EN 14491/EN 14994 in Europe. The term "no-overpressure" is an exaggeration, as all venting involves some reduced pressure; the goal is to keep this pressure within safe limits defined by these standards.
    </p>
</div>
<div class="note-card">
    <h3>üí° Conclusion</h3>
    <p>
        This calculator determines the <strong>no-overpressure vent area</strong> required for safe pressure relief 
        in vessels handling pressurized or flammable liquids.</p>
</div>
                    </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
        function calculateVentArea() {
    // Get input values
    let mo = parseFloat(document.getElementById('mo').value);
    let q = parseFloat(document.getElementById('q').value);
    let vfa = parseFloat(document.getElementById('vfa').value);
    let G = parseFloat(document.getElementById('G').value);
    let V = parseFloat(document.getElementById('V').value);
    let hfa = parseFloat(document.getElementById('hfa').value);
    let errors = false;

    // Clear previous errors
    document.querySelectorAll(".error").forEach(el => el.innerText = "");

    // --- Input Validations (NFPA 68, API RP 521, OSHA) ---
    if (isNaN(mo) || mo <= 0 || mo > 1e6) {
        document.getElementById('error-mo').innerText = "Mass must be >0 and within realistic range (1‚Äì1,000,000 kg).";
        errors = true;
    }
    if (isNaN(q) || q <= 0 || q > 1e6) {
        document.getElementById('error-q').innerText = "Heat release rate must be >0 and within 10‚Äì1,000,000 kW.";
        errors = true;
    }
    if (isNaN(vfa) || vfa <= 0 || vfa > 10) {
        document.getElementById('error-vfa').innerText = "Specific volume must be >0 and <10 m¬≥/kg.";
        errors = true;
    }
    if (isNaN(G) || G <= 0 || G > 2000) {
        document.getElementById('error-G').innerText = "Mass flux must be within 1‚Äì2000 kg/(m¬≤¬∑s).";
        errors = true;
    }
    if (isNaN(V) || V <= 0 || V > 10000) {
        document.getElementById('error-V').innerText = "Vessel volume must be >0 and <10,000 m¬≥.";
        errors = true;
    }
    if (isNaN(hfa) || hfa <= 0 || hfa < 100 || hfa > 3000) {
        document.getElementById('error-hfa').innerText = "Latent heat must be within 100‚Äì3000 kJ/kg.";
        errors = true;
    }

    if (errors) {
        document.getElementById('placeholder').classList.add('hidden');
        document.getElementById('resultValue').classList.add('hidden');
        document.getElementById('resultError').classList.remove('hidden');
        document.getElementById('errorMessage').innerHTML = "Please correct highlighted errors before calculation.";
        return;
    }

    // --- Formula ---
    // Ao = (mo * q * vfa) / (G * V * hfa)
    let Ao = (mo * q * vfa) / (G * V * hfa);

    if (Ao <= 0 || !isFinite(Ao)) {
        document.getElementById('placeholder').classList.add('hidden');
        document.getElementById('resultValue').classList.add('hidden');
        document.getElementById('resultError').classList.remove('hidden');
        document.getElementById('errorMessage').innerHTML = "Invalid calculation result. Check inputs for division by zero or unrealistic values.";
        return;
    }

    // --- Show Result ---
    document.getElementById('placeholder').classList.add('hidden');
    document.getElementById('resultError').classList.add('hidden');
    document.getElementById('resultValue').classList.remove('hidden');
    document.getElementById('rateValue').textContent = Ao.toFixed(4);

    // --- Safety Meter ---
    let meterFill = document.getElementById('meterFill');
    let fillPercentage = Math.min(100, (Ao / 5) * 100);
    meterFill.style.width = fillPercentage + '%';

    if (Ao < 0.1) {
        meterFill.style.background = 'linear-gradient(to right, #2ecc71, #27ae60)';
        document.getElementById('feedbackContent').innerHTML = "<span class='good'>Safe: Low venting requirement.</span>";
    } else if (Ao < 0.5) {
        meterFill.style.background = 'linear-gradient(to right, #f1c40f, #f39c12)';
        document.getElementById('feedbackContent').innerHTML = "<span class='average'>Moderate venting required. Review safeguards.</span>";
    } else if (Ao < 1) {
        meterFill.style.background = 'linear-gradient(to right, #e67e22, #d35400)';
        document.getElementById('feedbackContent').innerHTML = "<span class='average'>Significant venting required. Recheck design capacity.</span>";
    } else if (Ao < 5) {
        meterFill.style.background = 'linear-gradient(to right, #e74c3c, #c0392b)';
        document.getElementById('feedbackContent').innerHTML = "<span class='bad'>Large vent area needed! System review mandatory.</span>";
    } else {
        meterFill.style.background = 'linear-gradient(to right, #8e44ad, #6c3483)';
        document.getElementById('feedbackContent').innerHTML = "<span class='bad'>Unrealistic vent area (>5 m¬≤). Check input validity.</span>";
    }
}

        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}

{% comment %} 
1. Formula Used

In your calculator, the formula is:

// Formula Reference (NFPA 68, API RP 521 - vent sizing principles)
// Required No-Overpressure Vent Area (Ao):
// Ao = (m‚ÇÄ √ó q √ó vfa) / (G √ó V √ó hfa)
//
// Where:
// m‚ÇÄ   = Initial mass of liquid (kg)
// q    = Heat release rate (kW = kJ/s)
// vfa  = Specific volume of vapor (m¬≥/kg)
// G    = Mass flux through vent (kg/(m¬≤¬∑s))
// V    = Vessel volume (m¬≥)
// hfa  = Latent heat of vaporization (kJ/kg)
//
// Unit Consistency:
// - q in kW ‚Üí kJ/s
// - hfa in kJ/kg
// Result Ao in m¬≤ (vent area)

2. Validation Rules (Industry-Standard)
‚úÖ Input-by-Input Rules

Initial Mass (m‚ÇÄ, kg)

Min: > 0 (cannot have zero/negative mass)

Typical Range: 1 ‚Äì 1,000,000 kg (depending on vessel size)

Decimals: Allowed up to 2.

Cross-check: m‚ÇÄ must not exceed V √ó liquid density. If density unknown, flag unrealistic values.

Heat Release Rate (q, kW)

Min: > 0

Typical Range: 10 ‚Äì 1,000,000 kW (chemical/flammable scenarios)

Decimals: Up to 1.

Validation: Ensure not absurdly high (e.g., 1e9 kW ‚Üí fireball scale).

Specific Volume (vfa, m¬≥/kg)

Min: > 0

Typical Range: 0.0001 ‚Äì 10 m¬≥/kg

Step: 0.001 (already applied).

Outliers outside this range are physically inconsistent.

Mass Flux (G, kg/(m¬≤¬∑s))

Min: > 0

Typical Range: 10 ‚Äì 1000 kg/(m¬≤¬∑s) (NFPA/API guidance).

Too low (e.g., <1) ‚Üí non-physical. Too high (>2000) ‚Üí unrealistic choking.

Volume (V, m¬≥)

Min: > 0

Typical Range: 0.001 ‚Äì 10,000 m¬≥ (lab reactors to refinery tanks).

Must be consistent with m‚ÇÄ (see cross-check).

Latent Heat of Vaporization (hfa, kJ/kg)

Min: > 0

Typical Range: 100 ‚Äì 3000 kJ/kg (water = 2257, hydrocarbons lower).

Outside range ‚Üí invalid input.

‚úÖ Cross-Field & Edge Case Validations

Division by Zero ‚Üí if G=0, V=0, or hfa=0 ‚Üí prevent calculation.

Negative/NaN inputs ‚Üí block.

Extreme Ratios ‚Üí If (mo √ó q) >> (G √ó V √ó hfa) √ó 1e6, warn user result is beyond realistic safety standards.

Empty inputs ‚Üí block with error.

Consistency Check: If Ao > 10 m¬≤, flag as "unrealistic, check inputs".

3. Output Validation Logic

Your thresholds should map to real safety reporting:

< 0.1 m¬≤ ‚Üí Small venting requirement (safe).

0.1 ‚Äì 0.5 m¬≤ ‚Üí Moderate venting, confirm design safety margins.

0.5 ‚Äì 1.0 m¬≤ ‚Üí Significant venting, special review required.

1 ‚Äì 5 m¬≤ ‚Üí Large vent area ‚Üí recheck inputs/design.

> 5 m¬≤ ‚Üí Unrealistic/extreme ‚Üí likely input error or catastrophic fire case. {% endcomment %}