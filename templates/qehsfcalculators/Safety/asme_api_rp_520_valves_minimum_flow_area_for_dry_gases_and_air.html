{% extends 'base.html' %}
{% block title %}ASME (API RP 520) Valves - Minimum Flow Area for Dry Gases and Air{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASME (API RP 520) Valves - Minimum Flow Area for Dry Gases and Air</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            {% comment %} display: flex; {% endcomment %}
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            {% comment %} overflow-y: auto; {% endcomment %}
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Input rows for side-by-side fields */
         .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            {% comment %} margin-bottom: 15px; {% endcomment %}
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value { 
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
       
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>ASME (API RP 520) Valves - Minimum Flow Area for Dry Gases and Air</h1>
            <p>Calculate the minimum flow area required for gas discharge in safety valves</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="volumeFlow">Required Volume Flow (VÃá) (ft¬≥/min)</label>
                        <input type="number" id="volumeFlow" class="form-input" min="0" placeholder="e.g., 5000">
                    </div>
                    <div class="form-group">
                        <label for="temperature">Relieving Temperature (T) (¬∞R)</label>
                        <input type="number" id="temperature" class="form-input" min="0" placeholder="e.g., 520">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="compressibility">Compressibility Factor (Z)</label>
                        <input type="number" id="compressibility" class="form-input" min="0" max="1.5" step="0.01" placeholder="e.g., 0.95">
                    </div>
                    <div class="form-group">
                        <label for="specificGravity">Specific Gravity of Gas (G)</label>
                        <input type="number" id="specificGravity" class="form-input" min="0" step="0.01" placeholder="e.g., 1.0">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="Cg">Nozzle Gas Constant (C<sub>g</sub>)</label>
                        <input type="number" id="Cg" class="form-input" min="0" placeholder="e.g., 315">
                    </div>
                    <div class="form-group">
                        <label for="Kd">Effective Coefficient of Discharge (K<sub>d</sub>)</label>
                        <input type="number" id="Kd" class="form-input" min="0.1" max="1" step="0.01" placeholder="e.g., 0.8">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="Pr">Upstream Relieving Pressure (P<sub>R</sub>) (bar a)</label>
                        <input type="number" id="Pr" class="form-input" min="0" placeholder="e.g., 10">
                    </div>
                    <div class="form-group">
                        <label for="Kb">Backpressure Correction Factor (K<sub>b</sub>)</label>
                        <input type="number" id="Kb" class="form-input" min="0" step="0.01" placeholder="e.g., 1.0">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateDischargeArea()">Calculate Minimum Flow Area</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Minimum Flow Area</strong> for dry gases and air. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Minimum Flow Area</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">in¬≤</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Small</span><span>Optimal</span><span>Moderate</span><span>Large</span><span>Very Large</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Flow Area Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            This tool calculates the <strong>Minimum Flow Area for Dry Gases and Air</strong> required for a safety valve, 
            ensuring proper discharge of excess gas under specified operating conditions according to ASME (API RP 520) standards.
        </p>
    </div>

    <div class="note-card">
        <h3>‚öôÔ∏è Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Required Volume Flow (VÃá):</strong> The volumetric flow rate of gas to be discharged (ft¬≥/min).</li>
            <li><strong>Relieving Temperature (T):</strong> The absolute temperature of gas at relieving conditions in Rankine (¬∞R).</li>
            <li><strong>Compressibility Factor (Z):</strong> A correction factor for non-ideal gas behavior (typically 0‚Äì1.5).</li>
            <li><strong>Specific Gravity of Gas (G):</strong> The density of gas relative to air at standard conditions.</li>
            <li><strong>Nozzle Gas Constant (C<sub>g</sub>):</strong> A coefficient related to gas expansion characteristics.</li>
            <li><strong>Effective Coefficient of Discharge (K<sub>d</sub>):</strong> Represents flow efficiency through the valve (0‚Äì1).</li>
            <li><strong>Upstream Relieving Pressure (P<sub>R</sub>):</strong> The absolute pressure upstream of the valve at relieving conditions (bar a).</li>
            <li><strong>Backpressure Correction Factor (K<sub>b</sub>):</strong> Accounts for the effect of downstream pressure on valve performance.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>üìù Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Volume Flow (VÃá):</strong> Must be > 0 and ‚â§ 10,000,000 ft¬≥/min.</li>
            <li><strong>Relieving Temperature (T):</strong> 460 ¬∞R ‚â§ T ‚â§ 2000 ¬∞R.</li>
            <li><strong>Compressibility Factor (Z):</strong> 0.1 ‚â§ Z ‚â§ 1.5.</li>
            <li><strong>Specific Gravity (G):</strong> 0.1 ‚â§ G ‚â§ 10.</li>
            <li><strong>Nozzle Gas Constant (Cg):</strong> > 0 and ‚â§ 4000.</li>
            <li><strong>Discharge Coefficient (Kd):</strong> 0.62 ‚â§ Kd ‚â§ 1.0.</li>
            <li><strong>Relieving Pressure (PR):</strong> 1.01 ‚â§ PR ‚â§ 700 bar abs.</li>
            <li><strong>Backpressure Factor (Kb):</strong> 0.5 ‚â§ Kb ‚â§ 2.0.</li>
            <li><strong>Calculated Flow Area (A‚ÇÄ):</strong> Must be > 0 and ‚â§ 100 in¬≤. Values above 100 suggest unrealistic data or unit mismatch.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>üìä Output Validations</h3>
        <ul class="note-list">
            <li>Flow Area &lt; 0.1 in¬≤: ‚úÖ Small flow area, suitable for low-flow applications.</li>
            <li>Flow Area 0.1‚Äì1.0 in¬≤: ‚ö†Ô∏è Optimal range for most industrial applications.</li>
            <li>Flow Area 1.0‚Äì3.0 in¬≤: üî∂ Large flow area, check for chemical or refinery applications.</li>
            <li>Flow Area &gt; 3.0 in¬≤: üö® Very large area, recheck process data and units.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>üìè Governing Principle</h3>
        <p>
            The "ASME (API RP 520) Valves - Minimum Flow Area for Dry Gases and Air Calculator" is a tool that follows the ASME (American Society of Mechanical Engineers) and API RP 520 (American Petroleum Institute Recommended Practice 520) standards, specifically for sizing, selecting, and installing pressure-relieving devices. These industry standards provide the methodologies and formulas for calculating the required orifice area for a safety valve or pressure relief valve for various fluids, including dry gases and air. 
        </p>
        <h3>Key Aspects of the Standard</h3>
        <ul class="note-list">
            <li><strong>Purpose:</strong> Establishes design and selection criteria for pressure relief valves to prevent system overpressure.</li>
            <li><strong>Methodology:</strong> Provides calculation methods for required orifice area based on flow rate, fluid properties (pressure, temperature, specific gravity), and rated discharge coefficient.</li>
            <li><strong>Scope:</strong> Includes API RP 520 Part II for installation requirements, with sizing/selection referencing ASME Section VIII codes.</li>
            <li><strong>Applications:</strong> Critical for safe operation of pressure relief devices in oil & gas, chemical, and manufacturing industries.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>‚úÖ Conclusion</h3>
        <p>
            This tool helps engineers and safety professionals determine the <strong>minimum required discharge area (A‚ÇÄ)</strong> for gas and air relief valves using the API RP 520 standard. Properly sized valves protect equipment from overpressure, ensuring safe and efficient system operation.
        </p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
});

function calculateDischargeArea() {
    const volumeFlow = parseFloat(document.getElementById('volumeFlow').value.trim());
    const temperature = parseFloat(document.getElementById('temperature').value.trim());
    const compressibility = parseFloat(document.getElementById('compressibility').value.trim());
    const specificGravity = parseFloat(document.getElementById('specificGravity').value.trim());
    const Cg = parseFloat(document.getElementById('Cg').value.trim());
    const Kd = parseFloat(document.getElementById('Kd').value.trim());
    const Pr = parseFloat(document.getElementById('Pr').value.trim());
    const Kb = parseFloat(document.getElementById('Kb').value.trim());

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    let errors = [];

    // ‚úÖ Input Validations
    if (isNaN(volumeFlow) || volumeFlow <= 0 || volumeFlow > 1e7) errors.push("üëâ Volume Flow must be > 0 and ‚â§ 10,000,000 ft¬≥/min.");
    if (isNaN(temperature) || temperature < 460 || temperature > 2000) errors.push("üëâ Temperature must be between 460 ¬∞R and 2000 ¬∞R.");
    if (isNaN(compressibility) || compressibility < 0.1 || compressibility > 1.5) errors.push("üëâ Compressibility Factor (Z) must be between 0.1 and 1.5.");
    if (isNaN(specificGravity) || specificGravity < 0.1 || specificGravity > 10) errors.push("üëâ Specific Gravity must be between 0.1 and 10.");
    if (isNaN(Cg) || Cg <= 0 || Cg > 4000) errors.push("üëâ Nozzle Gas Constant (Cg) must be > 0 and ‚â§ 4000.");
    if (isNaN(Kd) || Kd < 0.62 || Kd > 1.0) errors.push("üëâ Discharge Coefficient (Kd) must be between 0.62 and 1.0.");
    if (isNaN(Pr) || Pr < 1.01 || Pr > 700) errors.push("üëâ Relieving Pressure (PR) must be between 1.01 and 700 bar abs.");
    if (isNaN(Kb) || Kb < 0.5 || Kb > 2.0) errors.push("üëâ Backpressure Factor (Kb) must be between 0.5 and 2.0.");

    // ‚úÖ Cross-field or edge-case validations
    if (!isNaN(volumeFlow) && !isNaN(Cg) && Cg === 0) errors.push("‚ö†Ô∏è Division by zero risk due to Cg = 0.");
    if (!isNaN(volumeFlow) && !isNaN(Kd) && Kd === 0) errors.push("‚ö†Ô∏è Division by zero risk due to Kd = 0.");
    if (!isNaN(Pr) && Pr < 1) errors.push("‚ö†Ô∏è PR < 1 bar abs is invalid (vacuum).");
    if (!isFinite(volumeFlow) || !isFinite(temperature) || !isFinite(compressibility) || !isFinite(specificGravity)) errors.push("‚ö†Ô∏è Non-numeric or infinite input detected.");
    if (compressibility > 1.5 && specificGravity > 10 && Pr < 1.01) errors.push("‚ö†Ô∏è High Z and G with low PR may cause unstable result.");

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ‚úÖ Calculation
    const A0 = (volumeFlow * Math.sqrt(temperature * compressibility * specificGravity)) /
               (1.175 * Cg * Kd * Pr * Kb);

    // ‚úÖ Output validations
    if (A0 <= 0 || !isFinite(A0)) {
        errorMessage.innerHTML = "‚ö†Ô∏è Invalid calculation result. Please review inputs.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }
    if (A0 > 100) {
        errorMessage.innerHTML = "‚ö†Ô∏è Flow area exceeds 100 in¬≤. Check input units or system design.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }
    if (A0 < 0.01) {
        errorMessage.innerHTML = "‚ö†Ô∏è Extremely small flow area (<0.01 in¬≤). Verify input data.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    document.getElementById('rateValue').textContent = A0.toFixed(4);

    // Meter feedback (matching Notes Section wording)
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (A0 < 0.1) { 
        meterWidth = '20%'; 
        meterColor = '#2ecc71'; 
        feedback = '‚úÖ Small flow area, suitable for low-flow applications.'; 
    } else if (A0 <= 1.0) { 
        meterWidth = '40%'; 
        meterColor = '#27ae60'; 
        feedback = '‚ö†Ô∏è Optimal range for most industrial applications.'; 
    } else if (A0 <= 3.0) { 
        meterWidth = '60%'; 
        meterColor = '#f39c12'; 
        feedback = 'üî∂ Large flow area, may indicate an oversized valve.'; 
    } else { 
        meterWidth = '80%'; 
        meterColor = '#e74c3c'; 
        feedback = 'üö® Very large flow area! Check system design or input units.'; 
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

function printReport() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
    window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used (from API RP 520, ASME standard)
// API RP 520 formula for gas discharge area (Minimum Flow Area for Dry Gases & Air)
//
// A‚ÇÄ = ( VÃá * ‚àö(T * Z * G) ) / (1.175 * Cg * Kd * PR * Kb)
//
// Where:
//   A‚ÇÄ  = Minimum required flow area (in¬≤)
//   VÃá   = Required volumetric flow (ft¬≥/min)
//   T   = Relieving temperature (¬∞R, absolute Rankine)
//   Z   = Compressibility factor (typically 0.85 ‚Äì 1.1, max 1.5)
//   G   = Specific gravity of gas (relative to air at standard conditions)
//   Cg  = Gas nozzle coefficient (depends on k, ratio of Cp/Cv)
//   Kd  = Effective discharge coefficient (0.62 ‚â§ Kd ‚â§ 1.0)
//   PR  = Upstream relieving pressure (bar absolute)
//   Kb  = Backpressure correction factor (0.8 ‚Äì 1.2 typical)


This is consistent with ASME/API RP 520 requirements for safety valve sizing.

2. Detailed Input Validation Rules
Parameter	Unit	Valid Range (Industry Practice)	Validation Rule	Why Needed (Compliance / Safety)
Volume Flow (VÃá)	ft¬≥/min	> 0 and typically < 1e7	Must be positive, finite, ‚â§ 10,000,000	Negative/zero flow is meaningless; ensures realistic sizing
Temperature (T)	¬∞R	> 460 ¬∞R (absolute zero = 0 ¬∞R, but practical > 460) ‚â§ 2000 ¬∞R	Must be positive and ‚â• 460	Gas temp can‚Äôt be below absolute zero; ensures safety margins
Compressibility (Z)	‚Äì	0.1 ‚â§ Z ‚â§ 1.5	Must be between 0.1 and 1.5	Corrects for non-ideal gas; outside range means invalid gas model
Specific Gravity (G)	‚Äì	0.1 ‚â§ G ‚â§ 10	Must be positive, realistic upper bound ~10	Ensures density ratio is realistic
Gas Constant (Cg)	‚Äì	> 0 and ‚â§ 4000	Must be positive and below extreme values	Cg depends on k, prevents division blowup
Coefficient of Discharge (Kd)	‚Äì	0.62 ‚â§ Kd ‚â§ 1.0	Must be within API RP 520 recommendation	Values below 0.62 unsafe; values >1 impossible
Relieving Pressure (PR)	bar a	‚â• 1.01 bar abs up to ~700 bar abs	Must be >1 and ‚â§700	Pressure must be absolute, not vacuum or negative
Backpressure Factor (Kb)	‚Äì	0.5 ‚â§ Kb ‚â§ 2.0	Must be >0 and bounded	Very low or very high Kb leads to unrealistic correction
3. Edge Case Validations

Division by zero ‚Üí If any denominator factor (Cg, Kd, PR, Kb) = 0 ‚Üí show error.

Extremely large flow area (A‚ÇÄ > 100 in¬≤) ‚Üí warn user, may indicate wrong units or system design issue.

Very small area (A‚ÇÄ < 0.01 in¬≤) ‚Üí warn user, may indicate under-sizing or wrong data.

PR < 1 bar abs ‚Üí invalid (vacuum); reject input.

Non-numeric / NaN / Infinity inputs ‚Üí reject.

Cross-dependency: If Z very high (>1.5) + G very high (>10) + PR very low ‚Üí result may be unstable ‚Üí show warning.

4. Output Validation & Thresholds

For reporting clarity:

A‚ÇÄ < 0.1 in¬≤ ‚Üí small valves, suitable for low-flow relief (lab scale, instrument lines).

0.1 ‚Äì 1.0 in¬≤ ‚Üí typical range for industrial PSV sizing.

1.0 ‚Äì 3.0 in¬≤ ‚Üí large valves (chemical, refinery service).

> 3.0 in¬≤ ‚Üí very large, double-check process data.

> 100 in¬≤ ‚Üí reject as unrealistic, possible unit mismatch.

This keeps outputs auditable and aligned with real safety reports. {% endcomment %}