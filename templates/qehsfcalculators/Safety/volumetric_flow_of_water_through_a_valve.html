{% extends 'base.html' %}
{% block title %}Volumetric Flow Rate of Water Through a Valve{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volumetric Flow Rate of Water Through a Valve</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }


        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            min-height: 420px; /* Match calc-card */
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Volumetric Flow Rate of Water Through a Valve</h1>
            <p>Calculate the volume of water flowing through a valve based on its Kv and pressure drop.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Valve & System Parameters</h2>
                <div class="form-group">
                    <label for="flowCoefficient">Flow Coefficient (Kv)</label>
                    <input type="number" id="flowCoefficient" class="form-input" placeholder="Enter Kv value">
                </div>
                <div class="form-group">
                    <label for="pressureDrop">Pressure Drop (ŒîP) in bar</label>
                    <input type="number" id="pressureDrop" class="form-input" placeholder="Enter ŒîP value">
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate Flow Rate</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Engineering illustration">
                    <p>Enter the valve's flow coefficient and the pressure drop across it to calculate the flow rate.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Volumetric Flow Rate (Q)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label">m¬≥/h</div>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Flow Rate Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                       <div class="btn-wrapper">
                            <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                        </div>
                </div>
            </div>
        </div>

        <div class="note-section">
        
            <!-- üìò ABOUT THIS CALCULATOR -->
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Volumetric Flow Through a Valve Calculator</strong> determines the amount of liquid that can
                    flow
                    through a valve under a given pressure drop, using standardized flow coefficients (Cv or Kv).
                    This calculator is crucial for valve sizing, process control, and hydraulic system design, ensuring optimal
                    flow performance and efficiency across industrial applications.
                </p>
                <p>
                    It utilizes internationally accepted definitions of flow coefficients derived from engineering standards
                    such as
                    DIN EN 60534, VDI/VDE 2173, and JIS guidelines.
                </p>
            </div>
        
            <!-- ‚öô PARAMETERS USED -->
            <div class="note-card">
                <h3>‚öô Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Flow Coefficient (Cv or Kv):</strong> Indicates the valve‚Äôs capacity to pass fluid, defined as
                        the flow rate
                        of water at a specific temperature and pressure drop.</li>
                    <li><strong>Pressure Drop (ŒîP):</strong> The difference in pressure across the valve, determining how much
                        force drives the flow.</li>
                </ul>
                <p><em>The flow coefficient (Cv for Imperial units or Kv for Metric units) standardizes valve performance
                        globally.</em></p>
            </div>
        
            <!-- ‚úÖ INPUT VALIDATION RULES -->
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Flow Coefficient (Cv or Kv):</strong> Must be greater than 0 ‚Äî a value of 0 indicates a closed
                        valve.</li>
                    <li><strong>Pressure Drop (ŒîP):</strong> Must be ‚â• 0 bar ‚Äî negative pressure values are invalid.</li>
                    <li><strong>All Inputs Required:</strong> Both Cv/Kv and ŒîP are mandatory for accurate flow rate
                        computation.</li>
                </ul>
                <p><em>Validation ensures that results conform to ISO/DIN measurement integrity and prevent unrealistic
                        output.</em></p>
            </div>
        
            <!-- üìä OUTPUT VALIDATIONS -->
            <div class="note-card">
                <h3>üìä Output Validations</h3>
                <p>The flow rate result is evaluated to indicate the system‚Äôs flow condition:</p>
                <ul class="note-list">
                    <li><strong>Low Flow Rate (Q &lt; 10 m¬≥/h):</strong> ‚úÖ Indicates minimal flow, suitable for precision
                        control systems.</li>
                    <li><strong>Moderate Flow Rate (10 ‚â§ Q ‚â§ 100 m¬≥/h):</strong> ‚öôÔ∏è Normal operational range ‚Äî typical for
                        industrial use.</li>
                    <li><strong>High Flow Rate (Q &gt; 100 m¬≥/h):</strong> ‚ö†Ô∏è Large discharge volume ‚Äî verify valve sizing and
                        downstream capacity.</li>
                </ul>
                <p><em>The same qualitative assessment is displayed alongside the calculator output dynamically.</em></p>
            </div>
        
            <!-- üìê GOVERNING PRINCIPLE -->
            <div class="note-card">
                <h3>üìê Governing Principle</h3>
                <p>
                    A <strong>Volumetric Flow Through A Valve Calculator</strong> uses a standard known as the <strong>Flow
                        Coefficient</strong>,
                    which has two main variations: <strong>Cv</strong> (English/Imperial units) and <strong>Kv</strong> (Metric
                    units).
                    Both Cv and Kv are defined by standards such as <strong>DIN EN 60534</strong>, the <strong>VDI/VDE
                        2173</strong> guidelines,
                    or the <strong>JIS</strong> standard, and are used to quantify a valve‚Äôs flow capacity under specific
                    conditions.
                </p>
        
                <p><strong>Key Concepts</strong></p>
                <ul class="note-list">
                    <li><strong>Flow Coefficient (Cv or Kv):</strong> A standardized measure of a valve‚Äôs ability to pass fluid.
                    </li>
                    <li><strong>Cv (Coefficient of Flow):</strong> Used in the Imperial system ‚Äî number of U.S. gallons of water
                        at 60¬∞F flowing through a valve with a 1 psi pressure drop.
                        Standard often linked to <strong>JIS (Japanese Industrial Standards)</strong>.</li>
                    <li><strong>Kv (Flow Factor):</strong> Used in the Metric system ‚Äî volume of water in m¬≥/h flowing through a
                        valve with a 1 bar pressure drop.
                        Defined by <strong>DIN EN 60534</strong> and <strong>VDI/VDE 2173</strong> guidelines.</li>
                </ul>
        
                <p><strong>How to Use These Standards</strong></p>
                <ul class="note-list">
                    <li><strong>Identify the Standard:</strong> Choose Imperial (Cv) or Metric (Kv) based on your system‚Äôs unit
                        preference.</li>
                    <li><strong>Find the Valve‚Äôs Cv/Kv:</strong> Obtain from manufacturer‚Äôs data sheet or valve body marking.
                    </li>
                    <li><strong>Use the Calculator:</strong> Enter the flow coefficient and pressure drop to predict valve
                        performance or size selection.</li>
                </ul>
            </div>
        
            <!-- üß© CONCLUSION -->
            <div class="note-card">
                <h3>üß© Conclusion</h3>
                <p>
                    This calculator implements globally recognized flow coefficient methods (Cv and Kv) as defined by DIN EN
                    60534,
                    VDI/VDE 2173, and JIS standards. It enables accurate flow predictions for valve selection, system
                    optimization,
                    and energy-efficient design. Correct application of Cv/Kv values ensures process safety, performance
                    consistency,
                    and compliance with international flow measurement practices.
                </p>
            </div>
        
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];
            function getVal(id, label, opts = {}) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (!raw) {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num)) {
                    errors.push(`üëâ Enter a valid number for ${label}.`);
                    return null;
                }
                if (opts.allowZero ? num < 0 : num <= 0) {
                    errors.push(`üëâ ${label} must be a positive number greater than 0.`);
                    return null;
                }
                return num;
            }

            const kv = getVal('flowCoefficient', 'Flow Coefficient (Kv)');
            const dp = getVal('pressureDrop', 'Pressure Drop (ŒîP)', { allowZero: true });

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }
            
            const flowrate = kv * Math.sqrt(dp);

            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = flowrate.toFixed(2);
            
            let feedback;
            if (flowrate < 10) {
                feedback = "<span class='good'><strong>Low Flow Rate:</strong> Indicates minimal water passage, suitable for precision control applications.</span>";
            } else if (flowrate <= 100) {
                 feedback = "<span class='average'><strong>Moderate Flow Rate:</strong> A typical flow rate for standard industrial or commercial use.</span>";
            } else {
                 feedback = "<span class='bad'><strong>High Flow Rate:</strong> Represents a significant volume of water, common in large-scale systems like mains or fire suppression.</span>";
            }
            
            document.getElementById('feedbackContent').innerHTML = feedback;
        }
        
        function printReport() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}