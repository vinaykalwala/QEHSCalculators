{% extends 'base.html' %}
{% block title %}Steam Flow Through Valve Under Critical Condition Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
     
            @media screen and (max-width: 768px) {
    .calculator-header h1 {
        font-size: 1.5rem; /* smaller font for mobile */
        margin-bottom: 8px;
        text-align: center; /* optional: center the heading on mobile */
    }
}
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 250px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
       
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
<div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Steam Flow Through Valve Under Critical Condition Calculator</h1>
        <p>Estimate steam mass flow through a valve and assess operational safety based on valve capacity and upstream pressure.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="Kv">Valve Flow Capacity (K<sub>v</sub>) in Cubic Meters per Hour per Bar:</label>
                <input type="number" id="Kv" class="form-input" step="0.01" min="0" placeholder="e.g., 10">
            </div>
            <div class="form-group">
                <label for="P1">Upstream Absolute Pressure (P<sub>1</sub>) in Bar:</label>
                <input type="number" id="P1" class="form-input" step="0.01" min="0" placeholder="e.g., 5">
            </div>
            <button class="calculate-btn" onclick="calculateSteamFlow()">Calculate Mass Flow Rate</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Steam valve illustration">
                <p>This tool will calculate <strong>Steam Mass Flow Rate</strong>. Enter your data to see results and insights here.</p>
            </div>
            
            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>
            
            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Steam Mass Flow Result</h2>
                </div>
                <div class="rate-value" id="steamFlowValue">0</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">
                    Kilograms per Hour (kg/h)
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<!-- Notes Section -->
<div class="note-section">

    <!-- 📘 About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Steam Flow Through Valve Under Critical Condition Calculator</strong> determines the mass flow rate of steam (in kilograms per hour) passing through a valve when operating under critical flow conditions. It calculates this by combining the valve's flow capacity with the upstream steam pressure. The results help engineers and operators assess valve performance, ensure system safety, and optimize energy efficiency in industrial steam systems.
        </p>
    </div>

    <!-- ⚙️ Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Valve Flow Capacity (K<sub>v</sub>):</strong> Represents the flow capacity of the valve in cubic meters per hour per bar of pressure.</li>
            <li><strong>Upstream Absolute Pressure (P<sub>1</sub>):</strong> The pressure before the valve, measured in bars. Higher pressures increase mass flow rate.</li>
        </ul>
    </div>

    <!-- ✅ Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Valve Flow Capacity (K<sub>v</sub>):</strong> 
                <ul>
                    <li>Must be numeric; non-numeric inputs are invalid.</li>
                    <li>Minimum allowed value: <strong>greater than 0 m³/h·bar</strong>. Zero or negative values are physically impossible.</li>
                    <li>Maximum recommended value: <strong>1000 m³/h·bar</strong> (adjust based on valve specifications). Exceeding this may indicate unrealistic inputs.</li>
                    <li>Decimals allowed: up to 2 decimal places for precise calculations.</li>
                </ul>
            </li>
            <li><strong>Upstream Absolute Pressure (P<sub>1</sub>):</strong>
                <ul>
                    <li>Must be numeric; non-numeric inputs are invalid.</li>
                    <li>Minimum allowed value: <strong>greater than 0 bar</strong>. Negative or zero pressures are invalid in real-world scenarios.</li>
                    <li>Maximum recommended value: <strong>200 bar</strong> (typical industrial max; adjust per equipment specifications). Values above this may be unsafe.</li>
                    <li>Decimals allowed: up to 2 decimal places for accurate mass flow calculation.</li>
                </ul>
            </li>
            <li><strong>Cross-Field Logical Consistency:</strong>
                <ul>
                    <li>The combination of K<sub>v</sub> and P<sub>1</sub> should produce a realistic mass flow rate.</li>
                    <li>Calculated mass flow rate (ṁ<sub>s</sub>) &gt; 10,000 kg/h triggers a warning; values &gt; 20,000 kg/h are flagged as unsafe.</li>
                </ul>
            </li>
        </ul>
    </div>

    <!-- 📊 Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>
                <span class="good">Low Mass Flow (&lt;500 kg/h):</span> 🔵  
                Minimal flow; check if valve size meets system requirements.
            </li>
            <li>
                <span class="average">Normal Mass Flow (500–5000 kg/h):</span> 🟢  
                Flow within typical operating limits.
            </li>
            <li>
                <span class="bad">High Mass Flow (5000–20000 kg/h):</span> 🟠  
                Flow is high; verify valve sizing and upstream pressure.
            </li>
            <li>
                <span class="critical">Extreme Flow Rate (&gt;20000 kg/h):</span> 🔴  
                Mass flow exceeds safe limits; review inputs and system design!
            </li>
        </ul>
        <p>
            <strong>Assessment/Feedback:</strong> The same assessment logic (Low, Normal, High, Extreme) displayed along with results is reflected here to guide safe operation and compliance with industrial steam standards.
        </p>
    </div>

    <!-- 🧭 Governing Principle -->
    <div class="note-card">
        <h3>🧭 Governing Principle</h3>
        <p>
            Steam flow through a valve under critical (or choked) conditions is calculated using standards based on the ISA-75.01.01 and harmonized IEC 60534-2-1 procedures for control valve sizing, which provide equations for both compressible (gas/steam) and incompressible fluids. These standards incorporate specific equations and correction factors to account for the fluid's properties, including its behavior under critical flow conditions where the flow velocity reaches the speed of sound.
        </p>
        <p><strong style="color: #1976d2;">Key Standards:</strong></p>
        <ul class="note-list">
            <li><strong>ISA-75.01.01:</strong> This American National Standard, developed by the ISA (International Society of Automation), provides standardized equations for sizing control valves, including those used for gas and steam.</li>
            <li><strong>IEC 60534-2-1:</strong> This International Electrotechnical Commission (IEC) standard is a global equivalent to the ISA standard, with which ISA-75.01.01 has been harmonized.</li>
        </ul>
        <p><strong style="color: #1976d2;">What the Standards Address:</strong></p>
        <ul class="note-list">
            <li><strong>Compressible Flow Equations:</strong> Calculating flow of gases and steam through valves, accounting for compressibility.</li>
            <li><strong>Critical Flow (Choked Flow):</strong> Considers point where flow reaches maximum velocity (critical flow factor Cf).</li>
            <li><strong>Flow Coefficient (Cv):</strong> Determines the valve’s capacity to handle specific flow rates at a given pressure drop.</li>
            <li><strong>Correction Factors:</strong> Accounts for valve geometry and fluid properties.</li>
        </ul>
        <p>
            By following these standards, engineers can accurately size control valves for steam applications, preventing underperformance, excessive wear, or energy waste. The same assessment logic displayed along with results (Low, Normal, High, Extreme Mass Flow) is derived from these standards.
        </p>
    </div>

    <!-- 🏁 Conclusion -->
    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            The <strong>Steam Flow Calculator</strong> provides reliable mass flow estimates for valves under critical conditions, supporting safe, efficient, and optimized steam system operation. Always ensure input values are realistic for accurate results.
        </p>
    </div>

</div>


<script>
function calculateSteamFlow() {
    const Kv = parseFloat(document.getElementById("Kv").value);
    const P1 = parseFloat(document.getElementById("P1").value);
    const proportionalConstant = 12;

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const steamFlowValue = document.getElementById('steamFlowValue');
    const feedbackContent = document.getElementById('feedbackContent');

    let errors = [];

    // --- Input Validations ---
    if (isNaN(Kv) || Kv <= 0) errors.push("👉 Valve Flow Capacity must be a positive number.");
    if (Kv > 1000) errors.push("⚠️ Valve Flow Capacity unusually high (>1000 m³/h·bar). Check input.");
    if (isNaN(P1) || P1 <= 0) errors.push("👉 Upstream Absolute Pressure must be a positive number.");
    if (P1 > 200) errors.push("⚠️ Upstream Pressure unusually high (>200 bar). Check input.");

    // Stop if errors exist
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculate Mass Flow Rate ---
    const massFlowRate = proportionalConstant * Kv * P1;
    steamFlowValue.textContent = massFlowRate.toFixed(2);

    // --- Output Validation & Feedback ---
    let feedback = "";
    let color = "";

    if (massFlowRate < 500) {
        feedback = "🔵 Low Mass Flow: Minimal flow; check if valve size meets system requirements.";
        color = "blue";
    } else if (massFlowRate >= 500 && massFlowRate <= 5000) {
        feedback = "🟢 Normal Mass Flow: Flow within typical operating limits.";
        color = "green";
    } else if (massFlowRate > 5000 && massFlowRate <= 20000) {
        feedback = "🟠 High Mass Flow: Flow is high; verify valve sizing and upstream pressure.";
        color = "orange";
    } else {
        feedback = "🔴 Extreme Flow Rate: Mass flow exceeds safe limits; review inputs and system design!";
        color = "red";
    }

    feedbackContent.innerHTML = `<strong style="color:${color}">${feedback}</strong>`;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>




    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Inputs Analysis & Real-World QEHS Perspective

Inputs:

Input	Unit	QEHS Considerations
Valve Flow Capacity (K<sub>v</sub>)	m³/h per bar	Determines the maximum flow the valve can handle. Must be realistic for pipe diameter and rated valve type. Overestimating can lead to oversizing and wastage; underestimating can lead to unsafe overpressure.
Upstream Absolute Pressure (P<sub>1</sub>)	bar	Pressure before the valve. Must not exceed equipment ratings (valve, piping, boiler). Excessive pressure can cause mechanical failure or accidents.

Calculation Formula:

Mass Flow Rate (
m
˙
_s, kg/h)
=
𝐾
𝑣
×
𝑃
1
×
Proportional Constant (12)
Mass Flow Rate (
m
˙
_s, kg/h)=K
v
	​

×P
1
	​

×Proportional Constant (12)

Proportional Constant accounts for conversion factors and critical flow assumptions.

Represents critical flow through a valve, where steam reaches sonic velocity.

QEHS Insight:

Flow must never exceed valve or piping design limits.

High steam mass flow may lead to overheating, pipe stress, or flash steam hazards.

Values must be audited against OSHA, NFPA, ISO 45001, and ILO safety standards.

2. Recommended Input Validation Rules

Valve Flow Capacity (K<sub>v</sub>):

Must be numeric.

Minimum: > 0 m³/h·bar.

Maximum: <= 1000 m³/h·bar (example limit based on industrial valves; adjust per facility standards).

Decimals allowed: 2 (precision for sizing).

Upstream Absolute Pressure (P<sub>1</sub>):

Must be numeric.

Minimum: > 0 bar (zero or negative is physically impossible).

Maximum: <= 200 bar (typical industrial max; adjust per equipment).

Decimals allowed: 2.

Cross-field Logic:

Calculate mass flow = Kv × P1 × constant.

Mass flow must not exceed 20,000 kg/h (industrial limit for typical steam lines; adjust per design).

Warn if Kv × P1 leads to >10,000 kg/h – check input realism.

Edge Cases:

Division by zero: not relevant here (no division), but zero inputs must be blocked.

Extremely small values (<0.01) – warn for negligible flow.

Extremely high combinations – flag as potential unsafe operating condition.

Non-numeric or empty inputs: stop calculation.

3. Output Validation Logic
Output	QEHS Assessment	Thresholds & Rationale
Low Mass Flow (<500 kg/h)	🔵 Minimal flow	Check if valve size is sufficient; small flow may reduce heat transfer efficiency.
Normal Mass Flow (500–5000 kg/h)	🟢 Safe operating range	Typical industrial steam usage; system is safe.
High Mass Flow (>5000 kg/h)	🔴 High flow	Potential risk of pipe stress, overpressure, or valve failure; safety review required.

Compliance Perspective:

Flow thresholds ensure safe operation under design pressure.

Helps auditors verify KPIs during OSHA/NFPA compliance checks.

Provides early warning to prevent steam hazards.

✅ Summary of Why Each Validation is Essential

Numeric & Positive: Prevents impossible physical conditions.

Maximum Thresholds: Protects valves and pipelines; avoids overpressure accidents.

Cross-field Logical Checks: Ensures combination of Kv × P1 is realistic and safe.

Decimals & Units: Ensures engineering precision and consistency in audit reports.

Output Categorization: Supports safe operating ranges, compliance reporting, and risk assessment. -->