{% extends 'base.html' %}
{% block title %}Road Safety - Time Headway (TH) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
       
        .result-placeholder img {
            max-width: 350px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        @media (max-width: 768px) {
    .result-placeholder img {
        max-width: 80%;    /* Slightly smaller on tablets */
    }
}

@media (max-width: 480px) {
    .result-placeholder img {
        max-width: 100%;   /* Full width on small screens */
        margin-bottom: 15px;
    }
}
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
  <div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Road Safety & Time Headway (TH) Calculator</h1>
        <p>Estimate the time gap between two successive vehicles based on traffic flow rate.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="trafficFlow">Traffic Flow Rate (vehicles/hour)</label>
                <input type="number" id="trafficFlow" class="form-input" min="0" placeholder="e.g., 1800">
            </div>
            <button class="calculate-btn" onclick="calculateTimeHeadway()">Calculate Time Headway</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/roadsafety.png' %}" alt="Traffic illustration">
                <p>This tool calculates <strong>Time Headway</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">‚ùå</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Time Headway Result</h2>
                </div>
                <div class="rate-value" id="timeHeadwayValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">
                    Time in seconds (s)
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
       <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
        The <strong>Time Headway Calculator</strong> is designed to help drivers, traffic engineers, urban planners, and safety analysts understand vehicle spacing on roads under varying traffic conditions. By evaluating the time interval between two successive vehicles, users can gauge whether the traffic flow allows for safe driving and reaction time. 
    </p>
    <p>
        Maintaining adequate time headways is critical for preventing rear-end collisions, optimizing traffic signal timings, and designing safer and more efficient roadways. This calculator provides a quick and practical way to assess vehicle gaps based on observed traffic flow rates, supporting both everyday driving decisions and professional traffic management analyses.
    </p>
</div>

<div class="note-card">
    <h3>‚öôÔ∏è Parameters Used</h3>
    <ul class="note-list">
        <li><strong>Traffic Flow Rate (vehicles/hour):</strong> Represents how many vehicles pass a specific point on the road in one hour. Higher flow rates generally indicate more congested conditions, which can reduce the spacing between vehicles.</li>
        <li><strong>Time Headway (TH):</strong> The time interval in seconds between two consecutive vehicles as they pass a point. Shorter headways may indicate increased risk of collisions, while longer headways suggest safer gaps for reaction and braking.</li>
    </ul>
</div>


       <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Traffic Flow Rate (vehicles/hour):</strong> Must be numeric. Ensures valid calculations; non-numeric inputs cannot be processed.</li>
        <li>Must be greater than 0. Time Headway (TH) is undefined for zero or negative traffic flow (prevents division by zero).</li>
        <li>Typical range: 100‚Äì10,000 vehicles/hour. Extremely high values (>10,000) are rare and may indicate input errors; very low values (<100) may indicate abnormal conditions.</li>
        <li>Allow decimals up to 2 places. Traffic flow is usually integer, but decimal input allows for precision from automated sensors or measurement devices.</li>
        <li>Cross-check: Extremely high traffic flow combined with very low TH values (<0.5 s) triggers a warning. Prevents unrealistic outputs that would fail safety audits or risk assessments.</li>
    </ul>
</div>


        <div class="note-card">
    <h3>üìä Output Validation</h3>
    <ul class="note-list">
        <li><strong>Time Headway (TH) ‚â• 3 s:</strong> ‚úÖ Safe gap between vehicles. Low risk of rear-end collisions. Complies with standard road safety practices; vehicles have sufficient reaction time.</li>
        <li><strong>1.5 s ‚â§ TH &lt; 3 s:</strong> ‚ö†Ô∏è Moderate gap. Drivers should remain alert. Traffic density is increasing; safety margins are adequate but vigilance is needed.</li>
        <li><strong>TH &lt; 1.5 s:</strong> ‚ùå High risk of collisions. Dense traffic; drivers must maintain extra caution. May trigger alerts in traffic management systems or safety audits.</li>
        <li><strong>TH &lt; 0.5 s:</strong> ‚ö†Ô∏è Extremely low gap. Unrealistic or unsafe vehicle spacing. Likely input error or abnormal traffic conditions; requires verification.</li>
    </ul>
    <p>
        These ranges align with **ISO 39001**, **OSHA**, and traffic safety best practices. When using this tool for safety audits or traffic planning, always consider additional factors such as road conditions, weather, and driver behavior.
    </p>
</div>

       <div class="note-card">
    <h3>üìã Standards & Compliance</h3>
    <p>
        This calculator is designed to align with international road safety and occupational standards to ensure accurate assessment of vehicle spacing and time headways:
    </p>
    <ul class="note-list">
        <li><strong>ISO 39001:</strong> Road traffic safety management standard for vehicle spacing and traffic flow assessment.</li>
        <li><strong>OSHA & Local Traffic Guidelines:</strong> Ensures safe vehicle spacing on work sites and urban roads.</li>
        <li><strong>Calculated Time Headway:</strong> TH values calculated using this calculator can be used to assess vehicle gaps and support compliance with road safety standards.</li>
    </ul>
    <p>
        Always verify inputs and consider traffic conditions and driver behavior to ensure accurate assessment and compliance.
    </p>
</div>

        <div class="note-card">
            <h3>üìù Conclusion</h3>
            <p>
                Maintaining appropriate time headways is crucial for road safety. Use this calculator to guide safe driving practices and support traffic management decisions.
            </p>
        </div>
    </div>
</div>

<script>
function calculateTimeHeadway() {
    const trafficFlowInput = document.getElementById('trafficFlow').value.trim();
    const trafficFlow = parseFloat(trafficFlowInput);

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const feedbackContent = document.getElementById('feedbackContent');

    let errors = [];

    // --- Mandatory & Type Check ---
    if (trafficFlowInput === "") {
        errors.push("üëâ Traffic flow is required.");
    } else if (isNaN(trafficFlow)) {
        errors.push("üëâ Traffic flow must be a numeric value.");
    }

    // --- Decimal Precision Check ---
    if (!isNaN(trafficFlow)) {
        const decimalPlaces = (trafficFlowInput.split('.')[1] || '').length;
        if (decimalPlaces > 2) {
            errors.push("üëâ Traffic flow can have up to 2 decimal places only.");
        }
    }

    // --- Range Checks ---
    if (!isNaN(trafficFlow)) {
        if (trafficFlow <= 0) errors.push("üëâ Traffic flow must be greater than 0 vehicles/hour.");
        if (trafficFlow < 100) errors.push("‚ö†Ô∏è Traffic flow unusually low (<100 vehicles/hour). Verify input.");
        if (trafficFlow > 10000) errors.push("‚ö†Ô∏è Traffic flow unusually high (>10,000 vehicles/hour). Verify input.");
    }

    // --- Stop and display errors ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculation ---
    const timeHeadway = 3600 / trafficFlow; // seconds

    // --- Cross-field / logical consistency check ---
    if (timeHeadway < 0.5) {
        feedbackContent.innerHTML = `<strong style="color:red">‚ö†Ô∏è Calculated TH is extremely low (<0.5 s). Check traffic flow input.</strong>`;
    } else {
        // --- Output Feedback ---
        let feedback = "";
        let color = "";

       if (timeHeadway >= 3) {
    feedback = "‚úÖ Safe gap between vehicles. Low risk of rear-end collisions. Complies with standard road safety practices; vehicles have sufficient reaction time.";
    color = "green";
} else if (timeHeadway >= 1.5) {
    feedback = "‚ö†Ô∏è Moderate gap. Drivers should remain alert. Traffic density is increasing; safety margins are adequate but vigilance is needed.";
    color = "orange";
} else if (timeHeadway >= 0.5) {
    feedback = "‚ùå High risk of collisions. Dense traffic; drivers must maintain extra caution. May trigger alerts in traffic management systems or safety audits.";
    color = "red";
} else {
    feedback = "‚ö†Ô∏è Extremely low gap. Unrealistic or unsafe vehicle spacing. Likely input error or abnormal traffic conditions; requires verification.";
    color = "darkred";
}


        feedbackContent.innerHTML = `<strong style="color:${color}">${feedback}</strong>`;
    }

    // --- Display Result ---
    document.getElementById('timeHeadwayValue').textContent = timeHeadway.toFixed(2);
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- . Analysis of Calculator Inputs, Outputs, and Formula

Input:

Traffic Flow Rate (vehicles/hour)

Must be positive, numeric, and realistic.

Represents traffic density indirectly (more vehicles/hour ‚Üí smaller headways ‚Üí higher collision risk).

Output:

Time Headway (TH) in seconds: TH = 3600 / trafficFlow

Represents the average time interval between consecutive vehicles.

Real-world safety perspective:

TH < 1.5 s ‚Üí High risk, unsafe driving

1.5 ‚â§ TH < 3 s ‚Üí Moderate risk

TH ‚â• 3 s ‚Üí Safe gap

Output is a KPI used in traffic safety audits, urban planning, and QEHS compliance reporting.

2. Recommended Input Validation Rules
Parameter	Rule	Industry Reasoning
Traffic Flow Rate (vehicles/hour)	Must be numeric	Ensures valid calculations; non-numeric inputs cannot be processed.
	Must be > 0	TH is undefined for zero or negative traffic flow (division by zero).
	Typical range: 100‚Äì10,000 vehicles/hour	Extremely high values (>10,000) are rare; may indicate input error.
	Allow decimals up to 2 places	Traffic flow is usually integer, but decimal input allows data from automated sensors.
	Cross-check: High flow + extremely low TH triggers warning	Prevents unrealistic outputs that would fail safety audits.
3. Edge Case Validations
Edge Case	Handling	Reason
Traffic Flow = 0	Block calculation, show error	Division by zero, physically impossible.
Traffic Flow negative	Block calculation	Cannot have negative vehicles.
Extremely high traffic flow (e.g., >10,000 vehicles/hour)	Show warning but allow	Could be legitimate in very dense urban traffic but requires verification.
Decimal overflow or NaN	Block calculation	Ensures reliable calculations and avoids UI crashes.
TH < 0 or unrealistically low (<0.5 s)	Flag as unrealistic	Unachievable in real traffic; indicates input error.
4. Output Validation Logic & Threshold Explanations

Time Headway ‚â• 3 s: ‚úÖ Safe gap

Low risk of rear-end collisions; recommended by ISO 39001 for normal roads.

1.5 ‚â§ TH < 3 s: ‚ö†Ô∏è Moderate gap

Traffic is manageable but requires alert driving; common in urban areas.

TH < 1.5 s: ‚ùå High risk

High density; immediate safety interventions recommended.

TH > 60 s: ‚ö†Ô∏è Extremely low traffic flow; verify input | May indicate empty highway, sensor error, or reporting mistake. -->

<!-- 7. Compliance Rationale for Each Validation

Mandatory & numeric check: Ensures meaningful KPIs in safety audits. Non-numeric or missing inputs could generate misleading reports.

Positive flow (>0): Division by zero is physically impossible; negative values are invalid.

Upper/lower bounds (50‚Äì10,000): Aligns with real-world traffic observations and ISO 39001 safety benchmarks. Extreme values are flagged for audit verification.

Edge cases (very low/high TH): Alerts QEHS officers to potentially unsafe traffic conditions or sensor/input errors.

Decimal precision: Ensures compatibility with automated traffic data while maintaining accuracy in reports.

Output thresholds: Provides actionable guidance for drivers, traffic management, and safety auditors. -->