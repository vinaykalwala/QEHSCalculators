{% extends 'base.html' %}
{% block title %}Chemical Exposure Burn Severity Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Exposure Burn Severity Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 12px;
        }
         .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 520px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        
        /* Select input */
        .select-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .extreme { 
            color: #8b0000; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Input with select wrapper */
        .input-with-select {
            display: flex;
            gap: 10px;
        }
        
        .input-with-select .form-input {
            flex: 2;
        }
        
        .input-with-select .select-input {
            flex: 1;
        }
    </style>
</head>
<body>
     <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Chemical Exposure Burn Severity Rate Calculator</h1>
            <p>Calculate the potential severity of burns caused by chemical exposure based on concentration, exposure time, and toxicity</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="chemicalConcentration">Chemical Concentration (mg/m³ or ppm)</label>
                    <input type="number" id="chemicalConcentration" class="form-input" min="0" step="any" placeholder="e.g., 50">
                </div>
                <div class="form-group">
                    <label for="exposureTime">Exposure Time</label>
                    <div class="input-with-select">
                        <input type="number" id="exposureTime" class="form-input" min="0" step="any" placeholder="e.g., 30">
                        <select id="timeUnit" class="select-input">
                            <option value="minutes">Minutes</option>
                            <option value="hours">Hours</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="lethalDose">LD50 (mg/kg)</label>
                    <input type="number" id="lethalDose" class="form-input" min="0" step="any" placeholder="e.g., 500">
                </div>
                
                <button class="calculate-btn" onclick="calculateBurnSeverity()">Calculate Burn Severity</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/4089/4089077.png" alt="Chemical safety illustration">
                    <p>This tool will calculate the <strong>Chemical Exposure Burn Severity (CEBS)</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Chemical Exposure Burn Severity (CEBS)</h2>
                    </div>
                    <div class='rate-display'>
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">CEBS Score</div></div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>High</span><span>Extreme</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Risk Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Chemical Exposure Burn Severity (CEBS) Calculator</strong> helps evaluate the potential severity of burns caused by chemical exposure by considering the chemical concentration, duration of exposure, and toxicity level of the substance (measured by LD50).
                </p>
            </div>
            <div class="note-card">
                <h3>❓ What is Chemical Exposure Burn Severity (CEBS)?</h3>
                <p>CEBS is an indicative measure used to estimate the potential severity of burns caused by chemical exposure. It helps assess the level of danger posed by a chemical in a given environment.</p>
            </div>
            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Chemical Concentration (mg/m³ or ppm):</strong> The amount of a chemical present in the air or environment.</li>
                    <li><strong>Exposure Time:</strong> The duration for which an individual is exposed to the chemical.</li>
                    <li><strong>LD50 (mg/kg):</strong> Lethal Dose for 50% of the population - represents the dose at which 50% of test subjects die after exposure.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>📊 Interpretation Guidelines</h3>
                <ul class="note-list">
                    <li><span class="good">CEBS &lt; 0.1</span> → Low Risk: Minimal burn potential</li>
                    <li><span class="average">CEBS 0.1 - 0.5</span> → Moderate Risk: May cause noticeable burns</li>
                    <li><span class="bad">CEBS 0.5 - 1.0</span> → High Risk: Likely to cause significant burns</li>
                    <li><span class="extreme">CEBS ≥ 1.0</span> → Extreme Risk: Potential for severe burns and systemic toxicity</li>
                </ul>
                <p>Note: Always compare results against known safety standards for specific chemicals.</p>
            </div>
            <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Chemical Concentration:</strong> 0.01 – 100,000 mg/m³ or ppm (positive only, 3 decimals allowed).</li>
        <li><strong>Exposure Time:</strong> 1 – 1440 minutes (or 0.1 – 24 hours).</li>
        <li><strong>LD50:</strong> 1 – 10,000 mg/kg (check SDS for chemical-specific values).</li>
        <li>No negative values or empty inputs allowed.</li>
        <li>LD50 must not be 0 (division by zero risk).</li>
        <li>Values outside these ranges will trigger an error.</li>
        <li>Always cross-check results with OSHA PEL, ACGIH TLV, and SDS data.</li>
    </ul>
</div>

        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateBurnSeverity() {
    const concentration = document.getElementById('chemicalConcentration').value.trim();
    const exposureTime = document.getElementById('exposureTime').value.trim();
    const timeUnit = document.getElementById('timeUnit').value;
    const ld50 = document.getElementById('lethalDose').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // Chemical Concentration
    if (concentration === "") {
        errors.push("👉 Please enter the chemical concentration.");
    } else if (isNaN(concentration) || parseFloat(concentration) <= 0) {
        errors.push("👉 Chemical concentration must be greater than 0.");
    } else if (parseFloat(concentration) > 100000) {
        errors.push("👉 Chemical concentration is unrealistically high. Check input.");
    }

    // Exposure Time
    if (exposureTime === "") {
        errors.push("👉 Please enter the exposure time.");
    } else if (isNaN(exposureTime) || parseFloat(exposureTime) <= 0) {
        errors.push("👉 Exposure time must be greater than 0.");
    } else if (timeUnit === "minutes" && parseFloat(exposureTime) > 1440) {
        errors.push("👉 Exposure time cannot exceed 1440 minutes (24 hours).");
    } else if (timeUnit === "hours" && parseFloat(exposureTime) > 24) {
        errors.push("👉 Exposure time cannot exceed 24 hours.");
    }

    // LD50
    if (ld50 === "") {
        errors.push("👉 Please enter the LD50 value.");
    } else if (isNaN(ld50) || parseFloat(ld50) <= 0) {
        errors.push("👉 LD50 must be greater than 0.");
    } else if (parseFloat(ld50) > 10000) {
        errors.push("👉 LD50 value is unrealistic (>10,000 mg/kg). Check SDS.");
    }

    // Show errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Convert inputs
    const conc = parseFloat(concentration);
    let expTime = parseFloat(exposureTime);
    const ld = parseFloat(ld50);

    if (timeUnit === "hours") {
        expTime *= 60; // convert to minutes
    }

    // Compute CEBS
    const cebs = (conc * expTime) / ld;

    // Handle negligible cases
    if (cebs === 0) {
        document.getElementById('rateValue').textContent = "0.0000 (Negligible Risk)";
    } else {
        document.getElementById('rateValue').textContent = cebs.toFixed(4);
    }

    // Risk interpretation
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (cebs < 0.1) {
        meterWidth = '25%'; 
        meterColor = '#2ecc71';
        feedback = '🟢 Low Risk! Minimal burn potential, but monitor for any symptoms.';
    } else if (cebs < 0.5) {
        meterWidth = '50%'; 
        meterColor = '#f39c12';
        feedback = '🟠 Moderate Risk! May cause noticeable burns. Prompt treatment recommended.';
    } else if (cebs < 1.0) {
        meterWidth = '75%'; 
        meterColor = '#e67e22';
        feedback = '🔴 High Risk! Likely to cause significant burns. Urgent decontamination needed.';
    } else {
        meterWidth = '95%'; 
        meterColor = '#e74c3c';
        feedback = '⚠️ Extreme Risk! Immediate medical attention required. Potential for severe burns and systemic toxicity.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


{% comment %} 


/* 
Formula:
    CEBS = (Chemical Concentration × Exposure Time) / LD50
    - C = concentration (mg/m³ or ppm), valid range: 0.01 – 100,000
    - T = exposure time (minutes), valid range: 1 – 1440
    - LD50 = mg/kg, valid range: 1 – 10,000
Validation Rules:
    - No negative values
    - No division by zero (LD50 > 0)
    - Time converted to minutes if entered in hours
    - Cross-field: unrealistic extreme values rejected
*/




1. Real-World QEHS / Fire Safety Analysis

This calculator estimates Chemical Exposure Burn Severity (CEBS) using:

𝐶
𝐸
𝐵
𝑆
=
𝐶
×
𝑇
𝐿
𝐷
50
CEBS=
LD
50
	​

C×T
	​


C (Chemical Concentration) → mg/m³ or ppm

T (Exposure Time) → minutes (converted from hours if needed)

LD50 (mg/kg) → Lethal Dose for 50% population

🔹 Practical Use: This is an indicative tool, not a regulatory index. Real standards (ACGIH TLVs, OSHA PELs, NFPA chemical burn classifications) require reference to specific chemical safety data sheets (SDS). This tool is useful for screening risk levels but should not replace official exposure models.

2. Input Validation Rules
Chemical Concentration (mg/m³ or ppm)

Unit: mg/m³ (airborne concentration) or ppm

Valid Range: 0.01 – 100,000 (values below detection are meaningless; values above are extremely unrealistic)

Decimals Allowed: Up to 3 decimal places

Compliance Reason: OSHA PELs rarely exceed 5000 ppm, so outliers should trigger warnings.

Exposure Time

Unit: minutes / hours

Valid Range: 1 – 1440 minutes (1 day)

Decimals Allowed: 0.1 minutes (6 seconds)

Cross-field check: Exposure time of 0 or negative must be rejected.

Compliance Reason: ISO 45001 and OSHA standards consider 8h TWA or STEL (15 min). Beyond 24h is biologically irrelevant.

LD50 (mg/kg)

Unit: mg/kg (oral, dermal, inhalation depends on chemical)

Valid Range: 1 – 10,000

Decimals Allowed: 1 decimal place

Compliance Reason: Globally Harmonized System (GHS) defines:

<50 mg/kg = extremely toxic

50–300 mg/kg = highly toxic

300–2000 mg/kg = harmful

>2000 mg/kg = less toxic

3. Output Validation & Thresholds

Already defined in your code — I recommend keeping but justifying:

CEBS < 0.1 → Low Risk (minimal irritation)

0.1 ≤ CEBS < 0.5 → Moderate Risk (burns possible, first aid needed)

0.5 ≤ CEBS < 1.0 → High Risk (significant burns, urgent decontamination)

≥ 1.0 → Extreme Risk (severe burns, systemic toxicity, emergency response)

✅ Matches NFPA chemical hazard severity interpretation. {% endcomment %}