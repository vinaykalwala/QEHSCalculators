{% extends 'base.html' %}
{% block title %}Averaging Thickness for Corroded Areas Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Averaging Thickness for Corroded Areas Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            overflow-y: 320;
            justify-content:center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
   
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Averaging Thickness for Corroded Areas Calculator</h1>
            <p>Calculate the required length for thickness averaging based on vessel diameter</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="diameter">Vessel Diameter (D) [inches]</label>
                    <input type="number" id="diameter" class="form-input" min="0" step="any" placeholder="e.g., 30">
                </div>
                
                <button class="calculate-btn" onclick="calculateAveragingThickness()">Calculate Averaging Length</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Length for Averaging Thickness</strong>. Enter the vessel diameter to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Averaging Length</h2>
                    </div>
                    <div class="rate-display">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Inches (Length for Averaging)</div></div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low Risk</span><span>Moderate Risk</span><span>High Risk</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Risk Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

<!-- Notes Section -->
<div class="note-section">

    <!-- 1. About -->
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            The <strong>Averaging Thickness for Corroded Areas Calculator</strong> determines the required 
            <em>length for averaging thickness measurements</em> in corroded regions of pressure vessels, tanks, 
            or similar components based on the vessel's internal diameter.  
            This approach ensures accurate evaluation of corrosion impact, structural integrity, and 
            compliance with <strong>API 579 / ASME FFS-1</strong> fitness-for-service assessment standards.
        </p>
    </div>

    <!-- 2. Parameters Used -->
    <div class="note-card">
        <h3>‚öôÔ∏è Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Vessel Diameter (D):</strong> The internal diameter of the vessel or component being assessed (in inches).</li>
            <li><strong>Averaging Length (L):</strong> The calculated length used for averaging thickness readings, ensuring 
                the corrosion area is represented accurately for safe evaluation.</li>
        </ul>
    </div>

    <!-- 3. Input Validation Rules -->
    <div class="note-card">
        <h3>‚úÖ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Required Field:</strong> Vessel diameter must be entered.</li>
            <li><strong>Numeric Only:</strong> No text, symbols, or negative values allowed.</li>
            <li><strong>Positive Value:</strong> Diameter must be greater than 0.</li>
            <li><strong>Minimum:</strong> 6 inches (per API 579 recommended lower limit).</li>
            <li><strong>Maximum:</strong> 300 inches ‚Äî values beyond this trigger a warning as unrealistic.</li>
            <li><strong>Precision:</strong> Up to two decimal places accepted for accurate reporting.</li>
        </ul>
    </div>

    <!-- 4. Output Validations -->
    <div class="note-card">
        <h3>üìä Output Validations</h3>
        <p>The calculated <strong>Averaging Length (L)</strong> is classified into risk categories based on corrosion impact:</p>
        <ul class="note-list">
            <li>‚úÖ <strong>Low Risk (‚â• 30 inches):</strong> Corrosion impact minimal; periodic monitoring is sufficient.</li>
            <li>‚ö†Ô∏è <strong>Moderate Risk (15 ‚Äì 30 inches):</strong> Acceptable, but requires regular inspections.</li>
            <li>üö® <strong>High Risk (&lt; 15 inches):</strong> Significant corrosion; frequent monitoring and immediate assessment recommended.</li>
        </ul>
        <p>
            These exact feedback sentences appear in the result display and follow the same visual indicators 
            (‚úÖ, ‚ö†Ô∏è, üö®) for consistent interpretation.
        </p>
    </div>

    <!-- 5. Governing Principle -->
    <div class="note-card">
        <h3>üß≠ Governing Principle</h3>
        <p>
            There isn't one single global standard defining the averaging thickness for corroded areas; 
            instead, it depends on several <strong>engineering codes and industry practices</strong> 
            used for different applications such as <b>API, ASME, and IS standards</b>.  
            These standards define methodologies, formulas, and safety factors to ensure structural integrity, 
            reliability, and compliance during corrosion assessments.
        </p>

        <h3>üìö Key Standards and Their Applications</h3>
        <ul class="note-list">
            <li><strong>API 653 (Storage Tanks):</strong> Provides methods for evaluating large corroded areas in aboveground storage tanks, 
                including the "one-foot rule" and calculations for minimum acceptable thickness based on corrosion rate.</li>

            <li><strong>API 579-1 / ASME FFS-1 (Pressure Vessels):</strong> The primary standard for evaluating metal loss due to corrosion, 
                pitting, or local thinning. It defines multiple assessment levels to determine whether a corroded vessel 
                can safely remain in service.</li>

            <li><strong>ASME Codes (e.g., ASME B31.3):</strong> Cover the design and inspection of piping systems. 
                These include formulas for calculating wall thickness and determining the structural effect of corrosion.</li>

            <li><strong>EN ISO 12944:</strong> Focuses on corrosion protection of steel structures through coatings, 
                classifying environmental corrosivity and expected coating durability.</li>

            <li><strong>Indian Standards (IS):</strong> For Indian contexts, the <b>Bureau of Indian Standards (BIS)</b> 
                issues relevant standards such as <b>IS 4759</b> for hot-dip zinc coatings and others for corrosion testing and material quality.</li>
        </ul>

        <h3>‚öôÔ∏è Factors Influencing the Standard Used</h3>
        <ul class="note-list">
            <li><strong>Type of Equipment:</strong> Tanks, pressure vessels, and pipelines each follow different codes (e.g., API 653, API 579, ASME B31.3).</li>
            <li><strong>Service & Environment:</strong> The chemical environment, temperature, and pressure affect which standard applies.</li>
            <li><strong>Corrosion Type:</strong> General, pitting, or localized metal loss determine which formula and section of the standard are used.</li>
            <li><strong>Level of Risk:</strong> High-risk industries (like oil, gas, and chemical plants) rely heavily on API and ASME standards for safety validation.</li>
        </ul>

        <p><b style="color: #1976d2;">Key Takeaway:</b>  
            The averaging thickness calculation is a vital step in assessing corroded components‚Äô safety, 
            and engineers must select the appropriate code or standard based on the component‚Äôs type, 
            service environment, and regulatory framework.
        </p>
    </div>

    <!-- 6. Conclusion -->
    <div class="note-card">
        <h3>üîö Conclusion</h3>
        <p>
            The <strong>Averaging Thickness for Corroded Areas Calculator</strong> simplifies the application of 
            industry standards such as <b>API 579</b> and <b>ASME FFS-1</b> by providing a clear, rule-based 
            method for determining averaging lengths.  
            Using this tool helps engineers conduct accurate corrosion assessments, maintain regulatory 
            compliance, and ensure the continued safe operation of critical assets through informed inspection 
            and maintenance planning.
        </p>
    </div>

</div>




    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateAveragingThickness() {
    const diameterInput = document.getElementById('diameter').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    // Reset previous results
    errorBox.classList.add('hidden');

    // === INPUT VALIDATIONS ===
    // Empty check
    if (diameterInput === "") {
        errorMessage.textContent = "üëâ Please enter the vessel diameter.";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Parse value
    const diameter = parseFloat(diameterInput);

    // Not a number
    if (isNaN(diameter)) {
        errorMessage.textContent = "üëâ Vessel diameter must be a valid number.";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Negative or zero
    if (diameter <= 0) {
        errorMessage.textContent = "üëâ Vessel diameter must be greater than zero.";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Minimum threshold
    if (diameter < 6) {
        errorMessage.textContent = "üëâ Minimum vessel diameter for assessment is 6 inches (API practice).";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Maximum threshold warning
    if (diameter > 300) {
        errorMessage.textContent = "‚ö†Ô∏è Diameter exceeds 300 inches. Please confirm input ‚Äî this may be unrealistic for typical vessels.";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // === CALCULATION ===
    let lengthForAveraging;
    if (diameter <= 60) {
        lengthForAveraging = Math.min(2 * diameter, 20);
    } else {
        lengthForAveraging = Math.min(3 * diameter, 40);
    }

    // === OUTPUT DISPLAY ===
    document.getElementById('rateValue').textContent = lengthForAveraging.toFixed(2);

    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (lengthForAveraging >= 30) {
        meterWidth = '25%';
        meterColor = '#27ae60';
        feedback = '‚úÖ Low Risk: Corrosion impact minimal; periodic monitoring is sufficient.';
    } else if (lengthForAveraging >= 15) {
        meterWidth = '50%';
        meterColor = '#f39c12';
        feedback = '‚ö†Ô∏è Moderate Risk: Within acceptable limits; maintain regular inspections.';
    } else {
        meterWidth = '95%';
        meterColor = '#e74c3c';
        feedback = 'üö® High Risk: Significant corrosion; frequent monitoring and immediate assessment recommended.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
{% comment %} 

1. Formula (to add in code as comments)

/**

üìò Formula (per ASME/API 579 guidelines for localized corrosion assessment):

If D ‚â§ 60 in ‚Üí L = min(2 √ó D, 20)

If D > 60 in ‚Üí L = min(3 √ó D, 40)

Where:

D = vessel inside diameter (inches)

L = required averaging length for thickness measurements (inches)

Purpose: Ensures localized corrosion assessment is representative and avoids overly conservative/unsafe evaluations.
*/

2. Input Validation Rules (QEHS/Fire Safety Standards)

Vessel Diameter (D):

Units: Inches (must be consistent with API/ASME formulas).

Minimum realistic value: ‚â• 6 in (smaller vessels are not normally assessed with this method; reject below this).

Maximum practical value: ‚â§ 300 in (25 ft diameter; most pressure vessels fall within). Values above should trigger a warning.

Allowed decimals: Up to 2 decimal places (precision required for reporting).

Positive only: No negative or zero values allowed.

Logical check: D must be numeric and not exponential (e.g., disallow 1e6).

3. Output Validation Logic & Thresholds

Risk thresholds (based on L):

L ‚â• 30 in ‚Üí Low Risk: corrosion impact minimal (API 579 Part 5 logic; wide averaging length implies uniform corrosion).

15 ‚â§ L < 30 in ‚Üí Moderate Risk: acceptable but requires regular inspection.

L < 15 in ‚Üí High Risk: localized severe corrosion; frequent monitoring required.

‚ö†Ô∏è Compliance Note: These ranges must be documented in audit reports, aligning with OSHA/ISO‚Äôs requirement for risk-based inspection planning (RBI). {% endcomment %}