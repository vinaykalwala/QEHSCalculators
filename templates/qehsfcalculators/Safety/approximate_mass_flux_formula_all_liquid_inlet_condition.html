{% extends 'base.html' %}
{% block title %}Approximate Mass Flux Formula (All-Liquid Inlet Condition){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approximate Mass Flux Formula (All-Liquid Inlet Condition)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
    
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Approximate Mass Flux Formula (All-Liquid Inlet Condition)</h1>
            <p>Calculate the mass flux for systems with all-liquid inlet conditions</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="hfg">Latent Heat of Vaporization (h_fg)</label>
                    <input type="number" id="hfg" class="form-input" step="any" min="0.0001" placeholder="e.g., 2257">
                </div>
                <div class="form-group">
                    <label for="vfg">Specific Volume Difference (v_fg)</label>
                    <input type="number" id="vfg" class="form-input" step="any" min="0.0001" placeholder="e.g., 1.67185">
                </div>
                <div class="form-group">
                    <label for="cp">Specific Heat at Constant Pressure (C_p)</label>
                    <input type="number" id="cp" class="form-input" step="any" min="0.0001" placeholder="e.g., 4.18">
                </div>
                <div class="form-group">
                    <label for="temp">Temperature (T)</label>
                    <input type="number" id="temp" class="form-input" step="any" min="0.0001" placeholder="e.g., 373">
                </div>
                
                <button class="calculate-btn" onclick="calculateMassFlux()">Calculate Mass Flux</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                   <img src="https://cdn-icons-png.flaticon.com/512/1157/1157109.png" alt="Computer with calculator illustration">

                    <p>This tool will calculate the <strong>Mass Flux</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Mass Flux</h2>
                    </div>
                    <div class="rate-display">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Mass Flux (kg/m²s)</div></div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>High</span><span>Very High</span><span>Critical</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Mass Flux Calculator</strong> helps estimate mass flux in systems where liquid rapidly evaporates, 
                    such as fire suppression, boiler safety, and steam release scenarios. It helps in understanding energy transfer 
                    and phase change in high-temperature environments.
                </p>
            </div>
            
            <div class="note-card">
                <h3>❓ What is Mass Flux?</h3>
                <p>
                    Mass flux is the mass flow rate per unit area, representing how much mass passes through a given area per unit time.
                    It's a critical parameter in fluid dynamics and heat transfer calculations.
                </p>
            </div>

            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>h_fg (Latent Heat of Vaporization):</strong> The energy required to convert a unit mass of liquid into vapor.</li>
                    <li><strong>v_fg (Specific Volume Difference):</strong> The change in volume between the liquid and vapor phase.</li>
                    <li><strong>C_p (Specific Heat at Constant Pressure):</strong> The heat capacity of the fluid.</li>
                    <li><strong>T (Temperature):</strong> The absolute temperature of the fluid.</li>
                </ul>
            </div>
            
            
            <div class="note-card">
                <h3>📊 Interpretation</h3>
                <p>
                    <b>Mass Flux Values</b> indicate the intensity of phase change processes:
                </p>
                <ul class="note-list">
                    <li><span class="good">Below 100 kg/m²s</span> → Low intensity phase change</li>
                    <li><span class="average">100 – 500 kg/m²s</span> → Moderate phase change</li>
                    <li><span class="bad">Above 500 kg/m²s</span> → High intensity phase change</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>🔬 Real-Life Applications</h3>
                <ul class="note-list">
                    <li>Used in <strong>fire safety</strong> to estimate steam or vapor flow from heated liquids.</li>
                    <li>Critical for <strong>boiler safety</strong> and high-pressure steam calculations.</li>
                    <li>Applied in <strong>nuclear reactor cooling</strong> for heat transfer estimation.</li>
                    <li>Essential in <strong>chemical processing</strong> for evaporation and condensation systems.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>🔢 Constant Values</h3>
                <ul class="note-list">
                    <li><strong>0.9:</strong> Represents an empirical factor accounting for real-world inefficiencies.</li>
                    <li><strong>0.5:</strong> The exponent represents a square root relationship between temperature and mass flux.</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>✅ Validation Rules Applied</h3>
    <ul class="note-list">
        <li><b>h_fg (Latent Heat):</b> Must be 100 – 5000 kJ/kg.</li>
        <li><b>v_fg (Specific Volume):</b> Must be 0.001 – 50 m³/kg.</li>
        <li><b>C_p (Specific Heat):</b> Must be 0.5 – 10 kJ/kg·K.</li>
        <li><b>T (Temperature):</b> Must be 250 – 2000 K.</li>
        <li><b>No Zero/Negative Values:</b> All inputs must be positive.</li>
        <li><b>Cross-check:</b> h_fg should be > C_p × T.</li>
        <li><b>Units:</b> Ensure inputs are in SI units (kJ/kg, m³/kg, K).</li>
    </ul>
</div>

        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateMassFlux() {
    const hfg = parseFloat(document.getElementById('hfg').value.trim());
    const vfg = parseFloat(document.getElementById('vfg').value.trim());
    const cp  = parseFloat(document.getElementById('cp').value.trim());
    const temp = parseFloat(document.getElementById('temp').value.trim());

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // ✅ Validation rules (compliance-based)
    if (isNaN(hfg) || hfg <= 0) {
        errors.push("👉 Enter Latent Heat of Vaporization (h_fg) > 0 kJ/kg.");
    } else if (hfg < 100 || hfg > 5000) {
        errors.push("⚠️ h_fg value seems unrealistic (expected range: 100–3000 kJ/kg).");
    }

    if (isNaN(vfg) || vfg <= 0) {
        errors.push("👉 Enter Specific Volume Difference (v_fg) > 0 m³/kg.");
    } else if (vfg < 0.0001 || vfg > 100) {
        errors.push("⚠️ v_fg value seems unrealistic (expected range: 0.001–50 m³/kg).");
    }

    if (isNaN(cp) || cp <= 0) {
        errors.push("👉 Enter Specific Heat (C_p) > 0 kJ/kg·K.");
    } else if (cp < 0.1 || cp > 20) {
        errors.push("⚠️ C_p value seems unrealistic (expected range: 0.5–10 kJ/kg·K).");
    }

    if (isNaN(temp) || temp <= 0) {
        errors.push("👉 Enter Temperature (T) > 0 K.");
    } else if (temp < 200 || temp > 3000) {
        errors.push("⚠️ Temperature value seems unrealistic (expected range: 250–2000 K).");
    }

    // Cross-field check
    if (hfg && cp && temp && (hfg < cp * temp)) {
        errors.push("⚠️ h_fg is unusually low compared to Cp*T (phase change unlikely).");
    }

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ✅ Safe calculation
    const massFlux = 0.9 * (hfg / vfg) * Math.pow((1 / (cp * temp)), 0.5);

    // ✅ Output validation and display
    document.getElementById('rateValue').textContent = massFlux.toFixed(4);

    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (massFlux < 100) {
        meterWidth = '20%'; 
        meterColor = '#27ae60';
        feedback = '✅ Low mass flux. Mild phase change process.';
    } else if (massFlux < 500) {
        meterWidth = '40%'; 
        meterColor = '#2ecc71';
        feedback = '👍 Moderate. Typical for industrial evaporation.';
    } else if (massFlux < 1000) {
        meterWidth = '60%'; 
        meterColor = '#f39c12';
        feedback = '⚠️ High. Monitor system closely.';
    } else if (massFlux < 5000) {
        meterWidth = '80%'; 
        meterColor = '#e67e22';
        feedback = '🚨 Very high. Consider engineering controls.';
    } else {
        meterWidth = '95%'; 
        meterColor = '#e74c3c';
        feedback = '❌ Critical. Immediate safety action required.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}

{% comment %} 
1. Formula (for documentation & code comments)
/*
Mass Flux Formula (All-Liquid Inlet Condition):

   G = 0.9 * (h_fg / v_fg) * (1 / (C_p * T))^0.5

Where:
- h_fg = Latent Heat of Vaporization [kJ/kg]
- v_fg = Specific Volume Difference (vapor – liquid) [m³/kg]
- C_p  = Specific Heat at Constant Pressure [kJ/kg·K]
- T    = Absolute Temperature [K]

Units: Result G is in kg/m²·s

Reference: Commonly used in two-phase heat transfer, safety relief valve sizing,
and steam release calculations under NFPA/ASME methodologies.
*/

2. Input Validation Rules (Real-World QEHS / Fire Safety Standards)

h_fg (Latent Heat of Vaporization, kJ/kg)

Must be > 0.

Typical range for water-like fluids: 100 – 3000 kJ/kg.

Safety validation: values < 100 or > 5000 are likely incorrect input (unit mismatch or typo).

Allow up to 3 decimal places.

v_fg (Specific Volume Difference, m³/kg)

Must be > 0.

Typical engineering range: 0.001 – 50 m³/kg (depends on fluid).

If value < 0.0001 or > 100, reject as unrealistic.

Allow up to 6 decimals.

C_p (Specific Heat, kJ/kg·K)

Must be > 0.

Common fluids: 0.5 – 10 kJ/kg·K.

Reject if < 0.1 or > 20 (physically unrealistic).

Allow 3 decimals.

T (Temperature, K)

Must be > 0 K.

For practical use: 250 – 2000 K (approx. -23 °C to 1726 °C).

Reject < 200 K or > 3000 K (likely unit error or typo).

Integer values acceptable, allow 2 decimals.

3. Cross-Field & Logical Validations

Division by Zero: ensure (v_fg * C_p * T) ≠ 0.

Physical Consistency:

h_fg should always be > C_p*T (otherwise phase change is negligible → unrealistic).

If (h_fg / v_fg) < 1, warn user (low enthalpy/volume ratio unusual for real fluids).

Negative/NaN: Reject immediately.

4. Output Validation Logic

Mass Flux classification (aligned with fire safety / process safety significance):

Range (kg/m²·s)	Classification	Interpretation (for safety reports)
< 100	Low	Mild evaporation, low hazard
100 – 500	Moderate	Typical industrial boiling
500 – 1000	High	Requires monitoring (steam release, relief valves)
1000 – 5000	Very High	Serious safety consideration
> 5000	Critical	Imminent risk, engineering control required {% endcomment %}