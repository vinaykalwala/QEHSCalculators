{% extends 'base.html' %}
{% block title %}Remaining Corrosion Allowance Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 350px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        @media (max-width: 768px) {
    .result-placeholder img {
        max-width: 80%;    /* Slightly smaller on tablets */
    }
}

@media (max-width: 480px) {
    .result-placeholder img {
        max-width: 100%;   /* Full width on small screens */
        margin-bottom: 15px;
    }
}
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
   <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Remaining Corrosion Allowance Calculator</h1>
        <p>Calculate the remaining corrosion allowance to assess material degradation and ensure structural safety.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="actualThickness">Actual Thickness (inches)</label>
                <input type="number" id="actualThickness" class="form-input" min="0" placeholder="e.g., 0.75" step="any">
            </div>
            <div class="form-group">
                <label for="requiredThickness">Required Thickness (inches)</label>
                <input type="number" id="requiredThickness" class="form-input" min="0" placeholder="e.g., 0.50" step="any">
            </div>
            <button class="calculate-btn" onclick="calculateRemainingCorrosionAllowance()">Calculate Remaining Allowance</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/corrosion.webp' %}" alt="Corrosion illustration">
                <p>This tool will calculate the <strong>Remaining Corrosion Allowance</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Remaining Corrosion Allowance Result</h2>
                </div>
                <div class="rate-value" id="remainingAllowanceValue">0.0000</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">inches</div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
           <h3>📘 About This Calculator</h3>
<p>
    The <strong>Remaining Corrosion Allowance Calculator</strong> determines how much material thickness is left in a component before it reaches its minimum safe limit. 
    By calculating the difference between the <em>actual measured thickness</em> and the <em>required minimum thickness</em>, 
    this tool helps engineers and maintenance teams assess material degradation, predict equipment lifespan, ensure structural safety, 
    and plan timely maintenance or replacement to avoid failures.
</p>

        </div>

        <div class="note-card">
            <h3>⚙️ Parameters Used</h3>
            <ul class="note-list">
               <li><strong>Actual Thickness:</strong> The current measured thickness of the material, in inches.</li>
        <li><strong>Required Thickness:</strong> The minimum allowable thickness required for safe operation, in inches.</li>
        <li><strong>Remaining Corrosion Allowance:</strong> The difference between actual and required thickness, indicating the remaining material before reaching the critical limit.</li>
            </ul>
        </div>

       <div class="note-card">
    <h3>✅ Recommended Input Validation Rules</h3>
    <ul class="note-list">
        <li>
            <strong>Actual Thickness (AT):</strong> Required, numeric, greater than 0, and typically ≤50 inches (or the realistic maximum for the component).<br>
            <em>Rationale:</em> Ensures physical feasibility; prevents negative or unrealistic values; aligns with inspection and ultrasonic measurement standards.
        </li>
        <li>
            <strong>Required Thickness (RT):</strong> Required, numeric, greater than 0, typically ≤50 inches, and ideally ≤ Actual Thickness.<br>
            <em>Rationale:</em> Prevents illogical input (cannot require more than exists); ensures compliance with design and safety codes.
        </li>
        <li>
            <strong>Decimal Precision:</strong> Both AT and RT can have up to 4 decimal places.<br>
            <em>Rationale:</em> Provides measurement accuracy consistent with ultrasonic or caliper inspections.
        </li>
        <li>
            <strong>Unit Consistency:</strong> Both thickness values must be in the same unit (inches).<br>
            <em>Rationale:</em> Prevents miscalculations due to unit mismatch; critical for audit-compliant reporting.
        </li>

        <li>
            <strong>Cross-field / Relational Checks:</strong><br>
            AT &lt; RT → <strong>Critical Warning:</strong> Component below minimum safe thickness; immediate action required.<br>
            AT = RT → <strong>Caution Alert:</strong> No remaining corrosion allowance; monitor closely.<br>
            AT &gt;&gt; RT or AT ≈ RT → <strong>Warning:</strong> Indicates high corrosion risk or unrealistic input; verify measurements.<br>
            <em>Rationale:</em> Ensures logical consistency and flags high-risk conditions for safety compliance.
        </li>

        <li>
            <strong>Empty or Non-numeric Inputs:</strong> Must be blocked before calculation.<br>
            <em>Rationale:</em> Prevents calculation errors, ensures accurate reporting, and maintains compliance with audit and safety standards.
        </li>
    </ul>
</div>

<div class="note-card">
    <h3>📊 Output Validations</h3>
    <ul class="note-list">
        <li>
            <strong>Remaining Corrosion Allowance (RCA) &gt; 0 inches:</strong><br>
            ✅ <em>Safe Thickness:</em> Material has adequate corrosion allowance. Component is within safe operational limits.<br>
            <em>QEHS Rationale:</em> No immediate maintenance required; regular monitoring recommended.
        </li>
        <li>
            <strong>RCA = 0 inches:</strong><br>
            ⚠️ <em>Warning:</em> No remaining corrosion allowance. Component has reached its minimum safe thickness.<br>
            <em>QEHS Rationale:</em> Close monitoring needed. Schedule inspection or maintenance to prevent safety hazards.
        </li>
        <li>
            <strong>RCA &lt; 0 inches:</strong><br>
            ❌ <em>Critical Condition:</em> Material is below required thickness. Immediate action required!<br>
            <em>QEHS Rationale:</em> High risk of failure or leakage. Component must be repaired, reinforced, or replaced immediately to comply with safety and regulatory standards (OSHA, ISO 45001, NFPA).
        </li>
        <li>
            <strong>Unrealistic Outputs:</strong><br>
            ⚠️ RCA exceeding initial thickness or unusually high negative values.<br>
            <em>QEHS Rationale:</em> Likely input error; recheck Actual and Required Thickness values. Ensures audit-compliant reporting and prevents misinterpretation in safety reports.
        </li>
    </ul>
</div>

       
<div class="note-card">
    <h3>⚖️ Governing Principle</h3>
    <p>
        A remaining corrosion allowance calculator is not tied to one specific standard but uses principles and guidelines 
        from industry standards like <strong>API (American Petroleum Institute)</strong> standards, such as 
        <strong>API 510</strong> and <strong>API 579-1/ASME FFS-1</strong>, and the 
        <strong>ASME (American Society of Mechanical Engineers) Boiler and Pressure Vessel Code (BPVC)</strong>. 
        These standards provide the methodologies for calculating corrosion rates, determining remaining wall thickness, 
        and assessing the safe operating life of pressure vessels and piping systems.
    </p>

    <h5>Key Standards and Their Role</h5>
    <ul class="note-list">
        <li><strong>API Standards (e.g., API 510):</strong> These standards are crucial for pressure vessel inspection, repair, alteration, and rerating, and they provide guidelines for determining corrosion rates and remaining life based on thickness measurements over time.</li>
        <li><strong>ASME BPVC (Section VIII):</strong> This code addresses the design of pressure vessels and includes information on how to incorporate a corrosion allowance to account for material loss during the equipment's lifetime.</li>
        <li><strong>API 579-1/ASME FFS-1:</strong> This Fitness-For-Service (FFS) standard provides guidelines for assessing the integrity of corroded equipment, which includes considerations for remaining corrosion allowance.</li>
    </ul>

    <h5>How These Standards Are Applied</h5>
    <ul class="note-list">
        <li><strong>Measuring Corrosion:</strong> Inspections measure the actual wall thickness (<em>t<sub>actual</sub></em>) at different points and times to determine the extent of metal loss.</li>
        <li><strong>Calculating Corrosion Rate:</strong> Corrosion rates (both short-term and long-term) are calculated using thickness measurements taken over a period.</li>
        <li><strong>Determining Remaining Thickness:</strong> The calculated corrosion rate is used to predict future wall thickness.</li>
        <li><strong>Assessing Remaining Life:</strong> Based on the remaining thickness and the minimum required thickness (<em>t<sub>min</sub></em>), the remaining safe operating life is calculated using formulas outlined in these standards.</li>
    </ul>
</div>


        <div class="note-card">
            <h3>Conclusion</h3>
            <p>
                Maintaining a positive remaining corrosion allowance ensures structural integrity, prolongs service life, and prevents unexpected failures. 
                Regular inspection and monitoring are recommended for all critical components.
            </p>
        </div>
    </div>
</div>

<script>
function calculateRemainingCorrosionAllowance() {
    const actualThicknessInput = document.getElementById('actualThickness').value.trim();
    const requiredThicknessInput = document.getElementById('requiredThickness').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

  // --- Validation: Actual Thickness ---
if (actualThicknessInput === "") {
    errors.push("👉 Please enter Actual Thickness (0.01 – 50 inches).");
} else if (isNaN(actualThicknessInput)) {
    errors.push("👉 Actual Thickness must be numeric (0.01 – 50 inches).");
} else {
    const AT = parseFloat(actualThicknessInput);
    if (AT <= 0) errors.push("👉 Actual Thickness must be greater than 0 inches.");
    if (AT > 50) errors.push("⚠️ Actual Thickness unusually high. Typical maximum: 50 inches. Verify measurement.");
    if (!/^\d+(\.\d{1,4})?$/.test(actualThicknessInput)) errors.push("👉 Actual Thickness can have max 4 decimal places.");
}

// --- Validation: Required Thickness ---
if (requiredThicknessInput === "") {
    errors.push("👉 Please enter Required Thickness (0.01 – 50 inches).");
} else if (isNaN(requiredThicknessInput)) {
    errors.push("👉 Required Thickness must be numeric (0.01 – 50 inches).");
} else {
    const RT = parseFloat(requiredThicknessInput);
    if (RT <= 0) errors.push("👉 Required Thickness must be greater than 0 inches.");
    if (RT > 50) errors.push("⚠️ Required Thickness unusually high. Typical maximum: 50 inches. Verify input.");
    if (!/^\d+(\.\d{1,4})?$/.test(requiredThicknessInput)) errors.push("👉 Required Thickness can have max 4 decimal places.");
}

    // --- Cross-field validation ---
    if (errors.length === 0) {
        const AT = parseFloat(actualThicknessInput);
        const RT = parseFloat(requiredThicknessInput);
        if (AT < RT) errors.push("❌ Actual Thickness is less than Required Thickness! Component below minimum safety limit.");
    }

    // Display errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculation ---
    const actualThickness = parseFloat(actualThicknessInput);
    const requiredThickness = parseFloat(requiredThicknessInput);
    const remainingAllowance = actualThickness - requiredThickness;

    document.getElementById('remainingAllowanceValue').textContent = remainingAllowance.toFixed(4);

    // --- Feedback Interpretation ---
    let feedback = "";
    if (remainingAllowance > 0) {
        feedback = "✅ <strong>Safe Thickness:</strong>Material has adequate corrosion allowance. Component is within safe operational limits.";
    } else if (remainingAllowance === 0) {
        feedback = "⚠️ <strong>Warning:</strong>No remaining corrosion allowance. Component has reached its minimum safe thickness.";
    } else {
        feedback = "❌ <strong>Critical Condition:</strong> Material is below required thickness. Immediate action required!";
    }

    document.getElementById('feedbackContent').innerHTML = feedback;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Input Analysis & Real-World Perspective

Actual Thickness (AT): Measured thickness of a pipe, vessel, or structural member. Must be greater than 0. Measured via ultrasonic testing (UT), calipers, or micrometers.

Required Thickness (RT): Minimum safe thickness defined by design codes (ASME, API 579, NFPA, ISO standards). Must also be positive.

Remaining Corrosion Allowance (RCA): Calculated as AT - RT. A positive value indicates safe material, zero indicates critical limit reached, negative indicates failure risk.

QEHS Perspective:

Negative RCA values indicate immediate maintenance or shutdown.

Decimals matter because small variations (0.001–0.01 inches) can impact pressure vessel safety.

Cross-checking AT vs RT ensures regulatory compliance and audit readiness (OSHA, ISO 45001, API, NFPA).

2. Recommended Input Validation Rules
Input	Validation	Rationale (QEHS)
Actual Thickness	Required, numeric, >0, ≤ 50 in (or realistic max for component)	Ensure physical feasibility; prevent negative or extreme errors.
Required Thickness	Required, numeric, >0, ≤ 50 in, ≤ Actual Thickness (recommended)	Prevent illogical input (cannot require more than exists). Complies with design codes.
Decimal Precision	Max 4 decimals	Ensures measurement accuracy aligned with UT/inspection precision.
Unit Consistency	Inches	Must be same units for both inputs to prevent miscalculation.
Cross-field check	Actual < Required → Critical warning	Identifies components below minimum thickness immediately.
Extreme values	AT >> RT or AT ≈ RT → Warning	Avoids unrealistic inputs and highlights high corrosion risk.
Empty/Non-numeric	Block calculation	Prevents calculation errors in reporting or audits.
3. Output Validation Logic & Thresholds
Remaining Allowance (AT-RT)	Interpretation	Action/Feedback
>0	Safe	Continue operation; routine inspection
=0	Warning	Component at minimum limit; monitor closely
<0	Critical	Component below required limit; immediate maintenance or shutdown

QEHS Perspective:

These thresholds align with pressure vessel codes, pipeline safety regulations, and NFPA structural safety requirements.

Critical values trigger corrective actions documented in audits.

4. Edge Case Handling

Division by Zero: Not applicable here (simple subtraction), but guard against zero AT/RT.

Negative or zero inputs: Block calculation.

Excessively high values: Warn if thickness >50 in (unlikely in most structures).

Extreme cross-field mismatch: If AT < RT → Critical.

Decimal overflow: Limit to 4 decimals to prevent misreporting in audits. -->

<!-- 7. Why Each Validation is Essential (Compliance)

Numeric & Positive Values: Ensures actual physical measurements; avoids miscalculations in reports.

Maximum Thresholds: Prevents unrealistic inputs, protects audit credibility.

Decimal Precision: Matches inspection tool accuracy; compliant with ISO 45001/OSHA reporting.

Cross-field Checks (AT < RT): Identifies components below minimum thickness, critical for safety and NFPA compliance.

Edge Case Handling: Avoids runtime errors and prevents misleading KPI calculations in audits. -->