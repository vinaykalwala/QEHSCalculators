{% extends 'base.html' %}
{% block title %}Turnaround Time Formula (External Heating) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnaround Time Formula (External Heating) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 18px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        .sub-results {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }

        .sub-result-item {
            text-align: center;
        }
        
        .sub-result-value {
            font-size: 20px;
            font-weight: 600;
            color: #34495e;
        }

        .sub-result-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Turnaround Time Formula (External Heating) Calculator</h1>
            <p>Estimate the critical time available for intervention during vessel venting with external heating, a key factor in process safety management.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Process Parameters</h2>
                <div class="form-group">
                    <label for="tr">Emptying Time ($t_r$) [minutes]</label>
                    <input type="number" id="tr" class="form-input" placeholder="e.g., 60">
                </div>
                <div class="form-group">
                    <label for="V">Volume (V) [liters]</label>
                    <input type="number" id="V" class="form-input" placeholder="e.g., 1000">
                </div>
                <div class="form-group">
                    <label for="hfa">Latent Heat of Vaporization ($h_{fa}$) [kJ/kg]</label>
                    <input type="number" id="hfa" class="form-input" placeholder="e.g., 2260">
                </div>
                <div class="form-group">
                    <label for="QT">External Heat Input ($Q_T$) [kJ/min]</label>
                    <input type="number" id="QT" class="form-input" placeholder="e.g., 5000">
                </div>
                <div class="form-group">
                    <label for="vfa">Specific Volume ($v_{fa}$) [L/kg]</label>
                    <input type="number" id="vfa" class="form-input" placeholder="e.g., 1.04">
                </div>
                <button class="calculate-btn" onclick="calculateTurnaroundTime()">Calculate Time</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Process safety illustration">
                    <p>Enter your process data to determine the Turnaround Time (τ), a critical safety metric for emergency response.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" id="rateLabel">Turnaround Time (τ) [minutes]</div>
                    
                    <div class="sub-results">
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="emptyingTime">0 min</div>
                            <div class="sub-result-label">Emptying Time ($t_r$)</div>
                        </div>
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="heatingTime">0 min</div>
                            <div class="sub-result-label">Heating Time</div>
                        </div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Critical</span><span>Danger</span><span>Warning</span><span>Safe</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Response Time Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

       <div class="note-section">
    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator estimates the <strong>Turnaround Time (τ)</strong> during homogeneous-vessel venting
            with a constant external heat input. It determines the time available for operators to take action
            before a critical event, considering vaporization and external heating effects.
        </p>
        <p>
            It is fundamental in <strong>thermal hazard analysis</strong>,
            <strong>emergency relief system design</strong>, and <strong>process safety planning</strong>.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>τ (Turnaround Time):</strong> Time available before a critical event occurs.</li>
            <li><strong>t<sub>r</sub> (Emptying Time):</strong> Time to empty the vessel without external heating.</li>
            <li><strong>V (Volume):</strong> Vessel volume.</li>
            <li><strong>h<sub>fa</sub> (Latent Heat):</strong> Energy required to vaporize the liquid.</li>
            <li><strong>Q<sub>T</sub> (External Heat Input):</strong> Constant external heat rate.</li>
            <li><strong>v<sub>fa</sub> (Specific Volume):</strong> Specific volume of the liquid.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>📝 Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Emptying Time (t<sub>r</sub>):</strong> Must be a number &gt; 0.</li>
            <li><strong>Volume (V):</strong> Must be a number &gt; 0.</li>
            <li><strong>Latent Heat (h<sub>fa</sub>):</strong> Must be a number &gt; 0.</li>
            <li><strong>Heat Input (Q<sub>T</sub>):</strong> Must be a number &gt; 0.</li>
            <li><strong>Specific Volume (v<sub>fa</sub>):</strong> Must be a number &gt; 0.</li>
            <li><strong>Cross-Field Check:</strong> Denominator (Q<sub>T</sub>·v<sub>fa</sub>) must not be zero.</li>
        </ul>
        <h3>💡 Allowed Decimals</h3>
        <ul class="note-list">
            <li>All inputs can have up to 2 decimal places for practical accuracy.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li><strong>❌ Critical Condition (τ &lt; 0):</strong> Heating rate exceeds emptying rate. Immediate process review required.</li>
            <li><strong>⚠️ Danger (τ ≤ 5 min):</strong> Very short response time. Relies on automated systems and rapid operator action.</li>
            <li><strong>🟡 Warning (5–15 min):</strong> Limited time for intervention; requires high alert.</li>
            <li><strong>✅ Safe (τ &gt; 15 min):</strong> Sufficient time for operators to act safely.</li>
            <li><strong>❌ Invalid Number:</strong> Non-finite calculation result indicates invalid inputs.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            A "Turnaround Time Formula (External Heating) Calculator" is industry-specific and typically used in petrochemical or refinery contexts.
            It is based on principles outlined in <strong>API standards</strong> for vessel heating, maintenance, and process safety.
        </p>
        <ul class="note-list">
            <li><strong>Industry Context:</strong> "Turnaround" refers to scheduled downtime for maintenance, inspection, or repairs.</li>
            <li><strong>External Heating:</strong> Heating vessels from the outside to achieve target conditions safely.</li>
            <li><strong>Calculation Principles:</strong> Incorporates heat load formulas (Q = m·Cp·ΔT), heat transfer rates (Q = U·A·ΔT<sub>lm</sub>), and vessel-specific parameters.</li>
            <li><strong>No Single Standard:</strong> Methods follow API guidelines, but calculators are proprietary tools or spreadsheets used by companies.</li>
        </ul>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <p>
            This calculator helps operators and engineers assess the safe window of time for intervention during vessel venting under external heating.
            Accurate inputs are critical to ensure reliable results. The turnaround time (τ) is a <strong>key safety metric</strong>
            supporting emergency response, hazard mitigation, and compliant operational planning in high-risk industrial environments.
        </p>
    </div>
</div>

    </div>

   <script>
    document.addEventListener('DOMContentLoaded', function () {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
    });

    function calculateTurnaroundTime() {
        // --- INPUTS ---
        const inputs = {
            tr: { val: document.getElementById('tr').value.trim(), label: "Emptying Time (t_r)" },
            V: { val: document.getElementById('V').value.trim(), label: "Volume (V)" },
            hfa: { val: document.getElementById('hfa').value.trim(), label: "Latent Heat (h_fa)" },
            QT: { val: document.getElementById('QT').value.trim(), label: "Heat Input (Q_T)" },
            vfa: { val: document.getElementById('vfa').value.trim(), label: "Specific Volume (v_fa)" }
        };

        // --- DOM ELEMENTS ---
        const errorBox = document.getElementById('resultError');
        const errorMessage = document.getElementById('errorMessage');
        const placeholder = document.getElementById('placeholder');
        const resultValue = document.getElementById('resultValue');
        const feedbackContent = document.getElementById('feedbackContent');

        let errors = [];

        // --- INPUT VALIDATION ---
        function validateInput(key) {
            const raw = inputs[key].val;
            if (raw === '' || isNaN(raw) || parseFloat(raw) <= 0) {
                errors.push(`👉 ${inputs[key].label} must be a valid number > 0.`);
                return null;
            }
            return parseFloat(parseFloat(raw).toFixed(2)); // allow up to 2 decimals
        }

        const tr = validateInput("tr");
        const V = validateInput("V");
        const hfa = validateInput("hfa");
        const QT = validateInput("QT");
        const vfa = validateInput("vfa");

        // --- CROSS-FIELD CHECK ---
        if (QT * vfa === 0) {
            errors.push("❌ Denominator (Q_T · v_fa) must not be zero.");
        }

        if (errors.length > 0) {
            errorMessage.innerHTML = errors.join("<br>");
            errorBox.classList.remove("hidden");
            placeholder.classList.add("hidden");
            resultValue.classList.add("hidden");
            return;
        } else {
            errorBox.classList.add("hidden");
        }

        // --- CALCULATION ---
        const heatingTime = (V * hfa) / (QT * vfa);
        const turnaroundTime = tr - heatingTime;

        // --- OUTPUT VALIDATION ---
        if (!isFinite(turnaroundTime)) {
            errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your inputs.";
            errorBox.classList.remove("hidden");
            resultValue.classList.add("hidden");
            return;
        }

        // --- DISPLAY RESULTS ---
        document.getElementById('rateValue').textContent = turnaroundTime.toFixed(2);
        document.getElementById('emptyingTime').textContent = tr.toFixed(2) + ' min';
        document.getElementById('heatingTime').textContent = heatingTime.toFixed(2) + ' min';

        // --- RESPONSE TIME ASSESSMENT ---
        const meterFill = document.getElementById('meterFill');
        let meterWidth, meterColor, feedback;

        if (turnaroundTime < 0) {
            meterWidth = '15%';
            meterColor = '#e74c3c'; // Red
            feedback = '❌ <strong>Critical Condition.</strong> Heating rate exceeds emptying rate. Immediate process review required.';
        } else if (turnaroundTime <= 5) {
            meterWidth = '40%';
            meterColor = '#e67e22'; // Orange
            feedback = '⚠️ <strong>Danger.</strong> Very short response time (≤5 min). Rapid operator action or automated systems needed.';
        } else if (turnaroundTime <= 15) {
            meterWidth = '65%';
            meterColor = '#f1c40f'; // Yellow
            feedback = '🟡 <strong>Warning.</strong> Limited time (5–15 min). High alert required for manual intervention.';
        } else {
            meterWidth = '90%';
            meterColor = '#2ecc71'; // Green
            feedback = '✅ <strong>Safe.</strong> Sufficient time (>15 min) for operators to act safely.';
        }

        meterFill.style.width = meterWidth;
        meterFill.style.backgroundColor = meterColor;
        feedbackContent.innerHTML = feedback;

        placeholder.classList.add("hidden");
        resultValue.classList.remove("hidden");
    }

    // --- PRINT REPORT ---
    function printReport() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
        window.print();
    }
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (QEHS/Fire Safety Context)

Every parameter here is critical for safety analysis in process industries. Incorrect inputs can lead to false risk assessments during audits (OSHA, ISO 45001, NFPA, ILO).

🔹 Emptying Time ($t_r$) [minutes]

Range: 1 – 10,000 minutes (max ~7 days, beyond which emergency relevance is lost).

Decimals: Up to 2 decimal places allowed.

Validation: Must be > 0.

Rationale: Negative or zero emptying times violate physical law; excessively high times distort emergency preparedness.

🔹 Volume (V) [liters]

Range: 1 – 1,000,000 L (practical tank sizes in refineries, chemical plants, storage terminals).

Decimals: Up to 2 decimals.

Validation: Must be > 0.

Rationale: Negative or zero volumes are physically impossible; very high volumes should be flagged as outliers.

🔹 Latent Heat of Vaporization ($h_{fa}$) [kJ/kg]

Range: 100 – 25,000 kJ/kg (typical range for industrial fluids).

Decimals: Up to 2 decimals.

Validation: Must be > 0.

Rationale: Zero or negative values are thermodynamically invalid.

🔹 External Heat Input ($Q_T$) [kJ/min]

Range: 1 – 1,000,000 kJ/min.

Decimals: Up to 2 decimals.

Validation: Must be > 0.

Cross-check: Should not be disproportionately low compared to heat required to vaporize the volume.

Rationale: Prevents false “safe” outputs due to under-reporting of heat exposure.

🔹 Specific Volume ($v_{fa}$) [L/kg]

Range: 0.1 – 100 L/kg (common for liquids and vapors).

Decimals: Up to 3 decimals.

Validation: Must be > 0.

Rationale: Zero/negative values invalidate mass-to-volume conversion.

🔹 Cross-Field Dependencies

Denominator ($Q_T \cdot v_{fa}$) must ≠ 0 → avoids division by zero.

Heating time ≤ Emptying time → otherwise turnaround time ($\tau$) becomes negative → flagged as unsafe.

Tau should not exceed 10,000 minutes → unrealistic for emergency scenarios.

2. Output Validation & Thresholds

Output: Turnaround Time (τ) [minutes]

Industry emergency response (fire, explosion, toxic release scenarios) uses time windows for compliance:

τ ≤ 5 minutes → 🔴 Critical: Immediate catastrophic failure risk.

5 < τ ≤ 15 minutes → 🟠 Danger: Very high risk, only automated systems effective.

15 < τ ≤ 60 minutes → 🟡 Warning: Limited time for evacuation, requires robust ERT (Emergency Response Team).

τ > 60 minutes → 🟢 Safe: Adequate time for controlled intervention.
-->