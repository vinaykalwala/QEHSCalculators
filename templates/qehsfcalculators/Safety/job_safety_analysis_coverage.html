{% extends 'base.html' %}
{% block title %}Job Safety Analysis Coverage Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Safety Analysis Coverage Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
    flex: 1;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    padding: 30px;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
    border: 2px solid #1560bd;
    min-height: 420px;
    max-height: 420px;
    overflow-y: auto;
    justify-content: flex-start;
    align-items: center;
    text-align: center;
}

.calc-card {
    flex: 1;
    background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
    color: #fff;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
    height: 420px;
    overflow-y: auto;
}
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Job Safety Analysis Coverage Calculator</h1>
            <p>Calculate the percentage of tasks covered by Job Safety Analyses</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="jobSafetyAnalyses">Total Job Safety Analyses Conducted</label>
                    <input type="number" id="jobSafetyAnalyses" class="form-input" min="0" placeholder="e.g., 50">
                </div>
                <div class="form-group">
                    <label for="totalTasks">Total Tasks or Jobs Performed</label>
                    <input type="number" id="totalTasks" class="form-input" min="1" placeholder="e.g., 100">
                </div>
                
                <button class="calculate-btn" onclick="calculateCoverage()">Calculate Coverage</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Job Safety Analysis Coverage</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Job Safety Analysis Coverage</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00%</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Percentage of tasks covered by JSAs</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>Good</span><span>Excellent</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Coverage Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
<div class="note-section">

  <!-- 📘 About This Calculator -->
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      The <strong>Mean Steam Consumption (Flow-Type Application) Calculator</strong> estimates the average steam demand for continuous flow-type heat exchange applications. It helps engineers and plant operators evaluate thermal load requirements and optimize steam system efficiency.
    </p>
  </div>

  <!-- ⚙ Parameters Used -->
  <div class="note-card">
    <h3>⚙️ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Steam Pressure:</strong> The pressure at which steam is supplied to the application.</li>
      <li><strong>Condensate Temperature:</strong> The outlet temperature of the condensate after heat transfer.</li>
      <li><strong>Heat Load:</strong> The total heat energy required by the process or equipment.</li>
      <li><strong>Latent Heat of Steam:</strong> The amount of energy released when steam condenses at given pressure.</li>
    </ul>
  </div>

  <!-- ✅ Input Validation Rules -->
  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>Steam Pressure:</b> Must be a positive number (bar or MPa), not exceeding system design limits.</li>
      <li><b>Condensate Temperature:</b> Must be below the saturation temperature of steam at given pressure.</li>
      <li><b>Heat Load:</b> Positive numerical value, typically within 0–10,000 kW or equivalent units.</li>
      <li><b>Latent Heat:</b> Auto-validated based on steam tables; no manual input required.</li>
      <li><b>Cross-Check:</b> Input values must be physically realistic (no negative, zero, or undefined parameters).</li>
    </ul>
  </div>

  <!-- 🧾 Output Validations -->
  <div class="note-card">
    <h3>🧾 Output Validations</h3>
    <ul class="note-list">
      <li>Calculated mean steam consumption is automatically validated for unit consistency.</li>
      <li>Outputs are rounded to appropriate engineering precision (2–3 significant digits).</li>
      <li>Results include automatic feedback messages based on consumption range, such as:
        <br><b>"Assessment:</b> Steam consumption is within expected operational range for flow-type applications."</li>
      <li>If the result indicates unusually high or low consumption, a warning message is displayed to prompt further review.</li>
    </ul>
  </div>

  <!-- ⚖ Governing Principle -->
<div class="note-card">
  <h3>⚖ Governing Principle</h3>
  <p>
    A <strong>“Job Safety Analysis (JSA) Coverage Calculator”</strong> is not defined by any specific national or international standard. 
    Instead, Job Safety Analysis (JSA) is a risk assessment methodology referenced by multiple occupational health and safety standards, which employers are required to implement. 
    Therefore, a calculator’s coverage would be based on general principles derived from these standards.
  </p>

  <p><strong>Key standards and guidelines that inform JSA methodology:</strong></p>
  <ul class="note-list">
    <li>
      <strong>OSHA (Occupational Safety and Health Administration):</strong> In the U.S., while there is no specific JSA standard, OSHA requires hazard assessments that JSAs help fulfill. 
      For example, OSHA standard 1910.132 for Personal Protective Equipment (PPE) mandates employers to perform hazard assessments to determine appropriate PPE.
    </li>
    <li>
      <strong>ISO 45001:</strong> This international Occupational Health and Safety Management System standard requires organizations to have a structured process for identifying hazards and assessing risks, which a JSA fulfills.
    </li>
    <li>
      <strong>ANSI / ASSP:</strong> ANSI/ASSP standards, such as ANSI/ASSP A10.28-2018 for work platforms, may mandate a JSA by a qualified person for specific high-risk tasks.
    </li>
    <li>
      <strong>CCOHS (Canadian Centre for Occupational Health and Safety):</strong> Provides detailed guidance and methodologies for conducting a JSA, also known as a Job Hazard Analysis (JHA).
    </li>
  </ul>

  <p><strong>How a "JSA Coverage Calculator" is used:</strong></p>
  <p>
    Since there is no universal standard for a JSA Coverage Calculator, such a tool likely measures an organization's performance and coverage based on internal metrics and general regulatory requirements. 
    This may include tracking metrics informed by JSAs, such as:
  </p>

  <ul class="note-list">
    <li><strong>Recordable Injury Frequency Rate (TRIFR):</strong> Number of recordable injuries relative to total hours worked.</li>
    <li><strong>Severity Rate:</strong> Number of lost or restricted workdays compared to recordable incidents.</li>
    <li><strong>Completion Rate:</strong> Percentage of high-risk tasks with a completed and up-to-date JSA.</li>
    <li><strong>Review Timeliness:</strong> Ensuring JSAs are periodically reviewed and updated, especially after incidents or procedural changes.</li>
  </ul>

  <p>
    In essence, a JSA Coverage Calculator is a company-specific tool that evaluates safety performance and the effectiveness of hazard assessments in alignment with established occupational health and safety principles.
  </p>
</div>


  <!-- 🏁 Conclusion -->
  <div class="note-card">
    <h3>🏁 Conclusion</h3>
    <p>
      This calculator provides an engineering-based estimation of mean steam consumption for continuous flow-type systems. It is best used for design optimization, energy audits, and performance monitoring. For high-accuracy measurements, direct steam flowmeter readings are recommended.
    </p>
  </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
        
        function calculateCoverage() {
    const jobSafetyAnalyses = document.getElementById('jobSafetyAnalyses').value.trim();
    const totalTasks = document.getElementById('totalTasks').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Validation: Job Safety Analyses ---
    if (jobSafetyAnalyses === "" || isNaN(jobSafetyAnalyses)) {
        errors.push("👉 Please enter the number of Job Safety Analyses conducted.");
    } else if (!Number.isInteger(Number(jobSafetyAnalyses))) {
        errors.push("👉 Job Safety Analyses must be a whole number (no decimals).");
    } else if (parseInt(jobSafetyAnalyses) < 0) {
        errors.push("👉 Job Safety Analyses cannot be negative.");
    } else if (parseInt(jobSafetyAnalyses) > 10000) {
        errors.push("👉 Job Safety Analyses cannot exceed 10,000 (unrealistic).");
    }

    // --- Validation: Total Tasks ---
    if (totalTasks === "" || isNaN(totalTasks)) {
        errors.push("👉 Please enter the total number of tasks performed.");
    } else if (!Number.isInteger(Number(totalTasks))) {
        errors.push("👉 Total Tasks must be a whole number (no decimals).");
    } else if (parseInt(totalTasks) <= 0) {
        errors.push("👉 Total Tasks must be greater than 0.");
    } else if (parseInt(totalTasks) > 10000) {
        errors.push("👉 Total Tasks cannot exceed 10,000 (unrealistic).");
    }

    // --- Cross-field validation ---
    if (jobSafetyAnalyses !== "" && totalTasks !== "" &&
        parseInt(jobSafetyAnalyses) > parseInt(totalTasks)) {
        errors.push("👉 Job Safety Analyses cannot exceed Total Tasks.");
    }

    // --- Error Handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Safe Calculation ---
    const numJSAs = parseInt(jobSafetyAnalyses);
    const numTasks = parseInt(totalTasks);
    const coverage = (numJSAs / numTasks) * 100;

    // --- Output Formatting ---
    document.getElementById('rateValue').textContent = coverage.toFixed(2) + '%';

    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    // --- Output thresholds ---
    if (coverage >= 75) {
        meterWidth = '95%'; 
        meterColor = '#27ae60';
        feedback = '🌟 Excellent! Your JSA coverage is comprehensive, indicating a strong safety culture.';
    } else if (coverage >= 50) {
        meterWidth = '70%'; 
        meterColor = '#2ecc71';
        feedback = '✅ Good coverage. You are performing safety analyses on a significant portion of tasks.';
    } else if (coverage >= 25) {
        meterWidth = '45%'; 
        meterColor = '#f1c40f';
        feedback = '🔵 Moderate coverage. Consider expanding JSA to more tasks for better risk management.';
    } else {
        meterWidth = '20%'; 
        meterColor = '#e74c3c';
        feedback = '⚠️ Needs improvement. Prioritize conducting JSAs on high-risk tasks to enhance safety.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;

    feedback += `<br><br>You have conducted ${numJSAs} Job Safety Analyses out of ${numTasks} total tasks.`;
    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Detailed Input Validation Rules (QEHS/Fire Safety Practice)

Inputs:

🔹 Total Job Safety Analyses Conducted (jobSafetyAnalyses)

Type: Integer, no decimals (counts).

Min: 0 (valid, since sometimes no JSAs are done yet).

Max: 10,000 (reasonable upper bound for reporting periods; prevents unrealistic entries).

Cannot exceed Total Tasks (logical cross-check).

🔹 Total Tasks or Jobs Performed (totalTasks)

Type: Integer, no decimals.

Min: 1 (at least one task must exist, otherwise denominator → division by zero).

Max: 10,000 (realistic bound for reporting).

2. Output Validation & Thresholds

Formula:

Coverage (%)
=
(
Job Safety Analyses
Total Tasks
)
×
100
Coverage (%)=(
Total Tasks
Job Safety Analyses
	​

)×100

Thresholds for interpretation (aligned with OSHA best practice & internal audit scoring):

<25% → ⚠️ Needs Improvement (major gaps, regulatory risk).

25–49% → 🔵 Moderate (coverage exists but inadequate for high-risk industries).

50–74% → ✅ Good (meets many audit expectations, but may still lack high-risk task focus).

≥75% → 🌟 Excellent (best practice level, shows safety program maturity).

3. Corrected JavaScript Code (with Compliance-Oriented Validations)

/**

Formula: Coverage (%) = (Job Safety Analyses ÷ Total Tasks) × 100

Validation Rules:

Job Safety Analyses: integer, 0–10,000

Total Tasks: integer, 1–10,000

Cross-check: JSAs ≤ Total Tasks

Units: counts only (no decimals)

Edge Cases: prevent divide by zero, prevent unrealistic outliers
*/ {% endcomment %}