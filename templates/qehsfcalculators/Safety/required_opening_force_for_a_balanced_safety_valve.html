{% extends 'base.html' %}
{% block title %}Required Opening Force For A Balanced Safety Valve  Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Required Opening Force For A Balanced Safety Valve  Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
  <div class="calculator-container printable" id="printArea">
    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Required Opening Force for a Balanced Safety Valve Calculator</h1>
        <p>Calculate the required spring force (N) for a safety valve based on fluid pressure and nozzle area</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="pressure">Fluid Inlet Pressure (P<sub>v</sub>) [Pa]</label>
                <input type="number" id="pressure" class="form-input" min="0" placeholder="e.g., 500000">
            </div>
            <div class="form-group">
                <label for="area">Nozzle Area (A<sub>N</sub>) [m¬≤]</label>
                <input type="number" id="area" class="form-input" min="0" placeholder="e.g., 0.002">
            </div>

            <button class="calculate-btn" onclick="calculateForce()">Calculate Force</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Valve illustration">
                <p>This tool will calculate the <strong>Required Opening Force</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">‚ùå</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Spring Force Result</h2>
                </div>
                <div class="rate-value" id="forceValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Newtons (N)</div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
       <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
        The <strong>Required Opening Force Calculator</strong> is used to determine the 
        <strong>spring force (F<sub>s</sub>)</strong> necessary to open a balanced safety valve. 
        This calculation ensures the valve only opens when the <strong>inlet fluid pressure</strong> 
        acting on the <strong>nozzle area</strong> exceeds the designed spring force. 
        By balancing these forces, engineers can guarantee the valve responds correctly 
        under pressure surges, preventing equipment rupture, explosions, or unsafe 
        operating conditions. 
    </p>
    <p>
        In safety-critical systems such as boilers, chemical plants, and pipelines, 
        calculating this force helps engineers design valves that activate reliably 
        during overpressure events while staying sealed during normal operations. 
        A well-calibrated spring force protects both <strong>equipment integrity</strong> 
        and <strong>personnel safety</strong>.
    </p>
</div>

<div class="note-card">
    <h3>‚öôÔ∏è Parameters Used</h3>
    <ul class="note-list">
        <li><strong>P<sub>v</sub> (Fluid Inlet Pressure):</strong> 
            Measured in Pascals (Pa), this represents the pressure of the fluid entering the valve. 
            It acts as the driving force pushing against the spring-loaded mechanism.</li>
        <li><strong>A<sub>N</sub> (Nozzle Area):</strong> 
            Measured in square meters (m¬≤), this is the cross-sectional area of the valve nozzle 
            exposed to the fluid. Larger areas amplify the total applied force.</li>
        <li><strong>F<sub>s</sub> (Spring Force):</strong> 
            Measured in Newtons (N), this is the force exerted by the valve spring 
            to keep the valve closed until the pressure exceeds the safety threshold. 
            It is the required output of this calculation.</li>
    </ul>
</div>

        

       <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Fluid Inlet Pressure (P·µ•, Pa):</strong>
            <ul>
                <li>Must be &gt; 0 ‚Üí Pressure cannot be zero or negative; invalid for a pressurized system.</li>
                <li>Typical industrial range: 1,000 ‚Äì 50,000,000 Pa (‚âà0.01 ‚Äì 500 bar).</li>
                <li>Warning threshold: &gt; 10,000,000 Pa (100 bar) ‚Äî uncommon, but possible in specialized systems. Should prompt user to double-check.</li>
                <li>Absolute max: 50,000,000 Pa (500 bar) ‚Äî above this, reject as unrealistic or dangerous.</li>
                <li>Decimal precision: max 2 decimals (Pa values usually reported in integers; decimals acceptable for converted bar/MPa).</li>
            </ul>
        </li>
        <li><strong>Nozzle Area (A‚Çô, m¬≤):</strong>
            <ul>
                <li>Must be &gt; 0 ‚Üí Physical area can‚Äôt be zero or negative.</li>
                <li>Typical range: 0.0001 ‚Äì 0.1 m¬≤ (1 cm¬≤ to 1000 cm¬≤).</li>
                <li>Warning threshold: &gt; 0.05 m¬≤ ‚Äî rare for safety valves; flag for review.</li>
                <li>Absolute max: 0.5 m¬≤ ‚Äî reject as unrealistic.</li>
                <li>Decimal precision: max 4 decimals ‚Äî ensures engineering accuracy.</li>
            </ul>
        </li>
        <li><strong>Cross-field / logical checks:</strong>
            <ul>
                <li>If pressure √ó area ‚Üí force &gt; 10,000 N, classify as critical and warn that spring & assembly must be validated.</li>
                <li>If force &lt; 50 N, warn about possible input/data entry errors (too small for real-world spring-actuated valves).</li>
            </ul>
        </li>
    </ul>
</div>

<div class="note-card">
    <h3>üìä Output Validation Logic & Thresholds</h3>
    <ul class="note-list">
        <li><strong>&lt; 50 N (Very Low Force):</strong> Likely input error, miscalibration, or unrealistic valve size. <br>Safety risk: valve may not seal or may ‚Äúchatter‚Äù under normal ops.</li>
        <li><strong>50 ‚Äì 5,000 N (Normal Range):</strong> Typical for industrial safety valves (boilers, chemical processes, oil & gas). Indicates correct design and safe operation.</li>
        <li><strong>5,000 ‚Äì 10,000 N (High Range):</strong> Still possible but requires stronger springs & robust valve housings. Should trigger design check and maintenance alert.</li>
        <li><strong>&gt; 10,000 N (Critical):</strong> Likely unrealistic or unsafe. Must be reviewed by engineering/safety audit. Could indicate excessive design pressure or oversized valve.</li>
    </ul>
</div>
<div class="note-card">
    <h3>üìè Standards & Compliance</h3>
    <p>
        This calculation aligns with global safety and engineering standards such as 
        <strong>OSHA</strong>, <strong>ISO 45001</strong>, <strong>NFPA</strong>, and 
        <strong>ILO guidelines</strong>. Following these standards ensures that safety 
        valves operate reliably, preventing overpressure incidents and protecting 
        workers, equipment, and facilities.
    </p>
</div>

       <div class="note-card">
    <h3>Conclusion</h3>
    <p>
        This calculator ensures the spring force of a safety valve is correctly set, 
        so it stays sealed under normal conditions and opens only during overpressure. 
        Accurate force calculation protects both equipment and personnel.
    </p>
</div>

    </div>
</div>

<script>
 function calculateForce() {
    const pressureInput = document.getElementById('pressure').value.trim();
    const areaInput = document.getElementById('area').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // --- Validation: Fluid Inlet Pressure (P·µ•, Pa) ---
    if (pressureInput === "") {
        errors.push("üëâ Fluid Inlet Pressure (P·µ•) is required.");
    } else if (isNaN(pressureInput)) {
        errors.push("üëâ Fluid Inlet Pressure (P·µ•) must be a number (Pa).");
    } else {
        const P = parseFloat(pressureInput);
        if (P <= 0) errors.push("üëâ Fluid Inlet Pressure (P·µ•) must be greater than zero (Pa).");
        if (P < 1000) errors.push("‚ö†Ô∏è Fluid Inlet Pressure (P·µ•) below 1,000 Pa is unusually low for a safety valve.");
        if (P > 1e7 && P <= 5e7) errors.push("‚ö†Ô∏è Fluid Inlet Pressure (P·µ•) above 10,000,000 Pa (100 bar) is unusually high. Verify inputs.");
        if (P > 5e7) errors.push("‚ùå Fluid Inlet Pressure (P·µ•) exceeds maximum realistic limit (>50,000,000 Pa / 500 bar).");
        if (!/^\d+(\.\d{1,2})?$/.test(pressureInput)) {
            errors.push("üëâ Fluid Inlet Pressure (P·µ•) can have maximum 2 decimal places.");
        }
    }

    // --- Validation: Nozzle Area (A‚Çô, m¬≤) ---
    if (areaInput === "") {
        errors.push("üëâ Nozzle Area (A‚Çô) is required.");
    } else if (isNaN(areaInput)) {
        errors.push("üëâ Nozzle Area (A‚Çô) must be a number (m¬≤).");
    } else {
        const A = parseFloat(areaInput);
        if (A <= 0) errors.push("üëâ Nozzle Area (A‚Çô) must be greater than zero (m¬≤).");
        if (A < 0.0001) errors.push("‚ö†Ô∏è Nozzle Area (A‚Çô) below 0.0001 m¬≤ is too small for practical safety valves.");
        if (A > 0.05 && A <= 0.5) errors.push("‚ö†Ô∏è Nozzle Area (A‚Çô) above 0.05 m¬≤ is unusually large. Verify design and application.");
        if (A > 0.5) errors.push("‚ùå Nozzle Area (A‚Çô) exceeds maximum realistic limit (>0.5 m¬≤).");
        if (!/^\d+(\.\d{1,4})?$/.test(areaInput)) {
            errors.push("üëâ Nozzle Area (A‚Çô) can have maximum 4 decimal places for engineering accuracy.");
        }
    }

    // --- Display errors if any ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculation ---
    const P = parseFloat(pressureInput);
    const A = parseFloat(areaInput);
    const F = P * A;

    document.getElementById('forceValue').textContent = F.toFixed(2);

    // --- Feedback Interpretation ---
    let feedback = "";
    if (F < 50) {
        feedback = "‚ö†Ô∏è <strong>Very Low Force:</strong> Likely input error, miscalibration, or unrealistic valve size. <br> Safety risk: valve may not seal or may chatter under normal operation.";
    } else if (F >= 50 && F <= 5000) {
        feedback = "‚úÖ <strong>Normal Range:</strong> Typical for industrial safety valves (boilers, chemical processes, oil & gas). Indicates correct design and safe operation.";
    } else if (F > 5000 && F <= 10000) {
        feedback = "üö® <strong>High Force:</strong> Requires stronger springs and robust valve housings. Trigger design verification and maintenance review.";
    } else {
        feedback = "‚ùå <strong>Critical Force:</strong> Likely unrealistic or unsafe. Immediate engineering/safety audit required. Could indicate excessive design pressure or oversized valve.";
    }

    document.getElementById('feedbackContent').innerHTML = feedback;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 1Ô∏è‚É£ Input Validation Rules (Real-World QEHS / Fire Safety Context)

Fluid Inlet Pressure (P·µ•, Pa):

Must be > 0 ‚Üí Pressure cannot be zero or negative; invalid for a pressurized system.

Typical industrial range: 1,000 ‚Äì 50,000,000 Pa (‚âà0.01 ‚Äì 500 bar).

Warning threshold: > 10,000,000 Pa (100 bar) ‚Äî uncommon, but possible in specialized systems. Should prompt user to double-check.

Absolute max: 50,000,000 Pa (500 bar) ‚Äî above this, reject as unrealistic or dangerous.

Decimal precision: max 2 decimals (Pa values usually reported in integers; decimals acceptable for converted bar/MPa).

Nozzle Area (A‚Çô, m¬≤):

Must be > 0 ‚Üí Physical area can‚Äôt be zero or negative.

Typical range: 0.0001 ‚Äì 0.1 m¬≤ (1 cm¬≤ to 1000 cm¬≤).

Warning threshold: > 0.05 m¬≤ ‚Äî rare for safety valves; flag for review.

Absolute max: 0.5 m¬≤ ‚Äî reject as unrealistic.

Decimal precision: max 4 decimals ‚Äî ensures engineering accuracy.

Cross-field / logical checks:

If pressure √ó area ‚Üí force > 10,000 N, classify as critical and warn that spring & assembly must be validated.

If force < 50 N, warn about possible input/data entry errors (too small for real-world spring-actuated valves).

2Ô∏è‚É£ Output Validation Logic & Thresholds

These thresholds tie into safety assessments:

< 50 N (Very Low Force):

Likely input error, miscalibration, or unrealistic valve size.

Safety risk: valve may not seal or may ‚Äúchatter‚Äù under normal ops.

50 ‚Äì 5,000 N (Normal Range):

Typical for industrial safety valves (boilers, chemical processes, oil & gas).

Indicates correct design and safe operation.

5,000 ‚Äì 10,000 N (High Range):

Still possible but requires stronger springs & robust valve housings.

Should trigger design check and maintenance alert.

> 10,000 N (Critical):

Likely unrealistic or unsafe.

Must be reviewed by engineering/safety audit. Could indicate excessive design pressure or oversized valve.

4Ô∏è‚É£ Edge Cases & Handling

Empty fields ‚Üí Block with error.

Negative values ‚Üí Block, since pressure/area can‚Äôt be negative.

Zero values ‚Üí Block, not physically valid.

Tiny inputs (e.g., P < 1000 Pa, A < 0.0001 m¬≤) ‚Üí Warn, may represent data entry mistake.

Huge inputs (P > 50 MPa, A > 0.5 m¬≤) ‚Üí Block as unrealistic.

Extreme but possible values (P = 30 MPa, A = 0.05 m¬≤) ‚Üí Allow but warn user.

Decimals beyond allowed precision ‚Üí Reject, ask user to limit decimals.

Overflow force (F > 10,000 N) ‚Üí Warn or mark as critical.

5Ô∏è‚É£ Why These Validations Are Essential (Compliance Perspective)

OSHA / ISO 45001 / NFPA Compliance: Ensures that only realistic, engineering-valid values are used in safety-critical calculations. Prevents misreporting or unsafe design assumptions.

ILO Standards: Protects worker safety by preventing underestimation of opening force (which could cause premature venting or valve failure).

Fire Safety & QEHS Best Practice: High pressures and large nozzle areas directly correlate with explosion risks. Validation prevents accidental acceptance of unsafe conditions.

Audit Readiness: Clear validation messages and logical limits ensure traceable, defensible calculations in safety reports. -->