{% extends 'base.html' %}
{% block title %}Vent Area Reduction Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vent Area Reduction Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            min-height: 420px; /* Match calc-card */
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Vent Area Reduction Formula Calculator</h1>
            <p>Calculate the required vent area for an enclosed space based on heat release and system properties.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>System Parameters</h2>
                <div class="form-group">
                    <label for="initialMass">Initial Mass (m‚ÇÄ) in kg</label>
                    <input type="number" id="initialMass" class="form-input" placeholder="Enter initial mass">
                </div>
                <div class="form-group">
                    <label for="heatRelease">Heat Release Rate (q) in J/kg</label>
                    <input type="number" id="heatRelease" class="form-input" placeholder="Enter heat release rate">
                </div>
                <div class="form-group">
                    <label for="massFlux">Mass Flux (G) in kg/m¬≤s</label>
                    <input type="number" id="massFlux" class="form-input" placeholder="Enter mass flux">
                </div>
                <div class="form-group">
                    <label for="specificHeat">Specific Heat (C·µ•) in J/kg¬∑K</label>
                    <input type="number" id="specificHeat" class="form-input" placeholder="Enter specific heat">
                </div>
                <div class="form-group">
                    <label for="tempRise">Temperature Rise (ŒîT) in K</label>
                    <input type="number" id="tempRise" class="form-input" placeholder="Enter temperature rise">
                </div>
                <div class="form-group">
                    <label for="emptyingTime">Emptying Time (Œît‚Çö) in s</label>
                    <input type="number" id="emptyingTime" class="form-input" placeholder="Enter emptying time">
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate Vent Area</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>Enter the system parameters to calculate the required vent area for pressure relief.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Calculated Vent Area (A)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.000</div>
                        <div class="rate-label">m¬≤</div>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                       <div class="btn-wrapper">
                            <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                        </div>
                </div>
            </div>
        </div>

        <div class="note-section">
        
            <!-- üìò ABOUT THIS CALCULATOR -->
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Reduced Vent Area Calculator</strong> determines the minimum vent opening required to safely
                    relieve pressure
                    during an explosion or deflagration inside a vessel, silo, or enclosed space. It ensures that internal
                    pressures remain
                    below structural limits, preventing catastrophic failures.
                </p>
                <p>
                    This tool is based on internationally recognized standards for explosion protection and is applicable to
                    both
                    dust and gas deflagration systems. Proper vent sizing enhances process safety, equipment protection, and
                    compliance with NFPA and EN explosion venting standards.
                </p>
            </div>
        
            <!-- ‚öô PARAMETERS USED -->
            <div class="note-card">
                <h3>‚öô Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Initial Mass (m‚ÇÄ):</strong> Mass of material within the enclosure before deflagration (kg).</li>
                    <li><strong>Heat Release Rate (q):</strong> Energy released per unit mass of material during combustion
                        (kJ/kg).</li>
                    <li><strong>Mass Flux (G):</strong> Rate of mass flow through the vent per unit area (kg/m¬≤¬∑s).</li>
                    <li><strong>Specific Heat (C·µ•):</strong> Energy required to raise unit mass by 1¬∞C at constant volume
                        (kJ/kg¬∑K).</li>
                    <li><strong>Temperature Rise (ŒîT):</strong> Maximum allowable temperature increase inside the system (¬∞C).
                    </li>
                    <li><strong>Emptying Time (Œît‚Çö):</strong> Duration within which safe depressurization must occur (s).</li>
                </ul>
            </div>
        
            <!-- ‚úÖ INPUT VALIDATION RULES -->
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Positive Numerical Inputs Only:</strong> All parameters must be greater than zero.</li>
                    <li><strong>All Fields Mandatory:</strong> Missing data will prevent calculation, as all terms are required
                        for vent area estimation.</li>
                    <li><strong>No Negative or Non-Numeric Values:</strong> Such inputs trigger an error message prompting
                        correction.</li>
                </ul>
                <p><em>Validation ensures physically meaningful results and reliable application of NFPA/EN methodologies.</em>
                </p>
            </div>
        
            <!-- üìä OUTPUT VALIDATIONS -->
            <div class="note-card">
                <h3>üìä Output Validations</h3>
                <p>
                    The calculator provides two vent areas:
                    <strong>A‚ÇÅ</strong> (thermodynamic basis) and <strong>A‚ÇÇ</strong> (emptying-time basis). The feedback message displays both values to guide safe vent sizing.
                </p>
                <ul class="note-list">
                    <li><strong>üî¥ A < 0.0001 m¬≤ ‚Üí Warning:</strong> Vent area is too small ‚Äî indicates restricted discharge or incorrect data entry.</li>
                    <li><strong>üü¢ 0.0001 m¬≤ ‚â§ A ‚â§ 0.5 m¬≤ ‚Üí Safe Range:</strong> Vent area within practical design limits for explosion venting systems.</li>
                    <li><strong>üü° A > 0.5 m¬≤ ‚Üí Critical:</strong> Vent area excessively large ‚Äî verify vessel volume, pressure, or mass flux inputs.</li>
                </ul>
                <p>
                    <em>Displayed feedback message:</em> 
                    ‚ÄúThe alternative calculation based on emptying time gives a required area of <strong>[A‚ÇÇ] m¬≤</strong>. Use the appropriate formula based on your available data.‚Äù
                </p>
            </div>
        
            <!-- üìê GOVERNING PRINCIPLE -->
            <div class="note-card">
                <h3>üìê Governing Principle</h3>
                <p>
                    The formulas used to calculate a reduced vent area are based on international standards such as
                    <strong>NFPA 68</strong> and <strong>EN 14994</strong>, which govern the design of systems to protect
                    against industrial
                    deflagrations (explosions). These standards provide the parameters and equations for sizing explosion vents
                    to protect
                    a vessel or enclosure from damage.
                </p>
        
                <ul class="note-list">
                    <li><strong>NFPA 68 (Deflagration Venting):</strong> Published by the National Fire Protection Association,
                        this standard defines
                        vent area requirements for dust and gas deflagrations. Key variables include vent area (A·µ•), vessel
                        volume (V),
                        deflagration index (K‚Çõ‚Çú), and reduced explosion pressure (P‚Çç·µ£‚Çëd‚Çé). Coefficients (a, b, c) depend on
                        static activation pressure (P‚Çç‚Çõ‚Çú‚Çê‚Çú‚Çé).</li>
        
                    <li><strong>EN 14994 (Explosion Venting Devices):</strong> The European counterpart to NFPA 68, EN 14994 and
                        related EN 14491
                        standards define methods for determining vent areas in dust and gas explosion scenarios.
                        They use variables such as vessel volume (V), maximum explosion pressure (P‚Çç‚Çò‚Çê‚Çì‚Çé), and reduced explosion
                        pressure (P‚Çç·µ£‚Çëd‚Çé).</li>
        
                    <li><strong>Key Differences:</strong> Comparative studies indicate that results between NFPA 68 and EN 14994
                        vary depending
                        on the vessel‚Äôs geometry, particularly the length-to-diameter ratio.</li>
        
                    <li><strong>Other References:</strong>
                        <ul>
                            <li><strong>FM Global DS 7-76:</strong> Provides guidance for mitigating dust explosion risks and
                                the effect of obstructions on vent performance.</li>
                            <li><strong>CEN TR 15007:</strong> Offers alternative procedures for sizing explosion vents,
                                validated against real explosion trials.</li>
                        </ul>
                    </li>
                </ul>
            </div>
        
            <!-- üß© CONCLUSION -->
            <div class="note-card">
                <h3>üß© Conclusion</h3>
                <p>
                    This calculator provides an initial estimation of the reduced vent area for explosion relief based on
                    thermodynamic
                    and time-based approaches. Both NFPA 68 and EN 14994 emphasize the importance of accounting for vessel
                    geometry, dust/gas
                    characteristics, and vent activation pressure. While this tool provides a simplified analysis for design
                    evaluation,
                    final vent sizing should always be validated against applicable standards, FM Global data sheets, or
                    certified CFD models
                    to ensure full compliance and operational safety.
                </p>
            </div>
        
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];
            function getVal(id, label) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (!raw) {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num) || num <= 0) {
                    errors.push(`üëâ Enter a valid positive number for ${label}.`);
                    return null;
                }
                return num;
            }

            const m0 = getVal('initialMass', 'Initial Mass');
            const q = getVal('heatRelease', 'Heat Release Rate');
            const G = getVal('massFlux', 'Mass Flux');
            const Cv = getVal('specificHeat', 'Specific Heat');
            const deltaT = getVal('tempRise', 'Temperature Rise');
            const deltaTp = getVal('emptyingTime', 'Emptying Time');

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }
            
            const A1 = (m0 * q) / (G * Cv * deltaT);
            const A2 = m0 / (G * deltaTp);

            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = A1.toFixed(4);
            document.getElementById('feedbackContent').innerHTML = `The alternative calculation based on emptying time gives a required area of <strong>${A2.toFixed(4)} m¬≤</strong>. Use the appropriate formula based on your available data.`;
        }
        
        function printReport() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}