{% extends 'base.html' %}
{% block title %}Vent Area Reduction Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vent Area Reduction Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            min-height: 420px; /* Match calc-card */
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Vent Area Reduction Formula Calculator</h1>
            <p>Calculate the required vent area for an enclosed space based on heat release and system properties.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>System Parameters</h2>
                <div class="form-group">
                    <label for="initialMass">Initial Mass (m₀) in kg</label>
                    <input type="number" id="initialMass" class="form-input" placeholder="Enter initial mass">
                </div>
                <div class="form-group">
                    <label for="heatRelease">Heat Release Rate (q) in J/kg</label>
                    <input type="number" id="heatRelease" class="form-input" placeholder="Enter heat release rate">
                </div>
                <div class="form-group">
                    <label for="massFlux">Mass Flux (G) in kg/m²s</label>
                    <input type="number" id="massFlux" class="form-input" placeholder="Enter mass flux">
                </div>
                <div class="form-group">
                    <label for="specificHeat">Specific Heat (Cᵥ) in J/kg·K</label>
                    <input type="number" id="specificHeat" class="form-input" placeholder="Enter specific heat">
                </div>
                <div class="form-group">
                    <label for="tempRise">Temperature Rise (ΔT) in K</label>
                    <input type="number" id="tempRise" class="form-input" placeholder="Enter temperature rise">
                </div>
                <div class="form-group">
                    <label for="emptyingTime">Emptying Time (Δtₚ) in s</label>
                    <input type="number" id="emptyingTime" class="form-input" placeholder="Enter emptying time">
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate Vent Area</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>Enter the system parameters to calculate the required vent area for pressure relief.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Calculated Vent Area (A)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.000</div>
                        <div class="rate-label">m²</div>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                       <div class="btn-wrapper">
                            <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                        </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Vent Area Reduction Formula Calculator</strong> is a safety engineering tool used to determine the necessary opening size for a vent to safely relieve pressure from an enclosure during an overpressure event, such as a deflagration or a runaway reaction. Proper vent sizing is critical to prevent catastrophic failure of a vessel or building. This calculator provides two methods for determining the vent area based on either thermodynamic properties or a required emptying time.
                </p>
            </div>
            <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Initial Mass (m₀):</strong> The total mass of the substance inside the enclosure before the event.</li>
                    <li><strong>Heat Release Rate (q):</strong> The amount of energy released per unit mass of the substance.</li>
                    <li><strong>Mass Flux (G):</strong> The rate of mass flow through the vent per unit area.</li>
                    <li><strong>Specific Heat (Cᵥ):</strong> The amount of heat required to raise the temperature of a unit mass of the substance by one degree at a constant volume.</li>
                    <li><strong>Temperature Rise (ΔT):</strong> The maximum allowable temperature increase inside the enclosure.</li>
                    <li><strong>Emptying Time (Δtₚ):</strong> The required time to safely discharge the contents of the enclosure.</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>✅ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>All Fields Required:</strong> Each parameter is essential for the formulas, so all fields must be filled. Missing data will prevent the calculation.</li>
                    <li><strong>Positive Numbers Only:</strong> All inputs, such as mass, heat release, and time, must be greater than zero. Physical quantities in this context cannot be zero or negative.</li>
                    <li><strong>Numeric Values:</strong> The calculator only accepts numerical data. Entering text or special characters will result in an error, prompting you to enter a valid number for each parameter.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>Output Validations</h3>
                 <p>This calculator provides two distinct results for the vent area, and it's crucial to understand their basis to apply them correctly:</p>
                <ul class="note-list">
                    <li><strong>Primary Result (Thermodynamic Basis):</strong> The main displayed value is calculated based on the system's thermodynamic properties (heat release, specific heat, temperature rise). This value represents the vent area required to safely release the energy generated during the overpressure event.</li>
                    <li><strong>Alternative Result (Emptying Time Basis):</strong> The interpretation text provides a second vent area calculated based on the required emptying time. This value is relevant for scenarios where the primary safety objective is to discharge the enclosure's contents within a specific timeframe.</li>
                </ul>
                <p>The feedback message, "The alternative calculation based on emptying time gives a required area of <strong>[Calculated Area] m²</strong>. Use the appropriate formula based on your available data," highlights this duality. Your choice between these two values should be determined by the specific requirements of your safety analysis and the data you have available.</p>
            </div>
            <div class="note-card">
                <h3>Governing Principle</h3>
                <p>The calculation of vent areas for explosion protection is governed by internationally recognized standards to ensure safety and reliability. The primary standards are:</p>
                <ul class="note-list">
                    <li><strong>NFPA 68:</strong> Standard on Explosion Protection by Deflagration Venting, published by the National Fire Protection Association.</li>
                    <li><strong>EN 14491:</strong> A European standard for the design of vents for dust explosions.</li>
                </ul>
                <p>These standards provide detailed methodologies and empirical formulas for calculating the required vent area based on the properties of the substance, the enclosure strength, and the nature of the potential explosion. The formulas in this calculator are simplified representations of the principles outlined in these comprehensive safety standards.</p>
            </div>
            <div class="note-card">
                <h3>Conclusion</h3>
                <p>
                    Proper vent sizing is a critical component of industrial safety. This calculator provides a valuable tool for preliminary design and assessment based on two common approaches. However, for the final design of a safety-critical system, it is imperative to consult the full text of relevant standards like NFPA 68 and consider all contributing factors, including ductwork effects, vent panel inertia, and the specific characteristics of the hazardous material.
                </p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];
            function getVal(id, label) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (!raw) {
                    errors.push(`👉 ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num) || num <= 0) {
                    errors.push(`👉 Enter a valid positive number for ${label}.`);
                    return null;
                }
                return num;
            }

            const m0 = getVal('initialMass', 'Initial Mass');
            const q = getVal('heatRelease', 'Heat Release Rate');
            const G = getVal('massFlux', 'Mass Flux');
            const Cv = getVal('specificHeat', 'Specific Heat');
            const deltaT = getVal('tempRise', 'Temperature Rise');
            const deltaTp = getVal('emptyingTime', 'Emptying Time');

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }
            
            const A1 = (m0 * q) / (G * Cv * deltaT);
            const A2 = m0 / (G * deltaTp);

            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = A1.toFixed(4);
            document.getElementById('feedbackContent').innerHTML = `The alternative calculation based on emptying time gives a required area of <strong>${A2.toFixed(4)} m²</strong>. Use the appropriate formula based on your available data.`;
        }
        
        function printReport() {
            if (document.getElementById('printDate')) {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}