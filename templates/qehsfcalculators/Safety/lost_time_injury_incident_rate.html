{% extends 'base.html' %}
{% block title %}Lost Time Injury Incident Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Time Injury Incident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Lost Time Injury Frequency Rate Calculator</h1>
            <p>Calculate the frequency of lost time injuries per million hours worked</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="injuries">Number of Lost Time Injuries</label>
                    <input type="number" id="injuries" class="form-input" min="0" placeholder="e.g., 5">
                </div>
                <div class="form-group">
                    <label for="hours">Total Hours Worked</label>
                    <input type="number" id="hours" class="form-input" min="1" placeholder="e.g., 200000">
                </div>
                
                <button class="calculate-btn" onclick="calculateLTIFR()">Calculate LTIFR</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Lost Time Injury Frequency Rate</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:30px;">
                        <h2>Lost Time Injury Frequency Rate</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Injuries per million hours worked</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Excellent</span><span>Good</span><span>Average</span><span>Poor</span><span>Critical</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Safety Performance Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
<div class="note-section">

  <!-- 📘 ABOUT -->
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      The <strong>Lost Time Injury Frequency Rate (LTIFR) Calculator</strong> measures the frequency of lost time injuries 
      per million hours worked, providing a standardized method to compare safety performance across organizations and industries.
    </p>
  </div>

  <!-- ⚙️ PARAMETERS USED -->
  <div class="note-card">
    <h3>⚙️ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Number of Lost Time Injuries:</strong> Incidents resulting in time away from work beyond the day of occurrence.</li>
      <li><strong>Total Hours Worked:</strong> Cumulative hours worked by all employees during the reporting period.</li>
    </ul>
  </div>

  <!-- ✅ INPUT VALIDATION RULES -->
  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>Lost Time Injuries:</b> Must be a whole number between 0 – 10,000.</li>
      <li><b>Total Hours Worked:</b> Must be numeric, between 1 – 100,000,000.</li>
      <li><b>No Negative Values:</b> Injuries or hours cannot be negative.</li>
      <li><b>Cross-Check:</b> Hours must be reasonable relative to the number of injuries.</li>
      <li><b>Compliance:</b> OSHA, ANSI Z16, ISO 45001, and ILO OHS standards.</li>
    </ul>
  </div>

  <!-- 🧾 OUTPUT VALIDATIONS -->
  <div class="note-card">
    <h3>🧾 Output Validations</h3>
    <ul class="note-list">
      <li>The LTIFR result is validated for physical feasibility and compliance with safety standards.</li>
      <li><b>Assessment / Feedback Messages:</b></li>
      <ul class="note-sublist">
        <li>✅ Zero lost time injuries - excellent safety performance.</li>
        <li>✅ Excellent safety performance - world-class standard.</li>
        <li>✅ Good safety performance - meeting industry standards.</li>
        <li>🔵 Average performance - consider improvements.</li>
        <li>⚠️ Below average - corrective actions required.</li>
        <li>❌ Critical safety issue - immediate intervention required.</li>
      </ul>
      <li>Feedback messages are displayed alongside the LTIFR result, summarizing safety performance based on the inputs.</li>
    </ul>
  </div>

  <!-- ⚖️ GOVERNING PRINCIPLE -->
  <div class="note-card">
    <h3>⚖️ Governing Principle</h3>
    <p>
      A Lost Time Incident Rate (LTIR) calculator is based on OSHA standards, specifically using the mathematical formula 
      established by the Occupational Safety and Health Administration for comparing injury and illness rates across industries 
      and companies. The standard calculation uses a base of 200,000 labor hours to represent 100 employees working a full year, 
      providing a consistent benchmark for assessing the rate of incidents that result in time away from work.
    </p>
    <ul class="note-list">
      <li><strong>Standard Metric:</strong> OSHA considers LTIR a standard metric for reporting recordable incident rates.</li>
      <li><strong>Consistent Formula:</strong> Uses a standardized method for fair comparison.</li>
      <li><strong>Benchmarking:</strong> The 200,000 labor hour base allows comparisons across companies and industries.</li>
      <li><strong>Legal Requirement:</strong> LTIR is a legally required metric; high rates can trigger OSHA investigation.</li>
      <li><strong>Tracking:</strong> Employers track total lost time cases (employee unable to work for more than one day).</li>
      <li><strong>Reporting:</strong> The resulting metric measures and compares workplace safety performance over time.</li>
    </ul>
  </div>

  <!-- 🏁 CONCLUSION -->
  <div class="note-card">
    <h3>🏁 Conclusion</h3>
    <p>
      This LTIFR Calculator provides a standardized way to assess safety performance, benchmark against industry standards, 
      and identify areas for corrective actions. The feedback messages guide organizations in understanding their current 
      safety performance and taking appropriate measures to improve workplace safety.
    </p>
  </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateLTIFR() {
    const injuries = document.getElementById('injuries').value.trim();
    const hours = document.getElementById('hours').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // -------------------------
    // ✅ Input Validations (Based on QEHS & OSHA/ISO Standards)
    // -------------------------

    // Injuries
    if (injuries === "" || isNaN(injuries)) {
        errors.push("👉 Please enter the number of lost time injuries.");
    } else if (!Number.isInteger(Number(injuries))) {
        errors.push("👉 Number of injuries must be a whole number (no decimals).");
    } else if (parseInt(injuries) < 0) {
        errors.push("👉 Number of injuries cannot be negative.");
    } else if (parseInt(injuries) > 10000) {
        errors.push("👉 Number of injuries cannot exceed 10,000 (out of range).");
    }

    // Hours
    if (hours === "" || isNaN(hours)) {
        errors.push("👉 Please enter the total hours worked.");
    } else if (parseFloat(hours) <= 0) {
        errors.push("👉 Total hours worked must be greater than 0.");
    } else if (parseFloat(hours) > 100000000) {
        errors.push("👉 Total hours worked cannot exceed 100,000,000 (out of range).");
    }

    // Logical Cross-Field Dependencies
    if (parseInt(injuries) > 0 && parseFloat(hours) < parseInt(injuries)) {
        errors.push("👉 Total hours worked seems too low compared to number of injuries.");
    }

    // -------------------------
    // 🚫 Error Handling
    // -------------------------
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // -------------------------
    // ✅ Safe Calculation
    // -------------------------
    const numInjuries = parseInt(injuries);
    const totalHours = parseFloat(hours);

    // Formula: LTIFR = (Number of Injuries × 1,000,000) ÷ Hours Worked
    const ltifr = (numInjuries * 1000000) / totalHours;

    document.getElementById('rateValue').textContent = ltifr.toFixed(2);

    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    // Threshold Classification
    if (ltifr === 0) {
        meterWidth = '5%'; 
        meterColor = '#27ae60';
        feedback = '✅ Zero lost time injuries - excellent safety performance.';
    } else if (ltifr < 1.0) {
        meterWidth = '20%'; 
        meterColor = '#2ecc71';
        feedback = '✅ Excellent safety performance - world-class standard.';
    } else if (ltifr < 3.0) {
        meterWidth = '35%'; 
        meterColor = '#2ecc71';
        feedback = '✅ Good safety performance - meeting industry standards.';
    } else if (ltifr < 5.0) {
        meterWidth = '50%'; 
        meterColor = '#f1c40f';
        feedback = '🔵 Average performance - consider improvements.';
    } else if (ltifr < 10.0) {
        meterWidth = '70%'; 
        meterColor = '#e67e22';
        feedback = '⚠️ Below average - corrective actions required.';
    } else {
        meterWidth = '95%'; 
        meterColor = '#e74c3c';
        feedback = '❌ Critical safety issue - immediate intervention required.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;

    feedback += `<br><br>Based on ${numInjuries} lost time injuries and ${totalHours.toLocaleString()} hours worked.`;
    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Reference
// Formula used for LTIFR calculation:
// LTIFR = (Number of Lost Time Injuries × 1,000,000) ÷ Total Hours Worked


This formula is aligned with OSHA recordkeeping requirements, ANSI Z16.1 standards, ISO 45001, and ILO definitions.

2. Input Validation Rules (QEHS/Fire Safety Based)
Lost Time Injuries (LTI):

Type: Integer only (whole numbers, no decimals).

Range: 0 – 10,000 (realistic upper bound for annual corporate/global reporting).

Minimum: 0 (cannot be negative).

Logical Dependency:

If hours worked = 0, then LTI must also be 0.

If LTI = 0, the LTIFR must calculate as exactly 0.

Total Hours Worked:

Type: Numeric (integer or decimal acceptable).

Range: 1 – 100,000,000 (large upper bound for multinational workforce).

Minimum: > 0 (to prevent division by zero).

Logical Dependency:

Must be ≥ Number of Injuries × 1 hour, since each injury implies some work hours occurred.

Hours cannot be unrealistically small if injuries are high (e.g., 10 injuries in 20 hours → LTIFR 500,000 → flag warning).

3. Output Validation & Thresholds
LTIFR Classification (per million hours worked):

0.0 → Perfect (Zero harm – exceptional performance).

< 1.0 → Excellent (world-class performance, e.g., oil & gas majors, pharma).

1.0 – 3.0 → Good (acceptable benchmark for many industries).

3.0 – 5.0 → Average (needs structured safety improvement plan).

5.0 – 10.0 → Below Average (serious risk exposures, requires intervention).

> 10.0 → Poor (critical, indicates systemic safety failures).

⚠️ These thresholds are in line with OSHA, ANSI Z16, ISO 45001 benchmarking practices. {% endcomment %}