{% extends 'base.html' %}
{% block title %}Lost Time Injury Incident Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost Time Injury Incident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Lost Time Injury Frequency Rate Calculator</h1>
            <p>Calculate the frequency of lost time injuries per million hours worked</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="injuries">Number of Lost Time Injuries</label>
                    <input type="number" id="injuries" class="form-input" min="0" placeholder="e.g., 5">
                </div>
                <div class="form-group">
                    <label for="hours">Total Hours Worked</label>
                    <input type="number" id="hours" class="form-input" min="1" placeholder="e.g., 200000">
                </div>
                
                <button class="calculate-btn" onclick="calculateLTIFR()">Calculate LTIFR</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Lost Time Injury Frequency Rate</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:30px;">
                        <h2>Lost Time Injury Frequency Rate</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Injuries per million hours worked</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Excellent</span><span>Good</span><span>Average</span><span>Poor</span><span>Critical</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Safety Performance Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Lost Time Injury Frequency Rate (LTIFR) Calculator</strong> measures the frequency of lost time injuries 
                    per million hours worked, providing a standardized way to compare safety performance across different 
                    organizations and industries.
                </p>
            </div>

            <div class="note-card">
                <h3>‚ùì What is Lost Time Injury Frequency Rate?</h3>
                <p>
                    LTIFR is a safety metric that quantifies the number of lost time injuries occurring per million hours worked. 
                    It's widely used to benchmark safety performance in various industries.
                </p>
            </div>

            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Number of Lost Time Injuries:</strong> Injuries resulting in time away from work beyond the day of the incident</li>
                    <li><strong>Total Hours Worked:</strong> The cumulative hours worked by all employees during the period</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üìä Interpretation</h3>
                <p>
                    <b>Lower LTIFR Values</b> = better safety performance. Generally:
                </p>
                <ul class="note-list">
                    <li><span class="good">Below 1.0</span> ‚Üí Excellent safety performance</li>
                    <li><span class="good">1.0 - 3.0</span> ‚Üí Good safety performance</li>
                    <li><span class="average">3.0 - 5.0</span> ‚Üí Average safety performance</li>
                    <li><span class="average">5.0 - 10.0</span> ‚Üí Below average, needs improvement</li>
                    <li><span class="bad">Above 10.0</span> ‚Üí Poor safety performance, requires immediate action</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>üåç Real-Life Applications</h3>
                <ul class="note-list">
                    <li><strong>Workplace Safety</strong> - Benchmarking safety performance across departments</li>
                    <li><strong>Construction Industry</strong> - Monitoring safety in high-risk environments</li>
                    <li><strong>Manufacturing</strong> - Tracking safety improvements over time</li>
                    <li><strong>Regulatory Compliance</strong> - Meeting OSHA and other regulatory requirements</li>
                    <li><strong>Insurance Risk Assessment</strong> - Determining premium rates based on safety performance</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>üìã Industry Standards</h3>
                <p>
                    OSHA recordkeeping requirements, ANSI Z16 standards, and ISO 45001 (Occupational Health and Safety) 
                    provide frameworks for calculating and interpreting LTIFR.
                </p>
            </div>
            
            <div class="note-card">
    <h3>‚úÖ Validation Rules (This Calculator)</h3>
    <ul class="note-list">
        <li><b>Lost Time Injuries:</b> Integer only, range 0 ‚Äì 10,000 (no decimals).</li>
        <li><b>Total Hours Worked:</b> Numeric, range 1 ‚Äì 100,000,000.</li>
        <li><b>No Negative Values:</b> Injuries and hours cannot be negative.</li>
        <li><b>Cross-Check:</b> Hours must be reasonable compared to number of injuries.</li>
        <li><b>Formula:</b> LTIFR = (Lost Time Injuries √ó 1,000,000) √∑ Total Hours Worked.</li>
        <li><b>Compliance:</b> OSHA, ANSI Z16, ISO 45001, and ILO OHS standards.</li>
    </ul>
</div>

        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateLTIFR() {
    const injuries = document.getElementById('injuries').value.trim();
    const hours = document.getElementById('hours').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // -------------------------
    // ‚úÖ Input Validations (Based on QEHS & OSHA/ISO Standards)
    // -------------------------

    // Injuries
    if (injuries === "" || isNaN(injuries)) {
        errors.push("üëâ Please enter the number of lost time injuries.");
    } else if (!Number.isInteger(Number(injuries))) {
        errors.push("üëâ Number of injuries must be a whole number (no decimals).");
    } else if (parseInt(injuries) < 0) {
        errors.push("üëâ Number of injuries cannot be negative.");
    } else if (parseInt(injuries) > 10000) {
        errors.push("üëâ Number of injuries cannot exceed 10,000 (out of range).");
    }

    // Hours
    if (hours === "" || isNaN(hours)) {
        errors.push("üëâ Please enter the total hours worked.");
    } else if (parseFloat(hours) <= 0) {
        errors.push("üëâ Total hours worked must be greater than 0.");
    } else if (parseFloat(hours) > 100000000) {
        errors.push("üëâ Total hours worked cannot exceed 100,000,000 (out of range).");
    }

    // Logical Cross-Field Dependencies
    if (parseInt(injuries) > 0 && parseFloat(hours) < parseInt(injuries)) {
        errors.push("üëâ Total hours worked seems too low compared to number of injuries.");
    }

    // -------------------------
    // üö´ Error Handling
    // -------------------------
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // -------------------------
    // ‚úÖ Safe Calculation
    // -------------------------
    const numInjuries = parseInt(injuries);
    const totalHours = parseFloat(hours);

    // Formula: LTIFR = (Number of Injuries √ó 1,000,000) √∑ Hours Worked
    const ltifr = (numInjuries * 1000000) / totalHours;

    document.getElementById('rateValue').textContent = ltifr.toFixed(2);

    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    // Threshold Classification
    if (ltifr === 0) {
        meterWidth = '5%'; 
        meterColor = '#27ae60';
        feedback = '‚úÖ Zero lost time injuries - excellent safety performance.';
    } else if (ltifr < 1.0) {
        meterWidth = '20%'; 
        meterColor = '#2ecc71';
        feedback = '‚úÖ Excellent safety performance - world-class standard.';
    } else if (ltifr < 3.0) {
        meterWidth = '35%'; 
        meterColor = '#2ecc71';
        feedback = '‚úÖ Good safety performance - meeting industry standards.';
    } else if (ltifr < 5.0) {
        meterWidth = '50%'; 
        meterColor = '#f1c40f';
        feedback = 'üîµ Average performance - consider improvements.';
    } else if (ltifr < 10.0) {
        meterWidth = '70%'; 
        meterColor = '#e67e22';
        feedback = '‚ö†Ô∏è Below average - corrective actions required.';
    } else {
        meterWidth = '95%'; 
        meterColor = '#e74c3c';
        feedback = '‚ùå Critical safety issue - immediate intervention required.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;

    feedback += `<br><br>Based on ${numInjuries} lost time injuries and ${totalHours.toLocaleString()} hours worked.`;
    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Reference
// Formula used for LTIFR calculation:
// LTIFR = (Number of Lost Time Injuries √ó 1,000,000) √∑ Total Hours Worked


This formula is aligned with OSHA recordkeeping requirements, ANSI Z16.1 standards, ISO 45001, and ILO definitions.

2. Input Validation Rules (QEHS/Fire Safety Based)
Lost Time Injuries (LTI):

Type: Integer only (whole numbers, no decimals).

Range: 0 ‚Äì 10,000 (realistic upper bound for annual corporate/global reporting).

Minimum: 0 (cannot be negative).

Logical Dependency:

If hours worked = 0, then LTI must also be 0.

If LTI = 0, the LTIFR must calculate as exactly 0.

Total Hours Worked:

Type: Numeric (integer or decimal acceptable).

Range: 1 ‚Äì 100,000,000 (large upper bound for multinational workforce).

Minimum: > 0 (to prevent division by zero).

Logical Dependency:

Must be ‚â• Number of Injuries √ó 1 hour, since each injury implies some work hours occurred.

Hours cannot be unrealistically small if injuries are high (e.g., 10 injuries in 20 hours ‚Üí LTIFR 500,000 ‚Üí flag warning).

3. Output Validation & Thresholds
LTIFR Classification (per million hours worked):

0.0 ‚Üí Perfect (Zero harm ‚Äì exceptional performance).

< 1.0 ‚Üí Excellent (world-class performance, e.g., oil & gas majors, pharma).

1.0 ‚Äì 3.0 ‚Üí Good (acceptable benchmark for many industries).

3.0 ‚Äì 5.0 ‚Üí Average (needs structured safety improvement plan).

5.0 ‚Äì 10.0 ‚Üí Below Average (serious risk exposures, requires intervention).

> 10.0 ‚Üí Poor (critical, indicates systemic safety failures).

‚ö†Ô∏è These thresholds are in line with OSHA, ANSI Z16, ISO 45001 benchmarking practices. {% endcomment %}