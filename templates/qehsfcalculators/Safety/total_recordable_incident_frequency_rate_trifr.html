{% extends 'base.html' %}
{% block title %}Total Recordable Incident Frequency Rate (TRIFR) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Total Recordable Incident Frequency Rate (TRIFR) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px; /* Fixed Height */
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px; /* Fixed Height */
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        .comparison-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        .comparison-table thead {
            background-color: #e3f2fd;
            color: #0d47a1;
            font-weight: 600;
        }
        .comparison-table th, .comparison-table td {
            padding: 12px 15px;
            border: 1px solid #bbdefb;
            text-align: left;
            vertical-align: top;
        }
        .comparison-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .comparison-table td:first-child {
            font-weight: 600;
            color: #1560bd;
        }

        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Base table styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 16px;
            border: 1px solid #ddd;
        }

        table th,
        table td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #ddd;
        }

        table thead {
            background-color: #f5f5f5;
            font-weight: bold;
        }

        /* Responsive: Mobile View */
        @media (max-width: 768px) {
            table,
            table thead,
            table tbody,
            table th,
            table td,
            table tr {
                display: block;
                width: 100%;
            }

            table thead {
                display: none; /* Hide header on small screens */
            }

            table tr {
                margin-bottom: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 10px;
                background: #fff;
            }

            table td {
                text-align: left;
                padding: 10px;
                position: relative;
            }

            table td::before {
                content: attr(data-label);
                font-weight: bold;
                display: block;
                margin-bottom: 5px;
                color: #333;
            }
        }

    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Total Recordable Incident Frequency Rate (TRIFR) Calculator</h1>
            <p>Measure workplace safety performance using the international standard of incidents per 1,000,000 hours worked.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Safety Data</h2>
                <div class="form-group">
                    <label for="totalIncidents">Total Recordable Incidents</label>
                    <input type="number" id="totalIncidents" class="form-input" placeholder="e.g., 2">
                </div>
                <div class="form-group">
                    <label for="totalHours">Total Hours Worked</label>
                    <input type="number" id="totalHours" class="form-input" placeholder="e.g., 750000">
                </div>
                <button class="calculate-btn" onclick="calculateTRIFR()">Calculate TRIFR</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Global safety standards icon">
                    <p>Enter your incident and work hour data to calculate your TRIFR and assess your safety performance.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" id="rateLabel">TRIFR (per 1,000,000 hours)</div>
                    
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Excellent</span><span>Good</span><span>Moderate</span><span>High</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Safety Performance Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>üìò About TRIFR</h3>
                <p>
                    The <strong>Total Recordable Incident Frequency Rate (TRIFR)</strong> helps measure workplace safety by
                    calculating the rate of recordable incidents per <strong>1,000,000 hours worked</strong>.
                    It is used internationally (Australia, UK, and other regions) to benchmark safety performance
                    and is particularly useful in industries with larger workforces.
                </p>
            </div>
        
            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Total Recordable Incidents (TRIs):</strong> The number of OSHA recordable incidents, including
                        work-related injuries and illnesses that require medical treatment beyond first aid, restricted work,
                        lost time, or fatalities.</li>
                    <li><strong>Total Hours Worked:</strong> The total number of hours worked by all employees, including
                        full-time, part-time, and temporary workers.</li>
                </ul>
                <p>Click the <strong>Calculate TRIFR</strong> button to see the result.</p>
            </div>
        
            <div class="note-card">
                <h3>‚úÖ Input Validations:</h3>
                <p>The calculator enforces strict validation rules to ensure results are accurate and meaningful:</p>
                <ul class="note-list">
                    <li>If <strong>Total Recordable Incidents</strong> is empty, not a number, or less than 0:<br>
                        <code>üëâ Total Incidents must be a number ‚â• 0.</code>
                    </li>
                    <li>If <strong>Total Recordable Incidents</strong> is not a whole number:<br>
                        <code>üëâ Total Incidents must be a whole number.</code>
                    </li>
                    <li>If <strong>Total Recordable Incidents</strong> exceeds 1000:<br>
                        <code>üëâ Total Incidents seems unrealistic. Please verify your input.</code>
                    </li>
                    <li>If <strong>Total Hours Worked</strong> is empty, not a number, or ‚â§ 0:<br>
                        <code>üëâ Total Hours Worked must be a number > 0.</code>
                    </li>
                    <li>If <strong>Total Hours Worked</strong> is less than 100:<br>
                        <code>üëâ Total Hours Worked is too low to be realistic. Please verify.</code>
                    </li>
                    <li>If <strong>Total Hours Worked</strong> exceeds 1,000,000,000:<br>
                        <code>üëâ Total Hours Worked seems excessively high. Please check your input.</code>
                    </li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üìä Output Validations:</h3>
                <p>Once valid inputs are provided, the calculator ensures the TRIFR result is meaningful and aligns with audit
                    standards:</p>
                <ul class="card-list">
                    <li>If the final TRIFR calculation is invalid (NaN, infinite, or negative):<br>
                        <code>‚ùå Calculation resulted in an invalid number. Please check your inputs.</code>
                    </li>
                    <li>When valid, the <strong>TRIFR</strong> is displayed with two decimal places, along with safety performance
                        feedback:</li>
                    <ul class="note-list">
                        <li><strong>‚â§ 1.0:</strong> ‚úÖ Excellent Performance ‚Äì very low TRIFR, strong safety culture and controls.
                        </li>
                        <li><strong>1.01 ‚Äì 2.5:</strong> üëç Good Performance ‚Äì TRIFR in healthy range, continue proactive safety
                            measures.</li>
                        <li><strong>2.51 ‚Äì 4.0:</strong> üü° Moderate Performance ‚Äì review incident trends and preventive measures.
                        </li>
                        <li><strong>> 4.0:</strong> ‚ùå High Frequency ‚Äì immediate review of safety systems required.</li>
                    </ul>
                </ul>
            </div>

            <div class="note-card">
                <h3>üìè Standards & Compliance</h3>
                <p>
                    TRIFR is closely related to <strong>TRIR (Total Recordable Incident Rate)</strong>, but they differ in
                    the standard multiplier used:
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Description</th>
                            <th>Key Difference</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="Metric"><strong>TRIR</strong></td>
                            <td data-label="Description">Measures the number of recordable workplace incidents per total hours worked.
                                Commonly used in the U.S. (OSHA standard).</td>
                            <td data-label="Key Difference">Uses a multiplier of <strong>200,000</strong>, representing 100 employees
                                working a full year.</td>
                        </tr>
                        <tr>
                            <td data-label="Metric"><strong>TRIFR</strong></td>
                            <td data-label="Description">Measures the frequency of recordable workplace incidents under international
                                standards.</td>
                            <td data-label="Key Difference">Uses a multiplier of <strong>1,000,000</strong>, useful for global reporting
                                and larger workforces.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="note-card">
                <h3>‚úÖ Conclusion</h3>
                <p>
                    Tracking <strong>TRIFR</strong> helps organizations evaluate and improve workplace safety.
                    Lower TRIFR values indicate fewer disruptions and a safer, more efficient operation.
                    Understanding the difference between TRIFR and TRIR is crucial for accurate benchmarking across regions.
                </p>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if (document.getElementById('printDate')) {
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateTRIFR() {
            const incidents_val = document.getElementById('totalIncidents').value.trim();
            const hours_val = document.getElementById('totalHours').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // --- VALIDATION RULES ---
            const incidents = parseFloat(incidents_val);
            if (incidents_val === '' || isNaN(incidents) || incidents < 0) {
                errors.push("üëâ Total Incidents must be a number ‚â• 0.");
            } else if (!Number.isInteger(incidents)) {
                errors.push("üëâ Total Incidents must be a whole number.");
            } else if (incidents > 1000) {
                errors.push("üëâ Total Incidents seems unrealistic. Please verify your input.");
            }

            const hours = parseFloat(hours_val);
            if (hours_val === '' || isNaN(hours) || hours <= 0) {
                errors.push("üëâ Total Hours Worked must be a number > 0.");
            } else if (hours < 100) {
                errors.push("üëâ Total Hours Worked is too low to be realistic. Please verify.");
            } else if (hours > 1e9) {
                errors.push("üëâ Total Hours Worked seems excessively high. Please check your input.");
            }

            // --- ERROR HANDLING ---
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // --- CALCULATION ---
            const trifr = (incidents * 1000000) / hours;

            if (!isFinite(trifr) || trifr < 0) {
                errorMessage.innerHTML = "‚ùå Calculation resulted in an invalid number. Please check your inputs.";
                errorBox.classList.remove("hidden");
                resultValue.classList.add("hidden");
                return;
            }

            document.getElementById('rateValue').textContent = trifr.toFixed(2);

            // --- PERFORMANCE ASSESSMENT ---
            const meterFill = document.getElementById('meterFill');
            let meterWidth, meterColor, feedback;

            if (trifr <= 1.0) {
                meterWidth = '20%';
                meterColor = '#2ecc71'; // Green
                feedback = '‚úÖ <strong>Excellent Performance.</strong> Very low TRIFR, indicating strong safety culture and effective controls.';
            } else if (trifr <= 2.5) {
                meterWidth = '45%';
                meterColor = '#f1c40f'; // Yellow
                feedback = 'üëç <strong>Good Performance.</strong> TRIFR is within a healthy range. Continue proactive safety measures.';
            } else if (trifr <= 4.0) {
                meterWidth = '70%';
                meterColor = '#e67e22'; // Orange
                feedback = 'üü° <strong>Moderate Performance.</strong> TRIFR suggests room for improvement. Review incident trends and controls.';
            } else {
                meterWidth = '95%';
                meterColor = '#e74c3c'; // Red
                feedback = '‚ùå <strong>High Frequency.</strong> TRIFR is elevated. Immediate review of your safety management system is strongly recommended.';
            }

            meterFill.style.width = meterWidth;
            meterFill.style.backgroundColor = meterColor;
            document.getElementById('feedbackContent').innerHTML = feedback;

            placeholder.classList.add("hidden");
            resultValue.classList.remove("hidden");
        }

        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if (document.getElementById('printDate')) {
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!--  
1. Input Analysis & Real-World Relevance

Total Recordable Incidents

Must be a whole number ‚â• 0 (OSHA/ISO 45001 recognizes only integer counts of incidents).

Typically ranges from 0‚Äì50 depending on company size.

Total Hours Worked

Must be > 0, since division by zero is invalid.

Should reasonably reflect workforce size √ó hours √ó time period.

E.g., 100 employees √ó 2000 hrs/year ‚âà 200,000 hours/year.

Anything below 1,000 is unrealistic; anything above 100,000,000 may be suspicious and needs validation.

Formula Validation
TRIFR = (Total Recordable Incidents √ó 1,000,000) √∑ Total Hours Worked

Standardized globally (OSHA, ILO, ISO 45001).

Scaling factor ensures comparability across industries.

2. Comprehensive Input Validation Rules

‚úÖ Total Recordable Incidents

Required (cannot be blank).

Must be integer ‚â• 0.

Maximum: 10,000 (any larger is likely data entry error).

‚úÖ Total Hours Worked

Required (cannot be blank).

Must be > 0.

Reasonable range: 1,000 ‚Äì 100,000,000 (for audit credibility).

Must be a valid positive number (decimals allowed).

‚úÖ Cross-Field Validations

If incidents = 0 ‚Üí TRIFR should = 0 (safe workplace).

If hours are unrealistically small (e.g., < 100) with incidents > 0 ‚Üí flag warning.

3. Edge Case Validations

Division by zero ‚Üí Prevented (totalHours > 0).

Negative inputs ‚Üí Invalid (safety data cannot be negative).

Non-integer incidents ‚Üí Invalid (cannot have 2.5 incidents).

Unrealistic TRIFR (>1000) ‚Üí Warn user about potential input errors.

4. Output Validation & Thresholds

Standard benchmarks (based on global safety data):

TRIFR = 0 ‚Üí ‚úÖ Excellent (world-class safety).

0.1 ‚Äì 3.0 ‚Üí üü¢ Good (better than industry average).

3.1 ‚Äì 10.0 ‚Üí üü° Moderate (needs improvement).

10.1 ‚Äì 25.0 ‚Üí üü† High (significant safety risks).

> 25.0 ‚Üí üî¥ Critical (urgent corrective action required).

These thresholds align with ISO 45001 audits and OSHA reporting expectations.
-->