{% extends 'base.html' %}
{% block title %}Dynamic Lifting Load Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Lifting Load Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
           /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 12px;
        }
         .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Table styles */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        .custom-table {
            width: 80%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .custom-table th, .custom-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .custom-table th {
            background-color: #1560bd;
            color: white;
            font-weight: 600;
        }
        
        .custom-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .custom-table tr:hover {
            background-color: #e9f7fe;
        }

        /* Mobile-specific adjustments */
        @media (max-width: 320px) {
            .calculator-container {
                padding: 10px;
            }
            
            .calculator-header h1 {
                font-size: 1.8rem;
            }
            
            .calculator-header p {
                font-size: 16px;
            }
            
            .calc-card, .result-card {
                padding: 20px 15px;
                border-radius: 12px;
            }
            
            .calc-card h2 {
                font-size: 1.4rem;
            }
            
            .form-input, .form-select {
                padding: 12px 14px;
                font-size: 14px;
            }
            
            .calculate-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .result-placeholder img {
                max-width: 180px;
            }
            
            .rate-value {
                font-size: 36px;
            }
            
            .meter-labels span {
                font-size: 10px;
            }
            
            .note-card {
                padding: 15px 18px;
            }
            
            .note-card h3 {
                font-size: 16px;
            }
            
            .note-card p, .note-card li {
                font-size: 14px;
            }
            
            .custom-table th, .custom-table td {
                padding: 8px 10px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Dynamic Lifting Load Calculator</h1>
            <p>Calculate the dynamic load for lifting operations based on equipment type and static load</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                
                <div class="form-group">
                    <label for="staticLoad">Static Load (kN/kg)</label>
                    <input type="number" id="staticLoad" class="form-input" min="1" placeholder="e.g., 100">
                </div>
                
               <div class="form-group">
    <label for="liftingClass">Select Lifting Equipment</label>
    <div class="select-wrapper">
        <select id="liftingClass" class="form-select">
            <option value="1.1">Tower Crane (f = 1.1)</option>
            <option value="1.3">Overhead Crane (f = 1.3)</option>
            <option value="1.4">Mobile Crane (f = 1.4)</option>
            <option value="1.6">High-Speed Lifting (f = 1.6)</option>
        </select>
    </div>
</div>

                
                <button class="calculate-btn" onclick="calculateDynamicLoad()">Calculate Dynamic Load</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                   <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Dynamic Lifting Load</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Dynamic Lifting Load</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">kN</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                 

                    <div class="result-feedback">
                        
                        <div class="feedback-title">Safety Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
<!-- Notes Section -->
<div class="note-section">

    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Dynamic Lifting Load Calculator</strong> helps determine the actual load experienced during lifting operations,
            which is higher than the static load due to acceleration, deceleration, and other dynamic factors.
            This calculation is essential for selecting appropriate lifting equipment and ensuring operational safety.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Static Load:</strong> The weight of the object being lifted (in kN or kg).</li>
            <li><strong>Dynamic Factor (f):</strong> A multiplier that accounts for the dynamic effects during lifting operations.</li>
        </ul>
    </div>

    <!-- Standard Values Table -->
    <div class="note-card">
        <h3>📊 Standard Values of Lifting Coefficient (f)</h3>
        <div class="table-container">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Lifting Equipment</th>
                        <th>Dynamic Factor (f)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Tower Crane</td>
                        <td>1.1</td>
                    </tr>
                    <tr>
                        <td>Overhead Crane</td>
                        <td>1.3</td>
                    </tr>
                    <tr>
                        <td>Mobile Crane</td>
                        <td>1.4</td>
                    </tr>
                    <tr>
                        <td>High-Speed Lifting</td>
                        <td>1.6</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Static Load:</strong> Must be > 0. Acceptable range: 1 – 10,000 kN. No negative or zero values allowed.</li>
            <li><strong>Dynamic Factor:</strong> Must be selected from predefined equipment types (1.1 – 1.6).</li>
            <li><strong>Output Dynamic Load:</strong> Valid range up to 2 × Static Load. Above this is unsafe (Critical Risk).</li>
            <li><strong>No text or invalid entries:</strong> Only numeric inputs accepted.</li>
        </ul>
        <p><b>Note:</b> These validations are based on <b>ISO 4301, OSHA 1910, and ASME B30</b> standards for crane and lifting operations.</p>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <p>The <strong>Dynamic Lifting Load</strong> is assessed as follows:</p>
        <ul class="note-list">
            <li>≤ 1.2 × Static Load → ✅ Safe operation. Dynamic load is within safe limits.</li>
            <li>≤ 1.5 × Static Load → ⚠ Moderate risk. Monitor lifting conditions closely.</li>
            <li>≤ 1.8 × Static Load → ⚠ High risk. Consider using higher-capacity equipment.</li>
            <li>≤ 2.0 × Static Load → 🚨 Dangerous! Review lifting plan before proceeding.</li>
            <li>> 2.0 × Static Load → ❌ Critical! Do not proceed. Dynamic load exceeds safe working limits.</li>
        </ul>
        <p><strong>Assessment/Feedback:</strong> Displayed along with result, e.g., "Moderate risk. Monitor lifting conditions closely."</p>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📖 Governing Principle</h3>
        <p>
            There is no single "standard" for Drilling Torque and Drag Calculators; instead, there are several widely-used models and industry practices, 
            with the Johancsik et al. model and soft-string/stiff-string models being prominent. Various academic papers, such as SPE 11380 and the Kyllingstad-He buckling model (SPE 25370), 
            are often incorporated into modern software to enhance accuracy, particularly for complex wellbores.
        </p>
        <ul class="note-list">
            <li><strong>Johancsik et al. Model (1984):</strong> Considered the most common and foundational method for drillstring analysis.</li>
            <li><strong>Soft-String Model:</strong> Widely used simplified model for calculating torque and drag, though less accurate in high-severity dog-leg situations.</li>
            <li><strong>Stiff-String Model:</strong> More complex, accurate for high dog-leg severity or stiff drillstring components.</li>
            <li><strong>SPE Standards:</strong> Papers like SPE 11380 serve as the basis for torque and drag calculation methodologies.</li>
            <li><strong>Kyllingstad-He Buckling Model:</strong> Often combined with soft-string model for comprehensive analysis.</li>
        </ul>
        <p><strong style="color: #1976d2;">Assessment/Feedback:</strong> Same interpretation rules as Output Validations apply here and are displayed along with result.</p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <ul>
            <li>Dynamic lifting load calculation ensures safe operation by accounting for acceleration and equipment type.</li>
            <li>Feedback and assessment during calculation help operators evaluate risk in real-time.</li>
            <li>Input validation prevents unsafe or unrealistic results, maintaining compliance with industry standards.</li>
        </ul>
    </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        
function calculateDynamicLoad() {
    const staticLoad = document.getElementById('staticLoad').value.trim();
    const liftingFactor = document.getElementById('liftingClass').value;

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // ============================
    // VALIDATE STATIC LOAD
    // ============================
    if (staticLoad === "") {
        errors.push("👉 Please enter the Static Load.");
    } else {
        const sl = parseFloat(staticLoad);
        if (isNaN(sl)) {
            errors.push("👉 Static Load must be a valid number.");
        } else if (sl <= 0) {
            errors.push("👉 Static Load must be greater than 0.");
        } else if (sl < 1) {
            errors.push("👉 Static Load less than 1 kN is not realistic for lifting equipment.");
        } else if (sl > 10000) {
            errors.push("👉 Static Load exceeds 10,000 kN. Please verify.");
        }
    }

    // ============================
    // VALIDATE LIFTING FACTOR
    // ============================
    const validFactors = ["1.1", "1.3", "1.4", "1.6"];
    if (!validFactors.includes(liftingFactor)) {
        errors.push("👉 Invalid lifting factor. Please select from the given options.");
    }

    // ============================
    // HANDLE ERRORS
    // ============================
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ============================
    // CALCULATION
    // ============================
    const SL = parseFloat(staticLoad);
    const f = parseFloat(liftingFactor);
    const DL = SL * f;

    if (!isFinite(DL) || DL <= 0) {
        errorMessage.innerHTML = "❌ Invalid calculation result. Please check inputs.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    document.getElementById('rateValue').textContent = DL.toFixed(2);

    // ============================
    // SAFETY ASSESSMENT
    // ============================
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (DL <= SL * 1.2) {
        meterWidth = "20%";
        meterColor = "#27ae60";
        feedback = "✅ Safe operation. Dynamic load is within safe limits.";
    } else if (DL <= SL * 1.5) {
        meterWidth = "40%";
        meterColor = "#2ecc71";
        feedback = "⚠ Moderate risk. Monitor lifting conditions closely.";
    } else if (DL <= SL * 1.8) {
        meterWidth = "60%";
        meterColor = "#f39c12";
        feedback = "⚠ High risk. Consider using higher-capacity equipment.";
    } else if (DL <= SL * 2.0) {
        meterWidth = "80%";
        meterColor = "#e67e22";
        feedback = "🚨 Dangerous! Review lifting plan before proceeding.";
    } else {
        meterWidth = "95%";
        meterColor = "#e74c3c";
        feedback = "❌ Critical! Do not proceed. Dynamic load exceeds safe working limits.";
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback;

    const equipmentType = document.getElementById('liftingClass').options[document.getElementById('liftingClass').selectedIndex].text;
    document.getElementById('calculationType').innerHTML = `<h2>Dynamic Lifting Load for ${equipmentType.split(' (')[0]}</h2>`;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

{% comment %} 

1. Formula (with comment for code)
/*

Dynamic Lifting Load Calculator
Formula:
Dynamic Load (DL) = Static Load (SL) × Dynamic Factor (f)

Where:
SL = Static Load (weight of object in kN or kg)
f = Dynamic factor (depends on lifting equipment type)
- Tower Crane = 1.1
- Overhead Crane = 1.3
- Mobile Crane = 1.4
- High-Speed Lifting = 1.6

Standards Referenced:
- ISO 4301 (Cranes & Lifting Appliances)
- OSHA 1910 Subpart N (Material Handling)
- ASME B30 (Cranes & Lifting Devices)

*/

2. Input Validation Rules (QEHS / Fire Safety Perspective)
Static Load (SL)

Must be numeric.

Must be > 0 (cannot lift zero or negative weight).

Typical safe range: 1 – 10,000 kN (≈ 100 – 1,000,000 kg).

Up to 2 decimal places (since load measurement rarely exceeds that precision).

If entered in kg, convert to kN (1 kN ≈ 101.97 kg). Recommend consistency in labeling.

Dynamic Factor (f)

Must be chosen from predefined options only.

Range: 1.1 – 1.6 (based on ISO/ASME/OSHA).

Prevent free-text/manual entry.

3. Output Validation Logic
Dynamic Load (DL)

Formula: DL = SL × f

Safe working load assessments:

≤ 1.2 × SL → ✅ Safe

≤ 1.5 × SL → ⚠ Moderate Risk

≤ 1.8 × SL → ⚠ High Risk

≤ 2.0 × SL → 🚨 Dangerous

2.0 × SL → ❌ Critical (prohibited by OSHA/ASME)

⚠ Thresholds derived from crane derating guidelines (OSHA 1910.179, ASME B30.5).

4. Edge Case Validations

Static Load = 0 → error: “Load cannot be zero.”

Negative Static Load → error: invalid input.

Static Load > 10,000 kN → error: beyond crane safe limits.

Empty input → error: must provide load.

Non-numeric input → error.

Unrecognized lifting factor (tampered code) → error: invalid selection.

DL > 20,000 kN → warning: unrealistic for typical industrial cranes.

5. Corrected JavaScript Code

Here’s a validated version of your calculateDynamicLoad() function:

/*
=================================================
Dynamic Lifting Load Calculator
Formula:
    DL = SL × f
Validation Rules:
    Static Load (SL):
        - Must be > 0
        - Range: 1 – 10,000 kN
        - Up to 2 decimals allowed
    Dynamic Factor (f):
        - Must be from predefined options: 1.1, 1.3, 1.4, 1.6
    Output (DL):
        - Safe up to 2 × SL
        - Flag anything > 2 × SL as Critical Risk
=================================================
*/ {% endcomment %}
