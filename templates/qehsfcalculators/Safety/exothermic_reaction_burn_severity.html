{% extends 'base.html' %}
{% block title %}Exothermic Reaction Burn Severity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exothermic Reaction Burn Severity Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (min-width: 901px) {
            .calc-content { 
                flex-direction: row; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            order: 2;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            min-height: 320px;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for side-by-side fields */
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        .hint {
            display: block;
            margin-top: 5px;
            font-size: 12px;
            color: #e0e0e0;
            font-style: italic;
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .critical {
            color: #8b0000;
            font-weight: 700;
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Mobile-specific adjustments */
        @media (max-width: 320px) {
            .calculator-container {
                padding: 10px;
            }
            
            .calculator-header h1 {
                font-size: 1.8rem;
            }
            
            .calculator-header p {
                font-size: 16px;
            }
            
            .calc-card, .result-card {
                padding: 20px 15px;
                border-radius: 12px;
            }
            
            .calc-card h2 {
                font-size: 1.4rem;
            }
            
            .form-input {
                padding: 12px 14px;
                font-size: 14px;
            }
            
            .calculate-btn {
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .result-placeholder img {
                max-width: 180px;
            }
            
            .rate-value {
                font-size: 36px;
            }
            
            .meter-labels span {
                font-size: 10px;
            }
            
            .note-card {
                padding: 15px 18px;
            }
            
            .note-card h3 {
                font-size: 16px;
            }
            
            .note-card p, .note-card li {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Exothermic Reaction Burn Severity Calculator</h1>
            <p>Estimate burn severity from heat-generating chemical reactions based on heat release rate and exposure parameters</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                
                <div class="form-group">
                    <label for="heatReleaseRate">Heat Release Rate (HRR) (kW/m²)</label>
                    <input type="number" id="heatReleaseRate" class="form-input" min="0" step="0.01" placeholder="e.g., 5.2">
                </div>
                
                <div class="form-group">
                    <label for="exposedArea">Exposed Skin Area (m²)</label>
                    <input type="number" id="exposedArea" class="form-input" min="0" step="0.001" placeholder="e.g., 0.05">
                </div>
                
                <div class="form-group">
                    <label for="criticalHeatFlux">Critical Heat Flux (Hc) (kW/m²)</label>
                    <input type="number" id="criticalHeatFlux" class="form-input" min="0" step="0.01" placeholder="e.g., 1.4" value="1.4">
                    <span class="hint">Typical Hc for skin: ~1.4 kW/m² (2nd degree burns)</span>
                </div>
                
                <button class="calculate-btn" onclick="calculateExothermicBurn()">Calculate Burn Severity</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Exothermic Reaction Burn Index (ERBI)</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Exothermic Reaction Burn Index</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">ERBI Score</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>Severe</span><span>Critical</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Burn Severity Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

<!-- Notes Section -->
<div class="note-section">

    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Exothermic Reaction Burn Severity Calculator</strong> estimates potential burn severity caused by 
            heat-generating chemical reactions such as acid-base neutralization, oxidation, or decomposition. 
            It computes the <strong>Exothermic Reaction Burn Index (ERBI)</strong> based on the heat release rate, 
            exposed skin area, and the critical heat flux of human skin.  
            This tool supports chemical safety evaluations, emergency preparedness, and industrial process safety assessments.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Heat Release Rate (HRR):</strong> Thermal energy released per unit area by the reaction (kW/m²)</li>
            <li><strong>Exposed Skin Area (A):</strong> Contact area between chemical and skin (m²)</li>
            <li><strong>Critical Heat Flux (Hc):</strong> Minimum heat flux that causes second-degree burns (~1.4 kW/m² for human skin)</li>
            <li><strong>ERBI (Exothermic Reaction Burn Index):</strong> Dimensionless indicator of burn severity calculated as (HRR × Area) / Hc</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Heat Release Rate (HRR):</strong> 0.01 – 1000 kW/m² (max 2 decimals)</li>
            <li><strong>Exposed Skin Area:</strong> 0.001 – 2.0 m² (max 3 decimals)</li>
            <li><strong>Critical Heat Flux (Hc):</strong> 0.5 – 5 kW/m² (max 2 decimals)</li>
            <li><strong>No Negative Values:</strong> All inputs must be positive.</li>
            <li><strong>Division by Zero:</strong> Hc cannot be zero.</li>
            <li><strong>Logical Limits:</strong> HRR × Area should not exceed realistic fire exposure levels. ERBI > 500 is flagged as “Beyond realistic workplace safety limits.”</li>
        </ul>
        <p><b>Note:</b> These limits align with <b>OSHA burn safety</b>, <b>NFPA 921 fire standards</b>, and <b>medical burn threshold studies</b>.</p>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations & Burn Severity Assessment</h3>
        <ul class="note-list">
            <li><span class="good">ERBI (Exothermic Reaction Burn Index) &lt; 1</span> → 🟢 <strong>LOW RISK</strong> – Below burn threshold, monitor for irritation.</li>
            <li><span class="average">1 ≤ ERBI (Exothermic Reaction Burn Index) ≤ 5</span> → 🟠 <strong>MODERATE RISK</strong> – Likely 2nd-degree burns, medical evaluation required.</li>
            <li><span class="bad">5 &lt; ERBI (Exothermic Reaction Burn Index) ≤ 10</span> → 🔴 <strong>SEVERE RISK</strong> – Deep tissue burns, urgent treatment needed.</li>
            <li><span class="critical">ERBI (Exothermic Reaction Burn Index) &gt; 10</span> → ☠️ <strong>CRITICAL</strong> – Catastrophic burns, immediate emergency response required.</li>
        </ul>
        <p>
            <strong>Output Feedback:</strong> The calculator provides the above assessments dynamically in the results panel 
            to help evaluate burn severity levels and necessary safety or medical responses.
        </p>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>⚖ Governing Principle</h3>
        <p>
            There is no single, standardized “Exothermic Reaction Burn Severity Calculator.” Instead, assessing the danger of 
            an exothermic reaction involves applying established chemical safety principles and standards. Evaluation depends on:
        </p>
        <ul class="note-list">
            <li>The specific chemical properties and concentration.</li>
            <li>The duration of exposure.</li>
            <li>The tissue or material affected.</li>
        </ul>
        <h3>Key Standards and Indices for Evaluating Chemical Burn Risks:</h3>
        <ul class="note-list">
            <li><strong>National Fire Protection Association (NFPA) 704:</strong>  
                Known as the “fire diamond,” it identifies chemical hazards through color-coded ratings:  
                <ul>
                    <li><b>Reactivity Rating (Yellow):</b> 0–4 scale for instability and reactivity.</li>
                    <li><b>Special Hazards (White):</b> Symbols like “OX” for oxidizer or “W” for water-reactive materials.</li>
                </ul>
            </li>
            <li><strong>Dow Fire and Explosion Index (F&EI):</strong>  
                Evaluates chemical process hazards using a “Material Factor” based on heat of combustion and chemical reactivity.</li>
            <li><strong>American Burn Association (ABA):</strong>  
                Provides medical guidelines for chemical burn treatment through the Advanced Burn Life Support (ABLS) framework.  
                Emphasizes irrigation over neutralization to avoid secondary exothermic reactions.</li>
            <li><strong>Occupational Safety and Health Administration (OSHA):</strong>  
                Enforces hazard communication and safe handling of chemicals, including exothermic and reactive substances.</li>
        </ul>
        <h3>What This Means for Burn Severity:</h3>
        <p>
            Unlike simple thermal burns, exothermic chemical burns depend on reaction kinetics, contact duration, and material properties.  
            Severity is evaluated based on tissue involvement, affected area, and chemical behavior.  
            Healthcare professionals use these parameters to classify burns (e.g., partial- or full-thickness) and define treatment urgency.
        </p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>🧩 Conclusion</h3>
        <p>
            The <strong>Exothermic Reaction Burn Severity Calculator</strong> bridges chemical engineering safety and burn science 
            to estimate injury severity from exothermic events.  
            It applies validated input ranges, standards-based interpretations, and dynamic output feedback to support safer 
            handling of reactive materials in laboratories, manufacturing, and industrial environments.
        </p>
        <p>
            Always treat results as guidance, not medical diagnosis — consult certified safety professionals and healthcare experts 
            for any real-life exposure incident.
        </p>
    </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateExothermicBurn() {
    const hrr = document.getElementById('heatReleaseRate').value.trim();
    const area = document.getElementById('exposedArea').value.trim();
    const hc = document.getElementById('criticalHeatFlux').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // Validation rules
    const inputs = [
        { name: "Heat Release Rate (HRR)", val: hrr, min: 0.01, max: 1000, decimals: 2, unit: "kW/m²" },
        { name: "Exposed Skin Area", val: area, min: 0.001, max: 2, decimals: 3, unit: "m²" },
        { name: "Critical Heat Flux (Hc)", val: hc, min: 0.5, max: 5, decimals: 2, unit: "kW/m²" }
    ];

    inputs.forEach(input => {
        if (input.val === "") {
            errors.push(`👉 Please enter ${input.name}.`);
        } else {
            const num = parseFloat(input.val);
            if (isNaN(num)) {
                errors.push(`👉 ${input.name} must be a number.`);
            } else if (num < input.min) {
                errors.push(`👉 ${input.name} must be at least ${input.min} ${input.unit}.`);
            } else if (num > input.max) {
                errors.push(`👉 ${input.name} must not exceed ${input.max} ${input.unit}.`);
            } else {
                // Decimal check
                const decimals = (input.val.split('.')[1] || "").length;
                if (decimals > input.decimals) {
                    errors.push(`👉 ${input.name} must have max ${input.decimals} decimal places.`);
                }
            }
        }
    });

    // Division by zero check
    if (parseFloat(hc) === 0) {
        errors.push("👉 Critical Heat Flux (Hc) cannot be zero.");
    }

    // Show errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Calculation
    const hrrVal = parseFloat(hrr);
    const areaVal = parseFloat(area);
    const hcVal = parseFloat(hc);

    const erbi = (hrrVal * areaVal) / hcVal;
    document.getElementById('rateValue').textContent = erbi.toFixed(2);

    // Performance Assessment
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (erbi < 1) {
        meterWidth = '15%';
        meterColor = '#27ae60';
        feedback = '🟢 LOW RISK – Below burn threshold, monitor for irritation.';
    } else if (erbi <= 5) {
        meterWidth = '40%';
        meterColor = '#f39c12';
        feedback = '🟠 MODERATE RISK – Likely 2nd-degree burns, medical eval required.';
    } else if (erbi <= 10) {
        meterWidth = '70%';
        meterColor = '#e67e22';
        feedback = '🔴 SEVERE RISK – Deep tissue burns, urgent treatment needed.';
    } else {
        meterWidth = '95%';
        meterColor = '#e74c3c';
        feedback = '☠️ CRITICAL – Catastrophic burns, immediate emergency response.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


{% comment %} 
1. Formula Used (for code comments)
/*
📘 Formula:
ERBI = (HRR × Exposed Area) / Critical Heat Flux

Where:
- HRR (Heat Release Rate): kW/m²
- Exposed Area: m²
- Hc (Critical Heat Flux): kW/m²
- ERBI (Exothermic Reaction Burn Index): dimensionless ratio

Interpretation:
- ERBI < 1 → Below threshold (low risk)
- 1 ≤ ERBI ≤ 5 → Moderate risk (2nd-degree burns likely)
- 5 < ERBI ≤ 10 → Severe risk
- ERBI > 10 → Critical, catastrophic burns
*/

2. Detailed Input Validation Rules

These are aligned with NFPA 921 (fire investigation), OSHA chemical burn guidance, ISO 45001 risk management, and burn injury research:

(a) Heat Release Rate (HRR)

Range: 0.01 – 1000 kW/m²

Decimals allowed: up to 2

Reason: HRR < 0.01 is negligible, >1000 is extreme/unrealistic for workplace chemical reactions (more like explosions).

(b) Exposed Skin Area

Range: 0.001 – 2.0 m²

Decimals allowed: up to 3

Reason: 0.001 m² = fingertip size; 2 m² ≈ whole upper body (max realistic unprotected skin exposure).

(c) Critical Heat Flux (Hc)

Range: 0.5 – 5 kW/m²

Decimals allowed: up to 2

Reason: Human skin threshold is ~1.4 kW/m² (2nd degree burns). Below 0.5 is biologically invalid; >5 is outside human tissue tolerance.

3. Output Validation & Thresholds

ERBI < 1 → Safe/sub-critical: below burn threshold, minor irritation possible.

ERBI 1–5 → Moderate risk: consistent with 2nd-degree burn thresholds.

ERBI 5–10 → Severe risk: major tissue damage.

ERBI > 10 → Critical: catastrophic burns, fatality potential.

These follow burn dose-response studies and OSHA emergency planning requirements. {% endcomment %}