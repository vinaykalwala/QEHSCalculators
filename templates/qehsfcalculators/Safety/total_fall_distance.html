{% extends 'base.html' %}
{% block title %}Total Fall Distance Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Total Fall Distance Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px; /* Fixed Height */
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px; /* Fixed Height */
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        .sub-results {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }

        .sub-result-item {
            text-align: center;
        }
        
        .sub-result-value {
            font-size: 20px;
            font-weight: 600;
            color: #34495e;
        }

        .sub-result-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        .note-flex-container {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }
        .note-text-content {
            flex: 1;
        }
        .note-image-content {
            flex-shrink: 0;
            width: 250px;
        }
        .note-image-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        @media (max-width: 800px) {
            .note-flex-container {
                flex-direction: column;
                align-items: center;
            }
        }


        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        .note-image-content {
            width: 100%;
            text-align: center;
            margin: 15px 0;
        }

        .note-image-content img {
            width: 100%;           /* Makes it responsive */
            max-width: 200px;      /* Restrict size on normal/large screens */
            height: auto;          /* Maintain aspect ratio */
            display: block;
            margin: 0 auto;
        }

        /* For smaller devices */
        @media (max-width: 768px) {
            .note-image-content img {
                max-width: 90%;    /* Allow it to scale down on small screens */
            }
        }

    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Total Fall Distance Calculator</h1>
            <p>Calculate the distance an object falls under gravity, accounting for initial downward velocity and the duration of the fall.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Fall Parameters</h2>
                <div class="form-group">
                    <label for="initialVelocity">Initial Velocity ($v_0$) [m/s]</label>
                    <input type="number" id="initialVelocity" class="form-input" placeholder="e.g., 0 for a simple drop">
                </div>
                <div class="form-group">
                    <label for="fallTime">Time of Fall (t) [seconds]</label>
                    <input type="number" id="fallTime" class="form-input" placeholder="e.g., 3.5">
                </div>
                <div class="form-group">
                    <label for="gravity">Gravity (g) [m/s²]</label>
                    <input type="number" id="gravity" class="form-input" value="9.81">
                </div>
                <button class="calculate-btn" onclick="calculateFallDistance()">Calculate Distance</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Physics free fall icon">
                    <p>Enter the fall parameters to calculate the total distance traveled by the object.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" id="rateLabel">Total Fall Distance (m)</div>
                    
                    <div class="sub-results">
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="distFromVel">0 m</div>
                            <div class="sub-result-label">from Velocity</div>
                        </div>
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="distFromGrav">0 m</div>
                            <div class="sub-result-label">from Gravity</div>
                        </div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Calculation Breakdown</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>About This Calculator</h3>
                <p>
                    This calculator determines how far an object falls based on its initial velocity, time of fall, and gravity.
                    It is useful for engineering, construction, sports, safety calculations, and ballistics.
                </p>
            </div>
        
            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Initial Velocity (v₀):</strong> The speed at which the object is thrown downward (m/s).</li>
                    <li><strong>Time of Fall (t):</strong> The duration the object has been falling (seconds).</li>
                    <li><strong>Gravity (g):</strong> The acceleration due to Earth's gravity (9.81 m/s²).</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>✅ Input Validations:</h3>
                <p>The calculator enforces strict input rules to ensure safe and accurate fall distance calculations:</p>
                <ul class="note-list">
                    <li>If <strong>Initial Velocity (v₀)</strong> is empty, not a number, or negative:<br>
                        <code>👉 Initial Velocity must be a number ≥ 0 m/s.</code>
                    </li>
                    <li>If <strong>Time of Fall (t)</strong> is empty, not a number, or negative:<br>
                        <code>👉 Time of Fall must be a number ≥ 0 seconds.</code>
                    </li>
                    <li>If <strong>Time of Fall (t)</strong> is unreasonably large (> 300 s):<br>
                        <code>👉 Time of Fall is unusually long (&gt;300 s). Verify input.</code>
                    </li>
                    <li>If <strong>Gravity (g)</strong> is empty, not a number, or ≤ 0:<br>
                        <code>👉 Gravity must be a positive number (>0 m/s²).</code>
                    </li>
                    <li>If <strong>Gravity (g)</strong> exceeds typical physical limits (> 20 m/s²):<br>
                        <code>👉 Gravity exceeds typical physical limits (&gt;20 m/s²). Verify input.</code>
                    </li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>📊 Output Validations:</h3>
                <p>Once inputs are valid, the calculator ensures results are meaningful:</p>
                <ul class="card-list">
                    <li>If the final result is not a valid number:<br>
                        <code>❌ Calculation resulted in an invalid number. Please check your inputs.</code>
                    </li>
                    <li>When valid, the <strong>Total Fall Distance</strong> is displayed with two decimal places, along with
                        distance contributions from velocity and gravity.</li>
                    <li>Based on the inputs, feedback is shown:
                        <ul class="note-list">
                            <li>If <strong>v₀ = 0</strong>: ✅ The object was <strong>dropped from rest</strong>. Over the time
                                specified, gravity alone caused the fall.</li>
                            <li>If <strong>v₀ &gt; 0</strong>: ✅ The object was thrown downward. Distance contribution from initial
                                velocity and gravity is clearly separated.</li>
                        </ul>
                    </li>
                </ul>
            </div>

        
            <div class="note-card">
                <h3>📏 Standards & Compliance</h3>
                <p>
                    This calculator uses standard kinematic equations consistent with classical mechanics.
                    It assumes negligible air resistance and constant gravity.
                </p>
                    <h3>Visual Representation</h3>
                    <div class="note-image-content">
                        <img src="{% static 'images/fallcal1.jpg' %}" alt="Diagram illustrating fall distance calculation"
                            onerror="this.style.display='none'">
                    </div>
            </div>
        
            <div class="note-card">
                <h3>Conclusion</h3>
                <p>
                    The fall distance calculator helps engineers, safety professionals, and sports analysts quickly estimate how
                    far an object falls under given conditions.
                    Accurate calculations improve safety, design decisions, and planning for free-fall scenarios.
                </p>
            </div>
        </div>
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if (document.getElementById('printDate')) {
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function calculateFallDistance() {
            const v0_val = document.getElementById('initialVelocity').value.trim();
            const t_val = document.getElementById('fallTime').value.trim();
            const g_val = document.getElementById('gravity').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // --- VALIDATION RULES ---
            const v0 = parseFloat(v0_val);
            const t = parseFloat(t_val);
            const g = parseFloat(g_val);

            if (v0_val === '' || isNaN(v0) || v0 < 0) errors.push("👉 Initial Velocity must be a number ≥ 0 m/s.");
            if (t_val === '' || isNaN(t) || t < 0) errors.push("👉 Time of Fall must be a number ≥ 0 seconds.");
            if (t > 300) errors.push("👉 Time of Fall is unusually long (>300 s). Verify input.");
            if (g_val === '' || isNaN(g) || g <= 0) errors.push("👉 Gravity must be a positive number (>0 m/s²).");
            if (g > 20) errors.push("👉 Gravity exceeds typical physical limits (>20 m/s²). Verify input.");

            // --- ERROR HANDLING ---
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // --- CALCULATION ---
            const distFromVel = v0 * t;
            const distFromGrav = 0.5 * g * t * t;
            const totalDistance = distFromVel + distFromGrav;

            if (!isFinite(totalDistance)) {
                errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your inputs.";
                errorBox.classList.remove("hidden");
                resultValue.classList.add("hidden");
                return;
            }

            // --- DISPLAY RESULTS ---
            document.getElementById('rateValue').textContent = totalDistance.toFixed(2);
            document.getElementById('distFromVel').textContent = distFromVel.toFixed(2) + ' m';
            document.getElementById('distFromGrav').textContent = distFromGrav.toFixed(2) + ' m';

            // --- BUILD FEEDBACK ---
            let feedback = '';
            if (v0 === 0) {
                feedback = `✅ The object was <strong>dropped from rest</strong>. Over <strong>${t} s</strong>, gravity alone caused it to fall <strong>${distFromGrav.toFixed(2)} meters</strong>.`;
            } else {
                feedback = `✅ The object was thrown downward at <strong>${v0} m/s</strong>. Initial velocity contributed <strong>${distFromVel.toFixed(2)} m</strong>, and gravity contributed <strong>${distFromGrav.toFixed(2)} m</strong>.`;
            }

            document.getElementById('feedbackContent').innerHTML = feedback;

            placeholder.classList.add("hidden");
            resultValue.classList.remove("hidden");
        }

        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            window.print();
        }
    </script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 
1️⃣ Input Validation Rules (Real-world QEHS Perspective)
Input	Rules / Acceptable Range	Rationale
Initial Velocity (v₀)	≥ 0 m/s (cannot be negative in free-fall simulation)	Negative velocity would imply upward motion, which is invalid for fall distance calculation.
Fall Time (t)	> 0 s and ≤ 300 s (or practical max for site conditions)	Time must be positive; extremely long times (>300s) are unrealistic in workplace incidents.
Gravity (g)	> 0 m/s² and ≤ 20 m/s²	Gravity must be positive; values above 20 m/s² are physically unrealistic for human-scale falls.
Numeric Check	All inputs must be numeric	Prevents accidental text input that could break calculations.
Units Consistency	v₀ in m/s, t in seconds, g in m/s²	Ensures outputs are accurate and comparable to safety standards.
2️⃣ Output Validation Logic & Threshold Explanations

Special Cases

If t <= 0: Total fall distance = 0 (object did not fall).

If g <= 0: Invalid gravity, cannot compute fall distance.

Calculation

Distance from initial velocity: d₁ = v₀ * t

Distance from gravity: d₂ = 0.5 * g * t²

Total distance: D = d₁ + d₂

Output Feedback

Break down contributions:

Dropped from rest → only gravity matters.

Thrown downward → both initial velocity and gravity matter.

Helps safety officers verify calculations for incident investigations.

3️⃣ Edge Case Validations
Edge Case	Handling
t = 0 or negative	Total distance = 0, with special note.
g = 0 or negative	Error message: “Gravity must be positive.”
Extremely large v₀ or t	Warn user: values exceed practical fall scenarios (optional).
Non-numeric input	Error message: “Please enter valid numbers.”
Floating-point precision issues	Round results to 2 decimal places.
-->