{% extends 'base.html' %}
{% block title %}Total Pump Delivery Head Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Total Pump Delivery Head Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        .sub-results {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eaeaea;
        }

        .sub-result-item {
            text-align: center;
        }
        
        .sub-result-value {
            font-size: 20px;
            font-weight: 600;
            color: #34495e;
        }

        .sub-result-label {
            font-size: 14px;
            color: #7f8c8d;
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Total Pump Delivery Head Calculator</h1>
            <p>Calculate the total energy a pump must impart to a fluid by summing the static, friction, and backpressure heads.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Head Components</h2>
                <div class="form-group">
                    <label for="staticHead">Static Head ($h_s$) [meters]</label>
                    <input type="number" id="staticHead" class="form-input" placeholder="e.g., 20">
                </div>
                <div class="form-group">
                    <label for="frictionHead">Friction Head ($h_f$) [meters]</label>
                    <input type="number" id="frictionHead" class="form-input" placeholder="e.g., 5.5">
                </div>
                <div class="form-group">
                    <label for="backpressureHead">Backpressure Head ($h_p$) [meters]</label>
                    <input type="number" id="backpressureHead" class="form-input" placeholder="e.g., 10">
                </div>
                <button class="calculate-btn" onclick="calculateTotalHead()">Calculate Total Head</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Pump system analysis illustration">
                    <p>Enter the different head components of your system to determine the total delivery head required for proper pump selection.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" id="rateLabel">Total Delivery Head (m)</div>
                    
                    <div class="sub-results">
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="staticHeadDisplay">0 m</div>
                            <div class="sub-result-label">Static Head</div>
                        </div>
                        <div class="sub-result-item">
                            <div class="sub-result-value" id="frictionHeadDisplay">0 m</div>
                            <div class="sub-result-label">Friction Head</div>
                        </div>
                         <div class="sub-result-item">
                            <div class="sub-result-value" id="backpressureHeadDisplay">0 m</div>
                            <div class="sub-result-label">Backpressure</div>
                        </div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Medium</span><span>High</span><span>Very High</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">System Requirement Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Total Delivery Head</strong> is the total equivalent height that a fluid is to be pumped, taking into account
            vertical lift, friction losses, and any opposing pressure.
            It represents the total energy that the pump must add to the fluid to move it from the source to the destination.
            Accurate calculation is critical for selecting the correct pump and ensuring system efficiency.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Static Head (h<sub>s</sub>):</strong> Vertical height the fluid is lifted, from source to pump delivery.</li>
            <li><strong>Friction Head (h<sub>f</sub>):</strong> Head lost due to friction in pipes and fittings.</li>
            <li><strong>Backpressure Head (h<sub>p</sub>):</strong> Head due to system pressure opposing the pump.</li>
            <li><strong>Formula:</strong> Total Delivery Head = h<sub>s</sub> + h<sub>f</sub> + h<sub>p</sub></li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📝 Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Static Head (h<sub>s</sub>):</strong> Must be a number ≥ 0. Typical range: 0–100 m. Warn if > 200 m.</li>
            <li><strong>Friction Head (h<sub>f</sub>):</strong> Must be a number ≥ 0. Typical range: 0–50 m. Warn if > 100 m.</li>
            <li><strong>Backpressure Head (h<sub>p</sub>):</strong> Must be a number ≥ 0. Typical range: 0–50 m. Warn if > 100 m.</li>
            <li><strong>Cross-field Checks:</strong> Total Delivery Head = h<sub>s</sub> + h<sub>f</sub> + h<sub>p</sub>. Must be finite and logical.</li>
            <li><strong>No zero, negative, or blank inputs:</strong> Prevents unrealistic pump calculations.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>Total Head = 0 → ⚠️ No flow or pressure in the system.</li>
            <li>Total Head &lt; 10 m → ✅ Low Head System: Suitable for small circulation loops or short-distance transfers.</li>
            <li>Total Head 10–50 m → 🟡 Medium Head System: Common in commercial buildings, municipal water supply, or moderate industrial applications.</li>
            <li>Total Head 50–100 m → ⚠️ High Head System: Requires robust, high-pressure pumps for industrial processes or high-rise buildings.</li>
            <li>Total Head ≥ 100 m → 🚨 Very High Head System: Specialist multi-stage or high-power pumps required. Safety factors critical.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            Total Pump Delivery Head, also known as Total Dynamic Head (TDH), is a concept defined by engineering principles and standards like those found in the Hydraulic Institute (now part of ASME) rather than a single, codified "standard" that dictates the calculation formula. 
            The calculation involves the sum of the static head (vertical distance), pressure head (system pressure), and friction head (pipe and fitting losses) using a universally applied formula such as the one used to calculate manometric head.
        </p>
        <ul class="note-list">
            <li><strong>Static Head:</strong> Vertical height from source to pump delivery point.</li>
            <li><strong>Static Suction Head:</strong> Vertical height from fluid source to pump centerline.</li>
            <li><strong>Static Delivery Head:</strong> Vertical height from pump centerline to delivery point.</li>
            <li><strong>Pressure Head:</strong> Pressure differential in the system (e.g., pumping into a pressurized tank).</li>
            <li><strong>Friction Head:</strong> Head lost due to friction against pipe walls and fittings throughout the system.</li>
            <li><strong>Standardized Formula:</strong> 
                H = (z<sub>2</sub>−z<sub>1</sub>) + (P<sub>2</sub>−P<sub>1</sub>)/ρg + (v<sub>2</sub>²−v<sub>1</sub>²)/2g + H<sub>f</sub>
            </li>
            <li><strong>Guidelines:</strong> Hydraulic Institute (ASME), pump manufacturers (Grundfos, Atlas Copco), ICC plumbing guides.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <p>
            Accurate calculation of <strong>Total Delivery Head</strong> ensures proper pump selection, system efficiency, and safety. 
            Monitoring TDH helps prevent pump damage, optimize energy usage, and maintain effective fluid transport across the system.
        </p>
    </div>
</div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
    });

    function calculateTotalHead() {
        const hs_val = document.getElementById('staticHead').value.trim();
        const hf_val = document.getElementById('frictionHead').value.trim();
        const hp_val = document.getElementById('backpressureHead').value.trim();

        const errorBox = document.getElementById('resultError');
        const errorMessage = document.getElementById('errorMessage');
        const placeholder = document.getElementById('placeholder');
        const resultValue = document.getElementById('resultValue');
        const meterFill = document.getElementById('meterFill');
        const feedbackContent = document.getElementById('feedbackContent');

        let errors = [];
        let warnings = [];

        // --- INPUT VALIDATION ---
        const hs = parseFloat(hs_val);
        const hf = parseFloat(hf_val);
        const hp = parseFloat(hp_val);

        if (hs_val === '' || isNaN(hs) || hs < 0) errors.push("👉 Static Head (hₛ) must be a number ≥ 0.");
        if (hf_val === '' || isNaN(hf) || hf < 0) errors.push("👉 Friction Head (h𝒻) must be a number ≥ 0.");
        if (hp_val === '' || isNaN(hp) || hp < 0) errors.push("👉 Backpressure Head (hₚ) must be a number ≥ 0.");

        // Warnings for unusually high values
        if (hs > 200) warnings.push("⚠️ Static Head (hₛ) is unusually high. Ensure your system can handle this elevation.");
        if (hf > 100) warnings.push("⚠️ Friction Head (h𝒻) is unusually high. Check pipe length, diameter, and flow conditions.");
        if (hp > 100) warnings.push("⚠️ Backpressure Head (hₚ) is unusually high. Verify pump and system design.");

        // --- ERROR HANDLING ---
        if (errors.length > 0) {
            errorMessage.innerHTML = errors.join("<br>");
            errorBox.classList.remove("hidden");
            placeholder.classList.add("hidden");
            resultValue.classList.add("hidden");
            return;
        } else {
            errorBox.classList.add("hidden");
        }

        // --- WARNING HANDLING ---
        const warningBox = document.getElementById('resultWarning');
        const warningMessage = document.getElementById('warningMessage');
        if (warnings.length > 0) {
            warningMessage.innerHTML = warnings.join("<br>");
            warningBox.classList.remove("hidden");
        } else {
            warningBox.classList.add("hidden");
        }

        // --- CALCULATION ---
        const totalHead = hs + hf + hp;
        if (!isFinite(totalHead)) {
            errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your inputs.";
            errorBox.classList.remove("hidden");
            resultValue.classList.add("hidden");
            return;
        }

        document.getElementById('rateValue').textContent = totalHead.toFixed(2);
        document.getElementById('staticHeadDisplay').textContent = hs.toFixed(2) + ' m';
        document.getElementById('frictionHeadDisplay').textContent = hf.toFixed(2) + ' m';
        document.getElementById('backpressureHeadDisplay').textContent = hp.toFixed(2) + ' m';

        // --- PERFORMANCE / SAFETY ASSESSMENT ---
        let meterWidth, meterColor, feedback;
        if (totalHead === 0) {
            meterWidth = '0%';
            meterColor = '#95a5a6'; // gray
            feedback = "⚠️ No flow or pressure in the system.";
        } else if (totalHead < 10) {
            meterWidth = '20%';
            meterColor = '#2ecc71'; // Green
            feedback = "✅ Low Head System: Suitable for small circulation loops or short-distance transfers.";
        } else if (totalHead >= 10 && totalHead <= 50) {
            meterWidth = '45%';
            meterColor = '#f1c40f'; // Yellow
            feedback = "🟡 Medium Head System: Common in commercial buildings, municipal water supply, or moderate industrial applications.";
        } else if (totalHead > 50 && totalHead <= 100) {
            meterWidth = '70%';
            meterColor = '#e67e22'; // Orange
            feedback = "⚠️ High Head System: Requires robust, high-pressure pumps for industrial processes or high-rise buildings.";
        } else { // >=100
            meterWidth = '95%';
            meterColor = '#e74c3c'; // Red
            feedback = "🚨 Very High Head System: Specialist multi-stage or high-power pumps required. Safety factors critical.";
        }

        meterFill.style.width = meterWidth;
        meterFill.style.backgroundColor = meterColor;
        feedbackContent.innerHTML = feedback;

        placeholder.classList.add("hidden");
        resultValue.classList.remove("hidden");
    }

    function printReport() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        window.print();
    }
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 
1️⃣ Detailed Input Validation Rules

Inputs:

Static Head ($h_s$) [m]:

Must be ≥ 0

Typical industrial range: 0 – 100 m

Allows decimals up to 2 places

Friction Head ($h_f$) [m]:

Must be ≥ 0

Typical range: 0 – 50 m

Allows decimals up to 2 places

Backpressure Head ($h_p$) [m]:

Must be ≥ 0

Typical range: 0 – 50 m

Allows decimals up to 2 places

Cross-field considerations:

Total Head = $h_s + h_f + h_p$ should be logical and non-negative.

If any input is unreasonably high (e.g., > 1000 m), display a warning.

Edge Case Validations:

Non-numeric or blank inputs → error.

Negative values → error.

Extremely high total head → warning for safety/pump rating check.

Total head = 0 → warning that system has no driving pressure.

2️⃣ Output Validation Logic & Thresholds
Total Head (m)	Meter Fill / Label	Feedback (as in script)
0	0% / Low	⚠️ The total head is zero. This means there is no pressure or flow in the system.
0 < totalHead ≤ 10	20% / Low	✅ Low total head: Suitable for short-distance fluid transport with minimal resistance.
10 < totalHead ≤ 50	50% / Medium	🛠️ Moderate total head: Suitable for medium-range pumping systems with some friction loss.
50 < totalHead ≤ 100	75% / High	⚡ High total head: Common for industrial pumps handling high elevations or pipe friction.
> 100	95% / Very High	🚨 Very high total head: Ensure your pump is rated for this pressure to avoid system damage!

✅ All outputs must display numeric values with 2 decimal places.
-->