{% extends 'base.html' %}
{% block title %}Curtain Area of Safety Valve Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curtain Area of Safety Valve Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 520px;
            {% comment %} overflow-y: auto; {% endcomment %}
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .result-details {
            text-align: left;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .result-details p {
            margin: 8px 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Curtain Area of Safety Valve Calculator</h1>
            <p>Calculate the curtain area of a safety valve based on minimum opening diameter and maximum lift</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="diameter">Minimum Opening Diameter (d‚ÇÅ) (mm)</label>
                    <input type="number" id="diameter" class="form-input" min="0" placeholder="e.g., 50">
                </div>
                <div class="form-group">
                    <label for="lift">Maximum Lift (L) (mm)</label>
                    <input type="number" id="lift" class="form-input" min="0" placeholder="e.g., 20">
                </div>
                <div class="form-group">
                    <label for="piValue">Pi (œÄ)</label>
                    <input type="text" id="piValue" class="form-input" value="3.1416" readonly>
                </div>
                
                <button class="calculate-btn" onclick="calculateCurtainArea()">Calculate Curtain Area</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Curtain Area of a Safety Valve</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Curtain Area Results</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="areaValue">0.00</div>
                        <div class="rate-label" id="areaLabel" style="color:#2980b9; font-size:20px; font-weight:bold; ">mm¬≤</div>
                    </div>

                    <div class="result-details">
                        <p><strong>Minimum Opening Diameter (d‚ÇÅ):</strong> <span id="resultDiameter">0</span> mm</p>
                        <p><strong>Maximum Lift (L):</strong> <span id="resultLift">0</span> mm</p>
                        <p><strong>Pi (œÄ):</strong> 3.1416</p>
                        <p><strong>Curtain Area (m¬≤):</strong> <span id="areaM2">0.000000</span> m¬≤</p>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Curtain Area of Safety Valve Calculator</strong> helps determine the effective flow area through a safety valve. This area is crucial for calculating the valve's discharge capacity, ensuring it can adequately relieve excess pressure in a system like a boiler or pressure vessel.
                </p>
            </div>
            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Minimum Opening Diameter (d‚ÇÅ):</strong> The inner diameter of the valve seat, representing the narrowest point of the flow path when the valve is closed (measured in mm).</li>
                    <li><strong>Maximum Lift (L):</strong> The maximum vertical distance the valve disc travels from its closed position on the seat when activated (measured in mm).</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Minimum Opening Diameter (d‚ÇÅ):</strong> Must be a positive number between 1 mm and 1000 mm.</li>
                    <li><strong>Maximum Lift (L):</strong> Must be a positive number between 0.1 mm and 100 mm.</li>
                     <li><strong>Cross-Validation:</strong> A warning is triggered if the lift (L) is greater than one-quarter of the diameter (d‚ÇÅ/4), as this may indicate an unusually high lift for the valve size. Always verify with manufacturer specifications.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>Output Validations</h3>
                 <p>Based on the calculated curtain area, the system provides the following feedback:</p>
                <ul class="note-list">
                    <li><span class="average">‚ö†Ô∏è Very Small Curtain Area: Ensure valve capacity matches system requirements.</span> (For areas < 100 mm¬≤)</li>
                    <li><span class="good">‚úÖ Standard Curtain Area: Within typical design range.</span> (For areas between 100 mm¬≤ and 5000 mm¬≤)</li>
                    <li><span class="bad">‚ùå Large Curtain Area: Check system sizing and compliance.</span> (For areas > 5000 mm¬≤)</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>Governing Principle</h3>
                <p>A curtain area calculator for a safety valve does not strictly adhere to a single standard, but rather uses principles found in various international standards such as the <strong>API 520 series</strong>, the <strong>ISO 4126 series</strong>, and various <strong>ASME codes</strong> (like Section VIII). These standards provide guidelines for the calculation and sizing of pressure relief devices, with the curtain area being a critical parameter in determining the required discharge capacity and overall valve sizing to ensure effective pressure relief.</p>
                <p><strong>Key Standards Involved:</strong></p>
                <ul class="note-list">
                    <li><strong>API 520 (American Petroleum Institute):</strong> This standard outlines the sizing, selection, and installation of pressure-relieving devices, and its principles are often integrated into calculator methodologies.</li>
                    <li><strong>ISO 4126 (International Organization for Standardization):</strong> This series of standards provides general requirements for safety devices for protection against excessive pressure, including details for various safety valve types and sizing calculations.</li>
                    <li><strong>ASME (American Society of Mechanical Engineers) Boiler and Pressure Vessel Code:</strong> Codes such as ASME Section VIII provide detailed guidelines for the design and operation of safety valves in pressure vessels, influencing how calculations like curtain area are performed.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>Conclusion</h3>
                <p>
                    Calculating the curtain area is a fundamental step in safety valve engineering. It ensures that the selected valve has sufficient capacity to protect equipment and personnel from overpressure events. This calculator simplifies the process, but the results should always be used in conjunction with comprehensive engineering analysis and adherence to relevant industry codes and standards like API, ASME, and ISO.
                </p>
            </div>
        </div>

    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateCurtainArea() {
            const diameterInput = document.getElementById('diameter').value.trim();
            const liftInput = document.getElementById('lift').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // Validate diameter
            if (diameterInput === "") {
                errors.push("üëâ Please enter the minimum opening diameter (d‚ÇÅ).");
            } else {
                const d = parseFloat(diameterInput);
                if (isNaN(d) || d <= 0) {
                    errors.push("üëâ Diameter must be a number greater than 0.");
                } else if (d < 1 || d > 1000) {
                    errors.push("üëâ Diameter must be between 1 mm and 1000 mm.");
                }
            }

            // Validate lift
            if (liftInput === "") {
                errors.push("üëâ Please enter the maximum lift (L).");
            } else {
                const l = parseFloat(liftInput);
                if (isNaN(l) || l <= 0) {
                    errors.push("üëâ Lift must be a number greater than 0.");
                } else if (l < 0.1 || l > 100) {
                    errors.push("üëâ Lift must be between 0.1 mm and 100 mm.");
                }
            }

            // Cross-field validation
            if (errors.length === 0) {
                const d = parseFloat(diameterInput);
                const l = parseFloat(liftInput);
                if (l > d / 4) {
                   errors.push("‚ö†Ô∏è The lift value is unusually high compared to the valve opening size. Please confirm this with the valve specifications.");
                }
            }

            // If errors, show them
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // Perform calculation
            const d = parseFloat(diameterInput);
            const l = parseFloat(liftInput);
            const pi = 3.1416;

            const curtainAreaSqMm = pi * d * l;
            const curtainAreaSqM = curtainAreaSqMm / 1000000;

            // Display results
            document.getElementById('areaValue').textContent = curtainAreaSqMm.toFixed(2);
            document.getElementById('resultDiameter').textContent = d.toFixed(2);
            document.getElementById('resultLift').textContent = l.toFixed(2);
            document.getElementById('areaM2').textContent = curtainAreaSqM.toFixed(6);

            // Feedback logic
            let feedbackMessage = "";
            let feedbackClass = "";
            
            if (curtainAreaSqMm < 100) {
                feedbackMessage = "‚ö†Ô∏è Very Small Curtain Area: Ensure valve capacity matches system requirements.";
                feedbackClass = "average";
            } else if (curtainAreaSqMm >= 100 && curtainAreaSqMm <= 5000) {
                feedbackMessage = "‚úÖ Standard Curtain Area: Within typical design range.";
                feedbackClass = "good";
            } else {
                feedbackMessage = "‚ùå Large Curtain Area: Check system sizing and compliance.";
                feedbackClass = "bad";
            }

            document.getElementById('feedbackContent').innerHTML = `<span class="${feedbackClass}">${feedbackMessage}</span>`;

            // Show results
            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}



<!-- 
{% comment %} 
1Ô∏è‚É£ Input Validation Rules (Industry-Backed)

For Curtain Area of Safety Valve:
Formula = œÄ √ó d‚ÇÅ √ó L
where:

d‚ÇÅ = Minimum Opening Diameter (mm)

L = Maximum Lift (mm)

‚úÖ Diameter (d‚ÇÅ):

Unit: millimeters (mm)

Allowed Range: 1 mm ‚Äì 1000 mm

Less than 1 mm ‚Üí physically unrealistic

More than 1000 mm ‚Üí exceeds practical design for safety valves per ASME/API sizing guides

Decimals: up to 2 decimal places

‚úÖ Lift (L):

Unit: millimeters (mm)

Allowed Range: 0.1 mm ‚Äì 100 mm

Less than 0.1 mm ‚Üí not practically measurable

More than 100 mm ‚Üí unrealistic in commercial/industrial safety valves

Decimals: up to 2 decimal places

‚úÖ Cross-field checks:

Lift cannot exceed 25% of diameter (as per API 526 typical valve geometry)

If L > d‚ÇÅ/4, show warning: ‚ÄúLift unusually high relative to diameter ‚Äî verify manufacturer‚Äôs data.‚Äù

‚úÖ Logical Consistency:

No negative or zero values

Both fields required

2Ô∏è‚É£ Output Validation & Thresholds

Curtain Area (mm¬≤) must be > 0.

Convert to m¬≤ with 6 decimal precision.

Threshold feedback (based on API and ISO valve sizing ranges observed in practice):

< 100 mm¬≤ ‚Üí Very small area, likely for low-capacity applications

100 ‚Äì 5000 mm¬≤ ‚Üí Standard range for typical valves

> 5000 mm¬≤ ‚Üí Large curtain area, ensure matches system sizing requirements

These thresholds help in real audits: they show if the valve size is consistent with expected system capacity. {% endcomment %} -->