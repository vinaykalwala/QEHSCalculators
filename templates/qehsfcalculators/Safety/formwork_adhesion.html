{% extends 'base.html' %}
{% block title %}Formwork Adhesion Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formwork Adhesion Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        /* Input rows for side-by-side fields */
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
            {% comment %} margin-top: 20px; {% endcomment %}
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .error {
            color: #e74c3c;
            font-size: 14px;
            {% comment %} margin-top: 5px; {% endcomment %}
            display: block;
        }
        
        .success {
            color: #27ae60;
            font-size: 16px;
            margin-top: 15px;
            font-weight: 500;
        }

        .select-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
}

.form-select {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    appearance: none;            /* removes default arrow */
    -webkit-appearance: none;    /* for Safari */
    -moz-appearance: none;       /* for Firefox */
    background: #fff;
    font-size: 1rem;
    cursor: pointer;
}

/* Custom dropdown arrow */
.select-wrapper::after {
    content: "▼";   /* Unicode arrow */
    font-size: 0.9rem;
    color: #1560bd;
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none; /* lets clicks pass through */
}

    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Formwork Adhesion Calculator</h1>
            <p>Calculate the adhesion force between concrete and formwork materials</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                
                <div class="form-group">
                    <label for="area">Area of Contact (A) in m<sup>2</sup></label>
                    <input type="number" id="area" class="form-input" min="0" step="0.01" placeholder="e.g., 10.5">
                </div>
                
                <div class="form-group">
                    <label for="factor">Formwork Adhesion Factor (q) in kN/m<sup>2</sup></label>
                    <div class="select-wrapper">
                    <select id="factor" class="form-select">
                        <option value="">Select Material</option>
                        <option value="1">Oiled Steel Mould (1 kN/m²)</option>
                        <option value="2">Varnished Timber Mould (2 kN/m²)</option>
                        <option value="3">Rough Timber Mould (3 kN/m²)</option>
                    </select>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateAdhesion()">Calculate Adhesion</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/679/679922.png" 
     alt="Concrete formwork adhesion illustration">

                    <p>This tool will calculate the <strong>Formwork Adhesion (Ha)</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Formwork Adhesion</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">kN</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    <strong>Formwork Adhesion (Ha)</strong> refers to the resistance encountered between the concrete unit and the mould during the lifting process. This force must be accurately calculated to ensure safe and efficient lifting of precast concrete elements.
                </p>
            </div>

            <div class="note-card">
                <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>A:</strong> Area of contact between the mould and the concrete (m²)</li>
                    <li><strong>q:</strong> Formwork adhesion factor, varying based on the type of mould material</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>📊 Explanation of Adhesion Factors</h3>
                <p>
                    Different mould materials exhibit different levels of adhesion due to surface texture and treatment:
                </p>
                <ul class="note-list">
                    <li><strong>Oiled Steel Mould:</strong> 1 kN/m² - Lowest adhesion due to smooth, lubricated surface</li>
                    <li><strong>Varnished Timber Mould:</strong> 2 kN/m² - Moderate adhesion with treated wood surface</li>
                    <li><strong>Rough Timber Mould:</strong> 3 kN/m² - Highest adhesion with untreated, rough wood surface</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>📈 Special Cases</h3>
                <p>
                    For certain precast elements, the formwork adhesion can be greater due to the structural complexity. In such cases, an estimated value is derived by multiplying the weight (G) of the precast element by a specific factor:
                </p>
                <ul class="note-list">
                    <li><strong>Ha = 2 × G</strong> (for double-T slabs)</li>
                    <li><strong>Ha = 3 × G</strong> (for ribbed elements)</li>
                    <li><strong>Ha = 4 × G</strong> (for coffered elements)</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>🔍 Real-Life Applications</h3>
                <p>
                    The formwork adhesion calculation is crucial for:
                </p>
                <ul class="note-list">
                    <li><strong>Construction Industry:</strong> Ensures safe lifting of large concrete slabs, beams, and precast elements</li>
                    <li><strong>Engineering Analysis:</strong> Helps in assessing structural stability and lifting equipment capacity</li>
                    <li><strong>Project Management:</strong> Facilitates accurate estimation of lifting forces, optimizing crane and lifting device usage</li>
                </ul>
            </div>

            <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Area of Contact (A):</strong> Must be between 0.01 and 500 m², positive, decimals up to 2 places</li>
        <li><strong>Formwork Adhesion Factor (q):</strong> Must be selected from [1, 2, 3] kN/m² only</li>
        <li><strong>Cross-checks:</strong> Very small area with high factor may be unrealistic → flagged</li>
        <li><strong>Adhesion Force (Ha):</strong> If Ha > 10,000 kN, flagged as out-of-scope</li>
        <li><strong>No negative/empty values:</strong> Inputs must be valid and logical</li>
    </ul>
    <p><b>Note:</b> These rules align with <strong>ISO 45001 safe lifting</strong>, <strong>OSHA 1926.701 formwork safety</strong>, and <strong>NFPA construction handling</strong> standards.</p>
</div>

        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateAdhesion() {
    const area = document.getElementById('area').value.trim();
    const factor = document.getElementById('factor').value;

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    // Validate Area
    if (area === "") {
        errors.push("👉 Please enter the area of contact.");
    } else {
        const areaNum = parseFloat(area);
        if (isNaN(areaNum)) {
            errors.push("👉 Area must be a valid number.");
        } else if (areaNum <= 0) {
            errors.push("👉 Area must be greater than 0.");
        } else if (areaNum < 0.01) {
            errors.push("👉 Area is unrealistically small (<0.01 m²).");
        } else if (areaNum > 500) {
            errors.push("👉 Area exceeds typical limits (>500 m²). Please verify.");
        }
    }

    // Validate Factor
    if (factor === "") {
        errors.push("👉 Please select a formwork adhesion factor.");
    } else if (![1, 2, 3].includes(parseInt(factor))) {
        errors.push("👉 Invalid factor. Please select a valid option.");
    }

    // Show errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Perform calculation
    const areaNum = parseFloat(area);
    const factorNum = parseFloat(factor);
    const adhesion = areaNum * factorNum;

    // Edge case checks
    if (areaNum < 0.1 && factorNum === 3) {
        alert("⚠️ Warning: Very small area with high adhesion factor may be unrealistic. Please verify inputs.");
    }
    if (adhesion > 10000) {
        alert("⚠️ Warning: Adhesion force exceeds 10,000 kN. Out of normal safe lifting range.");
    }

    document.getElementById('rateValue').textContent = adhesion.toFixed(2);

    // Feedback messages
    let feedback = '';
    if (adhesion < 10) {
        feedback = 'Low adhesion force. Verify input values for accuracy.';
    } else if (adhesion < 50) {
        feedback = 'Moderate adhesion force. Standard lifting equipment should be sufficient.';
    } else if (adhesion < 100) {
        feedback = 'High adhesion force. Consider using specialized equipment.';
    } else {
        feedback = 'Very high adhesion force. Requires careful planning and heavy-duty equipment.';
    }

    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}



{% comment %} 
1. Formula Used

The calculator applies:

𝐻
𝑎
=
𝐴
×
𝑞
Ha=A×q

Where:

Ha = Formwork adhesion force (kN)

A = Contact area (m²)

q = Formwork adhesion factor (kN/m²)

📌 Special case (from your notes): For some precast elements, adhesion is estimated as:

Ha = 2 × G (double-T slabs)

Ha = 3 × G (ribbed elements)

Ha = 4 × G (coffered elements)

2. Input Validation Rules (QEHS/Fire Safety Aligned)
Area of Contact (A in m²)

Must be > 0 (no zero/negative values).

Minimum realistic value: 0.01 m² (small panel).

Maximum practical value: ~500 m² (very large slab). Anything higher should trigger a warning.

Allowed decimals: up to 2 places (precision required but not excessive).

Formwork Adhesion Factor (q in kN/m²)

Must be chosen only from dropdown (no manual input).

Accepted values: 1, 2, or 3 kN/m² (industry standards per material).

Must not be left blank.

Cross-field validation

If A is very small (<0.1 m²) AND q = 3, flag as “possible unrealistic input — check dimensions”.

Adhesion force must not exceed 10,000 kN without special justification (extreme outlier check).

3. Output Validation and Thresholds

After calculating Ha:

Ha < 10 kN: Very low force → Likely an input error or very small element.

10 ≤ Ha < 50 kN: Moderate → Safe for standard lifting gear.

50 ≤ Ha < 100 kN: High → Review lifting plan, use specialized equipment.

≥ 100 kN: Very high → Requires detailed lifting analysis, risk assessment, and heavy-duty gear.

📌 These thresholds align with ISO 45001 safe lifting practices and NFPA material handling safety guidelines.

4. Edge Case Handling

Empty input → Error.

Zero or negative area → Reject.

Non-numeric entry → Reject.

Factor not selected → Reject.

Extreme outputs (Ha > 10,000 kN) → Warn user, mark as “out of scope”.

Tiny outputs (<1 kN) → Suggest double-checking.

5. Corrected JavaScript Validation Code

Here’s your calculateAdhesion() function rewritten with QEHS-compliant validation and inline comments:

/* 
 FORMULA:
 Ha = A × q
 - A = Contact area (m²), must be >0
 - q = Adhesion factor (kN/m²), chosen from dropdown [1,2,3]
 - Ha in kN

 VALIDATION RULES:
 - Area (A): 0.01 ≤ A ≤ 500 (realistic construction range), 2 decimals max
 - Factor (q): must be 1, 2, or 3 only
 - Cross-check: If A < 0.1 with q=3, flag as unrealistic
 - Output (Ha): Ha ≤ 10,000 kN, else warn
 - No empty, zero, negative, or non-numeric inputs
*/ {% endcomment %}