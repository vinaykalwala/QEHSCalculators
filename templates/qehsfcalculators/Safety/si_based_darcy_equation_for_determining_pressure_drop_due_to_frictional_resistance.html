{% extends 'base.html' %}
{% block title %}SI-based D'Arcy Equation For Determining Pressure Drop{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SI-based D'Arcy Equation For Determining Pressure Drop</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        /* Input rows for side-by-side fields */
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
       
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>'SI based D'Arcy Equation For Determining Pressure Drop Due To Frictional Resistance Calculator</h1>
            <p>Calculate head loss due to frictional resistance in pipelines</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="f">Friction Factor (f)</label>
                        <input type="number" id="f" class="form-input" min="0" step="0.001" placeholder="e.g., 0.02">
                    </div>
                    <div class="form-group">
                        <label for="L">Length (L) (m)</label>
                        <input type="number" id="L" class="form-input" min="0" step="0.1" placeholder="e.g., 100">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="u">Flow Velocity (u) (m/s)</label>
                        <input type="number" id="u" class="form-input" min="0" step="0.1" placeholder="e.g., 2.5">
                    </div>
                    <div class="form-group">
                        <label for="D">Pipe Diameter (D) (m)</label>
                        <input type="number" id="D" class="form-input" min="0" step="0.01" placeholder="e.g., 0.15">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateDarcy()">Calculate Head Loss</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Head Loss</strong> due to friction in pipelines. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Head Loss Due to Friction</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Head Loss (m)</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low</span><span>Moderate</span><span>High</span><span>Very High</span><span>Extreme</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <!-- About -->
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>SI-based D'Arcy Equation Calculator</strong> determines the head loss due to frictional resistance in pipelines. 
                    This calculation is essential for designing efficient fluid systems, ensuring proper pressure management, 
                    and optimizing energy consumption in various industrial applications.
                </p>
            </div>

            <!-- Parameters Used -->
            <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>f (Friction Factor):</strong> Dimensionless factor depending on pipe roughness and flow type (0.001–0.1).</li>
                    <li><strong>L (Length):</strong> Length of the pipe in meters (m).</li>
                    <li><strong>u (Flow Velocity):</strong> Velocity of the fluid in meters per second (m/s).</li>
                    <li><strong>D (Pipe Diameter):</strong> Internal diameter of the pipe in meters (m).</li>
                    <li><strong>g (Gravity):</strong> Acceleration due to gravity (9.81 m/s²).</li>
                </ul>
            </div>

           <!-- Input Validation Rules -->
<div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Friction Factor (f):</strong> must be <strong>> 0</strong> (typical: <strong>0.001–0.1</strong>).</li>
        <li><strong>Length (L):</strong> must be <strong>> 0</strong> (typical: <strong>1–10,000 m</strong>).</li>
        <li><strong>Flow Velocity (u):</strong> must be <strong>> 0</strong> (typical: <strong>0.1–10 m/s</strong>).</li>
        <li><strong>Pipe Diameter (D):</strong> must be <strong>> 0</strong> (typical: <strong>0.01–2 m</strong>).</li>
        <li><strong>All values:</strong> must be <strong>positive numbers only</strong>.</li>
        <li><strong>Precision:</strong> decimals allowed up to <strong>3 places</strong> for accuracy.</li>
    </ul>
</div>
<div class="note-card">
  <h3>📊 Output Validations</h3>
  <ul class="note-list">
    <li><strong>headLoss &lt; 1 m:</strong> ✅ <strong>Low Head Loss</strong> — System is efficient with minimal resistance.</li>
    <li><strong>1 m ≤ headLoss ≤ 5 m:</strong> 🟢 <strong>Moderate Head Loss</strong> — Acceptable range for most industrial applications.</li>
    <li><strong>5 m &lt; headLoss ≤ 15 m:</strong> 🟠 <strong>High Head Loss</strong> — Consider optimizing pipe size, fittings, or flow rate.</li>
    <li><strong>15 m &lt; headLoss ≤ 30 m:</strong> 🔴 <strong>Very High Head Loss</strong> — System redesign or efficiency improvement recommended.</li>
    <li><strong>headLoss &gt; 30 m:</strong> 🚨 <strong>Extreme Head Loss</strong> — Unsafe or inefficient. Immediate engineering review required.</li>
  </ul>
</div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A "SI based Darcy Equation for Determining Pressure Drop Due to Frictional Resistance Calculator" relies on the principles of the Darcy-Weisbach Equation, a widely accepted standard in hydraulic engineering for calculating pipe friction losses, rather than a specific "standard" like ISO or ASME, although these standards may reference its use for specific applications. The equation, also known as the Darcy-Weisbach Formula, was developed by Henry Darcy and Julius Weisbach and is the most accurate method for determining pressure or head loss due to friction in a pipe.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Key Characteristics</h3>
    <ul class="note-list">
        <li><b>Empirical Standard:</b> The Darcy-Weisbach equation is an empirical (based on observation) relationship, not a formal written standard from a body like ASME or ISO.</li>
        <li><b>Hydraulic Engineering Standard:</b> It's the accepted standard equation for hydraulic engineers, especially for turbulent flow conditions, as computers have made its calculations easier.</li>
        <li><b>SI Units:</b> A "SI based" calculator implies it uses International System of Units (SI) for measurements.</li>
        <li><b>Fluid Mechanics Standard:</b> It is a fundamental tool in fluid mechanics for calculating friction losses and pressure drops in pipelines.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">How it Works</h3>
    <p>
        The Darcy-Weisbach equation is:
    </p>
    <p>
        h<sub>f</sub> = f (L/D) (v²/2g)
    </p>
    <p>
        Where:<br>
        h<sub>f</sub> = Head loss due to friction (meters)<br>
        f = Darcy friction factor<br>
        L = Length of the pipe (meters)<br>
        D = Inner diameter of the pipe (meters)<br>
        v = Average velocity of the fluid (m/s)<br>
        g = Acceleration due to gravity (m/s²)
    </p>
</div>




            <!-- Conclusion -->
            <div class="note-card">
                <h3>🎯 Conclusion</h3>
                <p>
                    Proper calculation of head loss is vital for designing safe and efficient fluid systems. 
                    Understanding frictional resistance helps engineers optimize pipeline performance, 
                    reduce energy consumption, and ensure system reliability across various applications 
                    including water supply, industrial processes, and fire safety systems.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateDarcy() {
    const f = parseFloat(document.getElementById('f').value.trim());
    const L = parseFloat(document.getElementById('L').value.trim());
    const u = parseFloat(document.getElementById('u').value.trim());
    const D = parseFloat(document.getElementById('D').value.trim());
    const g = 9.81;

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];
    let warnings = [];

    // Input checks
    if (isNaN(f) || f <= 0) errors.push("👉 Friction Factor must be > 0.");
    if (isNaN(L) || L <= 0) errors.push("👉 Pipe Length must be > 0.");
    if (isNaN(u) || u <= 0) errors.push("👉 Flow Velocity must be > 0.");
    if (isNaN(D) || D <= 0) errors.push("👉 Pipe Diameter must be > 0.");
    if (D === 0) errors.push("👉 Pipe Diameter cannot be zero (division by zero).");

    // Warnings based on typical ranges
    if (f < 0.001 || f > 0.1) warnings.push("⚠️ Friction Factor outside 0.001–0.1.");
    if (L > 10000) warnings.push("⚠️ Pipe length > 10,000 m. Check design.");
    if (u < 0.1 || u > 10) warnings.push("⚠️ Flow velocity outside 0.1–10 m/s.");
    if (D < 0.01 || D > 2) warnings.push("⚠️ Pipe diameter outside 0.01–2 m.");

    // Cross-field consistency checks
    if (u > 8 && D < 0.05) warnings.push("⚠️ High velocity in very small pipe may cause cavitation/erosion.");
    if (L > 5000 && D < 0.1) warnings.push("⚠️ Long, narrow pipe may cause excessive head loss.");

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Perform calculation
    const headLoss = (4 * f * L * Math.pow(u, 2)) / (2 * g * D);

    if (!isFinite(headLoss) || isNaN(headLoss)) {
        errorMessage.innerHTML = "👉 Calculation error: check inputs.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    if (headLoss < 0.1 || headLoss > 50) {
        warnings.push("⚠️ Head loss outside 0.1–50 m. Engineering review recommended.");
    }

    document.getElementById('rateValue').textContent = headLoss.toFixed(3);

    // Feedback + Meter
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (headLoss < 1) {
        meterWidth = '20%'; meterColor = '#2ecc71';
        feedback = 'Low head loss. System is efficient with minimal resistance.';
    } else if (headLoss <= 5) {
        meterWidth = '40%'; meterColor = '#27ae60';
        feedback = 'Moderate head loss. Acceptable  range for most industrial applications.';
    } else if (headLoss <= 15) {
        meterWidth = '60%'; meterColor = '#f39c12';
        feedback = 'High head loss. Consider optimizing pipe size, fittings, or flow rate.';
    } else if (headLoss <= 30) {
        meterWidth = '80%'; meterColor = '#e67e22';
        feedback = 'Very high head loss. System redesign or efficiency improvement recommended.';
    } else {
        meterWidth = '95%'; meterColor = '#e74c3c';
        feedback = 'Extreme head loss. Unsafe or inefficient. Immediate engineering review required.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback + (warnings.length ? " " + warnings.join(" ") : "");

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
{% comment %} 
/*
 SI-based Darcy-Weisbach Equation:
 h_f = (4 * f * L * u^2) / (2 * g * D)

 Validation Rules (based on ASME, NFPA, ISO 5167, OSHA):
 - f: 0.001–0.1 (dimensionless)
 - L: 1–10,000 m
 - u: 0.1–10 m/s
 - D: 0.01–2 m
 - All inputs > 0, decimals ≤ 3 places
 - Head Loss acceptable range: 0.1–50 m
 - Safety trigger: h_f > 30 m = unsafe for firewater systems
*/ {% endcomment %}