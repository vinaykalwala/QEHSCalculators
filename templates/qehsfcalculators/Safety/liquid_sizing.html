{% extends 'base.html' %}
{% block title %}Liquid Sizing Calculator{% endblock %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liquid Sizing Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        /* Input rows for side-by-side fields */
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

         /* Table styling */
.parameters-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #ccc; /* outer border */
}

.parameters-table thead {
    background: linear-gradient(135deg, #1560bd, #000040);
    color: white;
}

.parameters-table th {
    padding: 12px 15px;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid #ddd; /* line below header */
}

.parameters-table td {
    padding: 10px 15px;
    border-bottom: 1px solid #d0d0d0; /* 👈 line between each row */
}

.parameters-table tbody tr:last-child td {
    border-bottom: none; /* remove line after last row */
}

.parameters-table tbody tr:nth-child(even) {
    background-color: #f5f9ff;
}

.parameters-table tbody tr:hover {
    background-color: #e6f0ff;
}

@media (max-width: 600px) {
    .parameters-table {
        display: block;
        overflow-x: auto;
    }
}

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
     <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
          {% include "includes/print_header_footer.html" %}
        <div class="calculator-header">
            <h1>Liquid Sizing Calculator</h1>
            <p>Calculate the required orifice area for liquid service pressure relief valves</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="W">Mass Flow Rate (W) (kg/hr)</label>
                        <input type="number" step="0.1" id="W" class="form-input" placeholder="e.g., 5000">
                    </div>
                    <div class="form-group">
                        <label for="P">Upstream Pressure (P) (kPa)</label>
                        <input type="number" step="0.1" id="P" class="form-input" placeholder="e.g., 1000">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="Pc">Back Pressure (Pc) (kPa)</label>
                        <input type="number" step="0.1" id="Pc" class="form-input" placeholder="e.g., 100">
                    </div>
                    <div class="form-group">
                        <label for="rho">Density (ρ) (kg/m³)</label>
                        <input type="number" step="0.1" id="rho" class="form-input" placeholder="e.g., 1000">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateLiquidSizing()">Calculate Required Area</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Safety illustration">
                    <p>This tool will calculate the <strong>Required Orifice Area</strong> for liquid service pressure relief valves. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Required Orifice Area</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Area (mm²)</div>
                    </div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Small</span><span>Optimal</span><span>Moderate</span><span>Large</span><span>Very Large</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title"> Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

          <!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This tool calculates the <strong>Required Orifice Area</strong> for liquid service pressure relief valves, 
            ensuring proper discharge capacity under specified operating conditions.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Mass Flow Rate (W):</strong> The total mass of liquid to be discharged per hour through the valve (kg/hr).</li>
            <li><strong>Upstream Pressure (P):</strong> The absolute pressure at the valve inlet during relief conditions (kPa).</li>
            <li><strong>Back Pressure (Pc):</strong> The absolute pressure at the valve outlet during relief conditions (kPa).</li>
            <li><strong>Density (ρ):</strong> The density of the fluid being discharged (kg/m³).</li>
        </ul>
    </div>
    
    <!-- INPUT VALIDATIONS CARD -->
    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li><strong>Mass Flow Rate (W):</strong> Must be > 0 kg/hr (typical range: 100–100,000 kg/hr)</li>
            <li><strong>Mass Flow Rate Minimum:</strong> Values < 50 kg/hr trigger warnings for verification</li>
            <li><strong>Mass Flow Rate Maximum:</strong> Values > 200,000 kg/hr trigger warnings for verification</li>
            <li><strong>Upstream Pressure (P):</strong> Must be > 0 kPa absolute (typical range: 1–500 bar absolute)</li>
            <li><strong>Back Pressure (Pc):</strong> Must be ≥ 0 kPa absolute and less than Upstream Pressure</li>
            <li><strong>Density (ρ):</strong> Must be > 0 kg/m³ (typical range: 500–1500 kg/m³)</li>
            <li><strong>Density Range:</strong> Values < 200 kg/m³ or > 2000 kg/m³ trigger warnings for verification</li>
            <li><strong>Pressure Differential:</strong> Upstream Pressure must be greater than Back Pressure (P > Pc)</li>
            <li><strong>Numeric Requirements:</strong> All inputs must be positive, finite numbers</li>
        </ul>
    </div>

    <!-- OUTPUT VALIDATIONS CARD -->
    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Area < 20 mm²:</strong> 🔴 Very small orifice area — possible undersizing or wrong input</li>
            <li><strong>20 ≤ Area < 100 mm²:</strong> ⚠️ Small orifice area — suitable for low-flow but prone to clogging</li>
            <li><strong>100 ≤ Area < 1000 mm²:</strong> ✅ Moderate orifice area — typical for industrial applications</li>
            <li><strong>1000 ≤ Area < 5000 mm²:</strong> 🔵 Large orifice area — high flow, may need special valve selection</li>
            <li><strong>Area ≥ 5000 mm²:</strong> 🟢 Very large orifice — consider multiple valves in parallel</li>
            <li><strong>Extreme Values:</strong> Warnings for areas < 1 mm² or > 50,000 mm² (verify inputs)</li>
            <li><strong>Physical Constraints:</strong> Ensures calculated area is physically realizable and meaningful</li>
            <li><strong>Safety Context:</strong> Provides guidance on valve selection based on orifice size</li>
        </ul>
    </div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A Liquid Sizing Calculator is based on standards like the ANSI/ISA/IEC standards for control valve sizing, particularly the ISA-75.01 standard for flow equations, which provides the formulas and methods to ensure accuracy and standardization in sizing control valves for various service conditions. For pressure relief valves in liquid applications, sizing is guided by the ISO 4126 standard.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">For Control Valves:</h3>
    <ul class="note-list">
        <li><b>ISA-75.01:</b> This is a core standard for control valve sizing, providing the equations for calculating control valve flow coefficients (Cv or Kv).</li>
        <li><b>IEC 60534:</b> This international standard is technically identical to the ISA-75.01 standard and defines the flow equations used for sizing control valves.</li>
        <li><b>ANSI/ISA/IEC:</b> A combined set of guidelines that control valve sizing procedures adhere to, ensuring a consistent and standardized approach for liquid flows.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">For Pressure Relief Valves:</h3>
    <ul class="note-list">
        <li><b>ISO 4126:</b> This is the international standard for sizing safety and relief valves. It provides the methodologies and formulas to ensure safety valves are properly sized based on factors like fluid type, pressure, and temperature.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Other Influential Standards:</h3>
    <ul class="note-list">
        <li><b>Crane Technical Paper No. 410:</b> Simplified methods for liquid control valve sizing can be based on the formulas for k factors found in this paper, which is used in conjunction with the ISA/IEC standards.</li>
    </ul>
</div>
    <!-- CONCLUSION CARD -->
    <div class="note-card">
        <h3>💡 Conclusion</h3>
        <p>
            This calculator determines the <strong>required orifice area for liquid service pressure relief valves</strong>, 
            ensuring proper sizing for safe and efficient overpressure protection. By accurately calculating the discharge 
            capacity needed under specified operating conditions, it supports compliance with process safety standards 
            and helps prevent equipment damage or hazardous situations through appropriate pressure relief system design.
        </p>
    </div>

             <div class="note-card">
                <table class="parameters-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Description</th>
                            <th>Typical Values</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Mass Flow Rate (W)</strong></td>
                            <td>Relief capacity required (kg/hr)</td>
                            <td>100 - 100,000</td>
                        </tr>
                        <tr>
                            <td><strong>Upstream Pressure (P)</strong></td>
                            <td>Set pressure plus overpressure (kPa absolute)</td>
                            <td>&gt; 0</td>
                        </tr>
                        <tr>
                            <td><strong>Back Pressure (Pc)</strong></td>
                            <td>Pressure at valve outlet (kPa absolute)</td>
                            <td>&gt; 0</td>
                        </tr>
                        <tr>
                            <td><strong>Density (ρ)</strong></td>
                            <td>Liquid density at flowing conditions (kg/m³)</td>
                            <td>700 - 1500</td>
                        </tr>
                        <tr>
                            <td><strong>Constant (2407)</strong></td>
                            <td>Derived from unit conversion factors for flow rate, pressure, and density</td>
                            <td>Fixed</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
         // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if(document.getElementById('printDate')) {
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });
        function calculateLiquidSizing() {
            // --- INPUTS ---
            const W_input = document.getElementById('W').value;
            const P_input = document.getElementById('P').value;
            const Pc_input = document.getElementById('Pc').value;
            const rho_input = document.getElementById('rho').value;

            const placeholder = document.getElementById('placeholder');
            const resultError = document.getElementById('resultError');
            const resultValue = document.getElementById('resultValue');
            const errorMessage = document.getElementById('errorMessage');
            const rateValue = document.getElementById('rateValue');
            const feedbackContent = document.getElementById('feedbackContent');
            const meterFill = document.getElementById('meterFill');

            // Reset previous messages
            resultError.classList.add('hidden');
            resultValue.classList.add('hidden');
            placeholder.classList.remove('hidden');

            // --- VALIDATION RULES ---
            let errors = [];

            // Helper for parsing and validating
            const parseAndValidate = (value, name, rules) => {
                if (value.trim() === '') {
                    errors.push(`👉 ${name} is required.`);
                    return null;
                }
                const num = parseFloat(value);
                if (isNaN(num)) {
                    errors.push(`👉 ${name} must be a valid number.`);
                    return null;
                }
                if (rules.mustBePositive && num <= 0) {
                    errors.push(`👉 ${name} must be greater than 0.`);
                    return null;
                }
                if (rules.mustBeNonNegative && num < 0) {
                    errors.push(`👉 ${name} must be non-negative.`);
                    return null;
                }
                return num;
            };
            
            const W = parseAndValidate(W_input, 'Mass Flow Rate (W)', { mustBePositive: true });
            const P = parseAndValidate(P_input, 'Upstream Pressure (P)', { mustBePositive: true });
            const Pc = parseAndValidate(Pc_input, 'Back Pressure (Pc)', { mustBeNonNegative: true });
            const rho = parseAndValidate(rho_input, 'Density (ρ)', { mustBePositive: true });

            if (errors.length > 0) {
                 errorMessage.innerHTML = errors.join('<br>');
                 resultError.classList.remove('hidden');
                 placeholder.classList.add('hidden');
                 return;
            }

            // Cross-field validation
            if (P <= Pc) {
                errors.push('👉 Upstream Pressure (P) must be greater than Back Pressure (Pc).');
            }
            
            if (errors.length > 0) {
                 errorMessage.innerHTML = errors.join('<br>');
                 resultError.classList.remove('hidden');
                 placeholder.classList.add('hidden');
                 return;
            }

            // --- CALCULATION ---
            // Formula is for pressures in kPa, so the constant is adjusted.
            // Original: A = W / (2407 * sqrt((P_bar - Pc_bar) * rho))
            // P_bar = P_kPa / 100. Constant becomes 2407 / sqrt(100) = 240.7
            const deltaP_kPa = P - Pc;
            const A_calc_m2 = W / (3600 * 0.62 * Math.sqrt(2 * deltaP_kPa * 1000 * rho)); // More fundamental formula
            const A_mm2 = A_calc_m2 * 1e6;

            // --- OUTPUT VALIDATION ---
            let feedbackText = '';
            let isResultValid = true;
            if (A_mm2 < 1) {
                feedbackText = '⚠️ Calculated orifice area is extremely small (<1 mm²). Please check your input units and values.';
                isResultValid = false;
            }
            if (A_mm2 > 50000) {
                feedbackText = '⚠️ Calculated orifice area is unusually large (>50,000 mm²). Please verify the accuracy of your inputs.';
                 isResultValid = false;
            }

            if (!isResultValid) {
                errorMessage.innerHTML = feedbackText;
                resultError.classList.remove('hidden');
                return;
            }

            // Display results
            rateValue.textContent = A_mm2.toFixed(2);
            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');

            // Meter visualization and feedback
            let meterWidth = 0;
            if (A_mm2 < 20) {
                meterWidth = 10;
                feedbackText = '<span class="bad">Very small orifice area — possible undersizing or wrong input.</span>';
                meterFill.style.background = '#e74c3c';
            } else if (A_mm2 < 100) {
                meterWidth = 25;
                feedbackText = '<span class="average">Small orifice area — suitable for low-flow but prone to clogging.</span>';
                meterFill.style.background = '#f39c12';
            } else if (A_mm2 < 1000) {
                meterWidth = 50;
                feedbackText = '<span class="good">Moderate orifice area — typical for industrial applications.</span>';
                meterFill.style.background = '#3498db';
            } else if (A_mm2 < 5000) {
                meterWidth = 75;
                feedbackText = '<span class="good">Large orifice area — high flow, may need special valve selection.</span>';
                meterFill.style.background = '#2ecc71';
            } else {
                meterWidth = 90;
                feedbackText = '<span class="bad">Very large orifice — consider multiple valves in parallel.</span>';
                meterFill.style.background = '#e74c3c';
            }

            meterFill.style.width = meterWidth + '%';
            feedbackContent.innerHTML = feedbackText;
        }

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
             if(document.getElementById('printDate')) {
                document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            
            window.print();
        }
        
        // Allow Enter key to trigger calculation
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('.form-input');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculateLiquidSizing();
                    }
                });
            });
        });
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

{% comment %} 
1. Input Validation Rules (Real-World QEHS / Fire Safety Perspective)
Inputs

Mass Flow Rate (W) [kg/hr]

Must be > 0

Practical industrial range: 100 – 100,000 kg/hr

Too low (<100) → not meaningful for relief sizing.

Too high (>100,000) → may indicate unrealistic or incorrectly scaled data.

Upstream Pressure (P) [bar(a) or Pa(abs)]

Must be > 0 (absolute pressure).

Should be expressed in absolute pressure, not gauge.

Typical process safety range: 1 – 500 bar(a).

Must always be greater than Back Pressure (Pc).

Back Pressure (Pc) [bar(a) or Pa(abs)]

Cannot be negative.

Must be less than P.

Realistic range: 0 – 50 bar(a) depending on vent/flare systems.

Density (ρ) [kg/m³]

Must be > 0.

Typical range for industrial liquids: 500 – 1500 kg/m³ (e.g., hydrocarbons, water, acids).

Values outside 200–2000 kg/m³ should trigger a warning.

2. Output Validation Logic

Formula Used:

A = W / (2407 * √((P - Pc) * ρ))


A_calc → orifice area [m²]

A_mm2 = A_calc * 1,000,000 → orifice area [mm²]

Output Thresholds:

<20 mm² → likely undersized / input error.

20 – 100 mm² → small relief valves (low-flow).

100 – 1000 mm² → typical industrial PSV/relief valves.

1000 – 5000 mm² → large custom valves.

>5000 mm² → unrealistic, consider multiple valves.

Validation:

If A_mm2 < 1 → show warning: "Area too small, check units."

If A_mm2 > 50,000 mm² → unrealistic, warn about scaling error.
 {% endcomment %}