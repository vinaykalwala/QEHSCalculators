{% extends 'base.html' %}
{% block title %}Defects Per Million Opportunities (DPMO) and Six Sigma Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defects Per Million Opportunities (DPMO) and Six Sigma Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
        .result-metrics {
    display: flex;
    justify-content: center;
    gap: 40px; /* space between DPMO and Sigma cards */
    margin-top: 20px;
    flex-wrap: wrap; /* responsive */
}

.metric-card {
    flex: 1;
    min-width: 200px;
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.metric-card:hover {
    transform: translateY(-5px);
}

.metric-value {
    font-size: 36px;
    font-weight: 700;
    color: #1560bd;
    margin-bottom: 8px;
}

.metric-label {
    font-size: 16px;
    color: #555;
    font-weight: 500;
}

    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Defects Per Million Opportunities (DPMO) And Six Sigma Calculator</h1>
            <p>Calculates process performance metrics to measure quality and identify improvement opportunities</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="defects">Number of Defects</label>
                    <input type="number" id="defects" class="form-input" min="0" step="1" placeholder="Enter Defects">
                </div>

                <div class="form-group">
                    <label for="opportunities">Opportunities per Unit</label>
                    <input type="number" id="opportunities" class="form-input" min="1" step="1" placeholder="Enter Opportunities">
                </div>

                <div class="form-group">
                    <label for="units">Number of Units</label>
                    <input type="number" id="units" class="form-input" min="1" step="1" placeholder="Enter Units">
                </div>

                <button class="calculate-btn" onclick="calculateDPMO()">Calculate DPMO and Sigma Level</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Quality illustration">
                    <p>This tool calculates the <strong>DPMO and Sigma Level</strong> of your process. Enter your data to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Process Performance</h2>
                    </div>
<div class="result-metrics">
    <div class="metric-card">
        <div class="metric-value" id="dpmovalue">0.00</div>
        <div class="metric-label">DPMO</div>
    </div>
    <div class="metric-card">
        <div class="metric-value" id="sigmavalue">0.00</div>
        <div class="metric-label">Sigma Level</div>
    </div>
</div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="sigmaFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>🔎 About This Calculator</h3>
                <p>
                    The <strong>DPMO and Six Sigma Calculator</strong> helps determine the Defects Per Million Opportunities (DPMO) and the Sigma Level of a process. These metrics are critical for evaluating process performance and improving product quality. Achieving a higher Sigma Level reduces defects and enhances overall process efficiency.
                </p> 
            </div>

             <div class="note-card">
    <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Number of Defects:</strong> The total number of defects observed in the process. Fewer defects indicate better quality.</li>
                    <li><strong>Number of Opportunities per Unit:</strong> The number of potential defect opportunities in each unit. More opportunities increase the chance of defects but also allow better tracking.</li>
                    <li><strong>Number of Units:</strong> The total number of units produced or processed. Accurate unit tracking helps calculate process efficiency.</li>
                </ul>
            </div>

            <div class="note-card">
    <h3>📌 Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Number of Defects:</strong> Required, must be ≥ 0</li>
                    <li><strong>Opportunities per Unit:</strong> Required, must be ≥ 1</li>
                    <li><strong>Number of Units:</strong> Required, must be ≥ 1</li>
                    <li><strong>All inputs:</strong> Must be valid numbers (no text or special characters)</li>
                </ul>
            </div>

           

           <div class="note-card">
    <h3>📊 Output Validations</h3>
    <p>ℹ️ If DPMO = 0, the process is perfect, achieving 6 Sigma level (world-class quality). Any invalid input or extreme values will be flagged during calculation.</p>
    <ul class="note-list">
        <ul class="note-list">
    <li><strong>(≥ 6 Sigma):</strong> 🌟 World-class quality—only 3.4 defects per million opportunities.</li>
    <li><strong> (≥ 5 Sigma and < 6 Sigma):</strong> ✅ Excellent quality with very few defects (approx. 233 defects per million).</li>
    <li><strong>(≥ 4 Sigma and < 5 Sigma):</strong> 👍 Good quality but with noticeable defects (approx. 6,210 defects per million).</li>
    <li><strong>(≥ 3 Sigma and < 4 Sigma):</strong> ⚠️ Average quality—higher defect rates (approx. 66,800 defects per million).</li>
    <li><strong>(< 3 Sigma):</strong> ❌ Poor quality—immediate action needed to reduce defects.</li>
</ul>
   </ul>
    <p>⚠️ Input validations are enforced: defects ≥ 0, opportunities per unit ≥ 1, units ≥ 1. Any values outside these ranges will display an error and prevent calculation.</p>
</div>

            
            <div class="note-card">
    <h3>📐 Governing Principle</h3>
                <p>Defects Per Million Opportunities (DPMO) is a key metric from the Six Sigma quality management methodology. It measures the error rate of a process by counting the number of defects that occur per million opportunities for a defect to exist, helping to evaluate process efficiency and quality.  </p>
            </div>
            
            <div class="note-card">
                <h3>💡 Conclusion</h3>
                <p>DPMO and Six Sigma metrics are essential tools for quality management across industries. By accurately measuring process performance, organizations can identify improvement opportunities, reduce defects, and enhance customer satisfaction. Regular monitoring helps maintain high standards and drive continuous improvement.</p>
            </div>
        </div>
    </div>

    <script>
        function calculateDPMO() {
            const defects = document.getElementById("defects").value.trim();
            const opportunities = document.getElementById("opportunities").value.trim();
            const units = document.getElementById("units").value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');
            const dpmovalue = document.getElementById('dpmovalue');
            const sigmavalue = document.getElementById('sigmavalue');
            const feedbackBox = document.getElementById('sigmaFeedback'); 

            let errors = [];
            
            // Input validation
            if (defects === "") {
                errors.push("👉 Please enter the number of defects.");
            } else if (isNaN(defects)) {
                errors.push("👉 Defects must be a number.");
            } else if (parseFloat(defects) < 0) {
                errors.push("👉 Defects cannot be negative.");
            }
            
            if (opportunities === "") {
                errors.push("👉 Please enter the number of opportunities per unit.");
            } else if (isNaN(opportunities)) {
                errors.push("👉 Opportunities must be a number.");
            } else if (parseFloat(opportunities) <= 0) {
                errors.push("👉 Opportunities must be greater than 0.");
            }
            
            if (units === "") {
                errors.push("👉 Please enter the number of units.");
            } else if (isNaN(units)) {
                errors.push("👉 Units must be a number.");
            } else if (parseFloat(units) <= 0) {
                errors.push("👉 Units must be greater than 0.");
            }

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // Calculate DPMO
            const defectsNum = parseFloat(defects);
            const opportunitiesNum = parseFloat(opportunities);
            const unitsNum = parseFloat(units);
            
            const DPMO = (defectsNum / (opportunitiesNum * unitsNum)) * 1000000;

            // Calculate Sigma Level
            const sigmaLevel = calculateSigmaLevel(DPMO);

            dpmovalue.textContent = DPMO.toFixed(2);
            sigmavalue.textContent = sigmaLevel.toFixed(2);

            // Provide feedback based on sigma level
            let feedback = "";
            
           if (sigmaLevel >= 6) {
    feedback = "🌟 World-class quality—only 3.4 defects per million opportunities";
} else if (sigmaLevel >= 5) {
    feedback = "✅ Excellent quality with very few defects (approx. 233 defects per million)";
} else if (sigmaLevel >= 4) {
    feedback = "👍 Good quality but with noticeable defects (approx. 6,210 defects per million)";
} else if (sigmaLevel >= 3) {
    feedback = "⚠️ Average quality—higher defect rates (approx. 66,800 defects per million)";
} else {
    feedback = "❌ Poor quality—immediate action needed to reduce defects";
}


            feedbackBox.textContent = feedback;

            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        // Calculate Sigma Level from DPMO
        function calculateSigmaLevel(dpmo) {
            // Handle edge cases
            if (dpmo <= 0) return 6.0; // Perfect process
            if (dpmo >= 1000000) return 0; // Worst case
            
            // Standard Six Sigma conversion with 1.5 sigma shift
            // Using approximation formula for sigma level calculation
            const dpmoRate = dpmo / 1000000;
            
            // Use the inverse normal distribution approximation
            // This is a simplified approach for demonstration
            if (dpmoRate >= 0.5) {
                // For higher defect rates, use a different approximation
                return Math.max(0, 1.5 - Math.sqrt(Math.log(1/dpmoRate) * 2.3));
            } else {
                // For lower defect rates, use the standard approach
                return 1.5 + Math.sqrt(2) * erfInv(1 - dpmoRate);
            }
        }

        // Inverse error function (erfInv) approximation
        function erfInv(x) {
            if (x <= 0 || x >= 1) return 0;
            
            var a = 0.147;
            var sign = (x < 0.5) ? -1 : 1;
            x = (x < 0.5) ? x : 1 - x;
            var temp = Math.log(1 - Math.pow(x, 2));
            var part1 = (2 / (Math.PI * a)) + (temp / 2);
            var part2 = Math.sqrt(Math.pow(part1, 2) - (temp / a));
            return sign * Math.sqrt(part2 - part1);
        }

        function printReport() {
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Input Validation Rules from Quality Management Perspective
====================================================================
Number of Defects:

Required field, must be ≥ 0

Maximum realistic value: ≤ 1,000,000 (beyond this indicates critical process failure)

Must be integer (no decimals for defect counts)

Should not exceed (Opportunities × Units) - logical consistency check

Opportunities per Unit:

Required field, must be ≥ 1

Realistic range: 1-1,000 (most processes have 5-50 opportunities)

Must be integer (opportunities are discrete)

If > 100, warn user about potential over-counting

Number of Units:

Required field, must be ≥ 1

Realistic minimum: 10 (statistically meaningful sample)

Maximum: 10,000,000 (for calculation performance)

Must be integer (units are discrete)

=================Output Validation & Interpretation=================
DPMO Calculation:

Formula: DPMO = (Defects / (Opportunities × Units)) × 1,000,000

Valid range: 0 to 1,000,000 DPMO

If defects = 0, DPMO = 0 (perfect process)

Sigma Level Calculation:

Standard Six Sigma calculation with 1.5 sigma shift

Valid range: 0 to 6.0+ Sigma

Interpretation bands based on industry standards:

≥ 6.0: World Class (3.4 DPMO)

5.0-5.9: Excellent (233 DPMO)

4.0-4.9: Good (6,210 DPMO)

3.0-3.9: Average (66,807 DPMO)

< 3.0: Needs Improvement

=================Edge Case Validations====================
Division by zero: When opportunities or units = 0

Defects > (opportunities × units): Illogical scenario

Extremely small samples (units < 10): Statistical significance warning

Opportunities > 100: Potential over-counting warning

===============Compliance Importance==================
Each validation ensures:

Data integrity for quality reporting

Statistical significance of results

Logical consistency in process measurement

Alignment with ISO 13053 (Six Sigma standards)

Accurate benchmarking against industry standards

-->