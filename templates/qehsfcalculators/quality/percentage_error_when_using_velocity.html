{% extends 'base.html' %}
{% block title %}Percentage Error when using velocity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Percentage Error when using velocity Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
            content: url("https://cdn-icons-png.flaticon.com/512/2942/2942789.png");
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
     <div class="btn-container">
    <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        

        <div class="calculator-header">
            <h1>Percentage Error When Using Velocity Calculator</h1>
            <p>Calculates the percentage error in flowrate when using a velocity sensing meter that is not pressure compensated</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="specifiedDensity">Specified Density (kg/m³)</label>
                    <input type="number" id="specifiedDensity" class="form-input" min="0" step="0.001" placeholder="Enter specified density">
                </div>

                <div class="form-group">
                    <label for="actualDensity">Actual Density (kg/m³)</label>
                    <input type="number" id="actualDensity" class="form-input" min="0" step="0.001" placeholder="Enter actual density">
                </div>

                <button class="calculate-btn" onclick="calculateError()">Calculate Error</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Orifice">
                    <p>This tool calculates the <strong>percentage error</strong> in flowrate measurement. Enter specified and actual density values to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Percentage Error</h2>
                    </div>
                    <div class="rate-value" id="errorValue">0.00</div>
                    <div class="rate-label"><strong>%</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Error Interpretation</div>
                        <div class="feedback-content" id="errorFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
        
            <div class="note-card">
                <h3>🔎 About This Calculator</h3>
                <p>
                    The <strong>Percentage Error Calculator</strong> evaluates the error in steam flowrate measurement
                    when using a velocity-sensing meter that is not pressure-compensated.
                    Flow errors occur because steam density changes with operating pressure,
                    leading to inaccurate readings if the actual density differs from the specified density.
                </p>
            </div>
        
            <div class="note-card">
                <h3>📐 Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Specified Density (ρ<sub>specified</sub>):</strong> Density of steam at specified line pressure
                        (kg/m³).</li>
                    <li><strong>Actual Density (ρ<sub>actual</sub>):</strong> Density of steam at actual operating pressure
                        (kg/m³).</li>
                    <li><strong>Percentage Error (ε):</strong> Error in flowrate measurement due to density variation, expressed
                        in %.</li>
                    <li><strong>Density Ratio (ρ<sub>specified</sub> / ρ<sub>actual</sub>):</strong> Used to evaluate realism of
                        input values.</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>📌 Input Validation Rules</h3>
                <ul class="note-list">
                    <li>👉 <strong>Specified Density:</strong> Required, numeric, must be > 0.</li>
                    <li>👉 <strong>Actual Density:</strong> Required, numeric, must be > 0.</li>
                    <li>⚠️ Values above <strong>1000 kg/m³</strong> trigger a warning (unrealistic for steam).</li>
                    <li>⚠️ Density ratio outside the range <strong>0.5 – 2.0</strong> triggers a warning (unusual measurement).
                    </li>
                    <li>❌ <strong>Division by Zero:</strong> If ρ<sub>actual</sub> = 0 → error shown (invalid calculation).</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>📊 Output Validations</h3>
                <ul class="note-list">
                    <li>✅ Perfect Measurement: No error in flow calculation.</li>
                    <li>⚠️ Minor Overestimation: Slight over-calculation of flow.</li>
                    <li>❌ Significant Overestimation: Flow highly inaccurate. Check calibration!</li>
                    <li>⚠️ Minor Underestimation: Slight under-calculation of flow.</li>
                    <li>❌ Significant Underestimation: Flow highly inaccurate. Check calibration!</li>
                    <li>⚠️ Additional warnings appear if densities exceed realistic ranges or the ratio is abnormal.</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>⚙️ Governing Principle</h3>
                <p>
                    The principle is based on <strong>density-compensated flow measurement</strong>.
                    Flowrate (Q) measured by a velocity-sensing meter is proportional to the square root of differential
                    pressure.
                    If density is assumed incorrectly, the measured flow deviates from the true flow.
                </p>
                <p>
                    Governing relation:
                    <br>
                    <strong>ε (%) = [(ρ<sub>specified</sub> / ρ<sub>actual</sub>) - 1] × 100</strong>
                </p>
            </div>
        
            <div class="note-card">
                <h3>✅ Conclusion</h3>
                <p>
                    This calculator provides an efficient way to quantify errors in steam flow measurement caused by density
                    differences.
                    By applying proper validation rules and interpreting results, users can identify whether the system
                    is operating within acceptable limits, requires recalibration, or has unrealistic input values.
                    Regular checks help ensure <strong>accuracy, safety, and compliance</strong> in industrial steam
                    applications.
                </p>
            </div>
        
        </div>

    </div>

    <script>
        function calculateError() {
    const specifiedDensityInput = document.getElementById("specifiedDensity").value.trim();
    const actualDensityInput = document.getElementById("actualDensity").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const outputValue = document.getElementById('errorValue');
    const feedbackBox = document.getElementById('errorFeedback');

    let errors = [];
    let warnings = [];

    const specifiedDensity = parseFloat(specifiedDensityInput);
    const actualDensity = parseFloat(actualDensityInput);

    // --- Input Validation ---
    if (!specifiedDensityInput || isNaN(specifiedDensity)) {
        errors.push("👉 Enter a valid specified density (kg/m³).");
    } else if (specifiedDensity <= 0) {
        errors.push("👉 Specified density must be greater than 0.");
    } else if (specifiedDensity > 1000) {
        warnings.push("⚠️ Specified density exceeds typical steam values (>1000 kg/m³). Verify input.");
    }

    if (!actualDensityInput || isNaN(actualDensity)) {
        errors.push("👉 Enter a valid actual density (kg/m³).");
    } else if (actualDensity <= 0) {
        errors.push("👉 Actual density must be greater than 0.");
    } else if (actualDensity > 1000) {
        warnings.push("⚠️ Actual density exceeds typical steam values (>1000 kg/m³). Verify input.");
    }

    // Density ratio check
    if (actualDensity > 0 && (specifiedDensity / actualDensity > 2 || specifiedDensity / actualDensity < 0.5)) {
        warnings.push("⚠️ Density ratio unusually high or low. Check measurement accuracy.");
    }

    // Show errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Prevent division by zero ---
    if (actualDensity === 0) {
        errorMessage.innerHTML = "❌ Actual density cannot be zero (division by zero).";
        errorBox.classList.remove("hidden");
        return;
    }

    // --- Calculate percentage error ---
    const error = ((specifiedDensity / actualDensity) - 1) * 100;
    outputValue.textContent = error.toFixed(4);

    // --- Feedback based on thresholds ---
    let feedback = "";
    if (error === 0) {
        feedback = "✅ Perfect Measurement: No error in flow calculation.";
    } else if (error > 0 && error <= 5) {
        feedback = "⚠️ Minor Overestimation: Slight over-calculation of flow.";
    } else if (error > 5) {
        feedback = "❌ Significant Overestimation: Flow highly inaccurate. Check calibration!";
    } else if (error < 0 && error >= -5) {
        feedback = "⚠️ Minor Underestimation: Slight under-calculation of flow.";
    } else if (error < -5) {
        feedback = "❌ Significant Underestimation: Flow highly inaccurate. Check calibration!";
    }

    if (warnings.length > 0) {
        feedback += " | " + warnings.join(" ");
    }

    feedbackBox.textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

function printReport() {
    window.print();
}

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Input Validation Rules (QEHS / Fire Safety Perspective)
Input	Units	Valid Range	Precision	Notes / QEHS Rationale
Specified Density (ρ<sub>specified</sub>)	kg/m³	0.5 – 1000	0.001	Represents nominal steam density. Negative or zero values are physically impossible. Densities above 1000 kg/m³ are unrealistic for steam. Ensures accurate flow measurement and prevents miscalculations.
Actual Density (ρ<sub>actual</sub>)	kg/m³	0.5 – 1000	0.001	Measured operational density. Must not be zero (to avoid division by zero). Extreme differences vs specified density may indicate instrumentation or calibration issues.
Density Ratio (ρ<sub>specified</sub> / ρ<sub>actual</sub>)	dimensionless	0.5 – 2	N/A	Ratio should be within realistic bounds; values outside indicate measurement errors or process anomalies.

Cross-field / Logical Checks:

Both densities are required and must be positive numbers.

Actual density cannot be zero (division by zero risk).

Very large discrepancies (>50% difference) should trigger a warning.

Densities outside realistic operational ranges (for steam or fluid systems) should be flagged.

================ Output Validation Logic=======================

Percentage Error Formula:

Percentage Error
(
%
)
=
(
𝜌
specified
𝜌
actual
−
1
)
×
100
Percentage Error(%)=(
ρ
actual
	​

ρ
specified
	​

	​

−1)×100

Interpretation Thresholds (Typical Industrial / QEHS Guidelines):

% Error	Interpretation	QEHS / Compliance Significance
0	Perfect Measurement	Accurate flow reading; compliant with calibration standards (ISO 5167, ASTM, etc.)
0–5	Minor Overestimation / Underestimation	Acceptable operational deviation; may require periodic verification
5–15	Moderate Error	Calibration check recommended; may affect process efficiency
>15	Significant Error	High risk of incorrect flow reporting; requires immediate calibration and safety review
===========Edge Case Validations======================

Empty / Null Fields → show error.

Zero or negative densities → invalid; prevent division by zero.

Excessively high densities (>1000 kg/m³) → warning, not error.

Large discrepancies (e.g., actual density <50% of specified) → show warning; check process/measurement.

Extreme negative errors → indicate underestimation.

Precision handling → output up to 4 decimal places for industrial accuracy.

🧮 Formula:
    The percentage error is calculated using the formula:
        ε = ((ρ_specified / ρ_actual) - 1) × 100
        Where:
                ε = Percentage error (%)
                ρ_specified = Specified density (kg/m³)
                ρ_actual = Actual density (kg/m³)
                

-->