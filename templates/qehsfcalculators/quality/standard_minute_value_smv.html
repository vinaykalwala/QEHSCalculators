{% extends 'base.html' %}
{% block title %}Standard Minute Value (SMV) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standard Minute Value (SMV) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        
.result-card::-webkit-scrollbar {
    width: 8px;
}

.result-card::-webkit-scrollbar-thumb {
    background: #1560bd;
    border-radius: 6px;
}

.result-card::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.result-card {
    justify-content: flex-start; /* align from top */
    align-items: stretch;
    min-height: 420px;
    text-align: center;
    overflow-y: auto;       /* Enable vertical scrolling */
    max-height: 450px;      /* Set max height to control output size */
    padding: 20px;          /* keep spacing */
}

        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
        
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Standard Minute Value (SMV) Calculator</h1>
            <p>Calculates the Standard Minute Value based on basic time and allowance percentage</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="basicTime">Basic Time (minutes)</label>
                    <input type="number" id="basicTime" class="form-input" min="0" step="0.01" placeholder="Enter basic time">
                </div>

                <div class="form-group">
                    <label for="allowance">Allowance (%)</label>
                    <input type="number" id="allowance" class="form-input" min="0" step="0.1" placeholder="Enter allowance percentage">
                </div>

                <button class="calculate-btn" onclick="calculateSMV()">Calculate SMV</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Time management illustration">
                    <p>This tool calculates the <strong>Standard Minute Value (SMV)</strong>. Enter your basic time and allowance percentage to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Standard Minute Value</h2>
                    </div>
                    <div class="rate-value" id="smvValue">0.00</div>
                    <div class="rate-label"><strong>minutes</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Work Efficiency Analysis</div>
                        <div class="feedback-content" id="smvFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>🔎 About This Calculator</h3>
                <p>
                    The <strong>Standard Minute Value (SMV) Calculator</strong> determines the total time a standard worker should take to complete a task, including allowances for factors like personal needs, fatigue, and delays. This is crucial for production planning, efficiency analysis, and workforce management.
                </p> 
            </div>
            
            <div class="note-card">
                <h3>📌 Input Validations</h3>
                <ul class="note-list">
                    <li><strong>Basic Time (minutes):</strong> Required, must be > 0 and ≤ 480 minutes (8-hour shift)</li>
                    <li><strong>Allowance (%):</strong> Required, must be ≥ 0 and ≤ 50%</li>
                    <li><strong>Realistic Values:</strong> Allowance typically ranges from 10% to 25% for most industries</li>
                    <li><strong>Allowance:</strong> Cannot be negative as it represents additional time factors</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>❓ Explanation of Parameters</h3>
                <ul class="note-list">
                    <li><strong>Basic Time:</strong> The time taken by a standard worker to perform a task under ideal conditions, measured in minutes.</li>
                    <li><strong>Allowance:</strong> A percentage added to the basic time to account for factors that may slow down the worker, such as personal needs, fatigue, and machine downtime.</li>
                    <li><strong>Standard Minute Value (SMV):</strong> The total standard time required to complete the task, including allowances, measured in minutes.</li>
                </ul>
            </div>
            

            <div class="note-card">
                <h3>📊 Real-Life Applications</h3>
                <ul class="note-list">
                    <li><strong>Manufacturing:</strong> Used in production planning and efficiency analysis to determine standard production times.</li>
                    <li><strong>Garment Industry:</strong> Essential for costing, line balancing, and performance evaluation.</li>
                    <li><strong>Service Industry:</strong> Helps in setting service time standards and improving customer service efficiency.</li>
                    <li><strong>Workforce Management:</strong> Enables fair workload distribution and performance benchmarking.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>💡 Conclusion</h3>
                <p>This calculator enables accurate assessment of task completion times by incorporating realistic allowances for various factors. It helps organizations optimize their processes, improve productivity, ensure fair compensation for workers, and maintain consistent performance standards across operations.</p>
            </div>
        </div>
    </div>
    
    <script>
    function calculateSMV() {
    const basicTime = document.getElementById("basicTime").value.trim();
    const allowance = document.getElementById("allowance").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const smvValue = document.getElementById('smvValue');
    const feedbackBox = document.getElementById('smvFeedback'); 

    // Reset
    errorBox.classList.add("hidden");
    errorMessage.innerHTML = "";
    feedbackBox.innerHTML = "";

    let errors = [];
    let warnings = [];

    // ✅ Basic Time validation
    if (basicTime === "" || isNaN(basicTime)) {
        errors.push("⛔ Basic Time is required and must be a valid number.");
    } else {
        const basicTimeNum = parseFloat(basicTime);
        if (basicTimeNum <= 0) {
            errors.push("⛔ Basic Time must be greater than 0 minutes.");
        } else if (basicTimeNum > 480) {
            errors.push("⛔ Basic Time cannot exceed 480 minutes (8-hour shift).");
        } else if (basicTimeNum < 0.1) {
            warnings.push("⚠️ Very small Basic Time (<0.1 min). Use advanced stopwatch study.");
        } else if (basicTimeNum > 120) {
            warnings.push("⚠️ Task duration >120 minutes. Break into subtasks for ergonomic compliance.");
        }
    }

    // ✅ Allowance validation
    if (allowance === "" || isNaN(allowance)) {
        errors.push("⛔ Allowance is required and must be a valid number.");
    } else {
        const allowanceNum = parseFloat(allowance);
        if (allowanceNum < 0) {
            errors.push("⛔ Allowance cannot be negative.");
        } else if (allowanceNum > 50) {
            errors.push("⛔ Allowance cannot exceed 50%.");
        } else if (allowanceNum < 5) {
            warnings.push("⚠️ Allowance <5%. May not account for fatigue/personal needs.");
        } else if (allowanceNum > 25 && allowanceNum <= 35) {
            warnings.push("⚠️ Allowance >25%. Higher than typical industry standard.");
        }
    }

    // ❌ Show errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // ✅ Parse numbers
    const basicTimeNum = parseFloat(basicTime);
    const allowanceNum = parseFloat(allowance);

    // ✅ Calculate SMV
    const smv = basicTimeNum + (basicTimeNum * (allowanceNum / 100));

    // ✅ Display result
    smvValue.textContent = smv.toFixed(2);

    // ✅ Feedback logic
    let feedbackMessage = "";
    let complianceLevel = "compliant";
    const allowanceMinutes = smv - basicTimeNum;
    const allowancePercentage = (allowanceMinutes / smv) * 100;

    if (allowanceNum <= 15) {
        feedbackMessage = "✅ Optimal: Allowance ≤15%. Efficient & safe workflow.";
        complianceLevel = "optimal";
    } else if (allowanceNum <= 25) {
        feedbackMessage = "⚠️ Acceptable: Allowance 15–25%. Industry standard.";
        complianceLevel = "acceptable";
    } else if (allowanceNum <= 35) {
        feedbackMessage = "🔶 Moderate: Allowance 25–35%. Review workflow.";
        complianceLevel = "moderate";
    } else {
        feedbackMessage = "❌ Non-compliant: Allowance >35%. Immediate corrective action needed.";
        complianceLevel = "non-compliant";
    }

    feedbackMessage += `<br><br>Allowance Time: <strong>${allowanceMinutes.toFixed(2)} min</strong>`;
    feedbackMessage += `<br>Allowance Share of SMV: <strong>${allowancePercentage.toFixed(1)}%</strong>`;

    if (warnings.length > 0) {
        feedbackMessage += "<br><br><strong>Additional Notes:</strong><br>" + warnings.join("<br>");
    }

    feedbackBox.innerHTML = feedbackMessage;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}

    </script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
*--------------------------------------------------------------*
Input Validation Rules (Real-world QEHS/Fire Safety Compliance)
Basic Time (minutes)

Mandatory.

Min: > 0 minutes. (Zero or negative means no real task; unsafe in audits).

Max: ≤ 480 minutes (8 hours). A worker cannot continuously work on a task beyond one shift.

Decimals allowed: up to 2 decimal places (ISO/ILO allow precision to 0.01 minutes ≈ 0.6 sec).

Industry practice:

Typical task time: 0.1 – 120 minutes.

Very small (<0.1 min) → stopwatch error, requires advanced study.

Very large (>120 min) → likely multiple tasks, not one SMV unit.

*--------Allowance (%)-----------------*

Mandatory.

Min: ≥ 0% (cannot be negative).

Max: ≤ 50% (above 50% indicates systemic inefficiency).

Decimals allowed: 1 decimal place.

Industry practice:

Typical allowance: 10–25%.

<5% → unsafe (ignores fatigue/personal needs).

35% → non-compliant, requires management review.

Cross-field Dependencies

If Basic Time > 480 → throw a warning (“Task exceeds a shift – break into subtasks”).

If Allowance < 5% AND Basic Time > 120 minutes → flag safety risk (worker fatigue not accounted).

If Allowance > 35% with Basic Time < 10 minutes → flag data entry error (tiny tasks should not need massive allowance).

*--------- Output Validation & Threshold Explanations---------*
Formula:
𝑆
𝑀
𝑉
=
𝐵
𝑎
𝑠
𝑖
𝑐
𝑇
𝑖
𝑚
𝑒
+
(
𝐵
𝑎
𝑠
𝑖
𝑐
𝑇
𝑖
𝑚
𝑒
×
𝐴
𝑙
𝑙
𝑜
𝑤
𝑎
𝑛
𝑐
𝑒
100
)
SMV=BasicTime+(BasicTime×
100
Allowance
	​

)
Output (SMV in minutes):

<1 minute: Micro-task, confirm timing study.

1–30 minutes: Normal task block.

30–120 minutes: Extended task; check fatigue allowance.

>480 minutes: Invalid (task exceeds shift length).

*------Feedback Categories:-----------*

Optimal: Allowance ≤ 15% → Efficient, safe workflow.

Acceptable: 15–25% → Industry standard.

Moderate: 25–35% → Review process.

Non-compliant: >35% → Immediate corrective action.
*-----------------------------------------------------------------------------*
            <div class="note-card formula-card">
                <h3>📐 Formula</h3>
                <p>The Standard Minute Value is calculated using:</p>
                <code>SMV = Basic Time + (Basic Time × (Allowance / 100))</code>
                <p>Where:</p>
                <ul class="note-list">
                    <li><strong>SMV</strong> = Standard Minute Value (minutes)</li>
                    <li><strong>Basic Time</strong> = Time under ideal conditions (minutes)</li>
                    <li><strong>Allowance</strong> = Percentage allowance for various factors (%)</li>
                </ul>
            </div>

-->