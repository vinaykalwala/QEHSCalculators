{% extends 'base.html' %}
{% block title %}Cost Per Minute (CPM) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cost Per Minute (CPM) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
         .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
     <div class="btn-container">
        <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
    </div>

   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

    

        <div class="calculator-header">
            <h1>Cost Per Minute (CPM) Calculator</h1>
            <p>Calculates the cost efficiency of operations based on labor and operational costs divided by available work minutes</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="laborCost">Direct Labor Cost </label>
                    <input type="number" id="laborCost" class="form-input" min="0.01" step="0.01" placeholder="Enter labor cost">
                </div>

                <div class="form-group">
                    <label for="operationalCost">Operational Cost </label>
                    <input type="number" id="operationalCost" class="form-input" min="0.01" step="0.01" placeholder="Enter operational cost">
                </div>

                <div class="form-group">
                    <label for="availableMinutes">Available Minutes</label>
                    <input type="number" id="availableMinutes" class="form-input" min="0.01" step="0.01" placeholder="Enter available minutes">
                </div>

                <button class="calculate-btn" onclick="calculateCPM()">Calculate CPM</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Cost efficiency illustration">
                    <p>This tool calculates the <strong>Cost Per Minute (CPM)</strong>. Enter your cost data to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2> The Cost Per Minute</h2>
                    </div>
                    <div class="rate-value" id="cpmValue">0.00</div>
                    <div class="rate-label"> per minute</div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="cpmFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>🔎 About This Calculator</h3>
                <p>
                    The <strong>Cost Per Minute (CPM) Calculator</strong> measures the cost efficiency of operations based on labor and operational costs divided by available work minutes. It helps companies optimize their resource allocation and identify areas for cost reduction.
                </p> 
            </div>
             <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Direct Labor Cost:</strong> The total wages paid to workers for a given period.</li>
                    <li><strong>Operational Cost:</strong> Expenses required to keep operations running, such as rent, utilities, and materials.</li>
                    <li><strong>Available Minutes:</strong> The total number of working minutes available in a given period.</li>
                </ul>
            </div>
<div class="note-card">
    <h3>📌 Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Direct Labor Cost ($):</strong> Required; must be ≥ 0.01 and ≤ 1,000,000,000. Up to 2 decimal places allowed. Represents actual labor expenditure in USD.</li>
        <li><strong>Operational Cost ($):</strong> Required; must be ≥ 0.01 and ≤ 1,000,000,000. Up to 2 decimal places allowed. Reflects overhead or other operational expenses.</li>
        <li><strong>Available Minutes:</strong> Required; must be ≥ 1 and ≤ 1,000,000. Decimals allowed up to 2 places. Cannot be zero to avoid division errors.</li>
        <li><strong>Cross-field Logic:</strong> 
            <ul>
                <li>Total cost (Labor + Operational) divided by Available Minutes must be ≥ 0.0001 to avoid unrealistic CPM values.</li>
                <li>Extremely high costs with very low minutes (e.g., billions of dollars over few minutes) are flagged as outliers.</li>
            </ul>
        </li>
    </ul>
</div>
<div class="note-card">
    <h3>📊 Output Validations</h3>
    <ul class="note-list">
        <li><strong>CPM ≤ 1:</strong> ✅ This is a cost-effective operation. Your costs are well-managed relative to available time.</li>
        <li><strong>CPM &gt; 1:</strong> ⚠️ This CPM is relatively high. Consider optimizing labor or operational costs to improve efficiency.</li>
    </ul>
</div>

<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A <strong>Cost Per Minute (CPM) Calculator</strong> is not governed by a single, universal Indian standard; it is a general methodology used across industries to assess operational efficiency. 
        In India, guidelines for calculating equipment or operational unit costs, such as in river valley or construction projects, are referenced from the <strong>Bureau of Indian Standards (BIS)</strong>, e.g., <strong>IS 11590:1995</strong>, which outlines methods to determine unit rate costs for construction equipment. 
        Organizations adapt this calculation to their specific context, considering labor, operational costs, and available time, while aligning with best practices for cost control and efficiency measurement.
    </p>
</div>



          

            

           
            
            <div class="note-card">
                <h3>💡 Conclusion</h3>
                <p>Monitoring CPM is crucial for businesses to understand their operational efficiency. A lower CPM indicates better cost optimization relative to time usage, while a higher CPM suggests areas where costs can be reduced or processes can be made more efficient. Regular assessment helps companies maintain competitive advantage and improve profitability.</p>
            </div>
        </div>
    </div>

    <script>
        function calculateCPM() {
    const laborCost = document.getElementById("laborCost").value.trim();
    const operationalCost = document.getElementById("operationalCost").value.trim();
    const availableMinutes = document.getElementById("availableMinutes").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const outputValue = document.getElementById('cpmValue');
    const feedbackBox = document.getElementById('cpmFeedback');

    let errors = [];

    // --- Generic validator function ---
    function validateInput(value, field, min, max, decimals) {
        if (value === "") return `👉 Please enter ${field}.`;
        if (isNaN(value)) return `👉 ${field} must be a valid number.`;
        const num = parseFloat(value);
        if (num < min) return `👉 ${field} must be at least ${min}.`;
        if (num > max) return `👉 ${field} cannot exceed ${max.toLocaleString()}.`;
        if ((value.includes('.') && value.split('.')[1].length > decimals)) {
            return `👉 ${field} must not exceed ${decimals} decimal places.`;
        }
        return null;
    }

    // --- Validate each input ---
    const laborErr = validateInput(laborCost, "Direct Labor Cost ($)", 0.01, 1000000000, 2);
    const opErr = validateInput(operationalCost, "Operational Cost ($)", 0.01, 1000000000, 2);
    const minErr = validateInput(availableMinutes, "Available Minutes", 1, 1000000, 2);

    [laborErr, opErr, minErr].forEach(err => { if (err) errors.push(err); });

    // --- Cross-field sanity checks ---
    if (errors.length === 0) {
        const laborNum = parseFloat(laborCost);
        const opNum = parseFloat(operationalCost);
        const minutesNum = parseFloat(availableMinutes);

        if (minutesNum <= 0) {
            errors.push("👉 Available minutes must be greater than 0 to avoid division by zero.");
        }

        if ((laborNum + opNum) / minutesNum < 0.0001) {
            errors.push("👉 CPM too low to be realistic — check inputs.");
        }

        if ((laborNum + opNum) > 1000000000 && minutesNum < 10) {
            errors.push("👉 Extremely high cost with very low minutes — unrealistic.");
        }
    }

    // --- Error handling ---
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- Calculation ---
    const cpm = (parseFloat(laborCost) + parseFloat(operationalCost)) / parseFloat(availableMinutes);
    outputValue.textContent = cpm.toFixed(4);

            let feedback = "";
            if (cpm > 1) {
                feedback = "⚠️ This CPM is relatively high. Consider optimizing labor or operational costs to improve efficiency.";
            } else {
                feedback = "✅ This is a cost-effective operation. Your costs are well-managed relative to available time.";
            }

    feedbackBox.textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
===========Input Validation Rules (QEHS & Fire Safety Perspective)==============
Direct Labor Cost ($)

Required: Cannot be empty.

Range: ≥ 0.01 and ≤ 1,000,000,000 (to prevent absurd inputs or data entry errors).

Decimals: Up to 2 decimals (currency standard).

Units: U.S. Dollars (explicitly displayed).

Operational Cost ($)

Required: Cannot be empty.

Range: ≥ 0.01 and ≤ 1,000,000,000.

Decimals: Up to 2 decimals.

Logic: Cannot be negative; must reflect actual overhead.

Available Minutes

Required: Cannot be empty.

Range: ≥ 1 and ≤ 1,000,000 (practical cap for workforce periods).

Decimals: Up to 2 allowed (if fractional minutes are recorded from time systems).

Logic: Must always be > 0 (division by zero safety).

Cross-field Rules

Total cost (Labor + Operational) must be ≥ availableMinutes × $0.0001 (to avoid “zero CPM” anomalies).

If Available Minutes < 60, warn user: “⚠️ Very short analysis window may distort CPM values.”

Large mismatches (e.g., billions of dollars vs 10 minutes) flagged as outliers.

==========Output Validation & Thresholds=========

Formula:

CPM = Labor Cost + Operational Cost
Available Minutes
CPM=Available Minutes
Labor Cost + Operational Cost
	​

Output Thresholds (Industry benchmarks)

≤ $0.50 CPM → Excellent ✅
Highly cost-efficient operation.

$0.51 – $1.00 CPM → Acceptable ⚖️
Typical efficiency, monitor for improvements.

$1.01 – $5.00 CPM → High ⚠️
Overheads or labor utilization may be inefficient.

> $5.00 CPM → Critical 🚨
Urgent review required — cost inefficiency risks non-compliance with ISO/OSHA efficiency benchmarks.
Edge Case Validations

Empty input: Prompt user with required message.

Negative values: Block (not possible in cost/time reporting).

Zero minutes: Block (division by zero).

Excessive decimals: Round to 2 for costs, 2 for minutes.

Labor = 0, Ops = 0: Block — unrealistic in real audits.

Extreme mismatch (e.g., $1B / 5 minutes): Warn user about outlier.

Very low CPM (< $0.0001): Warn user — may be a unit mismatch (hours vs minutes).
-->