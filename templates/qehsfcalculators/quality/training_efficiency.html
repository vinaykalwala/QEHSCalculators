{% extends 'base.html' %}
{% block title %}Training Efficiency Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Efficiency Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
     <div class="btn-container">
    <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
</div>

   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Training Efficiency Calculator</h1>
            <p>Calculates training efficiency by comparing actual training hours to planned training hours</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="plannedHours">Planned Training Hours</label>
                    <input type="number" id="plannedHours" class="form-input" min="0" placeholder="Enter planned hours">
                </div>

                <div class="form-group">
                    <label for="actualHours">Actual Training Hours</label>
                    <input type="number" id="actualHours" class="form-input" min="0" placeholder="Enter actual hours">
                </div>

                <button class="calculate-btn" onclick="calculateEfficiency()">Calculate Efficiency</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Training illustration">
                    <p>This tool calculates the <strong>training efficiency percentage</strong>. Enter your planned and actual training hours to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Training Efficiency</h2>
                    </div>
                    <div class="rate-value" id="efficiencyValue">0.00</div>
                    <div class="rate-label"><strong>%</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Training Efficiency Interpretation</div>
                        <div class="feedback-content" id="efficiencyFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>🔎 About This Calculator</h3>
                <p>
                    The <strong>Training Efficiency Calculator</strong> measures how closely actual training hours match planned hours. This helps organizations assess whether their training programs are meeting expectations and identify areas for improvement in training delivery and planning.
                </p> 
            </div>
            
            <div class="note-card">
                <h3>📌 Input Validations</h3>
                <ul class="note-list">
                    <li><strong>Planned Hours:</strong> Required, must be > 0</li>
                    <li><strong>Actual Hours:</strong> Required, must be > 0</li>
                    <li><strong>Realistic Values:</strong> Hours should be reasonable for training programs</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>❓ Explanation of Parameters</h3>
                <ul class="note-list">
                    <li><strong>Planned Hours:</strong> The total hours of training that were scheduled or intended to be delivered.</li>
                    <li><strong>Actual Hours:</strong> The real-time hours of training that were actually conducted.</li>
                    <li><strong>Efficiency Percentage:</strong> The ratio of actual to planned hours, indicating how effectively training time is being utilized.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>📊 Efficiency Interpretation</h3>
                <ul class="note-list">
                    <li><strong>Efficiency = 100%:</strong> Perfect match! The actual training aligns exactly with the plan.</li>
                    <li><strong>Efficiency Below 100%:</strong> Training time is underutilized. Consider reviewing the training plan.</li>
                    <li><strong>Efficiency Above 100%:</strong> Extra training delivered. Ensure the additional time is valuable.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>💡 Why It Matters</h3>
                <p>Monitoring training efficiency helps organizations assess whether their training programs are meeting expectations. Consistently low efficiency could highlight issues like insufficient training delivery, while very high efficiency might indicate overextension beyond planned time. Regular assessments help optimize training programs and ensure effective use of resources.</p>
            </div>
        </div>
    </div>

    <script>
        function calculateEfficiency() {
    const plannedHours = document.getElementById("plannedHours").value.trim();
    const actualHours = document.getElementById("actualHours").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const outputValue = document.getElementById('efficiencyValue');
    const feedbackBox = document.getElementById('efficiencyFeedback'); 

    let errors = [];

    // Empty check
    if (!plannedHours || !actualHours) {
        errors.push("👉 Please enter both planned and actual training hours.");
    }

    // Numeric check
    if (isNaN(plannedHours) || isNaN(actualHours)) {
        errors.push("👉 Training hours must be numeric values.");
    }

    const plannedNum = parseFloat(plannedHours);
    const actualNum = parseFloat(actualHours);

    // Range & logical checks
    if (plannedNum <= 0) {
        errors.push("👉 Planned training hours must be greater than zero.");
    }
    if (actualNum <= 0) {
        errors.push("👉 Actual training hours must be greater than zero.");
    }
    if (plannedNum > 200) {
        errors.push("👉 Planned training hours exceed realistic program limits (>200 hrs).");
    }
    if (actualNum > 300) {
        errors.push("👉 Actual training hours exceed realistic delivery (>300 hrs).");
    }

    // Decimal precision check (max 1 decimal place)
    if (!Number.isInteger(plannedNum * 10) || !Number.isInteger(actualNum * 10)) {
        errors.push("👉 Hours can only be recorded up to 1 decimal place.");
    }

    // Prevent division by zero
    if (plannedNum === 0) {
        errors.push("👉 Planned training hours cannot be zero.");
    }

    // Show errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Calculate efficiency
    const efficiency = (actualNum / plannedNum) * 100;
    outputValue.textContent = efficiency.toFixed(2);

    // Feedback interpretation
    let feedback = "";
    if (efficiency === 100) {
        feedback = "✅ Perfect match! Training delivered exactly as planned.";
    } else if (efficiency >= 80 && efficiency < 100) {
        feedback = "⚠️ Slight underutilization – acceptable but review scheduling.";
    } else if (efficiency < 80) {
        feedback = "❌ Major underutilization – high compliance risk, corrective action required.";
    } else if (efficiency > 100 && efficiency <= 120) {
        feedback = "✔️ Extra training delivered – ensure it added measurable value.";
    } else if (efficiency > 120 && efficiency <= 200) {
        feedback = "⚠️ Training exceeded plan significantly – audit justification required.";
    } else {
        feedback = "❓ Unrealistic input combination – please review entered hours.";
    }

    feedbackBox.textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
*---------Input Validation Rules------------*
Inputs: Planned Training Hours, Actual Training Hours

| Rule                     | Validation                                                                  | Industry Justification                                                                     |
| ------------------------ | --------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ |
| **Required fields**      | Cannot be empty                                                             | OSHA/ISO training audits require all fields documented                                     |
| **Numeric only**         | Must be valid numbers (no text/NaN)                                         | Prevents corrupted KPI data                                                                |
| **Positive values only** | `> 0`                                                                       | Training hours cannot be negative or zero                                                  |
| **Allowed decimals**     | Max **1 decimal place** (e.g., 1.5 hrs)                                     | Training is usually recorded in 15–30 min increments                                       |
| **Range check**          | **Planned Hours:** 1–200 hrs (per program)<br>**Actual Hours:** 0.5–300 hrs | Typical corporate/industrial training sessions, OSHA/NFPA rarely exceed 200 hrs per course |
| **Logical consistency**  | If `actual >> planned` (>200%), flag as **unrealistic/needs review**        | Unlikely for safety/fire training to exceed 2× the plan                                    |
| **Unit consistency**     | Both must be in the same unit (hours)                                       | Avoids mismatch (days vs. hours)                                                           |

*-------Output Validation & Interpretation------------*

Formula:
Efficiency (%) = (Actual ÷ Planned) × 100

✅ Thresholds & Compliance Meaning

| Efficiency   | Meaning                      | Safety/Compliance Perspective                        |
| ------------ | ---------------------------- | ---------------------------------------------------- |
| **= 100%**   | Perfect alignment            | Training executed as per plan → audit-ready          |
| **80–99%**   | Slight underutilization      | Common but indicates scheduling/resource gaps        |
| **< 80%**    | Significant underutilization | ⚠️ Red flag in OSHA/ISO audits – non-compliance risk |
| **101–120%** | Slight over-delivery         | Acceptable if extra value was added                  |
| **> 120%**   | Overextended training        | Needs justification (budget/time audit risk)         |
| **> 200%**   | Unrealistic                  | Likely wrong data entry (error flag)                 |



*--------------------Edge Case Validations----------------------------*

Planned = 0 → Division by zero (invalid, must block).

Actual = 0 → Valid mathematically but shows 0% → interpret as “No training delivered” (compliance risk).

Planned < Actual × 5 → Outlier; requires warning (“Unrealistic entry”).

Fractional hours allowed only up to 1 decimal place (1.5 hrs ok, 1.57 rejected).
-->