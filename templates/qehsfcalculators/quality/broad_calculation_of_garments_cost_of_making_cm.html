{% extends 'base.html' %}
{% block title %}Broad Calculation of Garments Cost of Making (CM){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broad Calculation of Garments Cost of Making (CM)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 500px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        
        .input-group {
            display: flex;
            align-items: center;
        }
        
        .input-group .form-input {
            border-radius: 10px 0 0 10px;
        }
        
        .input-group-append {
            background: #e9ecef;
            padding: 14px 12px;
            border: 1px solid #ddd;
            border-left: none;
            border-radius: 0 10px 10px 0;
            color: #495057;
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 500px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        .result-breakdown {
            width: 100%;
            margin-top: 20px;
            text-align: left;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .breakdown-item:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #1560bd;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        .hidden { 
            display: none; 
        }
        
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
        
        .toggle-advanced {
            color: #ffc107;
            background: transparent;
            border: none;
            text-decoration: underline;
            cursor: pointer;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .advanced-settings {
            border-top: 1px dashed rgba(255,255,255,0.3);
            padding-top: 15px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Broad Calculation of Garments Cost of Making (CM)</h1>
            <p>Calculate the cost of making garments based on production parameters in <strong>₹ (Rupees)</strong></p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="expenditure">Monthly Expenditure (₹)</label>
                    <div class="input-group">
                        <input type="number" id="expenditure" class="form-input" placeholder="Enter monthly expenditure">
                    </div>
                </div>

                <div class="form-group">
                    <label for="machines">Number of Machines</label>
                    <input type="number" id="machines" class="form-input" min="1" placeholder="Enter total machines">
                </div>

                <div class="form-group">
                    <label for="runningMachines">Qty of Running Machines</label>
                    <input type="number" id="runningMachines" class="form-input" min="1" placeholder="Enter running machines">
                </div>

                <div class="form-group">
                    <label for="production">Production Capacity per Hour (pcs)</label>
                    <input type="number" id="production" class="form-input" min="1" placeholder="Enter pcs per hour per machine">
                </div>

                <div class="form-group">
                    <label for="efficiency">Production Efficiency (%)</label>
                    <div class="input-group">
                        <input type="number" id="efficiency" class="form-input" value="80" min="1" max="100">
                    </div>
                </div>

                <div class="form-group">
                    <label for="piecesPerDozen">Total Pieces in a Dozen</label>
                    <input type="number" id="piecesPerDozen" class="form-input" value="12" min="1" max="12">
                </div>
                
                <button class="toggle-advanced" onclick="toggleAdvanced()">+ Advanced Settings</button>
                
                <div class="advanced-settings hidden" id="advancedSettings">
                    <div class="form-group">
                        <label for="workingDays">Working Days per Month</label>
                        <input type="number" id="workingDays" class="form-input" value="26" min="1" max="31">
                    </div>
                    
                    <div class="form-group">
                        <label for="workingHours">Working Hours per Day</label>
                        <div class="input-group">
                            <input type="number" id="workingHours" class="form-input" value="8" min="1" max="24">
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateCM()">Calculate CM</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Boiler illustration">
                    <p>This tool calculates the <strong>Cost of Making (CM)</strong> for garments in ₹ per dozen. Enter your production data to see results.</p>
                 </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Cost of Making (CM)</h2>
                    </div>
                    <div class="rate-value" id="cmValue">0.00</div>
                    <div class="rate-label"> per dozen (₹)</div>
                    
                    <div class="result-breakdown" id="breakdown">
                        <div class="breakdown-item">
                            <span>Daily Expenditure:</span>
                            <span id="dailyExpenditure">0.00 ₹</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Daily Production:</span>
                            <span id="dailyProduction">0 pcs</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Cost per Piece:</span>
                            <span id="costPerPiece">0.00 ₹</span>
                        </div>
                        <div class="breakdown-item">
                            <span>CM per Dozen:</span>
                            <span id="cmPerDozen">0.00 ₹</span>
                        </div>
                    </div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>

                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

       <!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>🔎 About This Calculator</h3>
        <p>
            This calculator estimates the <strong>Cost of Making (CM)</strong> of garments per dozen in <strong>₹ (Rupees)</strong>. 
            It helps manufacturers determine production costs, set pricing accurately, and improve efficiency. 
            The calculation accounts for both basic production parameters and advanced settings like working days, working hours, and efficiency percentage.
        </p> 
    </div>

    <div class="note-card">
        <h3>❓ Explanation of Parameters</h3>
        <ul class="note-list">
            <li><strong>Monthly Expenditure (₹):</strong> Total cost spent on manufacturing per month, including labor, utilities, and overheads.</li>
            <li><strong>Number of Machines:</strong> Total machines available for production in the factory.</li>
            <li><strong>Running Machines:</strong> Number of machines currently operational. This cannot exceed the total number of machines.</li>
            <li><strong>Production Capacity per Hour (pcs):</strong> The number of garments a single machine can produce in one hour at 100% efficiency.</li>
            <li><strong>Production Efficiency (%):</strong> The actual efficiency compared to the maximum capacity. For example, if a machine runs at 80% efficiency, it produces 80% of its maximum output.</li>
            <li><strong>Total Pieces per Dozen:</strong> Garments considered per dozen. Typically 12, but can be adjusted if needed.</li>
            <li><strong>Working Days per Month:</strong> (Advanced Setting) The number of days the factory operates per month. Default is 26.</li>
            <li><strong>Working Hours per Day:</strong> (Advanced Setting) The number of hours each machine operates per day. Default is 8.</li>
        </ul>
    </div>

   

    <div class="note-card">
        <h3>📊 Real-Life Applications</h3>
        <ul class="note-list">
            <li>Estimate production costs in ₹ to set accurate pricing for garments.</li>
            <li>Identify inefficiencies in production, such as low machine utilization or low efficiency.</li>
            <li>Support lean manufacturing strategies to reduce wastage and improve profitability.</li>
            <li>Plan monthly budgets by understanding the impact of running fewer machines or reducing working hours.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>💡 Tips for Accurate Results</h3>
        <ul class="note-list">
            <li>Ensure all inputs reflect actual production conditions.</li>
            <li>Use the advanced settings if your factory does not operate standard 26 days or 8 hours/day.</li>
            <li>Adjust production efficiency based on machine downtime or operator skill levels.</li>
            <li>Compare CM results across different production scenarios to optimize costs.</li>
        </ul>
    </div>
    
    <div class="note-card">
        <h3>💡 Conclusion</h3>
        <p>
            Accurate CM calculation in ₹ is essential for profit maximization and cost control in the apparel industry. 
            Using both basic and advanced settings ensures realistic estimates, allowing manufacturers to make informed decisions about pricing, production planning, and efficiency improvements.
        </p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    if(document.getElementById('printDate')){
        document.getElementById('printDate').textContent = now.toLocaleDateString('en-IN', options);
    }
});

function toggleAdvanced() {
    const advancedSettings = document.getElementById('advancedSettings');
    const toggleBtn = document.querySelector('.toggle-advanced');
    
    if (advancedSettings.classList.contains('hidden')) {
        advancedSettings.classList.remove('hidden');
        toggleBtn.textContent = '- Advanced Settings';
    } else {
        advancedSettings.classList.add('hidden');
        toggleBtn.textContent = '+ Advanced Settings';
    }
}

function calculateCM() {
    const expenditure = parseFloat(document.getElementById('expenditure').value);
    const machines = parseFloat(document.getElementById('machines').value);
    const runningMachines = parseFloat(document.getElementById('runningMachines').value);
    const production = parseFloat(document.getElementById('production').value);
    const efficiency = parseFloat(document.getElementById('efficiency').value);
    const piecesPerDozen = parseFloat(document.getElementById('piecesPerDozen').value);
    const workingDays = parseFloat(document.getElementById('workingDays').value) || 26;
    const workingHours = parseFloat(document.getElementById('workingHours').value) || 8;

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const cmValue = document.getElementById('cmValue');
    const feedbackContent = document.getElementById('feedbackContent');
    const dailyExpenditureEl = document.getElementById('dailyExpenditure');
    const dailyProductionEl = document.getElementById('dailyProduction');
    const costPerPieceEl = document.getElementById('costPerPiece');
    const cmPerDozenEl = document.getElementById('cmPerDozen');

    let errors = [];

    // Validation
    if (isNaN(expenditure) || expenditure <= 0) errors.push("👉 Monthly expenditure must be greater than 0 ₹.");
    if (isNaN(machines) || machines <= 0) errors.push("👉 Number of machines must be greater than 0.");
    if (isNaN(runningMachines) || runningMachines <= 0 || runningMachines > machines) 
        errors.push("👉 Running machines must be greater than 0 and cannot exceed total machines.");
    if (isNaN(production) || production <= 0) errors.push("👉 Production capacity per hour must be greater than 0.");
    if (isNaN(efficiency) || efficiency <= 0 || efficiency > 100) errors.push("👉 Efficiency must be between 1% and 100%.");
    if (isNaN(piecesPerDozen) || piecesPerDozen <= 0 || piecesPerDozen > 12) errors.push("👉 Pieces per dozen must be between 1 and 12.");

    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // CM Calculation in ₹ - Improved formula
    const dailyExpenditure = expenditure / workingDays;
    const effectiveProduction = production * (efficiency / 100);
    const dailyProduction = runningMachines * effectiveProduction * workingHours;
    const costPerPiece = dailyExpenditure / dailyProduction;
    const CM = costPerPiece * piecesPerDozen;

    // Update UI
    cmValue.textContent = CM.toFixed(2);
    dailyExpenditureEl.textContent = dailyExpenditure.toFixed(2) + " ₹";
    dailyProductionEl.textContent = Math.round(dailyProduction) + " pcs";
    costPerPieceEl.textContent = costPerPiece.toFixed(2) + " ₹";
    cmPerDozenEl.textContent = CM.toFixed(2) + " ₹";

    // Feedback
    let feedback = "";
    if (CM < 50) {
        feedback = "✅ Efficient cost structure in ₹! Production costs are optimized.";
    } else if (CM >= 50 && CM <= 100) {
        feedback = "⚖️ Average cost structure in ₹. Optimization possible.";
    } else {
        feedback = "⚠️ High cost structure in ₹! Consider efficiency improvements.";
    }

    feedbackContent.textContent = feedback;
    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

function printReport() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    if(document.getElementById('printDate')){
        document.getElementById('printDate').textContent = now.toLocaleDateString('en-IN', options);
    }
    window.print();
}
</script>

<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}