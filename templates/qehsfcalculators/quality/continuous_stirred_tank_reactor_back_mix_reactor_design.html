{% extends 'base.html' %}
{% block title %}Continuous Stirred-Tank Reactor Design Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continuous Stirred-Tank Reactor Design Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Continuous Stirred-Tank Reactor Design Calculator</h1>
            <p>Calculate the residence time required for a continuous stirred-tank reactor to achieve desired conversion</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="CA0">Initial Concentration (C<sub>A0</sub>)</label>
                    <input type="number" id="CA0" class="form-input" min="0.001" step="0.001" placeholder="e.g., 2.5 mol/m³">
                </div>
                <div class="form-group">
                    <label for="XA">Conversion (X<sub>A</sub>)</label>
                    <input type="number" id="XA" class="form-input" min="0" max="1" step="0.001" placeholder="e.g., 0.85">
                </div>
                <div class="form-group">
                    <label for="rA">Reaction Rate (-r<sub>A</sub>)</label>
                    <input type="number" id="rA" class="form-input" min="0.001" step="0.001" placeholder="e.g., 0.05 mol/m³·s">
                </div>
                
                <button class="calculate-btn" onclick="calculateResidenceTime()">Calculate Residence Time</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Reactor illustration">
                    <p>This tool will calculate the <strong>Residence Time (τ)</strong> for a CSTR. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:50px;">
                        <h2>Residence Time (τ)</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">seconds</div>
                    </div>
                    
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Short</span><span>Moderate</span><span>Long</span><span>Very Long</span><span>Excessive</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Residence Time Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <!-- About -->
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Continuous Stirred-Tank Reactor (CSTR) Design Calculator</strong> calculates the required residence time (τ) 
                    for a continuous stirred-tank reactor to achieve desired conversion at given reaction conditions. 
                    This is essential for chemical engineers designing continuous processes where consistent quality and safety are paramount.
                </p>
            </div>

            <!-- Parameters Used -->
            <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>C<sub>A0</sub> (Initial Concentration of A):</strong> The concentration of the reactant A before entering the reactor, measured in moles per cubic meter (mol/m³).</li>
                    <li><strong>X<sub>A</sub> (Conversion of A):</strong> The fraction of the reactant A that has been converted to product during the reaction. It ranges from 0 (no reaction) to 1 (complete reaction).</li>
                    <li><strong>-r<sub>A</sub> (Reaction Rate of A):</strong> The speed at which reactant A is used up in the reactor, expressed in mol/m³·s. It is always taken as a positive number.</li>
                </ul>
            </div>

            <!-- Input Validation Rules -->
            <div class="note-card">
                <h3>✅ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><b>Initial Concentration (C<sub>A0</sub>):</b> Must be greater than 0. Zero concentration means no reactant to convert.</li>
                    <li><b>Conversion (X<sub>A</sub>):</b> Must be between 0 and 1. It represents the fraction of reactant converted.</li>
                    <li><b>Reaction Rate (-r<sub>A</sub>):</b> Must be greater than 0. A zero or negative rate means the reaction isn't progressing.</li>
                    <li><b>Units:</b> Concentration in mol/m³, Reaction Rate in mol/m³·s, Conversion is dimensionless.</li>
                </ul>
            </div>

            <!-- Output Validations -->
            <div class="note-card">
                <h3>📊 Output Validations</h3>
                <p>
                    The <strong>Residence Time (τ)</strong> is interpreted using these thresholds:
                </p>
                <ul class="note-list">
                    <li><strong>τ &lt; 10 seconds:</strong> ⚠️ Short residence time: The reaction may be fast or incomplete. Consider checking conversion.</li>
                    <li><strong>10 ≤ τ &lt; 600 seconds:</strong> ✅ Residence time is within a typical industrial range.</li>
                    <li><strong>600 ≤ τ &lt; 3600 seconds:</strong> ⚠️ Long residence time: May require a large reactor or improved reaction conditions.</li>
                    <li><strong>τ ≥ 3600 seconds:</strong> ❌ Excessive residence time: Process likely inefficient; consider alternative reactor design or conditions.</li>
                </ul>
            </div>

            <!-- Standards -->
            <div class="note-card">
                <h3>📋 Standards</h3>
                <p>
                    Reactor design follows established engineering principles and standards:  
                    • <strong>AIChE</strong> standards for chemical process design  
                    • <strong>ISO 9001</strong> for quality management systems  
                    • <strong>OSHA</strong> requirements for chemical reactor safety  
                    • Industry best practices for reactor sizing and process optimization
                </p>
            </div>

            <!-- Conclusion -->
            <div class="note-card">
                <h3>📝 Conclusion</h3>
                <p>
                    Proper residence time ensures complete reactions and consistent product quality in continuous manufacturing processes. 
                    This calculation is essential for chemical engineers designing continuous processes where consistent quality and safety are paramount. 
                    Proper residence time ensures complete conversion while optimizing reactor size and operating costs.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateResidenceTime() {
            const CA0 = document.getElementById('CA0').value.trim();
            const XA = document.getElementById('XA').value.trim();
            const rA = document.getElementById('rA').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // --- Validation Rules ---
            // Initial Concentration (CA0)
            if (CA0 === "" || isNaN(CA0)) {
                errors.push("👉 Please enter the initial concentration (C<sub>A0</sub>).");
            } else if (parseFloat(CA0) <= 0) {
                errors.push("👉 Initial concentration must be greater than 0. Zero concentration means no reactant to convert.");
            }

            // Conversion (XA)
            if (XA === "" || isNaN(XA)) {
                errors.push("👉 Please enter the conversion (X<sub>A</sub>).");
            } else if (parseFloat(XA) < 0 || parseFloat(XA) > 1) {
                errors.push("👉 Conversion must be between 0 and 1. It represents the fraction of reactant converted.");
            }

            // Reaction Rate (rA)
            if (rA === "" || isNaN(rA)) {
                errors.push("👉 Please enter the reaction rate (-r<sub>A</sub>).");
            } else if (parseFloat(rA) <= 0) {
                errors.push("👉 Reaction rate must be greater than 0. A zero or negative rate means the reaction isn't progressing.");
            }

            // --- Error Handling ---
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // --- Safe Calculations ---
            const numCA0 = parseFloat(CA0);
            const numXA = parseFloat(XA);
            const numRA = parseFloat(rA);

            // Formula: τ = (CA0 * XA) / (-rA)
            const tau = (numCA0 * numXA) / numRA;

            document.getElementById('rateValue').textContent = tau.toFixed(2);

            const meterFill = document.getElementById('meterFill');
            let meterWidth, meterColor, feedback;
            
            // --- Output thresholds ---
            if (tau < 10) {
                meterWidth = '15%'; 
                meterColor = '#e74c3c';
                feedback = '⚠️ Short residence time: The reaction may be fast or incomplete. Consider checking conversion.';
            } else if (tau < 600) {
                meterWidth = '40%'; 
                meterColor = '#2ecc71';
                feedback = '✅ Residence time is within a typical industrial range.';
            } else if (tau < 3600) {
                meterWidth = '65%'; 
                meterColor = '#f1c40f';
                feedback = '⚠️ Long residence time: May require a large reactor or improved reaction conditions.';
            } else {
                meterWidth = '95%'; 
                meterColor = '#e74c3c';
                feedback = '❌ Excessive residence time: Process likely inefficient; consider alternative reactor design or conditions.';
            }

            meterFill.style.width = meterWidth;
            meterFill.style.backgroundColor = meterColor;

            // Add contextual info
            feedback += `<br><br>Residence time in minutes: ${(tau / 60).toFixed(2)}`;
            document.getElementById('feedbackContent').innerHTML = feedback;

            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}