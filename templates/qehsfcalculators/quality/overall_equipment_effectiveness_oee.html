{% extends 'base.html' %}
{% block title %}Overall Equipment Effectiveness (OEE) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overall Equipment Effectiveness (OEE) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
    
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="btn-container">
            <a href="{% url 'quality_calculators' %}" class="back-btn">Back To Quality Calculators</a>
        </div>

        <div class="calculator-header">
            <h1>Overall Equipment Effectiveness (OEE) Calculator</h1>
            <p>Measures the efficiency and productivity of a manufacturing process by analyzing availability, performance, and quality factors</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="availability">Availability (%)</label>
                    <input type="number" id="availability" class="form-input" min="0" step="0.01" placeholder="Enter availability">
                </div>

                <div class="form-group">
                    <label for="performance">Performance (%)</label>
                    <input type="number" id="performance" class="form-input" min="0" step="0.01" placeholder="Enter performance">
                </div>

                <div class="form-group">
                    <label for="quality">Quality (%)</label>
                    <input type="number" id="quality" class="form-input" min="0" step="0.01" placeholder="Enter quality">
                </div>

                <button class="calculate-btn" onclick="calculateOEE()">Calculate OEE</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Manufacturing efficiency illustration">
                    <p>This tool calculates the <strong>Overall Equipment Effectiveness (OEE)</strong> in percentage. Enter availability, performance, and quality metrics to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Overall Equipment Effectiveness</h2>
                    </div>
                    <div class="rate-value" id="oeeValue">0.00</div>
                    <div class="rate-label"><strong>%</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">OEE Interpretation</div>
                        <div class="feedback-content" id="oeeFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>üîé About This Calculator</h3>
                <p>
                    The <strong>Overall Equipment Effectiveness (OEE) Calculator</strong> measures the efficiency and productivity of a manufacturing process by analyzing three core factors: availability, performance, and quality. It helps identify bottlenecks, improve productivity, and optimize operational performance.
                </p> 
            </div>
            
            <div class="note-card">
                <h3>üìå Input Validations</h3>
                <ul class="note-list">
                    <li><strong>Availability (%):</strong> Required, must be > 0</li>
                    <li><strong>Performance (%):</strong> Required, must be > 0</li>
                    <li><strong>Quality (%):</strong> Required, must be > 0</li>
                    <li><strong>Realistic Range:</strong> Typically 0-100% for all inputs</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>‚ùì Explanation of Parameters</h3>
                <ul class="note-list">
                    <li><strong>Availability:</strong> Represents the percentage of scheduled time that the equipment is available to operate. Factors like equipment breakdowns or maintenance downtime affect availability.</li>
                    <li><strong>Performance:</strong> Measures how fast the equipment operates relative to its designed speed. Reduced speed, minor stops, or slow cycles lower performance.</li>
                    <li><strong>Quality:</strong> Evaluates the proportion of good products produced versus the total output. Defects and rework reduce the quality rate.</li>
                    <li><strong>OEE:</strong> The product of availability, performance, and quality percentages, representing overall equipment effectiveness.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üí° Why Measure OEE?</h3>
                <ul class="note-list">
                    <li><strong>Identify Bottlenecks:</strong> Pinpoint areas where efficiency drops</li>
                    <li><strong>Improve Productivity:</strong> Optimize processes and equipment usage</li>
                    <li><strong>Monitor Performance:</strong> Track manufacturing trends over time</li>
                    <li><strong>Enhance Decision-Making:</strong> Provide data-driven insights for improvements</li>
                    <li><strong>Reduce Waste:</strong> Identify and eliminate inefficiencies in production</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>‚úÖ Conclusion</h3>
                <p>This tool provides a simple calculation of OEE, offering valuable insights into the efficiency and effectiveness of manufacturing operations. By improving OEE, businesses can enhance output, reduce waste, and optimize operational performance. Regular OEE tracking helps maintain high standards of manufacturing excellence and continuous improvement.</p>
            </div>
        </div>
    </div>

    <script>
        function calculateOEE() {
    const availabilityInput = document.getElementById("availability").value.trim();
    const performanceInput = document.getElementById("performance").value.trim();
    const qualityInput = document.getElementById("quality").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const outputValue = document.getElementById('oeeValue');
    const feedbackBox = document.getElementById('oeeFeedback');

    let errors = [];
    let warnings = [];

    // --- Input Validation ---
    const availability = parseFloat(availabilityInput);
    const performance = parseFloat(performanceInput);
    const quality = parseFloat(qualityInput);

    if (!availabilityInput || isNaN(availability)) {
        errors.push("üëâ Enter a valid availability percentage.");
    } else if (availability < 0) {
        errors.push("üëâ Availability cannot be negative.");
    } else if (availability > 100) {
        warnings.push("‚ö†Ô∏è Availability exceeds 100%.");
    }

    if (!performanceInput || isNaN(performance)) {
        errors.push("üëâ Enter a valid performance percentage.");
    } else if (performance < 0) {
        errors.push("üëâ Performance cannot be negative.");
    } else if (performance > 100) {
        warnings.push("‚ö†Ô∏è Performance exceeds 100%.");
    }

    if (!qualityInput || isNaN(quality)) {
        errors.push("üëâ Enter a valid quality percentage.");
    } else if (quality < 0) {
        errors.push("üëâ Quality cannot be negative.");
    } else if (quality > 100) {
        warnings.push("‚ö†Ô∏è Quality exceeds 100%.");
    }

    // Show errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // --- OEE Calculation ---
    const oee = (availability / 100) * (performance / 100) * (quality / 100) * 100;
    outputValue.textContent = oee.toFixed(2);

    // --- Feedback based on thresholds ---
    let feedback = "";
    if (oee < 50) {
        feedback = "‚ùå Poor: Significant room for improvement.";
    } else if (oee >= 50 && oee < 75) {
        feedback = "‚ö†Ô∏è Average: Moderate efficiency, improvements needed.";
    } else if (oee >= 75 && oee < 90) {
        feedback = "üî∑ Good: High efficiency, minor improvements needed.";
    } else {
        feedback = "‚úÖ Excellent: Outstanding efficiency.";
    }

    if (warnings.length > 0) {
        feedback += " | " + warnings.join(" ");
    }

    feedbackBox.textContent = feedback;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}

function printReport() {
    window.print();
}

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Input Validation Rules (QEHS / Fire Safety Perspective)
Input	Units	Valid Range	Precision	Notes / QEHS Rationale
Availability (%)	%	0 ‚Äì 100	2 decimals	Represents operational uptime. Negative values are physically impossible. >100% may indicate data entry errors. OSHA & ISO 45001 recommend accurate downtime tracking.
Performance (%)	%	0 ‚Äì 100	2 decimals	Represents actual speed vs design speed. Negative values or >100% are unrealistic. Important for detecting underperformance or unsafe over-speed operations.
Quality (%)	%	0 ‚Äì 100	2 decimals	Percentage of conforming products. Negative or >100% is impossible. NFPA/ISO standards require accurate quality tracking for process safety and compliance.

Cross-field / Logical Checks:

All inputs must be numbers.

OEE = Availability √ó Performance √ó Quality (%).

If any factor is 0, OEE = 0 ‚Üí indicates major operational problem.

Inputs exceeding 100% ‚Üí generate warnings instead of errors.

2Ô∏è‚É£ Output Validation Logic

OEE Thresholds and Interpretation (Industry Standards)

OEE (%)	Interpretation	QEHS / Compliance Significance
<50	Poor	Major inefficiencies; safety and maintenance audits recommended.
50‚Äì75	Average	Moderate efficiency; process improvements needed.
75‚Äì90	Good	High efficiency; minor optimization possible.
>90	Excellent	Outstanding performance; ideal operation, minimal safety risks.

Audit Note: OEE should be reported in audits for continuous improvement and risk management, and unusually high (>100%) or negative values indicate data entry errors.

3Ô∏è‚É£ Edge Case Validations

Empty / Null Fields ‚Üí prompt user.

Negative values ‚Üí invalid; not allowed.

Values > 100% ‚Üí warning, not error.

All zeros ‚Üí OEE = 0, highlight critical downtime.

Extreme outliers ‚Üí availability = 100%, performance = 100%, quality = 0 ‚Üí OEE = 0 ‚Üí unusual but possible; report accordingly.

Division by zero ‚Üí technically not possible here, but OEE formula inherently safe (all multiplication).
            <div class="note-card formula-card">
                <h3>üßÆ Formula</h3>
                <p>The OEE is calculated using the formula:</p>
                <code>OEE = (Availability / 100) √ó (Performance / 100) √ó (Quality / 100) √ó 100</code>
                <p>Where all inputs are expressed as percentages.</p>
            </div>


-->