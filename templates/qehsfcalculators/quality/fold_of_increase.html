{% extends 'base.html' %}
{% block title %}Fold of Increase Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fold of Increase Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
        
        /* Table styles */
        .feedback-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .feedback-table th, .feedback-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .feedback-table th {
            background-color: #f2f2f2;
            font-weight: 600;
        }
        
        .feedback-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
     <div class="btn-container">
    <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

      
        <div class="calculator-header">
            <h1>Fold Of Increase Calculator</h1>
            <p>Calculates the productivity improvement after hydraulic fracturing based on drainage radius, wellbore radius, and skin factor</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="re">Drainage Radius (r<sub>e</sub>) in ft</label>
                    <input type="number" id="re" class="form-input" min="0" placeholder="Enter r_e">
                </div>

                <div class="form-group">
                    <label for="rw">Wellbore Radius (r<sub>w</sub>) in ft</label>
                    <input type="number" id="rw" class="form-input" min="0" placeholder="Enter r_w">
                </div>
                
                <div class="form-group">
                    <label for="sf">Equivalent Skin Factor (S<sub>f</sub>)</label>
                    <input type="number" id="sf" class="form-input" placeholder="Enter S_f">
                </div>

                <button class="calculate-btn" onclick="calculateFoldIncrease()">Calculate Fold of Increase</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="/static/images/resultimage.png" alt="Well illustration">
                    <p>This tool calculates the <strong>fold of increase</strong> in well productivity after hydraulic fracturing. Enter your parameters to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Fold of Increase</h2>
                    </div>
                    <div class="rate-value" id="foldValue">0.00</div>
                    <div class="rate-label"><strong>Ratio</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Productivity Interpretation</div>
                        <div class="feedback-content" id="productivityFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
    <div class="note-card">
        <h3>🔎 About This Calculator</h3>
        <p>
            The <strong>Fold of Increase Calculator</strong> measures how much a well's productivity improves after hydraulic fracturing. A higher fold of increase indicates a more effective fracturing process. The equation compares the productivity of a fractured well against a non-fractured well.
        </p> 
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>r<sub>e</sub> (Drainage Radius):</strong> The area from which the well extracts fluids. A larger value means a wider reservoir.</li>
            <li><strong>r<sub>w</sub> (Wellbore Radius):</strong> The radius of the drilled well, affecting fluid inflow to the wellbore.</li>
            <li><strong>S<sub>f</sub> (Skin Factor):</strong> Represents flow resistance near the well. A high S<sub>f</sub> indicates formation damage; negative values may indicate improved flow.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>All inputs are required and numeric.</li>
            <li>r<sub>e</sub> must be > 0, typical range 100–10,000 ft, must always be greater than r<sub>w</sub>.</li>
            <li>r<sub>w</sub> must be > 0, typical range 0.25–2 ft.</li>
            <li>S<sub>f</sub> can be any real number, logical range -10 ≤ S<sub>f</sub> ≤ 50.</li>
            <li>Decimals allowed for precision.</li>
            <li>Edge cases: r<sub>e</sub> = r<sub>w</sub> or r<sub>e</sub> < r<sub>w</sub> are invalid; FOI cannot be negative.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📊 Output Validations & Feedback</h3>
        <p>
            The Fold of Increase (FOI) value is interpreted based on industry benchmarks and feedback messages:<br>
            FOI &lt; 1 → ⚠️ Productivity decreased (FOI < 1) – Possible formation damage or ineffective fracturing.<br>
            FOI = 1 → ℹ️ No improvement (FOI = 1) – Fracturing had no effect.<br>
            1 &lt; FOI &lt; 1.5 → 📈 Minimal improvement (1–1.5x) – Limited effectiveness.<br>
            1.5 ≤ FOI &lt; 3 → ✅ Moderate improvement (1.5–3x) – Effective treatment.<br>
            3 ≤ FOI &lt; 5 → 🔥 Significant improvement (3–5x) – Highly effective fracturing.<br>
            FOI ≥ 5 → 🚀 Exceptional improvement (>5x) – Outstanding fracturing results.<br>
            These feedback messages match what is displayed alongside the result in the calculator output.
        </p>
    </div>

    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            A Fold of Increase Calculator is not derived from a single, universal "standard" but is a concept used across various fields, most prominently in the petroleum industry for measuring well productivity after hydraulic fracturing and in biomedical research (especially genomics and metabolomics) for analyzing fold changes in gene or metabolite expression. The specific formula and "standard" of application depend on the industry.
        </p>
        <p>
            <strong>Applicable Standards:</strong> API RP 40 (Hydraulic Fracturing Guidelines), ISO 22400 (Manufacturing Operations Metrics), ASTM D3633 (Productivity Measurement), and other industry-specific measurement protocols depending on the field of application.
        </p>
    </div>


    <div class="note-card">
        <h3>💡 Conclusion</h3>
        <p>
            The Fold of Increase is a key metric for understanding the effectiveness of well stimulation. Higher values indicate greater productivity improvements, while lower values show limited or no effect. Accurate input values ensure reliable calculations and meaningful real-world interpretation of fracturing or experimental outcomes.
        </p>
    </div>
</div>


    <script>function calculateFoldIncrease() {
    const re = document.getElementById("re").value.trim();
    const rw = document.getElementById("rw").value.trim();
    const sf = document.getElementById("sf").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const foldValue = document.getElementById('foldValue');
    const feedbackBox = document.getElementById('productivityFeedback'); 

    let errors = [];

    // ✅ Drainage radius validation
    if (re === "") {
        errors.push("👉 Please enter the drainage radius (rₑ).");
    } else if (isNaN(re)) {
        errors.push("👉 Drainage radius must be numeric.");
    } else if (parseFloat(re) <= 0) {
        errors.push("👉 Drainage radius must be greater than 0 ft.");
    } else if (parseFloat(re) < 100 || parseFloat(re) > 10000) {
        errors.push("👉 Drainage radius should be between 100 ft and 10,000 ft (check units).");
    }

    // ✅ Wellbore radius validation
    if (rw === "") {
        errors.push("👉 Please enter the wellbore radius (r𝔀).");
    } else if (isNaN(rw)) {
        errors.push("👉 Wellbore radius must be numeric.");
    } else if (parseFloat(rw) <= 0) {
        errors.push("👉 Wellbore radius must be greater than 0 ft.");
    } else if (parseFloat(rw) < 0.25 || parseFloat(rw) > 2) {
        errors.push("👉 Wellbore radius should be between 0.25 ft and 2 ft (typical range).");
    }

    // ✅ Skin factor validation
    if (sf === "") {
        errors.push("👉 Please enter the skin factor (S𝒻).");
    } else if (isNaN(sf)) {
        errors.push("👉 Skin factor must be numeric.");
    } else if (parseFloat(sf) < -10 || parseFloat(sf) > 50) {
        errors.push("👉 Skin factor should be between -10 and +50 (realistic range).");
    }

    // ✅ Cross-field validation: re must be > rw
    if (errors.length === 0 && parseFloat(re) <= parseFloat(rw)) {
        errors.push("👉 Drainage radius must be greater than wellbore radius.");
    }

    // Show errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    const reNum = parseFloat(re);
    const rwNum = parseFloat(rw);
    const sfNum = parseFloat(sf);

    // ✅ Calculate Fold of Increase safely
    const lnRatio = Math.log(reNum / rwNum);
    let foi = lnRatio / (lnRatio + sfNum);

    if (foi < 0) foi = 0; // compliance safeguard, FOI cannot be negative
    foldValue.textContent = foi.toFixed(4);

    // ✅ Feedback interpretation
    let feedback = "";
    if (foi < 1) {
        feedback = "⚠️ Productivity decreased (FOI < 1) – Possible formation damage or ineffective fracturing.";
    } else if (foi === 1) {
        feedback = "ℹ️ No improvement (FOI = 1) – Fracturing had no effect.";
    } else if (foi < 1.5) {
        feedback = "📈 Minimal improvement (1–1.5x) – Limited effectiveness.";
    } else if (foi < 3) {
        feedback = "✅ Moderate improvement (1.5–3x) – Effective treatment.";
    } else if (foi < 5) {
        feedback = "🔥 Significant improvement (3–5x) – Highly effective fracturing.";
    } else {
        feedback = "🚀 Exceptional improvement (>5x) – Outstanding fracturing results.";
    }

    feedbackBox.textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Detailed Input Validation Rules
Drainage Radius (re, ft)

Required field.

Must be a number > 0 (radius cannot be zero/negative).

Allow decimals (field measurements often not integers).

Practical range: 100 – 10,000 ft (too small/large values indicate error).

Compliance check: must always be greater than wellbore radius.

Wellbore Radius (rw, ft)

Required field.

Must be a number > 0.

Allow decimals.

Practical range: 0.25 – 2 ft (typical wellbores are inches to a few feet).

Cannot exceed drainage radius.

Skin Factor (Sf, dimensionless)

Required field.

Can be any real number (negative = improved flow, positive = formation damage).

Logical range for validation: -10 ≤ Sf ≤ 50 (extremes beyond this are not physically meaningful).

Decimals allowed.

3️⃣ Edge Case Validations

re = rw → invalid (log(re/rw) = log(1) = 0 → division by zero).

re < rw → invalid (drainage radius cannot be smaller than wellbore).

Very small rw (<0.1 ft) → warn user (unlikely physically, check units).

Very large re (>10,000 ft) → warn user (check input, possible typo).

Extreme Sf (>50 or < -10) → warn user (outside industry norms).

Logarithm check: ensure re/rw > 1 before calculating.

Output check: Fold of Increase (FOI) should always be ≥ 0.

4️⃣ Output Validation Logic

Formula:
FOI=
ln(
r
w
	​

r
e
	​

	​

)+S
f
	​

ln(
r
w
	​

r
e
	​

	​

)
	​

Output Thresholds & Interpretation

FOI < 1 → ⚠️ Productivity decreased → fracturing ineffective/damaging.

FOI = 1 → No improvement → fracturing had no effect.

1 < FOI < 1.5 → 📈 Minimal improvement → marginal effectiveness.

1.5 ≤ FOI < 3 → ✅ Moderate improvement → acceptable performance.

3 ≤ FOI < 5 → 🔥 Significant improvement → very effective treatment.

FOI ≥ 5 → 🚀 Exceptional improvement → outstanding fracturing success.

These thresholds match industry reports and audit expectations for KPI categorization.

<div class="note-card">
                <h3>📐 Formula Explanation</h3>
                <ul class ="note-list">
                 <li>The formula used is: <strong>Fold of Increase = ln(r<sub>e</sub>/r<sub>w</sub>) / [ln(r<sub>e</sub>/r<sub>w</sub>) + S<sub>f</sub>]</strong></li>
                   <li>This equation compares the productivity index of a fractured well to that of a non-fractured well.</li>
                   <li>The natural logarithm (ln) represents the flow geometry in radial flow systems.</li>
                </ul>
            </div>
-->