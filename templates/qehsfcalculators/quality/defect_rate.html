{% extends 'base.html' %}
{% block title %}Defect Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Defect Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Defect Rate Calculator</h1>
            <p>Calculates the percentage of defective items in a production batch to help monitor and improve manufacturing quality</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="defectiveItems">Defective Items</label>
                    <input type="number" id="defectiveItems" class="form-input" min="0" placeholder="Enter number of defective items">
                </div>

                <div class="form-group">
                    <label for="totalItems">Total Items Produced</label>
                    <input type="number" id="totalItems" class="form-input" min="1" placeholder="Enter total items produced">
                </div>

                <button class="calculate-btn" onclick="calculateDefectRate()">Calculate Defect Rate</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Quality control illustration">
                    <p>This tool calculates the <strong>Defect Rate (%)</strong>. Enter the number of defective items and total items produced to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Defect Rate</h2>
                    </div>
                    <div class="rate-value" id="defectRateValue">0.00</div>
                    <div class="rate-label"><strong>%</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="qualityFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
       <div class="note-section">

  <div class="note-card">
    <h3>🔎 About This Calculator</h3>
    <p>
      The <strong>Defect Rate Calculator</strong> calculates the percentage of defective items in a production batch. 
      It helps manufacturers monitor product quality, identify potential process issues, and make data-driven decisions for process improvement.
      By analyzing defect rates, organizations can achieve higher production efficiency, minimize waste, and improve customer satisfaction.
    </p>
  </div>

  <div class="note-card">
            <h3>⚙️ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Defective Items:</strong> The number of units that do not meet quality standards due to material flaws, process errors, or equipment failures.</li>
      <li><strong>Total Items Produced:</strong> The total number of units manufactured, including both defect-free and defective items.</li>
    </ul>
  </div>

  <div class="note-card">
  <h3>📌 Input Validation Rules</h3>
  <ul class="note-list">
    <li><strong>Defective Items:</strong> Required; must be provided (≥ 0). Negative values are invalid. Decimals allowed up to 2 places for partial defect tracking, though whole numbers are preferred. Defective items cannot exceed total items produced.</li>
    <li><strong>Total Items Produced:</strong> Required; must be provided (> 0). Only whole numbers are valid (no fractional units). Extremely large values (e.g., > 1,000,000) should trigger warnings for verification.</li>
    <li><strong>Cross-Field Logic:</strong> Defective Items ≤ Total Items Produced must always hold true.</li>
    <li><strong>Realistic Range:</strong> For most industries, defect counts ≤ 10% of production are expected. If defect rate exceeds 20%, a serious quality concern warning is triggered.</li>
    <li><strong>Units:</strong> Both inputs represent count of items in production.</li>
  </ul>
</div>
  <div class="note-card">
    <h3>📊 Output Validations</h3>
    <p>If Defect Rate</p>
    <ul class="note-list">
      <li><strong>0%:</strong> ✅ Excellent! Perfect quality (Six Sigma level). Maintain current processes.</li>
      <li><strong>0.1% – 0.1%:</strong> ✅ World-class manufacturing quality. Near Six Sigma performance.</li>
      <li><strong>0.1% – 1%:</strong> 👍 Very Good quality. Minor improvements possible.</li>
      <li><strong>1% – 3%:</strong> 🙂 Acceptable quality. Implement continuous improvement measures.</li>
      <li><strong>3% – 5%:</strong> ⚠️ Moderate concern. Investigate root causes and implement corrective actions.</li>
      <li><strong>5% – 10%:</strong> 🚨 High defect rate. Immediate corrective action required. Review quality control processes.</li>
      <li><strong>> 10%:</strong> 🔥 Critical failure! Consider production halt. Full quality system audit required.</li>
    </ul>
</div>


  <div class="note-card">
    <h3>📐 Governance Principles</h3>
    <p>
      The <strong>Defect Rate Calculator</strong> is based on the <strong>Six Sigma</strong> methodology, particularly DPMO (Defects per Million Opportunities) and Sigma Level standards. 
      Six Sigma provides a structured framework for defining, measuring, and analyzing process performance to achieve near-perfect quality. 
      Using this calculator ensures traceable, audit-friendly assessment of production quality and aligns with regulatory and organizational compliance standards.
    </p>
  </div>

  <div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
      Monitoring defect rates is critical for maintaining high product quality, operational efficiency, and customer satisfaction. 
      By regularly calculating and analyzing defect rates, manufacturers can identify issues early, implement corrective actions, and continuously improve their production processes. 
      This ensures minimized waste, optimized quality control, and compliance with industry standards such as ISO 9001 and Six Sigma.
    </p>
  </div>

</div>

    </div>
<script>
    function calculateDefectRate() {
        const defectiveItems = document.getElementById("defectiveItems").value.trim();
        const totalItems = document.getElementById("totalItems").value.trim();

        const errorBox = document.getElementById('resultError');
        const errorMessage = document.getElementById('errorMessage');
        const placeholder = document.getElementById('placeholder');
        const resultValue = document.getElementById('resultValue');
        const outputValue = document.getElementById('defectRateValue');
        const feedbackBox = document.getElementById('qualityFeedback'); 

        let errors = [];
        let warnings = [];

        // ✅ Defective Items validation
        if (defectiveItems === "") {
            errors.push("👉 Please enter the number of defective items.");
        } else if (isNaN(defectiveItems) || !/^\d*\.?\d*$/.test(defectiveItems)) {
            errors.push("👉 Defective items must be a valid number.");
        } else if (parseFloat(defectiveItems) < 0) {
            errors.push("👉 Defective items cannot be negative.");
        } else if (parseFloat(defectiveItems) % 1 !== 0 && defectiveItems.split('.')[1].length > 2) {
            warnings.push("Defective items typically recorded as whole numbers. Decimal values suggest partial defects.");
        }

        // ✅ Total Items validation
        if (totalItems === "") {
            errors.push("👉 Please enter the total items produced.");
        } else if (isNaN(totalItems) || !/^\d+$/.test(totalItems)) {
            errors.push("👉 Total items must be a whole number.");
        } else if (parseInt(totalItems) <= 0) {
            errors.push("👉 Total items must be greater than 0.");
        } else if (parseInt(totalItems) > 1000000) {
            warnings.push("Extremely high production quantity. Verify this is correct.");
        }

        // Check if defective items exceed total items
        if (defectiveItems && totalItems && parseFloat(defectiveItems) > parseFloat(totalItems)) {
            errors.push("👉 Defective items cannot exceed total items produced.");
        }

        // Check for unrealistic defect rates in advance
        if (defectiveItems && totalItems && parseFloat(totalItems) > 0) {
            const preliminaryRate = (parseFloat(defectiveItems) / parseFloat(totalItems)) * 100;
            if (preliminaryRate > 20) {
                warnings.push("Extremely high defect rate detected. Verify inputs or consider production halt.");
            } else if (preliminaryRate > 10) {
                warnings.push("High defect rate detected. Immediate corrective action recommended.");
            }
        }

        // Show errors
        if (errors.length > 0) {
            errorMessage.innerHTML = errors.join("<br>");
            if (warnings.length > 0) {
                errorMessage.innerHTML += "<br><br>⚠️ " + warnings.join("<br>⚠️ ");
            }
            errorBox.classList.remove("hidden");
            placeholder.classList.add("hidden");
            resultValue.classList.add("hidden");
            return;
        } else {
            errorBox.classList.add("hidden");
        }

        const defectiveNum = parseFloat(defectiveItems);
        const totalNum = parseFloat(totalItems);

        // ✅ Calculate defect rate
        const defectRate = (defectiveNum / totalNum) * 100;
        outputValue.textContent = defectRate.toFixed(2);

        // ✅ Feedback messages based on defect rate with industry standards
        let feedback = "";
        let severity = "normal";
        
        if (defectRate === 0) {
            feedback = "✅ Excellent! Perfect quality (Six Sigma level). Maintain current processes.";
            severity = "excellent";
        } else if (defectRate <= 0.1) {
            feedback = "✅ World-class manufacturing quality. Near Six Sigma performance.";
            severity = "excellent";
        } else if (defectRate <= 1) {
            feedback = "👍 Very Good quality. Minor improvements possible.";
            severity = "good";
        } else if (defectRate <= 3) {
            feedback = "🙂 Acceptable quality. Implement continuous improvement measures.";
            severity = "acceptable";
        } else if (defectRate <= 5) {
            feedback = "⚠️ Moderate concern. Investigate root causes and implement corrective actions.";
            severity = "moderate";
        } else if (defectRate <= 10) {
            feedback = "🚨 High defect rate. Immediate corrective action required. Review quality control processes.";
            severity = "high";
        } else {
            feedback = "🔥 Critical failure! Consider production halt. Full quality system audit required.";
            severity = "critical";
        }
        
        // Add any warnings to feedback
        if (warnings.length > 0) {
            feedback += " | Note: " + warnings.join(" ");
        }

        // Apply severity coloring
        if (severity === "excellent") {
            outputValue.style.color = "#27ae60";
        } else if (severity === "good") {
            outputValue.style.color = "#2ecc71";
        } else if (severity === "acceptable") {
            outputValue.style.color = "#f39c12";
        } else if (severity === "moderate") {
            outputValue.style.color = "#e67e22";
        } else if (severity === "high") {
            outputValue.style.color = "#e74c3c";
        } else if (severity === "critical") {
            outputValue.style.color = "#c0392b";
            outputValue.style.textShadow = "0 0 5px rgba(192, 57, 43, 0.5)";
        }

        feedbackBox.textContent = feedback;

        placeholder.classList.add('hidden');
        resultValue.classList.remove('hidden');
    }
    
    function printReport() {
        window.print();
    }
</script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
======Input Validation Rules========
Defective Items:
Required: Must be provided (cannot be empty)

Minimum: ≥ 0 (negative values are impossible)

Maximum: Should not exceed total items produced

Decimals: Allow up to 2 decimal places for partial defect tracking

Realistic Range: For most industries, defect counts should be ≤ 10% of total production

Units: Count of items (whole numbers preferred, but decimals allowed for partial defects)

Total Items Produced:
Required: Must be provided (cannot be empty)

Minimum: > 0 (production must have occurred)

Maximum: Realistic production limits based on industry (e.g., ≤ 1,000,000 for most manufacturing)

Decimals: Whole numbers only (cannot produce fractional items)

Units: Count of items

Cross-field Validation:
Defective items ≤ Total items produced

If defect rate > 20%, trigger serious quality concern warning

==========Output Validation & Industry Standards=======================
Defect Rate (%) = (Defective Items / Total Items Produced) × 100

Industry Standard Thresholds:

0%: Perfect quality (Six Sigma goal)

< 0.1%: World-class manufacturing (Six Sigma level)

0.1-1%: Excellent quality

1-3%: Good, with room for improvement

3-5%: Moderate concern (requires investigation)

5-10%: High concern (immediate corrective action needed)

>10%: Critical failure (production halt may be required)

===============Edge Case Validations========================
Division by zero (total items = 0)

Defective items > total items (logical impossibility)

Extremely high values that exceed realistic production capabilities

Negative values

Non-numeric inputs

Decimal values where inappropriate

=================Compliance Importance=====================
Each validation ensures:

Data integrity for audit trails (ISO 9001 requirement)

Realistic measurements for accurate quality reporting

Early warning of quality system failures

Compliance with regulatory record-keeping standards

Actionable insights for continuous improvement processes
--------------------------------------------------------------------------------------------
FORMULA:

    Defect Rate (%) = (Defective Items / Total Items Produced) × 100

-->