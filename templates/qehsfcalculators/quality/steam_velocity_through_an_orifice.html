{% extends 'base.html' %}
{% block title %}Steam Velocity through an Orifice Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam Velocity through an Orifice Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Steam Velocity Through An Orifice Calculator</h1>
            <p>Calculates the velocity of steam passing through an orifice based on the heat drop per unit mass (J/kg)</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="heatDrop">Heat Drop (h) (J/kg)</label>
                    <input type="number" id="heatDrop" class="form-input" min="0" placeholder="Enter heat drop">
                </div>

                <button class="calculate-btn" onclick="calculateSteamVelocity()">Calculate Velocity</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Orifice">
                    <p>This tool calculates the <strong>velocity of steam</strong> in m/s. Enter your heat drop value to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Steam Velocity</h2>
                    </div>
                    <div class="rate-value" id="velocityValue">0.00</div>
                    <div class="rate-label"><strong>m/s</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Steam Velocity Interpretation</div>
                        <div class="feedback-content" id="velocityFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">

    <!-- About the Calculator -->
    <div class="note-card">
        <h3>🔎 About This Calculator</h3>
        <p>
            The <strong>Steam Velocity Calculator</strong> estimates the speed of steam passing through an orifice using the heat drop per unit mass (J/kg). 
            It helps engineers design efficient steam systems and ensure proper expansion processes.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>❓ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Heat Drop (h):</strong> Energy lost per unit mass due to expansion, measured in J/kg.</li>
            <li><strong>Velocity (u):</strong> Steam speed exiting the orifice, measured in meters per second (m/s).</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>📌 Input Validation Rules</h3>
        <ul class="note-list">
            <li>Heat Drop: Required, numeric, &gt; 0 J/kg.</li>
            <li>Typical range: 100,000–2,000,000 J/kg.</li>
            <li>Maximum physical limit: 10,000,000 J/kg (hard stop for unrealistic inputs).</li>
            <li>Soft warnings for inputs below 100,000 J/kg or above 2,000,000 J/kg.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>Velocity &lt;100 m/s → Low, risk of poor turbine/valve performance.</li>
            <li>100–300 m/s → Normal, safe operational range.</li>
            <li>300–600 m/s → High, monitor erosion and vibration.</li>
            <li>&gt;600 m/s → Very high, unsafe; recheck system design and safety controls.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
<div class="note-card">
    <h3>⚖️ Governing Principle</h3>
    <p>
        The density of steam is governed by the relationship between its <strong>specific volume of dry steam (v<sub>g</sub>)</strong> and the <strong>dryness fraction (χ)</strong>. 
        Mathematically, the principle is expressed as:
    </p>
    <p style="text-align:center; font-weight:bold;">
        ρ = 1 / (v<sub>g</sub> × χ)
    </p>
    <p>
        Where ρ is the steam density in kg/m³. This principle ensures that the mass per unit volume of steam accounts for both the vapor and liquid phases. 
        Accurate determination of steam density is essential for energy calculations, flow design, and process safety in thermal systems.
    </p>
</div>


    <!-- Conclusion -->
    <div class="note-card">
        <h3>💡 Conclusion</h3>
        <p>
            Calculating steam velocity is essential in thermal engineering for designing and optimizing steam systems. 
            It enables proper energy conversion, system sizing, and adherence to safety standards, while minimizing operational risks like erosion or inadequate pressure control.
        </p>
    </div>

</div>

    </div>

    <script>function calculateSteamVelocity() {
    const heatDropInput = document.getElementById("heatDrop").value.trim();
    
    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const velocityValue = document.getElementById('velocityValue');
    const feedbackBox = document.getElementById('velocityFeedback'); 
    
    let errors = [];
    let warnings = [];

    // ✅ Validation: Required
    if (heatDropInput === "") {
        errors.push("👉 Heat drop is required (J/kg).");
    }

    // ✅ Validation: Numeric
    const heatDrop = parseFloat(heatDropInput);
    if (!isNaN(heatDropInput) && isNaN(heatDrop)) {
        errors.push("👉 Heat drop must be a valid number.");
    }

    // ✅ Validation: Positive only
    if (!isNaN(heatDrop) && heatDrop <= 0) {
        errors.push("👉 Heat drop must be greater than 0 J/kg.");
    }

    // ✅ Validation: Realistic hard limits
    if (heatDrop > 10000000) {
        errors.push("❌ Input exceeds physical steam limits (>10,000,000 J/kg). Check units.");
    }

    // ✅ Soft warnings: Engineering ranges
    if (heatDrop < 100000 && heatDrop > 0) {
        warnings.push("⚠️ Heat drop is lower than typical steam expansion (<100,000 J/kg).");
    } else if (heatDrop > 2000000 && heatDrop <= 10000000) {
        warnings.push("⚠️ Heat drop is above normal design limit (>2,000,000 J/kg). Verify input.");
    }

    // ✅ Error Handling
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ✅ Calculate Velocity
    const velocity = Math.sqrt(2 * heatDrop);
    if (!isFinite(velocity)) {
        errors.push("❌ Calculation failed. Please check input.");
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        return;
    }

    velocityValue.textContent = velocity.toFixed(2);

    // ✅ Output Feedback
    let feedback = "";
    if (velocity < 100) {
        feedback = "⚠️ Low Velocity (< 100 m/s) – Risk of poor turbine/valve performance.";
    } else if (velocity < 300) {
        feedback = "✅ Normal Velocity (100 – 300 m/s) – Safe operational range.";
    } else if (velocity < 600) {
        feedback = "🔥 High Velocity (300 – 600 m/s) – Monitor erosion and vibration.";
    } else {
        feedback = "🚨 Very High Velocity (>600 m/s) – Unsafe. Recheck system design and safety controls.";
    }

    if (warnings.length > 0) {
        feedback += " | " + warnings.join(" ");
    }

    feedbackBox.textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
*-----------Input Validation Rules (Industry Standards)-----------------*
Input: Heat Drop (h) in J/kg

Required field: Cannot be empty or null. Missing values invalidate the calculation.

Numeric only: Must be a valid number (float or integer).

Positive only: Heat drop represents energy released → cannot be negative or zero.

Realistic engineering range:

Minimum threshold: 100,000 J/kg (≈ latent heat differences in steam).

Maximum threshold: 2,000,000 J/kg (extreme superheated conditions).

Outside this → flagged as “warning” but still calculable (edge testing).

Precision: Allow up to 2 decimals (e.g., 150,000.25 J/kg). More decimals aren’t practical.

Units: Must be J/kg. If user mistakenly enters kJ/kg or cal/g, results are unsafe → require note in UI.

*---------- 2. Output Validation Logic & Thresholds--------------*

Formula:

𝑢
=
2
ℎ
u=
2h
	​


Where:

u = velocity of steam (m/s)

h = heat drop (J/kg)

Realistic velocity ranges:

< 100 m/s → Too low → may indicate improper expansion or insufficient turbine drive.

100 – 300 m/s → Normal safe operational range (common in industrial turbines, boiler orifices).

300 – 600 m/s → High → must check erosion, vibration, noise, and piping material selection.

> 600 m/s → Critical → shock waves, mechanical stress, possible orifice failure. Red-flag for safety compliance.

*---------- 3. Edge Case Validations----------*

Empty input → Block calculation with error message.

Non-numeric input (text, symbols, NaN) → Block calculation.

Zero or negative input → Physically impossible → error.

Extremely low (e.g., < 1000 J/kg) → Warning → too small to represent actual steam expansion.

Extremely high (> 10,000,000 J/kg) → Hard block (invalid, exceeds any thermodynamic limit).

Infinity or NaN output (JS calculation bug) → Fail-safe → “Invalid calculation, check inputs.”

Unrealistic combination → If heat drop < 100,000 J/kg but velocity feedback says “High” → cross-check consistency.

*-----------------------------------------------------------------------------------------*
            <div class="note-card formula-card">
                <h3>📐 Formula</h3>
                <p>The velocity of steam through an orifice is calculated using:</p>
                <code>u = √(2 × h)</code>
                <p>Where:</p>
                <ul class="note-list">
                    <li><strong>u</strong> = Velocity of steam (m/s)</li>
                    <li><strong>h</strong> = Heat drop (J/kg)</li>
                </ul>
            </div>

-->