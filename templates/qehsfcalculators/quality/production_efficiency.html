{% extends 'base.html' %}
{% block title %}Production Efficiency Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Efficiency Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        
        .result-card::-webkit-scrollbar {
            width: 8px;
        }

        .result-card::-webkit-scrollbar-thumb {
            background: #1560bd;
            border-radius: 6px;
        }

        .result-card::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .result-card {
            justify-content: flex-start; /* align from top */
            align-items: stretch;
            min-height: 420px;
            text-align: center;
            overflow-y: auto;       /* Enable vertical scrolling */
            max-height: 450px;      /* Set max height to control output size */
            padding: 20px;          /* keep spacing */
        }

        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
        
        /* Efficiency specific styles */
        .efficiency-results {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .efficiency-result-item {
            background: linear-gradient(135deg, #1560bd, #000040);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .efficiency-result-item h3 {
            margin: 0 0 10px;
            font-size: 18px;
        }
        
        .efficiency-result-value {
            font-size: 32px;
            font-weight: 700;
        }
        
        .feedback-alert {
            background: #e3f2fd;
            border-left: 4px solid #1976d2;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            text-align: left;
        }
        
        .good-efficiency {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }
        
        .fair-efficiency {
            background: #fff3e0;
            border-left-color: #ff9800;
        }
        
        .poor-efficiency {
            background: #ffebee;
            border-left-color: #f44336;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Production Efficiency Calculator</h1>
            <p>Calculates production efficiency based on output, standard time values, manpower, and working time</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="pcs">Production (PCs)</label>
                    <input type="number" id="pcs" class="form-input" min="0" step="1" placeholder="Enter production count">
                </div>

                <div class="form-group">
                    <label for="smv">Standard Minute Value (SMV)</label>
                    <input type="number" id="smv" class="form-input" min="0" step="0.01" placeholder="Enter SMV">
                </div>

                <div class="form-group">
                    <label for="manpower">Manpower (HEL + OPR)</label>
                    <input type="number" id="manpower" class="form-input" min="0" step="1" placeholder="Enter manpower count">
                </div>

                <div class="form-group">
                    <label for="workingTime">Working Time (Minutes)</label>
                    <input type="number" id="workingTime" class="form-input" min="0" step="1" placeholder="Enter working minutes">
                </div>

                <button class="calculate-btn" onclick="calculateEfficiency()">Calculate Efficiency</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Production efficiency illustration">
                    <p>This tool calculates <strong>production efficiency</strong>. Enter your production data to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:15px; color:#1560bd;">
                        <h2>Production Efficiency Results</h2>
                    </div>
                    
                    <div class="efficiency-results">
                        <div class="efficiency-result-item">
                            <h3>Efficiency</h3>
                            <div class="efficiency-result-value" id="efficiencyValue">0.00%</div>
                        </div>
                    </div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Efficiency Interpretation</div>
                        <div class="feedback-content" id="efficiencyFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>üîé About This Calculator</h3>
                <p>
                    The <strong>Production Efficiency Calculator</strong> measures how effectively labor and time are utilized in manufacturing and production processes. A higher efficiency percentage indicates better productivity and optimized resource usage, which is essential for quality management and cost control.
                </p> 
            </div>
            
            <div class="note-card">
                <h3>üìå Input Validations</h3>
                <ul class="note-list">
                    <li><strong>Production (PCs):</strong> Required, must be ‚â• 0</li>
                    <li><strong>Standard Minute Value (SMV):</strong> Required, must be > 0</li>
                    <li><strong>Manpower (HEL + OPR):</strong> Required, must be > 0</li>
                    <li><strong>Working Time (Minutes):</strong> Required, must be > 0</li>
                    <li><strong>Realistic Ranges:</strong> Values should reflect actual production scenarios</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>‚ùì Explanation of Parameters</h3>
                <ul class="note-list">
                    <li><strong>Production (PCs):</strong> The total number of units produced during the measured period.</li>
                    <li><strong>Standard Minute Value (SMV):</strong> The predetermined time allowed to complete a specific task or produce one unit, measured in minutes.</li>
                    <li><strong>Manpower (HEL + OPR):</strong> The total number of workers (helpers + operators) involved in the production process.</li>
                    <li><strong>Working Time (Minutes):</strong> The total time available for production during the measured period.</li>
                    <li><strong>Efficiency:</strong> The ratio of earned minutes (PCs √ó SMV) to available minutes (Manpower √ó Working Time), expressed as a percentage.</li>
                </ul>
            </div>
            
           

            <div class="note-card">
                <h3>üìä Efficiency Interpretation Guidelines</h3>
                <ul class="note-list">
                    <li><strong>Efficiency < 50%:</strong> Poor performance - requires immediate process improvement</li>
                    <li><strong>Efficiency 50-75%:</strong> Below target - needs optimization</li>
                    <li><strong>Efficiency 75-90%:</strong> Good performance - meeting expectations</li>
                    <li><strong>Efficiency 90-100%:</strong> Excellent performance - optimal resource utilization</li>
                    <li><strong>Efficiency > 100%:</strong> Exceptional performance - may indicate underestimated SMV or extraordinary effort</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üè≠ Real-Life Applications</h3>
                <ul class="note-list">
                    <li><strong>Manufacturing:</strong> Monitor production line performance and identify bottlenecks</li>
                    <li><strong>Quality Management:</strong> Correlate efficiency with defect rates and quality issues</li>
                    <li><strong>Resource Planning:</strong> Optimize manpower allocation based on efficiency data</li>
                    <li><strong>Performance Incentives:</strong> Use efficiency metrics for reward systems</li>
                    <li><strong>Continuous Improvement:</strong> Track efficiency trends over time to measure improvement initiatives</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>üí° Conclusion</h3>
                <p>Production efficiency is a critical Key Performance Indicator (KPI) for any manufacturing operation. By regularly calculating and monitoring efficiency, organizations can identify improvement opportunities, optimize resource allocation, reduce waste, and increase profitability. Maintaining efficiency above 75% is generally considered good practice, while consistently achieving over 90% indicates world-class manufacturing operations.</p>
            </div>
        </div>
    </div>

    <script>
        function calculateEfficiency() {
            // Get input values
            const pcsInput = document.getElementById("pcs").value.trim();
            const smvInput = document.getElementById("smv").value.trim();
            const manpowerInput = document.getElementById("manpower").value.trim();
            const workingTimeInput = document.getElementById("workingTime").value.trim();

            // Get DOM elements for results and errors
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');
            const efficiencyValue = document.getElementById('efficiencyValue');
            const feedbackBox = document.getElementById('efficiencyFeedback'); 

            let errors = [];
            let warnings = [];

            // Validate inputs
            if (pcsInput === "") {
                errors.push("üëâ Please enter Production (PCs).");
            } else if (isNaN(pcsInput)) {
                errors.push("üëâ Production must be a number.");
            } else if (parseFloat(pcsInput) < 0) {
                errors.push("üëâ Production cannot be negative.");
            }

            if (smvInput === "") {
                errors.push("üëâ Please enter Standard Minute Value (SMV).");
            } else if (isNaN(smvInput)) {
                errors.push("üëâ SMV must be a number.");
            } else if (parseFloat(smvInput) <= 0) {
                errors.push("üëâ SMV must be greater than 0.");
            } else if (parseFloat(smvInput) > 1000) {
                warnings.push("‚ö†Ô∏è SMV is unusually high (> 1000 minutes). Verify this value.");
            }

            if (manpowerInput === "") {
                errors.push("üëâ Please enter Manpower.");
            } else if (isNaN(manpowerInput)) {
                errors.push("üëâ Manpower must be a number.");
            } else if (parseFloat(manpowerInput) <= 0) {
                errors.push("üëâ Manpower must be greater than 0.");
            } else if (parseFloat(manpowerInput) > 1000) {
                warnings.push("‚ö†Ô∏è Manpower is unusually high (> 1000 workers). Verify this value.");
            }

            if (workingTimeInput === "") {
                errors.push("üëâ Please enter Working Time.");
            } else if (isNaN(workingTimeInput)) {
                errors.push("üëâ Working Time must be a number.");
            } else if (parseFloat(workingTimeInput) <= 0) {
                errors.push("üëâ Working Time must be greater than 0.");
            } else if (parseFloat(workingTimeInput) > 1440) {
                warnings.push("‚ö†Ô∏è Working Time exceeds 24 hours (1440 minutes). Verify this value.");
            }

            // Show errors if any
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // Parse values
            const pcs = parseFloat(pcsInput);
            const smv = parseFloat(smvInput);
            const manpower = parseFloat(manpowerInput);
            const workingTime = parseFloat(workingTimeInput);

            // Calculate efficiency
            const earnedMinutes = pcs * smv;
            const availableMinutes = manpower * workingTime;
            const efficiency = (earnedMinutes / availableMinutes) * 100;

            // Update result display
            efficiencyValue.textContent = efficiency.toFixed(2) + "%";

            // Generate feedback
            let feedback = "";
            
            // Add calculation details
            feedback += `<div class="feedback-alert">
                <strong>Calculation Details:</strong><br>
                Earned Minutes = ${pcs} PCs √ó ${smv} min/PC = ${earnedMinutes.toFixed(2)} min<br>
                Available Minutes = ${manpower} workers √ó ${workingTime} min = ${availableMinutes.toFixed(2)} min<br>
                Efficiency = (${earnedMinutes.toFixed(2)} / ${availableMinutes.toFixed(2)}) √ó 100% = ${efficiency.toFixed(2)}%
            </div>`;
            
            // Add efficiency interpretation
            if (efficiency < 50) {
                feedback += `<div class="feedback-alert poor-efficiency">
                    <strong>Poor Efficiency (${efficiency.toFixed(2)}%)</strong><br>
                    Immediate process improvement required. This level of efficiency indicates significant waste, bottlenecks, or operational issues that need to be addressed.
                </div>`;
            } else if (efficiency < 75) {
                feedback += `<div class="feedback-alert fair-efficiency">
                    <strong>Below Target Efficiency (${efficiency.toFixed(2)}%)</strong><br>
                    Performance is below expectations.
                </div>`;
            } else if (efficiency < 90) {
                feedback += `<div class="feedback-alert">
                    <strong>Good Efficiency (${efficiency.toFixed(2)}%)</strong><br>
                    Performance meets expectations. Continue monitoring and look for incremental improvement opportunities.
                </div>`;
            } else if (efficiency <= 100) {
                feedback += `<div class="feedback-alert good-efficiency">
                    <strong>Excellent Efficiency (${efficiency.toFixed(2)}%)</strong><br>
                    Performance exceeds expectations. This indicates optimal resource utilization and effective processes.
                </div>`;
            } else {
                feedback += `<div class="feedback-alert">
                    <strong>Exceptional Efficiency (${efficiency.toFixed(2)}%)</strong><br>
                    Performance significantly exceeds expectations. Verify that SMV is accurately calibrated, as values over 100% may indicate underestimated standard times.
                </div>`;
            }
            
            // Add warnings if any
            if (warnings.length > 0) {
                warnings.forEach(warning => {
                    feedback += `<div class="feedback-alert" style="background: #fff3e0; border-left-color: #ff9800;">${warning}</div>`;
                });
            }
            
            // Add QEHS note
            feedback += `<div class="feedback-alert">
                <strong>QEHS Note:</strong> Maintaining optimal efficiency reduces operational stress, minimizes safety risks from rushed work, and supports sustainable production practices. Consistently low efficiency may indicate underlying safety or quality issues that require investigation.
            </div>`;
            
            feedbackBox.innerHTML = feedback;

            // Show results
            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }
        
        function printReport() {
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--Input Validation Rules:
Production (PCs)

Required field

Must be a valid number ‚â• 0

Realistic range: 0 to 1,000,000 units (depends on industry)

Decimal precision: Allow integers only (no decimal units produced)

Zero is acceptable (may indicate production issues needing investigation)

Standard Minute Value (SMV)

Required field

Must be a valid number > 0

Realistic range: 0.1 to 120 minutes (typical manufacturing operations)

Maximum threshold: 480 minutes (8-hour shift for one unit - requires validation)

Decimal precision: Allow up to 2 decimal places

Manpower (HEL + OPR)

Required field

Must be a valid number > 0

Realistic range: 1 to 500 workers (depends on facility size)

Maximum threshold: 1000 workers (requires validation for large facilities)

Decimal precision: Integers only (partial workers not possible)

Working Time (Minutes)

Required field

Must be a valid number > 0

Realistic range: 1 to 1440 minutes (24-hour period)

Maximum threshold: 10080 minutes (7-day week - requires validation)

Decimal precision: Allow up to 2 decimal places for precision timing

Cross-Field Dependencies:
SMV should be reasonable for the type of production (e.g., < 60 minutes for most discrete manufacturing)

Working time should align with shift patterns (e.g., 480 minutes for 8-hour shift)

Manpower should be proportional to production volume

=====================Edge Cases:=======================
Division by zero if available minutes = 0

Extremely high efficiency (>150%) may indicate data errors

Zero production with positive working time (indicates production issues)

Unrealistic SMV values (e.g., < 0.01 minutes or > 8 hours per unit)
====================================================================================
Output Validation & Interpretation
From a QEHS perspective, efficiency values should be interpreted as:

Efficiency < 50%: Critical concern - indicates serious operational problems, potential safety risks from rushed work or inadequate training

Efficiency 50-75%: Below target - requires process improvement investigation

Efficiency 75-90%: Good performance - sustainable operation

Efficiency 90-110%: Excellent performance - optimal utilization

Efficiency > 110%: Potential data error or unsustainable pace that may compromise safety
-->