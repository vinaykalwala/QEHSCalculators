{% extends 'base.html' %}
{% block title %}The Turndown Ratio Of A Steam Flowmeter Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To Determine The Turndown Ratio Of A Steam Flowmeter Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
     <div class="btn-container">
    <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
</div>

   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>The Turndown Ratio Of A Steam Flowmeter Calculator</h1>
            <p>Calculates the turndown ratio of a steam flowmeter based on its maximum and minimum measurable flow rates</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="maxFlow">Maximum Flow (m³/hr)</label>
                    <input type="number" id="maxFlow" class="form-input" min="0" placeholder="Enter maximum steam flow">
                </div>

                <div class="form-group">
                    <label for="minFlow">Minimum Flow (m³/hr)</label>
                    <input type="number" id="minFlow" class="form-input" min="0" placeholder="Enter minimum steam flow">
                </div>

                <button class="calculate-btn" onclick="calculateTurndown()">Calculate Turndown Ratio</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Flowmeter illustration">
                    <p>This tool calculates the <strong>turndown ratio</strong> of a steam flowmeter. Enter your maximum and minimum flow values to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Turndown Ratio</h2>
                    </div>
                    <div class="rate-value" id="turndownValue">0.00</div>
                    <div class="rate-label"><strong>Ratio</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Flowmeter Performance Interpretation</div>
                        <div class="feedback-content" id="turndownFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>🔎 About This Calculator</h3>
                <p>
                    The <strong>Turndown Ratio Calculator</strong> determines the operational range of a steam flowmeter by comparing its maximum and minimum measurable flow rates. A higher turndown ratio indicates better flexibility and precision in measuring varying steam flow rates.
                </p> 
            </div>
            
            <div class="note-card">
                <h3>📌 Input Validations</h3>
                <ul class="note-list">
                    <li><strong>Maximum Flow (m³/hr):</strong> Required, must be > 0</li>
                    <li><strong>Minimum Flow (m³/hr):</strong> Required, must be > 0</li>
                    <li><strong>Maximum Flow:</strong> Must be greater than Minimum Flow</li>
                    <li><strong>Realistic Values:</strong> Flow rates should be within the flowmeter's specified operating range</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>❓ Explanation of Parameters</h3>
                <ul class="note-list">
                    <li><strong>Maximum Flow:</strong> The highest measurable steam flow rate (m³/hr) that the flowmeter can accurately measure.</li>
                    <li><strong>Minimum Flow:</strong> The lowest measurable steam flow rate (m³/hr) that the flowmeter can accurately measure.</li>
                    <li><strong>Turndown Ratio:</strong> The ratio of maximum to minimum flow, indicating the accuracy and flexibility of the flowmeter.</li>
                </ul>
            </div>
            

            <div class="note-card">
                <h3>📊 Real-Life Applications</h3>
                <ul class="note-list">
                    <li><strong>Power Plants:</strong> Used to measure steam flow in boilers.</li>
                    <li><strong>Food Industry:</strong> Monitors steam usage in sterilization and cooking processes.</li>
                    <li><strong>Petrochemical Plants:</strong> Ensures accurate steam flow control in refining operations.</li>
                    <li><strong>HVAC Systems:</strong> Helps in steam-based heating system efficiency.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>💡 Conclusion</h3>
                <p>A high turndown ratio means the flowmeter can measure a wide range of flows effectively. If the ratio is too low, the system may lack flexibility and accuracy. Selecting the right flowmeter ensures efficiency, cost savings, and reliable process control in steam systems.</p>
            </div>
        </div>
    </div>

    <script>
        function calculateTurndown() {
    const maxFlow = document.getElementById("maxFlow").value.trim();
    const minFlow = document.getElementById("minFlow").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const outputValue = document.getElementById('turndownValue');
    const feedbackBox = document.getElementById('turndownFeedback'); 

    let errors = [];

    // Empty check
    if (!maxFlow || !minFlow) {
        errors.push("👉 Please enter both maximum and minimum flow values.");
    }

    // Numeric check
    if (isNaN(maxFlow) || isNaN(minFlow)) {
        errors.push("👉 Flow values must be numeric.");
    }

    const maxFlowNum = parseFloat(maxFlow);
    const minFlowNum = parseFloat(minFlow);

    // Range and logical checks
    if (maxFlowNum <= 0 || minFlowNum <= 0) {
        errors.push("👉 Flow values must be greater than zero.");
    }
    if (maxFlowNum <= minFlowNum) {
        errors.push("👉 Maximum flow must be greater than minimum flow.");
    }
    if (minFlowNum < 0.1) {
        errors.push("👉 Minimum flow too small – below realistic industrial range (<0.1 m³/hr).");
    }
    if (maxFlowNum > 10000) {
        errors.push("👉 Maximum flow exceeds typical steam flowmeter capacity (>10,000 m³/hr).");
    }

    // Division by zero / unrealistic ratio check
    if (minFlowNum > 0) {
        const turndownRatioCheck = maxFlowNum / minFlowNum;
        if (turndownRatioCheck > 1000) {
            errors.push("👉 Turndown ratio exceeds realistic operational range (>1000).");
        }
    }

    // Show errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Calculate ratio
    const turndownRatio = maxFlowNum / minFlowNum;
    outputValue.textContent = turndownRatio.toFixed(2);

    // Feedback based on thresholds
    let feedback = "";
    if (turndownRatio < 4) {
        feedback = "⚠️ Low Efficiency – Non-compliant with industry standards. Consider upgrading flowmeter.";
    } else if (turndownRatio >= 4 && turndownRatio <= 20) {
        feedback = "✔️ Acceptable Performance – Suitable for most industrial steam systems.";
    } else if (turndownRatio > 20 && turndownRatio <= 100) {
        feedback = "✅ High Performance – Advanced flowmeter with excellent flexibility.";
    } else {
        feedback = "❓ Unrealistic Result – Please review input values and units.";
    }

    feedbackBox.textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
*------------------------Input Validation Rules (Real-world QEHS & Fire Safety Context)-------------------*

Inputs: Maximum Flow (m³/hr), Minimum Flow (m³/hr)
| Rule                     | Validation                                                      | Industry Justification                                                                                                 |
| ------------------------ | --------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| **Required fields**      | Both fields must not be empty                                   | Incomplete data = non-compliant KPI reporting                                                                          |
| **Numeric only**         | Must be valid numbers (no text, special chars)                  | Prevents incorrect calculations in safety reports                                                                      |
| **Positive values only** | `> 0`                                                           | Steam flow cannot be zero or negative — would imply no flow or reverse flow                                            |
| **Reasonable ranges**    | **Min Flow:** 0.1 → 500 m³/hr<br>**Max Flow:** 1 → 10,000 m³/hr | Based on typical steam flowmeters used in power plants, petrochemical, HVAC (NFPA steam flow guidelines).              |
| **Max > Min**            | Always required                                                 | A smaller or equal max flow is physically impossible                                                                   |
| **Allowed decimals**     | Up to **2 decimal places**                                      | Sufficient accuracy for safety/efficiency reporting                                                                    |
| **Logical ratio check**  | Turndown ratio should be **between 1 and 1000**                 | Most steam flowmeters operate **1:10 → 1:50**; some advanced ultrasonic may go up to 1000. Beyond that is unrealistic. |

*---------Output Validation Logic------------------------*

The calculator output is Turndown Ratio = Max Flow ÷ Min Flow
--------------------***---------------
Thresholds & Meaningful Feedback:

< 4 → Low Efficiency / Non-compliant

Below industry baseline; in real safety audits, this signals poor meter selection, inaccurate low flow detection, risk of process inefficiency.

4 – 20 → Acceptable / Standard Compliance

Meets ISO/IEC guidelines for most industrial steam metering. Suitable for HVAC, food processing, boiler control.

20 – 100 → High Performance

Indicates advanced instrumentation (e.g., vortex, ultrasonic, Coriolis meters). Good flexibility.

> 100 → Unrealistic / Needs review

Could be calculation error, wrong unit entry, or unsafe assumption. Must flag.

*-----------Edge Case Validations--------------------*

Division by zero → If minFlow = 0 → show error: “Minimum flow cannot be zero.”

Equal values (maxFlow = minFlow) → Ratio = 1 → Flag as invalid for industrial flowmeter selection.

Extreme outliers (e.g., minFlow = 0.001, maxFlow = 10,000 → ratio = 10,000,000) → Reject as “Unrealistic input combination.”

Very small flows (<0.1 m³/hr) → Warn: “Below measurable range of most industrial steam flowmeters.”
-->