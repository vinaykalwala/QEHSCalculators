{% extends 'base.html' %}
{% block title %}Corrective Action Effectiveness (CAE) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrective Action Effectiveness (CAE) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }



        .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}
    </style>
</head>
<body>
     <div class="btn-container">
    <a href="{% url 'qualitycategory_calculators' %}" class="back-btn">Back To Quality Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Corrective Action Effectiveness (CAE) Calculator</h1>
            <p>Measures the percentage reduction in defects after implementing corrective actions to evaluate effectiveness</p>
        </div>

        <div class="calc-content">
            <!-- Calculator Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="initialDefects">Initial Defects</label>
                    <input type="number" id="initialDefects" class="form-input" min="0" placeholder="Enter initial defects">
                </div>

                <div class="form-group">
                    <label for="reducedDefects">Reduced Defects</label>
                    <input type="number" id="reducedDefects" class="form-input" min="0" placeholder="Enter reduced defects">
                </div>

                <button class="calculate-btn" onclick="calculateCAE()">Calculate CAE</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Boiler illustration">
                    <p>This tool calculates the <strong>Corrective Action Effectiveness (CAE)</strong> percentage. Enter your initial and reduced defects to see results.</p>
                </div>

                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Corrective Action Effectiveness</h2>
                    </div>
                    <div class="rate-value" id="caeValue">0.00</div>
                    <div class="rate-label"><strong>%</strong></div>
                    
                    <div class="result-feedback">
                        <div class="feedback-title">Effectiveness Interpretation</div>
                        <div class="feedback-content" id="caeFeedback"></div>
                    </div>
                    
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
           <div class="note-card">
    <h3>üîé About This Calculator</h3>
    <p>
        The <strong>Corrective Action Effectiveness (CAE) Calculator</strong> measures the percentage reduction in defects after implementing corrective actions. 
        Corrective actions are steps taken to eliminate the root causes of identified problems or nonconformities to prevent recurrence. 
        This calculator helps evaluate how effective those actions were in improving quality and reducing defects.
    </p> 
</div>

<div class="note-card">
        <h3>‚öôÔ∏è Parameters Used</h3>
  <ul class="note-list">
    <li><strong>Initial Defects:</strong> Issues found before corrective actions.</li>
    <li><strong>Reduced Defects:</strong> Issues left after corrective actions.</li>
  </ul>
</div>

          <div class="note-card">
    <h3>üìå Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Initial Defects:</strong> 
            <ul>
                <li>Required field; cannot be blank.</li>
                <li>Must be a whole number (integer), as defects are discrete countable items.</li>
                <li>Must be greater than 0 (you cannot measure effectiveness without initial defects).</li>
                <li>Maximum threshold: 1,000,000 to prevent accidental excessive input.</li>
                <li>Decimals or negative numbers are not allowed.</li>
            </ul>
        </li>
        <li><strong>Remaining Defects:</strong>
            <ul>
                <li>Required field; cannot be blank.</li>
                <li>Must be a whole number (integer); decimals not logical.</li>
                <li>Must be greater than or equal to 0.</li>
                <li>Cannot exceed the value of Initial Defects (cross-field validation).</li>
                <li>Maximum threshold: 1,000,000 to prevent accidental excessive input.</li>
            </ul>
        </li>
        <li><strong>Cross-field Logic:</strong> Remaining Defects ‚â§ Initial Defects must always hold true.</li>
    </ul>
</div>
<div class="note-card">
    <h3>üìä Output Validations</h3>
    <p> If Corrective Action Effectiveness</p>
    <ul class="note-list">
        <li><strong>‚â• 90% (Excellent):</strong> ‚úÖ Excellent! Corrective actions were highly effective.</li>
        <li><strong>70% ‚Äì 89% (Good):</strong> üëç Good effectiveness, but some improvements possible.</li>
        <li><strong>50% ‚Äì 69% (Moderate):</strong> ‚ö†Ô∏è Moderate effectiveness. Review actions for sustainability.</li>
        <li><strong>< 50% (Low):</strong> ‚ùå Low effectiveness. Corrective actions need major review.</li>
    </ul>
</div>

<div class="note-card">
    <h3>üìê Governing Principle</h3>
    <p>
        The <strong>Corrective Action Effectiveness (CAE) Calculator</strong> aligns with international quality and regulatory standards to ensure process improvement is measurable and compliant. 
        Relevant standards include: 
    </p>
    <ul class="note-list">
        <li><strong>FDA 21 CFR 820:</strong> U.S. regulation for medical device quality systems, emphasizing corrective and preventive actions (CAPA).</li>
        <li><strong>ISO 13485:</strong> International standard for medical device QMS, requiring documented procedures for defect reduction and corrective actions.</li>
        <li><strong>ISO 9001:</strong> General quality management standard applicable across industries, focusing on continuous improvement and effectiveness of corrective actions.</li>
    </ul>
    <p>
        Using this calculator helps organizations quantify the impact of corrective measures, maintain compliance, and ensure continuous quality improvement.
    </p>
</div>


<div class="note-card">
    <h3>üí° Conclusion</h3>
    <p>
        The <strong>CAE Calculator</strong> provides a clear, quantitative measure of the effectiveness of corrective actions. 
        By analyzing the reduction in defects, organizations can identify whether corrective measures are successful, 
        ensure compliance with international standards, and continuously improve quality processes. 
        Regular use of this tool supports data-driven decision-making, risk reduction, and enhanced operational performance.
    </p>
</div>


            
            
        </div>
    </div>
<script>
 function calculateCAE() {
    const initialDefectsInput = document.getElementById("initialDefects").value.trim();
    const reducedDefectsInput = document.getElementById("reducedDefects").value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const outputValue = document.getElementById('caeValue');
    const feedbackBox = document.getElementById('caeFeedback');

    let errors = [];

    // ‚úÖ Validation Rules
    if (initialDefectsInput === "") {
        errors.push("üëâ Please enter the initial defects.");
    } else if (!/^\d+$/.test(initialDefectsInput)) {
        errors.push("üëâ Initial defects must be a whole number (no decimals).");
    } else if (parseInt(initialDefectsInput) <= 0) {
        errors.push("üëâ Initial defects must be greater than 0.");
    } else if (parseInt(initialDefectsInput) > 1000000) {
        errors.push("üëâ Initial defects cannot exceed 1,000,000.");
    }

    if (reducedDefectsInput === "") {
        errors.push("üëâ Please enter the remaining defects.");
    } else if (!/^\d+$/.test(reducedDefectsInput)) {
        errors.push("üëâ Remaining defects must be a whole number (no decimals).");
    } else if (parseInt(reducedDefectsInput) < 0) {
        errors.push("üëâ Remaining defects cannot be negative.");
    } else if (parseInt(reducedDefectsInput) > 1000000) {
        errors.push("üëâ Remaining defects cannot exceed 1,000,000.");
    }

    if (errors.length === 0) {
        const initialNum = parseInt(initialDefectsInput);
        const reducedNum = parseInt(reducedDefectsInput);

        if (reducedNum > initialNum) {
            errors.push("üëâ Remaining defects cannot be greater than initial defects.");
        }
    }

    // ‚ùå Show errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ‚úÖ Perform Calculation
    const initialNum = parseInt(initialDefectsInput);
    const reducedNum = parseInt(reducedDefectsInput);
    const cae = ((initialNum - reducedNum) / initialNum) * 100;

    outputValue.textContent = cae.toFixed(2);

    // ‚úÖ Feedback Interpretation
    let feedback = "";
    if (cae >= 90) {
        feedback = "‚úÖ Excellent! Corrective actions were highly effective.";
    } else if (cae >= 70) {
        feedback = "üëç Good effectiveness, but some improvements possible.";
    } else if (cae >= 50) {
        feedback = "‚ö†Ô∏è Moderate effectiveness. Review actions for sustainability.";
    } else {
        feedback = "‚ùå Low effectiveness. Corrective actions need major review.";
    }
    feedbackBox.textContent = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

</script>

    
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

===========Real-World Analysis of Inputs and Outputs================

Inputs:

Initial Defects = The total number of defects (nonconformities, safety issues, or hazards) before corrective action implementation.

Remaining Defects = The number of defects observed after corrective action is implemented.

Output:

CAE (%) = [(Initial Defects - Reduced Defects) √∑ Initial Defects] √ó 100
Provides a percentage effectiveness of corrective action.

Practical Use in QEHS & Fire Safety:

Used in safety audits, incident investigations, ISO 45001 compliance reviews, and NFPA fire safety risk assessments.

Ensures corrective actions are not cosmetic but actually reduce risks/defects.

CAE below thresholds (<70%) typically triggers management review or re-investigation.

===========================Detailed Validation Rules (Industry-Grade)=========================
Input: Initial Defects

Required (no blanks allowed).

Numeric only (integers recommended).

Must be > 0 (you can‚Äôt measure effectiveness if no initial defects).

Max threshold: Set upper bound (e.g., 1,000,000) to prevent accidental huge inputs.

Decimal places: Not logical (defects are discrete countable items). Must be integer only.

Input: Remaining Defects

Required (no blanks allowed).

Numeric only (integer).

Must be ‚â• 0.

Must be ‚â§ Initial Defects (you can‚Äôt have more defects after correction unless misclassified ‚Üí in real audit that would be recorded as ‚Äúineffective‚Äù but not > initial).

Max threshold: same cap (1,000,000).

Decimal places: Not logical (must be integer).

Cross-field Validation

Remaining Defects ‚â§ Initial Defects.

Both values should be in logical range (0‚Äì1M).

If Remaining Defects = Initial Defects ‚Üí CAE = 0% (No effectiveness).

If Remaining Defects = 0 ‚Üí CAE = 100% (Full effectiveness).

===============Edge Case Validations=======================

Division by zero ‚Üí handled by requiring Initial > 0.

Remaining > Initial ‚Üí flag as invalid.

Negative values ‚Üí not allowed.

Excessively large values (>1,000,000) ‚Üí warn user (likely data entry mistake).

Non-numeric inputs (e.g., text, special characters) ‚Üí block before calculation.

Floating point entries ‚Üí reject (defects must be integer counts).
Output Validation & Thresholds

Interpret CAE (%) aligned with ISO/OSHA audit practices:

‚â• 90% ‚Üí Excellent: Corrective action eliminated nearly all defects, often expected in high-risk fire/safety cases.

70‚Äì89% ‚Üí Good: Effective but still leaves room for hazard reappearance.

50‚Äì69% ‚Üí Moderate: Requires management review ‚Äì corrective action may not be sustainable.

< 50% ‚Üí Low: Considered ineffective under ISO 45001 continuous improvement clauses. Requires escalation.
-->