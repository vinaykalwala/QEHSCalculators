{% extends 'base.html' %}
{% block title %}GAD-7 Anxiety Assessment Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAD-7 Anxiety Assessment Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            max-height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
            line-height: 1.4;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .result-value {
            width: 100%;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        .rate-label {
            color: #7f8c8d;
            font-size: 16px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>GAD-7 Anxiety Assessment</h1>
            <p>Over the last two weeks, how often have you been bothered by the following problems?</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>GAD-7 Questionnaire</h2>
                <div class="form-group"><label for="q1">1. Feeling nervous, anxious, or on edge?</label><select id="q1" class="form-select"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select></div>
                <div class="form-group"><label for="q2">2. Not being able to stop or control worrying?</label><select id="q2" class="form-select"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select></div>
                <div class="form-group"><label for="q3">3. Worrying too much about different things?</label><select id="q3" class="form-select"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select></div>
                <div class="form-group"><label for="q4">4. Trouble relaxing?</label><select id="q4" class="form-select"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select></div>
                <div class="form-group"><label for="q5">5. Being so restless that it‚Äôs hard to sit still?</label><select id="q5" class="form-select"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select></div>
                <div class="form-group"><label for="q6">6. Becoming easily annoyed or irritable?</label><select id="q6" class="form-select"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select></div>
                <div class="form-group"><label for="q7">7. Feeling afraid as if something awful might happen?</label><select id="q7" class="form-select"><option value="0">Not at all</option><option value="1">Several days</option><option value="2">More than half the days</option><option value="3">Nearly every day</option></select></div>
                <button class="calculate-btn" onclick="calculateGAD7()">Calculate Score</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Please answer the questions to see your GAD-7 score and an interpretation of the result.</p>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Anxiety Severity Score</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0</div>
                        <div class="rate-label">GAD-7 Score</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Minimal</span><span>Mild</span><span>Moderate</span><span>Severe</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>‚ùó Important Disclaimer</h3>
                <p>
                    This tool is designed to help you reflect on the presence and severity of symptoms related to anxiety. 
                    It is not a substitute for a professional evaluation or diagnosis. If you have concerns about your mental health, 
                    please consult with a healthcare provider. This assessment tool is adapted to provide a basic understanding 
                    and is inspired by validated resources like the GAD-7 and other mental health frameworks.
                </p>
                <p>
                    Your experience may differ, and only a professional can offer personalized advice. 
                    Always prioritize reaching out to a medical or mental health professional for any concerns you may have.
                </p>
            </div>

            <div class="note-card">
                <h3>üìå Input Validation Rules</h3>
                <div class="note-list">
                    <ul>
                    <li><strong>Answer Required:</strong> All 7 questions must be answered. Skipping any question will stop the calculation.</li>
                    <li><strong>Valid Range:</strong> Each question accepts only values between <code>0</code> and <code>3</code>:
                        <ul>
                        <li>0 = Not at all</li>
                        <li>1 = Several days</li>
                        <li>2 = More than half the days</li>
                        <li>3 = Nearly every day</li>
                        </ul>
                    </li>
                    <li><strong>No Empty Fields:</strong> Leaving a question blank is not allowed.</li>
                    <li><strong>Consistency Check:</strong> If inputs are tampered (e.g., values like -1 or 5), the system will reject them.</li>
                    <li><strong>Score Range:</strong> The total score is valid only between <code>0</code> and <code>21</code>. Anything outside this range will trigger an error.</li>
                    <li><strong>Meaningful Output:</strong> The calculator only provides interpretation when valid inputs are given, ensuring reliable and compliant results.</li>
                    </ul>
                    <p><em>‚ö†Ô∏è Note: This tool is for self-assessment only. For medical or mental health concerns, always consult a qualified professional.</em></p>
                </div>
            </div>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
    });

    function calculateGAD7() {
        let score = 0;
        let errors = [];

        // Validate all 7 inputs
        for (let i = 1; i <= 7; i++) {
            const field = document.getElementById(`q${i}`);
            if (!field) {
                errors.push(`Question ${i} is missing from the form.`);
                continue;
            }

            const value = field.value.trim();

            // Must not be empty
            if (value === "") {
                errors.push(`üëâ Please answer Question ${i}.`);
                continue;
            }

            const num = parseInt(value, 10);

            // Must be integer between 0‚Äì3
            if (isNaN(num) || num < 0 || num > 3) {
                errors.push(`üëâ Invalid value for Question ${i}. Must be between 0 and 3.`);
            } else {
                score += num;
            }
        }

        // Handle validation errors
        if (errors.length > 0) {
            alert(errors.join("\n"));
            return;
        }

        // Double-check range
        if (score < 0 || score > 21) {
            alert("Calculated score is out of valid range (0‚Äì21). Please check inputs.");
            return;
        }

        // UI elements
        const placeholder = document.getElementById('placeholder');
        const resultValue = document.getElementById('resultValue');
        document.getElementById('rateValue').textContent = score;

        const meterFill = document.getElementById('meterFill');
        let meterWidth, meterColor, feedback;

        // Interpret score
        if (score === 0) {
            meterWidth = '10%'; meterColor = '#2ecc71';
            feedback = "<strong>No Anxiety:</strong> No symptoms detected. Maintain healthy habits.";
        } else if (score <= 4) {
            meterWidth = '25%'; meterColor = '#27ae60';
            feedback = "<strong>Minimal Anxiety:</strong> Little to no anxiety. Continue monitoring your well-being.";
        } else if (score <= 9) {
            meterWidth = '50%'; meterColor = '#f1c40f';
            feedback = "<strong>Mild Anxiety:</strong> Mild symptoms. Consider relaxation techniques or talking with someone you trust.";
        } else if (score <= 14) {
            meterWidth = '75%'; meterColor = '#e67e22';
            feedback = "<strong>Moderate Anxiety:</strong> Moderate symptoms. Consulting a healthcare provider is recommended.";
        } else {
            meterWidth = '95%'; meterColor = '#c0392b';
            feedback = "<strong>Severe Anxiety:</strong> Severe symptoms. Strongly advised to seek professional support.";
        }

        // Update UI
        meterFill.style.width = meterWidth;
        meterFill.style.backgroundColor = meterColor;
        document.getElementById('feedbackContent').innerHTML = feedback;

        placeholder.classList.add('hidden');
        resultValue.classList.remove('hidden');
    }

    function printReport() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
        window.print();
    }
    </script>

</body>
</html>
{% endblock %}

<!-- 
1. Analysis of Inputs, Outputs, and Formula

Inputs (q1‚Äìq7): Each dropdown records a response coded 0‚Äì3.
‚Üí From a QEHS view, this is equivalent to structured data capture (e.g., ‚Äú0 incidents‚Äù, ‚Äúfew incidents‚Äù, ‚Äúregular incidents‚Äù, ‚Äúfrequent incidents‚Äù).
‚Üí Safe ranges must be enforced to prevent tampering or invalid data.

Output: A total score (0‚Äì21).
‚Üí This mirrors a KPI index (e.g., risk index). In real audits, we interpret thresholds:

0‚Äì4 = minimal

5‚Äì9 = mild

10‚Äì14 = moderate

15‚Äì21 = severe

Formula: Sum of all inputs.
‚Üí Like in accident frequency, where totals are benchmarked against industry thresholds.

2. Input Validation Rules (Industry-Style Compliance)
Field	Expected Range	Validation Rule	Compliance Rationale
Q1‚ÄìQ7 (all dropdowns)	Integer 0‚Äì3	Must be an integer, no blanks, no decimals.	In audits, categorical scales must be consistent & controlled. Prevents input manipulation.
Score Calculation	0‚Äì21	Sum must be ‚â•0 and ‚â§21	Equivalent to ensuring KPIs like TRIR cannot exceed maximum mathematically possible.
Cross-field dependency	All 7 must be answered	If any question skipped ‚Üí incomplete data ‚Üí block calculation.	Like missing man-hours in frequency rate calculations: invalid without all fields.
3. Edge Case Validations

Unanswered Dropdowns ‚Üí Show error: ‚ÄúPlease answer all 7 questions before calculating.‚Äù

Tampering (values outside 0‚Äì3) ‚Üí Auto-reject with error: ‚ÄúInvalid input detected.‚Äù

Score beyond 21 or negative (from DOM manipulation) ‚Üí Block output, log error.

All 0 but user claims severe ‚Üí Flag inconsistency (like reporting zero accidents but high injury rate).

4. Output Validation Logic & Thresholds

Outputs must mirror recognized clinical cutoffs (like how OSHA uses defined TRIR cutoffs).

Score Range	Interpretation	Compliance Analogy
0	No symptoms	Equivalent to zero accidents ‚Üí ‚ÄúExcellent compliance.‚Äù
1‚Äì4	Minimal anxiety	Equivalent to ‚Äúbelow industry threshold.‚Äù
5‚Äì9	Mild anxiety	Watch-list status (like rising near miss trends).
10‚Äì14	Moderate	Trigger investigation / corrective action.
15‚Äì21	Severe	Equivalent to ‚Äúrecordable/major incidents ‚Üí mandatory escalation.‚Äù
-->