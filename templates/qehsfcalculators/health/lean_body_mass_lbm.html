{% extends 'base.html' %}
{% block title %}Lean Body Mass (LBM) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lean Body Mass (LBM) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            min-height: 420px;
            justify-content: center;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
            background-color: #3498db;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Lean Body Mass (LBM) Calculator</h1>
            <p>Estimate the weight of your body minus fat, including muscle, bone, and organs.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Your Measurements</h2>
                 <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" class="form-select">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" id="weight" class="form-input" placeholder="e.g., 70">
                </div>
                <div class="form-group">
                    <label for="height">Height (cm)</label>
                    <input type="number" id="height" class="form-input" placeholder="e.g., 175">
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate LBM</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Enter your gender, weight, and height to calculate your body composition.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Lean Body Mass (LBM)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.0</div>
                        <div class="rate-label">kg</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Body Fat</span>
                        <span>Lean Mass</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Body Composition Analysis</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>What is Lean Body Mass (LBM)?</h3>
                <p>Lean Body Mass (LBM) is the total weight of your body minus all the weight due to fat mass. LBM includes the weight of your bones, muscles, organs, skin, and water. It is a crucial measure of your body composition and a better indicator of metabolic health than total body weight alone.</p>
            </div>
            <div class="note-card">
                <h3>Why LBM Matters</h3>
                <ul class="note-list">
                    <li><strong>Metabolic Rate:</strong> Muscle tissue burns more calories at rest than fat tissue. A higher LBM can lead to a higher basal metabolic rate (BMR).</li>
                    <li><strong>Fitness Tracking:</strong> When dieting or exercising, tracking LBM ensures you are losing fat, not valuable muscle mass.</li>
                    <li><strong>Nutritional Planning:</strong> Protein and calorie needs are often based on LBM, especially for athletes and those looking to build muscle.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>Improving Your Lean Body Mass</h3>
                <p>To increase your LBM, focus on two key areas:</p>
                <ul class="note-list">
                    <li><strong>Strength Training:</strong> Regular resistance exercises (like weightlifting) are essential for stimulating muscle growth.</li>
                    <li><strong>Adequate Protein Intake:</strong> Consuming enough dietary protein provides the building blocks for muscle repair and growth.</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>‚ö†Ô∏è Disclaimer</h3>
                <p>This calculator uses the Boer formula, which provides an estimate of LBM. For a precise measurement of body composition, methods like DEXA scans or hydrostatic weighing are recommended. Always consult with a healthcare or fitness professional for personalized advice.</p>
            </div>
        </div>
    </div>

    <script>
        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];
            function getVal(id, label, opts = {}) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (!raw) {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num) || num <= 0) {
                    errors.push(`üëâ Enter a valid positive number for ${label}.`);
                    return null;
                }
                if (opts.min !== undefined && num < opts.min) errors.push(`üëâ ${label} must be ‚â• ${opts.min}.`);
                if (opts.max !== undefined && num > opts.max) errors.push(`üëâ ${label} must be ‚â§ ${opts.max}.`);
                return num;
            }

            const gender = document.getElementById('gender').value;
            const weight = getVal('weight', 'Weight', { min: 20, max: 300 });
            const height = getVal('height', 'Height', { min: 100, max: 250 });

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }

            let lbm;
            if (gender === "male") {
                lbm = (0.407 * weight) + (0.267 * height) - 19.2;
            } else { // female
                lbm = (0.252 * weight) + (0.473 * height) - 48.3;
            }

            const fatMass = weight - lbm;
            const fatPercentage = (fatMass / weight) * 100;
            const lbmPercentage = 100 - fatPercentage;

            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = lbm.toFixed(1);
            
            const meterFill = document.getElementById('meterFill');
            meterFill.style.width = lbmPercentage.toFixed(1) + '%';
            
            document.getElementById('feedbackContent').innerHTML = `
                Your body composition is estimated to be:<br>
                <ul>
                    <li><strong>Lean Body Mass:</strong> ${lbm.toFixed(1)} kg (${lbmPercentage.toFixed(1)}%)</li>
                    <li><strong>Body Fat Mass:</strong> ${fatMass.toFixed(1)} kg (${fatPercentage.toFixed(1)}%)</li>
                </ul>
            `;
        }
    </script>
</body>
</html>
{% endblock %}