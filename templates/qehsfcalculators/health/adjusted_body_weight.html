{% extends 'base.html' %}
{% block title %}Adjusted Body Weight Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adjusted Body Weight Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
      

        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" with report_title="Adjusted Body Weight Report" %}

    <div class="calculator-header">
        <h1>Adjusted Body Weight Calculator</h1>
        <p>Calculate your adjusted body weight (AjBW) for nutritional planning based on your ideal and actual weight.</p>
    </div>

    <div class="calc-content">
        <div class="calc-card">
            <h2>Enter Your Data</h2>
            <div class="form-group"><label for="sex">Gender:</label><select id="sex" class="form-input"><option value="male">Male</option><option value="female">Female</option></select></div>
            <div class="form-group"><label for="height">Height (cm):</label><input type="number" id="height" class="form-input" placeholder="e.g., 175" min="1"></div>
            <div class="form-group"><label for="weight">Actual Body Weight (kg):</label><input type="number" id="weight" class="form-input" placeholder="e.g., 80" min="1"></div>
            <button class="calculate-btn" onclick="calculateAdjustedBodyWeight()">Calculate</button>
        </div>

        <div class="result-card">
            <div class="result-placeholder" id="placeholder"><img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Nutrition scale icon"><p>Results for your Ideal and Adjusted Body Weight will be displayed here.</p></div>
            <div class="result-error hidden" id="resultError"><div class="error-message" id="errorMessage"></div></div>
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value" id="ajbwValue">0.00 kg</div>
                <div class="rate-label" id="ibwValue"></div>
                <div class="result-feedback"><div class="feedback-title">Interpretation</div><div class="feedback-content" id="feedbackContent"></div></div>
                <div class="btn-wrapper"><button class="calculate-btn print-btn" onclick="printReport()">Print Report</button></div>
            </div>
        </div>
    </div>

    <div class="note-section">
        <div class="note-card">
            <h3>What is Adjusted Body Weight?</h3>
            <p>Adjusted Body Weight (AjBW) is a measure used to estimate a person's nutritional needs more accurately, especially for individuals who are overweight or obese. Since fat tissue (adipose tissue) is less metabolically active than muscle tissue, using actual body weight to calculate energy requirements can overestimate the needs of individuals with excess body fat. Adjusted Body Weight accounts for this by adjusting the actual body weight to better reflect metabolic activity.</p>
        </div>
        <div class="note-card">
            <h3>Input Validations</h3>
            <ul class="note-list">
                <li><strong>Gender:</strong> Must be selected as either <span class="good">Male</span> or <span class="good">Female</span>. No other values are accepted.</li>
                <li><strong>Height:</strong> Enter between <span class="good">120 – 250 cm</span>. Values outside this range are not physiologically realistic for adults.</li>
                <li><strong>Weight:</strong> Enter between <span class="good">30 – 300 kg</span>. Below 30 kg or above 300 kg is outside safe adult ranges.</li>
                <li><strong>IBW (Ideal Body Weight):</strong> The calculated value must fall between <span class="good">20 – 150 kg</span>. Out-of-range IBW values will trigger an error.</li>
                <li><strong>AjBW (Adjusted Body Weight):</strong> Final results must fall between <span class="good">20 – 300 kg</span>. Invalid outputs indicate incorrect inputs.</li>
                <li><strong>Empty Fields:</strong> If any required input is left blank, the calculator will not run until all values are filled.</li>
            </ul>
            <p><em>These rules ensure safe, realistic, and clinically relevant calculations, aligned with standard dietetic and clinical practice.</em></p>
        </div>
        <div class="note-card">
            <h3>How is Adjusted Body Weight Calculated?</h3>
            <p>Adjusted Body Weight is calculated using a formula that combines <strong>Ideal Body Weight (IBW)</strong> and <strong>Actual Body Weight (ABW)</strong>. The calculation involves two main steps:</p>
            <ol>
                <li><strong>Calculate Ideal Body Weight (IBW):</strong> This is the weight considered healthy for a person based on their height and gender. It is calculated using a standardized formula that varies slightly between men and women.</li>
                <li><strong>Calculate Adjusted Body Weight (AjBW):</strong> This adjusts the actual body weight by considering the difference between the actual weight and the ideal weight, with a correction factor applied to account for the lower metabolic activity of fat tissue.</li>
            </ol>
        </div>
        <div class="note-card">
            <h3>Why Use Adjusted Body Weight?</h3>
            <p>Adjusted Body Weight is particularly useful for:</p>
            <ul>
                <li><strong>Overweight or Obese Individuals:</strong> It provides a more accurate estimate of nutritional needs by accounting for the lower metabolic activity of fat tissue.</li>
                <li><strong>Clinical Settings:</strong> Dietitians and healthcare providers use AjBW to design personalized nutrition plans for patients.</li>
            </ul>
        </div>
        <div class="note-card">
            <h3>Limitations of Adjusted Body Weight</h3>
            <p>While Adjusted Body Weight is useful in many cases, it is not suitable for everyone:</p>
            <ul>
                <li><strong>Athletes:</strong> Individuals with high muscle mass may have a higher actual body weight due to muscle, not fat. In such cases, AjBW may underestimate their nutritional needs.</li>
                <li><strong>Pregnancy:</strong> AjBW is not applicable during pregnancy, as weight gain is due to the growing fetus and related changes, not fat tissue.</li>
            </ul>
        </div>
        <div class="note-card">
            <h3>⚠️ Disclaimer</h3>
            <p>This calculator provides estimates and is not a substitute for professional medical advice. Always consult a healthcare provider for personalized recommendations.</p>
        </div>
    </div>
</div>

<script>
    // All JS functions remain the same
    document.addEventListener('DOMContentLoaded', function() { /* ... */ const printDateEl = document.getElementById('printDate'); if (printDateEl) { const now = new Date(); const options = { year: 'numeric', month: 'long', day: 'numeric' }; printDateEl.textContent = now.toLocaleDateString('en-US', options); } });
    function calculateAdjustedBodyWeight() {
    const sex = document.getElementById('sex').value.toLowerCase();
    const height = parseFloat(document.getElementById('height').value);
    const weight = parseFloat(document.getElementById('weight').value);

    // Result containers
    const placeholder = document.getElementById('placeholder');
    const errorBox   = document.getElementById('resultError');
    const errorMsg   = document.getElementById('errorMessage');
    const resultBox  = document.getElementById('resultValue');
    const ibwValue   = document.getElementById('ibwValue');
    const ajbwValue  = document.getElementById('ajbwValue');
    const feedback   = document.getElementById('feedbackContent');

    // Reset all states
    placeholder.classList.add("hidden");
    errorBox.classList.add("hidden");
    resultBox.classList.add("hidden");
    errorMsg.textContent = "";
    ibwValue.textContent = "";
    ajbwValue.textContent = "";
    feedback.textContent = "";

    // --- Input Validations ---
    if (sex !== "male" && sex !== "female") {
        errorMsg.textContent = "❌ Invalid gender selected.";
        errorBox.classList.remove("hidden");
        return;
    }
    if (isNaN(height) || height < 120 || height > 250) {
        errorMsg.textContent = "❌ Please enter a valid height between 120–250 cm.";
        errorBox.classList.remove("hidden");
        return;
    }
    if (isNaN(weight) || weight < 30 || weight > 300) {
        errorMsg.textContent = "❌ Please enter a valid weight between 30–300 kg.";
        errorBox.classList.remove("hidden");
        return;
    }

    // --- IBW Calculation ---
    const heightInches = height / 2.54;
    let ibw = (sex === "male")
        ? 52 + 1.9 * (heightInches - 60)
        : 49 + 1.7 * (heightInches - 60);

    if (ibw <= 0 || ibw > 150) {
        errorMsg.textContent = "❌ Calculated Ideal Body Weight is out of realistic range.";
        errorBox.classList.remove("hidden");
        return;
    }

    // --- AjBW Calculation ---
    let ajbw;
    if (weight > ibw) {
        ajbw = ibw + 0.4 * (weight - ibw);
    } else {
        ajbw = weight; // no adjustment needed
    }

    // Round
    const ibwRounded = parseFloat(ibw.toFixed(2));
    const ajbwRounded = parseFloat(ajbw.toFixed(2));

    // --- Output Validation ---
    if (ajbwRounded < 20 || ajbwRounded > 300) {
        errorMsg.textContent = "❌ Adjusted Body Weight calculation is not valid. Check your inputs.";
        errorBox.classList.remove("hidden");
        return;
    }

    // --- Display Results ---
    ajbwValue.textContent = `${ajbwRounded} kg`;
    ibwValue.textContent = `Ideal Body Weight (IBW): ${ibwRounded} kg`;

    if (weight <= ibw) {
        feedback.innerHTML = `Your weight is below or equal to your IBW (${ibwRounded} kg). No adjustment required.`;
    } else {
        feedback.innerHTML = `Your adjusted weight for nutritional purposes is <strong>${ajbwRounded} kg</strong>. This is used for diet and nutrition planning instead of your actual weight (${weight} kg).`;
    }

    resultBox.classList.remove("hidden");
}
    function printReport() { /* ... */ const printDateEl = document.getElementById('printDate'); if (printDateEl) { const now = new Date(); const options = { year: 'numeric', month: 'long', day: 'numeric' }; printDateEl.textContent = now.toLocaleDateString('en-US', options); } window.print(); }
</script>

</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (QEHS & Safety-Compliant)

From a safety and compliance perspective, inputs must be restricted to humanly possible, medically relevant, and logically consistent ranges.

a. Gender (sex)

Allowed values: "male", "female".

No blanks or invalid strings.

Case-insensitive enforcement.

b. Height (height, cm)

Range: 120 – 250 cm (below = unsafe/extreme dwarfism, above = unrealistic outlier).

Decimals allowed: up to 1 decimal place (e.g., 175.5 cm).

Must be numeric and positive.

c. Actual Weight (weight, kg)

Range: 30 – 300 kg (below = severe malnutrition, above = medical extreme).

Decimals allowed: up to 1 decimal place.

Must be numeric and positive.

Must logically exceed 30% of IBW (to prevent division by zero or negative AjBW).

2. Output Validation Logic & Thresholds

Ideal Body Weight (IBW) should:

Be > 0 and within a realistic range for humans (40–120 kg for average adults).

If calculated IBW is < 30 kg or > 150 kg, flag as “⚠️ Data likely invalid.”

Adjusted Body Weight (AjBW) should:

Always fall between IBW and Actual Weight.

If not, return error (prevents negative AjBW or meaningless results).

Interpretation Rules:

If weight <= IBW → AjBW is not required → show: “No adjustment needed.”

If weight > IBW → AjBW used for nutrition planning.

3. Edge Case Validations

Division by zero / log of negative numbers → Prevent by checking IBW validity.

Height < 120 cm or > 250 cm → Reject with error.

Weight < 30 kg or > 300 kg → Reject with error.

IBW negative (e.g., very short height) → Reject with error.

AjBW < 0 or > 300 kg → Reject with error.

All inputs blank → Prompt user to enter values.

4. Why These Validations Are Critical (Compliance View)

OSHA / ISO 45001 Principle: Prevent misuse or unsafe assumptions in health monitoring tools.

NFPA / ILO Requirement: Risk-based validation avoids misleading health assessments that could impact worker placement or nutrition programs.

Audit-Readiness: Validations ensure outputs are credible, defensible, and align with real-world occupational health screening practices.
-->