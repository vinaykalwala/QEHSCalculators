{% extends 'base.html' %}
{% block title %}Waist-to-Height Ratio (WHtR) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waist-to-Height Ratio (WHtR) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        .custom-table {
            border-collapse: collapse; width: 100%;
            margin: 20px 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead { background-color: #1560bd; color: white; }
        .custom-table th, .custom-table td {
            padding: 12px 16px; border: 1px solid #ddd; text-align: center;
        }
        .custom-table tr:nth-child(even) { background-color: #f9f9f9; }
        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-top: 10px;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Waist-to-Height Ratio (WHtR) Calculator</h1>
            <p>Assess your body fat distribution and health risk using your waist and height.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Your Measurements</h2>
                <div class="form-group">
                    <label for="waist">Waist Circumference (cm)</label>
                    <input type="number" id="waist" class="form-input" placeholder="Enter waist measurement">
                </div>
                <div class="form-group">
                    <label for="height">Height (cm)</label>
                    <input type="number" id="height" class="form-input" placeholder="Enter height measurement">
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate WHtR</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Enter your waist and height to calculate your Waist-to-Height Ratio.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Waist-to-Height Ratio</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Healthy</span>
                        <span>Overweight</span>
                        <span>Obese</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                     <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <!-- About WHtR -->
            <div class="note-card">
                <h3>Understanding Waist-to-Height Ratio (WHtR)</h3>
                <p>
                    The waist-to-height ratio (WHtR) is a simple and effective measure of centralized obesity
                    and associated cardiometabolic risks. It compares your waist circumference to your height,
                    providing insight into body fat distribution and potential health risks.
                </p>
            </div>
        
            <!-- Why Important -->
            <div class="note-card">
                <h3>Why is WHtR Important?</h3>
                <p>
                    WHtR is a strong predictor of obesity-related health risks, such as cardiovascular diseases,
                    stroke, and diabetes. Unlike BMI, WHtR directly considers abdominal fat, which is a key factor in metabolic
                    health.
                </p>
                <ul>
                    <li>A WHtR <strong>below 0.5</strong> is considered healthy for both men and women.</li>
                    <li>A WHtR <strong>above 0.5</strong> indicates an increased risk of health issues.</li>
                </ul>
            </div>
        
            <!-- How to Measure -->
            <div class="note-card">
                <h3>How to Measure Correctly</h3>
                <ul>
                    <li><strong>Waist:</strong> Measure at the midpoint between the last rib and the top of the iliac crest
                        (usually just above the belly button) using a stretch-resistant tape.</li>
                    <li><strong>Height:</strong> Stand straight against a wall and measure from the base of your feet
                        to the top of your head.</li>
                </ul>
            </div>
        
            <!-- Interpretation Table -->
            <div class="note-card">
                <h3>Interpreting Your WHtR Result</h3>
                <div style="overflow-x:auto;">
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>WHtR Range</th>
                                <th>Risk Level</th>
                                <th>Recommendation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Below 0.4</strong></td>
                                <td>Underweight</td>
                                <td>Consider gaining weight for better health.</td>
                            </tr>
                            <tr>
                                <td><strong>0.4 - 0.49</strong></td>
                                <td>Healthy</td>
                                <td>Maintain your current lifestyle.</td>
                            </tr>
                            <tr>
                                <td><strong>0.5 - 0.59</strong></td>
                                <td>Increased Risk</td>
                                <td>Consider lifestyle changes to reduce waist size.</td>
                            </tr>
                            <tr>
                                <td><strong>0.6 or Above</strong></td>
                                <td>High Risk</td>
                                <td>Consult a healthcare professional for guidance.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        
            <!-- Shape Chart -->
            <div class="note-card">
                <h3>Shape Chart based on Waist-to-Height Ratio</h3>
                <p>
                    After research showed that WHtR was as good a predictor of health outcomes as waist circumference
                    and waist-to-hip ratio, a simple "Shape Chart" was produced. It is suitable for adults and children over 5
                    years old:
                </p>
                <ul>
                    <li>The cut-off values for WHtR are set at 0.4, 0.5, and 0.6.</li>
                    <li><span style="color:brown;">Brown area:</span> Underweight ‚Äì Take Care.</li>
                    <li><span style="color:green;">Green area:</span> Healthy.</li>
                    <li><span style="color:orange;">Yellow area:</span> Consider Action (adults) / Take Action (children).</li>
                    <li><span style="color:red;">Red area:</span> High Risk ‚Äì Take Action.</li>
                </ul>
                <div class="image-container">
                    <img src="{% static 'images/whtr.webp' %}" alt="Waist-to-Height Ratio Shape Chart">
                </div>
            </div>
        
            <div class="note-card">
                <h3>‚úÖ Input Validations</h3>
                <p>
                    To ensure accurate Waist-to-Height Ratio (WHtR) calculations, the following
                    input rules are applied:
                </p>
                <ul class="note-list">
                    <li>üëâ <strong>Required:</strong> Both Waist and Height fields must be filled.</li>
                    <li>üëâ <strong>Positive Numbers:</strong> Only positive numeric values are accepted.</li>
                    <li>üëâ <strong>Valid Ranges:</strong>
                        <ul>
                            <li>Waist: 40 cm ‚Äì 200 cm</li>
                            <li>Height: 100 cm ‚Äì 250 cm</li>
                        </ul>
                    </li>
                    <li>üëâ <strong>Decimal Precision:</strong> Maximum of 1 decimal place is allowed.</li>
                    <li>üëâ <strong>Cross-Check:</strong> Waist cannot be equal to or greater than height.</li>
                </ul>
                <p>
                    These checks help avoid invalid or unrealistic entries, ensuring a reliable result.
                </p>
            </div>

            <!-- Limitations -->
            <div class="note-card">
                <h3>Limitations of WHtR</h3>
                <ul>
                    <li>Does not distinguish between muscle and fat mass.</li>
                    <li>May not account for variations in body composition across different ethnic groups.</li>
                    <li>Provides an estimate but does not measure actual body fat percentage.</li>
                </ul>
            </div>
        </div>

    </div>

    <script>
        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');
            const rateValue = document.getElementById('rateValue');
            const feedbackContent = document.getElementById('feedbackContent');
            const meterFill = document.getElementById('meterFill');

            // Reset UI
            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];

            // Validation helper
            function getValidatedValue(id, label, min, max) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();

                if (!raw) {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }

                const num = parseFloat(raw);

                if (isNaN(num) || num <= 0) {
                    errors.push(`üëâ Enter a valid positive number for ${label}.`);
                    return null;
                }

                if (num < min || num > max) {
                    errors.push(`üëâ ${label} must be between ${min} and ${max} cm.`);
                }

                // Restrict to max 1 decimal place
                if (!/^\d+(\.\d{1})?$/.test(raw)) {
                    errors.push(`üëâ ${label} must have at most 1 decimal place.`);
                }

                return num;
            }

            const waist = getValidatedValue("waist", "Waist Circumference", 40, 200);
            const height = getValidatedValue("height", "Height", 100, 250);

            // Cross-field validation
            if (waist && height && waist >= height) {
                errors.push("üëâ Waist circumference cannot be equal to or greater than height.");
            }

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                return;
            }

            // Calculate WHtR
            const whtr = waist / height;
            let interpretation = "";

            // Interpretation logic
            if (whtr < 0.40) {
                interpretation = "‚ö†Ô∏è <strong>Underweight:</strong> May indicate malnutrition or frailty. Seek guidance if needed.";
                meterFill.style.backgroundColor = "#3498db"; // Blue
            } else if (whtr < 0.50) {
                interpretation = "‚úÖ <strong>Healthy:</strong> Low risk. Maintain your current lifestyle.";
                meterFill.style.backgroundColor = "#2ecc71"; // Green
            } else if (whtr < 0.60) {
                interpretation = "‚ö†Ô∏è <strong>Increased Risk:</strong> Suggests overweight. Lifestyle changes recommended.";
                meterFill.style.backgroundColor = "#f39c12"; // Yellow
            } else {
                interpretation = "üö® <strong>High Risk:</strong> Strong link to serious health risks. Consult a healthcare professional.";
                meterFill.style.backgroundColor = "#e74c3c"; // Red
            }

            // Scale meter (range 0.3‚Äì0.7 ‚Üí 0‚Äì100%)
            const minRatio = 0.3, maxRatio = 0.7;
            let pct = ((whtr - minRatio) / (maxRatio - minRatio)) * 100;
            pct = Math.max(0, Math.min(100, pct));
            meterFill.style.width = pct + "%";

            // Display result
            placeholder.classList.add("hidden");
            resultValueBox.classList.remove("hidden");
            rateValue.textContent = whtr.toFixed(2);
            feedbackContent.innerHTML = interpretation;
        }

        function printReport() {
            window.print();
        }
    </script>

</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (QEHS & Fire Safety Perspective)
Waist Circumference (cm)

Unit: Centimeters (must be numeric, no text or special characters).

Range:

Minimum: 40 cm (below this is unrealistic for adults).

Maximum: 200 cm (beyond this indicates either measurement error or extreme obesity).

Allowed Decimals: Up to 1 decimal place (precision required in audits).

Logical Consistency: Waist must not exceed height (red flag in reporting if waist ‚â• height).

Height (cm)

Unit: Centimeters.

Range:

Minimum: 100 cm (below this only valid in children; adults should flag error).

Maximum: 250 cm (beyond this is unrealistic, likely an input mistake).

Allowed Decimals: Up to 1 decimal place.

Cross-field dependency: Must always be greater than waist.

2. Output Validation Logic (with Thresholds)

Waist-to-Height Ratio (WHtR) = Waist √∑ Height

Industry references (WHO, ISO 45001 health KPIs, occupational wellness standards):

WHtR < 0.40 ‚Üí Underweight / Potential malnutrition

0.40 ‚Äì 0.49 ‚Üí Low Risk (Healthy)

0.50 ‚Äì 0.59 ‚Üí Moderate Risk (Overweight / Increased metabolic risk)

‚â• 0.60 ‚Üí High Risk (Obesity / Severe cardiovascular & fire safety concern in workplace ergonomics and evacuation)

üëâ These thresholds are meaningful for occupational safety audits, because high WHtR correlates to higher risk of cardiovascular events, impacting fitness for duty, emergency response, and fire evacuation performance.

3. Edge Case Validations

Division by Zero ‚Üí Height = 0 must be blocked.

Waist ‚â• Height ‚Üí Physically inconsistent, flag error.

Extremely small decimals ‚Üí WHtR displayed to 2 decimals only for audit clarity.

Empty fields ‚Üí Must not allow calculation.

Outliers ‚Üí If inputs outside normal adult ranges, provide warning instead of result.
-->