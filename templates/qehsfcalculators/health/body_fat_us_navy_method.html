{% extends 'base.html' %}
{% block title %}Body Fat Calculator (U.S. Navy Method){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Fat Calculator (U.S. Navy Method)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            max-height: 420px;   /* adjust as needed */
            overflow-y: auto;
            padding-right: 12px; /* prevent scrollbar overlap */
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: center;
        }
        .result-value {
            width: 100%;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        .rate-label {
            color: #7f8c8d;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Body Fat Calculator (U.S. Navy Method)</h1>
            <p>Estimate your body fat percentage using circumference measurements.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Your Measurements</h2>
                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" class="form-select" onchange="toggleHipInput()">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="height">Height (cm)</label>
                    <input type="number" id="height" class="form-input" min="0" placeholder="e.g., 178">
                </div>
                <div class="form-group">
                    <label for="neck">Neck Circumference (cm)</label>
                    <input type="number" id="neck" class="form-input" min="0" placeholder="e.g., 38">
                </div>
                <div class="form-group">
                    <label for="waist">Waist Circumference (cm)</label>
                    <input type="number" id="waist" class="form-input" min="0" placeholder="e.g., 85">
                </div>
                <div class="form-group hidden" id="hip-group">
                    <label for="hip">Hip Circumference (cm)</label>
                    <input type="number" id="hip" class="form-input" min="0" placeholder="e.g., 99">
                </div>
                <button class="calculate-btn" onclick="calculateBodyFat()">Calculate Body Fat</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Enter your measurements to estimate your <strong>Body Fat Percentage</strong>.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Body Fat Percentage</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.0</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">%</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Essential</span><span>Athlete</span><span>Fitness</span><span>Average</span><span>Overweight</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Category Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
    <div class="note-card">
        <h3>⭐ Take Control Of Your Body Composition</h3>
        <p>Achieving and maintaining optimal health calls for a nuanced understanding of the body's composition, including factors such as body fat percentage and its implications on overall wellness. This calculator empowers you with precise insights into your body composition, guiding you towards healthier living.</p>
    </div>

    <div class="note-card">
        <h3>🤔 How This Calculator Works</h3>
        <p>This tool estimates your body fat percentage using key inputs. It applies a mathematical formula (the U.S. Navy Method) to these inputs to derive an estimated body fat percentage. The required parameters are:</p>
        <ul class="note-list">
            <li><strong>Gender:</strong> Body fat distribution varies significantly between men and women.</li>
            <li><strong>Height:</strong> Used to assess overall body structure.</li>
            <li><strong>Neck & Waist Circumference:</strong> These measurements help estimate lean mass and fat distribution.</li>
            <li><strong>Hip Circumference:</strong> This is used for women for a more precise calculation due to different fat storage patterns.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Benefits of Using a Body Fat Calculator</h3>
        <ul class="note-list">
            <li>Assess overall health and risk for conditions like heart disease and diabetes.</li>
            <li>Tailor fitness programs focusing on fat loss or muscle gain.</li>
            <li>Track body composition changes over time.</li>
            <li>Detect increases in body fat early and make lifestyle adjustments.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📊 Body Fat Categories (ACE Chart)</h3>
    </div>
    <table class="custom-table">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Men</th>
                    <th>Women</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Essential Fat</td><td>2-5%</td><td>10-13%</td></tr>
                <tr><td>Athletes</td><td>6-13%</td><td>14-20%</td></tr>
                <tr><td>Fitness</td><td>14-17%</td><td>21-24%</td></tr>
                <tr><td>Average</td><td>18-24%</td><td>25-31%</td></tr>
                <tr><td>Overweight</td><td>25%+</td><td>32%+</td></tr>
            </tbody>
        </table>

    <div class="note-card">
        <h3>💡 Understanding Body Fat Types</h3>
        <p><strong>Essential Fat:</strong> This is the minimum amount of fat required for normal physiological function. For men, it's about 2-5%, and for women, it's 10-13%.</p>
        <p><strong>Stored Fat:</strong> This includes subcutaneous fat (found just beneath the skin) and visceral fat (located around internal organs). While some stored fat is normal, excess visceral fat is linked to health risks.</p>
    </div>

    <div class="note-card">
        <h3>❗ Potential Health Complications of Excess Body Fat</h3>
        <p>High body fat, particularly visceral fat, is associated with an increased risk of several health issues, including cardiovascular disease, Type 2 diabetes, joint problems, sleep apnea, and metabolic syndrome.</p>
    </div>

    <div class="note-card">
        <h3>🏃 Maintaining a Healthy Body Fat Percentage</h3>
        <p>You can achieve and maintain a healthy body fat percentage through a combination of a balanced diet, regular physical activity (including both cardio and strength training), and a healthy lifestyle. Personalized guidance from healthcare professionals can ensure long-term wellness.</p>
    </div>
</div>
</div>

    </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
             if(document.getElementById('printDate')) {
               document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            toggleHipInput(); // Set initial visibility
        });
        
        function toggleHipInput() {
            const gender = document.getElementById('gender').value;
            document.getElementById('hip-group').classList.toggle('hidden', gender === 'male');
        }

        function calculateBodyFat() {
            const gender = document.getElementById('gender').value;
            const height = document.getElementById('height').value.trim();
            const neck = document.getElementById('neck').value.trim();
            const waist = document.getElementById('waist').value.trim();
            const hip = document.getElementById('hip').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];
            if (height === "" || parseFloat(height) <= 0) errors.push("👉 Enter a valid height.");
            if (neck === "" || parseFloat(neck) <= 0) errors.push("👉 Enter a valid neck circumference.");
            if (waist === "" || parseFloat(waist) <= 0) errors.push("👉 Enter a valid waist circumference.");
            if (gender === 'female' && (hip === "" || parseFloat(hip) <= 0)) errors.push("👉 Enter a valid hip circumference.");

            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }
            
            const h = parseFloat(height), n = parseFloat(neck), w = parseFloat(waist), hi = parseFloat(hip);
            let bodyFat;

            if (gender === 'male') {
                if (w - n <= 0) {
                    errorMessage.innerHTML = "Waist measurement must be greater than neck measurement.";
                    errorBox.classList.remove("hidden");
                    placeholder.classList.add("hidden");
                    resultValue.classList.add("hidden");
                    return;
                }
                bodyFat = 86.010 * Math.log10(w - n) - 70.041 * Math.log10(h) + 36.76;
            } else { // Female
                 if (w + hi - n <= 0) {
                    errorMessage.innerHTML = "Waist + Hip must be greater than neck measurement.";
                    errorBox.classList.remove("hidden");
                    placeholder.classList.add("hidden");
                    resultValue.classList.add("hidden");
                    return;
                }
                bodyFat = 163.205 * Math.log10(w + hi - n) - 97.684 * Math.log10(h) - 78.387;
            }
            
            const bodyFatRounded = Math.max(0, bodyFat).toFixed(1);
            document.getElementById('rateValue').textContent = bodyFatRounded;

            const meterFill = document.getElementById('meterFill');
            let meterWidth, meterColor, feedback;

            if (gender === 'male') {
                if (bodyFatRounded <= 5) { meterWidth = '20%'; meterColor = '#3498db'; feedback = 'in the <strong>Essential Fat</strong> range. This level is vital for basic health.'; }
                else if (bodyFatRounded <= 13) { meterWidth = '40%'; meterColor = '#27ae60'; feedback = 'in the <strong>Athlete</strong> range. This reflects a high level of fitness.'; }
                else if (bodyFatRounded <= 17) { meterWidth = '60%'; meterColor = '#2ecc71'; feedback = 'in the <strong>Fitness</strong> range. This is considered healthy and fit.'; }
                else if (bodyFatRounded <= 24) { meterWidth = '80%'; meterColor = '#f39c12'; feedback = 'in the <strong>Average</strong> range. This is acceptable for most individuals.'; }
                else { meterWidth = '95%'; meterColor = '#e74c3c'; feedback = 'in the <strong>Overweight</strong> range. Consider consulting a health professional.'; }
            } else { // Female
                if (bodyFatRounded <= 13) { meterWidth = '20%'; meterColor = '#3498db'; feedback = 'in the <strong>Essential Fat</strong> range. This level is crucial for hormonal health.'; }
                else if (bodyFatRounded <= 20) { meterWidth = '40%'; meterColor = '#27ae60'; feedback = 'in the <strong>Athlete</strong> range, indicating excellent physical condition.'; }
                else if (bodyFatRounded <= 24) { meterWidth = '60%'; meterColor = '#2ecc71'; feedback = 'in the <strong>Fitness</strong> range, associated with good health.'; }
                else if (bodyFatRounded <= 31) { meterWidth = '80%'; meterColor = '#f39c12'; feedback = 'in the <strong>Average</strong> range. This is typical for the general population.'; }
                else { meterWidth = '95%'; meterColor = '#e74c3c'; feedback = 'in the <strong>Overweight</strong> range. A health consultation is recommended.'; }
            }
            
            meterFill.style.width = meterWidth;
            meterFill.style.backgroundColor = meterColor;
            document.getElementById('feedbackContent').innerHTML = `Your estimated body fat percentage is ${feedback}`;
            
            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
             if(document.getElementById('printDate')) {
               document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}