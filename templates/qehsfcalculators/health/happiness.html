{% extends 'base.html' %}
{% block title %}Happiness Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happiness Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            max-height: 480px; /* Allow scrolling for long forms */
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
            line-height: 1.4;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .result-value {
            width: 100%;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        .rate-label {
            color: #7f8c8d;
            font-size: 16px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li, .note-card ol {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Happiness Calculator</h1>
            <p>Based on the Subjective Happiness Scale (SHS), please select the point that best describes you.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Happiness Questionnaire</h2>
                <div class="form-group"><label for="q1">1. In general, I consider myself:</label><select id="q1" class="form-select"><option value="1">1 - Not a very happy person</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7 - A very happy person</option></select></div>
                <div class="form-group"><label for="q2">2. Compared with most of my peers, I consider myself:</label><select id="q2" class="form-select"><option value="1">1 - Less happy</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7 - More happy</option></select></div>
                <div class="form-group"><label for="q3">3. Some people are generally very happy... How much does this describe you?</label><select id="q3" class="form-select"><option value="1">1 - Not at all</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7 - A great deal</option></select></div>
                <div class="form-group"><label for="q4">4. Some people are generally not very happy... How much does this describe you?</label><select id="q4" class="form-select"><option value="7">1 - Not at all</option><option value="6">2</option><option value="5">3</option><option value="4">4</option><option value="3">5</option><option value="2">6</option><option value="1">7 - A great deal</option></select></div>
                <button class="calculate-btn" onclick="calculateHappiness()">Calculate Score</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Answer the questions to see your <strong>Subjective Happiness Score</strong>.</p>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Your Happiness Score</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.0</div>
                        <div class="rate-label">Average Score</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Less Happy</span><span>Average</span><span>More Happy</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>😊 About the Subjective Happiness Scale (SHS)</h3>
                <p>
                    This calculator is based on the <strong>Subjective Happiness Scale (SHS)</strong>, 
                    a simple and reliable method to assess your personal sense of happiness. 
                    It is not intended to provide a clinical diagnosis, but rather to give you 
                    a quick reflection of your emotional well-being.
                </p>
                <p>
                    Your responses are based on how you perceive your life and experiences. 
                    Unlike more objective measurements, this scale values your own feelings 
                    and interpretation of happiness. Everyone experiences happiness differently, 
                    and that's perfectly okay!
                </p>
            </div>

                <!-- 2. Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Question Responses (Q1–Q4):</strong> Four statements that measure how you perceive happiness in your life and compare it to others.</li>
            <li><strong>7-Point Scale:</strong> Each question is answered on a scale of 1 to 7, where 1 represents “Not at all happy” and 7 represents “Very happy.”</li>
            <li><strong>Average Happiness Score:</strong> The calculator computes the mean of all four responses to determine your subjective happiness score.</li>
        </ul>
    </div>

            <div class="note-card">
                <h3>🧬 What Influences Happiness?</h3>
                <p>According to psychological research, happiness is influenced by three major components:</p>
                <ol>
                    <li><strong>Intentional thoughts and actions (40%)</strong> – how you respond to life, the habits you form, and your mindset.</li>
                    <li><strong>Genetics (50%)</strong> – your natural disposition and personality traits.</li>
                    <li><strong>External circumstances (10%)</strong> – such as income, health, and environment.</li>
                </ol>
                <p>
                    This means that almost half of your happiness can be shaped by your own actions and choices! 
                    Simple things like spending quality time with loved ones, expressing gratitude, 
                    or engaging in fulfilling activities can make a big difference.
                </p>
            </div>

            <div class="note-card">
                <h3>🌱 Nurturing Your Happiness</h3>
                <p>
                    If you feel your score is lower than expected, don’t worry. Happiness is not a fixed state – 
                    it’s a journey that you can continuously nurture and grow. Reflect on what brings you joy 
                    and meaning, and remember: even small changes in your daily life can lead to greater 
                    happiness over time.
                </p>
            </div>

            <div class="note-card">
                <h3>ℹ️ Input Validations</h3>
                <div class="note-list">
                    <p>
                    To make sure your <strong>Happiness Score</strong> is calculated correctly, please follow these input rules:
                    </p>
                    <ul>
                        <li><strong>Required Fields:</strong> You must answer all 4 questions before calculating.</li>
                        <li><strong>Valid Range:</strong> Each answer must be between <strong>1</strong> and <strong>7</strong>.</li>
                        <li><strong>No Empty Selections:</strong> Leaving a question blank will stop the calculation.</li>
                        <li><strong>No Invalid Values:</strong> Letters, symbols, or numbers outside <code>1–7</code> are not allowed.</li>
                        <li><strong>Consistent Scale:</strong> Higher numbers always mean greater happiness, except Q4 (reverse scoring is already applied).</li>
                        <li><strong>Error Messages:</strong> If an invalid or missing value is detected, a warning will appear instead of results.</li>
                        <li><strong>Correct Example:</strong> Select <code>5</code> if you feel “above average happy.”</li>
                    </ul>
                    <p>
                    ✅ These checks ensure that your score is meaningful and reliable, just like compliance metrics in real audits and safety reports.
                    </p>
                </div>
            </div>

  <div class="note-card">
        <h3>📤 Output Validations</h3>
        <p>
            Once you submit valid inputs, the calculator displays your average happiness score along with an interpretation message 
            to help you understand your emotional state:
        </p>
        <ul class="note-list">
            <li><strong>1–3:</strong> Indicates lower levels of happiness – may reflect stress, dissatisfaction, or low mood.</li>
            <li><strong>4–5:</strong> Represents an average range – typical day-to-day happiness levels.</li>
            <li><strong>6–7:</strong> Suggests high subjective happiness – positive mindset and life satisfaction.</li>
        </ul>
        <p style="margin-top:10px; color:#555;">
            💡 The assessment feedback is displayed along with the result, helping you reflect on your current well-being 
            and encouraging self-awareness or positive change.
        </p>
    </div>

    <!-- 5. Governing Principle -->
    <div class="note-card">
        <h3>⚖ Governing Principle</h3>
        <p>
            There is no single “Happiness Calculator” standard, as different organizations use varying methodologies and 
            criteria to measure happiness. Many personal online tools are based on specific psychological scales, while 
            large-scale international reports use a combination of factors to create a national happiness index.
        </p>
        <p>
            The most prominent example of a large-scale happiness metric is the <strong>World Happiness Report</strong>. 
            It is published annually by the <strong>United Nations Sustainable Development Solutions Network</strong> 
            and relies primarily on data from the <strong>Gallup World Poll</strong>.
        </p>

        <p><strong style="color: #1976d2;">Standards Used in the World Happiness Report:</strong></p>
        <ul class="note-list">
            <li><strong>Subjective Measure – The Cantril Ladder:</strong> Respondents visualize a ladder from 0 (worst life) to 10 (best life) 
                and rate their current life position on that scale.</li>
            <li><strong>Objective Measures – Six Key Variables:</strong> GDP per capita, social support, healthy life expectancy, 
                freedom to make life choices, generosity, and perceptions of corruption.</li>
        </ul>

        <p><strong style="color: #1976d2;">Other Notable Happiness Standards:</strong></p>
        <ul class="note-list">
            <li><strong>Gross National Happiness (GNH) Index:</strong> Developed in Bhutan, measuring well-being across nine domains including 
                culture, environment, and psychological well-being.</li>
            <li><strong>Subjective Happiness Scale (SHS):</strong> A four-item psychological tool for measuring individual happiness perception, 
                forming the basis for this calculator.</li>
            <li><strong>Happiness Index (Happiness Alliance):</strong> A survey-based tool assessing happiness across ten domains such as 
                time balance and community vitality.</li>
        </ul>
    </div>

    <!-- 6. Conclusion -->
    <div class="note-card">
        <h3>🧩 Conclusion</h3>
        <p>
            The <strong>Subjective Happiness Scale (SHS)</strong> Calculator helps you gain self-awareness about your happiness levels 
            through introspection and honest reflection. It highlights that happiness is dynamic — shaped by thoughts, behaviors, 
            and life choices.
        </p>
        <p>
            Regardless of your score, remember that happiness can always be nurtured. Simple steps such as gratitude, mindfulness, 
            social connection, and self-care can significantly improve well-being over time.
        </p>
        <p>
            🌿 Happiness isn’t a final destination — it’s a journey you can continuously grow through positivity, purpose, and 
            personal reflection.
        </p>
    </div>

</div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
    });

    function calculateHappiness() {
        let score = 0;
        let totalQuestions = 4;

        for (let i = 1; i <= totalQuestions; i++) {
            let val = document.getElementById(`q${i}`).value;

            // Required field check
            if (!val) {
                alert(`⚠️ Please answer Question ${i} before calculating.`);
                return;
            }

            val = parseInt(val);

            // Validate numeric and range (1–7 only)
            if (isNaN(val) || val < 1 || val > 7) {
                alert(`⚠️ Invalid input in Question ${i}. Please select a number between 1 and 7.`);
                return;
            }

            score += val;
        }

        // Division by zero protection
        if (totalQuestions === 0) {
            alert("⚠️ No questions available for calculation.");
            return;
        }

        const avgScore = (score / totalQuestions);
        if (avgScore < 1 || avgScore > 7) {
            alert("⚠️ Calculation error. Score out of valid range (1–7). Please retry.");
            return;
        }

        // Update results UI
        document.getElementById('rateValue').textContent = avgScore.toFixed(1);

        const meterFill = document.getElementById('meterFill');
        let meterWidth, meterColor, feedback;

        if (avgScore < 4) {
            meterWidth = '33%'; meterColor = '#f39c12';
            feedback = "Your score is lower than average. Remember, happiness can be cultivated over time through gratitude, social connection, and meaningful activities.";
        } else if (avgScore < 5.5) {
            meterWidth = '66%'; meterColor = '#2ecc71';
            feedback = "Your happiness level is in the average range for most people. There’s always room to grow by reflecting on what brings you joy.";
        } else {
            meterWidth = '95%'; meterColor = '#27ae60';
            feedback = "Your happiness score is higher than average! That’s wonderful. Keep nurturing your well-being and doing what works for you.";
        }

        meterFill.style.width = meterWidth;
        meterFill.style.backgroundColor = meterColor;
        document.getElementById('feedbackContent').innerHTML = feedback;

        // Show results
        document.getElementById('placeholder').classList.add('hidden');
        document.getElementById('resultValue').classList.remove('hidden');
    }

    function printReport() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        if (document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        }
        window.print();
    }
    </script>

</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (Industry-aligned)

Even though this is a Happiness Calculator, we apply the same rigor as in safety KPIs to ensure valid, auditable, and meaningful data.

✅ General Validation Principles

Required Fields: All four questions (q1–q4) must be answered before calculation.

Numeric & Discrete Input Only: Only integer values 1–7 are allowed (no decimals, letters, or symbols).

Unit Consistency: The scale is ordinal (Likert scale 1–7). Values outside the scale must be blocked.

Cross-field Dependency: Since q4 is reverse-scored, its mapping must be validated (1 → 7, 2 → 6, …).

Logical Completeness: No null, empty, or NaN values allowed.

📋 Validation Rules Table
Field	Expected Input	Validation Rules	Compliance Rationale
Q1 – General happiness	Integer (1–7)	Must be integer, ≥1 and ≤7	Prevents invalid/unrealistic scoring
Q2 – Peer comparison	Integer (1–7)	Must be integer, ≥1 and ≤7	Maintains ordinal scale consistency
Q3 – Self-description (happy)	Integer (1–7)	Must be integer, ≥1 and ≤7	Ensures Likert scale compliance
Q4 – Self-description (unhappy)	Integer (1–7, reversed)	Must be integer, ≥1 and ≤7; must map correctly to reverse scoring	Prevents logical inconsistency in scoring
Average Score Output	Decimal (1.00–7.00)	Must be rounded to 2 decimals; division by zero prevented	Ensures audit-ready reporting
2. Output Validation Logic

Valid Range: Happiness scores must always be between 1.00 and 7.00.

Thresholds (aligned to audit-style KPIs):

< 4.00 → Below Average (Needs Improvement)

4.00 – 4.99 → Average Zone (Acceptable, Monitor)

≥ 5.00 → Above Average (Positive Indicator)

Error Handling: If results fall outside range due to a coding or user error, show a “⚠️ Invalid input detected. Please recheck answers.”
-->