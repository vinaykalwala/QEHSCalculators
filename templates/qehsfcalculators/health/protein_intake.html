{% extends 'base.html' %}
{% block title %}Daily Protein Intake Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Protein Intake Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px; /* Fixed height to match reference */
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        .rate-label {
            color: #2980b9;
            font-weight: bold;
            font-size: 20px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Daily Protein Intake Calculator</h1>
            <p>Estimate your optimal daily protein requirement based on your body and lifestyle.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Your Profile</h2>
                <div class="form-group">
                    <label for="age">Age (years)</label>
                    <input type="number" id="age" class="form-input" placeholder="e.g., 35">
                </div>
                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" class="form-select">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="height">Height (cm)</label>
                    <input type="number" id="height" class="form-input" placeholder="e.g., 175">
                </div>
                <div class="form-group">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" id="weight" class="form-input" placeholder="e.g., 70">
                </div>
                <div class="form-group">
                    <label for="activity">Activity Level</label>
                    <select id="activity" class="form-select">
                        <option value="sedentary">Sedentary (Little or no exercise)</option>
                        <option value="light">Lightly Active (Exercise 1-3 days/week)</option>
                        <option value="moderate">Moderately Active (Exercise 3-5 days/week)</option>
                        <option value="active">Very Active (Exercise 6-7 days/week)</option>
                        <option value="extra">Athlete / Extra Active (Intense daily exercise)</option>
                    </select>
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate Protein Needs</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Health illustration">
                    <p>Enter your profile details to get a personalized daily protein intake recommendation.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Recommended Daily Protein</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0</div>
                        <div class="rate-label">grams/day</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Sedentary</span>
                        <span>Moderate</span>
                        <span>Athlete</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Personalized Range</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>🔎  About This Calculator</h3>
                <p>
                    Protein is a crucial macronutrient that supports muscle repair, metabolic function, and overall well-being.
                    Use this guide to understand how your <strong>age, gender, body weight, and activity level</strong>
                    influence
                    your daily protein needs.
                </p>
            </div>
        
            <div class="note-card">
                <h3>📊 Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Age:</strong> Children and adolescents require more for growth, while older adults need
                        increased intake to maintain muscle mass and strength.</li>
                    <li><strong>Gender:</strong> Men generally require more protein due to higher muscle mass, while women need
                        consistent intake for hormonal balance and tissue repair.</li>
                    <li><strong>Body Weight:</strong> Protein requirements are calculated based on body weight—the more you
                        weigh, the higher your needs.</li>
                    <li><strong>Activity Level:</strong> Active individuals need more protein for muscle repair and recovery,
                        while sedentary individuals require less.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <h3>ℹ️ Input Validation Rules</h3>
                <ul class="note-list">
                    <li> <strong>Age</strong>: Must be a positive number (up to 120 years).</li>
                    <li> <strong>Weight</strong>: Must be a positive number in kilograms (reasonable range: up to 300kg).</li>
                    <li> <strong>Height</strong>: Must be entered in centimeters (reasonable range: up to 250cm).</li>
                    <li> <strong>Activity Level</strong>: Choose from the dropdown (Sedentary, Light, Moderate, Active, Extra
                        Active).</li>
                    <li> Negative, zero, or blank values are not accepted.</li>
                    <li> Unrealistic values trigger warnings to help ensure correct input.</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>🧮 Output Validation Rules</h3>
    <ul class="note-list">
        <li><strong>Calculated Range:</strong> The result is based on standard multipliers (0.8–2.2 g/kg/day) depending on your activity level and age.</li>
        <li><strong>Upper Limit Check:</strong> Protein intake is capped at <b>300 g/day</b> to prevent unrealistic or unsafe outputs that could strain kidney function.</li>
        <li><strong>Age Adjustment:</strong> For individuals aged 65 and above, the calculator increases the baseline requirement (≥1.0 g/kg) to prevent muscle loss.</li>
        <li><strong>Safety Band Visualization:</strong> The progress meter color and length dynamically indicate where your protein intake stands within the safe range.</li>
        
            <ul class="note-list">
                <li>✅ <b>Safe Range:</b> Balanced protein intake suitable for general health.</li>
                <li>⚠️ <b>High Range:</b> For athletes or intense training; ensure hydration and medical supervision.</li>
                <li>❌ <b>Unsafe Input:</b> Values outside valid physiological limits are rejected automatically.</li>
            </ul>
        </li>
    </ul>
</div>

            <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        Protein Intake Calculators are based on standards and scientific recommendations from organizations like the Institute of Medicine (IOM), Academy of Nutrition and Dietetics (AND), and the American College of Sports Medicine (ACSM), as well as Dietary Reference Intakes (DRI) and international expert groups such as the World Health Organization (WHO) and the Food and Agriculture Organization (FAO). They use general guidelines and formulas to provide an estimated daily protein requirement based on individual factors like age, weight, gender, activity level, and health goals, but these tools are for informational purposes and not a substitute for professional medical advice.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Key Standards and Organizations</h3>
    <ul class="note-list">
        <li><b>Institute of Medicine (IOM):</b> Provides guidelines for various nutrient intakes, including protein.</li>
        <li><b>Academy of Nutrition and Dietetics (AND):</b> Another prominent organization that offers scientific recommendations for nutrition.</li>
        <li><b>American College of Sports Medicine (ACSM):</b> Provides recommendations on exercise and nutrition, including protein needs for active individuals.</li>
        <li><b>Dietary Reference Intakes (DRI):</b> These are general guidelines for nutrient requirements, often used as the basis for protein calculators.</li>
        <li><b>World Health Organization (WHO) & Food and Agriculture Organization (FAO):</b> International expert groups that have established standards for protein requirements.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">How They Work</h3>
    <ul class="note-list">
        <li><b>Personalized Input:</b> Calculators use your personal information (age, weight, gender, activity level) and input it into established formulas to estimate your protein needs.</li>
        <li><b>Standard Formulas:</b> These formulas are based on the recommended daily protein intake per kilogram of body weight, which is a fundamental standard in nutrition science.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Important Considerations</h3>
    <ul class="note-list">
        <li><b>Informational Tool:</b> Protein intake calculators are estimation tools designed to provide general guidance.</li>
        <li><b>Not Medical Advice:</b> The information from these calculators should not replace professional medical advice from a qualified healthcare provider.</li>
        <li><b>Individual Variation:</b> Your specific protein requirements can vary significantly based on your health condition, metabolism, and physical activity.</li>
        <li><b>Special Populations:</b> Calculators may not be suitable for children, pregnant or lactating women, or individuals with certain medical conditions, as their needs differ.</li>
    </ul>
</div>
        
            <div class="note-card">
                <h3>📌 Recommended Daily Protein Intake</h3>
                <ul class="note-list">
                    <li><strong>General Adults (CDC Guideline):</strong> 0.8 g per kg of body weight to maintain basic
                        functions.</li>
                    <li><strong>Athletes:</strong> 1.2 – 2.0 g per kg of body weight to support muscle recovery and endurance.
                    </li>
                    <li><strong>Older Adults:</strong> 1.0 – 1.2 g per kg of body weight to prevent muscle loss and maintain
                        strength.</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>💪 Why is Protein Essential?</h3>
                <p>
                    Protein is vital for building and repairing tissues, producing enzymes, and supporting immune health.
                    Adequate intake is linked to improved muscle retention, better metabolic health, and faster recovery from
                    physical activity.
                </p>
            </div>
        

            <div class="note-card">
                <h3>⚠️ Disclaimer</h3>
                <p>
                    This calculator provides estimated daily protein intake ranges for healthy individuals.
                    Actual needs may vary based on health conditions, fitness goals, or medical concerns.
                    Consult a registered dietitian or healthcare provider for personalized advice.
                </p>
            </div>
    
        <div class="note-card">
    <h3>🧾 Conclusion</h3>
    <p>
        This calculator estimates your ideal daily protein intake using age, gender, weight, and activity level to align with international nutritional standards.
        It ensures results remain within physiologically safe and scientifically recommended limits, helping users maintain balanced nutrition without exceeding healthy thresholds.
        Always consult a healthcare or nutrition professional for personalized dietary planning.
    </p>
</div>
</div>


    </div>

    <script>
        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            // Reset display
            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];

            // Generic validation function
            function getVal(id, label, maxLimit = null) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (!raw) {
                    errors.push(`👉 ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num) || num <= 0) {
                    errors.push(`👉 Enter a valid positive number for ${label}.`);
                    return null;
                }
                if (maxLimit && num > maxLimit) {
                    errors.push(`👉 ${label} seems too high (max ${maxLimit}). Please check again.`);
                }
                return num;
            }

            const age = getVal('age', 'Age', 120);
            const weight = getVal('weight', 'Weight (kg)', 300);
            const height = getVal('height', 'Height (cm)', 250); // validated but not used
            const activity = document.getElementById('activity').value;

            // Stop if validation failed
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }

            // Default multipliers (sedentary baseline)
            let minMultiplier = 0.8, maxMultiplier = 1.0;

            switch (activity) {
                case "light": minMultiplier = 1.0; maxMultiplier = 1.2; break;
                case "moderate": minMultiplier = 1.2; maxMultiplier = 1.5; break;
                case "active": minMultiplier = 1.5; maxMultiplier = 1.8; break;
                case "extra": minMultiplier = 1.7; maxMultiplier = 2.2; break;
            }

            // Seniors (65+) special adjustment
            if (age >= 65) {
                minMultiplier = Math.max(minMultiplier, 1.0);
                maxMultiplier = Math.max(maxMultiplier, 1.2);
            }

            const minProtein = minMultiplier * weight;
            const maxProtein = maxMultiplier * weight;
            const avgProtein = (minProtein + maxProtein) / 2;

            // Show result
            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = avgProtein.toFixed(0);

            const meterFill = document.getElementById('meterFill');
            const absoluteMin = 0.8 * weight;
            const absoluteMax = 2.2 * weight;

            let pct = ((avgProtein - absoluteMin) / (absoluteMax - absoluteMin)) * 100;
            pct = Math.max(5, Math.min(100, pct));
            meterFill.style.width = pct + '%';

            document.getElementById('feedbackContent').innerHTML = `
                🍗 Your recommended daily protein intake is between 
                <strong>${minProtein.toFixed(0)}g</strong> and 
                <strong>${maxProtein.toFixed(0)}g</strong>.
            `;
        }

        function printReport() {
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (Real-world, QEHS-Compliant)

From a safety and occupational health standpoint, inputs must be realistic, consistent, and bounded by medical and ergonomic standards.

Age

Range: 2 – 120 years (infants not supported in this calculator).

Validation: Must be an integer, no decimals.

Reason: Below 2 years → medical supervision required, >120 years → unrealistic entry.

Height (cm)

Range: 50 – 250 cm.

Validation: Positive number, max 2 decimal places allowed.

Reason: Below 50 cm = infant/invalid entry, above 250 cm = outlier.

Weight (kg)

Range: 10 – 250 kg.

Validation: Positive number, max 1 decimal place allowed.

Reason: <10 kg = pediatric case, >250 kg = morbid obesity (calculator not designed for clinical use).

Gender

Must be explicitly selected (male/female).

Dependency: Used to adjust protein thresholds in future (muscle mass difference).

Activity Level

Must be chosen from predefined options.

Dependency: Protein multiplier changes with workload → critical for ergonomic safety and avoiding protein over-supplementation.

2. Output Validation Logic

Base Formula: Protein = multiplier × body weight (kg).

Ranges (grams/kg/day):

Sedentary: 0.8 – 1.2

Light: 1.0 – 1.5

Moderate: 1.2 – 1.7

Active: 1.4 – 2.0

Athlete: 1.6 – 2.2

Adjustment for Age ≥ 50: Add 0.2 – 0.3 g/kg/day → aligns with sarcopenia prevention guidelines.

Cap: 300 g/day absolute upper limit → prevents unsafe recommendations (renal overload risk).

Meaningful Output: Show range (min–max) with interpretation:

✅ Within safe protein range.

⚠️ Approaching upper safe intake (risk of dehydration, kidney stress).

❌ Invalid or dangerous input combination.
-->