{% extends 'base.html' %}
{% block title %}Diet Risk Score Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diet Risk Score Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            max-height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .result-value {
            width: 100%;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        .rate-label {
            color: #7f8c8d;
            font-size: 16px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Diet Risk Score Calculator</h1>
            <p>How often do you eat the following foods? Answer to assess your diet's health risk.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Diet Questionnaire</h2>

                <div class="form-group">
                <label for="fastFood">Fast food üçï:</label>
                <select id="fastFood" class="form-select">
                    <option value="3">Daily</option>
                    <option value="2">2‚Äì3 times a week</option>
                    <option value="1">Once a week</option>
                    <option value="0">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="bread">Bread, rolls ü•™:</label>
                <select id="bread" class="form-select">
                    <option value="3">Daily</option>
                    <option value="2">2‚Äì3 times a week</option>
                    <option value="1">Once a week</option>
                    <option value="0">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="snacks">Chips, salty snacks ü•®:</label>
                <select id="snacks" class="form-select">
                    <option value="3">Daily</option>
                    <option value="2">2‚Äì3 times a week</option>
                    <option value="1">Once a week</option>
                    <option value="0">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="processedMeat">Hot dogs, sausages üå≠:</label>
                <select id="processedMeat" class="form-select">
                    <option value="3">Daily</option>
                    <option value="3">2‚Äì3 times a week</option>
                    <option value="3">Once a week</option>
                    <option value="0">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="sweetDrinks">Sugary drinks ü•§:</label>
                <select id="sweetDrinks" class="form-select">
                    <option value="3">Daily</option>
                    <option value="2">2‚Äì3 times a week</option>
                    <option value="1">Once a week</option>
                    <option value="0">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="nuts">Nuts, seeds, peanut butter ü•ú:</label>
                <select id="nuts" class="form-select">
                    <option value="0">Daily</option>
                    <option value="0">2‚Äì3 times a week</option>
                    <option value="2">Once a week</option>
                    <option value="3">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="fish">Fish, shellfish üêü:</label>
                <select id="fish" class="form-select">
                    <option value="0">Daily</option>
                    <option value="0">2‚Äì3 times a week</option>
                    <option value="1">Once a week</option>
                    <option value="3">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="vegetables">Vegetables ü•ï:</label>
                <select id="vegetables" class="form-select">
                    <option value="0">Daily</option>
                    <option value="3">2‚Äì3 times a week</option>
                    <option value="3">Once a week</option>
                    <option value="3">Never</option>
                </select>
                </div>

                <div class="form-group">
                <label for="fruit">Fruits üçé:</label>
                <select id="fruit" class="form-select">
                    <option value="0">Daily</option>
                    <option value="3">2‚Äì3 times a week</option>
                    <option value="3">Once a week</option>
                    <option value="3">Never</option>
                </select>
                </div>

                <button class="calculate-btn" onclick="calculateDietRisk()">Calculate Score</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Answer the questions to see your <strong>Diet Risk Score</strong> and receive personalized feedback.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Your Diet Risk Score</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0</div>
                        <div class="rate-label">Points</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Excellent</span><span>Okay</span><span>High Risk</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Assessment & Recommendations</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    This tool provides a quick assessment of your dietary habits by scoring your food choices. It is designed to raise awareness about how frequently you consume high-risk foods (like fast food and processed meats) versus beneficial foods (like fruits and vegetables). A higher score indicates a greater dietary risk, while a lower score reflects healthier eating patterns.
                </p>
            </div>

            <div class="note-card">
                <h3>‚öôÔ∏è Parameters Used</h3>
                <p>The calculator evaluates your diet based on the frequency of consumption for nine food categories. Foods are classified as either "high-risk" or "healthy."</p>
                <ul class="note-list">
                    <li><strong>High-Risk Foods:</strong> Items like fast food, sugary drinks, and processed meats increase your score when consumed frequently.</li>
                    <li><strong>Healthy Foods:</strong> Items like fruits, vegetables, and fish lower your risk score when consumed frequently.</li>
                    <li><strong>Scoring Tiers:</strong> The final score places your diet into one of three risk categories: Excellent (0-9), Okay (10-18), or High Risk (19+).</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>‚úÖ Input Validation Rules</h3>
                <p>For an accurate result, please adhere to the following rules:</p>
                <ul class="note-list">
                    <li><strong>All Questions Required:</strong> You must select an answer for all nine food categories.</li>
                    <li><strong>Valid Selections:</strong> Each dropdown provides four frequency options. The score for each (0-3) is assigned automatically based on your choice and whether the food is high-risk or healthy.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>‚úÖ Output Validations</h3>
                <p>Your total score corresponds to one of three assessment categories, each with tailored feedback:</p>
                <ul class="note-list">
                    <li><strong>Score 0-9:</strong> üåü Excellent! Your diet is wholesome and heart-friendly.</li>
                    <li><strong>Score 10-18:</strong> üß© You're doing okay! Just a few mindful swaps could enhance your nutrition.</li>
                    <li><strong>Score 19+:</strong> üö® High Dietary Risk: Your eating pattern could increase health risks.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>‚öñÔ∏è Governing Principle</h3>
                <p>
                    A diet risk score (DRS) calculator is not based on a single, universal standard but is typically adapted from or validated against established dietary indices and health guidelines. The underlying standard used depends on the specific tool or calculator being used.
                </p>
                <p>Here are some of the common standards and indices on which diet risk score calculators are based:</p>
                 <ul class="note-list">
                    <li><strong>Healthy Eating Index (HEI):</strong> Many diet risk scores are modeled on or validated against the Healthy Eating Index (HEI), developed by the U.S. Department of Agriculture (USDA).
                        <p style="margin-left: 20px;"><strong>How it works:</strong> The HEI is a measure of overall diet quality, assessing alignment with the Dietary Guidelines for Americans. It scores dietary components like fruits, vegetables, and whole grains, while penalizing high intake of saturated fats and added sugars.</p>
                        <p style="margin-left: 20px;"><strong>Example:</strong> A 9-item Diet Risk Score (DRS) calculator developed for clinical practice was validated against the HEI-2015.</p>
                    </li>
                    <li><strong>Dietary Approaches to Stop Hypertension (DASH):</strong> The DASH diet pattern, originally developed to lower blood pressure, is another basis for diet risk scores and dietary assessment tools.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>üßæ Conclusion</h3>
                <p>
                    This calculator serves as a simple guide to help you reflect on your eating habits. A high score is an opportunity to introduce positive changes. Small, consistent adjustments, like adding more vegetables or reducing sugary drinks, can significantly improve your overall health over time.
                </p>
                 <p>
                    ‚ö†Ô∏è <strong>Important:</strong> This tool is for informational purposes and is not a substitute for professional medical or nutritional advice. Consult a doctor or registered dietitian for personalized guidance.
                </p>
            </div>
        </div>

    </div>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    if (document.getElementById('printDate')) {
        document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
    }
});

function calculateDietRisk() {
    const fields = [
        'fastFood', 'bread', 'snacks',
        'processedMeat', 'sweetDrinks',
        'nuts', 'fish', 'vegetables', 'fruit'
    ];

    let totalScore = 0;
    let errors = [];

    for (let field of fields) {
        const elem = document.getElementById(field);
        if (!elem || elem.value === "") {
             errors.push(`‚ùå Please make a selection for all fields.`);
             break; // Stop after first error to avoid multiple messages
        }
        totalScore += parseInt(elem.value, 10);
    }

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    if (errors.length > 0) {
        errorMessage.innerHTML = errors[0];
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Clear errors
    errorBox.classList.add("hidden");

    // Show score
    document.getElementById('rateValue').textContent = totalScore;

    // Feedback & meter logic
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (totalScore <= 9) {
        meterWidth = '33%'; meterColor = '#2ecc71';
        feedback = `
            <p>üåü <strong>Excellent! Your diet is wholesome and heart-friendly.</strong></p>
            <p>You‚Äôre consistently choosing nourishing foods that support your energy, immune system, and long-term health. Keep eating a variety of fruits, vegetables, and lean proteins.</p>
        `;
    } else if (totalScore <= 18) {
        meterWidth = '66%'; meterColor = '#f1c40f';
        feedback = `
            <p>üß© <strong>You're doing okay! Just a few mindful swaps could enhance your nutrition.</strong></p>
            <p>You‚Äôre on the right track, but some processed items might be appearing too often. Try swapping one snack or drink for a healthier option this week.</p>
        `;
    } else {
        meterWidth = '95%'; meterColor = '#e74c3c';
        feedback = `
            <p>üö® <strong>High Dietary Risk: Your eating pattern could increase health risks.</strong></p>
            <p>This score is a helpful signal to make positive changes. Start by adding one more serving of vegetables to your day or replacing one sugary drink with water.</p>
        `;
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

function printReport() {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    if (document.getElementById('printDate')) {
        document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
    }
    window.print();
}
    </script>

</body>
</html>
{% endblock %}

<!-- 
1Ô∏è‚É£ Analysis of Inputs & Outputs (from QEHS perspective)

Your calculator captures dietary risk factors (fast food, bread, snacks, processed meat, sugary drinks, nuts, fish, vegetables, fruits).

From a safety & compliance lens:

These are leading indicators (like unsafe acts in safety audits).

Output (Diet Risk Score) is a lagging indicator (comparable to incident rates).

Results should be interpretable, auditable, and standardized (so two auditors calculate the same score from the same answers).

2Ô∏è‚É£ Input Validation Rules
Field	Expected Range	Allowed Values	Units / Context	Validation Rationale
Fast Food	0‚Äì3	Integer only	Frequency scale (Never ‚Üí Daily)	Prevents out-of-scale scoring.
Bread	0‚Äì3	Integer only	Frequency scale	Same logic as above.
Snacks	0‚Äì3	Integer only	Frequency scale	Must be mapped correctly.
Processed Meat	0‚Äì3	Integer only	Frequency scale	Currently all options =3 (bug!). Needs correction.
Sugary Drinks	0‚Äì3	Integer only	Frequency scale	Same as above.
Nuts	0‚Äì3	Integer only	Frequency scale (reverse scored, healthier = lower)	Prevents illogical scoring (e.g., negative).
Fish	0‚Äì3	Integer only	Frequency scale (reverse scored)	Healthy ‚Üí low score, Unhealthy ‚Üí high score.
Vegetables	0‚Äì3	Integer only	Frequency scale (reverse scored)	Needs correction (currently wrong mapping).
Fruits	0‚Äì3	Integer only	Frequency scale (reverse scored)	Needs correction.

üîë Compliance requirement: Only 0‚Äì3 integers should be accepted. No text, decimals, or blank values.

3Ô∏è‚É£ Edge Case Validations

Division by zero ‚Üí Not applicable here, but prevent empty/NaN totals.

All fields left blank ‚Üí Show error: ‚ÄúPlease answer all questions before scoring.‚Äù

Unrealistic input combinations ‚Üí E.g., ‚ÄúDaily fast food + Never vegetables‚Äù should still be valid, but flagged as High Risk automatically.

Extreme outliers ‚Üí Since only 0‚Äì3 allowed, protect against 999, -5, etc.

Data tampering ‚Üí If someone edits the DOM to bypass dropdown values, validation must block it.

4Ô∏è‚É£ Output Validation & Thresholds

Currently:

<10 = Excellent

10‚Äì18 = Okay

‚â•19 = High Risk

‚úÖ These thresholds are good but need justification:

Excellent (<10): Equivalent to best-practice compliance (like <1 OSHA incident rate).

Okay (10‚Äì18): Minor deficiencies, needs continuous improvement.

High Risk (‚â•19): Serious deficiencies; corrective action required (like OSHA Recordable Incident).
-->