{% extends 'base.html' %}
{% block title %}Ankle-Brachial Index (ABI) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ankle-Brachial Index (ABI) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
      

        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
            text-align: center; /* centers inline-block buttons */
            margin-top: 20px;
        }

        .btn-wrapper {
            text-align: center; /* centers the button */
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;   /* control button size */
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important; /* prevent full width */
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" with report_title="Ankle-Brachial Index (ABI) Report" %}

    <div class="calculator-header">
        <h1>Ankle-Brachial Index (ABI) Calculator</h1>
        <p>Assess for Peripheral Artery Disease (PAD) by comparing blood pressure in the ankles to the arms.</p>
    </div>

    <div class="calc-content">
        <div class="calc-card">
            <h2>Enter Pressures</h2>
            <div class="form-group"><label for="armPressure">Highest Arm Systolic Pressure (mmHg)</label><input type="number" id="armPressure" class="form-input" placeholder="e.g., 120" min="1"></div>
            <div class="form-group"><label for="rightAnkle">Highest Right Ankle Systolic Pressure (mmHg)</label><input type="number" id="rightAnkle" class="form-input" placeholder="e.g., 130" min="0"></div>
            <div class="form-group"><label for="leftAnkle">Highest Left Ankle Systolic Pressure (mmHg)</label><input type="number" id="leftAnkle" class="form-input" placeholder="e.g., 110" min="0"></div>
            <button class="calculate-btn" onclick="calculateABI()">Calculate ABI</button>
        </div>

        <div class="result-card">
            <div class="result-placeholder" id="placeholder"><img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Blood pressure icon"><p>The ABI results for the left and right ankle will be displayed here.</p></div>
            <div class="result-error hidden" id="resultError"><div class="error-message" id="errorMessage"></div></div>
            <div class="result-value hidden" id="resultValue">
                <div class="result-grid">
                    <div class="result-half"><h3>Right Ankle</h3><div class="rate-value" id="rightAbiValue">0.00</div><div class="feedback-content" id="rightAbiInterpretation"></div></div>
                    <div class="result-half"><h3>Left Ankle</h3><div class="rate-value" id="leftAbiValue">0.00</div><div class="feedback-content" id="leftAbiInterpretation"></div></div>
                </div>
                <div class="btn-wrapper"><button class="calculate-btn print-btn" onclick="printReport()">Print Report</button></div>
            </div>
        </div>
    </div>

    <div class="note-section">
        <div class="note-card"><h3>Note:</h3><p>The <strong>Ankle-Brachial Index (ABI)</strong> is a non-invasive diagnostic tool used to evaluate the presence and severity of peripheral artery disease (PAD). By comparing the blood pressure in the ankle to the blood pressure in the arm, healthcare providers can assess blood flow and detect arterial narrowing or blockage.</p></div>
       <div class="note-card">
    <h3>About This Calculator</h3>
    <p>
        This <strong>Ankle-Brachial Index (ABI) Calculator</strong> estimates the presence and severity of peripheral artery disease (PAD) by comparing ankle systolic pressure to arm systolic pressure. The calculator uses validated clinical ranges and provides interpretation for both left and right leg measurements.
    </p>
</div>
        <div class="note-card"><h3>Parameters Used</h3><ul><li><strong>Highest Arm Systolic Pressure:</strong> This is the systolic pressure (top number) from the arm that shows the highest reading. It serves as the baseline for calculating ABI and reflects central blood pressure.</li><li><strong>Highest Right Ankle Systolic Pressure:</strong> This is the highest systolic pressure recorded in the arteries of the right ankle. It helps detect any obstruction in the blood flow to the right leg.</li><li><strong>Highest Left Ankle Systolic Pressure:</strong> This is the highest systolic pressure recorded in the arteries of the left ankle, used to detect obstruction in the blood flow to the left leg.</li></ul></div>

        <div class="note-card">
            <h3>Input Validation Rules</h3>
            <ul>
                <li><strong>Units:</strong> All inputs must be entered in <strong>mmHg (millimeters of mercury)</strong>.</li>
                <li><strong>Arm Systolic Pressure:</strong> Enter a value between <strong>60 and 250 mmHg</strong>. Values outside this range are not physiologically valid.</li>
                <li><strong>Ankle Systolic Pressures (Left & Right):</strong> Must be between <strong>50 and 250 mmHg</strong>.</li>
                <li><strong>Positive Values Only:</strong> No negative numbers, symbols, or text are allowed.</li>
                <li><strong>Decimals:</strong> Up to <strong>1 decimal place</strong> is accepted (e.g., 120.5).</li>
                <li><strong>No Empty Fields:</strong> All three fields must be filled in before calculation.</li>
                <li><strong>Logical Check:</strong> The ABI (Ankle ÷ Arm) is usually between <strong>0.3 and 1.4</strong>. Results outside this range may indicate measurement error or arterial calcification.</li>
                <li><strong>Division by Zero:</strong> Arm pressure cannot be <strong>0</strong> (to avoid invalid results).</li>
            </ul>
            <p class="note-tip">⚠️ Entering values outside these rules will show an error message and stop the calculation.</p>
            </div>

        
        <div class="note-card"><h3>Output Validations</h3><table class="custom-table"><thead><tr><th>ABI Range</th><th>Interpretation</th></tr></thead><tbody><tr><td><strong>Above 1.4</strong></td><td>May indicate vessel calcification or hardening. Consult a vascular specialist.</td></tr><tr><td><strong>1.0 – 1.4</strong></td><td>Normal ABI. No immediate action required.</td></tr><tr><td><strong>0.9 – 1.0</strong></td><td>Acceptable range. Usually no action required.</td></tr><tr><td><strong>0.8 – 0.9</strong></td><td>Mild arterial disease. Talk to your doctor about managing risk factors.</td></tr><tr><td><strong>0.5 – 0.8</strong></td><td>Moderate arterial disease. Consult a vascular specialist.</td></tr><tr><td><strong>Below 0.5</strong></td><td>Severe arterial disease. Immediate medical attention is advised.</td></tr></tbody></table></div>
        

<!-- ⚖️ Governing Principle -->
<div class="note-card">
    <h3>⚖️ Governing Principle</h3>
    <p>
        The <strong>Ankle-Brachial Index (ABI)</strong> Calculator provides a non-invasive assessment of peripheral artery disease (PAD) by calculating the ratio of ankle systolic pressure to arm (brachial) systolic pressure. While the method is widely accepted, there is no single universal standard for measurement or interpretation.
    </p>
    <p>
        <strong>How the Calculation Works:</strong>
        <ul>
            <li><strong>Measure Ankle Pressure:</strong> Systolic pressure is measured in the posterior tibial or anterior tibial arteries of the ankle.</li>
            <li><strong>Measure Arm Pressure:</strong> Systolic pressure is measured in the brachial artery of the arm.</li>
            <li><strong>Calculate Ratio:</strong> ABI = Ankle Systolic Pressure ÷ Arm Systolic Pressure.</li>
        </ul>
    </p>
    <p>
        <strong>Methods for Measurement:</strong>
        <ul>
            <li><strong>Doppler Technique:</strong> Gold standard; uses an ultrasound probe to detect blood flow and pressure.</li>
            <li><strong>Oscillometric Method:</strong> Automated blood pressure devices can also be used but may be slightly less precise.</li>
        </ul>
    </p>
    <p>
        <strong>Interpretation Guidelines:</strong>
        <ul>
            <li>Normal ABI: 1.0 – 1.4</li>
            <li>Mild PAD: 0.8 – 0.9</li>
            <li>Moderate PAD: 0.5 – 0.8</li>
            <li>Severe PAD: &lt; 0.5</li>
            <li>High ABI &gt; 1.4: Possible arterial calcification; consult a vascular specialist</li>
        </ul>
    </p>
    <p>
        <strong>Why There Isn’t a Single Standard:</strong>
        <ul>
            <li><strong>Methodological Variations:</strong> Doppler vs. oscillometric methods may give slightly different readings.</li>
            <li><strong>Definition Variations:</strong> Clinical guidelines and research studies may differ in cutoff values for diagnosing PAD.</li>
        </ul>
    </p>
    <p>
        <strong>Clinical Compliance:</strong> Proper input validation, range checks, and interpretation rules ensure that results are consistent with accepted clinical practice and guidelines for PAD screening.
    </p>
</div>

<!-- 🧾 Conclusion -->
<div class="note-card">
    <h3>🧾 Conclusion</h3>
    <p>
        The ABI Calculator is a reliable, non-invasive screening tool for peripheral artery disease when used according to validated measurement methods. Users should always interpret results in conjunction with clinical assessment and consult healthcare professionals for diagnosis or treatment planning.
    </p>
</div>
    </div>
</div>

<script>
function calculateABI() {
    const armPressure = parseFloat(document.getElementById('armPressure').value);
    const rightAnkle = parseFloat(document.getElementById('rightAnkle').value);
    const leftAnkle = parseFloat(document.getElementById('leftAnkle').value);

    const errorDiv = document.getElementById('resultError');
    const errorMsg = document.getElementById('errorMessage');
    const resultDiv = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const rightAbiValueEl = document.getElementById('rightAbiValue');
    const leftAbiValueEl = document.getElementById('leftAbiValue');
    const rightAbiInterpretationEl = document.getElementById('rightAbiInterpretation');
    const leftAbiInterpretationEl = document.getElementById('leftAbiInterpretation');

    // Reset sections
    errorDiv.classList.add('hidden');
    resultDiv.classList.add('hidden');
    placeholder.classList.remove('hidden');
    rightAbiValueEl.textContent = "";
    leftAbiValueEl.textContent = "";
    rightAbiInterpretationEl.textContent = "";
    leftAbiInterpretationEl.textContent = "";

    // Validation helper
    function showError(msg) {
        errorMsg.textContent = msg;
        errorDiv.classList.remove('hidden');
        placeholder.classList.add('hidden');
    }

    // --- Input Validations ---
    if (isNaN(armPressure) || isNaN(rightAnkle) || isNaN(leftAnkle)) {
        return showError("❌ All fields are required and must be numeric.");
    }
    if (armPressure < 60 || armPressure > 250) {
        return showError("❌ Arm systolic pressure must be between 60 and 250 mmHg.");
    }
    if (rightAnkle < 50 || rightAnkle > 250 || leftAnkle < 50 || leftAnkle > 250) {
        return showError("❌ Ankle systolic pressures must be between 50 and 250 mmHg.");
    }
    if (armPressure === 0) {
        return showError("❌ Arm pressure cannot be zero (division by zero).");
    }

    // --- Calculation ---
    const rightABI = parseFloat((rightAnkle / armPressure).toFixed(2));
    const leftABI = parseFloat((leftAnkle / armPressure).toFixed(2));

    if (rightABI < 0.3 || rightABI > 1.4 || leftABI < 0.3 || leftABI > 1.4) {
        return showError("❌ Calculated ABI outside expected range (0.3–1.4). Check inputs.");
    }

    // --- Interpretation ---
    function interpretABI(value) {
        if (value > 1.4) return "🔍 May indicate vessel calcification or stiff arteries. Consult a vascular specialist.";
        else if (value >= 1.0) return "✅ Normal ABI. No immediate action required.";
        else if (value >= 0.9) return "⚠️ Acceptable range. Usually no action required.";
        else if (value >= 0.8) return "⚠️ Mild arterial disease. Talk to your doctor about managing risk factors.";
        else if (value >= 0.5) return "🚨 Moderate arterial disease. Consult a vascular specialist.";
        else return "🚨 Severe arterial disease. Immediate medical attention is advised!";
    }

    // --- Display results ---
    rightAbiValueEl.textContent = rightABI.toFixed(2);
    leftAbiValueEl.textContent = leftABI.toFixed(2);
    rightAbiInterpretationEl.textContent = interpretABI(rightABI);
    leftAbiInterpretationEl.textContent = interpretABI(leftABI);

    placeholder.classList.add('hidden');
    resultDiv.classList.remove('hidden');
}

// --- Print Report ---
function printReport() {
    const printDateEl = document.getElementById('printDate');
    if (printDateEl) {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        printDateEl.textContent = now.toLocaleDateString('en-US', options);
    }
    window.print();
}
</script>

</body>
</html>
{% endblock %}