{% extends 'base.html' %}
{% block title %}Waist-to-Hip Ratio (WHR) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waist-to-Hip Ratio (WHR) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list { margin: 0; padding-left: 18px; }
        .custom-table {
            border-collapse: collapse; width: 100%;
            margin: 20px 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead { background-color: #1560bd; color: white; }
        .custom-table th, .custom-table td {
            padding: 12px 16px; border: 1px solid #ddd; text-align: center;
        }
        .custom-table tr:nth-child(even) { background-color: #f9f9f9; }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px; padding: 20px;
            text-align: left; gap: 12px; margin-top: 20px;
        }
        .error-icon { font-size: 76px; flex-shrink: 0; text-align: center; }
        .error-message { font-size: 24px; line-height: 1.6; }
        .hidden { display: none; }
        .btn-container { display: flex; justify-content: center; margin: 30px 0; }
        .back-btn {
            background: linear-gradient(#1560bd,#000040); color: #ffffff; border: 2px solid #1560bd;
            padding: 10px 20px; font-size: 14px; font-weight: 600; border-radius: 8px;
            text-decoration: none; transition: all 0.3s ease; cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Waist-to-Hip Ratio (WHR) Calculator</h1>
            <p>Assess your body fat distribution and potential health risks.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Your Measurements</h2>
                 <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" class="form-select">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="waist">Waist Circumference (cm)</label>
                    <input type="number" id="waist" class="form-input" placeholder="Enter waist measurement">
                </div>
                <div class="form-group">
                    <label for="hip">Hip Circumference (cm)</label>
                    <input type="number" id="hip" class="form-input" placeholder="Enter hip measurement">
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate WHR</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Enter your measurements to calculate your Waist-to-Hip Ratio and see your health risk category.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Waist-to-Hip Ratio</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Low Risk</span>
                        <span>Moderate</span>
                        <span>High Risk</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Risk Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                     <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
        <h3>üìò About This Calculator</h3>
                <p>
                    The Waist-to-Hip Ratio (WHR) estimates the ratio of the circumference of the waist to that of the hips.
                    It helps in understanding body fat distribution and associated health risks.
                    A higher WHR indicates more fat stored around the abdomen, which is linked to increased health risks.
                </p>
            </div>
            <div class="note-card">
    <h3>üìù Parameters Used</h3>
    <ul class="note-list">
        <li><strong>Gender:</strong> Male or Female</li>
        <li><strong>Waist Circumference:</strong> Measurement of the waist</li>
        <li><strong>Hip Circumference:</strong> Measurement of the hips</li>
    </ul>
</div>

        <div class="note-card">
    <h3>‚ö†Ô∏è Input Validation Rules</h3>
    <p>
        <strong>Input validation</strong> ensures that user-provided data meets required standards before calculations. Proper validation guarantees accurate results and compliance with health and safety regulations.
    </p>
    <ul class="note-list">
        <li><strong>Required Fields:</strong> Waist Circumference and Hip Circumference must be entered.</li>
        <li><strong>Data Type Check:</strong> Only positive numeric values are accepted.</li>
        <li><strong>Range Check:</strong>
            <ul>
                <li>Waist Circumference: 50 ‚Äì 200 cm (below 50 cm is physiologically unrealistic; above 200 cm is extreme obesity/outlier)</li>
                <li>Hip Circumference: 60 ‚Äì 200 cm (below 60 cm unlikely; above 200 cm is extreme outlier)</li>
            </ul>
        </li>
        <li><strong>Precision:</strong> Maximum 1 decimal place allowed (e.g., 87.5 cm)</li>
        <li><strong>Logical Consistency:</strong>
            <ul>
                <li>Hip circumference cannot be zero (prevents division by zero).</li>
                <li>Waist should not exceed hip by more than 50% (flags extreme obesity/outlier).</li>
                <li>Hip should not exceed waist by more than 100% (flags potential input error).</li>
            </ul>
        </li>
        <li><strong>Units:</strong> All measurements must be in centimeters (cm).</li>
        <li><strong>Cross-Field Dependency:</strong> Checks are performed to ensure waist and hip values are consistent with human body proportions.</li>
    </ul>
    <p>
        ‚úÖ These validations maintain accuracy, protect against unrealistic inputs, and ensure compliance with occupational health and safety standards such as ISO 45001, WHO guidelines, and NIH recommendations.
    </p>
</div>
<div class="note-card">
    <h3>üìä Output Validations</h3>
    <p>After calculating the Waist-to-Hip Ratio (WHR), the risk categories based on ranges are:</p>
    <ul class="note-list">
        <li><strong>Men:</strong>
            <ul>
                <li>WHR &lt; 0.90 ‚úÖ ‚Äî Low Risk: Your WHR indicates healthy fat distribution.</li>
                <li>WHR 0.90 ‚Äì 1.00 ‚ö†Ô∏è ‚Äî Moderate Risk: Increased risk of metabolic/cardiovascular issues.</li>
                <li>WHR &gt; 1.00 üö® ‚Äî High Risk: High probability of obesity-related health problems. Seek medical guidance.</li>
            </ul>
        </li>
        <li><strong>Women:</strong>
            <ul>
                <li>WHR &lt; 0.85 ‚úÖ ‚Äî Low Risk: Your WHR indicates healthy fat distribution.</li>
                <li>WHR 0.85 ‚Äì 0.95 ‚ö†Ô∏è ‚Äî Moderate Risk: Increased risk of metabolic/cardiovascular issues.</li>
                <li>WHR &gt; 0.95 üö® ‚Äî High Risk: High probability of obesity-related health problems. Seek medical guidance.</li>
            </ul>
        </li>
    </ul>
    <p>‚ö†Ô∏è Proper categorization ensures accurate health risk assessment and aligns with WHO/NIH health standards.</p>
</div>
<div class="note-card">
    <h3>üìè Governing Principle</h3>
    <p>
        This Waist-to-Hip Ratio (WHR) Calculator is based on globally recognized health and safety standards and follows regulatory guidance for body composition assessment:
    </p>
    <ul class="note-list">
        <li><strong>WHO Guidelines:</strong> Defines healthy WHR ranges for men and women to identify risk of metabolic and cardiovascular diseases.</li>
        <li><strong>NIH Recommendations:</strong> Uses WHR as a clinical indicator of abdominal obesity and associated health risks.</li>
        <li><strong>ISO 45001 / Occupational Health Standards:</strong> Ensures input validation and reporting are consistent with workplace health and safety assessments.</li>
        <li><strong>Input Rules Compliance:</strong> Mandatory waist and hip measurements, realistic physiological ranges, and cross-field consistency checks prevent erroneous data entry.</li>
        <li><strong>Output Assessment:</strong> WHR ranges are categorized into Low, Moderate, and High Risk for accurate health risk reporting.</li>
        <li><strong>Purpose:</strong> Provides a standardized, safe, and reliable method to assess body fat distribution, supporting health monitoring, occupational safety, and early intervention planning.</li>
    </ul>
    <p>‚úÖ Following these principles ensures accurate calculations, prevents unrealistic entries, and aligns the tool with international health and occupational safety standards.</p>
</div>

            <div class="note-card">
                <h3>Why is WHR Important?</h3>
                <p>
                    WHR is a critical indicator for assessing the risk of chronic conditions such as diabetes, cardiovascular
                    diseases,
                    and Alzheimer's disease. According to the WHO:
                </p>
                <ul class="note-list">
                    <li><strong>For Men:</strong> WHR below 0.90 is considered healthy.</li>
                    <li><strong>For Women:</strong> WHR below 0.85 is considered healthy.</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>How to Measure Correctly</h3>
                <ul class="note-list">
                    <li><strong>Waist:</strong> Measure at the midpoint between the last rib and the top of the iliac crest
                        using a stretch-resistant tape.</li>
                    <li><strong>Hip:</strong> Measure around the widest part of your buttocks, keeping the tape parallel to the
                        floor.</li>
                    <li>Ensure the tape is level, snug, but not compressing the skin.</li>
                </ul>
            </div>
        
           
        
          
            <div class="note-card">
                <h3>Limitations of WHR</h3>
                <p>Although WHR is a valuable tool, it has some limitations:</p>
                <ul class="note-list">
                    <li>Does not distinguish between muscle and fat mass.</li>
                    <li>May vary across different ethnic groups and populations.</li>
                    <li>Provides an estimate but does not measure actual body fat percentage.</li>
                </ul>
            </div>
            <div class="note-card">
    <h3>üìå Conclusion</h3>
    <p>
        The Waist-to-Hip Ratio (WHR) provides a quick assessment of body fat distribution and associated health risks.  
        A higher WHR indicates more abdominal fat, which is linked to increased risk of metabolic and cardiovascular diseases.  
        Proper measurement of waist and hip circumferences ensures reliable results.  
        WHR categorization helps identify low, moderate, and high-risk individuals for preventive health measures.
    </p>
</div>

        </div>

    </div>

    <script>
        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');
            const meterFill = document.getElementById('meterFill');

            // Reset UI
            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            let errors = [];

            // Helper for numeric validation
            function getVal(id, label, opts = {}) {
                const el = document.getElementById(id);
                const raw = el.value?.toString().trim();
                if (!raw) {
                    errors.push(`üëâ ${label} is required.`);
                    return null;
                }
                const num = parseFloat(raw);
                if (isNaN(num) || num <= 0) {
                    errors.push(`üëâ Enter a valid positive number for ${label}.`);
                    return null;
                }
                if (opts.min !== undefined && num < opts.min) {
                    errors.push(`üëâ ${label} must be ‚â• ${opts.min} cm.`);
                }
                if (opts.max !== undefined && num > opts.max) {
                    errors.push(`üëâ ${label} must be ‚â§ ${opts.max} cm.`);
                }
                return parseFloat(num.toFixed(1)); // 1 decimal place allowed
            }

            const gender = document.getElementById('gender').value;
            const waist = getVal('waist', 'Waist Circumference', { min: 50, max: 200 });
            const hip = getVal('hip', 'Hip Circumference', { min: 60, max: 200 });

            // Cross-field validations
            if (hip === 0) {
                errors.push("üëâ Hip circumference cannot be zero (division by zero).");
            }
            if (waist && hip) {
                if (waist > hip * 1.5) {
                    errors.push("üëâ Waist is disproportionately large compared to hip. Please recheck your input.");
                }
                if (hip > waist * 2) {
                    errors.push("üëâ Hip is disproportionately large compared to waist. Please recheck your input.");
                }
            }

            // Show errors if any
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }

            // Calculate WHR
            const whr = waist / hip;

            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = whr.toFixed(2);

            let pct = 0;
            let interpretation = "";

            if (gender === 'male') {
                pct = (whr - 0.7) / (1.1 - 0.7) * 100; // scale meter
                if (whr < 0.90) {
                    meterFill.style.backgroundColor = '#2ecc71'; // Green
                    interpretation = "‚úÖ <strong>Low Risk:</strong> Your WHR indicates healthy fat distribution.";
                } else if (whr < 1.0) {
                    meterFill.style.backgroundColor = '#f39c12'; // Yellow
                    interpretation = "‚ö†Ô∏è <strong>Moderate Risk:</strong> Increased risk of metabolic/cardiovascular issues.";
                } else {
                    meterFill.style.backgroundColor = '#e74c3c'; // Red
                    interpretation = "üö® <strong>High Risk:</strong> High probability of obesity-related health problems. Seek medical guidance.";
                }
            } else { // female
                pct = (whr - 0.65) / (1.0 - 0.65) * 100;
                if (whr < 0.85) {
                    meterFill.style.backgroundColor = '#2ecc71';
                    interpretation = "‚úÖ <strong>Low Risk:</strong> Your WHR indicates healthy fat distribution.";
                } else if (whr < 0.95) {
                    meterFill.style.backgroundColor = '#f39c12';
                    interpretation = "‚ö†Ô∏è <strong>Moderate Risk:</strong> Increased risk of metabolic/cardiovascular issues.";
                } else {
                    meterFill.style.backgroundColor = '#e74c3c';
                    interpretation = "üö® <strong>High Risk:</strong> High probability of obesity-related health problems. Seek medical guidance.";
                }
            }

            meterFill.style.width = Math.max(0, Math.min(100, pct)) + '%';
            document.getElementById('feedbackContent').innerHTML = interpretation;
        }

        function printReport() {
            window.print();
        }
    </script>

</body>
</html>
{% endblock %}

<!-- 
1. Input Validation Rules (QEHS/Fire Safety Perspective)

From regulatory and occupational health contexts (OSHA, ILO, ISO 45001):

Waist Circumference (cm)

Required (cannot be empty).

Acceptable range: 50 cm ‚Äì 200 cm

Below 50 cm ‚Üí not physiologically realistic.

Above 200 cm ‚Üí extreme obesity, usually outliers and require medical confirmation.

Decimals: up to 1 decimal place (e.g., 87.5 cm).

Unit of measure: must be in centimeters.

Hip Circumference (cm)

Required.

Acceptable range: 60 cm ‚Äì 200 cm

Below 60 cm ‚Üí unlikely and unsafe entry.

Above 200 cm ‚Üí extreme outlier.

Decimals: up to 1 decimal place.

Unit of measure: centimeters.

Logical Consistency

Waist should not be less than 50 cm.

Hip must be greater than waist in most healthy cases, but calculator should still accept cases where waist ‚â• hip (since high-risk individuals exist).

No division by zero (hip ‚â† 0).

Cross-Field Dependencies

If waist > hip by >50%, flag as extreme obesity/outlier.

If hip > waist by >100%, flag as possible input error (e.g., swapped values).

2. Output Validation Logic & Thresholds

Standards from WHO & NIH (used in safety/health risk audits):

Men:

Low Risk (Healthy): WHR < 0.90

Moderate Risk: WHR = 0.90 ‚Äì 1.00

High Risk: WHR > 1.00

Women:

Low Risk (Healthy): WHR < 0.85

Moderate Risk: WHR = 0.85 ‚Äì 0.95

High Risk: WHR > 0.95

‚ö†Ô∏è Why compliance matters: In workplace health audits, WHR is often used as a KPI for obesity-related fire/safety risks (reduced mobility, higher fatigue, higher medical risk in emergencies). Categorizing properly ensures correct reporting.
-->