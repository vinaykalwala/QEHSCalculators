{% extends 'base.html' %}
{% block title %}Age Shock Index (Age SI) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Age Shock Index (Age SI) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
        .table-container {
            width: 100%;
            overflow-x: auto; /* ✅ horizontal scroll on small screens */
        }

        .table-container table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            min-width: 600px; /* ✅ keeps structure readable */
        }

        .table-container th,
        .table-container td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .table-container th {
            background: #1976d2;
            color: #fff;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .table-container table {
                font-size: 12px;
            }
            .table-container th,
            .table-container td {
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" with report_title="Age Shock Index Report" %}

    <div class="calculator-header">
        <h1>Age Shock Index (Age SI) Calculator</h1>
        <p>Assess cardiovascular risk by combining age with standard shock index parameters (heart rate and systolic blood pressure).</p>
    </div>

    <div class="calc-content">
        <div class="calc-card">
            <h2>Enter Patient Data</h2>
            <div class="form-group">
                <label for="age">Age (years)</label>
                <input type="number" id="age" class="form-input" placeholder="e.g., 65" min="1">
            </div>
            <div class="form-group">
                <label for="heartRate">Heart Rate (beats/minute)</label>
                <input type="number" id="heartRate" class="form-input" placeholder="e.g., 95" min="1">
            </div>
            <div class="form-group">
                <label for="systolicBP">Systolic Blood Pressure (mmHg)</label>
                <input type="number" id="systolicBP" class="form-input" placeholder="e.g., 110" min="1">
            </div>
            <button class="calculate-btn" onclick="calculateAgeShockIndex()">Calculate Age SI</button>
        </div>

        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Cardiovascular health icon">
                <p>The patient's Age Shock Index and risk interpretation will appear here.</p>
            </div>
            <div class="result-error hidden" id="resultError">
                <div class="error-message" id="errorMessage"></div>
            </div>
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value" id="ageSiValue">0.00</div>
                <div class="rate-label">Age Shock Index</div>
                <div class="safety-meter">
                    <div class="meter-fill" id="meterFill"></div>
                </div>
                <div class="meter-labels">
                    <span>Normal</span><span>Elevated</span>
                </div>
                <div class="result-feedback">
                    <div class="feedback-title">Interpretation</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <div class="note-section">
        <div class="note-card"><h3>What is Age Shock Index?</h3><p>The <strong>Age Shock Index (Age SI)</strong> is an advanced clinical tool that incorporates a patient’s age with their heart rate and systolic blood pressure. It is used to more accurately predict the severity of a patient’s condition, especially in emergencies like acute myocardial infarction (AMI).</p></div>
        <div class="note-card"><h3>📌 Explanation of Parameters</h3><ul><li><strong>Age (years):</strong> Older individuals generally have a higher baseline risk for cardiovascular issues, adding crucial context to vital signs.</li><li><strong>Heart Rate (beats/min):</strong> A high heart rate can signal physiological stress or shock.</li><li><strong>Systolic Blood Pressure (mmHg):</strong> Low systolic pressure may indicate poor organ perfusion and potential circulatory failure.</li></ul></div>
        <div class="note-card"><h3>How Is It Calculated?</h3><p>The Age SI is calculated with the formula: <strong>(Age × Heart Rate) / Systolic Blood Pressure</strong>. By combining these three parameters, the Age SI provides a clearer and more immediate picture of how well the cardiovascular system is handling stress.</p></div>
        <div class="note-card"><h3>Why It Matters</h3><p>In fast-paced clinical environments, the Age Shock Index helps healthcare professionals make quick, informed decisions. It provides rapid risk stratification at the bedside, with predictive power similar to more complex scoring systems.</p></div>
        <div class="note-card">
            <h3>Validation Rules & Compliance</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Expected Range</th>
                            <th>Units</th>
                            <th>Validation Rules</th>
                            <th>Compliance Rationale</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Age</td>
                            <td>1 – 120 years</td>
                            <td>Years</td>
                            <td>Must be an integer ≥1 and ≤120</td>
                            <td>Human biological limits; prevents nonsense inputs (e.g., negative or 999 years).</td>
                        </tr>
                        <tr>
                            <td>Heart Rate (HR)</td>
                            <td>30 – 220 bpm</td>
                            <td>Beats/min</td>
                            <td>Accept only values in this physiologically possible range</td>
                            <td>OSHA/medical references consider &lt;30 or &gt;220 bpm invalid/extreme.</td>
                        </tr>
                        <tr>
                            <td>Systolic BP (SBP)</td>
                            <td>50 – 300 mmHg</td>
                            <td>mmHg</td>
                            <td>Must be within 50–300 mmHg</td>
                            <td>SBP &lt;50 = incompatible with life; &gt;300 is extreme outlier.</td>
                        </tr>
                        <tr>
                            <td>Decimals</td>
                            <td>Age = integer only, HR and SBP = integers only</td>
                            <td>-</td>
                            <td>Restrict input to whole numbers</td>
                            <td>Medical measurement units are integers in practice.</td>
                        </tr>
                        <tr>
                            <td>Cross-field dependencies</td>
                            <td>SBP must be &gt; HR (normally). Flag if HR ≫ SBP.</td>
                            <td>-</td>
                            <td>Warn if inputs suggest physiologically implausible state</td>
                            <td>e.g., HR 180, SBP 60</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const printDateEl = document.getElementById('printDate');
    if (printDateEl) {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        printDateEl.textContent = now.toLocaleDateString('en-US', options);
    }
});

function calculateAgeShockIndex() {
    const age = parseInt(document.getElementById('age').value, 10);
    const HR = parseInt(document.getElementById('heartRate').value, 10);
    const SBP = parseInt(document.getElementById('systolicBP').value, 10);

    const placeholder = document.getElementById('placeholder');
    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const resultBox = document.getElementById('resultValue');
    const ageSiValue = document.getElementById('ageSiValue');
    const feedbackContent = document.getElementById('feedbackContent');
    const meterFill = document.getElementById('meterFill');

    // Reset visibility
    placeholder.classList.add('hidden');
    errorBox.classList.add('hidden');
    resultBox.classList.add('hidden');

    let errorMsg = "";

    // Input validations
    if (isNaN(age) || isNaN(HR) || isNaN(SBP)) {
        errorMsg = "❌ Please enter all required values.";
    } else if (age < 1 || age > 120) {
        errorMsg = "❌ Age must be between 1 and 120 years.";
    } else if (HR < 30 || HR > 220) {
        errorMsg = "❌ Heart Rate must be between 30 and 220 bpm.";
    } else if (SBP < 50 || SBP > 300) {
        errorMsg = "❌ Systolic BP must be between 50 and 300 mmHg.";
    }

    if (errorMsg) {
        errorMessage.textContent = errorMsg;
        errorBox.classList.remove('hidden');
        return;
    }

    // Calculation
    const ageSI = (age * HR) / SBP;
    ageSiValue.textContent = ageSI.toFixed(2);

    let interpretation = "";
    let fillPercent = 0;

    // Interpretation thresholds
    if (ageSI > 50) {
        interpretation = "⚠️ Elevated: Increased risk of mortality — possible cardiovascular compromise.";
        fillPercent = 100;
    } else {
        interpretation = "✅ Normal: Suggests stable cardiovascular status.";
        fillPercent = (ageSI / 50) * 100;
    }

    // Outlier flagging
    if ((age > 100 && HR > 180) || (SBP < 60 && HR > 150)) {
        interpretation += "<br>⚠️ Warning: Values appear physiologically extreme — verify input.";
    }

    // Update feedback & meter
    feedbackContent.innerHTML = interpretation;
    meterFill.style.width = fillPercent + "%";

    // Show result
    resultBox.classList.remove('hidden');
}

function printReport() {
    const printDateEl = document.getElementById('printDate');
    if (printDateEl) {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        printDateEl.textContent = now.toLocaleDateString('en-US', options);
    }
    window.print();
}
</script>

</body>
</html>
{% endblock %}

<!-- 🔎 2. Output Validation Logic

Formula:

𝐴
𝑔
𝑒
 
𝑆
𝐼
=
𝐴
𝑔
𝑒
×
𝐻
𝑅
𝑆
𝐵
𝑃
Age SI=
SBP
Age×HR
	​


Thresholds (based on peer-reviewed studies & audits)

≤ 50 → ✅ Normal (lower mortality risk, stable hemodynamics).

> 50 → ⚠️ Elevated (associated with shock, acute myocardial infarction, trauma risk).

Compliance perspective:

Avoids false reassurance: Always provide a disclaimer that Age SI is a screening tool not a diagnostic conclusion.

Aligns with ISO 45001 and OSHA incident reporting principles — “accurate, validated, and reliable data entry prevents misreporting in health & safety audits.”

🔎 3. Edge Case Validations
Edge Case	Handling Rule
Division by zero (SBP = 0)	Prevented by SBP ≥ 50 rule.
Extreme elderly + extreme vitals (e.g., Age 120, HR 220, SBP 50)	Calculate, but display warning “Unrealistic physiological combination.”
Missing fields	Block calculation with user-friendly error message.
Negative / non-numeric inputs	Auto-reject with validation.
Outliers (e.g., HR=20, SBP=300)	Allow calculation but flag as “outlier — check input.” -->