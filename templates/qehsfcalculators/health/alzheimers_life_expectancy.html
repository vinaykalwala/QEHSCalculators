{% extends 'base.html' %}
{% block title %}Alzheimer's Life Expectancy Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alzheimer’s Life Expectancy Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
      

        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
         .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
      <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" with report_title="Alzheimer's Life Expectancy Report" %}

    <div class="calculator-header">
        <h1>Alzheimer’s Life Expectancy Calculator</h1>
        <p>Estimate life expectancy and stage duration based on the 7 stages of Alzheimer's disease.</p>
    </div>

    <div class="calc-content">
        <div class="calc-card">
            <h2>Select Alzheimer’s Stage</h2>
            <div class="form-group">
                <label for="alzStage">Select the current stage of the individual:</label>
                <select id="alzStage" class="form-input">
                    <option value="">-- Select Stage --</option>
                    <option value="1">Stage 1 – No cognitive decline</option>
                    <option value="2">Stage 2 – Very mild decline</option>
                    <option value="3">Stage 3 – Mild decline</option>
                    <option value="4">Stage 4 – Moderate decline</option>
                    <option value="5">Stage 5 – Moderately severe decline</option>
                    <option value="6">Stage 6 – Severe decline</option>
                    <option value="7">Stage 7 – Very severe decline</option>
                </select>
            </div>
            <button class="calculate-btn" onclick="calculateAlzheimersExpectancy()">Show Estimate</button>
        </div>

        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health timeline icon">
                <p>Estimates for life expectancy and stage duration will be displayed here.</p>
            </div>
            <div class="result-error hidden" id="resultError"><div class="error-message" id="errorMessage"></div></div>
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value" id="lifeExpectancyValue"></div>
                <div class="safety-meter">
                    <div class="meter-fill" id="meterFill"></div>
                </div>
                <div class="meter-labels">
                    <span>Stage 1</span><span>Stage 4</span><span>Stage 7</span>
                </div>
                <div class="result-feedback">
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <div class="note-section">
        <div class="note-card"><h3>Note:</h3><p><strong>Alzheimer’s Disease</strong> is a progressive neurodegenerative disorder that primarily affects memory, thinking skills, and the ability to carry out everyday tasks. It advances gradually through distinct stages, each with its own set of symptoms and implications for life expectancy.</p></div>
        <div class="note-card"><h3>About the Calculator:</h3><p>This Alzheimer's Life Expectancy Calculator provides estimated timelines for life expectancy and the typical duration of each stage of Alzheimer's disease. These estimates are based on statistical averages and clinical research, helping caregivers and families better prepare and plan for the journey ahead.</p></div>
        <div class="note-card">
            <h3>Input Validation</h3>
            <ul class="note-list">
                <li><strong>Stage Selection Required:</strong> You must select a stage between <strong>1 and 7</strong> to get results. Leaving it blank will trigger an error.</li>
                <li><strong>Valid Range Only:</strong> Stages outside <strong>1–7</strong> are not accepted, as they don’t exist in the Alzheimer’s staging system.</li>
                <li><strong>No Text or Symbols:</strong> Only valid stage numbers (1–7) can be selected from the dropdown. Other characters are not allowed.</li>
                <li><strong>One Stage at a Time:</strong> Only a single stage can be selected for accurate life expectancy estimation.</li>
                <li><strong>Error Handling:</strong> If an invalid or missing stage is detected, the calculator will show a clear error message: 
                    <span class="bad">❌ “Please select a valid Alzheimer’s stage (1–7).”</span>
                </li>
            </ul>
            <p>This ensures results remain reliable and compliant with clinical staging standards for Alzheimer’s disease.</p>
        </div>
        <div class="note-card"><h3>Explanation of Stages:</h3><ul><li><strong>Stage 1 – No cognitive decline:</strong> Normal function. No noticeable symptoms of dementia.</li><li><strong>Stage 2 – Very mild cognitive decline:</strong> Minor memory issues, often considered normal aging.</li><li><strong>Stage 3 – Mild cognitive decline:</strong> Increased forgetfulness and difficulty concentrating; may interfere with daily tasks.</li><li><strong>Stage 4 – Moderate cognitive decline:</strong> Clear-cut symptoms; trouble with simple arithmetic and short-term memory.</li><li><strong>Stage 5 – Moderately severe cognitive decline:</strong> Individuals may need help with daily activities like dressing and grooming.</li><li><strong>Stage 6 – Severe cognitive decline:</strong> Memory continues to worsen; difficulty recognizing family members; assistance required for basic tasks.</li><li><strong>Stage 7 – Very severe cognitive decline:</strong> Loss of ability to respond to environment; individuals require round-the-clock care.</li></ul></div>
        <div class="note-card"><h3>Why It Matters:</h3><p>Understanding the stage of Alzheimer's can help healthcare providers, caregivers, and families estimate life expectancy and prepare emotionally, financially, and logistically for the journey ahead.</p></div>
        <div class="note-card"><h3>Understanding the Results:</h3><p>When you select a stage in the calculator, you’ll receive two key pieces of information:</p><ul><li><strong>Estimated Life Expectancy:</strong> The average number of years a person may live after reaching the selected stage. This figure varies depending on individual health and quality of care.</li><li><strong>Average Duration of Stage:</strong> How long a person typically remains in that specific stage before progressing to the next.</li></ul></div>
        <div class="note-card"><h3>Conclusion:</h3><p>While each person's experience with Alzheimer's is unique, this calculator offers general guidance based on the current stage. It is not a substitute for professional medical advice, but rather a helpful tool for setting expectations and encouraging early intervention and support planning.</p></div>
    </div>
</div>

<script>
   function calculateAlzheimersExpectancy() {
    const stage = document.getElementById("alzStage").value;

    const placeholder = document.getElementById("placeholder");
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const resultBox = document.getElementById("resultValue");
    const lifeExpectancyValue = document.getElementById("lifeExpectancyValue");
    const feedbackContent = document.getElementById("feedbackContent");
    const meterFill = document.getElementById("meterFill");

    // Reset visibility
    placeholder.classList.add("hidden");
    errorBox.classList.add("hidden");
    resultBox.classList.add("hidden");

    let errorMsg = "";
    let expectancyText = "";
    let feedbackText = "";
    let fillPercent = 0;

    // 🔹 Input validation
    if (!stage || isNaN(stage) || stage < 1 || stage > 7) {
        errorMsg = "❌ Please select a valid Alzheimer’s stage (1–7).";
    }

    if (errorMsg) {
        errorMessage.textContent = errorMsg;
        errorBox.classList.remove("hidden");
        return;
    }

    // 🔹 Stage-based outputs (validated ranges)
    switch (stage) {
        case "1":
            expectancyText = "Normal for age";
            feedbackText = "🧠 Stage 1 – No cognitive decline. ✅ No impairment, normal life expectancy.";
            fillPercent = 0;
            break;
        case "2":
            expectancyText = "> 10 years";
            feedbackText = "🧠 Stage 2 – Very mild decline. Life expectancy generally exceeds 10 years, stage can last up to 15 years.";
            fillPercent = 15;
            break;
        case "3":
            expectancyText = "~10 years";
            feedbackText = "🧠 Stage 3 – Mild decline. Expectancy around 10 years, stage duration 2–7 years.";
            fillPercent = 30;
            break;
        case "4":
            expectancyText = "3–8 years";
            feedbackText = "🧠 Stage 4 – Moderate decline. Average stage duration ~2 years.";
            fillPercent = 50;
            break;
        case "5":
            expectancyText = "1.5–6.5 years";
            feedbackText = "🧠 Stage 5 – Moderately severe decline. Duration typically ~1.5 years.";
            fillPercent = 70;
            break;
        case "6":
            expectancyText = "≤ 4 years";
            feedbackText = "🧠 Stage 6 – Severe decline. Duration ~2.5 years.";
            fillPercent = 85;
            break;
        case "7":
            expectancyText = "≤ 2.5 years";
            feedbackText = "🧠 Stage 7 – Very severe decline. Duration 1.5–2.5 years.";
            fillPercent = 100;
            break;
    }

    // 🔹 Display outputs
    lifeExpectancyValue.innerHTML = `<strong>Life Expectancy:</strong> ${expectancyText}`;
    feedbackContent.innerHTML = feedbackText;
    meterFill.style.width = fillPercent + "%";

    // Risk color coding
    if (stage <= 3) {
        meterFill.style.backgroundColor = "#2ecc71"; // green = early
    } else if (stage <= 5) {
        meterFill.style.backgroundColor = "#f1c40f"; // yellow = mid
    } else {
        meterFill.style.backgroundColor = "#e74c3c"; // red = late
    }

    resultBox.classList.remove("hidden");
}



    function printReport() { /* ... */ const printDateEl = document.getElementById('printDate'); if (printDateEl) { const now = new Date(); const options = { year: 'numeric', month: 'long', day: 'numeric' }; printDateEl.textContent = now.toLocaleDateString('en-US', options); } window.print(); }
</script>

</body>
</html>
{% endblock %}


<!-- 4. Edge Case Validations

Invalid input → Show error only (Stage must be 1–7).

Empty selection → Block calculation.

Manipulated DOM values (e.g., stage = 9) → Fails validation.

Extreme expectancy overlaps → Always use ranges, not absolute values.

Cross-field consistency (if age field added) → If age < 40 but stage ≥ 3 → show warning: "⚠️ Alzheimer’s onset is rare before 40. Verify input."

5. Why Each Validation Matters (Compliance)

OSHA / ISO 45001 → Requires data integrity in health & safety monitoring. Invalid inputs could bias reporting.

NFPA / ILO → Stress accuracy when life-critical information is presented.

Clinical compliance (WHO, NIH, Alzheimer’s Association) → Ensures results mirror real epidemiological ranges, avoiding liability from misleading information.

Audit-readiness → Proper error handling prevents “silent failures” in official records.

6. Recommended Test Cases
Test Case	Input	Expected Output
Empty stage	""	Error: “Please select a valid Alzheimer’s stage”
Invalid stage	"9"	Error
Stage 1	"1"	Life expectancy = Normal for age, green meter
Stage 3	"3"	Life expectancy ~10 years, yellow-green meter
Stage 5	"5"	Life expectancy 1.5–6.5 years, yellow meter
Stage 7	"7"	Life expectancy ≤2.5 years, red meter
DOM tampering	"abc"	Error
Edge warning (if age field added)	Age=35, Stage=6	Show warning about early onset -->