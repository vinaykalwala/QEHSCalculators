{% extends 'base.html' %}
{% block title %}Baby Milk Intake Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baby Milk Intake Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            flex-direction: column;
            gap: 4px;
            align-items: center;
            justify-content: center;
        }
        .result-value {
            width: 100%;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 0;
        }
        .rate-label {
            color: #7f8c8d;
            font-size: 16px;
            font-weight: 500;
        }
        #perFeedingResult {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-top: 10px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Baby Milk Intake Calculator</h1>
            <p>Estimate your baby's daily milk needs based on age and weight.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Baby's Details</h2>
                <div class="form-group">
                    <label for="babyAge">Baby's Age Group</label>
                    <select id="babyAge" class="form-select">
                        <option value="0">Newborn (0 months)</option>
                        <option value="0.5" selected>Less than 1 month</option>
                        <option value="1">1 – 3 months</option>
                        <option value="3">3 – 6 months</option>
                        <option value="6">6 – 9 months</option>
                        <option value="9">9 – 12 months</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="babyWeight">Baby's Weight (kg)</label>
                    <input type="number" id="babyWeight" class="form-input" placeholder="e.g., 4.5">
                </div>
                <div class="form-group">
                    <label for="feedingsPerDay">Number of Feedings per Day</label>
                    <input type="number" id="feedingsPerDay" class="form-input" placeholder="e.g., 8">
                </div>
                <button class="calculate-btn" onclick="calculateMilkIntake()">Calculate</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Enter your baby's details to estimate their daily milk requirement.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Estimated Milk Intake</h2>
                    <div class="rate-display">
                        <div>
                            <div class="rate-value" id="rateValue">0</div>
                            <div class="rate-label">ml / day (Total)</div>
                        </div>
                    </div>
                    <p id="perFeedingResult">0 ml per feeding</p>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Guideline</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Feeding Guide</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>📊 Age-Based Milk Requirement Guide</h3>
                <p>This table shows the general daily milk requirement in milliliters (ml) per kilogram (kg) of body weight, based on the baby's age. Younger infants have higher metabolic rates and need more milk relative to their size.</p>
            </div>
            <table class="custom-table">
                    <thead>
                        <tr><th>Age (Months)</th><th>Milk Requirement (ml/kg/day)</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Newborn (0 months)</td><td>60</td></tr>
                        <tr><td>Less than 1 month</td><td>180</td></tr>
                        <tr><td>1 – 3 months</td><td>150</td></tr>
                        <tr><td>3 – 6 months</td><td>120</td></tr>
                        <tr><td>6 – 9 months</td><td>100</td></tr>
                        <tr><td>9 – 12 months</td><td>90</td></tr>
                    </tbody>
                </table>
            <div class="note-card">
                <h3>Input Validation Guidelines</h3>
                <p class="note-tip">⚠️ Entering values outside these rules will show an error message and stop the calculation.</p>
                </div>
                <table class="custom-table">
                    <thead>
                    <tr>
                        <th>Field</th>
                        <th>Expected Range</th>
                        <th>Units</th>
                        <th>Validation Rules</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td><strong>Arm Systolic Pressure</strong></td>
                        <td>60 – 250</td>
                        <td>mmHg</td>
                        <td>Must be a positive number, no text or symbols. Decimals allowed (e.g., 120.5).</td>
                    </tr>
                    <tr>
                        <td><strong>Ankle Systolic Pressure (Left & Right)</strong></td>
                        <td>50 – 250</td>
                        <td>mmHg</td>
                        <td>Must be a positive number. No empty fields. Decimals allowed up to 1 place.</td>
                    </tr>
                    <tr>
                        <td><strong>General</strong></td>
                        <td>—</td>
                        <td>—</td>
                        <td>
                        • All fields are mandatory.<br>
                        • No negative values or zero for Arm Pressure.<br>
                        • ABI ratio (Ankle ÷ Arm) usually falls between 0.3 – 1.4.  
                        Out-of-range results may indicate error or arterial stiffness.
                        </td>
                    </tr>
                    </tbody>
                </table>

             <div class="note-card">
                <h3>❗ Important Disclaimer</h3>
                <p>This calculator provides a general estimate. Every baby is different, and their needs can vary based on growth spurts, activity level, and overall health. These results should not replace professional medical advice. Always consult your pediatrician for personalized guidance regarding your baby's nutrition.</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if(document.getElementById('printDate')) {
               document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });

        function getAgeEquivalence(age) {
    if (age == 0) return 60;       // Newborn
    else if (age < 1) return 180;  // <1 month
    else if (age == 1) return 150; // 1–3 months
    else if (age == 3) return 120; // 3–6 months
    else if (age == 6) return 100; // 6–9 months
    else if (age == 9) return 90;  // 9–12 months
    else return 0;                 // Invalid
}

function calculateMilkIntake() {
    const age = parseFloat(document.getElementById('babyAge').value);
    const weight = parseFloat(document.getElementById('babyWeight').value);
    const feedings = parseFloat(document.getElementById('feedingsPerDay').value);

    const errorDiv = document.getElementById('resultError');
    const errorMsg = document.getElementById('errorMessage');
    const resultDiv = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');

    // Reset UI
    errorDiv.classList.add('hidden');
    resultDiv.classList.add('hidden');
    placeholder.classList.remove('hidden');

    function showError(msg) {
        errorMsg.textContent = msg;
        errorDiv.classList.remove('hidden');
        placeholder.classList.add('hidden');
    }

    // Validation
    if (isNaN(age) || isNaN(weight) || isNaN(feedings)) {
        showError("⚠️ All fields are required and must be numbers.");
        return;
    }
    if (weight <= 0 || feedings <= 0) {
        showError("⚠️ Weight and feedings must be greater than zero.");
        return;
    }
    if (weight < 1.5 || weight > 15) {
        showError("⚠️ Baby weight must be between 1.5 and 15 kg.");
        return;
    }
    if (!Number.isInteger(feedings) || feedings < 4 || feedings > 15) {
        showError("⚠️ Feedings per day must be an integer between 4 and 15.");
        return;
    }

    const ageEquivalence = getAgeEquivalence(age);
    if (ageEquivalence === 0) {
        showError("⚠️ Age should be between 0 and 12 months.");
        return;
    }

    // Calculation
    const requiredMilk = ageEquivalence * weight;
    const milkPerFeeding = requiredMilk / feedings;

    // Output plausibility checks
    if (requiredMilk < 400 || requiredMilk > 1500) {
        showError("⚠️ Calculated daily milk intake is outside recommended safe range. Consult pediatrician.");
        return;
    }
    if (milkPerFeeding < 30 || milkPerFeeding > 250) {
        showError("⚠️ Calculated milk per feeding is outside safe limits. Consult pediatrician.");
        return;
    }

    // Update UI
    document.getElementById('rateValue').textContent = requiredMilk.toFixed(0);
    document.getElementById('perFeedingResult').textContent = `${milkPerFeeding.toFixed(0)} ml per feeding`;

    // Feedback
    let feedback = "";
    if (milkPerFeeding >= 60 && milkPerFeeding <= 180) {
        feedback = "✅ Within normal feeding range for infants.";
    } else if (milkPerFeeding < 60) {
        feedback = "⚠️ Below typical feeding volume. Monitor closely.";
    } else {
        feedback = "⚠️ Above typical feeding volume. Risk of overfeeding.";
    }
    document.getElementById('feedbackContent').textContent = feedback;

    placeholder.classList.add('hidden');
    resultDiv.classList.remove('hidden');
}


        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if(document.getElementById('printDate')) {
               document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }
    </script>
</body>
</html>
{% endblock %}

<!-- 
1. Analysis of Inputs, Outputs & Formula

Inputs:

Baby’s Age (months, grouped) → categorical input via dropdown.

Baby’s Weight (kg) → numerical, continuous.

Number of Feedings per Day → integer count of feeding sessions.

Outputs:

Total Daily Milk Requirement (ml/day) = Age Factor × Weight (kg)

Milk Per Feeding (ml/feed) = Total ÷ Feedings per day

Safety meter + feedback → interpret results against pediatric nutrition guidelines.

Formula (age equivalence multipliers):

Newborn (0m) → 60 ml/kg/day

<1m → 180 ml/kg/day

1–3m → 150 ml/kg/day

3–6m → 120 ml/kg/day

6–9m → 100 ml/kg/day

9–12m → 90 ml/kg/day

This formula matches AAP & WHO infant nutrition guidelines ranges.

2. Comprehensive Input Validation Rules
✅ Baby Age (months, dropdown)

Must be between 0 and 12 months.

Predefined values only (0, 0.5, 1, 3, 6, 9).

If any invalid selection → error.

✅ Baby Weight (kg)

Acceptable range: 1.5 – 15 kg

<1.5 kg → extreme preterm / NICU case (not suitable for calculator).

15 kg → outside typical 0–12m growth standards.

Decimals allowed: up to 1 decimal place (e.g., 4.5).

Must be positive & non-zero.

✅ Feedings per Day

Acceptable range: 4 – 15 feeds/day

<4 → underfeeding risk.

15 → overfeeding risk / unrealistic.

Must be an integer.

Must be positive & non-zero.

✅ Cross-Field Validations

Required Milk (ml/day) should not exceed 1,500 ml/day (AAP threshold for 0–12 months).

Per Feeding (ml/feed) must be between 30 ml – 250 ml per feed.

If outputs fall outside, flag as “⚠️ Consult pediatrician.”

3. Edge Case Validations

Empty inputs → show clear error.

Non-numeric weight/feedings → reject.

Negative numbers → reject.

Division by zero if feedings = 0 → reject.

Unrealistic age group (other than listed) → reject.

Extreme outliers (e.g., weight 50 kg, feeds 1/day) → warn and block result.

4. Output Validation & Threshold Explanations

<30 ml/feed → Underfeeding risk.

>250 ml/feed → Overfeeding risk.

<400 ml/day total → Nutritional deficiency risk.

>1500 ml/day total → Overfeeding / possible water intoxication risk.

Feedback messages should align with WHO Infant Feeding Guidelines.
 -->