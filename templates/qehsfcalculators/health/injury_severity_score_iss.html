{% extends 'base.html' %}
{% block title %}Injury Severity Score (ISS) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Injury Severity Score (ISS) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-placeholder {
            text-align: center;
            margin: auto;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0 10px;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out, background-color 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Injury Severity Score (ISS) Calculator</h1>
            <p>Assess trauma severity based on injuries across six body regions.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Select Injury Severity</h2>
                <div class="form-group">
                    <label for="head">Head and Neck</label>
                    <select id="head" class="form-select">
                        <option value="" disabled selected>Select severity...</option>
                        <option value="0">0 - No injury</option><option value="1">1 - Minor</option><option value="2">2 - Moderate</option>
                        <option value="3">3 - Serious</option><option value="4">4 - Severe</option><option value="5">5 - Critical</option>
                        <option value="6">6 - Unsurvivable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="face">Face</label>
                    <select id="face" class="form-select">
                        <option value="" disabled selected>Select severity...</option>
                        <option value="0">0 - No injury</option><option value="1">1 - Minor</option><option value="2">2 - Moderate</option>
                        <option value="3">3 - Serious</option><option value="4">4 - Severe</option><option value="5">5 - Critical</option>
                        <option value="6">6 - Unsurvivable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="chest">Chest</label>
                    <select id="chest" class="form-select">
                         <option value="" disabled selected>Select severity...</option>
                        <option value="0">0 - No injury</option><option value="1">1 - Minor</option><option value="2">2 - Moderate</option>
                        <option value="3">3 - Serious</option><option value="4">4 - Severe</option><option value="5">5 - Critical</option>
                        <option value="6">6 - Unsurvivable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="abdomen">Abdomen</label>
                    <select id="abdomen" class="form-select">
                         <option value="" disabled selected>Select severity...</option>
                        <option value="0">0 - No injury</option><option value="1">1 - Minor</option><option value="2">2 - Moderate</option>
                        <option value="3">3 - Serious</option><option value="4">4 - Severe</option><option value="5">5 - Critical</option>
                        <option value="6">6 - Unsurvivable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="extremity">Extremity</label>
                    <select id="extremity" class="form-select">
                         <option value="" disabled selected>Select severity...</option>
                        <option value="0">0 - No injury</option><option value="1">1 - Minor</option><option value="2">2 - Moderate</option>
                        <option value="3">3 - Serious</option><option value="4">4 - Severe</option><option value="5">5 - Critical</option>
                        <option value="6">6 - Unsurvivable</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="external">External</label>
                    <select id="external" class="form-select">
                         <option value="" disabled selected>Select severity...</option>
                        <option value="0">0 - No injury</option><option value="1">1 - Minor</option><option value="2">2 - Moderate</option>
                        <option value="3">3 - Serious</option><option value="4">4 - Severe</option><option value="5">5 - Critical</option>
                        <option value="6">6 - Unsurvivable</option>
                    </select>
                </div>
                <button class="calculate-btn" onclick="calculateAndDisplay()">Calculate ISS</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Select the severity of the worst injury in each of the six body regions to calculate the score.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div id="resultValue" class="hidden" style="text-align: center;">
                    <h2>Injury Severity Score (ISS)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Minor</span>
                        <span>Moderate</span>
                        <span>Severe</span>
                        <span>Profound</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Interpretation</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
        
            <div class="note-card">
                <h3>📖 About the Injury Severity Score (ISS)</h3>
                <p>
                    The <strong>Injury Severity Score (ISS)</strong> is a medical score used to assess trauma severity in
                    patients who have sustained
                    injuries in multiple body regions. It helps determine how critical a patient's condition is and is widely
                    used in trauma research,
                    emergency care, and clinical decision-making.
                </p>
            </div>
                <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <p>
            This calculator evaluates injuries across six body regions: Head & Neck, Face, Chest, Abdomen, Extremities, and External injuries.  
            Each region is rated using the <strong>Abbreviated Injury Scale (AIS)</strong> from 0 (No injury) to 6 (Unsurvivable injury).  
            The ISS is calculated using the three most severe scores by squaring each and summing them.
        </p>
    </div>

        
            <div class="note-card">
                <h3>🧮 Using the Calculator</h3>
                <p>Select the <strong>worst injury</strong> level for each of the six body regions:</p>
                <ul>
                    <li>Head and Neck (including cervical spine)</li>
                    <li>Face (facial skeleton, mouth, eyes, ears, nose)</li>
                    <li>Chest (including thoracic spine and diaphragm)</li>
                    <li>Abdomen (abdominal organs, lumbar spine, pelvic contents)</li>
                    <li>Extremities (including pelvic girdle)</li>
                    <li>External (skin and surface injuries)</li>
                </ul>
                <p>
                    Each region is rated from <strong>0 (no injury)</strong> to <strong>6 (unsurvivable injury)</strong>.
                    The ISS is calculated by squaring the three highest scores and summing them.
                </p>
                <p><strong>Important:</strong> If any region scores a 6, the ISS is automatically set to 75 (maximum possible
                    score).</p>
            </div>
        
        
            <div class="note-card">
                <h3>🏥 Clinical Significance</h3>
                <p>The ISS is the only anatomical scoring system that correlates linearly with patient outcomes such as:</p>
                <ul>
                    <li>Mortality</li>
                    <li>Morbidity</li>
                    <li>Length of hospital stay</li>
                    <li>Need for specialized trauma care</li>
                </ul>
            </div>
        
            <div class="note-card">
                <h3>ℹ️ Input Validations</h3>
                <div class="note-list">
                    <p>
                        To ensure the Injury Severity Score (ISS) is calculated correctly and avoids misleading results, please
                        follow these rules:
                    </p>
                    <ul>
                        <li><strong>Required Fields:</strong> You must select a severity for <em>all six body regions</em>
                            (Head/Neck, Face, Chest, Abdomen, Extremity, External).</li>
                        <li><strong>Allowed Values:</strong> Each region score must be an integer between <code>0</code> (No injury)
                            and <code>6</code> (Unsurvivable).</li>
                        <li><strong>No Skipping:</strong> Leaving a body region blank will prevent calculation.</li>
                        <li><strong>Special Rule:</strong> If <code>6</code> (Unsurvivable) is chosen for any region, the ISS is
                            automatically set to <strong>75</strong> (maximum score).</li>
                        <li><strong>Consistency:</strong> Values are based on the <em>Abbreviated Injury Scale (AIS)</em>. Avoid
                            unrealistic combinations (e.g., all 6 body regions as “6”).</li>
                        <li><strong>Output Range:</strong> Valid ISS results range from <strong>1</strong> to <strong>75</strong>.
                        </li>
                    </ul>
                    <p>
                        ✅ Following these rules ensures your ISS score is meaningful and compliant with real-world trauma assessment
                        practices.
                    </p>
                </div>
            </div>

 <div class="note-card">
    <h3>🧮 Output Validations</h3>
    <p>
        The calculator displays your <strong>Injury Severity Score (ISS)</strong> based on the Abbreviated Injury Scale (AIS) scores for the six body regions.  
        It provides a visual <strong>meter indicator</strong> showing whether the injury is Minor, Moderate, Severe, or Very Severe/Profound.  
    </p>
    <p><strong>Feedback Displayed:</strong></p>
    <ul>
        <li><strong>0–8:</strong> Minor Injury</li>
        <li><strong>9–15:</strong> Moderate Injury</li>
        <li><strong>16–24:</strong> Severe Injury</li>
        <li><strong>≥25:</strong> Very Severe / Profound Trauma</li>
        <li>The ISS helps predict mortality, hospitalization time, and treatment urgency. An ISS above 15 is generally considered major trauma requiring immediate attention.</li>
    </ul>
    <p>
        This ensures users understand how their result relates to the overall trauma severity and real-world clinical relevance.
    </p>
</div>




            <div class="note-card">
    <h3>📏 Governing Principle</h3>
    <p>
        The Injury Severity Score (ISS) Calculator is based on the Abbreviated Injury Scale (AIS) standard, which was developed by the Association for the Advancement of Automotive Medicine (AAAM) International Injury Scaling Committee (IISC) in 1969. The ISS itself, which uses AIS codes to provide a single summary score for multiple injuries, was developed by researchers in 1974.  
    </p>
    <p><strong>How it works:</strong></p>
    <ul>
        <li><strong>Abbreviated Injury Scale (AIS):</strong> This is the fundamental standard that categorizes the severity of individual injuries in a patient's body.</li>
        <li><strong>Body Regions:</strong> The body is divided into six regions: head and neck, face, thorax, abdomen, extremities (including the pelvis), and external injuries.</li>
        <li><strong>ISS Calculation:</strong> For a patient with multiple injuries, the ISS is calculated by taking the highest AIS score from each of the three most severely injured body regions, squaring those scores, and summing the results (A² + B² + C² = ISS).</li>
    </ul>
    <p>
        Therefore, while you may find various "ISS Calculators" online or in medical software, they all operate under the standard established by the AIS and the guidelines for calculating the ISS.
    </p>
</div>


    <div class="note-card">
        <h3>⚠️ Conclusion / Disclaimer</h3>
        <p>
            This calculator is intended for <strong>educational and preliminary screening purposes</strong> only.  
            Final assessment, diagnosis, and treatment should always be conducted by trained healthcare professionals.  
            An ISS above 15 generally indicates <strong>major trauma</strong> requiring immediate attention.
        </p>
    </div>
        
        </div>

    </div>

    <script>
        function calculateAndDisplay() {
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValueBox = document.getElementById('resultValue');

            // Reset UI
            errorBox.classList.add('hidden');
            resultValueBox.classList.add('hidden');
            placeholder.classList.remove('hidden');

            const regions = ['head', 'face', 'chest', 'abdomen', 'extremity', 'external'];
            let scores = [];
            let errors = [];

            // --- Validation ---
            regions.forEach(id => {
                const el = document.getElementById(id);
                const raw = el.value;

                if (raw === "" || raw === null) {
                    const label = document.querySelector(`label[for=${id}]`).textContent;
                    errors.push(`👉 ${label} is required.`);
                } else {
                    const val = parseInt(raw);
                    if (isNaN(val) || val < 0 || val > 6) {
                        errors.push(`👉 ${id} must be an integer between 0 and 6.`);
                    } else {
                        scores.push(val);
                    }
                }
            });

            // Handle validation errors
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add('hidden');
                return;
            }

            let iss = 0;
            let interpretation = "";

            // --- Special Case: Unsurvivable Injury ---
            if (scores.includes(6)) {
                iss = 75;
                interpretation = "🚨 Presence of an unsurvivable injury (AIS 6). ISS is automatically set to the maximum value of 75.";
            } else {
                // Calculate ISS from top 3 scores
                const top3 = scores.sort((a, b) => b - a).slice(0, 3);
                iss = top3[0] ** 2 + top3[1] ** 2 + top3[2] ** 2;

                // Interpret thresholds (compliance-aligned)
                if (iss <= 8) {
                    interpretation = "<strong>Minor Injury:</strong> Stable, low risk, usually outpatient treatment.";
                } else if (iss <= 15) {
                    interpretation = "<strong>Moderate Injury:</strong> More than minor but not usually life-threatening. Hospital care may be required.";
                } else if (iss <= 24) {
                    interpretation = "<strong>Severe Injury:</strong> Serious injuries requiring immediate medical attention.";
                } else {
                    interpretation = "<strong>Profound Trauma:</strong> Critical, life-threatening injuries. Emergency & intensive care required.";
                }
            }

            // --- Display Results ---
            placeholder.classList.add('hidden');
            resultValueBox.classList.remove('hidden');

            document.getElementById('rateValue').textContent = iss;

            // --- Update Meter ---
            const meterFill = document.getElementById('meterFill');
            const maxScore = 75;
            let pct = (iss / maxScore) * 100;
            meterFill.style.width = pct + '%';

            if (iss <= 8) meterFill.style.backgroundColor = '#2ecc71'; // Green
            else if (iss <= 15) meterFill.style.backgroundColor = '#f1c40f'; // Yellow
            else if (iss <= 24) meterFill.style.backgroundColor = '#e67e22'; // Orange
            else meterFill.style.backgroundColor = '#e74c3c'; // Red

            document.getElementById('feedbackContent').innerHTML = interpretation;
        }

        function printReport() {
            window.print();
        }
    </script>

</body>
</html>
{% endblock %}

<!-- 
1. Real-World QEHS / Fire Safety Input Validation Rules

Each body region input is an Abbreviated Injury Scale (AIS) score ranging from 0–6.
From a compliance and audit perspective, inputs must be:

Field	Expected Range	Units	Validation Rules	Compliance Rationale
Head/Neck	0 – 6	AIS scale	Must be integer only. No decimals or text.	AIS is categorical, not continuous. Prevents misreporting.
Face	0 – 6	AIS scale	Same rules as above.	Ensures consistency across trauma datasets (WHO, OSHA).
Chest	0 – 6	AIS scale	Integer only, mandatory field.	Missing or invalid data compromises safety reporting.
Abdomen	0 – 6	AIS scale	Integer only.	Accurate ISS relies on all six body regions being assessed.
Extremity	0 – 6	AIS scale	Integer only.	Extremity trauma is critical in workplace/fire accidents (ILO reporting standards).
External/Other	0 – 6	AIS scale	Integer only.	Burns/lacerations fall here; ensures fire safety compliance (NFPA injury reporting).

General Validation Rules:

All fields required (no blank entries).

Only integer values allowed (0–6).

No decimals, negative values, or strings.

If any field = 6 → ISS automatically = 75 (unsurvivable).

Logical consistency: ISS max = 75.

2. Output Validation & Thresholds

The ISS formula = sum of the squares of the top 3 AIS scores.
From global trauma standards:

ISS < 9 → Minor injury (usually outpatient, not OSHA recordable unless multiple injuries).

ISS 9–15 → Moderate (hospitalization may be required, OSHA recordable).

ISS 16–24 → Severe (high probability of long-term effects, triggers mandatory audits).

ISS ≥ 25 → Very severe / Profound (often fatal or life-altering, requires regulatory reporting).

ISS = 75 → Automatic (unsurvivable), immediate critical escalation.
-->