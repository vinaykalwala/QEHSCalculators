{% extends 'base.html' %}
{% block title %}Healthy Weight Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthy Weight Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: baseline;
            justify-content: center;
        }
        .result-value {
            width: 100%;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        .rate-label {
            color: #7f8c8d;
            font-size: 16px;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: center;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Healthy Weight Calculator</h1>
            <p>Find your healthy weight range based on your height and a healthy BMI.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Your Height</h2>
                <div class="form-group">
                    <label for="height">Height (cm)</label>
                    <input type="number" id="height" class="form-input" min="1" placeholder="e.g., 175">
                </div>
                <button class="calculate-btn" onclick="calculateHealthyWeight()">Calculate Range</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Enter your height to find your recommended healthy weight range.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Your Healthy Weight Range</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0 - 0 kg</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Based on a Healthy BMI (18.5 - 25)</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Understanding Your Range</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>‚öñÔ∏è What is a Healthy Weight?</h3>
                <p>A "healthy weight" isn't a single number, but a range. It's determined using the Body Mass Index (BMI), a measure that compares your weight to your height. For most adults, a BMI between <strong>18.5 and 24.9</strong> is considered healthy. Staying within this range helps lower your risk for chronic health problems.</p>
            </div>
            <div class="note-card">
                <h3>‚ö†Ô∏è Health Effects of Weight</h3>
                <ul class="note-list">
                    <li><strong>Underweight (BMI < 18.5):</strong> Can lead to a weakened immune system, osteoporosis, and malnutrition.</li>
                    <li><strong>Overweight (BMI 25-29.9):</strong> Increases the risk of type 2 diabetes, high blood pressure, and heart disease.</li>
                    <li><strong>Obese (BMI > 30):</strong> Significantly raises the risk for heart disease, stroke, certain cancers, and other serious health conditions.</li>
                </ul>
            </div>
             <div class="note-card">
                <h3>ü•ó Maintaining a Healthy Weight</h3>
                 <p>To stay within your healthy weight range, focus on sustainable lifestyle habits:</p>
                <ul class="note-list">
                    <li>Eat a balanced diet with plenty of fruits, vegetables, lean proteins, and whole grains.</li>
                    <li>Engage in regular physical activity‚Äîaim for at least 150 minutes of moderate exercise per week.</li>
                    <li>Limit processed foods, sugary drinks, and unhealthy fats.</li>
                </ul>
            </div>

            <div class="note-card">
                    <h3>‚ÑπÔ∏è Input Validations</h3>
                    <div class="note-list">
                        <p>
                        To make sure results are accurate and meaningful, please follow these rules when entering your height:
                        </p>
                        <ul>
                        <li><strong>Required Field:</strong> Height cannot be left blank.</li>
                        <li><strong>Numeric Input Only:</strong> Enter numbers (e.g., <code>170</code>), not letters or symbols.</li>
                        <li><strong>Valid Range:</strong> Height must be between <strong>50 cm</strong> and <strong>272 cm</strong> (realistic human limits).</li>
                        <li><strong>Error Messages:</strong> If an invalid value is entered, a clear warning will be shown instead of results.</li>
                        <li><strong>Correct Example:</strong> Enter <code>165</code> for 165 cm.</li>
                        </ul>
                        <p>
                        ‚úÖ These checks ensure that your healthy weight range is calculated correctly and avoids misleading results.
                        </p>
                    </div>
            </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                if (document.getElementById('printDate')) {
                    document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
                }
            });

            function calculateHealthyWeight() {
                const heightInput = document.getElementById('height').value.trim();

                const errorBox = document.getElementById('resultError');
                const errorMessage = document.getElementById('errorMessage');
                const placeholder = document.getElementById('placeholder');
                const resultValue = document.getElementById('resultValue');
                const rateValue = document.getElementById('rateValue');
                const meterFill = document.getElementById('meterFill');
                const feedbackContent = document.getElementById('feedbackContent');

                // Reset displays
                errorBox.classList.add("hidden");
                resultValue.classList.add("hidden");
                placeholder.classList.add("hidden");

                // Validate blank input
                if (heightInput === "") {
                    errorMessage.textContent = "‚ö†Ô∏è Height is required.";
                    errorBox.classList.remove("hidden");
                    return;
                }

                let height = parseFloat(heightInput);

                // Validate number
                if (isNaN(height)) {
                    errorMessage.textContent = "‚ö†Ô∏è Please enter a numeric height.";
                    errorBox.classList.remove("hidden");
                    return;
                }

                // Range validation (realistic human range: 50‚Äì272 cm)
                if (height < 50 || height > 272) {
                    errorMessage.textContent = "‚ö†Ô∏è Height must be between 50 cm and 272 cm.";
                    errorBox.classList.remove("hidden");
                    return;
                }

                // Convert cm ‚Üí meters
                const heightM = height / 100;

                // Calculate Healthy Weight Range (BMI 18.5‚Äì24.9)
                const minWeight = 18.5 * (heightM * heightM);
                const maxWeight = 24.9 * (heightM * heightM);

                // Edge case: unrealistic results
                if (minWeight < 20 || maxWeight > 250) {
                    errorMessage.textContent = "‚ö†Ô∏è Result outside realistic weight range.";
                    errorBox.classList.remove("hidden");
                    return;
                }

                // Display results
                placeholder.classList.add("hidden");
                resultValue.classList.remove("hidden");

                rateValue.textContent = `${minWeight.toFixed(1)} - ${maxWeight.toFixed(1)} kg`;

                // Meter fill (static color for healthy range)
                meterFill.style.width = "100%";
                meterFill.style.backgroundColor = "#2980b9";

                // Feedback
                feedbackContent.innerHTML = `
                    This range is based on the <strong>WHO BMI standard (18.5‚Äì24.9)</strong>.<br>
                    Maintaining weight in this range reduces occupational health risks such as fatigue,
                    reduced heat tolerance, and mobility issues during emergency evacuation.
                `;
            }

            function printReport() {
                const now = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                if (document.getElementById('printDate')) {
                    document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
                }
                window.print();
            }
        </script>

</body>
</html>
{% endblock %}

<!-- 
‚úÖ 1. Input Validation Rules (Real-World QEHS & Fire Safety Perspective)
Field	Expected Range	Units	Validation Rules	Compliance Rationale
Height	50 ‚Äì 272 cm	Centimeters (cm)	‚Ä¢ Must be integer or decimal
‚Ä¢ No negatives
‚Ä¢ Max 2 decimal places
‚Ä¢ Logical human limits (shortest living adult ~54 cm, tallest ~272 cm)	Prevents nonsense input (e.g., 0 cm, negative, or 500 cm). Keeps calculations realistic for occupational health monitoring.
‚úÖ 2. Output Validation & Thresholds

The calculator uses BMI formula (18.5‚Äì25 = normal range).
Outputs must:

Always be positive weight values (kg).

Be rounded sensibly (1 decimal place) for usability in safety audits.

Flag unrealistic outputs (e.g., <20 kg or >250 kg) as ‚Äú‚ö†Ô∏è Out of expected range.‚Äù

BMI Range	Interpretation	Compliance Link
< 18.5	Underweight ‚Äì increased occupational risk (fatigue, low strength).	ISO 45001: worker fitness assessment.
18.5 ‚Äì 24.9	Healthy weight ‚Äì optimal range.	WHO standard, aligns with ILO wellness programs.
‚â• 25	Overweight ‚Äì higher risk of heat stress, reduced mobility in fire/emergency.	NFPA fire evacuation studies, OSHA workplace wellness.
‚úÖ 3. Edge Case Validations

Blank Input ‚Üí Show error ‚ÄúHeight is required.‚Äù

Zero / Negative Input ‚Üí Invalid (physiologically impossible).

Extreme Outliers

Height < 50 cm or > 272 cm ‚Üí Show error ‚ÄúHeight outside realistic range for adults.‚Äù

Decimal Precision

Limit to 2 decimal places for calculation stability.

Division by Zero

Prevented by validating height > 0 before BMI calculation.
-->