{% extends 'base.html' %}
{% block title %}Daily Drinking Water Intake Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Drinking Water Intake Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .result-value {
            width: 100%;
        }
        .result-value h2 {
            color: #1560bd;
        }
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
            line-height: 1.6;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Daily Drinking Water Intake Calculator</h1>
            <p>Get a guideline for daily water intake based on your life stage and age.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Select Your Profile</h2>
                <div class="form-group">
                    <label for="lifeStage">Life Stage</label>
                    <select id="lifeStage" class="form-select">
                        <option value="infant">Infant</option>
                        <option value="child">Child</option>
                        <option value="adult" selected>Adult</option>
                        <option value="elderly">Elderly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="ageRange">Age Range</label>
                    <select id="ageRange" class="form-select"></select>
                </div>
                <button class="calculate-btn" onclick="calculateWaterIntake()">Get Recommendation</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Select your life stage and age to see the recommended daily water intake.</p>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Recommended Daily Intake</h2>
                    <div class="result-feedback">
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                     <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    This Hydration Calculator provides guidance on daily fluid intake based on general health recommendations. 
                    It helps users understand proper hydration levels and offers feedback on whether they are adequately hydrated or at risk of dehydration.
                </p>
            </div>
             <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Life Stage:</strong> Select the developmental stage of the individual (Infant, Child, Adult, Elderly).</li>
                    <li><strong>Age Range:</strong> Select the age bracket corresponding to the chosen life stage.</li>
                </ul>
            </div>


            <div class="note-card">
                <h3>💧 Hydration Guidelines</h3>
                 <ul class="note-list">
                    <li><strong>Pre-hydrate:</strong> It's essential to hydrate before you begin to feel thirsty or engage in any physical activity.</li>
                    <li><strong>Thirst is a late signal:</strong> Feeling thirsty means your body is already behind on its fluid needs.</li>
                    <li><strong>Check your urine:</strong> Proper hydration means urinating every 2–4 hours. Your urine should be colorless or a very light yellow.</li>
                    <li><strong>Watch for advanced signs:</strong> Headaches and dizziness are late signs of dehydration. If you experience these, increase your water intake immediately.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>✅ Input Validation Rules</h3>
                <ul class="note-list">
                    <li><strong>Life Stage:</strong> Must select one option; cannot be empty.</li>
                    <li><strong>Age Range:</strong> Must select a valid range corresponding to the chosen life stage.</li>
                    <li>No negative, zero, or non-numeric values for age.</li>
                    <li>Dropdowns should dynamically update based on life stage selection.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>🧮 Output Validations (Assessment / Feedback)</h3>
                <ul class="note-list">
                    <li><strong>Valid Selection:</strong> "Profile selected successfully: [Life Stage], Age [Age Range]. Ready for calculation."</li>
                    <li><strong>Invalid Selection:</strong> "Invalid age for the selected life stage. Please select a valid age range."</li>
                    <li><strong>Missing Selection:</strong> "Please complete all fields to proceed."</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>⚖️ Governing Principle</h3>
                <p>
                    According to the National Academies of Sciences, Engineering, and Medicine, average daily fluid requirements are about 2.7 litres (11 cups) for women and 3.7 litres (16 cups) for men. 
                    Proper hydration prevents dehydration, supports kidney function, and maintains optimal physiological performance. 
                    Monitoring urine color and frequency offers an additional assessment of hydration status.
                </p>
            </div>

            <!-- 🧩 Conclusion -->
            <div class="note-card">
                <h3>🧩 Conclusion</h3>
                <p>
                    Maintaining proper hydration is essential for health. This calculator provides personalized feedback on fluid intake, 
                    helping users identify if they are adequately hydrated or at risk of dehydration. 
                    Following the recommendations ensures optimal fluid balance and prevents dehydration-related complications.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Age options for each life stage
        const ageOptions = {
            infant: [
                { value: 'infant-0-6', text: '0-6 months' },
                { value: 'infant-6-12', text: '6-12 months' }
            ],
            child: [
                { value: 'child-1-3', text: '1-3 years' },
                { value: 'child-4-8', text: '4-8 years' },
                { value: 'child-9-13-boys', text: '9-13 years (Boys)' },
                { value: 'child-9-13-girls', text: '9-13 years (Girls)' },
                { value: 'child-14-18-boys', text: '14-18 years (Boys)' },
                { value: 'child-14-18-girls', text: '14-18 years (Girls)' }
            ],
            adult: [
                { value: 'adult-women-19-50', text: 'Women (19-50 years)' },
                { value: 'adult-men-19-50', text: 'Men (19-50 years)' },
                { value: 'adult-women-51+', text: 'Women (51+ years)' },
                { value: 'adult-men-51+', text: 'Men (51+ years)' },
                { value: 'adult-pregnant', text: 'Pregnant Women' },
                { value: 'adult-lactating', text: 'Lactating Women' }
            ],
            elderly: [
                { value: 'elderly-women', text: 'Elderly Women (65+ years)' },
                { value: 'elderly-men', text: 'Elderly Men (65+ years)' }
            ]
        };

        // Recommended daily water intake for each group
        const intakeData = {
            'infant-0-6': "<strong>700 ml/day.</strong> Typically from breast milk or formula.",
            'infant-6-12': "<strong>800 ml/day.</strong> Includes water from breast milk, formula, and complementary foods.",
            'child-1-3': "<strong>1,300 ml/day.</strong>",
            'child-4-8': "<strong>1,700 ml/day.</strong>",
            'child-9-13-boys': "<strong>2,400 ml/day.</strong>",
            'child-9-13-girls': "<strong>2,100 ml/day.</strong>",
            'child-14-18-boys': "<strong>3,300 ml/day.</strong>",
            'child-14-18-girls': "<strong>2,300 ml/day.</strong>",
            'adult-women-19-50': "<strong>2,700 ml/day (about 11 cups).</strong>",
            'adult-men-19-50': "<strong>3,700 ml/day (about 15 cups).</strong>",
            'adult-women-51+': "<strong>2,700 ml/day (about 11 cups).</strong>",
            'adult-men-51+': "<strong>3,700 ml/day (about 15 cups).</strong>",
            'adult-pregnant': "<strong>3,000 ml/day (about 12 cups).</strong>",
            'adult-lactating': "<strong>3,800 ml/day (about 16 cups).</strong>",
            'elderly-women': "<strong>2,700 ml/day (about 11 cups).</strong>",
            'elderly-men': "<strong>3,700 ml/day (about 15 cups).</strong>"
        };

        // Update age range options when life stage changes
        function updateAgeRanges() {
            const lifeStage = document.getElementById('lifeStage').value;
            const ageRangeSelect = document.getElementById('ageRange');
            ageRangeSelect.innerHTML = '';

            if (!lifeStage || !ageOptions[lifeStage]) return;

            ageOptions[lifeStage].forEach(opt => {
                const newOption = document.createElement('option');
                newOption.value = opt.value;
                newOption.textContent = opt.text;
                ageRangeSelect.appendChild(newOption);
            });

            // Set first option as default
            if (ageRangeSelect.options.length > 0) ageRangeSelect.selectedIndex = 0;
        }

        // Validate user input and calculate water intake
        function calculateWaterIntake() {
            const lifeStage = document.getElementById('lifeStage').value;
            const ageRange = document.getElementById('ageRange').value;
            const feedbackContent = document.getElementById('feedbackContent');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');
            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');

            // Reset
            feedbackContent.innerHTML = '';
            resultValue.classList.add('hidden');
            placeholder.classList.remove('hidden');
            if (errorBox) errorBox.classList.add('hidden');

            let errors = [];

            // Input validation
            if (!lifeStage) errors.push("⚠️ Please select your Life Stage.");
            if (!ageRange) errors.push("⚠️ Please select your Age Range.");
            if (lifeStage && ageRange && !ageOptions[lifeStage].some(opt => opt.value === ageRange)) {
                errors.push("⚠️ The selected age range does not match the chosen life stage.");
            }

            if (errors.length > 0) {
                if (errorBox && errorMessage) {
                    errorMessage.innerHTML = errors.join("<br>");
                    errorBox.classList.remove('hidden');
                } else {
                    alert(errors.join("\n"));
                }
                return;
            }

            // Show recommendation
            const recommendation = intakeData[ageRange] || "No recommendation found for the selected group.";
            feedbackContent.innerHTML = `The general recommendation for total water intake (from drinks and food) is approximately:<br><br><strong style="font-size: 1.2rem; color: #1560bd;">${recommendation}</strong>`;

            placeholder.classList.add('hidden');
            resultValue.classList.remove('hidden');
        }

        // Print report
        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if(document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
            window.print();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('lifeStage').addEventListener('change', updateAgeRanges);
            updateAgeRanges();

            // Set current date
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            if(document.getElementById('printDate')) {
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            }
        });
    </script>

</body>
</html>
{% endblock %}

<!-- 
1️⃣ Input Validation Rules (QEHS Perspective)
Input	Valid Range	Allowed Decimals	Units	Logical Checks / Notes
Life Stage	infant, child, adult, elderly	N/A	N/A	Must select one. Prevent empty selection.
Age Range	Depends on Life Stage: see below	N/A	N/A	Must match selected Life Stage. Prevent mismatched age-stage combinations.
Optional numeric inputs	N/A (not in current calculator)	N/A	N/A	If in future user input weight/height, must be positive and realistic.

Age Range by Life Stage:

Infant: 0-6 months, 6-12 months

Child: 1-2 yrs, 2-3 yrs, 4-8 yrs, 9-13 boys, 9-13 girls, 14-18 boys, 14-18 girls

Adult: Women 19-30, Women 31-50, Women 51+, Men 19-30, Men 31-50, Men 51+, Pregnant Women

Elderly: 60-70, 70+

Validation Logic:

Both Life Stage and Age Range must be selected.

Age range must correspond to the selected life stage.

Prevent empty selections or invalid combinations.

2️⃣ Output Validation Logic

Recommended water intake is based on scientific reference values (EFSA, National Academy of Medicine).

Output must be:

Numeric (ml/day)

Within a realistic range (infant: 700–900 ml, adult: 2200–3200 ml)

Display both EFSA and NAM guidelines for compliance with international standards.

Threshold Checks:

Minimum plausible intake: 500 ml/day

Maximum plausible intake: 3500 ml/day

Any value outside this range triggers a warning, as it may indicate mis-selection or data error.

3️⃣ Edge Case Validations
Scenario	Handling
Empty Life Stage or Age Range	Show error: "Please select both life stage and age range."
Mismatched age-stage combination	Prevent selection by dynamically updating options (already implemented).
Extreme values in future numeric inputs (weight/height)	Limit to safe physiological ranges.
Unexpected type (e.g., string input in numeric field)	Validate using isNaN or input type restrictions.
-->