{% extends 'base.html' %}
{% block title %}Body Adiposity Index (BAI) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Adiposity Index (BAI) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }
        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        @media (max-width: 900px) {
            .calc-content {
                flex-direction: column;
            }
        }
        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        .calc-card:hover {
            transform: translateY(-5px);
        }
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Inputs */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }
        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }
        .print-btn:hover {
            background: #1560bd;
        }
        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: center;
        }
        .result-value {
            width: 100%;
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        .rate-label {
            color: #7f8c8d;
        }
        /* Meter */
        .safety-meter {
            width: 100%;
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .feedback-content {
            color: #34495e;
        }
        /* Notes Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }
        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        .note-card:hover {
            transform: translateY(-2px);
        }
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        /* Error Message */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }
        /* Table styles */
        .custom-table {
    border-collapse: collapse;
    width: 100%;
    margin: 20px 0;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.custom-table thead {
    background-color: #1560bd;
    color: white;
}

.custom-table th,
.custom-table td {
    padding: 12px 16px;
    border: 1px solid #ddd;
    text-align: center;
    white-space: nowrap; /* prevent text breaking */
}

.custom-table tr:nth-child(even) {
    background-color: #f9f9f9;
}

/* ✅ Responsive Handling */
.table-wrapper {
    width: 100%;
    overflow-x: auto;   /* Enables horizontal scroll */
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on mobile */
}

@media (max-width: 768px) {
    .custom-table th,
    .custom-table td {
        padding: 10px;   /* Reduce padding on small screens */
        font-size: 14px; /* Smaller font for better fit */
    }
}

@media (max-width: 480px) {
    .custom-table th,
    .custom-table td {
        padding: 8px;
        font-size: 12px;
    }
}

        /* Toggle helper */
        .hidden {
            display: none;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Body Adiposity Index (BAI) Calculator</h1>
            <p>Estimate your body fat percentage using your hip circumference and height.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Data</h2>
                 <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" class="form-select">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="height">Your Height (cm)</label>
                    <input type="number" id="height" class="form-input" min="0" placeholder="e.g., 175">
                </div>
                <div class="form-group">
                    <label for="hip">Your Hip Circumference (cm)</label>
                    <input type="number" id="hip" class="form-input" min="0" placeholder="e.g., 95">
                </div>
                <button class="calculate-btn" onclick="calculateBAI()">Calculate BAI</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Health illustration">
                    <p>Enter your data to see your <strong>Body Adiposity Index</strong> and health assessment here.</p>
                </div>
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                <div class="result-value hidden" id="resultValue">
                    <h2>Body Adiposity Index (BAI)</h2>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">% Body Fat</div>
                    </div>
                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Underweight</span><span>Normal</span><span>Overweight</span><span>Obese</span>
                    </div>
                    <div class="result-feedback">
                        <div class="feedback-title">Performance Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>📘 What is Body Adiposity Index (BAI)?</h3>
                <p>The Body Adiposity Index (BAI) is a measurement used to estimate the percentage of body fat in a person's body. Unlike the Body Mass Index (BMI), which relies on body weight and height, BAI is calculated using hip circumference and height. This makes it a useful tool for assessing body composition without requiring a scale.</p>
                <p>BAI is often considered a better measure of body fat for people with varying muscle mass because it focuses on physical dimensions rather than weight. This can make it particularly useful for individuals who have higher muscle density, such as athletes, or those whose weight might not accurately reflect their fat levels.</p>
            </div>

            <div class="note-card">
                <h3>❓ Why Use BAI Over BMI?</h3>
                <ul class="note-list">
                    <li><strong>No Need for Body Weight:</strong> Only height and hip circumference are required, making it easy without a scale.</li>
                    <li><strong>Better Body Fat Estimation:</strong> More accurate across different populations.</li>
                    <li><strong>Gender-Specific Analysis:</strong> Accounts for differences between men and women.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>📏 Measurement Units</h3>
                <ul class="note-list">
                    <li><strong>Height:</strong> Measured in meters (m).</li>
                    <li><strong>Hip Circumference:</strong> Measured in centimeters (cm). Stand upright with feet together. Wrap a tape around the widest part of the hips/buttocks, parallel to the floor. Snug but not tight.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>📊 Interpreting Your BAI</h3>
                <p>Below is a guide to interpreting your results based on gender:</p>
            </div>
            <div class="table-wrapper">
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Gender</th>
                        <th>Underweight</th>
                        <th>Normal</th>
                        <th>Overweight</th>
                        <th>Obese</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Men</td>
                        <td>&lt; 8%</td>
                        <td>8% - 20%</td>
                        <td>21% - 25%</td>
                        <td>&gt; 26%</td>
                    </tr>
                    <tr>
                        <td>Women</td>
                        <td>&lt; 21%</td>
                        <td>21% - 33%</td>
                        <td>34% - 38%</td>
                        <td>&gt; 39%</td>
                    </tr>
                </tbody>
            </table>
        </div>


            <div class="note-card">
                <h3>💡 Why Is Knowing Your BAI Important?</h3>
                <ul class="note-list">
                    <li><strong>Heart Disease:</strong> Excess fat raises risks.</li>
                    <li><strong>Diabetes:</strong> Linked to insulin resistance and type 2 diabetes.</li>
                    <li><strong>Joint Issues:</strong> Extra weight strains joints.</li>
                    <li><strong>Metabolic Syndrome:</strong> Higher risk of stroke and heart disease.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>⚡ What Can You Do If Your BAI Is High?</h3>
                <ul class="note-list">
                    <li><strong>Consult a Healthcare Professional:</strong> Get personalized guidance.</li>
                    <li><strong>Adopt a Balanced Diet:</strong> Focus on nutrient-rich foods, avoid excess sugar/processed food.</li>
                    <li><strong>Engage in Physical Activity:</strong> Aim for regular workouts (walking, swimming, strength training).</li>
                    <li><strong>Monitor Your Progress:</strong> Track BAI and other health markers regularly.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>⚠️ Limitations of BAI</h3>
                <ul class="note-list">
                    <li><strong>Accuracy Variability:</strong> May be less accurate for unusual body shapes/extreme heights.</li>
                    <li><strong>Age Factors:</strong> Does not account for age-related fat distribution changes.</li>
                    <li><strong>Ethnic Variations:</strong> May not fully capture differences across ethnic groups.</li>
                </ul>
            </div>
            
            <div class="note-card">
                <div class="note-container">
                    <h3>✅ Input Validations</h3>
                    <ul>
                        <li><strong>Height:</strong> Must be between <em>50 cm and 250 cm</em>. Values outside this range are considered unrealistic and may give inaccurate BAI results.</li>
                        <li><strong>Hip Circumference:</strong> Must be between <em>50 cm and 200 cm</em>. Values too low or too high may indicate incorrect measurement.</li>
                        <li><strong>Hip-to-Height Ratio:</strong> Should be between <em>0.3 and 1.5</em>. This ensures logical consistency; extreme ratios are flagged as potential errors.</li>
                        <li><strong>Gender:</strong> Selection is required. Male and female BAI thresholds differ for health assessment.</li>
                        <li><strong>Allowed Values:</strong> Only positive numbers; decimals are allowed for precision.</li>
                        <li><strong>Edge Cases:</strong> Negative numbers, zero values, or extreme outliers are invalid and will prompt an error.</li>
                        <li><strong>Importance:</strong> Proper inputs ensure your BAI result is accurate and meaningful, supporting safe health and occupational assessments in line with QEHS standards.</li>
                    </ul>
                    <p>💡 Tip: Measure your hip circumference at the widest point of your hips/buttocks for the most accurate BAI calculation.</p>
                </div>
            </div>

            <div class="note-card">
                <h3>❗ Disclaimer</h3>
                <p>This calculator provides an estimate of body fat percentage based on the BAI formula. It is not a substitute for professional medical advice, diagnosis, or treatment. Always consult a healthcare provider for a comprehensive health assessment.</p>
            </div>
                </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const printDateEl = document.getElementById('printDate');
        if(printDateEl) {
            printDateEl.textContent = now.toLocaleDateString('en-US', options);
        }
    });

    function calculateBAI() {
        const heightInput = document.getElementById('height').value.trim();
        const hipInput = document.getElementById('hip').value.trim();
        const gender = document.getElementById('gender').value;

        const errorBox = document.getElementById('resultError');
        const errorMessage = document.getElementById('errorMessage');
        const placeholder = document.getElementById('placeholder');
        const resultValue = document.getElementById('resultValue');
        const rateValue = document.getElementById('rateValue');
        const feedbackContent = document.getElementById('feedbackContent');
        const meterFill = document.getElementById('meterFill');

        let errors = [];

        const height = parseFloat(heightInput);
        const hip = parseFloat(hipInput);

        // ---------------- INPUT VALIDATION ----------------
        if (isNaN(height) || height < 50 || height > 250) {
            errors.push("👉 Height must be between 50 cm and 250 cm.");
        }
        if (isNaN(hip) || hip < 50 || hip > 200) {
            errors.push("👉 Hip circumference must be between 50 cm and 200 cm.");
        }
        if (!gender) {
            errors.push("👉 Please select your gender.");
        }
        if (hip < 0.3 * height || hip > 1.5 * height) {
            errors.push("👉 Hip circumference seems inconsistent with height.");
        }

        if (errors.length > 0) {
            errorMessage.innerHTML = errors.join("<br>");
            errorBox.classList.remove("hidden");       // Show error
            placeholder.classList.add("hidden");       // HIDE placeholder
            resultValueDiv.classList.add("hidden");    // Hide result
            return;
        } else {
            errorBox.classList.add("hidden");
        }

        // ---------------- BAI CALCULATION ----------------
        const heightMeters = height / 100;
        const bai = (hip / Math.pow(heightMeters, 1.5)) - 18;
        const baiRounded = Math.max(0, parseFloat(bai.toFixed(2))); // Prevent negative BAI

        // ---------------- CATEGORY & FEEDBACK ----------------
        let meterWidth, meterColor, feedback;

        if (gender === 'male') {
            if (baiRounded < 8) {
                meterWidth = '25%'; meterColor = '#3498db';
                feedback = 'underweight. Ensure adequate nutrition for health and performance.';
            } else if (baiRounded <= 20) {
                meterWidth = '50%'; meterColor = '#2ecc71';
                feedback = 'in the healthy range. Excellent! Maintain your current lifestyle.';
            } else if (baiRounded <= 25) {
                meterWidth = '75%'; meterColor = '#f39c12';
                feedback = 'overweight. Consider more physical activity and balanced diet.';
            } else {
                meterWidth = '95%'; meterColor = '#e74c3c';
                feedback = 'obese. Consult a healthcare professional for guidance.';
            }
        } else { // Female
            if (baiRounded < 21) {
                meterWidth = '25%'; meterColor = '#3498db';
                feedback = 'underweight. Essential body fat is crucial; consult a professional.';
            } else if (baiRounded <= 33) {
                meterWidth = '50%'; meterColor = '#2ecc71';
                feedback = 'in the healthy range. Great job maintaining long-term health.';
            } else if (baiRounded <= 38) {
                meterWidth = '75%'; meterColor = '#f39c12';
                feedback = 'overweight. Small lifestyle changes can improve your body fat levels.';
            } else {
                meterWidth = '95%'; meterColor = '#e74c3c';
                feedback = 'obese. Seeking advice from a healthcare provider is strongly recommended.';
            }
        }

        // ---------------- DISPLAY RESULTS ----------------
        rateValue.textContent = baiRounded + "%";
        feedbackContent.innerHTML = `Your BAI indicates you are <strong>${feedback}</strong>`;
        meterFill.style.width = meterWidth;
        meterFill.style.backgroundColor = meterColor;

        placeholder.classList.add('hidden');
        resultValue.classList.remove('hidden');
    }

    function printReport() {
        const printDateEl = document.getElementById('printDate');
        if(printDateEl) {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            printDateEl.textContent = now.toLocaleDateString('en-US', options);
        }
        window.print();
    }
</script>

</body>
</html>
{% endblock %}

<!-- 
1. Analysis of Inputs, Outputs, and Formula

Formula:

𝐵
𝐴
𝐼
=
Hip Circumference (cm)
Height (m)
1.5
−
18
BAI=
Height (m)
1.5
Hip Circumference (cm)
	​

−18

Inputs:

Height in cm

Hip Circumference in cm

Gender (optional for standard BAI; gender may slightly adjust interpretation)

Outputs:

BAI value (% body fat)

Category: Underweight, Normal, Overweight, Obese

Feedback (guidance for maintaining or improving health)

QEHS Perspective:

These values can be part of health monitoring KPIs in occupational safety programs.

BAI is less intrusive than BMI for body fat estimation and can be used for employee wellness assessments.

Accuracy and validation of inputs are essential to avoid misleading health metrics.

2. Input Validation Rules (User-Friendly)
Field	Allowed Range	Units	Notes / Cross-Field Logic
Height	50 – 250	cm	Must be a positive number; extremely low or high values are physiologically unrealistic.
Hip Circumference	50 – 200	cm	Must be positive; should be consistent with height (e.g., hip > 0.3 × height).
Gender	Male / Female	N/A	Optional for standard BAI; helps interpret percentile tables if used.

Logical consistency:

Hip circumference should be proportionally reasonable relative to height.

Extreme ratios (e.g., hip >> height) should trigger warnings.

Edge Cases:

Division by zero (height = 0) → must be blocked.

Negative numbers → invalid.

Extremely unrealistic values (e.g., hip = 500 cm) → flagged.

3. Output Validation & Thresholds
BAI (%)	Category	Feedback / Action
<21	Underweight	Low body fat; may indicate underweight. Ensure adequate nutrition.
21–32	Normal	Healthy body fat. Maintain lifestyle.
33–38	Overweight	Slightly high body fat. Recommend regular exercise and balanced diet.
≥39	Obese	High body fat; consult healthcare professional.

Compliance Perspective:

These thresholds align with standard health assessments for adults (approximate ranges from literature).

Correct interpretation ensures meaningful safety KPIs for wellness programs.
-->