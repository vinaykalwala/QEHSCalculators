{% extends 'base.html' %}
{% block title %}Probit Percentage Effect Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Probit Percentage Effect Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0px  20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: transform 0.3s ease;
            height: 420px; /* Fixed Height */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            justify-content: center;
            align-items: center;
            min-height: 420px; /* Fixed Height */
            text-align: center;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background:linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }
        
        /* Result Card */
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }
        
        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        /* Note Section */
        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        /* Error Box */
        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'healthcategory_calculators'%}" class="back-btn">Back To Health Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">

        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Probit Percentage Effect Calculator</h1>
            <p>Convert a probit value from a dose-response model into an intuitive percentage effect for risk assessment.</p>
        </div>

        <div class="calc-content">
            <div class="calc-card">
                <h2>Enter Probit Value</h2>
                <div class="form-group">
                    <label for="probitValue">Probit Value (Y)</label>
                    <input type="number" id="probitValue" class="form-input" placeholder="e.g., 5.0">
                </div>
                <button class="calculate-btn" onclick="calculateProbitEffect()">Calculate Percentage</button>
            </div>

            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/resultimage.png' %}" alt="Toxicology and risk assessment icon">
                    <p>Enter a probit value to translate it into the corresponding percentage of the population affected.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                    
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value" id="rateValue">0.00%</div>
                    <div class="rate-label" id="rateLabel">Percentage Effect</div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Minimal (<1%)</span>
                        <span>Low (1-50%)</span>
                        <span>Significant (50-99%)</span>
                        <span>Near-Total (>99%)</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                   Probit analysis is a statistical method used in toxicology, biology, and risk assessment to model dose-response relationships. It transforms a sigmoid (S-shaped) dose-response curve into a straight line, making it easier to analyze. The **Probit Value (Y)** represents a point on this line. This calculator converts that abstract probit value back into a tangible **Percentage Effect**, indicating what proportion of a population is expected to be affected (e.g., show a toxic response) at that dose.
                </p>
            </div>
            <div class="note-card">
        <h3> ❓Parameters Used</h3>
        <ul class="note-list">
                <ul>
                    <li><strong>Probit Value (Y):</strong> Positive number representing dose-response effect. Typical range: 2 – 8</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>📊Input Validations</h3>
                <ul>
                    <li>Required field: Cannot be empty</li>
                    <li>Must be a number</li>
                    <li>Must be positive (>0)</li>
                </ul>
            </div>
            <div class="note-card">
                <h3>📊Output Validations</h3>
                <ul>
                    <li><strong>Probit &lt; 2.67:</strong> Effect &lt; 1%, ✅ <strong>Minimal Effect.</strong> The calculated effect is less than 1%, often considered a negligible or no-effect level in risk assessments.</li>
                    <li><strong>2.67 ≤ Probit &lt; 5:</strong> Effect 1–50%, 🟡 <strong>Low to Moderate Effect.</strong> The effect is between 1% and 50%, indicating a portion of the population will be affected.</li>
                    <li><strong>5 ≤ Probit &lt; 7.33:</strong> Effect 50–99%, ⚠️ <strong>Significant Effect.</strong> The effect is between 50% and 99%, indicating a majority of the population will be affected. This is a high-risk level.</li>
                    <li><strong>Probit ≥ 7.33:</strong> Effect &gt; 99%,🚨 <strong>Near-Total Effect.</strong> The calculated effect is over 99%, signifying that nearly the entire exposed population will be affected. This represents an extreme risk.</li>
                    <li>If calculation invalid (NaN/Infinity), shows error message</li>
                </ul>
            </li>
            </div>
            <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A Probit Percentage Effect Calculator uses a statistical method known as probit analysis, which assumes that the data is normally distributed. While there is no single international organization standardizing every calculator, the methodology is widely accepted and based on the foundational statistical work of Chester Bliss and D.J. Finney.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Validating Bodies and Applications</h3>
    <ul class="note-list">
        <li><b>CLSI (Clinical and Laboratory Standards Institute):</b> The CLSI's EP17-A2 document details probit regression for estimating analytical sensitivity (detection limits) in clinical and molecular diagnostic tests.</li>
        <li><b>EPA (U.S. Environmental Protection Agency):</b> The EPA uses probit analysis for toxicology studies, such as modeling the lethal concentration (LC50) or dose (LD50) of chemicals on organisms.</li>
        <li><b>FDA (U.S. Food and Drug Administration):</b> The FDA accepts probit analysis for validating the performance of certain laboratory tests. For example, the probability of detecting a virus at a specific concentration might be determined by probit analysis.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">How the Probit Standard Works</h3>
    <p>
        A probit calculator does not follow a formal standard like a building code. Instead, it applies a universally accepted statistical model based on the following principles:
    </p>
    <ul class="note-list">
        <li><b>Standard Normal Distribution:</b> The method relies on the cumulative distribution function (CDF) of the standard normal distribution.</li>
        <li><b>Dose-Response:</b> It assumes a relationship between the level of a stimulus (dose, concentration) and the proportion of a population that responds.</li>
        <li><b>Linearization:</b> It transforms a sigmoid-shaped (S-shaped) dose-response curve into a straight line for analysis, making it a powerful tool for modeling.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Key Statistical Output</h3>
    <ul class="note-list">
        <li>A calculator based on probit analysis will compute standard endpoints like the median effective dose (ED50) or lethal concentration (LC50).</li>
    </ul>
</div>
            <div class="note-card">
                <h3>⚠️ Conclusion</h3>
    <p>
        This calculator transforms a Probit value into the corresponding Percentage Effect of the population affected, providing a clear and intuitive understanding of risk. It features a visual meter and feedback system to help assess the level of impact, from minimal to near-total effects. Minimal effects generally indicate safe exposure levels, whereas near-total effects represent extreme risk. Typical Probit values fall within the 2–8 range; values outside this range may not be physiologically meaningful and should be interpreted cautiously.
    </p>
</li>
</div>
                



    
            
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateProbitEffect() {
            const probit_val = document.getElementById('probitValue').value.trim();

            const errorBox = document.getElementById('resultError');
            const errorMessage = document.getElementById('errorMessage');
            const placeholder = document.getElementById('placeholder');
            const resultValue = document.getElementById('resultValue');

            let errors = [];

            // --- VALIDATION RULES ---
            const probitValue = parseFloat(probit_val);
            if (probit_val === '' || isNaN(probitValue) || probitValue <= 0) {
                errors.push("👉 Probit Value must be a positive number (typically in the 2-8 range).");
            }

            // --- ERROR HANDLING ---
            if (errors.length > 0) {
                errorMessage.innerHTML = errors.join("<br>");
                errorBox.classList.remove("hidden");
                placeholder.classList.add("hidden");
                resultValue.classList.add("hidden");
                return;
            } else {
                errorBox.classList.add("hidden");
            }

            // --- CALCULATION ---
            // Abramowitz and Stegun approximation for the error function (erf)
            function erf(x) {
                const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741;
                const a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
                const sign = (x >= 0) ? 1 : -1;
                x = Math.abs(x);
                const t = 1.0 / (1.0 + p * x);
                const y = 1.0 - (((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x));
                return sign * y;
            }

            const percentageEffect = 50 * (1 + erf((probitValue - 5) / Math.sqrt(2)));

            if (!isFinite(percentageEffect)) {
                errorMessage.innerHTML = "❌ Calculation resulted in an invalid number. Please check your input.";
                errorBox.classList.remove("hidden");
                resultValue.classList.add("hidden");
                return;
            }

            // --- DISPLAY RESULTS ---
            document.getElementById('rateValue').textContent = percentageEffect.toFixed(2) + '%';
            
            // --- ASSESSMENT ---
            const meterFill = document.getElementById('meterFill');
            let meterWidth, meterColor, feedback;

            if (probitValue < 2.67) {
                meterWidth = '15%';
                meterColor = '#2ecc71'; // Green
                feedback = `✅ <strong>Minimal Effect.</strong> The calculated effect is less than 1%, often considered a negligible or no-effect level in risk assessments.`;
            } else if (probitValue < 5) {
                meterWidth = '40%';
                meterColor = '#f1c40f'; // Yellow
                feedback = `🟡 <strong>Low to Moderate Effect.</strong> The effect is between 1% and 50%, indicating a portion of the population will be affected.`;
            } else if (probitValue < 7.33) {
                meterWidth = '75%';
                meterColor = '#e67e22'; // Orange
                feedback = `⚠️ <strong>Significant Effect.</strong> The effect is between 50% and 99%, indicating a majority of the population will be affected. This is a high-risk level.`;
            } else { // >= 7.33
                meterWidth = '95%';
                meterColor = '#e74c3c'; // Red
                feedback = `🚨 <strong>Near-Total Effect.</strong> The calculated effect is over 99%, signifying that nearly the entire exposed population will be affected. This represents an extreme risk.`;
            }

            meterFill.style.width = meterWidth;
            meterFill.style.backgroundColor = meterColor;
            document.getElementById('feedbackContent').innerHTML = feedback;

            placeholder.classList.add("hidden");
            resultValue.classList.remove("hidden");
        }

        function printReport() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}