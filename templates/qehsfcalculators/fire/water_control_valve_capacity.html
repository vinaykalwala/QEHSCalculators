{% extends 'base.html' %}
{% block title %}Water Control Valve Capacity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Water Control Valve Capacity Calculator</h1>
        <p>Calculate the <strong>Required Valve Capacity (Kv)</strong> based on flow rate and pressure drop to ensure efficient water flow regulation.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="flowRate">Flow Rate (mÂ³/h)</label>
                <input type="number" id="flowRate" class="form-input" placeholder="Enter Flow Rate">
            </div>
            <div class="form-group">
                <label for="pressureDrop">Pressure Drop (bar)</label>
                <input type="number" id="pressureDrop" class="form-input" placeholder="Enter Pressure Drop">
            </div>
            <button class="calculate-btn" onclick="calculateValveCapacity()">Calculate Valve Capacity</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Valve Illustration">
                <p>This tool will calculate the <strong>Valve Capacity (Kv)</strong>. Enter your data to see results and insights here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Valve Capacity</div>
                <div class="rate-value" id="kvValue">0.00</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">mÂ³/hÂ·barâ°.âµ</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">

        <!-- About This Calculator -->
       <div class="note-card">
    <h3>ð About This Calculator</h3>
    <p>
        This calculator helps determine the <strong>Required Valve Capacity (Kv)</strong> for water control valves. Correct valve sizing ensures efficient flow regulation, safety, and optimal system performance.
    </p>
    <p>
        The Kv value represents the flow rate (in mÂ³/h) that passes through a valve at a pressure drop of 1 bar. Calculating the correct valve capacity is crucial to prevent under- or over-sizing, which can lead to system inefficiencies, excessive wear, or even failure. 
    </p>
    <p>
        <strong>Real-Life Applications:</strong>
        <ul>
            <li><strong>Automotive Cooling Systems:</strong> In car engines, water flow through the radiator is regulated by valves to maintain optimal engine temperature. Correct Kv ensures efficient cooling without overloading the pump.</li>
            <li><strong>HVAC Systems:</strong> Valves in heating and cooling circuits control water flow to maintain comfortable indoor temperatures.</li>
            <li><strong>Industrial Water Distribution:</strong> Manufacturing plants use water control valves to regulate process water, ensuring proper flow and preventing pressure drops that can damage equipment.</li>
            <li><strong>Plumbing Systems:</strong> Residential and commercial water supply systems rely on correctly sized valves for faucets, showers, and irrigation systems.</li>
            <li><strong>Fire Protection Systems:</strong> Sprinkler systems use valves with precise Kv ratings to deliver adequate water flow for fire suppression.</li>
        </ul>
    </p>
    <p>
        Using this calculator helps engineers, technicians, and system designers select the right valve, improving system efficiency, reducing energy consumption, and extending equipment lifespan.
    </p>
</div>


        <!-- Parameters -->
      <div class="note-card">
    <h3>âï¸ Parameters</h3>
    <p>
        <strong>Flow Rate (mÂ³/h):</strong> This is the volume of water passing through the valve per hour. A higher flow rate increases the required valve capacity to ensure efficient flow control.
    </p>
    <p>
        <strong>Pressure Drop (bar):</strong> This represents the difference in pressure across the valve. Higher pressure drops reduce flow through a given valve size, affecting the valve selection.
    </p>
    <p>
        <strong>Valve Capacity (Kv):</strong> The calculated flow capacity of the valve, determined using <em>Kv = Flow Rate / âPressure Drop</em>. This ensures the valve can handle the system requirements efficiently.
    </p>
</div>

      <!-- Interpretation -->
<div class="note-card">
    <h3>ð¡ Interpretation</h3>
    <ul class="note-list">
        <li>â ï¸ <strong>Very Small Valve Flow Capacity:</strong> The calculated valve flow capacity is less than one cubic meter per hour per square root of bar. The valve may be undersized. Verify if a low-flow control valve is required to maintain proper system efficiency and prevent insufficient water delivery.</li>
        <li>â <strong>Standard Valve Flow Capacity:</strong> The calculated valve flow capacity is between one and five cubic meters per hour per square root of bar. This range is suitable for most residential, commercial, or light industrial water systems. It ensures proper flow regulation without overloading pumps or causing pressure imbalance.</li>
        <li>â ï¸ <strong>Large Valve Flow Capacity:</strong> The calculated valve flow capacity is between five and ten cubic meters per hour per square root of bar. The valve must handle higher flow; verify mechanical compatibility and system design to prevent pressure loss or equipment stress.</li>
        <li>â <strong>Very Large Valve Flow Capacity:</strong> The calculated valve flow capacity is greater than ten cubic meters per hour per square root of bar. This is unusual and likely requires a custom valve design or system review. Check the input values for accuracy to ensure safety and compliance with standards.</li>
    </ul>
</div>

<!-- Input Validations -->
<div class="note-card">
    <h3>ð¡ï¸ Input Validations</h3>
    <ul class="note-list">
        <li>All input fields are required and must be completed before performing any calculation.</li>
        <li><strong>Flow Rate in Cubic Meters Per Hour:</strong> Must be a positive number greater than zero. The typical acceptable range is from 0.1 to 5000 cubic meters per hour depending on the water system type.</li>
        <li><strong>Pressure Drop in Bar:</strong> Must be a numeric value greater than zero. The typical acceptable range is from 0.01 to 50 bar for most water systems.</li>
        <li>Decimal precision up to two places is recommended to ensure accurate calculations and alignment with engineering design standards.</li>
        <li>Extremely low or extremely high valve flow capacity values may indicate incorrect input data or unusual system conditions. Such cases should be reviewed before implementation.</li>
        <li>Zero or negative values are invalid and will prevent accurate calculation of the valve flow capacity.</li>
        <li>Input values should be logically consistent. For example, a very high flow rate combined with an extremely low pressure drop, or vice versa, may produce unrealistic valve flow capacity and should trigger a warning to the user.</li>
    </ul>
</div>


        <!-- Usage -->
        <div class="note-card">
            <p>
                Click <strong>"Calculate Valve Capacity"</strong> to determine the required Kv. Proper sizing ensures optimal system performance and safety.
            </p>
        </div>

    </div>
</div>

<script>
function calculateValveCapacity() {
    const flowRateInput = document.getElementById('flowRate').value.trim();
    const pressureDropInput = document.getElementById('pressureDrop').value.trim();
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');

    // Reset display
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Mandatory field check
    if (flowRateInput === "" || pressureDropInput === "") {
        resultError.innerHTML = "â ï¸ Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Convert to numbers
    const flowRate = parseFloat(flowRateInput);
    const pressureDrop = parseFloat(pressureDropInput);

    // Type and positive checks
    if (isNaN(flowRate) || isNaN(pressureDrop)) {
        resultError.innerHTML = "â Invalid entry. Please enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    if (flowRate <= 0) {
        resultError.innerHTML = "â Flow rate must be greater than zero (mÂ³/h).";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    if (pressureDrop <= 0) {
        resultError.innerHTML = "â Pressure drop must be greater than zero (bar).";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Industry threshold warnings
    if (flowRate > 5000) {
        resultError.innerHTML = "â ï¸ Flow rate unusually high (>5000 mÂ³/h). Please verify units.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    if (pressureDrop > 50) {
        resultError.innerHTML = "â ï¸ Pressure drop unusually high (>50 bar). Check system design.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Calculation
    const kv = flowRate / Math.sqrt(pressureDrop);
    document.getElementById('kvValue').innerText = kv.toFixed(2);
    resultValue.classList.remove('hidden');

    // Feedback
    let feedback = "";
    if (kv < 0.01) {
        feedback = "â ï¸ Extremely low Kv (Flow Coefficient): Likely unrealistic or very low-flow system. Review inputs.";
        feedbackContent.style.color = "blue";
    } else if (kv < 1) {
        feedback = "â ï¸ Very Small Valve Required: Consider low-flow control valve.";
        feedbackContent.style.color = "blue";
    } else if (kv <= 5) {
        feedback = "â Suitable Valve Size: Standard for most systems.";
        feedbackContent.style.color = "green";
    } else if (kv <= 10) {
        feedback = "â ï¸ Large Valve Needed: Ensure the selected valve can handle this capacity.";
        feedbackContent.style.color = "orange";
    } else if (kv <= 100) {
        feedback = "â Very Large Valve Requirement: Verify inputs; may need custom valve.";
        feedbackContent.style.color = "red";
    } else {
        feedback = "â Kv(Flow Coefficient) extremely high (>100): Inputs likely invalid.";
        feedbackContent.style.color = "red";
    }

    feedbackContent.innerHTML = feedback;
}

function printReport() {
    window.print();
}

</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Analysis of Inputs, Outputs, and Calculation

Inputs:

Input	Units	Real-world Significance
Flow Rate	mÂ³/h	Volume of water passing through the valve per hour; critical for ensuring sufficient cooling or water delivery.
Pressure Drop	bar	Difference in pressure across the valve; affects valve sizing and efficiency.

Output:

Output	Units	Meaning
Valve Capacity (Kv)	mÂ³/hÂ·barâ°.âµ	Flow capacity of the valve; indicates proper valve size for safe and efficient water control.

Calculation Formula:

ð¾
ð£
=
FlowÂ RateÂ (mÂ³/h)
PressureÂ DropÂ (bar)
Kv=
PressureÂ DropÂ (bar)
	â

FlowÂ RateÂ (mÂ³/h)
	â


Correct for real systems. Kv represents standardized valve flow capacity, used in compliance reports, audits, and system design.

2. Recommended Input Validation Rules (QEHS/Fire Safety Perspective)

Flow Rate:

Required: Yes (mandatory)

Type: Positive number, decimals allowed (up to 2 decimal places)

Units: mÂ³/h

Typical range: 0.1 â 1000 mÂ³/h (industrial HVAC, plumbing, fire suppression)

Edge checks:

0 or negative â reject

Excessively high (> 5000 mÂ³/h) â warning, likely unrealistic

Non-numeric â reject

Pressure Drop:

Required: Yes

Type: Positive number, decimals allowed (0.01 bar minimum precision)

Units: bar

Typical range: 0.01 â 10 bar (HVAC, plumbing, fire systems)

Edge checks:

0 or negative â reject (division by zero)

Extremely high (>50 bar) â warning, check for industrial system

Non-numeric â reject

Cross-field consistency:

Kv should remain in a realistic range (0.01 â 100 mÂ³/hÂ·barâ°.âµ)

Warn user if combination of flow rate and pressure drop produces extremely low or high Kv

3. Edge Case Validations
Case	Handling
Flow Rate = 0	â Error: Flow rate must be greater than zero
Pressure Drop = 0	â Error: Pressure drop must be greater than zero (division by zero)
Extremely high Kv (>100)	â ï¸ Warning: Likely unrealistic; review inputs
Extremely low Kv (<0.01)	â ï¸ Warning: Likely very low-flow system; review inputs
Negative values	â Error: Invalid input
Non-numeric input	â Error: Must be numeric
Excessive decimals (>2)	â ï¸ Warning: Round to 2 decimal places

Why essential:

Prevents calculation errors that could mislead safety decisions

Ensures compliance with standards like NFPA, ISO 45001, and OSHA

Helps prevent undersized or oversized valves, which could compromise fire suppression, cooling systems, or industrial water safety

4. Output Validation Logic & Thresholds
Kv Range	Interpretation	Color
<1	â ï¸ Very Small Valve: Check system; may cause low flow	Blue
1 â 5	â Standard Valve: Suitable for most applications	Green
5 â 10	â ï¸ Large Valve: Ensure capacity; monitor safety	Orange
>10	â Very Large Valve: Unusual; verify inputs	Red

Ensures outputs are meaningful for audit reports

Allows technicians to quickly identify unsafe or unusual system setups -->