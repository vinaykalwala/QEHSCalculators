{% extends 'base.html' %}
{% block title %}Flammable Range Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
      

        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'firecategory_calculators'%}" class="back-btn">Back To Fire Calculators</a>
    </div>


   <div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Flammable Range Calculator</h1>
        <p>Determine the safe concentration limits of gases or vapors to prevent fire hazards.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Gas/Vapor Limits</h2>
            <div class="form-group">
                <label for="lfl">Lower Flammable Limit (LFL) %:</label>
                <input type="number" id="lfl" class="form-input" placeholder="e.g., 2.1" step="0.01">
            </div>
            <div class="form-group">
                <label for="ufl">Upper Flammable Limit (UFL) %:</label>
                <input type="number" id="ufl" class="form-input" placeholder="e.g., 9.5" step="0.01">
            </div>
            <button class="calculate-btn" onclick="calculateFlammableRange()">Calculate Range</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder when no result yet -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/flame.png' %}" alt="Flammable range icon">
                <p>Enter the LFL and UFL above and click <strong>Calculate Range</strong> to see the flammable range.</p>
            </div>

            <!-- Error display -->
            <div class="result-error hidden" id="resultError" style="font-size: 22px;"></div>

            <!-- Actual result display -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value" id="rangeResult"></div>
                <div class="safety-meter">
                    <div class="meter-fill" id="meterFill"></div>
                </div>
                <div class="meter-labels">
                    <span>Low Risk</span>
                    <span>Moderate Risk</span>
                    <span>High Risk</span>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

   <!-- Notes Section -->
<div class="note-section">

    <!-- What is this Calculator -->
    <div class="note-card">
        <h3>About the Flammable Range Calculator</h3>
        <p>This calculator helps determine the safe concentration limits of gases or vapors in air, preventing fire hazards. 
        By entering the Lower Flammable Limit (LFL) and Upper Flammable Limit (UFL), you can quickly assess the flammable range and associated risk.</p>
    </div>

    <!-- Explanation of Parameters -->
    <div class="note-card">
        <h3>Parameters Explained</h3>
        <ul>
            <li><strong>Lower Flammable Limit (LFL):</strong> Minimum concentration of a gas or vapor that can sustain combustion.</li>
            <li><strong>Upper Flammable Limit (UFL):</strong> Maximum concentration beyond which combustion cannot occur due to excess fuel and insufficient oxygen.</li>
        </ul>
    </div>

    <!-- Examples Table -->
    <div class="note-card">
        <h3>Examples of Flammability Limits (in air)</h3>
        
    </div>
      <table class="custom-table">
            <thead>
                <tr>
                    <th>Fuel</th>
                    <th>LFL (%)</th>
                    <th>UFL (%)</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>Methane</td><td>5.0</td><td>15.0</td></tr>
                <tr><td>Propane</td><td>2.1</td><td>9.5</td></tr>
                <tr><td>Ethylene</td><td>2.7</td><td>12.0</td></tr>
                <tr><td>Hydrogen</td><td>4.0</td><td>75.0</td></tr>
                <tr><td>Methanol</td><td>6.0</td><td>36.0</td></tr>
                <tr><td>Acetylene</td><td>2.5</td><td>100.0</td></tr>
            </tbody>
        </table>
    <!-- Input Validations / Conclusion -->
   <div class="note-card">
    <h3>Input Validations & Compliance Notes</h3>
    <p>To ensure accurate calculation and meaningful risk assessment, please follow these guidelines:</p>
    <ul>
        <li><strong>LFL (Lower Flammable Limit):</strong> Must be numeric, ‚â• 0%, ‚â§ 100%. Cannot exceed UFL.</li>
        <li><strong>UFL (Upper Flammable Limit):</strong> Must be numeric, > LFL, ‚â§ 100%. Cannot be zero or negative.</li>
        <li><strong>Decimal Precision:</strong> Only up to 2 decimal places allowed for both LFL and UFL.</li>
        <li><strong>Required Fields:</strong> Do not leave any field blank; both LFL and UFL are mandatory.</li>
        <li><strong>Logical Consistency:</strong> LFL must always be less than UFL to calculate a valid flammable range.</li>
        <li><strong>Physical Realism:</strong> Inputs outside typical gas flammability ranges (0‚Äì100%) are considered invalid and may indicate data entry errors.</li>
    </ul>
    <p>Following these rules ensures compliance with OSHA, NFPA, ISO 45001, and industry fire safety standards. It prevents calculation errors and ensures the reported flammable range reflects real-world safety limits.</p>
</div>


</div>
   </div>
<script>

function calculateFlammableRange() {
    const errorBox = document.getElementById('resultError'),
          placeholder = document.getElementById('placeholder'),
          resultValueDiv = document.getElementById('resultValue'),
          meterFill = document.getElementById('meterFill');

    const lfl = parseFloat(document.getElementById("lfl").value);
    const ufl = parseFloat(document.getElementById("ufl").value);

    // ---- VALIDATION ----
    let errors = [];

    // Check if numeric
    if (isNaN(lfl)) errors.push("LFL must be a numeric value.");
    if (isNaN(ufl)) errors.push("UFL must be a numeric value.");

    // Check ranges
    if (lfl < 0 || lfl > 100) errors.push("LFL must be between 0 and 100%.");
    if (ufl <= 0 || ufl > 100) errors.push("UFL must be greater than 0 and ‚â§ 100%.");
    if (lfl >= ufl) errors.push("LFL must be less than UFL.");

    // Decimal precision check (max 2 decimal places)
    if (!/^\d+(\.\d{1,2})?$/.test(lfl.toString())) errors.push("LFL must have at most 2 decimal places.");
    if (!/^\d+(\.\d{1,2})?$/.test(ufl.toString())) errors.push("UFL must have at most 2 decimal places.");

    // Display errors if any
    if (errors.length > 0) {
        errorBox.innerHTML = "‚ùå " + errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValueDiv.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // ---- CALCULATION ----
    const flammableRange = ufl - lfl;
    let rating = "", meterWidth = "", meterColor = "";

    if (flammableRange <= 5) {
        rating = "üîµ Low Risk: Minimal Flammability Risk";
        meterWidth = "30%"; meterColor = "#2ecc71";
    } else if (flammableRange <= 10) {
        rating = "üü° Moderate Risk: Moderate Flammability Risk";
        meterWidth = "65%"; meterColor = "#f1c40f";
    } else {
        rating = "üî¥ High Risk: High Flammability Risk! Caution!";
        meterWidth = "100%"; meterColor = "#e74c3c";
    }

    document.getElementById("rangeResult").innerHTML = `
        <p style="font-size:20px; color:#1560bd;">
            <strong>Flammable Range:</strong> ${flammableRange.toFixed(2)}%
        </p>
        <p style="font-size:16px; color:#333;">
            <strong>Rating:</strong> ${rating}
        </p>
    `;

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;

    placeholder.classList.add("hidden");
    resultValueDiv.classList.remove("hidden");
}

function printReport() {
    window.print();
}
</script>



</body>
</html>
{% endblock %}

<!-- 1. Analysis of Inputs, Outputs, and Calculation
Inputs

LFL (%): Lower Flammable Limit ‚Äì minimum gas concentration in air that can sustain combustion.

UFL (%): Upper Flammable Limit ‚Äì maximum gas concentration beyond which combustion cannot occur.

Real-world considerations:

LFL and UFL must be in percentage of volume in air.

LFL must be ‚â• 0 (cannot have negative fuel concentration).

UFL must be > LFL.

LFL and UFL should be realistic for known chemicals (e.g., < 100%).

Outputs

Flammable Range (%) = UFL ‚Äì LFL

Risk Rating: Based on range width (Low / Moderate / High).

Low Risk: ‚â§ 5%

Moderate Risk: 5‚Äì10%

High Risk: > 10%

Visualization: Safety meter for intuitive understanding.

Compliance Note: In audits, flammable range must be realistic and cannot report negative or zero ranges.

2. Recommended Input Validation Rules
Parameter	Validation Rule	Allowed Range / Unit	QEHS Rationale
LFL (%)	Must be numeric, ‚â• 0, ‚â§ 100	0‚Äì100%	LFL cannot be negative; above 100% is physically impossible
UFL (%)	Must be numeric, > LFL, ‚â§ 100	LFL < UFL ‚â§ 100%	UFL must be greater than LFL; cannot exceed 100% volume in air
Step / Decimals	Allow up to 2 decimal places	e.g., 2.12%	Precision is important for risk assessment
Cross-field	LFL < UFL	Logical consistency	Prevent nonsensical results, e.g., negative range
Non-empty	All fields required	N/A	Blank inputs cannot generate valid output
3. Edge Case Validation
Edge Case	Handling
LFL = UFL	Error: "LFL must be less than UFL"
LFL or UFL = 0	Allowed for LFL; not allowed for UFL = 0 (no combustion possible)
LFL < 0 or UFL < 0	Error: negative values are physically impossible
LFL > 100 or UFL > 100	Error: cannot exceed 100% gas volume
Extremely wide range (>100%)	Warn: unlikely, check input accuracy
Non-numeric input	Error: must be numeric
4. Output Validation Logic

Flammable Range (UFL ‚Äì LFL) must be ‚â• 0.

Range thresholds for risk rating:

Low Risk: 0‚Äì5% ‚Üí minimal fire hazard

Moderate Risk: 5‚Äì10% ‚Üí some fire hazard, monitor process

High Risk: >10% ‚Üí high fire hazard, strict control required

Meter Visualization: Width & color reflect severity.

Compliance rationale: OSHA/NFPA and ISO 45001 require that reported hazard data be physically meaningful and actionable. -->