{% extends 'base.html' %}
{% block title %}Fauske's Vent Area Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

   <div class="calculator-header">
    <h1>Fauske's Vent Area Calculator</h1>
    <p>Calculate the required vent area to safely relieve pressure and prevent explosions in enclosed systems.</p>
</div>

<div class="calc-content">
    <!-- Input Card -->
    <div class="calc-card">
        <h2>Enter Data</h2>
        
        <div class="form-group">
            <label for="mass">Initial Mass (kg)</label>
            <input type="number" id="mass" class="form-input" placeholder="Enter Initial Mass">
            <span id="massWarning" class="input-warning"></span>
        </div>

        <div class="form-group">
            <label for="pressure">Overpressure (Pa)</label>
            <input type="number" id="pressure" class="form-input" placeholder="Enter Overpressure">
            <span id="pressureWarning" class="input-warning"></span>
        </div>

        <div class="form-group">
            <label for="specificHeat">Specific Heat (J/kgÂ·K)</label>
            <input type="number" id="specificHeat" class="form-input" placeholder="Enter Specific Heat">
            <span id="specificHeatWarning" class="input-warning"></span>
        </div>

        <div class="form-group">
            <label for="temperature">Initial Temperature (K)</label>
            <input type="number" id="temperature" class="form-input" placeholder="Enter Initial Temperature">
            <span id="temperatureWarning" class="input-warning"></span>
        </div>

        <div class="form-group">
            <label for="tempRate">Temperature Rise Rate (K/s)</label>
            <input type="number" id="tempRate" class="form-input" placeholder="Enter Temperature Rise Rate">
            <span id="tempRateWarning" class="input-warning"></span>
        </div>

        <button class="calculate-btn" onclick="calculateVentArea()">Calculate Vent Area</button>
    </div>

    <!-- Result Card -->
    <div class="result-card">
        <!-- Placeholder -->
        <div class="result-placeholder" id="placeholder">
            <img src="{% static 'images/resultimage.png' %}" alt="Vent Area Illustration">
            <p>This tool will calculate the <strong>Required Vent Area</strong>. Enter your data to see results and insights here.</p>
        </div>

        <!-- Error -->
        <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

        <!-- Result -->
        <div class="result-value hidden" id="resultValue">
            <div class="rate-value">Required Vent Area</div>
            <div class="rate-value" id="ventAreaValue">0.0000</div>
            <div class="rate-label" style="font-size:16px; font-weight:bold;">mÂ²</div>
            <div class="result-feedback" id="feedbackContent"></div>
            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

    <!-- Notes Section -->
<div class="note-section">

    <!-- 1. About This Calculator -->
    <div class="note-card">
        <h3>ð About This Calculator</h3>
        <p>
            This calculator determines the <strong>required vent area</strong> to safely release pressure and prevent explosions.
            It is widely used in chemical, industrial, and fire safety applications for pressure relief design.
        </p>
    </div>

    <!-- 2. Parameters -->
    <div class="note-card">
        <h3>âï¸ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Initial Mass (kg):</strong> Total mass of material in the container; affects vent area requirement.</li>
            <li><strong>Overpressure (Pa):</strong> Pressure difference to relieve; higher pressure requires larger vent area.</li>
            <li><strong>Specific Heat (J/kgÂ·K):</strong> Energy required to raise temperature per unit mass.</li>
            <li><strong>Initial Temperature (K):</strong> Starting temperature of the material.</li>
            <li><strong>Temperature Rise Rate (K/s):</strong> Rate of heating; faster heating increases vent area.</li>
        </ul>
    </div>

    <!-- 3. Input Validation Rules -->
    <div class="note-card">
        <h3>ð¡ï¸ Input Validation Rules</h3>
        <p>To ensure safe and accurate vent area calculations, inputs are validated according to QEHS and fire safety best practices:</p>
        <ul class="note-list">
            <li>All inputs are mandatory; missing values prevent calculation.</li>
            <li>Numeric values only; letters or symbols trigger errors.</li>
            <li>Positive values required; zero or negative inputs are invalid.</li>
            <li>Industry-standard ranges:
                <ul>
                    <li>Mass: 0.01â10,000 kg</li>
                    <li>Overpressure: 1,000â500,000 Pa</li>
                    <li>Specific Heat: 100â5,000 J/kgÂ·K</li>
                    <li>Initial Temperature: 273â600 K</li>
                    <li>Temperature Rise Rate: 0.01â10 K/s</li>
                </ul>
            </li>
            <li>Logical consistency: Initial Temperature â  0; mass/pressure ratio must be physically reasonable; extreme combinations flagged.</li>
            <li>Feedback indicators:
                <ul>
                    <li>Red text â invalid input/error; calculation blocked.</li>
                    <li>Orange text â warning; calculation allowed but review advised.</li>
                </ul>
            </li>
        </ul>
    </div>

    <!-- 4. Output Validation & Feedback -->
    <div class="note-card">
        <h3>â¡ Output Validations & Feedback</h3>
        <ul class="note-list">
            <li><strong>â Low Vent Area:</strong> Minimal pressure; standard relief sufficient.</li>
            <li><strong>â ï¸ Moderate Vent Area:</strong> Monitor and ensure adequate venting.</li>
            <li><strong>ð¨ High Vent Area:</strong> Immediate attention required; risk of overpressure.</li>
            <li><strong>ð´ Extreme Hazard:</strong> Critical venting required; follow emergency protocols.</li>
            <li>Errors and warnings appear for zero/negative inputs, unrealistic mass/pressure ratios, or extreme values.</li>
            <li>Feedback is **displayed exactly** as in the calculator for compliance and safety assessment.</li>
        </ul>
    </div>

    <!-- 5. Governing Principle -->
    <div class="note-card">
        <h3>ð Governing Principle</h3>
        <p>
            Vent area calculation is based on safely relieving pressure to avoid catastrophic vessel failure. This methodology aligns with <strong>Fauske's Vent Area methodology</strong> and is guided by <strong>API 520/521 â Sizing, Selection, and Installation of Pressure-Relieving Devices</strong> standards.
        </p>
        <p>
            Analogous concept: A <strong>Critical Number of Samples Calculator</strong> is not tied to a single standard but is used in statistical quality control (ISO 2859) or laboratory medicine (Westgard rules) to determine required sample sizes for confidence or quality assessment. Similarly, vent area calculations ensure safety thresholds are met for pressure relief design.
        </p>
    </div>

    <!-- 6. Conclusion -->
    <div class="note-card">
        <h3>â Conclusion</h3>
        <ul class="note-list">
            <li>Calculated vent area provides actionable guidance for industrial safety and fire prevention.</li>
            <li>Dynamic feedback is displayed exactly as in the calculator, ensuring users understand the risk level.</li>
            <li>Input validations prevent unsafe or unrealistic scenarios, aligning with OSHA, NFPA, ISO 45001, and ILO standards.</li>
            <li>Errors and warnings alert operators to abnormal conditions, supporting effective hazard mitigation and compliance reporting.</li>
        </ul>
    </div>

</div>


<style>
.input-warning { font-size: 14px; display: block; margin-top: 2px; }
.input-warning.warning { color: orange; }
.input-warning.error { color: red; }
</style>

<script>
function calculateVentArea() {
    const mass = parseFloat(document.getElementById('mass').value.trim());
    const pressure = parseFloat(document.getElementById('pressure').value.trim());
    const specificHeat = parseFloat(document.getElementById('specificHeat').value.trim());
    const temperature = parseFloat(document.getElementById('temperature').value.trim());
    const tempRate = parseFloat(document.getElementById('tempRate').value.trim());

    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');

    // Reset display and warnings
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    clearFieldWarnings();

    // Validation: Mandatory & Numeric
    if ([mass, pressure, specificHeat, temperature, tempRate].some(v => isNaN(v))) {
        showError("â All inputs must be numeric.");
        return;
    }
    if ([mass, pressure, specificHeat, temperature, tempRate].some(v => v <= 0)) {
        showError("â All inputs must be greater than zero.");
        return;
    }
    if (temperature === 0) {
        showError("â Initial Temperature cannot be zero (division by zero).");
        return;
    }

    // Calculate Vent Area
    const ventArea = (mass / pressure) * Math.sqrt(specificHeat / temperature) * tempRate;
    document.getElementById('ventAreaValue').innerText = ventArea.toFixed(4);
    resultValue.classList.remove('hidden');

    // Feedback
    let feedback = "";
    if (ventArea < 0.1) { feedback = "â Low Vent Area: Standard pressure relief sufficient."; feedbackContent.style.color="green"; }
    else if (ventArea <= 1.0) { feedback = "â ï¸ Moderate Vent Area: Ensure adequate venting and monitoring."; feedbackContent.style.color="orange"; }
    else if (ventArea <= 10) { feedback = "ð¨ High Vent Area: Immediate attention required; risk of overpressure."; feedbackContent.style.color="red"; }
    else { feedback = "ð´ Extreme Hazard: Critical venting needed; follow emergency protocols."; feedbackContent.style.color="darkred"; }
    feedbackContent.innerHTML = feedback;

    // Industry-standard warnings (small, inline)
    if (mass < 0.01 || mass > 10000) showFieldWarning('massWarning', "Mass outside typical range (0.01â10,000 kg)", "warning");
    if (pressure < 1000 || pressure > 500000) showFieldWarning('pressureWarning', "Overpressure outside typical range (1,000â500,000 Pa)", "warning");
    if (specificHeat < 100 || specificHeat > 5000) showFieldWarning('specificHeatWarning', "Specific Heat outside typical range (100â5,000 J/kgÂ·K)", "warning");
    if (temperature < 273 || temperature > 600) showFieldWarning('temperatureWarning', "Temperature outside typical range (273â600 K)", "warning");
    if (tempRate < 0.01 || tempRate > 10) showFieldWarning('tempRateWarning', "Temperature Rise Rate outside typical range (0.01â10 K/s)", "warning");
}

function showError(msg) {
    const resultError = document.getElementById('resultError');
    resultError.innerHTML = msg;
    resultError.style.color = "red";
    resultError.classList.remove('hidden');
}

function showFieldWarning(id, msg, type="warning") {
    const span = document.getElementById(id);
    span.innerText = msg;
    span.className = `input-warning ${type}`;
}

function clearFieldWarnings() {
    ['massWarning','pressureWarning','specificHeatWarning','temperatureWarning','tempRateWarning'].forEach(id=>{
        const span = document.getElementById(id);
        span.innerText = '';
        span.className = 'input-warning';
    });
}

function printReport() {
    window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Inputs Analysis from a QEHS/Fire Safety Perspective
Input	Purpose	QEHS Considerations
Initial Mass (kg)	Mass of material in vessel	Must be > 0; unrealistic masses could mislead vent sizing. Typical ranges depend on vessel size (0.01â10,000 kg).
Overpressure (Pa)	Pressure to relieve	Must be > 0; exceeding vessel design pressure is dangerous. Typical industrial relief pressures: 1,000â500,000 Pa.
Specific Heat (J/kgÂ·K)	Material energy absorption	Must be > 0; unrealistic values affect vent area. Realistic chemical materials: 100â5,000 J/kgÂ·K.
Initial Temperature (K)	Starting temp of material	Must be > 0 K; physically meaningful. Typical chemical processes: 273â600 K.
Temperature Rise Rate (K/s)	Heating rate	Must be > 0; excessive rates may indicate fire/explosion scenario. Industrial processes: 0.01â10 K/s.
2. Recommended Input Validation Rules

Mandatory fields â All inputs must be entered.

Numeric only â No letters or special characters.

Positive values only â Zero or negative values are physically invalid.

Acceptable ranges (based on industry standards):

Input	Min	Max	Unit
Mass	0.01	10,000	kg
Overpressure	1,000	500,000	Pa
Specific Heat	100	5,000	J/kgÂ·K
Initial Temperature	273	600	K
Temperature Rise Rate	0.01	10	K/s

Allowed decimals â Up to 4 decimals for precision; more than 4 can be ignored.

Logical consistency / cross-field checks:

ventArea = (mass / pressure) * sqrt(specificHeat / temperature) * tempRate

Ensure temperature â  0 (division by zero).

Overpressure must be â¤ vessel design pressure (user-informed alert).

Mass/Pressure ratio should not exceed plausible physical limits.

3. Edge Case Validations
Edge Case	Handling
Zero or negative inputs	Reject; show red error.
Extremely high values (mass > 10,000 kg, pressure > 500 kPa, tempRate > 10 K/s)	Warn user (orange) but allow calculation if confirmed.
Division by zero (temperature = 0 K)	Block calculation; error message.
Unrealistic combinations (e.g., tiny mass, huge temp rate)	Warn user; suggest manual review.
Very small vent area (<0.01 mÂ²)	Show feedback: âLow Vent Area â standard relief sufficient.â
Very large vent area (>100 mÂ²)	Show feedback: âExtreme Hazard â verify inputs and emergency measures.â
4. Output Validation Logic and Thresholds
Vent Area (mÂ²)	Feedback	QEHS Interpretation
<0.1	â Low	Minimal hazard; standard relief sufficient
0.1â1.0	â ï¸ Moderate	Ensure monitoring and adequate venting
1.0â10	ð¨ High	Immediate attention; risk of overpressure
>10	ð´ Extreme	Critical; emergency safety required

Rationale: Aligns with OSHA, NFPA, and ISO 45001 guidance for pressure relief KPIs and hazard assessment. -->