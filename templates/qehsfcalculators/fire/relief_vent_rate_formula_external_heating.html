{% extends 'base.html' %}
{% block title %}Relief Vent Rate Formula (External Heating) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Relief Vent Rate (External Heating) Calculator</h1>
        <p>Estimate the temperature increase during homogeneous-vessel venting under constant external heat input. This helps evaluate thermal hazards and design relief systems safely.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="QT">Constant External Heat Input (Qₜ in kJ/min)</label>
                <input type="number" id="QT" class="form-input" placeholder="Enter Qₜ">
            </div>
            <div class="form-group">
                <label for="G">Mass Flux (G in kg/m²s)</label>
                <input type="number" id="G" class="form-input" placeholder="Enter G">
            </div>
            <div class="form-group">
                <label for="A">Vent Area (A in m²)</label>
                <input type="number" id="A" class="form-input" placeholder="Enter A">
            </div>
            <div class="form-group">
                <label for="Cv">Specific Heat (Cᵥ in kJ/kgK)</label>
                <input type="number" id="Cv" class="form-input" placeholder="Enter Cᵥ">
            </div>
            <div class="form-group">
                <label for="mo">Initial Mass (m₀ in kg)</label>
                <input type="number" id="mo" class="form-input" placeholder="Enter m₀">
            </div>
            <div class="form-group">
                <label for="V">Volume (V in m³)</label>
                <input type="number" id="V" class="form-input" placeholder="Enter V">
            </div>
            <div class="form-group">
                <label for="hfa">Latent Heat of Vaporization (hₓₐ in kJ/kg)</label>
                <input type="number" id="hfa" class="form-input" placeholder="Enter hₓₐ">
            </div>
            <div class="form-group">
                <label for="vfa">Specific Volume (vₓₐ in m³/kg)</label>
                <input type="number" id="vfa" class="form-input" placeholder="Enter vₓₐ">
            </div>
            <button class="calculate-btn" onclick="calculateVentTemp()">Calculate Temperature</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Venting Illustration">
                <p>This tool will calculate the <strong>Temperature Increase</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError" style="font-size: 22px;"></div>

            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Temperature Increase</div>
                <div class="rate-value" id="temperatureValue">0.00</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">K</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">

    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator helps you estimate how much the temperature inside a vessel will rise when it is vented under a constant external heat source 
            (like a fire or heater). It takes into account the heat added to the vessel, the cooling effect of vaporization, and the rate at which vapor escapes 
            through the vent. Use this tool to assess potential thermal hazards, plan safety measures, and design relief systems for vessels exposed to external heating. 
            Accurate values for heat input, vent area, substance properties, and vessel volume are essential for reliable results.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Qₜ – Constant External Heat Input (kJ/min):</strong> Heat added from fire/heater.</li>
            <li><strong>G – Mass Flux (kg/m²·s):</strong> Mass leaving per unit vent area.</li>
            <li><strong>A – Vent Area (m²):</strong> Size of the relief vent.</li>
            <li><strong>Cᵥ – Specific Heat (kJ/kg·K):</strong> Heat capacity of the substance.</li>
            <li><strong>m₀ – Initial Mass (kg):</strong> Mass inside the vessel initially.</li>
            <li><strong>V – Vessel Volume (m³):</strong> Total container volume.</li>
            <li><strong>hₓₐ – Latent Heat of Vaporization (kJ/kg):</strong> Cooling from liquid evaporation.</li>
            <li><strong>vₓₐ – Specific Volume (m³/kg):</strong> Volume occupied per kg of vapor.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li>All inputs (Constant External Heat Input, Mass Flux, Vent Area, Specific Heat, Initial Mass, Vessel Volume, Latent Heat of Vaporization, Specific Volume) must be <strong>positive</strong> numbers.</li>
        <li>Typical valid ranges:
            <ul>
                <li>Constant External Heat Input: 0 – 100,000 kJ/min</li>
                <li>Mass Flux: 0 – 50 kg/m²·s</li>
                <li>Vent Area: 0 – 50 m²</li>
                <li>Specific Heat: 0 – 10 kJ/kg·K</li>
                <li>Initial Mass: 0 – 50,000 kg</li>
                <li>Vessel Volume: 0 – 1,000,000 m³</li>
                <li>Latent Heat of Vaporization: 0 – 500 kJ/kg</li>
                <li>Specific Volume: 0 – 10 m³/kg</li>
            </ul>
        </li>
        <li>Density check: Initial Mass / Vessel Volume ≤ 2000 kg/m³.</li>
        <li>Logarithmic term in formula must be greater than 0 to prevent invalid results.</li>
        <li>Unrealistic or extreme inputs trigger warnings or errors to ensure safe calculations.</li>
    </ul>
</div>

    <!-- Output Validations -->
   <div class="note-card">
    <h3>📊 Output Validations</h3>
    <ul class="note-list">
        <li>ΔT &lt; 10 K → ✅ Low Temperature Increase: Safe conditions.</li>
        <li>10 ≤ ΔT ≤ 50 K → ⚠️ Moderate Increase: Monitor and ensure proper venting.</li>
        <li>50 &lt; ΔT ≤ 100 K → 🚨 High Increase: Thermal hazard present.</li>
        <li>ΔT &gt; 100 K → 🔴 Extreme Increase: Critical hazard, take emergency measures!</li>
    </ul>
    <p>Based on the calculated temperature increase (ΔT), the feedback indicates whether venting conditions are safe, moderate, high, or extreme.</p>
</div>


    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            The governing principle is based on energy balance between external heat input, venting losses, and thermal properties of the substance. 
            It uses the relationship between pressure, heat transfer, and vaporization dynamics, as referenced in standards such as the 
            <strong>ASME Boiler and Pressure Vessel Code (BPVC)</strong> and related process safety guidelines.
        </p>
        <p>Assessment criteria (same as Output Validations):</p>
        <ul class="note-list">
            <li>✅ Low Temperature Increase: ΔT &lt; 10 K → Safe conditions.</li>
            <li>⚠️ Moderate Increase: 10 ≤ ΔT ≤ 50 K → Monitor and ensure proper venting.</li>
            <li>🚨 High Increase: 50 &lt; ΔT ≤ 100 K → Thermal hazard present.</li>
            <li>🔴 Extreme Increase: ΔT &gt; 100 K → Critical hazard, take emergency measures!</li>
        </ul>
        <p><strong>Note:</strong> The same assessment or feedback shown in Output Validations will be displayed along with the result.</p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            Understanding temperature increase during venting with external heat input is critical for workplace safety and process design. 
            This calculator’s results, validated against safe thresholds, help engineers and safety professionals design effective relief systems, 
            prevent thermal hazards, and comply with recognized engineering standards such as ASME BPVC, OSHA, NFPA, and ISO 45001.
        </p>
    </div>

</div>

</div>

<script>
function calculateVentTemp() {
    const fields = ["QT","G","A","Cv","mo","V","hfa","vfa"];
    let isValid = true;
    let inputs = {};
    let feedbackMessages = [];

    // Collect inputs and validate
    fields.forEach(id => {
        const val = parseFloat(document.getElementById(id).value);
        inputs[id] = val;

        // Mandatory + positive check
        if (isNaN(val) || val <= 0) {
            feedbackMessages.push(`❌ ${id} must be a positive number.`);
            isValid = false;
        }

        // Industry-specific upper bounds
        if (id === "QT" && val > 100000) feedbackMessages.push(`⚠️ Qₜ seems unusually high (>100,000 kJ/min).`);
        if (id === "G" && val > 50) feedbackMessages.push(`⚠️ Mass flux G unusually high (>50 kg/m²s).`);
        if (id === "A" && val > 50) feedbackMessages.push(`⚠️ Vent area A unusually large (>50 m²).`);
        if (id === "Cv" && val > 10) feedbackMessages.push(`⚠️ Specific heat Cv unusually high (>10 kJ/kgK).`);
        if (id === "m0" && val > 50000) feedbackMessages.push(`⚠️ Initial mass m₀ unusually high (>50,000 kg).`);
        if (id === "V" && val > 1000000) feedbackMessages.push(`⚠️ Vessel volume V unusually high (>1,000,000 m³).`);
        if (id === "hfa" && val > 500) feedbackMessages.push(`⚠️ Latent heat hₓₐ unusually high (>500 kJ/kg).`);
        if (id === "vfa" && val > 10) feedbackMessages.push(`⚠️ Specific volume vₓₐ unusually high (>10 m³/kg).`);
    });

    // Cross-field logical checks
    if (inputs["mo"] / inputs["V"] > 2000) feedbackMessages.push("⚠️ m₀/V ratio exceeds realistic density (>2000 kg/m³).");
    if ((inputs["mo"]*inputs["QT"]) / (inputs["V"]*inputs["G"]*inputs["A"]*inputs["hfa"]) <= 0) feedbackMessages.push("❌ Check inputs: log argument invalid or negative.");

    const resultValue = document.getElementById("resultValue");
    const placeholder = document.getElementById("placeholder");
    const resultError = document.getElementById("resultError");
    const feedbackContent = document.getElementById("feedbackContent");

    // Hide placeholder
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    resultError.classList.add("hidden");
    feedbackContent.innerHTML = "";

    if (!isValid || feedbackMessages.length > 0) {
        resultError.innerHTML = feedbackMessages.join("<br>");
        resultError.style.color = feedbackMessages.some(msg => msg.startsWith("⚠️")) ? "orange" : "red";
        resultError.classList.remove("hidden");
        return;
    }

    // Calculation
    const {QT, G, A, Cv, mo, V, hfa, vfa} = inputs;
    const tempIncrease = (QT / (G * A * Cv)) * (Math.log((mo * QT) / (V * G * A * hfa)) - 1) + (V * hfa) / (mo * Cv * vfa);

    document.getElementById("temperatureValue").textContent = tempIncrease.toFixed(2);
    resultValue.classList.remove("hidden");

    // Feedback thresholds
    let feedback = "";
    if (tempIncrease < 10) feedback = "✅ Low Temperature Increase: Safe conditions.";
    else if (tempIncrease <= 50) feedback = "⚠️ Moderate Increase: Monitor and ensure proper venting.";
    else if (tempIncrease <= 100) feedback = "🚨 High Increase: Thermal hazard present.";
    else feedback = "🔴 Extreme Increase: Critical hazard, take emergency measures!";
    feedbackContent.style.color = (tempIncrease < 10) ? "green" : (tempIncrease <=50) ? "orange" : (tempIncrease <=100) ? "red" : "darkred";
    feedbackContent.textContent = feedback;
}


</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Input Validation Rules (QEHS & Fire Safety Perspective)
Input	Units	Recommended Range	Allowed Decimals	Rationale / Compliance Notes
Qₜ (Constant External Heat Input)	kJ/min	0 < Qₜ ≤ 100,000	Up to 2 decimals	Represents external fire/heat source. Must be positive. Excessively high values are unrealistic in chemical plants. Ensures realistic thermal hazard evaluation.
G (Mass Flux)	kg/m²·s	0 < G ≤ 50	Up to 4 decimals	Indicates mass flow through vent. Must be positive. Extremely high flux may indicate unit inconsistency. Compliance ensures accurate venting calculations.
A (Vent Area)	m²	0 < A ≤ 50	Up to 3 decimals	Vent area must be positive. Large industrial vents rarely exceed this. Validates realistic relief design.
Cᵥ (Specific Heat)	kJ/kg·K	0 < Cv ≤ 10	Up to 2 decimals	Positive and realistic substance properties. Avoids unphysical results.
m₀ (Initial Mass)	kg	0 < m₀ ≤ 50,000	Up to 2 decimals	Must reflect the actual vessel fill. Too high mass may indicate input unit errors.
V (Volume)	m³	0 < V ≤ 1,000,000	Up to 2 decimals	Vessel size must be positive. Ensures logical consistency between volume and mass.
hₓₐ (Latent Heat of Vaporization)	kJ/kg	0 < hfa ≤ 500	Up to 2 decimals	Must be positive. Excessive values are unrealistic. Critical for calculating cooling effect.
vₓₐ (Specific Volume)	m³/kg	0 < vfa ≤ 10	Up to 3 decimals	Positive value ensures valid density calculations.
Logical / Cross-field Validations	-	-	-	Ensure (m₀ / V) realistic (not > 2, implying unphysical density). Check QT / (G*A*Cv) does not cause division by zero.
2. Output Validation Logic and Thresholds
Output	Threshold	Interpretation
Temperature Increase (ΔT)	< 10 K	✅ Low – Safe, minimal thermal risk
10 – 50 K	⚠️ Moderate – Monitor, ensure proper venting	
50 – 100 K	🚨 High – Thermal hazard present, action required	
> 100 K	🔴 Extreme – Critical hazard, emergency procedures needed	

Compliance Note: These thresholds align with process safety guidelines (NFPA 30, API RP 521, OSHA PSM), which recommend assessing thermal hazards and designing relief systems based on realistic temperature rise.

3. Edge Case Validations

Division by zero: Ensure G > 0, A > 0, Cv > 0, mo > 0, vfa > 0.

Logarithm domain: Ensure (mo*QT) / (V*G*A*hfa) > 0. Negative or zero values would produce NaN.

Density checks: m₀ / V must not exceed physical limits (~2,000 kg/m³ for liquids).

Unrealistic combinations: Extremely high Qₜ with small G, A, or Cv → could produce huge ΔT; warn users.

Empty vessel scenario: mo → 0 is invalid (cannot vent nothing).

Physical limits: Ensure vfa realistic for liquid or vapor (~0.001–10 m³/kg). -->