{% extends 'base.html' %}
{% block title %}Sprinkler Flow Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

 <div class="calculator-container printable" id="printArea">
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Sprinkler Flow Rate Calculator</h1>
            <p>Calculate the required sprinkler flow (Q) from Coverage Area (A) and Flow Density (D).</p>
        </div>

        <div class="calc-content">
            <!-- Input Card -->
            <div class="calc-card">
                <h2>Enter Data</h2>

                <div class="form-group">
                    <label for="coverageArea">Coverage Area (A) ‚Äî m¬≤ or ft¬≤</label>
                    <input type="number" id="coverageArea" class="form-input" placeholder="Enter Coverage Area (e.g., 100)">
                </div>

                <div class="form-group">
                    <label for="flowDensity">Flow Density (D) ‚Äî L/min/m¬≤ or GPM/ft¬≤</label>
                    <input type="number" id="flowDensity" class="form-input" placeholder="Enter Flow Density (e.g., 6.9)">
                </div>

                <button class="calculate-btn" onclick="calculateFlowRate()">Calculate Flow Rate</button>
            </div>

            <!-- Result Card -->
            <div class="result-card">
                <!-- Placeholder -->
                <div class="result-placeholder" id="placeholder">
                    <img src="{% static 'images/sprinkler.jpg' %}" alt="Sprinkler Illustration">
                    <p>This tool will calculate the <strong>Sprinkler Flow Rate (Q)</strong>. Enter your data to see results and guidance here.</p>
                </div>

                <!-- Error -->
                <div class="result-error hidden" id="resultError" style="font-size: 22px;"></div>

                <!-- Result -->
                <div class="result-value hidden" id="resultValue">
                    <div class="rate-value">Sprinkler Flow Rate</div>
                    <div class="rate-value" id="flowRateValue">0.00</div>
                    <div class="rate-label" style="font-size:16px; font-weight:bold;">L/min (or GPM) ‚Äî total discharge</div>

                    <div class="result-feedback" id="feedbackContent"></div>

                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
           <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
        This calculator is designed to help determine how much water a sprinkler system must deliver to protect a given area.  
        Fire sprinklers are carefully planned so that every part of a building or space receives enough water during an emergency.  
        The required flow rate depends on how large the area is and how much water per unit of area is needed to effectively control or put out a fire.  
    </p>
    <p>
        By entering the coverage area and the required water density, the calculator quickly provides the total water flow that should be supplied.  
        This makes it easier for designers, engineers, and safety professionals to plan sprinkler systems that meet fire safety standards and ensure reliable protection.
    </p>
</div>

            <div class="note-card">
                <h3>‚öôÔ∏è Parameters</h3>
                <ul class="note-list">
                    <li><strong>Coverage Area (A):</strong> Total area protected by the sprinkler (m¬≤ or ft¬≤).</li>
                    <li><strong>Flow Density (D):</strong> Required discharge per unit area (L/min/m¬≤ or GPM/ft¬≤).</li>
                    <li><strong>Sprinkler Flow Rate (Q):</strong> Total required flow; Q = A √ó D.</li>
                </ul>
            </div>
      <div class="note-card">
    <h3>üéØ Why This Matters</h3>
    <p>
        Knowing the correct sprinkler flow rate is essential for both safety and system efficiency.  
        If the flow rate is too low, the sprinkler system may not control or suppress a fire effectively, putting lives and property at risk.  
        If the flow rate is too high, it can lead to unnecessary water demand, oversized pumps, and higher costs for the system.  
    </p>
    <p>
        By calculating the right flow rate, safety professionals can:
    </p>
    <ul>
        <li>Ensure compliance with local and international fire safety regulations.</li>
        <li>Design sprinkler systems that provide reliable protection in case of fire.</li>
        <li>Avoid over-design that increases water usage and installation costs.</li>
        <li>Plan for the correct water supply and pumping capacity.</li>
    </ul>
</div>

           <div class="note-card">
    <h3>üí° Interpretation</h3>
    <ul class="note-list">
        <li>‚úÖ <strong>Low Flow:</strong> Usually corresponds to <em>Light Hazard Occupancies</em> (e.g., offices, schools, residential). 
            Flow densities around 2‚Äì4 L/min/m¬≤ (0.1‚Äì0.15 GPM/ft¬≤) are common. Always confirm with NFPA/IS codes.</li>
        <li>‚ö†Ô∏è <strong>Moderate Flow:</strong> Typical for <em>Ordinary Hazard Groups</em> (e.g., retail, workshops, warehouses with limited combustibles). 
            Flow densities in the 4‚Äì10 L/min/m¬≤ (0.15‚Äì0.25 GPM/ft¬≤) range are expected.</li>
        <li>üö® <strong>High Flow:</strong> Required for <em>Extra Hazard or Storage Occupancies</em> (e.g., chemical plants, high-piled storage, flammable liquids). 
            Flow densities >10 L/min/m¬≤ (0.25 GPM/ft¬≤ and above) require larger water supplies, special pumps, and storage tanks.</li>
        <li>üî¥ <strong>Very High Flow:</strong> Flows above typical code tables. These require <em>engineering review, hydraulic calculations, and AHJ approval</em>.</li>
    </ul>
</div>

<div class="note-card">
    <h3>üõ°Ô∏è Input Validations</h3>
    <ul class="note-list">
        <li>All input fields are <strong>mandatory</strong> before calculation.</li>
        <li>Only <strong>numeric values</strong> are accepted (no text, symbols, or empty values).</li>
        <li>Coverage Area (A) must be <strong>&gt; 0</strong> and realistically between <strong>1 m¬≤ and 10,000 m¬≤</strong> (10‚Äì100,000 ft¬≤). 
            Larger inputs will trigger a <em>unit verification warning</em>.</li>
        <li>Flow Density (D) must be <strong>&gt; 0</strong> and typically between 
            <strong>2‚Äì20 L/min/m¬≤</strong> (0.1‚Äì0.5 GPM/ft¬≤). Values outside this range will trigger <em>validation or caution</em>.</li>
        <li>Extremely large inputs (A &gt; 1,000,000 m¬≤ or D &gt; 10,000 L/min/m¬≤) will be flagged as <strong>invalid</strong> 
            since they are unrealistic in practice.</li>
        <li>Decimals are allowed up to <strong>two places</strong> for accuracy (e.g., 6.90 L/min/m¬≤).</li>
        <li>Cross-check: If Q (A √ó D) &gt; 100,000 L/min (26,400 GPM), display a <strong>system feasibility warning</strong> 
            since very high flows require specialized design.</li>
    </ul>
</div>


           
        </div>
    </div>

<script>
function calculateFlowRate() {
    const areaInput = document.getElementById('coverageArea').value.trim();
    const densityInput = document.getElementById('flowDensity').value.trim();
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');
    const flowRateValue = document.getElementById('flowRateValue');

    // Reset UI
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Empty check
    if (areaInput === "" || densityInput === "") {
        resultError.innerHTML = "‚ö†Ô∏è Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    let A = parseFloat(areaInput);
    let D = parseFloat(densityInput);

    // Numeric & Range Validation
    if (isNaN(A) || isNaN(D)) {
        resultError.innerHTML = "‚ùå Invalid entry. Numbers only.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (A <= 0) {
        resultError.innerHTML = "‚ùå Coverage Area must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (D <= 0) {
        resultError.innerHTML = "‚ùå Flow Density must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Area validation (realistic range)
    if (A < 1) {
        resultError.innerHTML = "‚ö†Ô∏è Very small coverage area (<1 m¬≤). Verify input.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (A > 10000) {
        resultError.innerHTML = "‚ö†Ô∏è Extremely large coverage area (>10,000 m¬≤). Verify units.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Density validation (realistic range)
    if (D < 1.0) {
        resultError.innerHTML = "‚ö†Ô∏è Flow Density is below 1.0. May not satisfy fire codes.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (D > 20.0) {
        resultError.innerHTML = "‚ö†Ô∏è Very high Flow Density (>20). Verify hazard class.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Calculation
    const Q = A * D;

    // Cross-field validation
    if (Q > 50000) {
        resultError.innerHTML = "üî¥ Extremely high demand (>50,000 L/min). Confirm hazard classification and system design.";
        resultError.style.color = "darkred";
        resultError.classList.remove('hidden');
        return;
    }

    // Display result
    flowRateValue.innerText = Q.toFixed(2);
    resultValue.classList.remove('hidden');

    // Feedback by hazard demand ranges
    let feedback = "";
    if (Q < 100) {
        feedback = "‚ùå Too low. Likely insufficient for fire protection. Check values.";
        feedbackContent.style.color = "red";
    } else if (Q <= 2000) {
        feedback = "‚úÖ Suitable for Light Hazard / small systems.";
        feedbackContent.style.color = "green";
    } else if (Q <= 10000) {
        feedback = "‚ö†Ô∏è Typical for Ordinary Hazard occupancies. Ensure adequate mains/pump.";
        feedbackContent.style.color = "orange";
    } else if (Q <= 50000) {
        feedback = "üö® High flow demand (Extra Hazard / storage). Strong water supply required.";
        feedbackContent.style.color = "red";
    }
    feedbackContent.innerHTML = feedback;
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Input Analysis (Real-World Perspective)

Your calculator uses two critical inputs:

Coverage Area (A):

Represents the floor area covered by sprinklers.

Normally defined by NFPA 13 and ISO 6182, with typical design areas ranging from 140 m¬≤ to 465 m¬≤ for most occupancies.

Extremely large inputs (like 1,000,000 m¬≤) are usually either wrong units or an unrealistic scenario.

Flow Density (D):

Expresses discharge per unit area.

NFPA 13 specifies densities between 2.0‚Äì12.0 L/min/m¬≤ (or 0.05‚Äì0.30 GPM/ft¬≤), depending on hazard classification (Light, Ordinary, Extra Hazard).

Anything above 20 L/min/m¬≤ (0.5 GPM/ft¬≤) is generally excessive unless it‚Äôs a storage/warehouse or special hazard.

Output (Q = A √ó D):

Represents the total sprinkler system demand (L/min or GPM).

This is directly tied to pump sizing, water storage, and mains supply capacity.

Needs to be presented in a way that auditors and inspectors can use in compliance reports.

2. Comprehensive Validation Rules
Coverage Area (A):

Mandatory, numeric only.

Minimum: 1 m¬≤ (or 10 ft¬≤).

Maximum: 10,000 m¬≤ for standard occupancy design; beyond this requires warning (‚Äúverify unit or hazard class‚Äù).

Allow 1 decimal place for partial areas.

Reject negative/zero values.

Flow Density (D):

Mandatory, numeric only.

Minimum: 1.0 L/min/m¬≤ (0.025 GPM/ft¬≤).

Maximum: 20 L/min/m¬≤ (0.5 GPM/ft¬≤). Values beyond this should trigger a warning.

Allow up to 2 decimals for precision.

Reject negative/zero values.

Cross-field logic:

If A is very small (<10 m¬≤) but D is very high (>15 L/min/m¬≤), trigger warning: ‚ÄúInputs appear mismatched to realistic hazard classes.‚Äù

If A √ó D (Q) > 50,000 L/min (13,200 GPM), trigger warning: ‚ÄúExtremely high demand ‚Äî check units and hazard classification.‚Äù

3. Edge Case Validations

Empty fields: Show mandatory error.

Zero or negative values: Invalid.

Unrealistic small input (e.g., A=0.1 m¬≤): Warn user.

Huge mismatches: A=1,000,000 m¬≤ & D=5 ‚Üí system demand impossible ‚Üí show caution.

Decimal handling: Round coverage area to 1 decimal, density to 2 decimals, result to 2 decimals.

4. Output Validation (Meaningful Thresholds)

Based on NFPA hazard classes:

Q < 100 L/min (25 GPM): Likely too low ‚Üí warn ‚Äúmay not meet any hazard class.‚Äù

100‚Äì2000 L/min (25‚Äì530 GPM): Light hazard / small system typical.

2000‚Äì10,000 L/min (530‚Äì2650 GPM): Ordinary Hazard, medium facilities.

10,000‚Äì50,000 L/min (2650‚Äì13,200 GPM): Extra Hazard / storage; needs strong pumping.

>50,000 L/min: Unrealistic or very large industrial sites ‚Üí must validate with engineering review. -->