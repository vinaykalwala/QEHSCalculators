{% extends 'base.html' %}
{% block title %}Fire Hazard Risk Calculation (Fire Load Density){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
      

        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 480px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

        /* Table styles */
        .custom-table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .custom-table thead {
            background-color: #1560bd;
            color: white;
        }
        .custom-table th, .custom-table td {
            padding: 12px 16px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .custom-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .back-btn {
            background: linear-gradient(#1560bd,#000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'firecategory_calculators'%}" class="back-btn">Back To Fire Calculators</a>
    </div>


   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

       <div class="calculator-header">
    <h1>Fire Hazard Risk Calculator (Fire Load Density)</h1>
    <p>Calculate Fire Load Density (FLD) to assess workplace fire safety risk.</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Data</h2>
        
        <div class="form-group">
            <label for="numMaterials">Number of Combustible Materials:</label>
            <input type="number" id="numMaterials" class="form-input" min="1" placeholder="e.g., 3">
            <button class="calculate-btn" onclick="generateMaterialInputs()">Set Materials</button>
        </div>

        <div id="materialInputs"></div>

        <div class="form-group">
            <label for="floorArea">Total Floor Area (m¬≤):</label>
            <input type="number" id="floorArea" class="form-input" min="1" placeholder="e.g., 500">
        </div>
        
        <button class="calculate-btn" onclick="calculateFLD()">Calculate Fire Load Density</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="{% static 'images/flame.png' %}" alt="Fire Safety illustration">
            <p>This tool will calculate the <strong>Fire Load Density (FLD)</strong>. Enter your data to see results and insights here.</p>
        </div>
        
        <div class="result-error hidden" id="resultError">
            <div class="error-icon">‚ùå</div>
            <div class="error-message" id="errorMessage"></div>
        </div>
         
        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#bd1515;">
                <h2>Fire Load Density Result</h2>
            </div>
            <div class="rate-value" id="fldValue">0.00</div>
            <div class="rate-label">MJ per m¬≤ of floor area</div>

            <div class="safety-meter">
                <div class="meter-fill" id="meterFill"></div>
            </div>
            <div class="meter-labels">
                <span>Low</span><span>Moderate</span><span>High</span><span>Extreme</span>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Fire Safety Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>
            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
    <!-- About -->
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            The <strong>Fire Load Density (FLD) Calculator</strong> estimates the 
            <strong>potential fire hazard risk</strong> in a building or compartment. 
            It calculates the amount of heat energy released per unit floor area 
            if all combustible materials were to burn.  
            This tool is widely used in <b>fire risk assessments</b>, 
            <b>audits</b>, and <b>compliance checks</b> under NFPA, ISO, and NBC guidelines. 
            The result helps safety professionals understand how intense 
            a potential fire could be in a given space.
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>‚öôÔ∏è Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Mass of Combustible Materials (kg):</strong> 
                Total weight of burnable materials (wood, paper, plastics, textiles, chemicals, etc.).</li>
            <li><strong>Heat of Combustion (MJ/kg):</strong> 
                Energy released when 1 kg of a material burns 
                (e.g., wood ‚âà 17 MJ/kg, plastics ‚âà 30 MJ/kg).</li>
            <li><strong>Floor Area (m¬≤):</strong> 
                Size of the room or facility, used to normalize the fire load to density.</li>
        </ul>
    </div>

    <!-- Input Validations -->
    <div class="note-card">
        <h3>‚úÖ Input Validation Rules</h3>
        <ul class="note-list">
            <li><b>Number of Materials:</b> 1‚Äì200 allowed. Too many entries ‚Üí possible data error.</li>
            <li><b>Mass (kg):</b> 0.001‚Äì1,000,000 kg. Warn if &gt; 100,000 kg. Must be ‚â• 0.</li>
            <li><b>Heat of Combustion (MJ/kg):</b> 5‚Äì60 MJ/kg. Warn if &lt;10 or &gt;45 (atypical values).</li>
            <li><b>Floor Area (m¬≤):</b> 1‚Äì100,000 m¬≤. Warn if &lt;5 or &gt;20,000 m¬≤.</li>
            <li><b>Precision:</b> Mass up to 3 decimals, Heat up to 2 decimals, Area up to 2 decimals.</li>
            <li><b>Cross-checks:</b> At least one material must contribute (mass √ó heat > 0). 
                Fire Load Density must ‚â§ 100,000 MJ/m¬≤ (blocks unrealistic inputs).</li>
        </ul>
        <p><em>‚ö†Ô∏è These rules prevent invalid entries, unrealistic fire loads, 
           and ensure compliance with NFPA/ISO fire safety practices.</em></p>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>üìä Output Validations</h3>
        <ul class="note-list">
            <li><span class="good">‚úÖ FLD &lt; 200 MJ/m¬≤:</span> Low Risk ‚Äî safe fire load density, minimal hazard. 
                <b> "‚úÖ Low Fire Hazard."</b></li>
            <li><span class="average">üü° 200‚Äì500 MJ/m¬≤:</span> Moderate Risk ‚Äî requires regular checks. 
                <b> "üü° Moderate Fire Hazard."</b></li>
            <li><span class="bad">‚ö†Ô∏è 500‚Äì1000 MJ/m¬≤:</span> High Risk ‚Äî strong fire prevention needed. 
                <b> "‚ö†Ô∏è High Fire Hazard!"</b></li>
            <li><span class="critical">üî• &gt;1000 MJ/m¬≤:</span> Extreme Risk ‚Äî immediate action required. 
                <b> "üî• Extreme Fire Hazard!"</b></li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>üìñ Governing Principle</h3>
        <p>
            The Fire Load Density concept is based on the principle that 
            the <b>energy stored in combustible contents</b> represents 
            the fire hazard potential of a space.  
            This is recognized in <b>NFPA 557 ‚Äì Standard for Determination of Fire Load 
            for Use in Structural Fire Protection Design</b>, 
            which provides the methodology for quantifying fire load.  
            It aligns with international practices in <b>ISO 45001</b>, <b>NFPA codes</b>, and <b>National Building Code (NBC)</b>.
        </p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>üìù Conclusion</h3>
        <p>
            The FLD Calculator helps quantify the <strong>intensity of potential fire hazard</strong> 
            in a given area. By combining the weight of combustibles, their heat of combustion, 
            and the available floor area, it provides a practical benchmark for 
            <b>fire safety design, audits, and compliance</b>.  
            Results should always be reviewed against <b>NFPA 557</b> and local codes, 
            and appropriate fire safety measures (detection, suppression, compartmentation) 
            must be adopted based on the calculated risk level.
        </p>
    </div>
</div>

<script>
// ---- Configurable constants
const LIMITS = {
  MAX_MATERIALS: 200,
  MASS: { min: 0, max: 1_000_000, typicalWarnAbove: 100_000, maxDecimals: 3 },
  HEAT: { min: 5, max: 60, typicalLow: 10, typicalHigh: 45, maxDecimals: 2 },
  AREA: { min: 1, max: 100_000, typicalLow: 5, typicalHigh: 20_000, maxDecimals: 2 },
  FLD: { warnAbove: 10_000, blockAbove: 100_000 }
};

function countDecimals(num) {
  if (!Number.isFinite(num)) return 0;
  const s = num.toString();
  if (!s.includes('.')) return 0;
  return s.replace(/0+$/, '').split('.')[1]?.length || 0;
}

function pushError(arr, msg) { arr.push(`üëâ ${msg}`); }

function generateMaterialInputs() {
  const n = parseInt(document.getElementById('numMaterials').value, 10);
  const container = document.getElementById('materialInputs');
  container.innerHTML = "";

  if (!Number.isInteger(n) || n < 1) {
    container.innerHTML = "<p>Please enter a valid number of materials (integer ‚â• 1).</p>";
    return;
  }
  if (n > LIMITS.MAX_MATERIALS) {
    container.innerHTML = `<p>Number of materials is capped at ${LIMITS.MAX_MATERIALS}.</p>`;
    return;
  }

  for (let i = 1; i <= n; i++) {
    container.innerHTML += `
      <div class="form-group">
        <h4 style="color:#f9a825;font-size:20px;margin:none">Material ${i}</h4>
        <label for="mass${i}">Mass (kg):</label>
        <input type="number" id="mass${i}" class="form-input" placeholder="Enter mass" min="0" step="0.001">
        <span class="warning-text" id="warn-mass${i}"></span>
        <label for="heat${i}">Heat of Combustion (MJ/kg):</label>
        <input type="number" id="heat${i}" class="form-input" placeholder="Enter heat value" min="0" step="0.01">
        <span class="warning-text" id="warn-heat${i}"></span>
      </div>
    `;
  }
}

function calculateFLD() {
  const numMaterials = parseInt(document.getElementById('numMaterials').value, 10);
  const floorArea = parseFloat(document.getElementById('floorArea').value);

  const errorBox = document.getElementById('resultError');
  const errorMessage = document.getElementById('errorMessage');
  const placeholder = document.getElementById('placeholder');
  const resultValue = document.getElementById('resultValue');

  let errors = [];
  let totalFireLoad = 0;

  // Reset inline warnings
  document.querySelectorAll(".warning-text").forEach(span => span.textContent = "");

  // ---- Validate numMaterials
  if (!Number.isInteger(numMaterials) || numMaterials < 1) {
    pushError(errors, "Enter a valid number of combustible materials (integer ‚â• 1).");
  } else if (numMaterials > LIMITS.MAX_MATERIALS) {
    pushError(errors, `Number of materials cannot exceed ${LIMITS.MAX_MATERIALS}.`);
  }

  // ---- Validate floor area
  if (!Number.isFinite(floorArea)) {
    pushError(errors, "Enter a valid floor area (m¬≤).");
  } else {
    if (floorArea < LIMITS.AREA.min || floorArea > LIMITS.AREA.max) {
      pushError(errors, `Floor area must be between ${LIMITS.AREA.min} and ${LIMITS.AREA.max} m¬≤.`);
    }
    if (countDecimals(floorArea) > LIMITS.AREA.maxDecimals) {
      pushError(errors, `Floor area may have at most ${LIMITS.AREA.maxDecimals} decimals.`);
    }
    if (floorArea > 0 && (floorArea < LIMITS.AREA.typicalLow || floorArea > LIMITS.AREA.typicalHigh)) {
      document.getElementById("floorArea").insertAdjacentHTML(
        "afterend",
        `<span class="warning-text">‚ÑπÔ∏è Unusual floor area: ${floorArea} m¬≤. Confirm units.</span>`
      );
    }
  }

  // ---- Validate materials
  if (errors.length === 0) {
    let hasContributingLine = false;

    for (let i = 1; i <= numMaterials; i++) {
      const massStr = document.getElementById(`mass${i}`)?.value ?? "";
      const heatStr = document.getElementById(`heat${i}`)?.value ?? "";
      const warnMass = document.getElementById(`warn-mass${i}`);
      const warnHeat = document.getElementById(`warn-heat${i}`);

      if (massStr.trim() === "" || heatStr.trim() === "") {
        pushError(errors, `Material ${i}: both Mass and Heat are required.`);
        continue;
      }

      const mass = parseFloat(massStr);
      const heat = parseFloat(heatStr);

      if (!Number.isFinite(mass) || !Number.isFinite(heat)) {
        pushError(errors, `Material ${i}: enter valid numbers.`);
        continue;
      }

      // Mass validation
      if (mass < LIMITS.MASS.min || mass > LIMITS.MASS.max) {
        pushError(errors, `Material ${i}: mass must be between ${LIMITS.MASS.min} and ${LIMITS.MASS.max} kg.`);
      }
      if (mass > LIMITS.MASS.typicalWarnAbove) {
        warnMass.textContent = `‚ö†Ô∏è Large mass (${mass} kg). Confirm kg vs tonnes.`;
      }

      // Heat validation
      if (heat < LIMITS.HEAT.min || heat > LIMITS.HEAT.max) {
        pushError(errors, `Material ${i}: heat must be between ${LIMITS.HEAT.min}‚Äì${LIMITS.HEAT.max} MJ/kg.`);
      }
      if (heat < LIMITS.HEAT.typicalLow || heat > LIMITS.HEAT.typicalHigh) {
        warnHeat.textContent = `‚ö†Ô∏è Atypical heat value: ${heat} MJ/kg. Confirm material property.`;
      }

      if (mass > 0 && heat === 0) {
        pushError(errors, `Material ${i}: heat of combustion cannot be 0 when mass > 0.`);
      }

      if (errors.length === 0) {
        const contribution = mass * heat;
        if (contribution > 0) hasContributingLine = true;
        totalFireLoad += contribution;
      }
    }

    if (!hasContributingLine) {
      pushError(errors, "At least one material must contribute (>0 MJ).");
    }
  }

  // ---- Handle errors
  if (errors.length > 0) {
    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    document.getElementById('feedbackContent').textContent = "";
    document.getElementById('fldValue').textContent = "0.00";
    document.getElementById('meterFill').style.width = "0%";
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    return;
  } else {
    errorBox.classList.add("hidden");
    errorMessage.innerHTML = "";
  }

  // ---- Calculate FLD
  const fld = totalFireLoad / floorArea;

  if (!Number.isFinite(fld) || fld < 0) {
    errorMessage.innerHTML = "‚ùå Invalid calculation result.";
    errorBox.classList.remove("hidden");
    resultValue.classList.add("hidden");
    return;
  }

  document.getElementById('fldValue').textContent = fld.toFixed(2);

  // ---- Safety Meter
  const meterFill = document.getElementById('meterFill');
  let meterWidth, meterColor, feedback;

  if (fld > 1000) {
    meterWidth = '95%'; meterColor = '#e74c3c';
    feedback = 'üî• Extreme Fire Hazard!';
  } else if (fld > 500) {
    meterWidth = '75%'; meterColor = '#e67e22';
    feedback = '‚ö†Ô∏è High Fire Hazard!';
  } else if (fld > 200) {
    meterWidth = '50%'; meterColor = '#f1c40f';
    feedback = 'üü° Moderate Fire Hazard.';
  } else {
    meterWidth = '25%'; meterColor = '#2ecc71';
    feedback = '‚úÖ Low Fire Hazard.';
  }

  meterFill.style.width = meterWidth;
  meterFill.style.backgroundColor = meterColor;
  document.getElementById('feedbackContent').textContent = feedback;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
}

function printReport() {
  window.print();
}
</script>

<style>
.warning-text {
  display: block;
  font-size: 14px;
  color: orange;
  margin-top: 2px;
}
</style>



        <script src="{% static 'js/print.js' %}"></script>


</body>
</html>
{% endblock %}

<!-- 1) Expert analysis of inputs, outputs & calculation (QEHS perspective)

Inputs you capture (good):

Number of materials ‚Üí drives dynamic rows.

Per-material Mass (kg) and Heat of combustion (MJ/kg) ‚Üí the core contributors to total fire load.

Floor area (m¬≤) ‚Üí normalizes the fire load to density.

What matters in practice:

Units must be strict (kg, MJ/kg, m¬≤) and consistently used.

Ranges must be realistic or flagged (e.g., heat of combustion for common combustibles typically ~10‚Äì45 MJ/kg; some plastics/solvents can go higher).

Completeness: zero/blank values silently degrade accuracy. In audits, incomplete lines invalidate the KPI.

Normalization: division by floor area cannot be zero or ‚Äútiny‚Äù in a way that produces absurd densities.

Interpretation: result classes (Low/Moderate/High/Extreme) should be clear, and you should warn that thresholds can vary by local code/insurer/internal standard.

2) Comprehensive input validation rules (industry-aligned)

Below are strong defaults you can enforce. Values outside typical should either be blocked (hard error) or allowed with a warning.

A) Number of Materials (numMaterials)

Type: integer.

Required: yes.

Allowed: 1‚Äì200 (hard cap to prevent UI abuse/performance issues).

Why: excessive rows increase data-entry error; 200 is generous for most inventories.

B) Mass per material (kg)

Type: number (allow decimals).

Required: yes (for each row).

Range (hard): 0 ‚â§ mass ‚â§ 1,000,000 kg (block negatives; block extreme fantasy values).

Range (typical-warning): warn if mass > 100,000 kg per line.

Decimals: up to 3 decimal places (audit-friendly but avoids noise).

Unit: kilograms only (no tonnes; if user wants t, they must convert).

Cross-field: if mass > 0 then heat must be > 0.

C) Heat of combustion per material (MJ/kg)

Type: number (decimals allowed).

Required: yes.

Range (hard): 5 ‚â§ heat ‚â§ 60 MJ/kg (block 0/negatives; cap at 60 to avoid unit errors).

Range (typical-warning): warn if outside 10‚Äì45 MJ/kg.

Decimals: up to 2 decimal places.

Cross-field: if heat > 0 and mass = 0, allow but warn about material line contributing 0 MJ (data quality).

D) Floor area (m¬≤)

Type: number (decimals allowed).

Required: yes.

Range (hard): 1 ‚â§ area ‚â§ 100,000 m¬≤.

Range (typical-warning): warn if area < 5 m¬≤ or area > 20,000 m¬≤.

Decimals: up to 2 decimal places.

Cross-field: if the sum of masses > 0 then area must be > 0 (and not ‚Äútiny‚Äù creating absurd density).

E) Cross-field & logical consistency (very important)

At least one contributing line: sum(mass √ó heat) must be > 0.

Missing pairs: each material line must have both mass and heat filled; partial entries should error (not silently treated as 0).

Outliers on density:

Warn if FLD > 10,000 MJ/m¬≤ (extremely high‚Äîcheck inputs/units).

Block if FLD > 100,000 MJ/m¬≤ (almost certainly a unit/data error).

3) Edge-case validations

Division by zero: floorArea = 0 ‚Üí hard error.

All masses zero or all heats zero ‚Üí hard error (‚Äúno combustible load provided‚Äù).

Negative values anywhere ‚Üí hard error.

Non-integers for numMaterials ‚Üí hard error (coerce? better to block).

Empty/whitespace fields ‚Üí hard error per field.

Scientific notation or extremely long decimals ‚Üí allow parsing but enforce the decimal-place rule; round after validation.

Mismatched units (e.g., user typed tons but field is kg): can‚Äôt auto-detect; provide a warning template (‚ÄúLarge value‚Äîconfirm units are in kg‚Äù).

GPU-tier inputs: extremely many rows ‚Üí capped by MAX_MATERIALS.

4) Output validation & thresholds (real-world use)

Your classes are practical and readable (keep them), with this compliance note:

Low: < 200 MJ/m¬≤ ‚Üí generally acceptable risk; routine controls.

Moderate: 200‚Äì500 MJ/m¬≤ ‚Üí targeted housekeeping/storage controls; review ignition controls.

High: 500‚Äì1000 MJ/m¬≤ ‚Üí strong prevention & suppression; compartmentation/material reduction plans.

Extreme: > 1000 MJ/m¬≤ ‚Üí immediate action; engineering redesign/automatic suppression/storage limits.

Compliance note: Thresholds vary by jurisdiction/insurer/industry. Expose them as configurable constants so you can tune to NFPA/local building code/internal QHSE standard.

Also show in the report:

Inputs echo (so the audit record is reproducible).

Rounding: display FLD to 2 decimals; keep internal calc in full double precision, round only for display. -->