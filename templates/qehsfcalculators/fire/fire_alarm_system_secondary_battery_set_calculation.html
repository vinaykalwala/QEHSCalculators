{% extends 'base.html' %}
{% block title %}Fire Alarm System Secondary Battery -Set Calculation{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 30px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
.image-container {
    text-align: center;           /* Center image horizontally */
    margin: 20px auto;            /* Space above and below */
    padding: 10px;                /* Inner spacing */
    background: #f9f9f9;          /* Light background */
    border: 1px solid #ddd;       /* Subtle border */
    border-radius: 12px;          /* Smooth rounded corners */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Soft shadow */
    max-width: 1100px;             /* Prevents image from stretching too wide */
}

.responsive-image {
    max-width: 100%;              /* Make image scale responsively */
    height: auto;                 /* Keep aspect ratio */
    border-radius: 8px;           /* Slight rounding for the image */
    display: block;               /* Removes inline gaps */
    margin: 0 auto;               /* Ensures centering */
}

    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Fire Alarm System Secondary Battery -Set Calculation</h1>
        <p>Estimate the required secondary battery capacity for fire alarm systems based on NFPA 72 standby and alarm requirements.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="standbyCurrent">Total Standby Current (Amps)</label>
                <input type="number" id="standbyCurrent" class="form-input" placeholder="Enter standby current">
            </div>
            <div class="form-group">
                <label for="alarmCurrent">Total Alarm Current (Amps)</label>
                <input type="number" id="alarmCurrent" class="form-input" placeholder="Enter alarm current">
            </div>
            <div class="form-group">
                <label for="standbyTime">Standby Time (Hours) [NFPA 72]</label>
                <input type="number" id="standbyTime" class="form-input" value="24">
            </div>
            <div class="form-group">
                <label for="alarmTime">Alarm Time (Hours) [NFPA 72]</label>
                <input type="number" id="alarmTime" class="form-input" value="0.083">
            </div>
            <div class="form-group">
                <label for="safetyFactor">Safety Factor (Default: 1.2)</label>
                <input type="number" id="safetyFactor" class="form-input" value="1.2" step="0.1">
            </div>
            <button class="calculate-btn" onclick="calculateBatteryBackup()">Calculate Battery Capacity</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Battery Calculation Illustration">
                <p>This tool will calculate the <strong>Battery Capacity</strong>. Enter your data to see results and insights here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 22px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Battery Capacity Results</div>
                <div class="rate-value" id="batteryCapacityValue">0.00</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">Ampere-hours (Ah)</div>

                <!-- Detailed Breakdown -->
                <div class="capacity-details" id="capacityDetails"></div>

                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
<div class="note-section">

    <!-- 1. About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This <strong>Battery Backup Calculator</strong> estimates the required battery capacity for a fire alarm system, considering standby current, alarm current, standby time, alarm time, and a safety factor. 
            It ensures the system operates reliably and meets NFPA 72 requirements.
        </p>
    </div>

    <!-- 2. Parameters / Key Inputs -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Total Standby Current (Amps):</strong> Current drawn by devices in standby mode.</li>
            <li><strong>Total Alarm Current (Amps):</strong> Current drawn during alarm activation.</li>
            <li><strong>Standby Time (Hours):</strong> Default 24 h per NFPA 72.</li>
            <li><strong>Alarm Time (Hours):</strong> Default 0.083 h (5 min) per NFPA 72.</li>
            <li><strong>Safety Factor:</strong> Multiplier to account for aging, temperature effects, and uncertainties (default 1.2).</li>
        </ul>
    </div>

     <div class="note-card">
            <h3>📑 Fire Alarm System Secondary Battery -Set Calculation Sheet</h3>
            
        </div>
          <div class="image-container">
                <img src="{% static 'images/secondbattery.png' %}" alt="Leakage Calculation Image" class="responsive-image">
            </div>


    <!-- 3. Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>All fields are <strong>mandatory</strong> and must be numeric.</li>
            <li><strong>Standby Current:</strong> 0.01 – 50 A. Below or above triggers warnings/errors.</li>
            <li><strong>Alarm Current:</strong> 0.1 – 100 A. Must generally be ≥ standby current; otherwise, a warning is displayed.</li>
            <li><strong>Standby Time:</strong> 8 – 72 h; default 24 h per NFPA 72.</li>
            <li><strong>Alarm Time:</strong> 0.05 – 0.5 h; default 0.083 h per NFPA 72.</li>
            <li><strong>Safety Factor:</strong> 1.1 – 1.5. Values outside this range are rejected.</li>
            <li>Cross-field logic: Standby current > Alarm current triggers a warning, but calculation proceeds.</li>
        </ul>
    </div>

    <!-- 4. Output Validations & Feedback -->
    <div class="note-card">
        <h3>⚡ Output Validations</h3>
        <ul class="note-list">
            <li>&lt; 7 Ah → 🔴 Insufficient Capacity: Below minimum NFPA 72 requirements.</li>
            <li>7 – 20 Ah → ⚠️ Borderline Capacity: Meets NFPA minimum, but larger capacity recommended for reliability.</li>
            <li>&gt; 20 Ah → ✅ Sufficient Capacity: Fully compliant for typical commercial fire alarm panels.</li>
            <li>Feedback messages are dynamic and reflect the assessment along with the computed value.</li>
        </ul>
    </div>

    <!-- 5. Governing Principle -->
   <!-- Governing Principle -->
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        The “–Set” calculation for a fire alarm system’s secondary battery is governed by standards that define the required 
        standby and alarm operation durations to ensure uninterrupted performance during power loss.  
        These requirements are primarily defined by <strong>NFPA 72</strong> in the United States, 
        <strong>BS 5839-1</strong> in the United Kingdom, and <strong>IS 15908</strong> and <strong>IS 2189</strong> in India.  
        The calculation ensures that the backup battery provides sufficient capacity for <strong>24 hours of standby</strong> 
        followed by <strong>5–15 minutes of alarm function</strong>, depending on the system type and standard applied.
    </p>
    <p>
        <strong>Standard:</strong>  
        The following standards specify the framework for determining total battery capacity and ensuring compliance:  
        <ul class="note-list">
            <li><strong>NFPA 72 (U.S.):</strong> Mandates 24 hours of standby power and 5 minutes (notification) or 15 minutes (voice systems) of alarm operation.</li>
            <li><strong>BS 5839-1 (U.K.):</strong> Provides design guidance for calculating standby periods and selecting battery capacity for alarm systems.</li>
            <li><strong>IS 15908 (India):</strong> Covers the selection, installation, and maintenance of control and indicating equipment for fire alarm systems.</li>
            <li><strong>IS 2189 (India):</strong> Defines fire detection and alarm system installation practices, incorporating power and battery requirements.</li>
        </ul>
    </p>
    <p>
        Related concept:  
        The “–Set” represents the complete backup battery system designed to maintain operational integrity during both standby and alarm conditions.  
        By considering device current draws, total standby and alarm currents, safety margins, and aging factors,  
        this calculation ensures reliability and compliance with global fire protection standards such as NFPA, BS, and IS frameworks.
    </p>
</div>


    <!-- 6. Conclusion -->
    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <ul class="note-list">
            <li>Calculates battery capacity compliant with NFPA 72.</li>
            <li>Provides real-time feedback with thresholds and warnings based on calculated capacity.</li>
            <li>Considers safety factors, cross-field logic, and real-world constraints.</li>
            <li>Ensures safe, reliable, and cost-effective fire alarm system design.</li>
        </ul>
    </div>

</div>

<script>
function calculateBatteryBackup() {
    const standbyCurrentInput = document.getElementById("standbyCurrent").value.trim();
    const alarmCurrentInput = document.getElementById("alarmCurrent").value.trim();
    const standbyTimeInput = document.getElementById("standbyTime").value.trim();
    const alarmTimeInput = document.getElementById("alarmTime").value.trim();
    const safetyFactorInput = document.getElementById("safetyFactor").value.trim();

    const resultValue = document.getElementById("resultValue");
    const placeholder = document.getElementById("placeholder");
    const feedbackContent = document.getElementById("feedbackContent");
    const resultError = document.getElementById("resultError");
    const detailsBox = document.getElementById("capacityDetails");

    // Reset UI
    resultError.classList.add("hidden");
    resultValue.classList.add("hidden");
    placeholder.classList.add("hidden");
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";
    detailsBox.innerHTML = "";

    // Empty fields check
    if (!standbyCurrentInput || !alarmCurrentInput || !standbyTimeInput || !alarmTimeInput || !safetyFactorInput) {
        resultError.innerHTML = "❌ All fields are mandatory and must be numeric.";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }

    // Parse inputs
    const standbyCurrent = parseFloat(standbyCurrentInput);
    const alarmCurrent = parseFloat(alarmCurrentInput);
    const standbyTime = parseFloat(standbyTimeInput);
    const alarmTime = parseFloat(alarmTimeInput);
    const safetyFactor = parseFloat(safetyFactorInput);

    // Numeric check
    if ([standbyCurrent, alarmCurrent, standbyTime, alarmTime, safetyFactor].some(v => isNaN(v))) {
        resultError.innerHTML = "❌ All fields are mandatory and must be numeric.";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }

    // Range validations
    if (standbyCurrent < 0.01 || standbyCurrent > 50) {
        resultError.innerHTML = "⚠️ Standby Current: 0.01 – 50 A. Below or above triggers warnings/errors.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    if (alarmCurrent < 0.1 || alarmCurrent > 100) {
        resultError.innerHTML = "⚠️ Alarm Current: 0.1 – 100 A. Must generally be ≥ standby current; otherwise, a warning is displayed.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    if (standbyTime < 8 || standbyTime > 72) {
        resultError.innerHTML = "⚠️ Standby Time: 8 – 72 h; default 24 h per NFPA 72.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    if (alarmTime < 0.05 || alarmTime > 0.5) {
        resultError.innerHTML = "⚠️ Alarm Time: 0.05 – 0.5 h; default 0.083 h per NFPA 72.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    if (safetyFactor < 1.1 || safetyFactor > 1.5) {
        resultError.innerHTML = "⚠️ Safety Factor: 1.1 – 1.5. Values outside this range are rejected.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    // Cross-field warning
    if (standbyCurrent > alarmCurrent) {
        resultError.innerHTML = "⚠️ Standby current > Alarm current triggers a warning, but calculation proceeds.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
    }

    // Calculation
    const standbyCapacity = standbyCurrent * standbyTime;
    const alarmCapacity = alarmCurrent * alarmTime;
    const totalCapacity = standbyCapacity + alarmCapacity;
    const adjustedCapacity = totalCapacity * safetyFactor;

    // Display value
    document.getElementById("batteryCapacityValue").innerText = adjustedCapacity.toFixed(2);
    resultValue.classList.remove("hidden");

    // Detailed breakdown
    detailsBox.innerHTML = `
<p><strong>Standby Capacity:</strong> ${standbyCapacity.toFixed(2)} Ah</p>
<p><strong>Alarm Capacity:</strong> ${alarmCapacity.toFixed(2)} Ah</p>
<p><strong>Total Capacity:</strong> ${totalCapacity.toFixed(2)} Ah</p>
<p><strong>Adjusted Capacity (with Safety Factor):</strong> ${adjustedCapacity.toFixed(2)} Ah</p>
    `;

    // Feedback based on thresholds
    if (adjustedCapacity < 7) {
        feedbackContent.innerHTML = "🔴 Insufficient Capacity: Below minimum NFPA 72 requirements.";
        feedbackContent.style.color = "red";
    } else if (adjustedCapacity <= 20) {
        feedbackContent.innerHTML = "⚠️ Borderline Capacity: Meets NFPA minimum, but larger capacity recommended for reliability.";
        feedbackContent.style.color = "orange";
    } else {
        feedbackContent.innerHTML = "✅ Sufficient Capacity: Fully compliant for typical commercial fire alarm panels.";
        feedbackContent.style.color = "green";
    }
}

function printReport() {
    window.print();
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Input Validation Rules (QEHS/Fire Safety aligned)
Standby Current (Amps)

Range: 0.01 – 50 A

Typical fire alarm panels: 0.2–2 A.

Large systems: up to 10–15 A.

Anything above 50 A should be flagged as unrealistic for DC fire alarm loads.

Decimals: Allow up to 3 decimals (milliamp precision).

Units: Must always be entered in Amperes (A).

Alarm Current (Amps)

Range: 0.1 – 100 A

Horn/strobe loads are higher, but rarely >50 A in most facilities.

Decimals: Up to 3 decimals.

Cross-field rule: Alarm current must be ≥ standby current (if standby > alarm, warn user — unusual unless very light NAC load).

Standby Time (Hours)

Default (NFPA 72): 24 hours.

Range: 8 – 72 hours.

8 hours is sometimes used in non-UL jurisdictions.

Extended mission-critical sites may require >24 h.

Alarm Time (Hours)

Default (NFPA 72): 0.083 h (5 minutes).

Range: 0.05 – 0.5 h (3 – 30 minutes).

Above 0.5 h is unrealistic for fire alarm notification appliances.

Safety Factor

Default: 1.2 (per NFPA and good practice).

Range: 1.1 – 1.5.

Below 1.1: unsafe, no allowance for battery aging.

Above 1.5: unnecessary oversizing, cost/waste.

2. Output Validation & Thresholds

Outputs must reflect NFPA 72 and audit expectations:

Battery Capacity < 7 Ah
🔴 Insufficient — practically no commercial FACP is allowed with <7 Ah sealed lead acid battery.

7 Ah ≤ Capacity < 20 Ah
⚠️ Acceptable but borderline — only small panels or low-occupancy buildings.
(Recommend larger capacity to account for temperature & aging.)

≥ 20 Ah
✅ Fully compliant for most commercial applications.
Larger systems (campuses, hospitals) may require 50–100 Ah banks.
4. Edge Cases & Handling

Zero values → already blocked.

Negative values → blocked by validation.

Standby > Alarm current → flagged with warning, but not blocked (possible in rare systems).

Unrealistically high currents (e.g., >100 A) → blocked to avoid meaningless outputs.

Extreme times (e.g., 0.001 h, 999 h) → blocked with NFPA-aligned limits.

Safety Factor <1 → blocked (unsafe, under-designed).

Safety Factor >1.5 → blocked (excessive oversizing, not cost-effective).

5. Why Each Validation is Essential

Ranges → Keeps inputs aligned with NFPA 72 and actual product datasheets. Prevents unrealistic audits.

Cross-field check → Alarm current usually > standby; flagging this prevents user mis-entry.

Safety factor → Regulatory compliance: must allow for aging and uncertainty.

Output thresholds → NFPA audits check if batteries are ≥7Ah, ≥20Ah for most panels. Calculator now produces actionable compliance results.

Edge case handling → Prevents misreporting in safety audits (e.g., division by zero or absurd numbers). -->