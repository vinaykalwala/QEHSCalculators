{% extends 'base.html' %}
{% block title %}Specific volume calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
/* Table Wrapper for scroll */
.table-wrapper {
    width: 100%;
    overflow-x: auto;   /* horizontal scroll on small screens */
    -webkit-overflow-scrolling: touch;
}

/* Table Styling */
.custom-table {
    width: 100%;
    min-width: 600px; /* ensures table has minimum width for readability */
    border-collapse: collapse;
    margin: 15px 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    font-size: 14px;
    text-align: center;
}

/* Table Header */
.custom-table thead {
    background-color: #1560bd;
    color: #fff;
}

.custom-th {
    padding: 10px;
    border: 1px solid #ddd;
    font-weight: bold;
}

/* Table Rows */
.custom-tr:nth-child(even) {
    background-color: #fff;
}



.custom-td {
    padding: 8px;
    border: 1px solid #ddd;
}

/* Responsive adjustments for small screens */
@media screen and (max-width: 768px) {
    .custom-table {
        font-size: 12px;
    }
    .custom-th, .custom-td {
        padding: 6px;
    }
}

.hidden { display: none; }
.warning-msg {
    display: block;
    font-size: 13px;
    margin-top: 6px;
    color: orange;
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Specific Volume Calculator</h1>
       <p>
    Calculate the <strong>Specific Volume</strong> of an extinguishing agent to understand how it expands or contracts with temperature, aiding fire suppression system design.
</p>

    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="k1">Constant k₁</label>
                <input type="number" id="k1" class="form-input" placeholder="Enter k₁ value">
            </div>
            <div class="form-group">
                <label for="k2">Constant k₂</label>
                <input type="number" id="k2" class="form-input" placeholder="Enter k₂ value">
            </div>
            <div class="form-group">
                <label for="temperature">Temperature (T)</label>
                <input type="number" id="temperature" class="form-input" placeholder="Enter Temperature">
            </div>
            <button class="calculate-btn" onclick="calculateSpecificVolume()">Calculate Specific Volume</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/supression.jpg' %}" alt="Specific Volume Illustration">
                <p>This tool will calculate the <strong>Specific Volume</strong>. Enter your data to see results and insights here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Specific Volume</div>
                <div class="rate-value" id="specificVolumeValue">0.0000</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">(SI units)</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">

    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator determines the <strong>specific volume</strong> of fire suppression agents based on temperature. 
            Specific volume represents how much space a unit mass of the agent occupies. 
            Understanding this behavior is crucial because extinguishing agents expand when heated and contract when cooled. 
            Accurate knowledge of these changes ensures that storage, piping, and discharge systems are designed safely, 
            preventing overpressure, leaks, or insufficient coverage during fire suppression.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>k₁:</strong> Constant specific to the extinguishing agent.</li>
            <li><strong>k₂:</strong> Constant defining change in specific volume per unit temperature.</li>
            <li><strong>Temperature (T):</strong> The ambient or system temperature in °C or K.</li>
            <li><strong>Specific Volume (v):</strong> Resulting value showing volume per unit mass of the agent.</li>
        </ul>
    </div>

    <!-- Input Validations -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>All fields (<strong>k₁</strong>, <strong>k₂</strong>, <strong>Temperature</strong>) are <strong>mandatory</strong>.</li>
            <li>Inputs must be <strong>numeric</strong> values only; non-numeric entries are rejected.</li>
            <li><strong>k₁ and k₂:</strong> Must be positive, realistic constants based on agent data. Warnings appear if values exceed typical ranges.</li>
            <li><strong>Temperature:</strong> Must be within operational limits (e.g., -40°C to 60°C for storage, up to 500°C for simulations). Values outside these ranges trigger warnings.</li>
            <li>Edge cases such as negative results, zero constants, or unrealistic expansion are flagged to prevent unsafe or physically impossible calculations.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📤 Output Validations</h3>
        <ul class="note-list">
            <li>✅ Stable Specific Volume: Safe and within design expectations. (Displayed along with result feedback)</li>
            <li>⚠️ Moderate Expansion: Monitor design parameters carefully. (Displayed along with result feedback)</li>
            <li>🚨 High Expansion: May exceed safe design limits. Recheck calculations. (Displayed along with result feedback)</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📖 Governing Principle</h3>
        <ul class="note-list">
            <li>✅ Stable Specific Volume: Safe and within design expectations. (Same as Output Validations)</li>
            <li>⚠️ Moderate Expansion: Monitor design parameters carefully. (Same as Output Validations)</li>
            <li>🚨 High Expansion: May exceed safe design limits. Recheck calculations. (Same as Output Validations)</li>
        </ul>
        <p>
            The feedback displayed in Output Validations is mirrored here to guide design decisions and ensure that 
            storage and system layouts remain within safe operational limits.
        </p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>📌 Conclusion</h3>
        <p>
            This calculator provides quick and reliable estimation of specific volume based on agent constants and temperature. 
            Output validations indicate whether the expansion is within safe limits, requires monitoring, or may exceed safe design parameters, 
            ensuring that fire suppression systems are designed and operated safely.
        </p>
    </div>

</div>




</div>

<script>
function calculateSpecificVolume() {
    const k1Input = document.getElementById('k1').value.trim();
    const k2Input = document.getElementById('k2').value.trim();
    const tempInput = document.getElementById('temperature').value.trim();
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');

    // Reset displays
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Mandatory fields
    if (!k1Input || !k2Input || !tempInput) {
        showError("⚠️ Please fill in all required fields.", "orange");
        return;
    }

    const k1 = parseFloat(k1Input);
    const k2 = parseFloat(k2Input);
    const temperature = parseFloat(tempInput);

    // Numeric validation
    if (isNaN(k1) || isNaN(k2) || isNaN(temperature)) {
        showError("❌ Invalid entry. Enter numeric values only.", "red");
        return;
    }

    // Positive constants validation
    if (k1 <= 0 || k2 <= 0) {
        showError("❌ Constants k₁ and k₂ must be greater than zero.", "red");
        return;
    }

  // Stop calculation if thresholds exceeded
if (k1 > 1.0) {
    showError("⚠️ k₁ exceeds typical agent range (0.05 – 0.15 m³/kg). Please verify input.", "orange");
    return;
}
if (k2 > 0.01) {
    showError("⚠️ k₂ exceeds typical expansion coefficient (0.0002 – 0.0006 m³/kg·°C). Please verify input.", "orange");
    return;
}

    // Temperature realistic limits
    if (temperature < -40 || temperature > 500) {
        showError("⚠️ Temperature is outside typical operational range (-40°C to 500°C).", "orange");
        return;
    }

    // Calculate specific volume
    const specificVolume = k1 + (k2 * temperature);

    // Output sanity check
    if (specificVolume <= 0) {
        showError("❌ Calculated specific volume is physically impossible (<0). Check inputs.", "red");
        return;
    }

    // Display result
    document.getElementById('specificVolumeValue').innerText = specificVolume.toFixed(4);
    resultValue.classList.remove('hidden');

    // Feedback logic
    let feedback = "";
    if (specificVolume < 0.1) {
        feedback = "✅ Stable Specific Volume: Safe and within design expectations.";
        feedbackContent.style.color = "green";
    } else if (specificVolume <= 0.5) {
        feedback = "⚠️ Moderate Expansion: Monitor design parameters carefully.";
        feedbackContent.style.color = "orange";
    } else {
        feedback = "🚨 High Expansion: May exceed safe design limits. Recheck calculations.";
        feedbackContent.style.color = "red";
    }
    feedbackContent.innerHTML = feedback;

    // Helper function
    function showError(msg, color) {
        resultError.innerHTML = msg;
        resultError.style.color = color;
        resultError.classList.remove('hidden');
    }
}

</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Analysis of Inputs, Outputs, and Formula

Inputs:

Input	Unit	Description	QEHS Relevance
k₁	SI units (m³/kg)	Base specific volume of agent	Critical to calculate baseline agent occupancy in containers
k₂	SI units (m³/kg·°C)	Change in specific volume per unit temperature	Ensures expansion/contraction is accounted for, preventing overpressure or underfill
Temperature (T)	°C	Ambient or system temperature	High or low temperatures affect expansion; must be within operational ranges

Output:

Specific Volume (v, m³/kg)

Indicates how much volume the agent occupies under given conditions.

Helps evaluate storage, piping, and discharge safety in fire suppression systems.

Formula:

v = k₁ + k₂ × T


Linear approximation of expansion/contraction with temperature.

2. Recommended Input Validation Rules
Input	Validation	Real-World QEHS Rationale
k₁	Numeric, > 0, reasonable max ~1.0	Prevents physically impossible values; ensures agent mass-to-volume ratios are realistic
k₂	Numeric, > 0, reasonable max ~0.01	Large k₂ would indicate unrealistic expansion; ensures safe design assumptions
Temperature (T)	Numeric, -40°C to 60°C (typical storage), allow up to 500°C for extreme scenarios in simulations	Ensures inputs match operational and testing conditions; prevents unrealistic calculation results

Additional rules / logical consistency:

k₂ should be smaller than k₁ for realistic expansion (<10% typical)

If k₁ and k₂ values exceed known agent constants (from NFPA or manufacturer datasheets), warn user.

3. Edge Case Validations
Edge Case	Handling
Empty input	Show "Please fill in all required fields"
Non-numeric	Show "Invalid entry. Enter numeric values only"
Negative constants	Reject and warn: physically impossible
Extremely high/low temperature	Show warning: outside typical operational range
Resulting specific volume <0	Show error: physically impossible (agent cannot occupy negative volume)
Resulting specific volume excessively high (>1 m³/kg)	Show caution: check agent type/inputs
4. Output Validation Logic / Thresholds
Specific Volume (v, m³/kg)	Interpretation / QEHS Advice
< 0.1	✅ Stable / safe: within design expectations
0.1 – 0.5	⚠️ Moderate expansion: check storage container and piping margins
> 0.5	🚨 High expansion: potential overpressure; adjust storage or agent amount

Thresholds based on typical fire suppression agent behavior from NFPA 2001 standards.

Helps engineers design safe storage volumes, pressure reliefs, and discharge system capacity. -->