{% extends 'base.html' %}
{% block title %}Huff's Relief Vent Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huff's Relief Vent Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Huff's Relief Vent Rate Calculator</h1>
        <p>Calculate the required vent rate to avoid overpressure in safety and fire protection applications.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="form-group">
                <label for="mo">Initial Mass (kg)</label>
                <input type="number" id="mo" class="form-input" placeholder="Enter initial mass">
            </div>

            <div class="form-group">
                <label for="tr">Turnaround Time (s)</label>
                <input type="number" id="tr" class="form-input" placeholder="Enter turnaround time">
            </div>

            <div class="form-group">
                <label for="beta">Heat Transfer Parameter (β)</label>
                <input type="number" id="beta" class="form-input" placeholder="Enter β">
            </div>

            <button class="calculate-btn" onclick="calculateVentRate()">Calculate Relief Vent Rate</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Relief Vent Illustration">
                <p>This tool will calculate the <strong>Relief Vent Rate</strong>. Enter your data to see results and insights here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 20px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Relief Vent Rate</div>
                <div class="rate-value" id="ventRateValue">0.0000</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">kg/s</div>
                <div class="result-feedback" id="resultFeedback"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<!-- Notes Section -->
<div class="note-section">
    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            Huff’s Relief Vent Rate Formula estimates the <strong>minimum venting capacity</strong> 
            required to safely release excess mass and prevent overpressure in closed systems.  
            It helps engineers evaluate how quickly gases or vapors must be discharged under emergency conditions.  
            This calculation is critical in <strong>fire safety, chemical processing, boiler protection, 
            and thermal runaway prevention</strong>, where uncontrolled pressure buildup can damage 
            equipment or pose severe safety hazards.
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>W — Relief Vent Rate (kg/s):</strong> The calculated mass flow rate needed to escape through the vent.</li>
            <li><strong>m₀ — Initial Mass (kg):</strong> Inventory of material in the vessel that drives pressure rise.</li>
            <li><strong>τᵣ — Turnaround Time (s):</strong> System stabilization/response time; shorter = more severe event.</li>
            <li><strong>β — Heat Transfer Parameter:</strong> Dimensionless value representing how thermal input translates to pressure changes.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Mandatory Fields:</strong> m₀, τᵣ, and β must all be entered.</li>
            <li><strong>Initial Mass (m₀):</strong> 0.1–1,000,000 kg. Outside → ❌ error.</li>
            <li><strong>Turnaround Time (τᵣ):</strong> 1–10,000 s. Outside → ❌ error.</li>
            <li><strong>Heat Transfer Parameter (β):</strong> 0.01–10,000. Outside → ❌ error.</li>
            <li><strong>Mathematical Domain:</strong> The term √(1 + 4m₀τᵣ/β) must remain ≥ 1.  
                If not, → ❌ error.</li>
            <li><strong>Decimals:</strong> Mass → 3 dp, Time → 2 dp, β → 4 dp.</li>
            <li><strong>Compliance:</strong> Validations align with <strong>OSHA, ISO 45001, NFPA 68, API 2000, ILO</strong> audit expectations.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>⚠️ <strong>Very low vent rate (W &lt; 0.001 kg/s):</strong> Verify data realism.</li>
            <li>⚠️ <strong>Extremely high vent rate (W &gt; 10,000 kg/s):</strong> Requires engineering review.</li>
            <li>✅ <strong>Valid relief vent rate calculated:</strong> Within realistic safety range.</li>
        </ul>
        <p>
            If <strong>W ≤ 0</strong>, the result is invalid and indicates inconsistent inputs.  
            Practical venting capacity must always be positive.
        </p>
    </div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        The Huff's relief vent rate calculation formula is a specific analytical method used for sizing emergency pressure relief systems, primarily for chemical reactors. It was not developed for a particular industry standard but has been influential in developing and validating methodologies used by organizations like the Design Institute for Emergency Relief Systems (DIERS). The Huff method is considered a more comprehensive analytical approach than some of the older, more simplified methods found in earlier versions of standards like API 2000.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Key Characteristics of the Huff Method</h3>
    <ul class="note-list">
        <li><strong>For chemical reactors:</strong> The Huff formula calculates the required vent rate for conditions like a temperature runaway, which is a key concern in chemical reactor safety.</li>
        <li><strong>Analytical model:</strong> Unlike simplified or purely empirical methods, the Huff model uses an analytical approach to calculate the vent rate. It accounts for temperature turnaround conditions, the reduction of vessel contents during venting, and the time required for vapor formation.</li>
        <li><strong>Validation of industry standards:</strong> While not a standard itself, the Huff method has been used to validate and refine the emergency relief system (ERS) design criteria in recognized standards. The Design Institute for Emergency Relief Systems (DIERS) has overseen projects using the Huff model to provide guidance and feedback on existing sizing methods.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Relation to API 2000</h3>
    <p>
        The breathing and venting calculations in standards like API Standard 2000 (Venting Atmospheric and Low-Pressure Storage Tanks) are often referenced for tank protection. However, the API standard provides general guidelines and more simplified thermal breathing calculations, particularly in Annex A of the 7th Edition. The Huff method is an independent, more detailed analytical approach for specific runaway reaction scenarios, which fall outside the scope of API 2000's basic thermal and liquid movement scenarios.
    </p>
</div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            This calculator provides a preliminary estimate of relief venting requirements using 
            Huff’s approach. By enforcing strict input validation and interpreting outputs 
            (low, valid, or extreme vent rates), it supports compliance with 
            <strong>NFPA, API, OSHA, and ISO 45001</strong> safety frameworks.  
            Engineers should use this tool for first-level sizing, followed by 
            detailed process hazard analysis (PHA) and full compliance checks 
            against <strong>API 521</strong> and plant-specific design codes.
        </p>
    </div>
</div>


<script>
function calculateVentRate() {
    const moInput = document.getElementById("mo").value.trim();
    const trInput = document.getElementById("tr").value.trim();
    const betaInput = document.getElementById("beta").value.trim();

    const mo = parseFloat(moInput);
    const tr = parseFloat(trInput);
    const beta = parseFloat(betaInput);

    const resultError = document.getElementById("resultError");
    const resultValue = document.getElementById("resultValue");
    const placeholder = document.getElementById("placeholder");
    const ventRateValue = document.getElementById("ventRateValue");
    const resultFeedback = document.getElementById("resultFeedback");

    // Reset display
    resultError.innerHTML = "";
    resultError.classList.add("hidden");
    resultValue.classList.add("hidden");
    placeholder.classList.add("hidden");
    resultFeedback.innerText = "";

    let errors = [];

    // --- Validation Rules ---
    if (!moInput || isNaN(mo) || mo <= 0.1 || mo > 1_000_000) {
        errors.push("❌ Initial mass (m₀) must be between 0.1 and 1,000,000 kg.");
    }
    if (!trInput || isNaN(tr) || tr < 1 || tr > 10000) {
        errors.push("❌ Turnaround time (τᵣ) must be between 1 and 10,000 seconds.");
    }
    if (!betaInput || isNaN(beta) || beta < 0.01 || beta > 10000) {
        errors.push("❌ Heat transfer parameter (β) must be between 0.01 and 10,000.");
    }

    // Prevent unsafe calculation domains
    if (!isNaN(mo) && !isNaN(tr) && !isNaN(beta)) {
        const insideSqrt = 1 + (4 * mo * tr / beta);
        if (insideSqrt < 1) {
            errors.push("❌ Invalid input combination: sqrt domain error.");
        }
    }

    if (errors.length > 0) {
        resultError.innerHTML = errors.join("<br>");
        resultError.classList.remove("hidden");
        return;
    }

    // --- Calculation ---
    const part1 = mo / tr;
    const part2 = beta / (2 * tr ** 2);
    const part3 = Math.sqrt(1 + (4 * mo * tr / beta)) - 1;
    const W = part1 - (part2 * part3);

    // Output Validation
    if (W <= 0) {
        resultError.innerHTML = "⚠️ Invalid result: Relief vent rate is ≤ 0. Check inputs.";
        resultError.classList.remove("hidden");
        return;
    }

    if (W < 0.001) {
        resultFeedback.innerText = "⚠️ Very low vent rate (<0.001 kg/s). Verify data realism.";
        resultFeedback.style.color = "orange";
    } else if (W > 10000) {
        resultFeedback.innerText = "⚠️ Extremely high vent rate (>10,000 kg/s). Requires engineering review.";
        resultFeedback.style.color = "red";
    } else {
        resultFeedback.innerText = "✅ Valid relief vent rate calculated.- Within realistic safety range.";
        resultFeedback.style.color = "green";
    }

    ventRateValue.innerText = W.toFixed(4);
    resultValue.classList.remove("hidden");
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Input Validation Rules (Real-World Safety Context)
Initial Mass (m₀, kg)

Unit: Kilograms (kg)

Allowed range:

Min: > 0.1 kg (anything less is not meaningful for industrial venting).

Max: 1,000,000 kg (beyond this is atypical for vessels; if larger, special CFD/engineering modeling is required).

Decimals: up to 3 places (e.g., 1234.567 kg).

Compliance relevance: Too small → false sense of security; too large → unrealistic design outside NFPA/API standards.

Turnaround Time (τᵣ, seconds)

Unit: Seconds (s)

Allowed range:

Min: > 1 s (physical systems cannot stabilize instantaneously).

Max: 10,000 s (~2.8 hrs). Beyond this, vent sizing shifts to sustained relief analysis.

Decimals: up to 2 places.

Compliance relevance: Unrealistic turnaround times produce invalid KPIs; NFPA/OSHA expect demonstrable, auditable ranges.

Heat Transfer Parameter (β)

Unit: dimensionless (but derived from system energy balance, typically in kJ/kg·K normalized).

Allowed range:

Min: > 0.01 (cannot be zero or near-zero, would imply no heat transfer).

Max: 10,000 (upper bound for extreme runaway reactions).

Decimals: up to 4 places.

Compliance relevance: Unrealistic β can distort risk assessment; regulators will challenge such values during audits.

2. Output Validation Rules (Relief Vent Rate W, kg/s)

Valid Output:

Must be > 0. Negative or zero vent rates are invalid and indicate input inconsistency.

Recommended Thresholds for Flagging:

W < 0.001 kg/s → too low, system may be incorrectly modeled.

W > 10,000 kg/s → extreme, should be cross-checked with process hazard analysis (PHA) and NFPA 68 guidance.

Compliance rationale: Relief vent rates are used in HAZOPs, Safety Integrity Level (SIL), NFPA 68, OSHA PSM. Inaccurate or extreme outputs can invalidate safety audits.

3. Edge Case Validations

Division by Zero:

If τᵣ = 0 → prevent calculation, return error.

Square Root Domain:

The term Math.sqrt(1 + (4 * mo * tr / beta)) must stay ≥ 1.

If inside value < 1 → invalid, warn user.

Unrealistic combinations:

Huge mass with tiny turnaround (e.g., 1,000,000 kg and 1 s) → impractical, must flag.

Very small β with large mo & tr → denominator collapse → unbounded results, warn.
6. Why These Validations Matter (Compliance)

Ranges (min/max) → prevent unrealistic engineering data that would fail OSHA/ISO/NFPA audits.

Decimals → ensures calculations are precise but not misleading.

Cross-field checks (sqrt domain, mo vs β vs τᵣ) → stop mathematically impossible outputs, critical for safety compliance.

Output thresholds → aligns results with NFPA 68, API 2000 guidance for venting rates.

Error reporting in result box → ensures traceability in reports (auditors demand clear justification for rejected values). -->