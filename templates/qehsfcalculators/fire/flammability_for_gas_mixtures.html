{% extends 'base.html' %}
{% block title %}Flammability Calculator for Gas Mixtures{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
/* Result Container */
#flammabilityResult {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

/* NOT FLAMMABLE */
#flammabilityResult.green {
    color: #1560bd; /* professional blue */
    background-color: #e6f4ea; /* light green background */
    border: 2px solid #2ecc71;
}

/* FLAMMABLE */
#flammabilityResult.red {
    color: #e74c3c; /* strong red */
    background-color: #fdecea; /* light red/pink background */
    border: 2px solid #c0392b;
}

/* Feedback Message */
#feedbackContent {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    padding: 10px;
    border-radius: 6px;
}

/* Feedback colors */
#feedbackContent.green {
    color: #2ecc71;
    background-color: #e6f4ea;
    border: 1px solid #2ecc71;
}

#feedbackContent.red {
    color: #c0392b;
    background-color: #fdecea;
    border: 1px solid #c0392b;
}

    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Flammability Calculator for Gas Mixtures</h1>
        <p>Determine whether a gas mixture is flammable based on the concentration of its flammable and inert components.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Gas Mixture Parameters</h2>

            <div class="form-group">
                <label for="Ai"><strong>Fraction of Flammable Component (Ai) (%)</strong></label>
                <input type="number" id="Ai" placeholder="Enter Ai in mol%" class="form-input" min="0.01" step="0.01">
            </div>

            <div class="form-group">
                <label for="Tci"><strong>Maximum Flammable Gas Content (Tci) (%)</strong></label>
                <input type="number" id="Tci" placeholder="Enter Tci in mol%" class="form-input" min="0.01" step="0.01">
            </div>

            <div class="form-group">
                <label for="Bk"><strong>Fraction of Inert Component (Bk) (%)</strong></label>
                <input type="number" id="Bk" placeholder="Enter Bk in mol%" class="form-input"  min="0.01" step="0.01">
            </div>

            <div class="form-group">
                <label for="Kk"><strong>Coefficient of Nitrogen Equivalency (Kk)</strong></label>
                <input type="number" id="Kk" placeholder="Enter Kk value" class="form-input"  min="0.01" step="0.01">
            </div>

            <button class="calculate-btn" onclick="calculateFlammability()">Calculate</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/flame.png' %}" alt="Flammability illustration">
                <p>Enter the parameters above and click <strong>Calculate</strong> to see if the mixture is flammable.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 20px;"></div>

            <!-- Actual result display -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value" id="flammabilityResult"></div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
<div class="note-section">

    <!-- 1. About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator evaluates whether a gas mixture is flammable based on fractions of flammable and inert components. 
            It is a critical tool for industrial safety, chemical processing, and fire hazard assessment in enclosed spaces.
        </p>
    </div>

    <!-- 2. Parameters / Key Inputs -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Ai – Fraction of Flammable Component [% mol]:</strong> Percentage of flammable gases/vapors in the mixture. Higher Ai increases ignition likelihood.</li>
            <li><strong>Tci – Maximum Flammable Gas Content [% mol]:</strong> Maximum allowable concentration of flammable gas before ignition; serves as a safety threshold.</li>
            <li><strong>Bk – Fraction of Inert Component [% mol]:</strong> Percentage of inert gases (e.g., N₂, CO₂); reduces fire risk by displacing oxygen and diluting flammable gases.</li>
            <li><strong>Kk – Coefficient of Nitrogen Equivalency [unitless]:</strong> Effectiveness of inert gases in suppressing ignition; higher Kk indicates stronger suppression.</li>
        </ul>
    </div>

    <!-- 3. Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>All inputs are mandatory; missing values prevent calculation.</li>
            <li><strong>Ai:</strong> Numeric, 0.01–100, reflects flammable content. Higher values → higher hazard.</li>
            <li><strong>Tci:</strong> Numeric, 0.01–100; must exceed Ai for logical consistency.</li>
            <li><strong>Bk:</strong> Numeric, 0.01–100; ensures effective flammability suppression.</li>
            <li><strong>Kk:</strong> Numeric, 0.01–10; represents inert gas suppression efficiency.</li>
            <li>Logical consistency: Ai ≤ Tci, Ai + Bk ≤ 100%, ensures realistic and safe mixture.</li>
            <li>Decimal precision: up to two decimal places allowed for all inputs.</li>
            <li>Non-numeric, zero, negative, or extreme values trigger errors or warnings.</li>
        </ul>
    </div>

    <!-- 4. Output Validations & Feedback -->
    <div class="note-card">
        <h3>⚡ Output Validations & Feedback</h3>
        <p>
            The calculator outputs the flammability result with an immediate hazard assessment, displayed alongside the computed value:
        </p>
        <ul class="note-list">
            <li><strong>NOT FLAMMABLE:</strong> ✅ The gas mixture is safe under current conditions.</li>
            <li><strong>FLAMMABLE:</strong> ⚠️ The gas mixture poses a fire hazard! Implement engineering controls immediately.</li>
            <li>Low hazard → Green feedback.</li>
            <li>Moderate hazard → Orange/yellow feedback.</li>
            <li>High hazard → Red feedback; triggers urgent warning.</li>
            <li>Errors appear for Ai > 100%, Bk > 100%, Ai + Bk > 100%, Tci = 0, negative or missing inputs.</li>
        </ul>
    </div>

    <!-- 5. Governing Principle -->
    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            The flammability of gas mixtures depends on balancing flammable and inert components to prevent ignition. This methodology aligns with <strong>ASTM E681 – Standard Test Method for Concentration Limits of Flammability of Chemicals</strong>.
        </p>
        <p>
            Analogous concept: A <strong>Critical Number of Samples Calculator</strong> is not tied to a single standard but is used in statistical quality control (ISO 2859) or laboratory medicine (Westgard rules) to determine necessary sample sizes for confidence or quality assessment. Similarly, this calculator ensures gas mixtures remain within safe limits according to chemical properties and operational context.
        </p>
    </div>

    <!-- 6. Conclusion -->
    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <ul class="note-list">
            <li>Flammability assessment ensures mixtures remain within safe, non-ignitable limits.</li>
            <li>Dynamic feedback provides immediate hazard assessment and actionable guidance.</li>
            <li>Compliance with ASTM E681, OSHA, NFPA, ISO 45001, and ILO standards is maintained.</li>
            <li>Errors and warnings alert users to unsafe or unrealistic input conditions, supporting risk mitigation.</li>
        </ul>
    </div>

</div>


<script>
function calculateFlammability() {
    const Ai = parseFloat(document.getElementById("Ai").value);
    const Tci = parseFloat(document.getElementById("Tci").value);
    const Bk = parseFloat(document.getElementById("Bk").value);
    const Kk = parseFloat(document.getElementById("Kk").value);

    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");
    const resultError = document.getElementById("resultError");
    const flammabilityResult = document.getElementById("flammabilityResult");
    const feedbackContent = document.getElementById("feedbackContent");

    // Reset
    placeholder.classList.remove("hidden");
    resultValue.classList.add("hidden");
    resultError.classList.add("hidden");
    flammabilityResult.innerHTML = "";
    feedbackContent.innerHTML = "";
    flammabilityResult.className = "";
    feedbackContent.className = "";

    // Basic input checks
    if (isNaN(Ai) || Ai < 0.01 || Ai > 100 ||
        isNaN(Tci) || Tci < 0.01 || Tci > 100 ||
        isNaN(Bk) || Bk < 0.01 || Bk > 100 ||
        isNaN(Kk) || Kk < 0.01 || Kk > 10) {

        resultError.innerHTML = "❌ Enter valid numeric values within acceptable ranges (Ai/Tci/Bk: 0.01–100%, Kk: 0.01–10).";
        resultError.classList.remove("hidden");
        placeholder.classList.add("hidden");
        return;
    }

    // Cross-field logical validations
    if (Ai + Bk > 100) {
        resultError.innerHTML = "❌ Total fraction (Ai + Bk) cannot exceed 100%.";
        resultError.classList.remove("hidden");
        placeholder.classList.add("hidden");
        return;
    }

    if (Ai > Tci) {
        resultError.innerHTML = "⚠️ Ai exceeds Tci! Flammable content is higher than maximum allowable.";
        resultError.classList.remove("hidden");
        placeholder.classList.add("hidden");
        return;
    }

    // Prevent division by zero
    if (Tci === 0) {
        resultError.innerHTML = "❌ Tci cannot be zero.";
        resultError.classList.remove("hidden");
        placeholder.classList.add("hidden");
        return;
    }

    // Calculate flammability
    const leftSide = Ai * (100 / Tci - 1);
    const rightSide = Bk * Kk;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");

    // Output with hazard levels
    if (leftSide <= rightSide) {
        flammabilityResult.innerHTML = "Result: NOT FLAMMABLE";
        flammabilityResult.classList.add("green");

        feedbackContent.innerHTML = "✅ The gas mixture is safe under current conditions.";
        feedbackContent.classList.add("green");
    } else {
        flammabilityResult.innerHTML = "Result: FLAMMABLE";
        flammabilityResult.classList.add("red");

        feedbackContent.innerHTML = "⚠️ The gas mixture poses a fire hazard! Implement engineering controls immediately.";
        feedbackContent.classList.add("red");
    }
}


function printReport() {
    window.print();
}
</script>




    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Input Validation Rules (QEHS Perspective)

A. Ai – Fraction of Flammable Component [% mol]

Type: Numeric, positive

Range: 0.01 – 100 mol%

Decimals: Up to 2 decimal places allowed

Rationale: Flammable content above 100% is physically impossible. Small values <0.01% are negligible for safety calculations.

B. Tci – Maximum Flammable Gas Content [% mol]

Type: Numeric, positive

Range: 0.01 – 100 mol%

Decimals: Up to 2 decimal places

Rationale: Represents a safety threshold; zero or negative values are invalid. Must always exceed Ai for logical consistency.

C. Bk – Fraction of Inert Component [% mol]

Type: Numeric, positive

Range: 0.01 – 100 mol%

Decimals: Up to 2 decimal places

Rationale: Inert gas fraction cannot exceed 100%, cannot be zero in some risk assessments (no suppression).

D. Kk – Coefficient of Nitrogen Equivalency [unitless]

Type: Numeric, positive

Range: 0.01 – 10 (realistic range for most gases)

Decimals: Up to 2 decimals

Rationale: Represents inert suppression factor; extremely high or low values are unrealistic.

Cross-field Consistency Checks

Ai + Bk ≤ 100% – Cannot exceed total gas mixture volume.

Ai ≤ Tci – If actual flammable content exceeds max allowable concentration, flammability is almost certain; warn user.

2. Output Validation and Interpretation Logic

Calculation Formula:
Left Side = Ai * (100 / Tci - 1)
Right Side = Bk * Kk

Interpretation:

Left ≤ Right → NOT FLAMMABLE

Safe under current conditions, meets industry safety standards.

Left > Right → FLAMMABLE

Immediate attention required, implement engineering controls (ventilation, inerting).

Output Thresholds:

Low hazard (Left << Right) → Green feedback, safe.

Moderate hazard (Left ≈ Right) → Orange/yellow feedback, monitor closely.

High hazard (Left > Right) → Red feedback, implement immediate controls.

3. Edge Case Validations
Edge Case	Handling
Division by zero (Tci = 0)	Throw error: "Tci cannot be zero"
Ai > 100%	Reject input; invalid
Bk > 100%	Reject input; invalid
Ai + Bk > 100%	Reject input; total mixture exceeds 100%
Negative or zero values	Reject input
Kk = 0	Warning; no suppression effect
Extremely high values (Ai > 80% and low Bk)	Show “High Hazard” feedback
Non-numeric values	Reject input -->