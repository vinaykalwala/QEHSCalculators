{% extends 'base.html' %}
{% block title %}Heat detector responsive time calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Heat Detector Response Time Calculator</h1>
        <p>Calculate how quickly a heat detector will respond to a fire based on its RTI and hot gas velocity.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="rti">Response Time Index (RTI) (m¬Ω/s)</label>
                <input type="number" id="rti" class="form-input" placeholder="Enter RTI value">
            </div>
            <div class="form-group">
                <label for="velocity">Hot Gas Velocity (V) (m/s)</label>
                <input type="number" id="velocity" class="form-input" placeholder="Enter hot gas velocity">
            </div>
            <button class="calculate-btn" onclick="calculateHeatDetectorResponseTime()">Calculate Response Time</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/heatdetector.avif' %}" alt="Heat Detector Illustration">
                <p>This tool will calculate the <strong>response time</strong> of a heat detector. Enter your data to see results here.</p>
            </div>

            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Response Time</div>
                <div class="rate-value" id="responseTimeValue">0.00</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">seconds</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<!-- Notes Section -->
<div class="note-section">
    <!-- About -->
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            This calculator estimates the <strong>Response Time</strong> of a heat detector 
            based on its <strong>Response Time Index (RTI)</strong> and the velocity of hot gases. 
            It supports fire protection engineers and safety professionals in selecting detectors 
            that provide early warning in high-risk environments. 
            Faster response means earlier activation, which is critical for life safety and fire suppression.
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>‚öô Parameters Used</h3>
        <ul class="note-list">
            <li><strong>RTI (m¬Ω/s):</strong> Represents detector sensitivity. Higher RTI ‚Üí slower response. Typical range: 5‚Äì500 m¬Ω/s.</li>
            <li><strong>Hot Gas Velocity (V, m/s):</strong> Speed of hot gases reaching the detector. Faster velocity ‚Üí quicker activation.</li>
            <li><strong>Response Time (t, seconds):</strong> Time before detector activates, calculated as RTI / ‚àöV.</li>
        </ul>
    </div>

    <!-- Input Validation -->
    <div class="note-card">
        <h3>‚úÖ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Mandatory Fields:</strong> Both RTI and Hot Gas Velocity must be entered.</li>
            <li><strong>Numeric & Positive:</strong> Only numbers allowed; values must be > 0.</li>
            <li><strong>RTI Range:</strong> 5‚Äì500 m¬Ω/s. Outside this ‚Üí ‚ö†Ô∏è warning.</li>
            <li><strong>Velocity Range:</strong> 0.1‚Äì20 m/s. Outside this ‚Üí ‚ö†Ô∏è warning.</li>
            <li><strong>Logical Consistency:</strong> Response Time must be finite, > 0, and ‚â§ 300 s indoors.</li>
            <li><strong>Units Check:</strong> RTI in m¬Ω/s, Velocity in m/s (aligned with NFPA 72, ISO 7240-7, and ISO 45001).</li>
            <li><strong>Edge Cases:</strong>
                <ul>
                    <li>Zero/negative input ‚Üí ‚ùå error.</li>
                    <li>Very small velocity (&lt;0.1 m/s) ‚Üí ‚ö†Ô∏è stagnant airflow warning.</li>
                    <li>Extremely high RTI (&gt;500 m¬Ω/s) ‚Üí ‚ö†Ô∏è slow detector warning.</li>
                    <li>NaN/Infinity results ‚Üí ‚ùå prompt to recheck inputs.</li>
                </ul>
            </li>
            <li><strong>Decimals:</strong> Accept up to 2 decimals for both inputs.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>üìä Output Validations</h3>
        <ul class="note-list">
            <li>‚úÖ <strong>Fast Response:</strong> t &lt; 30s ‚Üí Ideal for high-risk areas.</li>
            <li>‚ö†Ô∏è <strong>Moderate Response:</strong> 30s ‚â§ t ‚â§ 90s ‚Üí Suitable for general protection.</li>
            <li>üö® <strong>Slow Response:</strong> t &gt; 90s ‚Üí May delay detection; consider lower RTI or improved airflow.</li>
        </ul>
        <p>
            Results beyond 300 seconds indicate an unrealistic or unsafe scenario and should be reassessed.
        </p>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>üìè Governing Principle</h3>
        <p>
            This principle is derived from the thermal balance of heat detectors exposed to hot gases.  
            It is recognized in <strong>NFPA 72</strong> (National Fire Alarm and Signaling Code) 
            and <strong>ISO 7240-7</strong> (Fire detection and alarm systems).  
            Specifically, <strong>EN 54-5</strong> defines requirements and classifications for heat detectors in Europe.  
            These standards ensure consistency in fire detection performance and life safety compliance.
        </p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>üèÅ Conclusion</h3>
        <p>
            This calculator provides a quick estimation of how fast a heat detector will respond in a fire scenario.  
            By validating RTI and gas velocity inputs, and classifying outputs (fast, moderate, slow), 
            it ensures compliance with <strong>NFPA, ISO, and EN standards</strong>.  
            Proper use supports faster fire detection, improved occupant safety, and optimized fire protection system design.
        </p>
    </div>
</div>


<script>
function calculateHeatDetectorResponseTime() {
    const RTIInput = document.getElementById('rti').value.trim();
    const VInput = document.getElementById('velocity').value.trim();
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');

    // Reset display
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Mandatory check
    if (RTIInput === "" || VInput === "") {
        resultError.innerHTML = "‚ö†Ô∏è Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Convert to float
    const RTI = parseFloat(RTIInput);
    const V = parseFloat(VInput);

    // Basic numeric validation
    if (isNaN(RTI) || isNaN(V)) {
        resultError.innerHTML = "‚ùå Invalid entry. Enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Positive value validation
    if (RTI <= 0 || V <= 0) {
        resultError.innerHTML = "‚ùå Values must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Industry realistic limits
    if (RTI < 5 || RTI > 500) {
        resultError.innerHTML = "‚ö†Ô∏è RTI value is outside typical range (5‚Äì500 m¬Ω/s). Verify detector type.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (V < 0.1 || V > 20) {
        resultError.innerHTML = "‚ö†Ô∏è Hot gas velocity outside typical range (0.1‚Äì20 m/s). Verify conditions.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Calculation
    const t = RTI / Math.sqrt(V);

    // Output validation
    if (!isFinite(t) || t <= 0) {
        resultError.innerHTML = "‚ùå Calculation error. Check input values.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    document.getElementById('responseTimeValue').innerText = t.toFixed(2);
    resultValue.classList.remove('hidden');

    // Feedback
    let feedback = "";
    if (t < 30) {
        feedback = "‚úÖ Fast Response: Ideal for high-risk areas.";
        feedbackContent.style.color = "green";
    } else if (t <= 90) {
        feedback = "‚ö†Ô∏è Moderate Response: Suitable for general protection.";
        feedbackContent.style.color = "orange";
    } else {
        feedback = "üö® Slow Response: May delay detection; consider lower RTI or improved airflow.";
        feedbackContent.style.color = "red";
    }
    feedbackContent.innerHTML = feedback;
}

function printReport() {
    window.print();
}

</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Analysis of Inputs, Outputs, and Formula

Inputs:

Input	Unit	Role	Real-World Notes
RTI (Response Time Index)	m¬Ω/s	Determines detector sensitivity	RTI values vary by detector type. Typical commercial heat detectors: 10‚Äì150 m¬Ω/s. High RTI ‚Üí slower response. Low RTI ‚Üí fast response.
Hot Gas Velocity (V)	m/s	Speed of convective heat transfer	Realistic velocities indoors: 0.1‚Äì10 m/s. High velocity ‚Üí quicker detection; extremely low velocity ‚Üí delayed response.

Output:

Output	Unit	Interpretation
Response Time (t)	seconds	Time for detector to activate: 
ùë°
=
ùëÖ
ùëá
ùêº
ùëâ
t=
V
	‚Äã

RTI
	‚Äã


Formula Validity:

This formula is standard in NFPA and ISO standards for predicting heat detector activation in convective flows.

Assumes constant RTI and uniform gas velocity.

2. Recommended Input Validation Rules

RTI (m¬Ω/s):

Required field

Numeric only, positive (>0)

Reasonable range: 5‚Äì500 m¬Ω/s

<5: Unrealistic for any detector

500: Extremely slow detector (rarely used)

Max 2 decimal places

Units must be m¬Ω/s

Hot Gas Velocity (V, m/s):

Required field

Numeric only, positive (>0)

Reasonable range: 0.1‚Äì20 m/s

<0.1 m/s: air almost stagnant ‚Üí negligible heat transfer

20 m/s: extremely fast, industrial flame jet; rare indoors

Max 2 decimal places

Units must be m/s

Cross-field consistency:

RTI / ‚àöV should produce t in seconds that is physically meaningful (<300 s for general indoor environments)

3. Output Validation & Thresholds
Response Time (t)	Feedback	Color	Explanation
<30 s	Fast Response	Green	Ideal for high-risk areas (NFPA 72, ISO 7240-7)
30‚Äì90 s	Moderate Response	Orange	Acceptable in normal occupancy; may require supplementary detection
>90 s	Slow Response	Red	Delayed response; violates good fire safety practice; triggers review

Additional Output Validations:

t must be finite number (no division by zero)

t must be realistic (<300 s for most indoor applications)

4. Edge Case Validations
Edge Case	Handling	Compliance Justification
RTI ‚â§ 0 or V ‚â§ 0	Show error; cannot calculate	Negative/zero values are physically impossible
V very small (<0.01 m/s)	Show warning	Airflow almost stagnant; detection delayed
RTI extremely high (>500 m¬Ω/s)	Show warning	Detector too slow; may violate NFPA safety recommendations
Division by zero	Prevent by V > 0	Mathematical error; unsafe assumption
Extremely large output t (>300 s)	Warn user	Indicates unrealistic scenario; may need review
Non-numeric input	Show error	Avoid JS NaN errors -->