{% extends 'base.html' %}
{% block title %}Base Design Quantity for CO₂ Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        /* Remove list dots & align horizontally */
.note-section ul {
    list-style: none;       /* removes bullets */
    
   
}

/* Space between items if more links later */


    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <!-- Calculator Header -->
    <div class="calculator-header">
        <h1>FM-200 / NOVEC 1230 - Nozzle Quantity Calculator</h1>
        <p>
            Determine the <strong>required number of nozzles</strong> for FM-200 or NOVEC 1230 fire suppression systems.  
            This ensures proper agent distribution, compliance, and safety.
        </p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="volume">Net Hazard Volume (V)</label>
                <input type="number" id="volume" class="form-input" placeholder="Enter Net Hazard Volume (m³)">
            </div>
            <div class="form-group">
                <label for="coverage">Nozzle Coverage Area (N)</label>
                <input type="number" id="coverage" class="form-input" placeholder="Enter Coverage per Nozzle (m³)">
            </div>
            <button class="calculate-btn" onclick="calculateNozzleQuantity()">Calculate Nozzle Quantity</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/nozzel.webp' %}" alt="Nozzle Illustration">
                <p>
                    This tool calculates the <strong>required number of nozzles</strong> for FM-200 or NOVEC 1230 systems.  
                    Enter your values to see results and insights here.
                </p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 20px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Nozzle Quantity</div>
                <div class="rate-value" id="nozzleValue">0</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">Nozzles Required</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<div class="note-section">

    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator determines the <strong>number of FM-200 or NOVEC 1230 nozzles</strong> 
            required for a protected space. Proper nozzle distribution ensures that the suppression 
            agent is discharged evenly across the enclosure, supporting <strong>fire safety, compliance, and efficiency</strong>.
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Net Hazard Volume (V):</strong> The total volume of the protected space (m³).</li>
            <li><strong>Nozzle Coverage Capacity (N):</strong> The effective volume one nozzle can protect, 
                specified by the manufacturer (m³/nozzle).</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Net Hazard Volume (V):</strong> Must be between 1 – 100,000 m³ (NFPA 2001 upper bound).</li>
            <li><strong>Nozzle Coverage (N):</strong> Must be between 1 – 5,000 m³ per nozzle (manufacturer specifications).</li>
            <li><strong>Numeric & Positive:</strong> Inputs must be positive numeric values, up to 1 decimal place.</li>
            <li><strong>Cross-check:</strong> Coverage (N) cannot exceed volume (V) by more than 100×.</li>
            <li><strong>Division by Zero Check:</strong> (N ≠ 0) is mandatory to avoid invalid results.</li>
        </ul>
        <p>
            These rules prevent unsafe system designs and ensure compliance with <strong>NFPA 2001</strong>, 
            <strong>ISO 14520</strong>, and manufacturer guidelines.
        </p>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <p>The result represents the <strong>total number of nozzles required</strong>.  
           Based on the calculated nozzle count, the following assessments are provided:</p>
        <ul class="note-list">
            <li><strong>&lt; 2 nozzles:</strong> ⚠️ Very low nozzle count. Verify nozzle spacing and manufacturer recommendations.</li>
            <li><strong>2 – 50 nozzles:</strong> ✅ Requirement is within typical design range.</li>
            <li><strong>51 – 100 nozzles:</strong> ⚠️ High nozzle count. Review practicality and piping layout.</li>
            <li><strong>&gt; 100 nozzles:</strong> ❌ Excessive nozzle count. System must be sectionalized for compliance.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        An FM-200 / Novec 1230 Nozzle Quantity Calculator is based on standards and procedures outlined in documents such as 
        the <strong>NFPA 2001</strong>, which provides the framework for designing clean agent fire suppression systems. 
        While there isn't one single "standard calculator," the underlying principles for calculating agent requirements, 
        nozzle placement, and flow rates are defined by this standard and its associated engineering guidelines provided by manufacturers.
    </p>

    <h5>📘 Standards and Factors Involved</h5>
    <ul>
        <li><strong>NFPA 2001:</strong> This is the fundamental standard for clean agent fire suppression systems and provides the formulas and criteria for designing these systems.</li>
        <li><strong>Manufacturer's Design Manuals:</strong> Companies like 3M (for Novec 1230) and manufacturers of FM-200 systems (like Ansul) publish detailed design and flow calculation manuals that include specific procedures for agent and nozzle calculations.</li>
        <li><strong>System Design Calculations:</strong>
            <ul>
                <li><strong>Hazard Volume Determination:</strong> Calculating the total volume of the space to be protected.</li>
                <li><strong>Design Concentration:</strong> Determining the minimum concentration of the agent needed to suppress the fire.</li>
                <li><strong>Agent Quantity Calculation:</strong> Using the room volume and design concentration to find the required amount of agent.</li>
                <li><strong>Nozzle Calculation:</strong> Determining the correct number and type of nozzles required to uniformly distribute the agent throughout the protected volume within the required discharge time (typically 10 seconds).</li>
            </ul>
        </li>
        <li><strong>Specific Standards for the Agent:</strong> Specific standards, like the Indian standard <strong>IS 15493</strong>, also exist to provide general requirements for gaseous fire extinguishing systems.</li>
    </ul>

    <p>
        In essence, the nozzle quantity calculator is a tool that applies the principles and formulas found in <strong>NFPA 2001</strong> 
        and manufacturer-specific guidelines to determine the necessary number of nozzles for a given protected space.
    </p>
</div>


    <div class="note-card">
            <h3>📊 What does the result mean?</h3>
            <p>
                The result indicates the <strong>total number of nozzles required</strong> to ensure proper distribution of the suppression agent.  
                Larger volumes or lower-coverage nozzles require more nozzles, while higher-coverage nozzles reduce the count.
            </p>
            <p>If you need assistance calculating the Net Hazard Volume, please use the following tool:</p>
            <ul style="display:flex; flex-wrap:wrap; justify-content:center; padding:0; margin:0; list-style:none;">
                <li style="margin:10px; flex:1 1 100%; text-align:center;">
                    <a href="{% url 'fire_fm_200_novec_1230_net_hazard_volume_calculator' %}" style="background-color:#1560bd; padding:12px 24px; color:white; border-radius:10px; text-decoration:none; font-weight:500; display:inline-block; width:90%; max-width:300px;">
                        Net Hazard Volume Calculator
                    </a>
                </li>
            </ul>
        </div>
    <!-- Conclusion -->
    <div class="note-card">
        <h3>🔎 Conclusion</h3>
        <p>
            By calculating the correct nozzle requirement, engineers can ensure <strong>even distribution</strong> 
            of FM-200 or NOVEC 1230, <strong>prevent dead zones</strong>, maintain regulatory compliance, and 
            <strong>optimize system costs</strong>.  
            This tool is particularly useful for <strong>data centers, control rooms, server facilities, 
            and industrial enclosures</strong> where gaseous fire suppression systems are applied.
        </p>
    </div>

</div>


<script>
function calculateNozzleQuantity() {
    const VInput = document.getElementById("volume").value.trim();
    const NInput = document.getElementById("coverage").value.trim();

    const resultValue = document.getElementById("resultValue");
    const placeholder = document.getElementById("placeholder");
    const feedbackContent = document.getElementById("feedbackContent");
    const resultError = document.getElementById("resultError");

    // Reset
    resultError.classList.add("hidden");
    resultValue.classList.add("hidden");
    placeholder.classList.add("hidden");
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Empty check
    if (VInput === "" || NInput === "") {
        resultError.innerHTML = "⚠️ Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    const V = parseFloat(VInput);
    const N = parseFloat(NInput);

    // Validation
    if (isNaN(V) || isNaN(N)) {
        resultError.innerHTML = "❌ Invalid entry. Please enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }

    // Range validation
    if (V <= 0 || V > 100000) {
        resultError.innerHTML = "❌ Net Hazard Volume must be between 1 and 100,000 m³ (per NFPA 2001).";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }
    if (N <= 0 || N > 5000) {
        resultError.innerHTML = "❌ Nozzle Coverage must be between 1 and 5,000 m³ per nozzle (per manufacturer specifications).";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }

    // Cross-field validation
    if (N > V * 100) {
        resultError.innerHTML = "⚠️ Nozzle coverage is unrealistically high compared to room volume. Please check input values.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    // Calculation
    const nozzleCount = Math.ceil(V / N);

    // Output
    document.getElementById("nozzleValue").innerText = nozzleCount;
    resultValue.classList.remove("hidden");

    // Feedback logic
    let feedback = "";
    if (nozzleCount < 2) {
        feedback = "⚠️ Very low nozzle count. Verify nozzle spacing and manufacturer recommendations.";
        feedbackContent.style.color = "orange";
    } else if (nozzleCount <= 50) {
        feedback = "✅ Nozzle requirement is within typical design range.";
        feedbackContent.style.color = "green";
    } else if (nozzleCount <= 100) {
        feedback = "⚠️ High nozzle count. Review system design for practicality and piping layout.";
        feedbackContent.style.color = "orange";
    } else {
        feedback = "❌ Excessive nozzle count (>100). System should be sectionalized for compliance.";
        feedbackContent.style.color = "red";
    }
    feedbackContent.innerHTML = feedback;
}

</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 🔍 1. Input Analysis (QEHS / Fire Safety Perspective)

Your calculator uses two inputs:

Net Hazard Volume (V, m³) → The cubic volume of the protected space.

Nozzle Coverage Area (N, m³/nozzle) → The effective volume a single nozzle can discharge agent into, based on manufacturer data.

Formula:

Nozzle Count
=
⌈
𝑉
𝑁
⌉
Nozzle Count=⌈
N
V
	​

⌉

This is consistent with NFPA 2001 / ISO 14520 principles: the room volume divided by nozzle capacity determines nozzle count.

🛡️ 2. Comprehensive Input Validation Rules
✅ Net Hazard Volume (V):

Unit: cubic meters (m³).

Minimum: 1 m³ (smaller spaces are not feasible for clean agent systems).

Maximum: 100,000 m³ (aligns with NFPA 2001 upper bounds for total flooding applications; anything larger requires sectionalized protection).

Decimals: Allow up to 1 decimal place (practical precision; higher precision is irrelevant for design).

Validation Logic: Must be positive, finite, and realistic.

✅ Nozzle Coverage (N):

Unit: cubic meters per nozzle (m³/nozzle).

Minimum: 1 m³/nozzle (anything less is physically meaningless).

Maximum: 5,000 m³/nozzle (based on FM-200/NOVEC nozzle manufacturer specifications).

Decimals: Allow up to 1 decimal place (since nozzle datasheets usually provide rounded figures).

Validation Logic: Must be positive, finite, and within manufacturer’s published range.

✅ Cross-field Consistency:

Check: Coverage (N) should not exceed total hazard volume (V) by more than 100×.

Example: If V = 100 m³ but N = 5,000 m³, the input is illogical and should trigger a warning.

⚠️ 3. Edge Case Validations

Division by Zero: If N = 0 → prevent calculation.

Unrealistically High Ratio: If V / N < 0.1 → warn that nozzle coverage is oversized and may not meet distribution requirements.

Unrealistically Low Ratio: If V / N > 1,000 → warn that nozzle count may be impractical and system design should be re-evaluated.

Extremes: If nozzle count > 100 → require review (large numbers trigger complexity in piping/hydraulics per NFPA).

📊 4. Output Validation & Threshold Explanations

< 2 Nozzles: Warning → Verify nozzle spacing and design per NFPA/ISO.

2 – 50 Nozzles: Acceptable range for most data centers, control rooms, and industrial enclosures.

> 50 Nozzles: Warning → System design may be impractical, consider sectionalization.

> 100 Nozzles: Error → Non-compliant, must split into multiple systems/zones.

This ensures results align with real-world audits and regulatory compliance. -->