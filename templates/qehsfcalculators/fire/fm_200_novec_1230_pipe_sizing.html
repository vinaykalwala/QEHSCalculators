{% extends 'base.html' %}
{% block title %}FM-200 / NOVEC 1230 - Pipe Sizing Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>FM-200 / NOVEC 1230 - Pipe Sizing Calculator</h1>
        <p>Calculate the optimal pipe diameter for FM-200 or NOVEC 1230 fire suppression systems to ensure proper agent flow and distribution.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="flowRate">Flow Rate (kg/sec)</label>
                <input type="number" id="flowRate" class="form-input" placeholder="Enter agent flow rate">
            </div>
            <div class="form-group">
                <label for="velocity">Velocity of Agent (m/s)</label>
                <input type="number" id="velocity" class="form-input" placeholder="Enter velocity">
            </div>
            <div class="form-group">
                <label for="agentType">Agent Type</label>
                <select id="agentType" class="form-input">
                    <option value="FM200">FM-200</option>
                    <option value="NOVEC">NOVEC 1230</option>
                </select>
            </div>
            <button class="calculate-btn" onclick="calculatePipeSize()">Calculate Pipe Size</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Pipe Sizing Illustration">
                <p>This tool will calculate the <strong>minimum pipe diameter</strong> required for FM-200 or NOVEC 1230 flow. Enter your data to see results here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 20px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Pipe Diameter</div>
                <div class="rate-value" id="pipeSizeValue">0.00</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">cm</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <!-- About -->
        <div class="note-card">
            <h3>üìò About This Calculator</h3>
            <p>
                This calculator determines the <strong>optimal pipe diameter</strong> for FM-200 / NOVEC 1230 fire suppression systems, ensuring 
                <strong>proper agent distribution</strong> and system performance.
            </p>
        </div>

        <!-- Importance -->
        <div class="note-card">
            <h3>üí° Why is Pipe Sizing Important?</h3>
            <ul class="note-list">
                <li><strong>Ensures Even Agent Distribution:</strong> Prevents pressure drops and inconsistent discharge.</li>
                <li><strong>Maintains Required Flow Rate:</strong> Ensures the agent reaches all areas within the correct time.</li>
                <li><strong>Regulatory Compliance:</strong> Meets NFPA 2001 and ISO 14520 standards.</li>
                <li><strong>Prevents Over-Pressurization:</strong> Protects pipes from excessive pressure that can damage the system.</li>
            </ul>
        </div>
          <!-- Validations -->
<div class="note-card">
    <h3>üõ°Ô∏è Input Validations</h3>
    <ul class="note-list">
        <li>All fields are <strong>mandatory</strong> ‚Äì empty fields trigger a warning.</li>
        <li><strong>Numeric values only:</strong> Non-numeric entries are not allowed.</li>
        <li><strong>Flow Rate (kg/s):</strong> 
            <ul>
                <li>Must be greater than <code>0.1 kg/s</code> (very small values are not practical).</li>
                <li>Values above <code>200 kg/s</code> trigger a caution warning.</li>
                <li>Up to 2 decimal places allowed.</li>
            </ul>
        </li>
        <li><strong>Velocity (m/s):</strong> 
            <ul>
                <li>Must be at least <code>2 m/s</code> (below this, agent transport is ineffective).</li>
                <li>Values above <code>30 m/s</code> trigger a caution warning (exceeds NFPA 2001 safe limit).</li>
                <li>Up to 2 decimal places allowed.</li>
            </ul>
        </li>
        <li><strong>Agent Type:</strong> Must be selected ‚Äì FM-200 or NOVEC 1230 only.</li>
        <li><strong>Pipe Diameter (Result):</strong>
            <ul>
                <li>Below <code>2 cm</code>: impractically small, unsafe for real systems.</li>
                <li>Above <code>30 cm</code>: unrealistic for suppression piping, recheck inputs.</li>
            </ul>
        </li>
        <li>Any error or warning will be displayed in the result box (default image will disappear).</li>
    </ul>
</div>

        <!-- Parameters -->
        <div class="note-card">
            <h3>‚öôÔ∏è Understanding the Parameters</h3>
            <ul class="note-list">
                <li><strong>Flow Rate (Q):</strong> The amount of FM-200 or NOVEC 1230 released per second (kg/sec).</li>
                <li><strong>Velocity (V):</strong> The recommended speed of the agent inside the pipe (m/s).</li>
                <li><strong>Agent Type:</strong> The suppression agent used, which affects density and flow calculations.</li>
            </ul>
            <p>
                This formula calculates the pipe diameter based on mass flow rate and fluid density. 
                By converting mass flow rate into volumetric flow, it ensures accurate pipe sizing for proper system performance.  
                Commonly used in fire suppression and specialized fluid systems, this method helps maintain the correct discharge rate and pressure.  
                The final diameter is given in centimeters, making it practical for real-world installation and component selection.
            </p>
        </div>

        <!-- Result Meaning -->
        <div class="note-card">
            <h3>üìè What Does the Result Mean?</h3>
            <p>
                The result provides the <strong>minimum pipe diameter required</strong> to handle the suppression agent efficiently without exceeding pressure limits.
            </p>
        </div>
    </div>
</div>

<script>
function calculatePipeSize() {
    const Q = parseFloat(document.getElementById('flowRate').value);
    const V = parseFloat(document.getElementById('velocity').value);
    const agentType = document.getElementById('agentType').value;

    const resultError = document.getElementById('resultError');
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const pipeSizeValue = document.getElementById('pipeSizeValue');

    // Reset
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    feedbackContent.innerHTML = "";
    resultError.innerHTML = "";

    // Validation: Empty / NaN
    if (isNaN(Q) || isNaN(V)) {
        resultError.innerHTML = "‚ùå Please enter numeric values for all fields.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Validation: Flow Rate
    if (Q <= 0.1) {
        resultError.innerHTML = "‚ùå Flow rate must be greater than 0.1 kg/s (practical lower limit).";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (Q > 200) {
        resultError.innerHTML = "‚ö†Ô∏è Flow rate exceeds typical design limit (>200 kg/s). Please verify input.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Validation: Velocity
    if (V < 2) {
        resultError.innerHTML = "‚ùå Velocity must be at least 2 m/s for effective agent transport.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (V > 30) {
        resultError.innerHTML = "‚ö†Ô∏è Velocity exceeds NFPA 2001 safe limit (>30 m/s). Recheck design.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Select density
    const density = agentType === "FM200" ? 1400 : 1600;

    // Convert flow rate to volumetric
    const Qv = Q / density; // m¬≥/s

    // Formula: D = sqrt(4 * Qv / (œÄ * V)) * 100 (cm)
    const D = Math.sqrt((4 * Qv) / (Math.PI * V)) * 100;

    // Output range validation
    pipeSizeValue.innerText = D.toFixed(2);
    resultValue.classList.remove('hidden');

    if (D < 2) {
        feedbackContent.innerHTML = "‚ö†Ô∏è Calculated diameter is less than 2 cm. This is impractically small.";
        feedbackContent.style.color = "orange";
    } else if (D > 30) {
        feedbackContent.innerHTML = "‚ö†Ô∏è Calculated diameter exceeds 30 cm. Likely unrealistic ‚Äì verify inputs.";
        feedbackContent.style.color = "orange";
    } else {
        feedbackContent.innerHTML = `‚úÖ The minimum required pipe diameter is <strong>${D.toFixed(2)} cm</strong> for ${agentType}.`;
        feedbackContent.style.color = "green";
    }
}

function printReport() {
    window.print();
}

</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Real-World Analysis of Inputs/Outputs

Inputs

Flow Rate (Q, kg/s): Real agent discharge flow rate. Typical FM-200/NOVEC ranges between 5‚Äì150 kg/s depending on cylinder bank size.

Velocity (V, m/s): NFPA 2001 recommends velocities ‚â§ 30 m/s for gas discharge through pipes. Practical range: 2‚Äì30 m/s.

Agent Type: Determines density (FM-200 ~1400 kg/m¬≥, NOVEC 1230 ~1600 kg/m¬≥).

Outputs

Pipe Diameter (cm): Minimum required pipe diameter to allow calculated flow. Should fall between 2 cm (DN20) and 30 cm (DN300) in real-world fire suppression systems.

2. Validation Rules (Industry Standards)
Flow Rate (kg/s)

Mandatory field, numeric only.

Minimum: > 0.1 kg/s (very small discharge below this is non-practical).

Maximum: ‚â§ 200 kg/s (beyond this is unrealistic for FM-200/NOVEC systems).

Decimals: Allow up to 2 decimal places.

Velocity (m/s)

Mandatory field, numeric only.

Minimum: ‚â• 2 m/s (below this, discharge won‚Äôt effectively transport agent).

Maximum: ‚â§ 30 m/s (NFPA 2001 safe velocity limit).

Decimals: Allow up to 2 decimal places.

Agent Type

Mandatory selection (FM-200 or NOVEC 1230 only).

3. Edge Case Validations

Division by Zero: If velocity = 0, formula breaks ‚Üí block with error.

Unrealistic Diameter: If diameter < 2 cm ‚Üí warn ‚Äútoo small, not practical‚Äù. If > 30 cm ‚Üí warn ‚Äútoo large, recheck inputs‚Äù.

Cross-field consistency: A very high flow rate with very low velocity ‚Üí impractically large diameter ‚Üí trigger caution.

Empty fields / NaN: Already covered.

4. Output Validation & Safety Relevance

Thresholds applied:

< 2 cm: Unsafe (risk of clogging, turbulence).

2‚Äì30 cm: Valid range for real systems.

> 30 cm: Unrealistic pipe for suppression systems, should trigger warning.

This ensures results can be defensible in audits (NFPA 2001, ISO 14520). -->