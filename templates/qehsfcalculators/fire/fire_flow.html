{% extends 'base.html' %}
{% block title %}Fire Flow calcualtor{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input{
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
select {
    width: 100%;
    padding: 15px;
    margin-top: 5px;
    border: 1px solid #d3e0f0;
    border-radius: 5px;
    font-size: 1rem;

}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Fire Flow Calculator</h1>
        <p>Estimate the amount of water required to control a fire in a building based on construction, occupancy, exposure, and sprinkler protection.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="form-group">
                <label for="floorArea">Total Floor Area (ftÂ²)</label>
                <input type="number" id="floorArea" class="form-input" placeholder="Enter total floor area">
            </div>

            <div class="form-group">
                <label for="buildingType">Building Type</label>
                <select id="buildingType" onchange="toggleCustomInput('buildingType', 'customBuildingType')">
                    <option value="0.6">Noncombustible (Fire-Resistive) (0.6)</option>
                    <option value="0.8">Ordinary Construction (0.8)</option>
                    <option value="1.0">Wood Frame (1.0)</option>
                    <option value="custom">Enter Custom Value</option>
                </select>
                <input type="number" id="customBuildingType" class="form-input" placeholder="Enter custom value" style="display:none;">
            </div>

            <div class="form-group">
                <label for="sprinkler">Fire Sprinkler System</label>
                <select id="sprinkler" onchange="toggleCustomInput('sprinkler', 'customSprinkler')">
                    <option value="0.5">Fully Sprinklered (0.5)</option>
                    <option value="1">Not Sprinklered (1.0)</option>
                    <option value="custom">Enter Custom Value</option>
                </select>
                <input type="number" id="customSprinkler" class="form-input" placeholder="Enter custom value" style="display:none;">
            </div>

            <div class="form-group">
                <label for="occupancyReduction">Occupancy Reduction (OR)</label>
                <select id="occupancyReduction" onchange="toggleCustomInput('occupancyReduction', 'customOccupancyReduction')">
                    <option value="0.9">Office Building (0.9)</option>
                    <option value="0.85">Industrial/Warehouse (0.85)</option>
                    <option value="1.0">High-Hazard Facility (1.0)</option>
                    <option value="custom">Enter Custom Value</option>
                </select>
                <input type="number" id="customOccupancyReduction" class="form-input" placeholder="Enter custom value" style="display:none;">
            </div>

            <div class="form-group">
                <label for="exposureDistance">Exposure Distance (ED)</label>
                <select id="exposureDistance" onchange="toggleCustomInput('exposureDistance', 'customExposureDistance')">
                    <option value="1.0">No Nearby Buildings (1.0)</option>
                    <option value="1.15">One Building Nearby (1.15)</option>
                    <option value="1.3">Two Buildings Nearby (1.3)</option>
                    <option value="custom">Enter Custom Value</option>
                </select>
                <input type="number" id="customExposureDistance" class="form-input" placeholder="Enter custom value" style="display:none;">
            </div>

            <button class="calculate-btn" onclick="calculateFireFlow()">Calculate Fire Flow</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/fireflow.jpeg' %}" alt="Fire Flow Illustration">
                <p>This tool will calculate the <strong>Required Fire Flow</strong>. Enter your building data to see results here.</p>
            </div>

            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Fire Flow Rate</div>

                <div class="rate-value" id="fireFlowValue">0.00</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">GPM</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
<div class="note-section">

  <!-- 1ï¸â£ About -->
  <div class="note-card">
      <h3>ð About This Calculator</h3>
      <p>
          The <strong>Fire Flow Calculator</strong> estimates the minimum water supply required to control a fire in a building using the 
          <strong>Fairfax County Method (Modified ISO Method)</strong>. It accounts for construction type, floor area, occupancy, exposure distance, 
          and sprinkler protection to ensure compliance with fire safety planning and emergency response needs.
      </p>
  </div>

  <!-- 2ï¸â£ Parameters -->
  <div class="note-card">
      <h3>âï¸ Parameters Used</h3>
      <ul class="note-list">
          <li><strong>Total Floor Area (A):</strong> 500â100,000 ftÂ², larger areas â higher fire load.</li>
          <li><strong>Building Type Factor (C):</strong> 0.5â1.2, based on construction fire resistance.</li>
          <li><strong>Sprinkler System Factor (S):</strong> 0.3â1.0, reflects suppression effectiveness.</li>
          <li><strong>Occupancy Reduction (OR):</strong> 0.7â1.0, accounts for risk level of building usage.</li>
          <li><strong>Exposure Distance (ED):</strong> 1.0â1.5, adjusts for nearby building fire spread risk.</li>
      </ul>
  </div>

  <!-- 3ï¸â£ Input Validation -->
  <div class="note-card">
      <h3>â Input Validation Rules</h3>
      <ul class="note-list">
          <li><strong>Mandatory Fields:</strong> All inputs must be provided; blanks are invalid.</li>
          <li><strong>Numeric Values Only:</strong> Letters/symbols are not accepted.</li>
          <li><strong>Ranges:</strong> 
              <ul>
                  <li>Floor Area (A): 500â100,000 ftÂ²</li>
                  <li>Building Type (C): 0.5â1.2</li>
                  <li>Sprinkler (S): 0.3â1.0</li>
                  <li>Occupancy Reduction (OR): 0.7â1.0</li>
                  <li>Exposure Distance (ED): 1.0â1.5</li>
              </ul>
          </li>
          <li><strong>Positive Values:</strong> No zero/negative inputs allowed.</li>
          <li><strong>Decimal Precision:</strong> Up to 2 decimals only.</li>
          <li><strong>Logical Consistency:</strong> Example â high-hazard occupancies (OR = 1.0) cannot have sprinkler factor > 1.0.</li>
      </ul>
  </div>

  <!-- 4ï¸â£ Output Validation -->
  <div class="note-card">
      <h3>ð Output Validations</h3>
      <ul class="note-list">
          <li><strong>Limits Applied:</strong> Fire flow capped between 500 GPM (minimum operational) and 6000 GPM (NFPA 13 hydrant max).</li>
          <li><strong>Post-Reductions:</strong> Adjusted by <code>OR Ã S</code>, but cannot go below 500 GPM.</li>
          <li><strong>Feedback Categories:</strong>  
              <ul>
                  <li>â <strong>Low Fire Flow (&lt;1000 GPM):</strong> Adequate for smaller structures.</li>
                  <li>â ï¸ <strong>Moderate Fire Flow (1000â3000 GPM):</strong> Standard commercial/industrial structures.</li>
                  <li>ð¨ <strong>High Fire Flow (&gt;3000 GPM):</strong> Large/high-hazard buildings; hydrant capacity must be checked.</li>
              </ul>
          </li>
      </ul>
  </div>

  <!-- 5ï¸â£ Governing Principle -->
  <div class="note-card">
      <h3>ð Governing Principle</h3>
      <p>
          Fire Flow estimation is based on the <strong>Fairfax County Method</strong>, a modified form of the ISO method, 
          with guidance drawn from <strong>NFPA 1142: Standard on Water Supplies for Suburban and Rural Fire Fighting</strong>. 
          Similar to how a <em>Critical Number of Samples Calculator</em> draws from multiple quality-control and medical 
          standards (e.g., ISO 2859, Westgard rules), the Fire Flow Calculator leverages these guidelines to provide 
          practical, safety-oriented estimates rather than being tied to a single formula.
      </p>
  </div>

  <!-- 6ï¸â£ Conclusion -->
  <div class="note-card">
      <h3>ð Conclusion</h3>
      <p>
          This calculator provides a quick estimate of the required fire flow, ensuring fire safety compliance, 
          structural protection, and effective emergency planning. Always verify results against local fire codes 
          and consult with the fire department for final design decisions.
      </p>
  </div>

</div>


<script>
function calculateFireFlow() {
    const floorAreaInput = document.getElementById('floorArea').value.trim();
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    const fireFlowValue = document.getElementById('fireFlowValue');
    const resultError = document.getElementById('resultError');
    const feedbackContent = document.getElementById('feedbackContent');

    // Reset
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Validate floor area
    const floorArea = parseFloat(floorAreaInput);
    if (isNaN(floorArea) || floorArea < 500 || floorArea > 100000) {
        resultError.innerHTML = "â Floor area must be between 500 and 100,000 ftÂ².";
        resultError.classList.remove('hidden');
        return;
    }

    // Collect values (custom or selection)
    const buildingType = getValidatedInput('buildingType', 'customBuildingType', 0.5, 1.2, 'Building Type');
    const sprinkler = getValidatedInput('sprinkler', 'customSprinkler', 0.3, 1.0, 'Sprinkler System');
    const occupancyReduction = getValidatedInput('occupancyReduction', 'customOccupancyReduction', 0.7, 1.0, 'Occupancy Reduction');
    const exposureDistance = getValidatedInput('exposureDistance', 'customExposureDistance', 1.0, 1.5, 'Exposure Distance');

    if ([buildingType, sprinkler, occupancyReduction, exposureDistance].includes(null)) return; // Validation failed

    // Raw fire flow
    let fireFlow = 18 * buildingType * Math.sqrt(floorArea) * exposureDistance;

    // Apply max/min limits
    fireFlow = Math.min(Math.max(fireFlow * occupancyReduction * sprinkler, 500), 6000);

    // Display
    fireFlowValue.innerText = fireFlow.toFixed(2);
    resultValue.classList.remove('hidden');

    // Feedback
    if (fireFlow < 1000) {
        feedbackContent.innerHTML = "â Low Fire Flow: Adequate for smaller structures.";
        feedbackContent.style.color = "green";
    } else if (fireFlow <= 3000) {
        feedbackContent.innerHTML = "â ï¸ Moderate Fire Flow: Standard commercial/industrial structures.";
        feedbackContent.style.color = "orange";
    } else {
        feedbackContent.innerHTML = "ð¨ High Fire Flow: Large or high-hazard building; ensure hydrant capacity.";
        feedbackContent.style.color = "red";
    }
}

// Helper function for validation
function getValidatedInput(selectId, customId, min, max, name) {
    const selectVal = document.getElementById(selectId).value;
    const value = (selectVal === "custom") ? parseFloat(document.getElementById(customId).value) : parseFloat(selectVal);

    if (isNaN(value) || value < min || value > max) {
        const resultError = document.getElementById('resultError');
        resultError.innerHTML = `â ${name} must be between ${min} and ${max}.`;
        resultError.classList.remove('hidden');
        return null;
    }
    return value;
}


function printReport() {
    window.print();
}
</script>

<script>
function toggleCustomInput(selectId, customId) {
    const selectElem = document.getElementById(selectId);
    const customInput = document.getElementById(customId);

    if (selectElem.value === "custom") {
        customInput.style.display = "block";
        customInput.focus();
    } else {
        customInput.style.display = "none";
        customInput.value = ""; // Clear any previous custom input
    }
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1ï¸â£ Detailed Input Validation Rules (Industry-Oriented)
Input Field	Units	Acceptable Range	Decimals	Cross-Field / Logical Checks	Compliance Rationale
Total Floor Area (A)	ftÂ²	500 â 100,000	0â2 decimal places	Must be > 0; realistic for building type	Ensures fire flow is calculated for realistic structures; too small or huge areas could produce misleading flow rates.
Building Type (C)	Factor	0.5 â 1.2	0â2 decimal places	Must be consistent with occupancy	Represents fire resistance; avoids underestimating required fire flow.
Fire Sprinkler System (S)	Factor	0.3 â 1.0	0â2 decimal places	Cannot be > 1 (no enhancement >100%)	Represents reduction of fire flow; ensures suppression system logic aligns with NFPA codes.
Occupancy Reduction (OR)	Factor	0.7 â 1.0	0â2 decimal places	High-risk occupancy (OR=1.0) cannot have sprinkler reduction <0.5	Ensures high-hazard buildings are not underestimated.
Exposure Distance (ED)	Factor	1.0 â 1.5	0â2 decimal places	Cannot decrease below 1.0; must increase if nearby building exists	Prevents underestimation due to neighboring structures; aligns with ISO / Fairfax County method.

Notes:

Decimal precision should be limited to 2 decimals; more precision is meaningless in fire flow calculations.

Custom values must be validated to fall within safe ranges.

Logical consistency is crucial: e.g., a âHigh-Hazardâ building cannot have OR < 1.0 if sprinkler factor is > 1.0.

2ï¸â£ Output Validation Logic

Raw Fire Flow (before reductions):
fireFlowRaw = 18 Ã C Ã âA Ã ED
Must be â¥ 500 GPM (minimum operational threshold) and â¤ 6000 GPM (max hydrant capacity per NFPA 13 guidelines).

After applying reductions (OR Ã S):

Fire Flow cannot fall below 500 GPM for safety.

Fire Flow cannot exceed 6000 GPM; if calculated > 6000, it should be capped.

Feedback thresholds:

<1000 GPM: Low fire flow â suitable for small offices or low-risk areas.

1000â3000 GPM: Moderate â typical commercial/industrial structures.

>3000 GPM: High â large or high-risk structures; hydrant capacity must be checked. -->