{% extends 'base.html' %}
{% block title %}Reached Concentration Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Reached Concentration Calculator</h1>
        <p>Determine the concentration of an extinguishing agent within an enclosed space to assess fire suppression effectiveness.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="W">Agent Mass (W in kg)</label>
                <input type="number" id="W" class="form-input" placeholder="Enter Agent Mass">
            </div>
            <div class="form-group">
                <label for="SV">Specific Volume (SV in m³/kg)</label>
                <input type="number" id="SV" class="form-input" placeholder="Enter Specific Volume">
            </div>
            <div class="form-group">
                <label for="VW">Volume of Space (VW in m³)</label>
                <input type="number" id="VW" class="form-input" placeholder="Enter Volume of Space">
            </div>
            <button class="calculate-btn" onclick="calculateReachedConcentration()">Calculate Reached Concentration</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Reached Concentration Illustration">
                <p>This tool will calculate the <strong>Reached Concentration</strong>. Enter your data to see results and insights here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Reached Concentration</div>
                <div class="rate-value" id="concentrationValue">0.0000%</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;"> of agent in space</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<!-- Notes Section -->
<div class="note-section">

    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Reached Concentration Calculator</strong> estimates the concentration of an extinguishing agent in an enclosed space after deployment.  
            Systems such as CO₂, FM-200, or inert gases rely on achieving a precise concentration to suppress fires effectively while ensuring personnel safety and preventing equipment damage.
        </p>
        <ul class="note-list">
            <li>Determine if the deployed agent mass is sufficient for effective suppression.</li>
            <li>Ensure compliance with fire safety standards and design codes (NFPA, ISO 14520, EN 15004, NFPA 2001).</li>
            <li>Optimize agent usage to reduce cost and environmental impact while maintaining safety.</li>
            <li>Assess potential risks to personnel from high concentrations and plan safe re-entry.</li>
        </ul>
        <p>
            The calculator uses <strong>Agent Mass (W)</strong>, <strong>Specific Volume (SV)</strong>, and <strong>Volume of Space (VW)</strong> to provide a concentration percentage representing how much of the protected space is occupied by the extinguishing agent.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Agent Mass (W)</strong>: Total mass of the extinguishing agent (kg).</li>
            <li><strong>Specific Volume (SV)</strong>: Volume occupied by one kilogram of agent (m³/kg).</li>
            <li><strong>Volume of Space (VW)</strong>: Protected space volume (m³).</li>
            <li><strong>Reached Concentration (%)</strong>: Percentage concentration of agent in the space.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>All fields (W, SV, VW) are <strong>mandatory</strong>; empty inputs trigger a warning.</li>
            <li>Numeric values only; non-numeric entries are invalid.</li>
            <li>Positive values required; zero or negative numbers are physically impossible.</li>
            <li>Agent Mass (W): 0.1 – 10,000 kg; above 10,000 kg triggers caution.</li>
            <li>Specific Volume (SV): 0.001 – 1 m³/kg; outside this range triggers a warning.</li>
            <li>Volume of Space (VW): 1 – 1,000,000 m³; outside this range triggers caution.</li>
            <li>Cross-field check: W × SV / VW should not exceed ~100% concentration; otherwise, a warning is shown.</li>
            <li>Division by zero, extremely small SV, or extremely high W relative to VW trigger errors.</li>
            <li>All errors/warnings are displayed in the result box; placeholder is hidden when calculation occurs.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>⚠️ <strong>Concentration &lt; 20%</strong>: Low Concentration - May be insufficient for effective fire suppression.</li>
            <li>✅ <strong>Concentration 20–50%</strong>:Moderate Concentration - Partially effective, monitor conditions.</li>
            <li>🚨 <strong>Concentration &gt; 50%</strong>: High Concentration – Effective suppression achieved.</li>
            <li>🔴 <strong>Concentration &gt; 100%</strong>: Calculated concentration exceeds 100%. Check input values for realism.</li>
            <li>Negative or NaN outputs indicate invalid inputs; proper validation prevents errors.</li>
            <li>All feedback displayed with calculation results is repeated here for audit clarity.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        While a "Reached Concentration Calculator" is not a recognized standard, the underlying concept is a fundamental principle of pharmacokinetics. The calculation refers to the concentration of a drug in the body over time, which is essential for determining a proper dosage.
    </p>
    <p><h3>Key Reached Concentration Points:</h3></p>
    <ul class="note-list">
        <li><strong>Peak concentration (Cmax):</strong> This is the maximum concentration a drug reaches in the body after administration. It indicates the highest level of drug exposure. It is crucial for evaluating drug efficacy and safety, as many side effects occur near this peak. The time it takes to reach Cmax is known as Tmax.</li>
        <li><strong>Steady-state concentration (Css):</strong> This is the concentration at which the amount of drug administered is in dynamic equilibrium with the amount being eliminated. It is typically achieved after four to five half-lives of consistent dosing. At steady state, the drug concentration remains consistently within a therapeutic range, ensuring a sustained pharmacological effect. This is the goal for chronic drug therapies, such as with antibiotics, to ensure effective treatment and minimize toxicity.</li>
    </ul>
    <p><h3>Standards and Calculations:</h3></p>
    <ul class="note-list">
        <li>Though there is no single "standard" calculator, the principles used to determine these concentrations are well-established in pharmacology and are based on mathematical models.</li>
        <li>For steady-state concentration, calculators use formulas that consider the rate of drug infusion and the body's clearance rate.</li>
        <li>Loading doses can be used to reach a steady-state concentration more quickly, and calculators can determine the appropriate loading and maintenance doses.</li>
        <li>These calculations are critical in therapeutic drug monitoring to individualize dosing and ensure a safe and effective drug regimen.</li>
    </ul>
  
</div>


    <!-- Conclusion -->
    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            This calculator provides a rapid assessment of extinguishing agent concentration.  
            By combining validated inputs, output thresholds, and compliance with NFPA 2001 and ISO standards, the tool ensures accurate, safe, and auditable evaluation.  
            The result feedback (low, moderate, high, or unrealistic) directly guides safe operational decisions.
        </p>
    </div>

</div>



</div>

<script>
function calculateReachedConcentration() {
    const WInput = document.getElementById('W').value.trim();
    const SVInput = document.getElementById('SV').value.trim();
    const VWInput = document.getElementById('VW').value.trim();
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');

    // Reset display
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Empty check
    if (WInput === "" || SVInput === "" || VWInput === "") {
        resultError.innerHTML = "⚠️ Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    const W = parseFloat(WInput);
    const SV = parseFloat(SVInput);
    const VW = parseFloat(VWInput);

    // Numeric check
    if (isNaN(W) || isNaN(SV) || isNaN(VW)) {
        resultError.innerHTML = "❌ Invalid entry. Please enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Positive checks
    if (W <= 0) {
        resultError.innerHTML = "❌ Agent Mass must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (SV <= 0) {
        resultError.innerHTML = "❌ Specific Volume must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (VW <= 0) {
        resultError.innerHTML = "❌ Volume of Space must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Threshold warnings
    if (W > 10000) {
        resultError.innerHTML = "⚠️ Agent Mass unusually high (>10,000 kg). Verify units.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (SV > 1 || SV < 0.001) {
        resultError.innerHTML = "⚠️ Specific Volume outside typical range (0.001–1 m³/kg). Verify input.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (VW > 1000000) {
        resultError.innerHTML = "⚠️ Space volume unusually large (>1,000,000 m³). Verify input.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Concentration calculation
    const ratio = W * SV / VW;
    if (ratio < 0) {
        resultError.innerHTML = "❌ Calculation error. Check inputs.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    const concentration = (100 * ratio) / (1 + ratio);

    // Edge case: concentration > 100%
    if (concentration > 100) {
        resultError.innerHTML = "⚠️ Calculated concentration exceeds 100%. Check input values for realism.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Display result
    document.getElementById('concentrationValue').innerText = concentration.toFixed(4) + "%";
    resultValue.classList.remove('hidden');

    // Feedback logic
    let feedback = "";
    if (concentration < 20) {
        feedback = "⚠️ Low Concentration: May be insufficient for effective fire suppression.";
        feedbackContent.style.color = "orange";
    } else if (concentration <= 50) {
        feedback = "✅ Moderate Concentration: Partially effective, monitor conditions.";
        feedbackContent.style.color = "green";
    } else {
        feedback = "🚨 High Concentration: Effective suppression achieved.";
        feedbackContent.style.color = "red";
    }
    feedbackContent.innerHTML = feedback;
}

function printReport() {
    window.print();
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1️⃣ Detailed Input Validation Rules (QEHS perspective)
Input	Units	Min	Max	Decimals	Notes / Real-world Constraints
Agent Mass (W)	kg	0.1	10,000	3	Must be positive. Typical suppression systems rarely exceed 10,000 kg. Values above this require a warning.
Specific Volume (SV)	m³/kg	0.001	1	4	Must be positive. Very low values (<0.001 m³/kg) are unrealistic for gaseous agents; very high values (>1 m³/kg) indicate input error or unusual conditions.
Volume of Space (VW)	m³	1	1,000,000	1	Must be positive. Extremely large spaces require engineering validation.

Cross-field dependencies:

If VW is extremely small (<1 m³) with high W, the concentration can be unrealistic (>100%), which should trigger a warning.

W × SV / VW should not exceed ~100 (100% concentration) under normal conditions.

2️⃣ Output Validation Logic

Formula:

Concentration (%)
=
100
×
(
𝑊
⋅
𝑆
𝑉
/
𝑉
𝑊
)
1
+
(
𝑊
⋅
𝑆
𝑉
/
𝑉
𝑊
)
Concentration (%)=
1+(W⋅SV/VW)
100×(W⋅SV/VW)
	​


Thresholds for interpretation (QEHS standard practice):

Concentration (%)	Meaning	Actions
< 20%	Low	Likely ineffective for fire suppression; check agent mass or space volume
20–50%	Moderate	Partially effective; ensure thresholds per NFPA / ISO 14520 are met
> 50%	High	Effective suppression; safe conditions, but monitor for personnel safety

Additional rules:

Negative or NaN outputs → input validation failed.

Concentration > 100% → indicates unrealistic input combination; prompt a warning.

3️⃣ Edge Cases and Handling
Edge Case	Handling
Empty input	Show warning “⚠️ Please fill in all required fields.”
Non-numeric input	Show error “❌ Invalid entry. Please enter numeric values only.”
Zero or negative values	Reject and warn; concentration calculation is meaningless.
Extremely high W / low VW	Warn about potential over-concentration (>100%) and unrealistic scenario.
Extremely small SV	Warn about likely input error or agent mismatch.
Division by zero (VW = 0)	Prevent calculation; show error.
Extremely large numbers	Show caution message but allow calculation if physically reasonable. -->