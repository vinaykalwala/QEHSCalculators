{% extends 'base.html' %}
{% block title %}Combustion Efficiency (CE) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Combustion Efficiency (CE) Calculator</h1>
        <p>Evaluate how effectively fuel is burned in combustion systems by calculating the combustion efficiency (CE).</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="co2">CO<sub>2</sub> Concentration [ppm]</label>
                <input type="number" id="co2" class="form-input" placeholder="Enter CO₂ concentration" step="any">
            </div>
            <div class="form-group">
                <label for="co">CO Concentration [ppm]</label>
                <input type="number" id="co" class="form-input" placeholder="Enter CO concentration" step="any">
            </div>
            <button class="calculate-btn" onclick="calculateCE()">Calculate CE</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/combustion.png' %}" alt="Combustion Efficiency Illustration">
                <p>This tool will calculate the <strong>Combustion Efficiency (CE)</strong>. Enter your data to see results and feedback here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value" id="ceValue">0.0000%</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">Combustion Efficiency</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
            <h3>📘 About This Calculator</h3>
            <p>
                This calculator determines the <strong>Combustion Efficiency (CE)</strong>, which is essential for evaluating how effectively fuel is burned in combustion systems. 
                It is widely used in industrial combustion processes, power plants, and environmental monitoring to optimize fuel usage and minimize pollutant emissions.
            </p>
        </div>

        <div class="note-card">
            <h3>⚙️ Parameters</h3>
            <ul class="note-list">
                 <li><strong>CO₂ Concentration:</strong> The volume concentration of carbon dioxide (CO₂) in the exhaust gases, measured in parts per million (ppm).</li>
        <li><strong>CO Concentration:</strong> The volume concentration of carbon monoxide (CO) in the exhaust gases, measured in parts per million (ppm).</li>
        <li><strong>CE (%):</strong> The efficiency of the combustion process in converting fuel into useful energy, calculated using the formula:</li>
  </ul>
        </div>
<div class="note-card">
    <h3>🛡️ Input Validations</h3>
    <ul class="note-list">
        <li>All fields are <strong>mandatory</strong> – leaving CO₂ or CO empty will trigger a warning.</li>
        <li><strong>Numeric values only:</strong> Non-numeric entries are not allowed.</li>
        <li><strong>Non-negative values:</strong> CO₂ and CO must be zero or positive.</li>
        <li><strong>Logical consistency:</strong> CO₂ and CO cannot both be zero (combustion must produce gases).</li>
        <li><strong>Realistic thresholds:</strong> CO₂ ≤ 20,000 ppm, CO ≤ 5,000 ppm – values beyond this range prompt a caution to verify units.</li>
        <li><strong>Decimal precision:</strong> Up to 2–4 decimal places, reflecting typical gas analyzer accuracy.</li>
        <li><strong>Feedback guidance:</strong> 
            <ul>
                <li>CE ≥ 99% → Excellent combustion.</li>
                <li>CE 90–98.99% → Good efficiency.</li>
                <li>CE 75–89.99% → Poor combustion.</li>
                <li>CE &lt; 75% → Critical combustion, immediate corrective action required.</li>
            </ul>
        </li>
    </ul>
</div>


        <div class="note-card">
            <h3>📌 Real-life Applications</h3>
            <ul class="note-list">
                <li>Power plants: Improve efficiency of coal, gas, and biomass combustion.</li>
                <li>Industrial boilers: Optimize fuel combustion in manufacturing plants.</li>
                <li>Automobile emissions testing: Evaluate engine efficiency and exhaust gas quality.</li>
                <li>Waste incineration: Reduce CO emissions and improve incinerator performance.</li>
                <li>HVAC systems: Ensure efficient heating and ventilation operations.</li>
            </ul>
        </div>
         <div class="note-card">
            <h3>Conclusion</h3>
                <p>The CE calculation is a **critical tool for energy efficiency and environmental protection**. Understanding it allows industries to **optimize combustion**, **reduce fuel wastage**, and **minimize air pollution**.</p>

        </div>
    </div>
</div>

<script>
function calculateCE() {
    const co2Input = document.getElementById('co2').value.trim();
    const coInput = document.getElementById('co').value.trim();
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');
    const ceValue = document.getElementById('ceValue');

    // Reset display states
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Empty check
    if (co2Input === "" || coInput === "") {
        resultError.innerHTML = "⚠️ Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    const co2 = parseFloat(co2Input);
    const co = parseFloat(coInput);

    // Numeric check
    if (isNaN(co2) || isNaN(co)) {
        resultError.innerHTML = "❌ Invalid entry. Please enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Non-negative check
    if (co2 < 0) {
        resultError.innerHTML = "❌ CO₂ concentration must be non-negative.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (co < 0) {
        resultError.innerHTML = "❌ CO concentration must be non-negative.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Realistic thresholds
    if (co2 > 20000) {
        resultError.innerHTML = "⚠️ CO₂ exceeds typical flue gas range. Verify measurement units.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (co > 5000) {
        resultError.innerHTML = "⚠️ CO exceeds typical flue gas range. Verify measurement units.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Division by zero / logical check
    if (co2 + co === 0) {
        resultError.innerHTML = "❌ CO₂ and CO cannot both be zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // CE Calculation
    const CE = (co2 / (co2 + co)) * 100;

    // Feedback
    let feedback = "";
    let color = "";
    if (CE >= 99) {
        feedback = "✅ Excellent Combustion: Highly efficient fuel utilization.";
        color = "green";
    } else if (CE >= 90) {
        feedback = "⚠️ Good Efficiency: Acceptable but may need optimization.";
        color = "orange";
    } else if (CE >= 75) {
        feedback = "❌ Poor Combustion: Significant fuel loss and emissions.";
        color = "red";
    } else {
        feedback = "❌ Critical Combustion: Unsafe, immediate corrective action required!";
        color = "darkred";
    }

    ceValue.innerText = CE.toFixed(2) + "%";
    feedbackContent.innerHTML = feedback;
    feedbackContent.style.color = color;
    resultValue.classList.remove('hidden');
}

</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Analysis of Inputs, Outputs, and Formula

Inputs:

Parameter	Unit	Description
CO₂	ppm	Carbon dioxide concentration in flue/exhaust gas.
CO	ppm	Carbon monoxide concentration in flue/exhaust gas.

Formula:

CE (%)
=
CO₂
CO₂ + CO
×
100
CE (%)=
CO₂ + CO
CO₂
	​

×100

Output:

CE (%) — indicates combustion efficiency.

Feedback categories:

CE ≥ 99% → Excellent

CE 90–98.99% → Good

CE < 90% → Poor

Real-world Relevance:

CO₂ is a combustion product; CO indicates incomplete combustion.

CE gives a KPI to evaluate fuel efficiency, safety, and emissions compliance.

2. Recommended Input Validation Rules

Based on industrial standards (OSHA, ISO 45001, NFPA, ILO):

Validation	Recommended Limits / Rules	Rationale
Numeric only	Only allow numbers (integers or decimals)	Prevent calculation errors and invalid entries
Mandatory	Both CO₂ and CO are required	CE cannot be computed without values
Non-negative	CO₂ ≥ 0, CO ≥ 0	Negative concentrations are physically impossible
Minimum measurable	CO₂ ≥ 50 ppm (typical flue), CO ≥ 0 ppm	Avoid trivial readings, ensure measurable range
Maximum realistic	CO₂ ≤ 20,000 ppm, CO ≤ 5,000 ppm	Extreme outliers indicate input error; typical combustion flue gases have CO₂ < 20,000 ppm, CO < 5,000 ppm
Logical consistency	CO₂ + CO > 0	Prevent division by zero and ensure gas is produced
Decimal precision	Up to 2–4 decimal places	Reflects measurement instrument precision (gas analyzers usually 1–4 decimal places)
3. Edge Case Validations

CO₂ = 0, CO > 0 → CE = 0%, indicates complete incomplete combustion → warn user.

CO₂ >> CO → CE > 99%, confirm realistic.

CO >> CO₂ → CE < 50%, high emission hazard.

CO₂ + CO = 0 → Division by zero → show error.

Extremely high inputs → prompt “Verify units and measurement” (to prevent unrealistic reporting).

4. Output Validation Logic and Thresholds
CE (%)	Feedback	QEHS Interpretation
CE ≥ 99	✅ Excellent	Compliant with efficiency standards, minimal emissions, safe operation
90 ≤ CE < 99	⚠️ Good	Acceptable; may need minor adjustments to optimize fuel usage and reduce CO
75 ≤ CE < 90	❌ Poor	Significant fuel loss and higher CO emissions; risk of non-compliance
CE < 75	❌ Critical	Unsafe, high emissions; immediate action required (system maintenance or process adjustment)

Why important:

Ensures compliance with emission regulations and operational safety standards.

Highlights potential risk of CO accumulation (toxic hazard).

Supports environmental reporting and audits. -->