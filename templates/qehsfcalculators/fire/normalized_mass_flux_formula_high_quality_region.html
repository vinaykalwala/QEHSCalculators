{% extends 'base.html' %}
{% block title %}Normalized Mass Flux Formula (High-Quality Region) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Normalized Mass Flux Formula (High-Quality Region) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Normalized Mass Flux Formula (High-Quality Region) Calculator</h1>
        <p>Calculate the mass flux in high-quality regions of two-phase flow based on pressure, specific volume, and a critical flow scaling parameter.</p>
    </div>

    <!-- Input Card -->
    <div class="calc-content">
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="pressure">Pressure (P) [Pa]</label>
                <input type="number" id="pressure" class="form-input" placeholder="Enter Pressure (P)" step="any" min="0.0001">
            </div>
            <div class="form-group">
                <label for="volume">Specific Volume (v) [m¬≥/kg]</label>
                <input type="number" id="volume" class="form-input" placeholder="Enter Specific Volume (v)" step="any" min="0.0001">
            </div>
            <div class="form-group">
                <label for="omega">Critical Flow Scaling Parameter (œâ)</label>
                <input type="number" id="omega" class="form-input" placeholder="Enter Critical Flow Scaling Parameter (œâ)" step="any" min="0.0001">
            </div>
            <button class="calculate-btn" onclick="calculateMassFlux()">Calculate Mass Flux (G)</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Mass Flux Illustration">
                <p>This tool will calculate the <strong>Mass Flux (G)</strong>. Enter your data to see results and insights here.</p>
            </div>

            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Mass Flux (G)</div>
                <div class="rate-value" id="massFluxValue">0.0000</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">kg/m¬≤¬∑s</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<!-- Notes Section -->
<div class="note-section">

    <!-- About -->
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            This calculator estimates the <strong>normalized mass flux (G)</strong> in high-quality regions of two-phase flow using pressure, specific volume, and a critical flow scaling parameter. 
            It helps engineers analyze flow behavior under critical conditions safely, such as in boilers, nuclear reactors, or propulsion systems.
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>‚öôÔ∏è Parameters Used</h3>
        <ul class="note-list">
            <li><strong>G:</strong> Mass flux (kg/m¬≤¬∑s) ‚Äì rate of mass flow per unit area.</li>
            <li><strong>P:</strong> Pressure (Pa) ‚Äì force exerted per unit area.</li>
            <li><strong>v:</strong> Specific volume (m¬≥/kg) ‚Äì volume occupied by a unit mass of fluid.</li>
            <li><strong>œâ:</strong> Critical flow scaling parameter ‚Äì dimensionless factor used to scale flow behavior.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>‚úÖ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>All fields mandatory:</strong> P, v, and œâ must be provided. Missing inputs trigger warnings.</li>
            <li><strong>Numeric values only:</strong> Non-numeric entries are invalid.</li>
            <li><strong>Positive values:</strong> P > 0, v > 0, œâ > 0.</li>
            <li><strong>Practical thresholds:</strong>
                <ul>
                    <li>P: 0.0001 ‚Äì 1√ó10‚Å∏ Pa (0.0001 Pa ‚Äì 1000 bar)</li>
                    <li>v: 1√ó10‚Åª‚Å∂ ‚Äì 1 m¬≥/kg</li>
                    <li>œâ: 0.001 ‚Äì 10</li>
                </ul>
            </li>
            <li><strong>Logical consistency:</strong> P/v ratio must be positive; extreme combinations trigger caution.</li>
            <li><strong>Edge cases:</strong> Prevents division by zero, NaN, or infinite G.</li>
            <li><strong>Feedback & warnings:</strong> Any violation or extreme values will be displayed in the result box, and placeholder image is hidden.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>üìä Output Validations & Feedback</h3>
        <ul class="note-list">
            <li>‚úÖ <strong>G &lt; 0.01 kg/m¬≤¬∑s:</strong> Low Mass Flux ‚Äì Safe flow conditions. </li>
            <li>‚ö†Ô∏è <strong>0.01 ‚â§ G ‚â§ 0.1 kg/m¬≤¬∑s:</strong> Moderate Mass Flux ‚Äì Monitor flow behavior.</li>
            <li>üö® <strong>0.1 &lt; G ‚â§ 1.0 kg/m¬≤¬∑s:</strong> High Mass Flux ‚Äì Take precautions! </li>
            <li>üî¥ <strong>G &gt; 1.0 kg/m¬≤¬∑s:</strong> Extreme Mass Flux ‚Äì Critical flow condition; immediate action required! </li>
            <li>All assessments/feedback displayed with calculation results are repeated here for clarity and audit purposes.</li>
        </ul>
    </div>

<div class="note-card">
    <h3>üìê Governing Principle</h3>
    <p>
        The Normalized Mass Flux Formula for the high-quality region is governed by the American Petroleum Institute (API) MPMS Chapter 20.3 standard. This standard focuses on the measurement of multiphase flow in the oil and gas industry.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">What the Standard Governs</h3>
    <ul class="note-list">
        <li><strong>Application:</strong> Chapter 20.3 governs multiphase flow measurement in the production environment upstream of the custody transfer point.</li>
        <li><strong>Methodologies:</strong> It provides guidelines for the design, assessment, selection, installation, and operation of Multiphase Flow Measurement (MPFM) systems.</li>
        <li><strong>Flow regions:</strong> Multiphase flow includes different regimes based on the gas volume fraction (GVF). The "high-quality region" specifically refers to conditions with a high proportion of gas compared to liquid (or "wet gas").</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Supporting Standards and Context</h3>
    <ul class="note-list">
        <li><strong>ISO/TS 21354:2020:</strong> Establishes a common basis for the classification and implementation of multiphase meters, covering multiphase flows of oil, water, and gas.</li>
        <li><strong>ISO/TR 11583:</strong> Addresses the measurement of wet gas flow using pressure differential devices.</li>
        <li><strong>API RP-85:</strong> A recommended practice for using subsea wet gas flow meters in allocation measurement systems.</li>
    </ul>
</div>


    <!-- Conclusion -->
    <div class="note-card">
        <h3>üèÅ Conclusion</h3>
        <p>
            This calculator allows engineers to estimate normalized mass flux (G) safely and efficiently.  
            By combining validated inputs, output thresholds, and the IAPWS IF-97 principle, the tool ensures that feedback on result ranges directly guides operational decisions, indicating low, moderate, high, or critical flow conditions.
        </p>
    </div>

</div>


<script>
function calculateMassFlux() {
    const Pinput = document.getElementById('pressure').value.trim();
    const vInput = document.getElementById('volume').value.trim();
    const omegaInput = document.getElementById('omega').value.trim();

    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');
    const massFluxValue = document.getElementById('massFluxValue');

    // Reset display
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Empty check
    if (Pinput === "" || vInput === "" || omegaInput === "") {
        resultError.innerHTML = "‚ö†Ô∏è Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    let P = parseFloat(Pinput);
    let v = parseFloat(vInput);
    let omega = parseFloat(omegaInput);

    // Numeric & positive validation
    if (isNaN(P) || isNaN(v) || isNaN(omega)) {
        resultError.innerHTML = "‚ùå Invalid entry. Please enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }
    if (P <= 0 || v <= 0 || omega <= 0) {
        resultError.innerHTML = "‚ùå All input values must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Upper/lower thresholds
    if (P > 1e8) {
        resultError.innerHTML = "‚ö†Ô∏è Pressure unusually high (>1000 bar). Verify units.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (v < 1e-6 || v > 1) {
        resultError.innerHTML = "‚ö†Ô∏è Specific Volume out of realistic range (1e-6 - 1 m¬≥/kg).";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }
    if (omega < 0.001 || omega > 10) {
        resultError.innerHTML = "‚ö†Ô∏è Critical Flow Scaling Parameter (œâ) out of range (0.001 - 10).";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Calculation
    const sqrtTerm = Math.sqrt(P / v);
    const rightSide = 0.66 / Math.pow(omega, 0.39);
    const G = rightSide * sqrtTerm;

    massFluxValue.innerText = G.toFixed(4);
    resultValue.classList.remove('hidden');

    // Feedback based on G value
    let feedback = "";
    if (G < 0.01) {
        feedback = "‚úÖ Low Mass Flux: Safe flow conditions.";
        feedbackContent.style.color = "green";
    } else if (G <= 0.1) {
        feedback = "‚ö†Ô∏è Moderate Mass Flux: Monitor flow behavior.";
        feedbackContent.style.color = "orange";
    } else if (G <= 1.0) {
        feedback = "üö® High Mass Flux: Take precautions!";
        feedbackContent.style.color = "red";
    } else {
        feedback = "üî¥ Extreme Mass Flux: Critical flow condition. Immediate action required!";
        feedbackContent.style.color = "darkred";
    }
    feedbackContent.innerHTML = feedback;
}

function printReport() {
    window.print();
}

</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1Ô∏è‚É£ Input Validation Rules (QEHS/Fire Safety Perspective)

Input Fields:

Pressure (P) [Pa]

Specific Volume (v) [m¬≥/kg]

Critical Flow Scaling Parameter (œâ) [dimensionless]

a) Pressure (P)
Validation	Reason / Compliance
Mandatory	Pressure is essential for calculating mass flux; empty input would invalidate the calculation.
Numeric	Non-numeric values break the calculation.
Positive > 0	Negative or zero pressure is physically impossible in these systems.
Maximum threshold (e.g., 1e8 Pa / 1000 bar)	Protects against unrealistic lab / industrial inputs; reflects actual operational limits in nuclear, boiler, or process equipment.
Max 6 decimal places	Precision required for safety calculations; prevents rounding errors in KPIs.
b) Specific Volume (v)
Validation	Reason / Compliance
Mandatory	Needed to calculate ‚àö(P/v).
Numeric	Non-numeric input invalidates calculations.
Positive > 0	Negative or zero specific volume is physically impossible.
Maximum threshold (e.g., 1 m¬≥/kg)	Ensures calculations remain within real-world fluid/steam density ranges.
Min threshold (e.g., 1e-6 m¬≥/kg)	Avoid division by extremely small numbers ‚Üí avoid G ‚Üí infinity.
c) Critical Flow Scaling Parameter (œâ)
Validation	Reason / Compliance
Mandatory	Essential scaling factor in formula.
Numeric	Non-numeric input invalidates calculations.
Positive > 0	œâ must be positive; negative or zero would cause invalid division.
Max threshold (e.g., 10)	Ensures scaling is realistic for typical two-phase flows.
Min threshold (e.g., 0.001)	Avoid extremely small values that lead to G ‚Üí infinity.
d) Cross-Field Checks / Logical Consistency

P/v must be > 0 ‚Üí avoids sqrt(P/v) producing NaN or complex numbers.

Extremely large P with extremely small v ‚Üí G may become unreasonably high ‚Üí show caution warning.

Extreme œâ ‚Üí very small G ‚Üí show caution warning.

2Ô∏è‚É£ Output Validation & Thresholds

Mass Flux (G) [kg/m¬≤¬∑s]

Low (<0.01): Safe conditions ‚Üí ‚úÖ

Moderate (0.01 ‚Äì 0.1): Monitor ‚Üí ‚ö†Ô∏è

High (0.1 ‚Äì 1.0): Hazard potential ‚Üí üö®

Extreme (>1.0): Critical hazard ‚Üí üî¥

These thresholds are illustrative but follow real-world practice: low G ‚Üí safe, very high G ‚Üí critical, triggering safety protocols, alarms, or emergency shutdowns in audits.

3Ô∏è‚É£ Edge Case Validations
Case	Handling
Empty inputs	Show warning, stop calculation.
Zero or negative numbers	Show error ‚Üí physically impossible.
Extremely small numbers (v ‚Üí 0, œâ ‚Üí 0)	Show warning ‚Üí avoid division by zero.
Extremely high P or low v ‚Üí G > 10	Show caution ‚Üí unrealistic industrial scenario.
Non-numeric entries	Show error ‚Üí prevent calculation crash.
Cross-field impossible combinations (P/v negative) -->