{% extends 'base.html' %}
{% block title %}Final design Quantity for co2 calcualtor{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 36px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
          @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>
<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Final Design Quantity for CO‚ÇÇ Calculator</h1>
        <p>Determine the final CO‚ÇÇ amount required for fire suppression, including adjustments for leakage, ventilation, and temperature.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="mD">Modified Quantity (m<sub>D</sub>) [kg]:</label>
                <input type="number" id="mD" class="form-input" placeholder="Enter Modified Quantity (mD)">
            </div>
            <div class="form-group">
                <label for="mlo">Leakage Adjustment (m<sub>lo</sub>) [kg]:</label>
                <input type="number" id="mlo" class="form-input" placeholder="Enter Leakage Adjustment (mlo)">
            </div>
            <div class="form-group">
                <label for="mlv">Ventilation Adjustment (m<sub>lv</sub>) [kg]:</label>
                <input type="number" id="mlv" class="form-input" placeholder="Enter Ventilation Adjustment (mlv)">
            </div>
            <div class="form-group">
                <label for="mT">Temperature Adjustment (m<sub>T</sub>) [kg]:</label>
                <input type="number" id="mT" class="form-input" placeholder="Enter Temperature Adjustment (mT)">
            </div>
            <button class="calculate-btn" onclick="calculateFinalDesignQuantity()">Calculate Final Design Quantity</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/co2.jpg' %}" alt="Final Design Quantity Illustration">
                <p>This tool will calculate the <strong>Final Design Quantity (m<sub>FD</sub>)</strong>. Enter your data to see results here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 20px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Final Design Quantity (m<sub>FD</sub>)</div>
                <div class="rate-value" id="finalDesignValue">0.00</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">kg</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">

        <!-- About This Calculator -->
        <div class="note-card">
            <h3>üìò About This Calculator</h3>
            <p>
                This calculator determines the <strong>Final Design Quantity (m<sub>FD</sub>)</strong> of CO‚ÇÇ required for fire suppression, including adjustments for leakage, ventilation, and temperature extremes.
                It ensures accurate CO‚ÇÇ dosing for effective fire protection.
            </p>
        </div>

        <!-- Parameters -->
        <div class="note-card">
            <h3>‚öôÔ∏è Parameters Used</h3>
            <ul class="note-list">
                <li><strong>Modified Quantity (m<sub>D</sub>)</strong>: Base CO‚ÇÇ amount in kilograms (kg).</li>
                <li><strong>Leakage Adjustment (m<sub>lo</sub>)</strong>: Extra CO‚ÇÇ to compensate for leaks (kg).</li>
                <li><strong>Ventilation Adjustment (m<sub>lv</sub>)</strong>: CO‚ÇÇ compensation for airflow (kg).</li>
                <li><strong>Temperature Adjustment (m<sub>T</sub>)</strong>: CO‚ÇÇ compensation for temperature extremes (kg).</li>
            </ul>
        </div>

        <!-- How It Works -->
        <div class="note-card">
            <h3>‚ö° How It Works</h3>
            <p>
                The final design quantity is calculated by summing the modified quantity with leakage, ventilation, and temperature adjustments. 
                This ensures that the system delivers the correct CO‚ÇÇ amount under real-world conditions.
            </p>
        </div>

        <!-- Why This Matters -->
        <div class="note-card">
            <h3>üí° Why This Matters</h3>
            <ul class="note-list">
                <li>Compliance with fire safety standards and regulations.</li>
                <li>Optimal CO‚ÇÇ usage, reducing waste and costs.</li>
                <li>Ensures fire suppression effectiveness in real-world conditions.</li>
            </ul>
        </div>

        <!-- Validations -->
        <div class="note-card">
    <h3>üõ°Ô∏è Input Validations</h3>
    <ul class="note-list">
        <li>All fields are <strong>mandatory</strong> ‚Äì empty fields trigger a warning.</li>
        <li><strong>Numeric values only:</strong> Non-numeric entries are invalid.</li>
        <li><strong>Modified Quantity (m<sub>D</sub>)</strong> must be greater than zero. Negative or zero values are not allowed.</li>
        <li>Modified Quantity above <code>10,000 kg</code> triggers a caution for unusually high input.</li>
        <li><strong>Leakage (m<sub>lo</sub>), Ventilation (m<sub>lv</sub>), Temperature (m<sub>T</sub>) Adjustments</strong> must be zero or positive.</li>
        <li>Adjustments above <code>5,000 kg</code> trigger a caution for unusually high values.</li>
        <li>Any errors or warnings will be displayed in the result box; the default placeholder image is hidden when an error occurs.</li>
        <li>Validation ensures all inputs are realistic and consistent with fire safety standards.</li>
    </ul>
</div>

         <!-- Usage -->
       <div class="note-card">
    <p>
        Enter the required values and click <strong>Calculate Final Design Quantity</strong> to see the result. 
        This calculation aids fire safety engineers and facility managers in designing effective suppression systems.
    </p>
    <p>
        If you need assistance calculating the <strong>Modified CO‚ÇÇ Quantity</strong>, please use the following link:
    </p>
    <ul style="display: flex; flex-wrap: wrap; justify-content: center; padding: 0; margin: 0; list-style: none;">
        <li style="margin: 10px; flex: 1 1 100%; text-align: center;">
            <a href="{% url 'fire_modified_co_quantity_calculator' %}" 
               style="background-color: #1560bd; padding: 12px 24px; color: white; border-radius: 10px; 
                      text-decoration: none; font-weight: 500; display: inline-block; width: 90%; max-width: 300px; transition: background 0.3s;">
                Modified CO‚ÇÇ Quantity Calculator
            </a>
        </li>
    </ul>
</div>

    </div>
</div>

<script>
function calculateFinalDesignQuantity() {
    const mDInput = document.getElementById("mD").value.trim();
    const mloInput = document.getElementById("mlo").value.trim();
    const mlvInput = document.getElementById("mlv").value.trim();
    const mTInput = document.getElementById("mT").value.trim();

    const resultError = document.getElementById("resultError");
    const resultValue = document.getElementById("resultValue");
    const placeholder = document.getElementById("placeholder");
    const feedbackContent = document.getElementById("feedbackContent");
    const finalDesignValue = document.getElementById("finalDesignValue");

    // Reset UI
    resultError.classList.add("hidden");
    resultValue.classList.add("hidden");
    placeholder.classList.add("hidden");
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Empty check
    if (!mDInput || !mloInput || !mlvInput || !mTInput) {
        resultError.innerHTML = "‚ö†Ô∏è Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    // Parse floats
    const mD = parseFloat(mDInput);
    const mlo = parseFloat(mloInput);
    const mlv = parseFloat(mlvInput);
    const mT = parseFloat(mTInput);

    // Numeric check
    if (isNaN(mD) || isNaN(mlo) || isNaN(mlv) || isNaN(mT)) {
        resultError.innerHTML = "‚ùå Invalid entry. Please enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }

    // Positive check
    if (mD <= 0) {
        resultError.innerHTML = "‚ùå Modified Quantity (mD) must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }
    if (mlo < 0 || mlv < 0 || mT < 0) {
        resultError.innerHTML = "‚ùå Adjustments cannot be negative.";
        resultError.style.color = "red";
        resultError.classList.remove("hidden");
        return;
    }

    // Upper threshold cautions
    if (mD > 10000) {
        resultError.innerHTML = "‚ö†Ô∏è Modified Quantity is unusually high (>10,000 kg). Verify units.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }
    if (mlo > 5000 || mlv > 5000 || mT > 5000) {
        resultError.innerHTML = "‚ö†Ô∏è One or more adjustments are unusually high (>5,000 kg). Verify units.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    // Cross-field ratio check
    const totalAdjustments = mlo + mlv + mT;
    if (totalAdjustments / mD > 0.5) {
        resultError.innerHTML = "‚ö†Ô∏è Total adjustments exceed 50% of base quantity. Verify design.";
        resultError.style.color = "orange";
        resultError.classList.remove("hidden");
        return;
    }

    // Calculation
    const mFD = mD + mlo + mlv + mT;
    finalDesignValue.innerText = mFD.toFixed(2);
    resultValue.classList.remove("hidden");

    // Feedback based on magnitude
    let feedback = "";
    if (mFD < 100) {
        feedback = "‚ö†Ô∏è CO‚ÇÇ quantity is very low ‚Äì verify protected volume.";
        feedbackContent.style.color = "orange";
    } else if (mFD <= 5000) {
        feedback = "‚úÖ Final Design Quantity is within normal range.";
        feedbackContent.style.color = "green";
    } else if (mFD <= 20000) {
        feedback = "‚ö†Ô∏è High CO‚ÇÇ quantity ‚Äì verify large space or adjustments.";
        feedbackContent.style.color = "orange";
    } else {
        feedback = "üö® Extreme CO‚ÇÇ quantity ‚Äì check inputs and design.";
        feedbackContent.style.color = "red";
    }
    feedbackContent.innerHTML = feedback;
}

function printReport() {
    window.print();
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Input Analysis and Calculation Logic

Inputs:

Input	Description	Units	QEHS Relevance
Modified Quantity (mD)	Base CO‚ÇÇ required for the protected space	kg	Represents the fundamental fire suppression requirement; must comply with NFPA 12/ISO standards for CO‚ÇÇ discharge.
Leakage Adjustment (mlo)	Additional CO‚ÇÇ for room leakages	kg	Compensates for gaps/doors, prevents sub-optimal concentrations.
Ventilation Adjustment (mlv)	CO‚ÇÇ adjustment due to airflow/ventilation	kg	Ensures proper concentration in spaces with active ventilation.
Temperature Adjustment (mT)	CO‚ÇÇ adjustment for temperature extremes	kg	Accounts for CO‚ÇÇ density/dispersion variations with temperature; ensures minimum fire suppression concentration.

Calculation Formula:

ùëö
ùêπ
ùê∑
=
ùëö
ùê∑
+
ùëö
ùëô
ùëú
+
ùëö
ùëô
ùë£
+
ùëö
ùëá
m
FD
	‚Äã

=m
D
	‚Äã

+m
lo
	‚Äã

+m
lv
	‚Äã

+m
T
	‚Äã


Output: mFD ‚Äì Total CO‚ÇÇ quantity required for fire suppression (kg).

Safety Check: Ensure mFD is sufficient to maintain required fire suppression concentration in all conditions.

2. Comprehensive Input Validation Rules
Input	Validation Rules	Acceptable Ranges	Notes
mD	Required, numeric, > 0	1 ‚Äì 10,000 kg	Base quantity must be positive; >10,000 kg triggers a caution (could indicate a very large space).
mlo	Required, numeric, ‚â• 0	0 ‚Äì 5,000 kg	Leakage adjustment cannot be negative; unusually high values (>5,000 kg) trigger caution.
mlv	Required, numeric, ‚â• 0	0 ‚Äì 5,000 kg	Same as above.
mT	Required, numeric, ‚â• 0	0 ‚Äì 5,000 kg	Same as above.
All fields	Must be numeric	N/A	Non-numeric input triggers immediate error.

Decimal precision:

Up to 2 decimal places is sufficient for fire suppression CO‚ÇÇ quantities.

Values entered with more than 2 decimals should be rounded internally.

Cross-field logic:

Adjustments should not exceed 50% of mD in normal scenarios; higher ratios should trigger a caution.

mFD must always be ‚â• mD.

3. Edge Case Validations
Edge Case	Handling	Reason
Empty inputs	Show warning: "Please fill in all required fields"	Prevent calculation errors.
Negative numbers	Show error: "Adjustments cannot be negative / Base quantity must be >0"	Negative CO‚ÇÇ is physically impossible.
Excessive inputs	Show caution: "Value unusually high, verify units"	Prevent data entry errors or unrealistic design.
Extremely small inputs (close to 0)	Show warning: "Value too low, may not meet suppression requirements"	Ensures compliance with NFPA 12 minimum concentration.
Non-numeric inputs	Show error: "Enter numeric values only"	Prevent NaN calculations.
Extreme ratio of adjustment > 50% of mD	Show caution: "Adjustment unusually high relative to base quantity"	Highlights potential design or entry error.
4. Output Validation and Feedback Logic

mFD must always be ‚â• mD.

Provide clear safety feedback based on magnitude:

mFD (kg)	Feedback	Color
< 100	‚ö†Ô∏è Small CO‚ÇÇ quantity ‚Äì check protected volume	Orange
100‚Äì5,000	‚úÖ Normal range ‚Äì safe	Green
> 5,000	‚ö†Ô∏è High CO‚ÇÇ quantity ‚Äì verify large space or adjustments	Orange
> 20,000	üö® Extreme quantity ‚Äì review design; potential error	Red

Round all outputs to 2 decimals for clarity.

Display feedback dynamically with color coding. -->