{% extends 'base.html' %}
{% block title %}Nitrogen Equivalency (Kik) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <!-- Header -->
    <div class="calculator-header">
        <h1>Nitrogen Equivalency (Kik) Calculator</h1>
        <p>Calculate the coefficient of nitrogen equivalency to assess inert gas effectiveness in preventing flammability.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="mxcik">MXCik (mol%)</label>
                <input type="number" id="mxcik" class="form-input" placeholder="Enter MXCik value">
            </div>
            <div class="form-group">
                <label for="tci">Tci</label>
                <input type="number" id="tci" class="form-input" placeholder="Enter Tci value">
            </div>
            <button class="calculate-btn" onclick="calculateKik()">Calculate Kik</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Kik Illustration">
                <p>
                    This tool will calculate the <strong>Kik Value</strong>. Enter your MXCik and Tci values to see results and insights here.
                </p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 20px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Kik Value</div>
                <div class="rate-value" id="kikResult">0.000</div>
                <div class="rate-label" style="font-size:16px; font-weight:bold;">Coefficient of Nitrogen Equivalency</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

 <!-- Notes Section -->
<div class="note-section">

    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Coefficient of Nitrogen Equivalency (Kik)</strong> evaluates the effectiveness of an inert gas in suppressing flammability within a gas mixture. 
            It helps determine if the inert gas concentration is sufficient to prevent ignition of flammable gases, supporting fire safety, explosion prevention, and safe industrial gas handling.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>MXCik (mol%):</strong> Maximum concentration of a flammable gas in the inert gas mixture that remains non-flammable.
                <ul>
                    <li>Measured in mole percentage (mol%).</li>
                    <li>Higher MXCik indicates lower inert gas requirements.</li>
                </ul>
            </li>
            <li><strong>Tci (mol%):</strong> Threshold critical concentration of the flammable gas.
                <ul>
                    <li>Above this value, the mixture may ignite.</li>
                    <li>Used to calculate Kik and determine safety margins.</li>
                </ul>
            </li>
            <li><strong>Kik:</strong> Coefficient of Nitrogen Equivalency, representing the suppression effectiveness of the inert gas.
                <ul>
                    <li>Lower Kik values indicate safer mixtures.</li>
                    <li>Higher Kik values indicate potential flammability risks.</li>
                </ul>
            </li>
        </ul>
    </div>

    <!-- Input Validations -->
    <div class="note-card">
        <h3>🛡️ Input Validations</h3>
        <ul class="note-list">
            <li><strong>MXCik (mol%):</strong> Required, numeric, >0, ≤100, and ≤Tci.</li>
            <li><strong>Tci (mol%):</strong> Required, numeric, >0, ≤100.</li>
            <li><strong>Decimals:</strong> Maximum 3 decimal places for precision.</li>
            <li><strong>Logical Consistency:</strong> MXCik ≤ Tci to ensure physically meaningful Kik values.</li>
            <li><strong>Empty / Non-numeric Values:</strong> Not allowed; both fields must contain valid numeric inputs.</li>
            <li><strong>Edge Cases:</strong>
                <ul>
                    <li>MXCik = 100 → Prevent calculation (division by zero risk).</li>
                    <li>Tci = 0 → Prevent calculation (division by zero).</li>
                    <li>MXCik > Tci → Show error and prompt review.</li>
                    <li>Extremely high or low values → Display warning for unrealistic input.</li>
                </ul>
            </li>
            <li><strong>Compliance:</strong> All validations align with <strong>NFPA, ISO 45001, OSHA, and ILO</strong> standards.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations & Feedback</h3>
        <ul class="note-list">
            <li><strong>Kik &lt; 0:</strong> ❌ Invalid mixture; physically impossible. Review input values.</li>
            <li><strong>Kik 0–1:</strong> ✅ Safe mixture; inert gas effectively suppresses flammability.</li>
            <li><strong>Kik 1–2:</strong> ⚠️ Moderate risk; consider increasing inert gas or improving ventilation.</li>
            <li><strong>Kik &gt; 2:</strong> 🔥 High risk; immediate mitigation required (increase inert gas, improve ventilation, restrict operations).</li>
        </ul>
    </div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A "Kick Calculator" for determining the Nitrogen Equivalent is not governed by a single, named standard but is a practical tool used in the oil and gas industry for well control. It is based on industry-established principles and calculations outlined in various recommended practices and guidelines.
    </p>

    <h3 style="margin-top:12px; color:#1976d2;">Context in the Oil and Gas Industry</h3>
    <ul class="note-list">
        <li><strong>What is a "kick"?</strong> In drilling operations, a "kick" is an unwanted influx of formation fluids (such as gas, oil, or water) into the wellbore.</li>
        <li><strong>What is "Nitrogen Equivalent"?</strong> It's a calculation used in well control, particularly for operations involving nitrogen injection, to determine the effect on wellbore pressure. Nitrogen may be injected into the wellbore to lighten the fluid column, which can be part of the well-killing process.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Relevant Standards and Practices</h3>
    <ul class="note-list">
        <li><strong>API Recommended Practice (RP) 59:</strong> This practice establishes recommendations for well control operations during and after a kick.</li>
        <li><strong>API Recommended Practice (RP) 64:</strong> This standard provides guidance on the selection, installation, and operation of diverter equipment systems for managing shallow gas kicks.</li>
        <li><strong>IADC Well Control Guidelines:</strong> The International Association of Drilling Contractors (IADC) also publishes guidelines that cover aspects of well control in drilling, particularly in deepwater applications.</li>
    </ul>

    <h3 style="margin-top:12px; color:#1976d2;">Key Takeaway</h3>
    <p>
        The "Kick Calculator" for Nitrogen Equivalent is a tool based on fundamental well control engineering principles, not a distinct standard itself. Its use is part of broader well control strategies covered by industry practices and recommendations from organizations like the American Petroleum Institute.
    </p>
</div>


    <!-- Conclusion -->
    <div class="note-card">
        <h3>📌 Conclusion</h3>
        <p>
            Calculating the <strong>Kik</strong> value allows safety engineers to determine if the inert gas concentration is sufficient to suppress flammability. 
            A Kik value within the safe range (0–1) indicates effective suppression, while higher values (1–2 moderate, &gt;2 high) indicate that additional preventive measures—such as increasing inert gas, improving ventilation, or restricting operations—are required to mitigate risks.
        </p>
    </div>

</div>

<script>
function calculateKik() {
    const mxcikInput = document.getElementById('mxcik').value.trim();
    const tciInput = document.getElementById('tci').value.trim();
    const resultValue = document.getElementById('resultValue');
    const resultError = document.getElementById('resultError');
    const feedbackContent = document.getElementById('feedbackContent');
    const kikResult = document.getElementById('kikResult');
    const placeholder = document.getElementById('placeholder');

    placeholder.classList.add('hidden');
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";
    kikResult.innerText = "0.000";

    // Check for empty inputs
    if (!mxcikInput || !tciInput) {
        resultError.innerHTML = "⚠️ Please fill in all required fields.";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    const mxcik = parseFloat(mxcikInput);
    const tci = parseFloat(tciInput);

    // Check numeric validity
    if (isNaN(mxcik) || isNaN(tci)) {
        resultError.innerHTML = "❌ Invalid entry. Please enter numeric values only.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Check positive values
    if (mxcik <= 0 || tci <= 0) {
        resultError.innerHTML = "❌ Values must be greater than zero.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Maximum value limits
    if (mxcik >= 100 || tci > 100) {
        resultError.innerHTML = "⚠️ Values should be realistic (below 100%).";
        resultError.style.color = "orange";
        resultError.classList.remove('hidden');
        return;
    }

    // Logical relationship
    if (mxcik > tci) {
        resultError.innerHTML = "❌ MXCik cannot exceed Tci. Review inputs.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Limit decimals to 3
    const mxcikRounded = parseFloat(mxcik.toFixed(3));
    const tciRounded = parseFloat(tci.toFixed(3));

    // Safe division check
    if ((100 - mxcikRounded) === 0) {
        resultError.innerHTML = "❌ Calculation error: MXCik cannot be 100%.";
        resultError.style.color = "red";
        resultError.classList.remove('hidden');
        return;
    }

    // Kik Calculation
    const kik = (mxcikRounded * ((100 / tciRounded) - 1)) / (100 - mxcikRounded);
    kikResult.innerText = kik.toFixed(3);
    resultValue.classList.remove('hidden');

    // Feedback based on Kik
    let feedback = "";
    if (kik < 0) {
        feedback = "⚠️ invalid mixture - physically impossible. Review input values.";
        feedbackContent.style.color = "red";
    } else if (kik < 1) {
        feedback = "✅ Safe mixture - inert gas effectively suppresses flammability.";
        feedbackContent.style.color = "green";
    } else if (kik < 2) {
        feedback = "⚠️ Moderate risk - consider increasing inert gas or improving ventilation.";
        feedbackContent.style.color = "orange";
    } else {
        feedback = "🔥 High risk - immediate mitigation required (increase inert gas, improve ventilation, restrict operations).";
        feedbackContent.style.color = "red";
    }
    feedbackContent.innerHTML = feedback;
}

</script>





    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Inputs Analysis

Your inputs:

Input	Description	Unit	Real-World QEHS Range / Notes
MXCik	Maximum flammable gas concentration in the mixture	mol%	Typically 0–100% by definition, but practically, 0–50% is realistic for industrial flammability prevention. Must always be >0.
Tci	Threshold critical concentration of the flammable gas	mol%	Should be >0. Usually ≤100%, depending on gas type. Must be physically feasible.

Initial concerns:

MXCik > Tci may lead to negative Kik, which is physically unrealistic.

Very small or very large values can lead to division by zero or extreme outliers.

Non-numeric, negative, or empty inputs can cause miscalculations.

2. Recommended Input Validation Rules
Field	Validation Rule	QEHS Rationale
MXCik	Required, numeric, >0, ≤100, ≤Tci	MXCik cannot exceed Tci or 100%. Ensures safe calculation and avoids negative Kik.
Tci	Required, numeric, >0, ≤100	Must represent a realistic threshold concentration.
MXCik & Tci relationship	MXCik ≤ Tci	Ensures Kik is physically meaningful. Prevents negative results.
Decimals	Max 3 decimal places	Precision in chemical concentration measurement.
Logical consistency	Both numbers positive, Tci > 0	Prevents division by zero and meaningless negative values.

Additional Considerations:

Warn if values are unusually high (>50% MXCik) for typical safety scenarios.

Warn if Kik is extremely high (>5), indicating potential flammability risk.

3. Output Validation Logic & Thresholds

Kik Calculation:

Kik
=
𝑀
𝑋
𝐶
𝑖
𝑘
×
(
100
𝑇
𝑐
𝑖
−
1
)
100
−
𝑀
𝑋
𝐶
𝑖
𝑘
Kik=
100−MXCik
MXCik×(
Tci
100
	​

−1)
	​


Interpretation / QEHS thresholds:

Kik	Safety Interpretation	Action
<0	❌ Invalid mixture	Review input; physically impossible.
0–1	✅ Safe mixture	No additional inert gas needed.
1–2	⚠️ Moderate risk	Consider increasing inert gas.
>2	🔥 High risk	Immediate mitigation required (increase inert gas, improve ventilation, restrict operations).

These thresholds align with industrial standards for flammable gas control and NFPA recommendations.

4. Edge Case Validations

Division by zero: Occurs if Tci = 0 or MXCik = 100. Must prevent.

Negative Kik: MXCik > Tci → physically meaningless.

Extreme values: MXCik or Tci > 100 or ≤0 → invalid input.

Non-numeric input: User may enter letters or special characters.

Empty input: Should not allow calculation without both inputs. -->