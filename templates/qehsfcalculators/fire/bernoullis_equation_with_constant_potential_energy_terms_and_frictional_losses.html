{% extends 'base.html' %}
{% block title %}Bernoulli's Equation With Constant Potential Energy Terms And Frictional Losses Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
            height: 420px;
            overflow-y: scroll;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Bernoulli's Equation With Constant Potential Energy Terms And Frictional Losses Calculator</h1>
        <p>Evaluate fluid energy conservation between two points, accounting for <strong>pressure, velocity, and frictional losses</strong>.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="form-group">
                <label for="P1">Pressure at Point 1 (P₁) [Pa]</label>
                <input type="number" id="P1" class="form-input" placeholder="Enter pressure at P₁">
            </div>
            <div class="form-group">
                <label for="U1">Velocity at Point 1 (U₁) [m/s]</label>
                <input type="number" id="U1" class="form-input" placeholder="Enter velocity at U₁">
            </div>

            <div class="form-group">
                <label for="P2">Pressure at Point 2 (P₂) [Pa]</label>
                <input type="number" id="P2" class="form-input" placeholder="Enter pressure at P₂">
            </div>
            <div class="form-group">
                <label for="U2">Velocity at Point 2 (U₂) [m/s]</label>
                <input type="number" id="U2" class="form-input" placeholder="Enter velocity at U₂">
            </div>

            <div class="form-group">
                <label for="rho">Density (ρ) [kg/m³]</label>
                <input type="number" id="rho" class="form-input" placeholder="Enter fluid density">
            </div>
            <div class="form-group">
                <label for="hf">Friction Loss (hₓ) [Pa]</label>
                <input type="number" id="hf" class="form-input" placeholder="Enter friction loss">
            </div>

            <button class="calculate-btn" onclick="calculateBernoulli()">Calculate</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/resultimage.png' %}" alt="Bernoulli Illustration">
                <p>This tool applies <strong>Bernoulli’s Equation</strong> with frictional losses. Enter your data to view results.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                
                <div id="bernoulliResults"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
            <h3>📘 About This Calculator</h3>
           <p>
This calculator evaluates <strong>Bernoulli’s Equation with frictional losses</strong>.  
It is designed to help engineers and safety professionals understand how energy is distributed in a fluid system as it flows from one point to another.  
Instead of looking only at ideal flow, it also considers the effect of <em>friction losses</em>, which always occur in real pipes, fittings, and equipment.  
</p>
        </div>

        <div class="note-card">
    <h3>⚙️ Parameters Used</h3>
            <ul class="note-list">
                <li><strong>P₁, P₂ (Pressure at Points 1 & 2):</strong> The force per unit area exerted by the fluid at two different points in the system (measured in Pascals, Pa).</li>
        <li><strong>ρ (Density of Fluid):</strong> The mass per unit volume of the fluid (measured in kg/m³).</li>
        <li><strong>u₁, u₂ (Velocity at Points 1 & 2):</strong> The speed of the fluid at two points in the system (measured in meters per second, m/s).</li>
        <li><strong>h<sub>f</sub> (Friction Loss):</strong> The energy lost due to friction in the flow, caused by viscosity and surface roughness (measured in Pascals, Pa).</li>

            </ul>
        </div>
  <div class="note-card">
    <h3>📌 Input Validation Rules</h3>
    <ul class="note-list">
        <!-- General rules -->
        <li><strong>All numeric fields:</strong> Required, must be parseable as numbers, no letters.</li>
        <li>Accept up to 4 decimal places; overly precise values (>4 decimals) may trigger a warning.</li>
        <li>Unit hints provided in labels/placeholders; follow the units shown.</li>

        <!-- Pressure -->
        <li><strong>P₁, P₂ (Pressure at Points 1 & 2):</strong> Units: Pa. Acceptable range: −100,000 Pa (moderate vacuum) to 50,000,000 Pa (~500 bar). Negative values allowed but flagged as "Negative pressure detected; confirm gauge/vacuum".</li>
        <li>Very small magnitude values flagged only if inconsistent with other inputs.</li>
        <li>Decimals allowed up to 4 digits.</li>

        <!-- Velocity -->
        <li><strong>U₁, U₂ (Velocity at Points 1 & 2):</strong> Units: m/s. Acceptable range: 0–300 m/s. Velocities >50 m/s trigger a warning (typical liquids much lower). Must be non-negative. Decimals allowed up to 3–4 digits.</li>

        <!-- Density -->
        <li><strong>ρ (Density):</strong> Units: kg/m³. Acceptable range: 0 < ρ ≤ 20,000. Typical liquids: 700–1400; gases: 0.1–10. Values outside typical range trigger informational warnings. Decimals allowed up to 3 digits.</li>

        <!-- Friction Loss -->
        <li><strong>hₓ (Friction Loss):</strong> Units: Pa. Acceptable range: 0–10,000,000. Negative values are invalid. Extremely high values trigger warnings.</li>

        <!-- Cross-field / logical checks -->
        <li>If both pressures are equal and velocities and friction are zero — flagged as suspicious (no driving head).</li>
        <li>If friction exceeds upstream energy by a large factor — warning shown: "Friction loss larger than available upstream energy — check measurements/units".</li>
        <li>If dynamic terms (velocities × density) are extremely large relative to pressures — warning for unit inconsistency.</li>
        <li>If energy terms exceed 1e8 Pa — possible unit input error (kPa/bar instead of Pa).</li>

        <!-- Auditing and UI notes -->
        <li>Inputs are entered using type="number" with step="any". Validation enforces decimal limits.</li>
        <li>For auditable runs, users should include input units and optional notes (recommended for documentation).</li>
    </ul>
</div>

      <div class="note-card">
    <h3>📊 Output Validations</h3>
    <p>This section explains how the results of the Bernoulli calculator are classified based on the energy difference between Point 1 and Point 2.  
       The <strong>average energy</strong> is calculated as the mean of the absolute energy values at Point 1 and Point 2:  
       <em>Average Energy = (|Point 1 Energy| + |Point 2 Energy|) / 2</em>.  
       The tolerance is then set as the larger of 10 Pa or 0.5% of this average energy.
    </p>

   <p>
    <strong>Difference ≤ Tolerance</strong> → ✅ Holds within measurement tolerance.  
    <br> The absolute difference between Point 1 and Point 2 energy terms is less than or equal to the tolerance. Energy balance is satisfied within expected measurement uncertainty.
</p>

<p>
    <strong>Tolerance &lt; Difference ≤ 0.05 × Average Energy</strong> → ⚠️ Moderate discrepancy — investigate measurement or minor losses.  
    <br> The difference exceeds the tolerance but is less than or equal to 5% of the average energy. Suggests minor losses, measurement inaccuracies, or small unaccounted friction; investigation recommended but not critical.
</p>

<p>
    <strong>Difference &gt; 0.05 × Average Energy</strong> → ❗ Major discrepancy — investigate immediately (units, missing losses, or transience).  
    <br> The difference is greater than 5% of the average energy. Indicates a significant energy mismatch likely caused by missing losses, incorrect units, wrong density, or transient effects; immediate investigation required.
</p>

</div>


 <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A calculator for Bernoulli's equation with frictional losses is based on the <strong>Modified or Extended Bernoulli Equation</strong>, 
        which is standard for practical, real-world fluid dynamics applications in engineering.  
        The original, ideal Bernoulli's equation assumes no friction, making it only suitable for ideal, non-viscous fluids.
    </p>

    <h4>Standard for Bernoulli with Friction</h4>
    <p>
        In the real world, viscous effects cause energy losses in fluid flow.  
        To account for these, the concept of a <strong>head loss</strong> (<code>h<sub>L</sub></code>) is added to the standard Bernoulli equation.
    </p>

    <ul class="note-list">
        <li><strong>Original Bernoulli's Equation (Ideal):</strong></li>
    </ul>
    <p class="equation">
        \(\frac{P_{1}}{\rho g}+\frac{v_{1}^{2}}{2g}+z_{1}=\frac{P_{2}}{\rho g}+\frac{v_{2}^{2}}{2g}+z_{2}\)
    </p>
    <p>
        This equation describes the conservation of energy per unit weight of fluid between two points (1 and 2) along a streamline for an ideal fluid.
    </p>

    <ul class="note-list">
        <li><strong>Extended Bernoulli's Equation (Real Fluids):</strong></li>
    </ul>
    <p class="equation">
        \(\frac{P_{1}}{\rho g}+\frac{v_{1}^{2}}{2g}+z_{1}+h_{p}=\frac{P_{2}}{\rho g}+\frac{v_{2}^{2}}{2g}+z_{2}+h_{t}+h_{L}\)
    </p>
    <p>
        This is the standard form used in engineering and includes terms for:
    </p>
    <ul class="note-list">
        <li><code>h<sub>p</sub></code>: The head added by a pump.</li>
        <li><code>h<sub>t</sub></code>: The head removed by a turbine.</li>
        <li><code>h<sub>L</sub></code>: The head loss due to friction.</li>
    </ul>

    <h3>Calculating Frictional Losses</h3>
    <p>
        The term <code>h<sub>L</sub></code> is typically calculated using the <strong>Darcy–Weisbach Equation</strong>, 
        which is the standard method for determining head loss due to friction in pipes.
    </p>
    <p class="equation">
        \(h_{L}=f\frac{L}{D}\frac{v^{2}}{2g}\)
    </p>
    <ul class="note-list">
        <li><code>h<sub>L</sub></code> = head loss due to friction</li>
        <li><code>f</code> = Darcy friction factor</li>
        <li><code>L</code> = length of the pipe</li>
        <li><code>D</code> = diameter of the pipe</li>
        <li><code>v</code> = average velocity of the fluid</li>
        <li><code>g</code> = acceleration due to gravity</li>
    </ul>

    <h3>Summary of Standards</h3>
    <p>
        In summary, a calculator for Bernoulli's equation that includes friction would be based on the standards of practical, applied fluid dynamics, specifically using:
    </p>
    <ul class="note-list">
        <li><strong>Extended Bernoulli Equation:</strong> To apply the principle to real, viscous fluids.</li>
        <li><strong>Darcy–Weisbach Equation:</strong> To quantify the head loss component (<code>h<sub>L</sub></code>) caused by friction.</li>
    </ul>


</div>



       
        <div class="note-card">
                            <h3>💡 Conclusion</h3>

            <p>
                Click <strong>"Calculate"</strong> to check if Bernoulli’s principle holds between the two points.
                Use results for fluid system design, safety checks, and engineering analysis.
            </p>
        </div>
    </div>
</div>

<script>
/* Helper: check decimal places */
function countDecimalPlaces(numStr) {
    if (!numStr || numStr.indexOf('.') === -1) return 0;
    return numStr.split('.')[1].length;
}

function formatPa(x) {
    if (!isFinite(x)) return 'NaN';
    if (Math.abs(x) >= 1e6) return x.toExponential(3) + ' Pa';
    return Number(x).toLocaleString(undefined, {maximumFractionDigits: 2});
}

function showError(element, messages) {
    element.innerHTML = messages.join('<br>');
    element.style.color = 'red';
    element.classList.remove('hidden');
}

function showResult(resultDiv, html) {
    resultDiv.innerHTML = html;
    resultDiv.classList.remove('hidden');
}

function calculateBernoulli() {
    const rawP1 = document.getElementById("P1").value.trim();
    const rawU1 = document.getElementById("U1").value.trim();
    const rawP2 = document.getElementById("P2").value.trim();
    const rawU2 = document.getElementById("U2").value.trim();
    const rawRho = document.getElementById("rho").value.trim();
    const rawHf = document.getElementById("hf").value.trim();

    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const resultError = document.getElementById('resultError');
    const bernoulliResults = document.getElementById('bernoulliResults');

    // Reset UI
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = '';
    bernoulliResults.innerHTML = '';

    const errors = [];
    const warnings = [];

    // Required field checks
    if (rawP1 === '') errors.push('Pressure at Point 1 (P₁) [Pa] is required. Allowed range: −100,000 to 50,000,000 Pa.');
    if (rawU1 === '') errors.push('Velocity at Point 1 (U₁) [m/s] is required. Allowed range: 0 to 300 m/s.');
    if (rawP2 === '') errors.push('Pressure at Point 2 (P₂) [Pa] is required. Allowed range: −100,000 to 50,000,000 Pa.');
    if (rawU2 === '') errors.push('Velocity at Point 2 (U₂) [m/s] is required. Allowed range: 0 to 300 m/s.');
    if (rawRho === '') errors.push('Density (ρ) [kg/m³] is required. Allowed range: >0 to 20,000 kg/m³.');
    if (rawHf === '') errors.push('Friction Loss (hₓ) [Pa] is required. Allowed range: 0 to 10,000,000 Pa.');

    if (errors.length > 0) {
        showError(resultError, errors);
        return;
    }

    // Parse numeric values
    const p1 = parseFloat(rawP1);
    const u1 = parseFloat(rawU1);
    const p2 = parseFloat(rawP2);
    const u2 = parseFloat(rawU2);
    const rho = parseFloat(rawRho);
    const hf = parseFloat(rawHf);

    // Detailed numeric and range validations
    if (!isFinite(p1)) errors.push('Pressure at Point 1 (P₁) must be a valid number in Pascals (Pa).');
    else if (p1 < -100000 || p1 > 50000000) errors.push('Pressure at Point 1 (P₁) is out of realistic range: −100,000 to 50,000,000 Pa. Please verify units.');

    if (!isFinite(p2)) errors.push('Pressure at Point 2 (P₂) must be a valid number in Pascals (Pa).');
    else if (p2 < -100000 || p2 > 50000000) errors.push('Pressure at Point 2 (P₂) is out of realistic range: −100,000 to 50,000,000 Pa. Please verify units.');

    if (!isFinite(u1)) errors.push('Velocity at Point 1 (U₁) must be a valid number in meters per second (m/s).');
    else if (u1 < 0 || u1 > 300) errors.push('Velocity at Point 1 (U₁) is out of realistic range: 0 to 300 m/s.');

    if (!isFinite(u2)) errors.push('Velocity at Point 2 (U₂) must be a valid number in meters per second (m/s).');
    else if (u2 < 0 || u2 > 300) errors.push('Velocity at Point 2 (U₂) is out of realistic range: 0 to 300 m/s.');

    if (!isFinite(rho)) errors.push('Density (ρ) must be a valid number in kilograms per cubic meter (kg/m³).');
    else if (rho <= 0) errors.push('Density (ρ) must be greater than 0 kg/m³.');
    else if (rho < 0.1 || rho > 20000) warnings.push('Density (ρ) is outside typical practical range (0.1–20,000 kg/m³). Please verify fluid type and units.');

    if (!isFinite(hf)) errors.push('Friction Loss (hₓ) must be a valid number in Pascals (Pa).');
    else if (hf < 0 || hf > 10000000) errors.push('Friction Loss (hₓ) is out of realistic range: 0 to 10,000,000 Pa. Negative values are invalid.');

    // Decimal precision warnings
    if (countDecimalPlaces(rawP1) > 4) warnings.push('P₁ has more than 4 decimal places — round to sensible precision for auditing.');
    if (countDecimalPlaces(rawP2) > 4) warnings.push('P₂ has more than 4 decimal places — round to sensible precision for auditing.');
    if (countDecimalPlaces(rawU1) > 4) warnings.push('U₁ has more than 4 decimal places — round to sensible precision.');
    if (countDecimalPlaces(rawU2) > 4) warnings.push('U₂ has more than 4 decimal places — round to sensible precision.');
    if (countDecimalPlaces(rawRho) > 4) warnings.push('ρ has more than 4 decimal places — round to sensible precision.');
    if (countDecimalPlaces(rawHf) > 4) warnings.push('hₓ has more than 4 decimal places — round to sensible precision.');

    if (errors.length > 0) {
        showError(resultError, errors);
        return;
    }

    // Bernoulli calculation
    const term1 = p1 + 0.5 * rho * Math.pow(u1, 2);
    const term2 = p2 + 0.5 * rho * Math.pow(u2, 2) + hf;
    const difference = Math.abs(term1 - term2);
    const avgEnergy = (Math.abs(term1) + Math.abs(term2)) / 2;

    if (hf > Math.abs(term1) * 5) warnings.push('Friction loss (hₓ) is several times larger than upstream energy — check measurements or units.');

    const tolerance = Math.max(10, 0.005 * avgEnergy); // max of 10 Pa or 0.5% avg energy

    // Classification
    let classification = '';
    let color = '';
    if (difference <= tolerance) {
        classification = 'Holds within measurement tolerance';
        color = 'green';
    } else if (difference <= 0.05 * avgEnergy) {
        classification = 'Moderate discrepancy — investigate measurement or minor losses';
        color = 'orange';
    } else {
        classification = 'Major discrepancy — investigate immediately (units, missing losses, or transience)';
        color = 'red';
    }

    // Build result HTML
    let html = `<div style="color:#1560bd;font-size:28px;margin:10px 0;"><strong>Results</strong></div>
                <div>Point 1 Energy : <strong>${formatPa(term1)}</strong></div>
                <div>Point 2 Energy : <strong>${formatPa(term2)}</strong></div>
                <div>Absolute difference: <strong>${formatPa(difference)}</strong></div>
                <div>Tolerance used: <strong>${formatPa(tolerance)}</strong> (max of 10 Pa or 0.5% of average)</div>
                <div style="margin-top:8px; color:${color}; font-weight:bold;">${classification}</div>`;

    if (warnings.length > 0) {
        html += `<div style="margin-top:8px;"><strong>Notes / Warnings:</strong><ul>`;
        warnings.forEach(w => { html += `<li>${w}</li>`; });
        html += `</ul></div>`;
    }

    bernoulliResults.innerHTML = html;
    bernoulliResults.style.color = (color === 'green') ? 'green' : (color === 'orange' ? 'orange' : 'darkred');
    resultValue.classList.remove('hidden');
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1) Summary (what I’m doing)

Analyze inputs/outputs from a QEHS & fire-safety perspective.

Provide detailed input validation rules (units, ranges, decimals, cross-field checks).

Provide output validation / classification rules (tolerances, audit-friendly wording).

Provide robust edge-case handling.

Provide corrected, production-ready JavaScript for validation and output logic that you can paste into your page.

Provide test cases to verify correctness.

2) Short assumptions (so my rules make sense)

All numeric inputs are in the units shown on the UI: pressure Pa, velocity m/s, density kg/m³, friction loss Pa.

Pressures are treated as absolute numeric values (if you use gauge pressures, state it to users in the UI).

This tool is intended for steady, single-phase flows at same elevation (as per your description) — not for compressible, two-phase or transient flows.

3) Detailed input validation rules (industry-oriented)

For each field: allowed units, acceptable range, decimal rules, rational checks and cross-field dependencies.

General rules for all numeric fields

Must be present (required).

Numeric parseable (no letters).

Accept up to 4 decimal places (display rounding to 2–4 places in results). Reject overly precise values from manual input ( >4 decimals ) as likely accidental.

Provide explicit unit hint in placeholder/label (already present).

P₁, P₂ (Pressure at Points 1 & 2) — units Pa

Acceptable numeric range for typical industrial systems: −100000 Pa (−1 bar) up to 50,000,000 Pa (≈ 500 bar).

Rationale: allow moderate vacuum (negative gauge), but block absurd values (typos like extra zeros).

If pressure < 0: accept but show an informational note: “Negative pressure detected; confirm if this is gauge pressure/vacuum.”

Reject very small magnitude values that are effectively zero only if other fields are inconsistent (checked later).

Allow decimals up to 4 digits.

U₁, U₂ (Velocity) — units m/s

Acceptable range: 0 ≤ velocity ≤ 300 m/s (approx speed of sound for many gases; gives safe upper bound).

If velocity > 50 m/s show a warning (typical liquid flows are much lower; gas flows can be high).

Velocities must be non-negative.

Allow decimals up to 3 (for speed) or 4 if needed.

ρ (Density) — units kg/m³

Acceptable range: 0 < ρ ≤ 20,000 kg/m³.

Typical liquids: ~700–1400 (hydrocarbons, water), gases: ~0.1–10 (at STP). Upper bound prevents accidental extra zeros.

Reject ρ <= 0 (invalid).

If ρ < 0.5 or ρ > 2000, show informational warning: “Density unusually low/high — confirm fluid type and units.”

hₓ (Friction Loss) — units Pa

Acceptable range: 0 ≤ hf ≤ 10,000,000 Pa.

Small friction losses are common; very large values could be valid for long systems but values above ~10⁶–10⁷ Pa are suspicious.

Negative hf is invalid (friction cannot be negative).

Cross-field / logical checks

If both pressures are equal and velocities and hf are zero — flag as suspicious (no driving head).

If hf exceeds term1 (upstream energy) by a large factor, warn: “Friction loss larger than available upstream energy — check measurement/units.”

If velocities are inconsistent with density/pressures (e.g., extremely large dynamic term compared to pressures), show warning.

If term1 or term2 magnitude > 1e8 Pa show warning: possible unit error (maybe user entered kPa or bar instead of Pa).

Allowed decimals

Pressure, hf: up to 2–4 decimals permitted (rounded display). For auditing, store raw input but show rounded results.

Velocity: up to 3 decimals.

Density: up to 3 decimals.

Input format & UI

Use type="number" with step attributes: e.g. pressure step="any" but the validation enforces decimals allowed.

For auditable runs, a note that user provided units and an optional description field should be included (not implemented here, but recommended).

4) Output validation logic & thresholds (how to interpret difference)

The previous absolute tolerance 0.01 Pa is unrealistic in practice. Use a combined relative + absolute tolerance that reflects measurement uncertainty:

Energy terms used

term1 = p1 + 0.5 * rho * u1^2

term2 = p2 + 0.5 * rho * u2^2 + hf

difference = |term1 - term2|

avgEnergy = (|term1| + |term2|) / 2

Tolerance decision

tolerance = max(10 Pa, 0.005 * avgEnergy)

That is: the larger of 10 Pa or 0.5% of average energy. (0.5% chosen as a practical relative tolerance for engineering measurements — you can tighten to 0.2% for laboratory setups.)

Classifications

difference ≤ tolerance → Holds within measurement tolerance (GREEN) — energy balance satisfied for audit.

tolerance < difference ≤ 0.05 * avgEnergy → Moderate discrepancy (ORANGE) — may be due to measurement error, unaccounted minor losses or instrumentation drift; investigate.

difference > 0.05 * avgEnergy → Major discrepancy (RED) — likely missing losses, wrong units, wrong density, transients, or compressibility — immediate investigation required.

Audit output content

Always show: term1, term2, difference, tolerance, and classification with short actionable guidance.

If inputs triggered warnings (e.g., negative pressure/gas), include them as “Notes/Warnings” in the result.

5) Edge cases (and how to handle them)

Missing / NaN: Block calculation and show clear error listing missing fields.

ρ = 0 or extremely small → division by small numbers not directly here but dynamic term becomes tiny: reject ρ ≤ 0.

Very large numbers (typos): input > allowed ranges triggers explicit error asking to verify units/typo.

Negative pressure: allowed but flagged — user must confirm gauge vs absolute.

hf > upstream energy: show prominent warning (friction > available energy).

Velocities too high (>300 m/s): flag and require confirmation (likely units mix-up).

Inconsistent units (kPa vs Pa): detected when term magnitudes look like kPa (e.g., numbers ~100) but velocities/density create small dynamic term — flag possible unit mismatch if term magnitudes are inconsistent.

Extremely close terms: be careful about floating point precision — use tolerance rule above.

Values with too many decimals: accept but normalize; warn if more than 4 decimals.

6) Why each validation is essential (compliance & safety reasons)

Required fields: incomplete calculations can produce false positives/negatives leading to unsafe decisions.

Ranges: prevent typographical errors that would generate dangerously misleading outputs (e.g., entering kPa as Pa yields 1000x error).

Decimal limits: very high precision implies false confidence; auditing expects reasonable precision relative to instruments.

Density checks: wrong density turns the dynamic term into garbage — required for correct energy calculation and safety margins.

hf sanity: unreal friction loss implies blocked lines or wrong units — critical for fire-safety systems and pump sizing.

Tolerance logic: auditors expect documented tolerances; absolute small thresholds (like 0.01 Pa) are unrealistic relative to instrument uncertainty.

Warnings for negative pressure/gas flows: many safety standards differentiate compressible/gas flows — must be identified to use correct formulas.

Unit/scale checks: prevent dangerous design errors in pipelines, firefighting systems, or chemical handling. -->