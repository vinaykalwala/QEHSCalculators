{% extends 'base.html' %}
{% block title %}Fire Fighting Demand Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accident Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            border-radius: 12px;
        }
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
           justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
         @media (max-width: 768px) {
    .rate-value {
        font-size: 28px; /* smaller font for tablets/mobiles */
    }
}

@media (max-width: 480px) {
    .rate-value {
        font-size: 24px; /* even smaller for phones */
    }
}
    </style>
</head>
<body>
   <div class="btn-container">
    <a href="{% url 'firecategory_calculators' %}" class="back-btn">Back To Fire Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Fire Fighting Demand Calculator</h1>
        <p>Estimate the amount of water required to effectively combat fires based on population and planning standards.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Data</h2>
            <div class="form-group">
                <label for="population">Population</label>
                <input type="number" id="population" class="form-input" placeholder="Enter Population">
            </div>
            <button class="calculate-btn" onclick="calculateFireDemand()">Calculate Fire Demand</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <!-- Placeholder -->
            <div class="result-placeholder" id="placeholder">
                <img src="{% static 'images/flame.png' %}" alt="Fire Demand Illustration">
                <p>This tool will calculate the <strong>Fire Fighting Demand</strong>. Enter your data to see results and insights here.</p>
            </div>

            <!-- Error -->
            <div class="result-error hidden" id="resultError" style="font-size: 28px;"></div>

            <!-- Result -->
            <div class="result-value hidden" id="resultValue">
                <div class="rate-value">Fire Fighting Demand</div>
                <div class="result-feedback" id="feedbackContent"></div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
<div class="note-section">

    <!-- 1. About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            Fire Fighting Demand refers to the amount of water required to effectively combat fires in a given area. 
            It is calculated based on the population of the area and is used to design firefighting systems and 
            water supply networks.
        </p>
    </div>

    <!-- 2. Parameters -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Population:</strong> Total number of people in the area; used as a scaling factor for water demand.</li>
            <li><strong>Fire Demand Formulas:</strong> Includes AIA, Kuchling, Freeman, and Ministry of Urban Development; each formula is applied based on population size and context.</li>
        </ul>
    </div>

    <!-- 3. Input Validation Rules -->
    <div class="note-card">
        <h3>🛡️ Input Validation Rules</h3>
        <ul class="note-list">
            <li>Population is mandatory; missing values prevent calculation.</li>
            <li>Only numeric, positive values accepted; zero or negative inputs trigger an error.</li>
            <li>Population < 1 triggers a warning for negligible demand.</li>
            <li>Population > 10,000,000 triggers a warning to verify data and units.</li>
            <li>Ministry of Urban Development formula applies only for populations &gt; 50,000.</li>
            <li>Decimals allowed for thousands (e.g., 12.5k), but fractions of individuals are not meaningful.</li>
            <li>Edge cases: extremely small, large, or non-numeric inputs are handled safely; negative or zero fire demand outputs are blocked.</li>
            <li>Compliance: ensures realistic, auditable, and regulatory-compliant estimates.</li>
        </ul>
    </div>

    <!-- 4. Output Validation & Feedback -->
    <div class="note-card">
        <h3>⚡ Output Validations</h3>
        <ul class="note-list">
            <li>Outputs must always be positive, physically meaningful, and within expected real-world ranges.</li>
            <li>Feedback is displayed exactly as in the calculator for each formula:</li>
            <ul>
                <li><strong>AIA Formula:</strong> 4,600–100,000 L/min for typical populations; minimal or extreme values trigger warning.</li>
                <li><strong>Kuchling's Formula:</strong> 3,200–30,000 L/min; warnings issued for extreme population inputs.</li>
                <li><strong>Freeman's Formula:</strong> 1,100–50,000 L/min; ensures calculated values are positive.</li>
                <li><strong>Ministry of Urban Development:</strong> 700,000+ L/day for populations &gt; 50,000; warns if inputs exceed reasonable bounds.</li>
            </ul>
            <li>Errors/warnings appear for non-numeric, zero, negative, or extremely high population values, preventing unrealistic outputs.</li>
            <li>This ensures that the assessment or feedback is clearly communicated and audit-ready.</li>
        </ul>
    </div>

   <!-- Governing Principle -->
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A "Fire Fighting Demand Calculator" doesn't correspond to a single universal standard but utilizes various methodologies derived from different standards, including international ones like NFPA (National Fire Protection Association) and country-specific Indian Standards (IS) like IS 9668, along with client-specific requirements and formulas such as Kuchling's Formula or the AIA formula. The specific standard or formula used depends on the region, industry, and the particular type of risk being assessed.
    </p>
    <p>
        <strong>Standard:</strong>  
        <ul class="note-list">
            <li><strong>NFPA (National Fire Protection Association):</strong> This international organization sets standards for fire protection, including those for calculating fire water demand, as seen in documents like NFPA 1231.</li>
            <li><strong>Indian Standards (IS):</strong> For India, standards like IS 9668 (Code of Practice for Provision and Maintenance of Water Supplies for Fire Fighting) and IS 12469 (Specification for Pumps for Fire Fighting System) provide guidelines for fire water supply and pumps.</li>
            <li><strong>Formulas:</strong>
                <ul class="note-list">
                    <li><strong>Kuchling's Formula:</strong> A simpler formula often used for preliminary assessments based on population size.</li>
                    <li><strong>AIA Formula:</strong> A widely used method that considers population and fire risk, especially for urban areas.</li>
                    <li><strong>Ministry of Urban Development Formula:</strong> Used for large populations, typically over 50,000 people.</li>
                </ul>
            </li>
        </ul>
    </p>
    <p>
        How to Determine the Correct Standard:  
        <ul class="note-list">
            <li>Check the documentation: Look for references to the specific standard or formula used in the calculator's design or accompanying literature.</li>
            <li>Consider the location and industry: The applicable standard will vary based on the project's location (e.g., in India, use IS standards) and the facility type (e.g., power plants may use NFPA standards).</li>
            <li>Consult the relevant authorities: Contact local fire brigades or engineering consultants who can advise on the required local standards and practices.</li>
        </ul>
    </p>
</div>


    <!-- 6. Conclusion -->
    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <ul class="note-list">
            <li>Calculated fire demand provides actionable guidance for urban planning, emergency preparedness, and infrastructure design.</li>
            <li>Dynamic feedback is displayed exactly as in the calculator, ensuring users understand the risk level and applicability of each formula.</li>
            <li>Input validations prevent unsafe or unrealistic scenarios, aligning with NFPA, ISO, and regulatory standards.</li>
            <li>Errors and warnings alert operators to abnormal or extreme population inputs, supporting effective hazard mitigation and audit-ready reporting.</li>
        </ul>
    </div>

</div>


<script>
function calculateFireDemand() {
    const populationInput = document.getElementById('population').value.trim();
    const resultValue = document.getElementById('resultValue');
    const placeholder = document.getElementById('placeholder');
    const feedbackContent = document.getElementById('feedbackContent');
    const resultError = document.getElementById('resultError');

    // Reset display
    resultError.classList.add('hidden');
    resultValue.classList.add('hidden');
    placeholder.classList.add('hidden');
    resultError.innerHTML = "";
    feedbackContent.innerHTML = "";

    // Empty check
    if (populationInput === "") {
        showError("⚠️ Please enter the population.", "orange");
        return;
    }

    const population = parseFloat(populationInput);

    // Numeric and positive check
    if (isNaN(population) || population <= 0) {
        showError("❌ Invalid entry. Please enter a positive numeric value for population.", "red");
        return;
    }

    // Bounds warnings
    if (population < 1) {
        showError("⚠️ Population is too small to generate meaningful fire demand.", "orange");
        return;
    }
    if (population > 10000000) {
        showError("⚠️ Population entered is extremely high. Verify units and data.", "orange");
        return;
    }

    // ---- FIRE DEMAND CALCULATIONS ----
    const fireDemandAIA = 4637 * Math.sqrt(population) * (1 - 0.01 * Math.sqrt(population));
    const fireDemandKuchling = 3182 * Math.sqrt(population);
    const fireDemandFreeman = 1136.5 * ((population / 5) + 10);
    let fireDemandUrbanDev = "Not applicable for this population";
    if (population > 50000) {
        fireDemandUrbanDev = 100 * Math.sqrt(population) * 1000; // L/day
    }

    // Ensure positive outputs
    if (fireDemandAIA <= 0 || fireDemandKuchling <= 0 || fireDemandFreeman <= 0) {
        showError("❌ Calculated fire demand is non-positive. Check input values.", "red");
        return;
    }

    // Round outputs
    const AIA = fireDemandAIA.toFixed(2);
    const Kuchling = fireDemandKuchling.toFixed(2);
    const Freeman = fireDemandFreeman.toFixed(2);
    const UrbanDev = (typeof fireDemandUrbanDev === "number") ? fireDemandUrbanDev.toFixed(2) : fireDemandUrbanDev;

    // Display results
    feedbackContent.innerHTML = `
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:15px;">
            <div style="background:#e8f4fc; padding:15px; border-left:5px solid #1560bd; border-radius:8px;">
                <strong>AIA Formula:</strong> ${AIA} L/min
            </div>
            <div style="background:#fff3e0; padding:15px; border-left:5px solid #ff9800; border-radius:8px;">
                <strong>Kuchling's Formula:</strong> ${Kuchling} L/min
            </div>
            <div style="background:#fce4ec; padding:15px; border-left:5px solid #e91e63; border-radius:8px;">
                <strong>Freeman's Formula:</strong> ${Freeman} L/min
            </div>
            <div style="background:#e0f7fa; padding:15px; border-left:5px solid #00acc1; border-radius:8px;">
                <strong>Ministry of Urban Development:</strong> ${UrbanDev} L/day
            </div>
        </div>
    `;
    resultValue.classList.remove('hidden');
}

// ---- HELPER FUNCTION TO SHOW ERRORS ----
function showError(msg, color="red") {
    const resultError = document.getElementById('resultError');
    resultError.innerHTML = msg;
    resultError.style.color = color;
    resultError.classList.remove('hidden');
}

// ---- PRINT FUNCTION ----
function printReport() {
    window.print();
}
</script>




    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 1. Analysis of Inputs, Outputs, and Formulas
Input

Population (population):

Represents the total number of people in the area under consideration.

Used as a scaling factor for firefighting water demand (per AIA, Kuchling, Freeman, Ministry of Urban Development).

Units: number of people (no fractions for individuals, but some formulas may allow decimals for thousands).

Outputs

Fire Fighting Demand (L/min or L/day):

AIA Formula: 4637 * sqrt(P) * (1 - 0.01 * sqrt(P)) (L/min)

Kuchling Formula: 3182 * sqrt(P) (L/min)

Freeman Formula: 1136.5 * ((P / 5) + 10) (L/min)

Ministry of Urban Development: 100 * sqrt(P) * 1000 (L/day), only if P > 50,000

Notes:

Outputs must be positive, physically meaningful, and within expected real-world ranges.

Extremely high populations (> 1,000,000) may produce unrealistic water demand and require a warning.

2. Input Validation Rules (QEHS Perspective)
Input	Validation	Justification / Compliance
Population	Required	Cannot calculate demand with empty value
	Numeric only	Non-numeric values are invalid; may crash formulas
	Positive integers (>=1)	Zero or negative populations are physically impossible
	Max population: 10,000,000 (ten million)	Realistic upper bound for large cities; exceeding this triggers review
	Allowed decimals? Optional	For planning, fractions in thousands (e.g., 12.5k) are acceptable, but no negative decimals
	Logical check: Population < 50 for Ministry of Urban Development	Ensures formula applicability
	No extremely small population (<1)	Fire demand for <1 person is meaningless

Compliance Note: These rules prevent unrealistic water demand calculations, ensuring estimates can be used in audits, emergency planning, and regulatory compliance.

3. Edge Case Validations

Empty input → warning.

Population = 0 → error.

Negative population → error.

Extremely high population (>10,000,000) → warning, may need manual review.

Population < 1 → warning, negligible demand, but calculated values can mislead.

Non-numeric input → error.

Extremely large population but Ministry of Urban Development formula triggered → check for overflow.

Division by zero is not an issue here, but sqrt of negative numbers should be prevented.

4. Output Validation / Thresholds

Fire Fighting Demand should always be positive.

Expected ranges based on population:

Formula	Population Range	Typical L/min or L/day
AIA	1 – 1,000,000	4,600 – 100,000 L/min
Kuchling	1 – 1,000,000	3,200 – 30,000 L/min
Freeman	1 – 1,000,000	1,100 – 50,000 L/min
Ministry of Urban Development	50,000+	700,000 – 1,000,000+ L/day

Compliance Note: Any output below 1 L/min or extremely high values (> max expected) should trigger a warning for verification. -->