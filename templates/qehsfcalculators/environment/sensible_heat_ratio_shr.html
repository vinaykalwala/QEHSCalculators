{% extends 'base.html' %}
{% block title %}Sensible Heat Ratio (SHR) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensible Heat Ratio (SHR) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Sensible Heat Ratio (SHR) Calculator</h1>
        <p>Calculate the Sensible Heat Ratio for HVAC system design and thermal comfort assessment.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="sensible_heat">Sensible Heat Gain</label>
                <input type="number" id="sensible_heat" class="form-input" step="any" min="0" placeholder="Enter Sensible Heat Gain">
            </div>
            
            <div class="form-group">
                <label for="latent_heat">Latent Heat Gain</label>
                <input type="number" id="latent_heat" class="form-input" step="any" min="0" placeholder="Enter Latent Heat Gain">
            </div>

            <button class="calculate-btn" onclick="calculateSHR()">Calculate SHR</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="HVAC system illustration">
                <p>This tool calculates Sensible Heat Ratio for HVAC system design and analysis.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Sensible Heat Ratio (SHR)</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="shrValue">0.00</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Sensible Heat Ratio (SHR) Calculator</strong> determines the proportion of sensible heat gain relative to total heat gain in HVAC systems. 
            This is a critical parameter for designing cooling systems that effectively manage both temperature and humidity, ensuring thermal comfort, energy efficiency, and proper equipment sizing. 
            By understanding the SHR, engineers can balance sensible and latent loads in HVAC system design.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Sensible Heat Gain (SH):</strong> Heat from temperature rise. Unit: W (typical range: 100–50,000).</li>
            <li><strong>Latent Heat Gain (LH):</strong> Heat from moisture. Unit: W (typical range: 0–20,000).</li>
            <li><strong>Total Heat Gain:</strong> Sensible + Latent. Must be >0.</li>
            <li><strong>Sensible Heat Ratio (SHR):</strong> Ratio of sensible to total heat. Range: 0–1.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Sensible Heat Gain:</strong> Must be > 0 (typical range: 100-50,000 W).</li>
            <li><strong>Latent Heat Gain:</strong> Must be ≥ 0 (typical range: 0-20,000 W).</li>
            <li><strong>Total Heat Gain:</strong> Sum must be > 0 to avoid division by zero.</li>
            <li><strong>Realistic Values:</strong> Inputs should reflect practical HVAC system parameters.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Sensible Heat Ratio (SHR) must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>Sensible Heat Ratio (SHR) = 1.0:</strong> ✅ Pure sensible cooling → No latent load.</li>
            <li><strong>Sensible Heat Ratio (SHR) ≥ 0.95:</strong> Very High → Primarily sensible cooling load. Minimal dehumidification required.</li>
            <li><strong>Sensible Heat Ratio (SHR) 0.8–0.95:</strong> ✅ Typical → Balanced sensible and latent loads.</li>
            <li><strong>Sensible Heat Ratio (SHR) 0.6–0.8:</strong> ⚠️ Moderate → Significant latent load. Consider enhanced dehumidification capabilities.</li>
            <li><strong>Sensible Heat Ratio (SHR) &lt; 0.6:</strong> ❌ Very Low → High latent load, specialized dehumidification needed.</li>
            <li><strong>Assessment/Feedback:</strong> The classification and suggestion displayed with the result reflect the actual SHR status and guide HVAC design decisions for balanced comfort and energy efficiency.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📚 Governing Principle</h3>
        <p>
            A <strong>Sensible Heat Ratio (SHR) Calculator</strong> is based on HVAC engineering principles guided by organizations like ASHRAE and ACCA. 
            It calculates the ratio of sensible heat (temperature change) to total heat (sensible + latent) in a space. 
            The formula SHR = SH ÷ (SH + LH) reflects fundamental thermodynamics and heat transfer concepts.
        </p>
        <p><strong style="color: #1976d2;">Relevant Standards and Concepts:</strong></p>
        <ul class="note-list">
            <li><strong>ASHRAE Standards:</strong> Provide benchmarks for indoor air quality, thermal comfort, and energy efficiency. SHR is central to load calculations and system design.</li>
            <li><strong>ACCA Standards:</strong> Guide HVAC equipment selection and sizing based on calculated sensible and latent loads.</li>
            <li><strong>Fundamental Physics:</strong> Heat transfer and thermodynamics principles underlie calculations of sensible and latent heat gains.</li>
            <li><strong>Load Calculations:</strong> SHR calculators help determine how much cooling capacity is used for temperature change versus humidity removal, ensuring balanced HVAC performance.</li>
        </ul>
        <p>
            The SHR classification (Very High, Typical, Moderate, Very Low) provides immediate feedback for system design, guiding decisions for dehumidification and energy-efficient operation. 
            By following ASHRAE 62.1/62.2 and ACCA Manual J/S principles, the calculator ensures HVAC designs meet comfort and efficiency targets.
        </p>
    </div>

    <div class="note-card">
        <h3>📌 Conclusion</h3>
        <p>
            The <strong>Sensible Heat Ratio (SHR) Calculator</strong> is an essential tool for HVAC system design and performance assessment. 
            Higher SHR values (close to 1.0) indicate primarily sensible cooling suitable for dry climates, while lower SHR values indicate significant latent loads requiring enhanced dehumidification. 
            Maintaining SHR within the typical range of <strong>0.8–0.95</strong> ensures balanced indoor comfort, efficient energy use, and compliance with ASHRAE and ACCA standards. 
            The feedback and classification help designers optimize cooling strategies and properly size HVAC equipment.
        </p>
    </div>

</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateSHR() {
    // Read values
    const sensibleHeat = parseFloat(document.getElementById("sensible_heat").value);
    const latentHeat = parseFloat(document.getElementById("latent_heat").value);

    const shrValueEl = document.getElementById("shrValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![sensibleHeat, latentHeat].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    if (sensibleHeat <= 0) errors.push("👉 Sensible Heat Gain must be > 0.");
    if (latentHeat < 0) errors.push("👉 Latent Heat Gain must be ≥ 0.");
    
    // Check for division by zero
    const totalHeat = sensibleHeat + latentHeat;
    if (totalHeat <= 0) errors.push("👉 Total heat gain must be > 0.");
    
    // Warning for unusual values
    if (sensibleHeat > 50000) warnings.push("⚠️ Sensible heat unusually high (>50,000 W).");
    if (sensibleHeat < 100) warnings.push("⚠️ Sensible heat unusually low (<100 W).");
    if (latentHeat > 20000) warnings.push("⚠️ Latent heat unusually high (>20,000 W).");

    if (errors.length) return showErrors(errors);

    // Formula: SHR = Sensible Heat / (Sensible Heat + Latent Heat)
    const SHR = sensibleHeat / totalHeat;

    if (!Number.isFinite(SHR)) {
        return showErrors(["⚠️ Computed SHR is invalid (possible calculation error)."]);
    }

    // Classification based on SHR (industry standard)
    let classification, suggestion, color;
    
    if (SHR >= 0.95) {
        classification = "Very High";
        suggestion = "✅ Primarily sensible cooling load. Minimal dehumidification required.";
        color = "#2e7d32";
    } else if (SHR >= 0.8) {
        classification = "Typical";
        suggestion = "✅ Balanced sensible and latent loads. Standard HVAC equipment suitable.";
        color = "#2e7d32";
    } else if (SHR >= 0.6) {
        classification = "Moderate";
        suggestion = "⚠️ Significant latent load. Consider enhanced dehumidification capabilities.";
        color = "#f9a825";
    } else {
        classification = "Very Low";
        suggestion = "❌ High latent load. Specialized dehumidification equipment required.";
        color = "#c62828";
    }

    // Display result
    shrValueEl.textContent = SHR.toFixed(3);
    
    feedbackEl.innerHTML = `
        <div>SHR = <b>${SHR.toFixed(3)}</b></div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

Input Validations:
Sensible Heat Gain: Must be > 0 (typical range: 100-50,000 W)

Latent Heat Gain: Must be ≥ 0 (typical range: 0-20,000 W)

Total Heat Gain: Sum must be > 0 to avoid division by zero

All inputs must be numeric and finite numbers
-----------------------------------------------------------------------

Output Validations:
SHR = 1.0: Pure sensible cooling (optimal for dry climates)

SHR 0.8-0.95: Typical range (balanced system)

SHR 0.6-0.8: Moderate latent load (warning)

SHR < 0.6: Very high latent load (critical)

Result must be finite: No NaN or Infinity values
------------------------------------------------------------------------------
Edge Cases:
Zero sensible heat: Sensible=0, Latent=1000 → Error (sensible must be > 0)

Negative latent heat: Sensible=1000, Latent=-100 → Error (latent must be ≥ 0)

Both zero: Sensible=0, Latent=0 → Error (total heat must be > 0)

Extremely large values: Sensible=100000, Latent=50000 → Warning

Non-numeric inputs: Text instead of numbers → Error




-->