{% extends 'base.html' %}
{% block title %}TDS (Total Dissolved Solids) Conductivity  Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDS (Total Dissolved Solids) Conductivity  Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
       
    <style>
    .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            overflow-y: auto;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

       
    </style>
</head>
<body>

        <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>TDS (Total Dissolved Solids) Conductivity  Calculator</h1>
        <p>Estimate Total Dissolved Solids (TDS) in water based on conductivity measurements (result shown in ppm).</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="input-row">
                <div class="form-group">
                    <label for="conductivity">Conductivity (µS/cm)</label>
                    <input type="number" id="conductivity" class="form-input" step="any" min="0" placeholder="e.g., 500" aria-label="Conductivity">
                    
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateTDS()">Calculate TDS</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="TDS calculation illustration">
                <p>This tool estimates Total Dissolved Solids (TDS) in water based on conductivity measurements.</p>
            </div>

            <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue" aria-live="polite">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Total Dissolved Solids (TDS)</h2>
                </div>

                <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                    
                        <div class="rate-value" id="tdsValue">0.00</div>
                        <div class="rate-label" style="font-size:16px; color: #2980b9; ">ppm</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
    <h3>ℹ️ About This Calculator</h3>
    <p>
        The <b>TDS (Total Dissolved Solids) Conductivity Calculator</b> is a simple tool 
        that converts water’s <b>electrical conductivity (µS/cm)</b> into 
        <b>TDS (ppm)</b> using an empirical factor (0.7).  
    </p>
    
</div>


        <div class="note-card">
    <h3>📊 Parameters</h3>
    <ul class="note-list">
        <li><strong>Conductivity (µS/cm):</strong> Electrical ability of water to conduct current, proportional to dissolved ions.</li>
        <li><strong>TDS (ppm):</strong> Total Dissolved Solids in parts per million, estimated using conductivity.</li>
        <li><strong>Conversion Factor (0.7):</strong> Empirical relation between conductivity and TDS (varies 0.55–0.8 in natural waters).</li>
        <li><strong>Water Quality Class:</strong> Category assigned based on TDS concentration thresholds.</li>
    </ul>
</div>

        

        <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li>Conductivity is <b>required</b> — cannot be left blank</li>
            <li>Conductivity must be a <b>positive finite number</b> (µS/cm)</li>
            <li>Minimum conductivity: <b>1 µS/cm</b> (ultra-pure water threshold)</li>
            <li>Maximum conductivity: <b>100,000 µS/cm</b> (saturated brine solution)</li>
            <li>Values outside typical ranges trigger warnings but not errors</li>
        </ul>
        </div>

        <div class="note-card">
            <h3>✅ Output Validations</h3>
            <ul class="note-list">
                <li>TDS &lt; 300 ppm → ✅ Excellent Quality (Ideal for drinking water. Low mineral content with good taste.)</li>
                <li>300-600 ppm → ⚠️ Good Quality (Acceptable for drinking.Moderate mineral content.)</li>
                <li>600-900 ppm → ⚠️ Fair Quality(May affect taste. Consider filtration for drinking purposes)</li>
                <li>900-1200 ppm → ❌ Poor Quality (Not recommended for drinking without treatment. High mineral content)</li>
                <li>TDS &gt; 1200 ppm → ❌ Unacceptable Quality (Unsuitable for drinking.Requires treatment before use.)</li>
            </ul>
        </div>

<div class="note-card">
  <h3>📐 Governing Principle</h3>
  <p>
    A <b>TDS calculator based on conductivity</b> does not adhere to a single, universal standard but 
    uses conversion factors derived from methods like <b>EPA Standard Methods #160.1</b> to approximate 
    the relationship between electrical conductivity (EC) and Total Dissolved Solids (TDS) for specific 
    water types. While the EPA method precisely measures TDS by evaporation, the conversion factor allows 
    estimation using EC readings, which is valid for many applications where dissolved ions are the primary 
    contributors to TDS.
  </p>

  <h3 style="margin-top:12px; color:#1976d2;">How the Calculation Works</h3>
  <ul class="note-list">
    <li><b>Measure Specific Conductivity (EC):</b> A conductivity meter measures how well water conducts 
        an electrical current.</li>
    <li><b>Apply a Conversion Factor:</b> A factor, often 0.5–0.7 (or 500–700), converts EC (µS/cm) to 
        TDS (mg/L or ppm).</li>
    <li><b>Estimated TDS:</b> Formula: <b>TDS ≈ EC × Conversion Factor</b>.  
        Example: EC = 500 µS/cm with a factor of 0.6 → TDS ≈ 300 mg/L.</li>
  </ul>

  <h3 style="margin-top:12px; color:#1976d2;">Why There Isn't One Standard</h3>
  <ul class="note-list">
    <li><b>Varying Water Composition:</b> The EC–TDS relationship depends on the types of dissolved ions present.</li>
    <li><b>Different Water Sources:</b> A factor valid for freshwater may not be accurate for brine or other waters.</li>
    <li><b>Purpose of Measurement:</b> Standards vary by application—e.g., <b>BIS</b> and <b>WHO</b> provide TDS guidelines 
        for drinking water, while the <b>EPA method</b> ensures precise measurement.</li>
  </ul>

  <h3 style="margin-top:12px; color:#1976d2;">In Summary</h3>
  <p>
    The conductivity–TDS conversion method is widely used for monitoring but is an <b>approximation</b>.  
    For highly accurate TDS measurements, the <b>gravimetric EPA Standard Method #160.1</b> must be used, 
    where water is evaporated and the residue weighed directly.
  </p>
</div>

<div class="note-card">
    <h3>✅ Conclusion</h3>
    <p>
        The <strong>TDS Conductivity Calculator</strong> estimates dissolved solids in water using conductivity input.  
        This provides a quick, field-level approximation of water quality without laboratory testing. 
    </p>
</div>


</div>

<script>
/* Helper: show errors consistently */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

/* Main TDS calculation with strong validations */
function calculateTDS() {
  // Safe reads
  const conductivityRaw = document.getElementById("conductivity")?.value.trim() ?? "";

  const tdsEl = document.getElementById("tdsValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  document.getElementById("resultError").classList.add("hidden");
  if (feedbackEl) feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required input check
  if (conductivityRaw === "") errors.push("👉 Enter Conductivity value in µS/cm.");

  if (errors.length > 0) { showErrors(errors); return; }

  // Parse number
  const conductivity = parseFloat(conductivityRaw);

  // Numeric & sign checks
  if (!Number.isFinite(conductivity)) errors.push("👉 Conductivity must be a valid number.");
  if (conductivity <= 0) errors.push("👉 Conductivity must be greater than zero.");
  if (conductivity < 1) warnings.push("⚠️ Conductivity value is very low (ultra-pure water).");
  if (conductivity > 100000) warnings.push("⚠️ Conductivity value is extremely high (saturated solution).");

  if (errors.length > 0) { showErrors(errors); return; }

  // Compute TDS (ppm) = Conductivity (µS/cm) × 0.7
  const tds = conductivity * 0.7;

  if (!Number.isFinite(tds) || tds <= 0) {
    showErrors(["⚠️ Computed TDS value is invalid. Check conductivity input."]);
    return;
  }

  // Extreme results warning
  if (tds > 70000) {
    warnings.push("⚠️ Extremely high TDS value - verify conductivity measurement.");
  }

  // Water quality classification based on TDS values
  let classification = "";
  let suggestion = "";
  
  if (tds < 300) {
    classification = "Excellent Quality";
    suggestion = "✅ Ideal for drinking water. Low mineral content with good taste.";
  } else if (tds >= 300 && tds < 600) {
    classification = "Good Quality";
    suggestion = "✅ Acceptable for drinking. Moderate mineral content.";
  } else if (tds >= 600 && tds < 900) {
    classification = "Fair Quality";
    suggestion = "⚠️ May affect taste. Consider filtration for drinking purposes.";
  } else if (tds >= 900 && tds < 1200) {
    classification = "Poor Quality";
    suggestion = "❌ Not recommended for drinking without treatment. High mineral content.";
  } else {
    classification = "Unacceptable Quality";
    suggestion = "❌ Unsuitable for drinking. Requires treatment before use.";
  }

  // Compose feedback content
  let details = `<div>TDS = <b>${tds.toFixed(2)}</b> ppm</div>`;
  details += `<div>Water Quality: <b>${classification}</b></div>`;
  details += `<div style="margin-top:6px;">${suggestion}</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:8px; color:#b35d00;">Note: ${warnings.join(" | ")}</div>`;
  }

  // Update UI
  if (tdsEl) tdsEl.textContent = tds.toFixed(2);
  if (feedbackEl) feedbackEl.innerHTML = details;

  // Toggle display
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

/* Print-safe report with date */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    el.textContent = now.toLocaleDateString('en-US', options);
  }
  window.print();
}

// Add event listeners for Enter key
document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById("conductivity");
  if (input) {
    input.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        calculateTDS();
      }
    });
  }
});
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
----------------------------------------------------------------------------------------------
Input Validations
Conductivity: Must be positive, minimum 1 µS/cm, maximum 100,000 µS/cm

Numeric validation: Ensures input is a valid number

Edge case handling: Warnings for extremely low/high values
------------------------------------------------------------------------------------------
 Output Validations
Calculates TDS = Conductivity × 0.7 (the correct formula)

Provides water quality classification based on TDS levels

Shows warnings for extreme but valid inputs
-----------------------------------------------------------------------------------------
Edge Cases
Division by zero protection (not applicable to this formula)

Extremely large/small values

Negative inputs

Non-numeric inputs
-------------------------------------------------------------------------------------
TDS (ppm) = Conductivity (µS/cm) × 0.7

Where:

TDS = Total Dissolved Solids in parts per million (ppm)

Conductivity = Electrical conductivity of water in microsiemens per centimeter (µS/cm)

0.7 = Empirical conversion factor (ranges 0.55-0.8 in natural waters)


-->