{% extends 'base.html' %}
{% block title %}Energy Consumption per Person per Year Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Consumption per Person per Year Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

<div class="calculator-header">
  <h1>Energy Consumption per Person per Year</h1>
  <p>
    Estimate per-capita annual energy use for a shared system (e.g., plant/process/utility)
    from total power demand and served population. Useful for ESG/QEHS benchmarking, permit reporting,
    and energy improvement programs.
  </p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="powerKW">Total Power Demand <span>[kW]</span></label>
      <input type="number" id="powerKW" class="form-input" min="0.001" max="1000000000" step="0.001" placeholder="e.g., 750.000">
    </div>

    <div class="form-group">
      <label for="population">Population Served <span>[people]</span></label>
      <input type="number" id="population" class="form-input" min="1" max="1000000000" step="1" placeholder="e.g., 25000">
    </div>

    <button class="calculate-btn" onclick="calculateEnergyPerPerson()">Calculate Per-Capita Energy</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Energy per person illustration">
      <p>This tool calculates <strong>kWh per person per year</strong> from power and population.</p>
    </div>

    <div class="result-error hidden" id="resultError">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Calculated Per-Capita Energy</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="rateValue">0.00</div>
        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">
          kWh/year/person
        </div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      Computes annual energy use per person assuming continuous operation (24/7 all year).
      Use for ESG/QEHS benchmarking, permit filings, and energy management reviews. Report
      context (facility scope, load coverage, and run profile) alongside results.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Power (kW):</strong> Total power demand of the system or facility.</li>
      <li><strong>Population (people):</strong> Number of people served by the system.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>Power (kW):</strong> Required, > 0; allowed 0.001–1,000,000,000 (typical facilities: 1–100,000).</li>
      <li><strong>Population (people):</strong> Required, whole number, 1–1,000,000,000.</li>
      <li><strong>Unit consistency:</strong> Power must be average/typical load over the year (or clearly state if peak).</li>
      <li><strong>Output:</strong> Energy in kWh/year/person; optional context shows daily value.</li>
      <li><strong>Constraints:</strong> Zeros, negatives, non-numeric, or fractional people are rejected.</li>
      <li><strong>Advisories:</strong> Extremely small population with large power or vice versa will be flagged for review.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📏 Output Validations</h3>
    <ul class="note-list">
      <li><strong>Energy Consumption (kWh/year/person):</strong> Displayed with 2 decimals.</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>&lt;10: Very low per-capita value — Verify metering scope and duty cycle.</li>
          <li>10–200: Typical — Typical range for shared utilities and treatment systems.</li>
          <li>200–1000: Elevated — Investigate load growth, run hours, or inefficiencies.</li>
          <li>&gt;1000: Very high — Validate inputs and consider energy optimization actions.</li>
        </ul>
      </li>
      <li>Warnings are triggered for extreme conditions: very high/low power, unusual population size, or excessive decimals.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      An energy consumption calculator isn't bound to one universal standard but relies on a formula (Energy = Power x Time) and often incorporates standards set by various bodies like the U.S. Energy Information Administration or Our World in Data for national/global data, or energy efficiency standards like those from the Bureau of Energy Efficiency (BEE) or Energy Star for appliance-specific calculations. The specific standard depends on whether the calculator is for general use, appliance efficiency, or national/global energy tracking.
    </p>
    <p><b>Factors determining the standard used:</b></p>
    <p><b>Purpose:</b> Is it for individual home use, industrial tracking, or national data?</p>
    <p><b>Energy Source:</b> Some standards are specific to electricity (kWh), while others cover total energy (joules, BTUs).</p>
    <p><b>Region:</b> Different countries or regions may have their own national energy standards and agencies.</p>
    <p><b>Appliance Efficiency:</b> For product-specific calculations, standards from organizations like the U.S. Department of Energy's Energy Star program might be referenced.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides reliable estimates of annual energy use per person, supporting <strong>ESG/QEHS benchmarking</strong>, <strong>permit filings</strong>, and <strong>energy management reviews</strong>. Ensure power (kW) and population inputs are accurate and reflect average operating conditions, and validate with field data or standards (e.g., BEE, Energy Star) for critical applications to ensure compliance and efficiency.
    </p>
  </div>
</div>
</div>
<script>
/* Reusable error display */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Energy per person with robust, domain-aware validations */
function calculateEnergyPerPerson() {
  const pRaw = (document.getElementById("powerKW").value || "").trim();
  const nRaw = (document.getElementById("population").value || "").trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // reset UI
  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // presence
  if (!pRaw) errors.push("👉 Please enter Total Power Demand (kW).");
  if (!nRaw) errors.push("👉 Please enter Population Served (people).");
  if (errors.length) return showErrors(errors);

  // parse
  const P = Number(pRaw);
  const N = Number(nRaw);

  // numeric checks
  if (!Number.isFinite(P)) errors.push("👉 Power must be a valid number (kW).");
  if (!Number.isFinite(N)) errors.push("👉 Population must be a valid number (people).");
  if (errors.length) return showErrors(errors);

  // integer-only for population
  if (!Number.isInteger(N)) {
    errors.push("👉 Population must be a whole number (no decimals).");
  }

  // hard ranges (physical & practical)
  const P_MIN = 0.001, P_MAX = 1_000_000_000;  // kW
  const N_MIN = 1, N_MAX = 1_000_000_000;      // people

  if (P <= 0 || P < P_MIN || P > P_MAX) {
    errors.push(`👉 Power must be > 0 and within ${P_MIN} to ${P_MAX} kW.`);
  }
  if (N < N_MIN || N > N_MAX) {
    errors.push(`👉 Population must be between ${N_MIN} and ${N_MAX} people.`);
  }
  if (errors.length) return showErrors(errors);

  // precision advisories
  const decimals = s => (String(s).split(".")[1] || "").length;
  if (decimals(pRaw) > 3) warnings.push("⚠️ Power has more than 3 decimals – consider rounding for reporting.");

  // sanity advisories (ESG/QEHS realism)
  if (P < 0.1) warnings.push("⚠️ Very small power – confirm scope and metering.");
  if (P > 5_000_000) warnings.push("⚠️ Extremely large power – verify that this is average, not peak.");
  if (N <= 10 && P >= 1000) warnings.push("⚠️ Very high power with tiny population – check boundaries and allocation method.");
  if (N > 10_000_000 && P < 1_000) warnings.push("⚠️ Very large population with small power – confirm completeness of loads.");

  // constants (continuous operation assumption)
  const HOURS_PER_DAY = 24;
  const DAYS_PER_YEAR = 365;

  // compute kWh/year/person
  const energyPerPerson = (P * HOURS_PER_DAY * DAYS_PER_YEAR) / N;

  if (!Number.isFinite(energyPerPerson) || energyPerPerson < 0) {
    return showErrors(["⚠️ Computation invalid. Check inputs and units."]);
  }

  // interpretation (domain-friendly)
  let statusMsg = "";
  if (energyPerPerson < 10) {
    statusMsg = "🟡 Very low per-capita value — verify metering scope and duty cycle.";
  } else if (energyPerPerson <= 200) {
    statusMsg = "🟢 Typical range for shared utilities and treatment systems.";
  } else if (energyPerPerson <= 1000) {
    statusMsg = "🟡 Elevated — investigate load growth, run hours, or inefficiencies.";
  } else {
    statusMsg = "🔴 Very high — validate inputs and consider energy optimization actions.";
  }

  // helpful context
  const perDay = energyPerPerson / 365;
  const totalAnnualKWh = P * HOURS_PER_DAY * DAYS_PER_YEAR;

  const fmt = (n, d=2) => Number(n).toLocaleString(undefined,{minimumFractionDigits:d, maximumFractionDigits:d});

  // update UI
  document.getElementById("placeholder").classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");

  rateEl.textContent = fmt(energyPerPerson, 2);
  document.querySelector(".rate-label").textContent = "kWh/year/person";

  let details = `
    <div>Total annual energy (scope): <b>${fmt(totalAnnualKWh,0)}</b> kWh/year</div>
    <div>Context: <b>${fmt(perDay,2)}</b> kWh/day/person (assuming 24/7)</div>
  `;
  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }
  document.getElementById("feedbackContent").innerHTML = `<div>${statusMsg}</div>${details}`;
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>




    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 
=============================================
📘 Energy per Person Calculator
=============================================

📌 Formula:
-----------
Annual energy consumption per person:

E_person = ( P × 24 × 365 ) / N

Where:
- E_person = Energy use per person [kWh/year/person]
- P = Total average power demand [kW]
- N = Population served [people]

Derived context values:
- Total annual energy = P × 24 × 365 [kWh/year]
- Per-capita daily energy = E_person / 365 [kWh/day/person]

---

✅ Input Validations:
---------------------
1. Presence:
   • P (Total Power Demand in kW) is required.  
   • N (Population in people) is required.  

2. Data type:
   • Both P and N must be valid numbers.  
   • N must be an integer (whole number).  

3. Ranges:
   • 0.001 ≤ P ≤ 1,000,000,000 kW  
   • 1 ≤ N ≤ 1,000,000,000 people  

4. Logical checks:
   • P > 0, N ≥ 1  
   • Computed E_person must be finite and non-negative.  

---

⚠️ Warnings / Advisories:
--------------------------
• More than 3 decimals entered for P → recommend rounding.  
• P < 0.1 kW → Very small, verify scope/metering.  
• P > 5,000,000 kW → Extremely large, verify if average vs peak.  
• N ≤ 10 with P ≥ 1000 kW → Very high load per small group, check allocation.  
• N > 10,000,000 with P < 1000 kW → Very low load per huge group, check completeness.  

---

📊 Outputs:
-----------
• Annual energy per person [kWh/year/person].  
• Total annual energy demand [kWh/year].  
• Daily per-capita energy [kWh/day/person].  
• Input summary: total power (kW) and population.  
• Status message based on E_person:  
   - < 10 → Very low, verify metering scope.  
   - 10–200 → Typical shared utilities/treatment systems.  
   - 200–1000 → Elevated, check load growth/inefficiencies.  
   - > 1000 → Very high, validate inputs and consider optimization.  
• Warnings/advisories if applicable.  

=============================================
-->
