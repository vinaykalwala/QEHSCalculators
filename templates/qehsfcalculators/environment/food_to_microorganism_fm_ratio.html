{% extends 'base.html' %}
{% block title %}Food to Microorganism (F/M) Ratio Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food to Microorganism (F/M) Ratio Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover¬†effect¬†*/
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
  <h1>Food to Microorganism (F/M) Ratio Calculator</h1>
  <p>Compute F/M using standard wastewater parameters. Result shown in <strong>per day (d‚Åª¬π)</strong>.</p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Parameters</h2>

    <div class="input-row">
      <div class="form-group">
        <label for="flowQ">Flow Rate (Q, m¬≥/day) *</label>
        <input type="number" id="flowQ" class="form-input" step="any" min="0" placeholder="e.g., 2500" aria-label="Flow rate">
      </div>

      <div class="form-group">
        <label for="bodS0">Influent BOD‚ÇÖ (S‚ÇÄ, mg/L) *</label>
        <input type="number" id="bodS0" class="form-input" step="any" min="0" placeholder="e.g., 300" aria-label="Influent BOD">
      </div>
    </div>

    <div class="input-row">
      <div class="form-group">
        <label for="mlvssX">Biomass (MLVSS, X, mg/L) *</label>
        <input type="number" id="mlvssX" class="form-input" step="any" min="0" placeholder="e.g., 3000" aria-label="Biomass concentration">
      </div>

      <div class="form-group">
        <label for="tankV">Aeration Tank Volume (V, m¬≥) *</label>
        <input type="number" id="tankV" class="form-input" step="any" min="0" placeholder="e.g., 5000" aria-label="Tank volume">
      </div>
    </div>

    <button class="calculate-btn" onclick="calculateAdsorption()">Calculate F/M</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Biological treatment illustration">
      <p>This tool computes F/M (food per biomass per day) and reports food load, biomass inventory, and HRT.</p>
    </div>

    <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
      <div class="error-icon">‚ùå</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue" aria-live="polite">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>F/M Ratio</h2>
      </div>

      <!-- Keeping this id to preserve your styling -->
      <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
        <div class="rate-value" id="headLoss">0.00</div>
        <div class="rate-label" style="font-size:16px; color:#2980b9;">per day (d‚Åª¬π)</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>

      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      The F/M ratio expresses organic loading (BOD) applied to available biomass (MLVSS) per day.
      It is a primary KPI for activated sludge stability, effluent quality, and safety (bulking/foaming/odor).
    </p>
  </div>

  <div class="note-card">
    <h3>‚öô Parameters Used</h3>
    <ul class="note-list">
      <li><b>Q (m¬≥/d):</b> Influent flow rate.</li>
      <li><b>S‚ÇÄ (mg/L):</b> Influent biochemical oxygen demand (BOD).</li>
      <li><b>X (mg/L MLVSS):</b> Mixed liquor volatile suspended solids (biomass concentration).</li>
      <li><b>V (m¬≥):</b> Aeration tank volume.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>Q (m¬≥/d):</b> Required; 0.001‚Äì1,000,000.</li>
      <li><b>S‚ÇÄ (mg/L):</b> Required; 1‚Äì100,000.</li>
      <li><b>X (mg/L MLVSS):</b> Required; 100‚Äì15,000 (typical 1,500‚Äì5,000).</li>
      <li><b>V (m¬≥):</b> Required; 0.1‚Äì10,000,000.</li>
      <li><b>Cross-checks:</b> X¬∑V must be sufficient; HRT = V/Q flagged if &lt; 0.04 d or &gt; 3 d.</li>
      <li><b>Output guardrails:</b> 0.001 ‚â§ F/M ‚â§ 3.0 d‚Åª¬π.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üìè Output Validations</h3>
    <ul class="note-list">
      <li><b>F/M Ratio:</b> Displayed in d‚Åª¬π with 4 decimals.</li>
      <li><b>Assessment:</b>
        <ul>
          <li>F/M &lt; 0.05 d‚Åª¬π: Very Low ‚Äî Endogenous conditions; verify nitrification goals and energy use.</li>
          <li>F/M 0.05‚Äì0.20 d‚Åª¬π: Low ‚Äî Extended aeration/low-load; check clarifier blanket health.</li>
          <li>F/M 0.20‚Äì0.60 d‚Åª¬π: Optimal (CAS) ‚Äî Favorable operating window for conventional activated sludge.</li>
          <li>F/M 0.60‚Äì1.00 d‚Åª¬π: High ‚Äî Risk of poor settling/filaments; consider increasing X or V, or reduce load.</li>
          <li>F/M &gt; 1.00 d‚Åª¬π: Very High ‚Äî Overloaded; immediate action: reduce Q/S‚ÇÄ or increase biomass/volume.</li>
        </ul>
      </li>
      <li>Warnings are triggered for extreme conditions: low biomass, high BOD, or unusual HRT.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üìñ Governing Principle</h3>
    <p>
      The F/M ratio calculator is not of one specific standard but is a concept rooted in wastewater treatment engineering and is used to manage activated sludge systems. While there isn't a universal numerical standard for F/M ratios, the concept defines operational standards for different wastewater treatment processes like extended aeration, conventional systems, completely mixed systems, and high-rate systems.
    </p>
    <p><b>How it works:</b></p>
    <p>
      The F/M ratio represents the relationship between the amount of food (organic matter, often measured as BOD or COD) and the amount of microorganisms (biomass, usually represented by MLSS) in an activated sludge system.
    </p>
    <ul class="note-list">
      <li>It is calculated as the daily mass of BOD divided by the mass of microorganisms.</li>
      <li>The ratio helps determine if the system has too much food for the existing microorganisms (low F/M, potentially leading to poor BOD removal) or too little (high F/M, potentially leading to poor sludge settling).</li>
    </ul>
    <p><b>Why it's important:</b></p>
    <ul class="note-list">
      <li>Maintaining the correct F/M ratio is essential for achieving system equilibrium and optimal performance in wastewater treatment.</li>
      <li>It allows operators to balance substrate consumption and biomass generation to ensure efficient decomposition of organic matter and a healthy microbial population.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üîö Conclusion</h3>
    <p>
      This calculator provides reliable estimates of the F/M ratio for activated sludge systems, supporting <strong>effluent quality</strong>, <strong>sludge stability</strong>, and <strong>safety</strong> in wastewater treatment. Ensure input values align with realistic ranges and consider process-specific standards (e.g., extended aeration or conventional systems) to achieve optimal performance and compliance.
    </p>
  </div>
</div>
</div>
<script>
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

function calculateAdsorption() {
  // (kept function name to preserve your button handler)
  const sQ  = document.getElementById("flowQ")?.value.trim();
  const sS0 = document.getElementById("bodS0")?.value.trim();
  const sX  = document.getElementById("mlvssX")?.value.trim();
  const sV  = document.getElementById("tankV")?.value.trim();

  const Q  = parseFloat(sQ);
  const S0 = parseFloat(sS0);
  const X  = parseFloat(sX);
  const V  = parseFloat(sV);

  const fmEl = document.getElementById("headLoss");        // reuse style id
  const feedbackEl = document.getElementById("feedbackContent");

  document.getElementById("resultError").classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = (v) => Number.isFinite(v) && !Number.isNaN(v);
  const decLen = (s) => (s && s.includes(".")) ? s.split(".")[1].length : 0;

  // Presence & positivity
  if (!isFiniteNum(Q)  || Q  <= 0) errors.push("üëâ Q is required and must be > 0 m¬≥/day.");
  if (!isFiniteNum(S0) || S0 <= 0) errors.push("üëâ S‚ÇÄ is required and must be > 0 mg/L.");
  if (!isFiniteNum(X)  || X  <= 0) errors.push("üëâ X (MLVSS) is required and must be > 0 mg/L.");
  if (!isFiniteNum(V)  || V  <= 0) errors.push("üëâ V is required and must be > 0 m¬≥.");

  // Hard limits
  if (isFiniteNum(Q)  && (Q  < 0.001 || Q  > 1_000_000)) errors.push("üëâ Q must be between 0.001 and 1,000,000 m¬≥/day.");
  if (isFiniteNum(S0) && (S0 < 1      || S0 > 100_000))  errors.push("üëâ S‚ÇÄ must be between 1 and 100,000 mg/L.");
  if (isFiniteNum(X)  && (X  < 100    || X  > 15_000))   errors.push("üëâ X must be between 100 and 15,000 mg/L.");
  if (isFiniteNum(V)  && (V  < 0.1    || V  > 10_000_000)) errors.push("üëâ V must be between 0.1 and 10,000,000 m¬≥.");

  if (errors.length) return showErrors(errors);

  // QA: decimal significance warnings
  if (decLen(sQ)  > 3) warnings.push("‚ö†Ô∏è Q has >3 decimals; rounding may not be meaningful.");
  if (decLen(sV)  > 3) warnings.push("‚ö†Ô∏è V has >3 decimals; rounding may not be meaningful.");
  if (decLen(sS0) > 1) warnings.push("‚ö†Ô∏è S‚ÇÄ has >1 decimal; typical lab precision is 1 decimal.");
  if (decLen(sX)  > 1) warnings.push("‚ö†Ô∏è X has >1 decimal; typical lab precision is 1 decimal.");

  // Cross-field checks
  const denom = X * V; // mg/L * m¬≥
  if (!isFiniteNum(denom) || denom <= 0) {
    return showErrors(["‚ö†Ô∏è Denominator X¬∑V is invalid (zero or NaN)."]);
  }
  if (denom < 1) warnings.push("‚ö†Ô∏è X¬∑V is very small; F/M may be unstable due to near-zero biomass.");

  // Derived quantities
  const foodLoadKgPerDay = Q * S0 * 1e-3;   // (m¬≥/d)*(mg/L)*1e-3 = kg/d
  const biomassKg        = X * V * 1e-3;    // (mg/L)*(m¬≥)*1e-3 = kg
  const HRTd             = V / Q;           // days
  const HRTh             = HRTd * 24;

  if (!isFiniteNum(foodLoadKgPerDay) || !isFiniteNum(biomassKg) || !isFiniteNum(HRTd)) {
    return showErrors(["‚ö†Ô∏è Derived values invalid. Check inputs for extremes or typos."]);
  }

  // Reasonableness warnings
  if (S0 < 100) warnings.push("‚ÑπÔ∏è Low influent BOD (<100 mg/L) ‚Äî low-strength wastewater.");
  if (S0 > 3000) warnings.push("‚ö†Ô∏è Very high BOD (>3000 mg/L) ‚Äî shock load or unit mismatch?");
  if (X < 1500 || X > 5000) warnings.push("‚ÑπÔ∏è X outside typical band (1500‚Äì5000 mg/L).");
  if (biomassKg < 50) warnings.push("‚ÑπÔ∏è Biomass inventory < 50 kg ‚Äî very small system.");
  if (biomassKg > 2_000_000) warnings.push("‚ö†Ô∏è Biomass inventory unusually large ‚Äî check units.");
  if (HRTd < 0.04) warnings.push("‚ö†Ô∏è HRT < 1 hour ‚Äî short-circuiting risk.");
  if (HRTd > 3) warnings.push("‚ö†Ô∏è HRT > 3 days ‚Äî energy/odor risks; verify design.");

  // F/M calculation
const FM = (Q * S0) / (X * V); // per day
if (!isFiniteNum(FM) || FM <= 0) {
  return showErrors([
    "‚ö†Ô∏è F/M ratio could not be calculated because one or more inputs are invalid.",
    !isFiniteNum(Q)  || Q  <= 0 ? "üëâ Flow rate (Q) is not valid. Enter a positive value in m¬≥/day." : "",
    !isFiniteNum(S0) || S0 <= 0 ? "üëâ Influent BOD (S‚ÇÄ) is not valid. Enter a positive value in mg/L." : "",
    !isFiniteNum(X)  || X  <= 0 ? "üëâ Biomass concentration (X) is not valid. Enter a positive value in mg/L." : "",
    !isFiniteNum(V)  || V  <= 0 ? "üëâ Aeration tank volume (V) is not valid. Enter a positive value in m¬≥." : ""
  ].filter(Boolean));
}

// Guardrail check
if (FM < 0.001 || FM > 3.0) {
  if (V < 50) {
    return showErrors([`üëâ Aeration tank volume (V = ${V}) is too small for the given flow and load. Increase V.`]);
  }
  if (X < 1000) {
    return showErrors([`üëâ Biomass concentration (X = ${X}) is too low. Increase MLSS/MLVSS to handle the load.`]);
  }
  if (Q > 100000) {
    return showErrors([`üëâ Flow rate (Q = ${Q}) is very high compared to tank volume. Reduce Q or increase V.`]);
  }
  if (S0 > 5000) {
    return showErrors([`üëâ Influent BOD (S‚ÇÄ = ${S0}) is too high. Consider pre-treatment or dilution.`]);
  }
  // fallback if none of the above clearly applies
  return showErrors([`‚ö†Ô∏è Computed F/M = ${FM.toFixed(4)} d‚Åª¬π cannot be supported with the given inputs. Please recheck values.`]);
}


  // Classification & guidance
  let classification, suggestion, color = "#2c7a7b";
  if (FM < 0.05) {
    classification = "Very Low";
    suggestion = "Endogenous conditions; verify nitrification goals and energy use.";
    color = "#006400";
  } else if (FM < 0.20) {
    classification = "Low";
    suggestion = "Extended aeration/low-load; check clarifier blanket health.";
    color = "#2c7a7b";
  } else if (FM <= 0.60) {
    classification = "Optimal (CAS)";
    suggestion = "Favorable operating window for conventional activated sludge.";
    color = "#1560bd";
  } else if (FM <= 1.00) {
    classification = "High";
    suggestion = "Risk of poor settling/filaments; consider increasing X or V, or reduce load.";
    color = "#b35d00";
  } else {
    classification = "Very High";
    suggestion = "Overloaded; immediate action: reduce Q/S‚ÇÄ or increase biomass/volume.";
    color = "#b00020";
  }

  // Render result
  fmEl.textContent = FM.toFixed(4);
  const details = `
    <div>Classification: <b style="color:${color}">${classification}</b></div>
    <div style="margin-top:6px;">${suggestion}</div>
    <div style="margin-top:8px; font-size:14px;">
      Food load: <b>${foodLoadKgPerDay.toFixed(2)}</b> kg BOD/day |
      Biomass: <b>${biomassKg.toFixed(2)}</b> kg MLVSS |
      HRT: <b>${HRTd.toFixed(3)} d</b> (~${HRTh.toFixed(1)} h)
    </div>
    ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
  `;
  feedbackEl.innerHTML = details;

  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}



<!--
Food-to-Microorganism (F/M) Ratio Calculator
--------------------------------------------

üìå Formula:
  F/M = (Q √ó S‚ÇÄ) / (X √ó V)

  where:
    ‚Ä¢ Q  = Influent flow rate (m¬≥/day)
    ‚Ä¢ S‚ÇÄ = Influent BOD concentration (mg/L)
    ‚Ä¢ X  = Mixed liquor suspended solids (MLVSS, mg/L)
    ‚Ä¢ V  = Aeration tank volume (m¬≥)
    ‚Ä¢ F/M = Food-to-Microorganism ratio (per day)

üì• Inputs:
  ‚Ä¢ Q  (m¬≥/day) ‚Äî required
  ‚Ä¢ S‚ÇÄ (mg/L) ‚Äî required
  ‚Ä¢ X  (mg/L) ‚Äî required
  ‚Ä¢ V  (m¬≥) ‚Äî required

üì§ Outputs:
  ‚Ä¢ F/M (d‚Åª¬π)
  ‚Ä¢ Classification & operating guidance
  ‚Ä¢ Food load (kg BOD/day)
  ‚Ä¢ Biomass inventory (kg MLVSS)
  ‚Ä¢ HRT (days & hours)
  ‚Ä¢ Advisory warnings

‚úÖ Input Validations:
  1. Required:
     - All four inputs must be > 0.
  2. Practical ranges:
     - Q: 0.001 ‚Äì 1,000,000 m¬≥/day
     - S‚ÇÄ: 1 ‚Äì 100,000 mg/L
     - X: 100 ‚Äì 15,000 mg/L
     - V: 0.1 ‚Äì 10,000,000 m¬≥
  3. Decimal significance:
     - Q, V ‚â§ 3 decimals
     - S‚ÇÄ, X ‚â§ 1 decimal
  4. Derived checks:
     - X¬∑V must be > 1
     - F/M must be within 0.001 ‚Äì 3.0 d‚Åª¬π
     - Reject invalid or non-finite outputs

‚ö†Ô∏è Advisory Rules:
  ‚Ä¢ Low S‚ÇÄ (<100 mg/L) ‚Üí low-strength wastewater  
  ‚Ä¢ High S‚ÇÄ (>3000 mg/L) ‚Üí shock load or unit mismatch  
  ‚Ä¢ X outside 1500‚Äì5000 mg/L ‚Üí unusual MLVSS range  
  ‚Ä¢ Biomass < 50 kg ‚Üí very small system  
  ‚Ä¢ Biomass > 2,000,000 kg ‚Üí check units  
  ‚Ä¢ HRT < 1 h ‚Üí risk of short-circuiting  
  ‚Ä¢ HRT > 3 d ‚Üí possible energy/odor problems  

üìä Classification & Guidance:
  ‚Ä¢ Very Low (F/M < 0.05):
       - Endogenous respiration; check nitrification & energy use.
  ‚Ä¢ Low (0.05 ‚Äì 0.20):
       - Extended aeration/low load; monitor clarifier health.
  ‚Ä¢ Optimal CAS (0.20 ‚Äì 0.60):
       - Favorable zone for conventional activated sludge.
  ‚Ä¢ High (0.60 ‚Äì 1.00):
       - Risk of poor settling; increase X or V, or reduce load.
  ‚Ä¢ Very High (>1.00):
       - Overloaded; reduce Q/S‚ÇÄ or increase biomass/volume immediately.
-->
