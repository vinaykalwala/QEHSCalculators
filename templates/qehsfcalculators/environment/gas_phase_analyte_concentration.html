{% extends 'base.html' %}
{% block title %}Gas Phase Analyte Concentration Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Phase Analyte Concentration Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
  <h1>Gas Phase Analyte Concentration Calculator</h1>
  <p>
    Computes gas-phase analyte concentration in a sampling bag or chamber.
    Result is shown in <strong>ppm (parts per million, v/v)</strong>.
  </p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Parameters</h2>

    <div class="input-row">
      <div class="form-group">
        <label for="T_ambient">Ambient Temperature (T<sub>ambient</sub>) — K *</label>
        <input type="number" id="T_ambient" class="form-input" step="any" min="0" placeholder="e.g., 298">
      </div>
      <div class="form-group">
        <label for="V_analyte">Analyte Volume (V<sub>analyte</sub>) — µL *</label>
        <input type="number" id="V_analyte" class="form-input" step="any" min="0" placeholder="e.g., 50">
      </div>
    </div>

    <div class="input-row">
      <div class="form-group">
        <label for="rho_analyte">Analyte Density (ρ<sub>analyte</sub>) — g/cm³ *</label>
        <input type="number" id="rho_analyte" class="form-input" step="any" min="0" placeholder="e.g., 0.8">
      </div>
      <div class="form-group">
        <label for="P_ambient">Ambient Pressure (P<sub>ambient</sub>) — mmHg *</label>
        <input type="number" id="P_ambient" class="form-input" step="any" min="0" placeholder="e.g., 760">
      </div>
    </div>

    <div class="input-row">
      <div class="form-group">
        <label for="V_matrix">Matrix Gas Volume (V<sub>matrix</sub>) — L *</label>
        <input type="number" id="V_matrix" class="form-input" step="any" min="0" placeholder="e.g., 10">
      </div>
      <div class="form-group">
        <label for="MW_analyte">Analyte Molecular Weight (MW) — g/mol *</label>
        <input type="number" id="MW_analyte" class="form-input" step="any" min="0" placeholder="e.g., 44">
      </div>
    </div>

    <button class="calculate-btn" onclick="calculateConcentration()">Calculate Concentration</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Gas analysis illustration">
      <p>This tool estimates analyte concentration in gas-phase systems (ppm v/v).</p>
    </div>

    <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue" aria-live="polite">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Analyte Concentration</h2>
      </div>

      <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
        <div class="rate-value" id="concentrationValue">0.00</div>
        <div class="rate-label" style="font-size:16px; color:#2980b9;">ppm (v/v)</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      Calculates the concentration of a liquid analyte after evaporation into a gas-phase
      matrix. Useful for laboratory calibration, air quality checks, and safety analysis
      of toxic/flammable gases.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><b>T<sub>ambient</sub> (K):</b> Ambient temperature in Kelvin.</li>
      <li><b>V<sub>analyte</sub> (µL):</b> Volume of liquid analyte.</li>
      <li><b>ρ<sub>analyte</sub> (g/cm³):</b> Density of the analyte.</li>
      <li><b>P<sub>ambient</sub> (mmHg):</b> Ambient pressure.</li>
      <li><b>V<sub>matrix</sub> (L):</b> Volume of the gas-phase matrix.</li>
      <li><b>MW<sub>analyte</sub> (g/mol):</b> Molecular weight of the analyte.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>T<sub>ambient</sub> (K):</b> 150–350 K typical; must be >0.</li>
      <li><b>V<sub>analyte</sub> (µL):</b> 0.1–1000 µL reasonable; must be >0.</li>
      <li><b>ρ<sub>analyte</sub> (g/cm³):</b> 0.2–2.0 typical; must be >0.</li>
      <li><b>P<sub>ambient</sub> (mmHg):</b> 300–800 typical (altitude range); must be >0.</li>
      <li><b>V<sub>matrix</sub> (L):</b> 0.1–100 typical; must be >0.</li>
      <li><b>MW<sub>analyte</sub> (g/mol):</b> 2–500 typical range; must be >0.</li>
      <li>Cross-check: denominator must not → 0 (prevents division by zero).</li>
      <li>Decimals: up to 6 accepted; results rounded to 2 decimals.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📏 Output Validations</h3>
    <ul class="note-list">
      <li><b>&lt;1 ppm:</b> Trace level (may be below detection limit).</li>
      <li><b>1–100 ppm:</b> Low concentration, usually safe unless toxic analyte.</li>
      <li><b>100–1000 ppm:</b> Elevated concentration, may require monitoring.</li>
      <li><b>&gt;1000 ppm:</b> High concentration, possible safety concern (toxic/flammable risk).</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      A gas phase analyte concentration calculator is not of one single standard, but rather uses either the External Standard method or the Internal Standard method, both of which are standard calibration techniques in gas chromatography (GC) to determine the concentration of an analyte in a sample. The choice between these methods depends on the specific requirements of the analysis, such as accuracy needs and the complexity of the sample matrix.
    </p>
    <p><b>1. External Standard Calibration</b></p>
    <p><b>Principle:</b> This is the classical method where a series of standard solutions with known concentrations of the analyte are analyzed. A calibration curve is then generated by plotting the analyte's peak area (or height) against its known concentration.</p>
    <p><b>How it works:</b> The peak area from the unknown sample is compared to this calibration curve to determine its concentration.</p>
    <p><b>Considerations:</b> This method is suitable for samples with simple matrices and where the injection and sample preparation processes are highly consistent.</p>
    <p><b>2. Internal Standard Calibration</b></p>
    <p><b>Principle:</b> An internal standard (IS) is a compound added at a fixed concentration to all samples and standards. The concentration of the analyte is then determined by the ratio of its peak area to that of the internal standard.</p>
    <p><b>How it works:</b> By comparing the analyte's peak area to the IS peak area, variations in the injection process, sample preparation, and other matrix effects are accounted for.</p>
    <p><b>Considerations:</b> This method is more robust and provides more accurate results in complex samples where such variations are common.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      The calculator provides a reliable estimate of gas-phase analyte concentration based on the provided parameters and chosen calibration method. Ensure input values align with typical ranges for accurate results, and select the appropriate calibration method (External or Internal Standard) based on sample complexity and analysis requirements.
    </p>
  </div>
</div>
</div>
<script>
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

function calculateConcentration() {
  const sT  = document.getElementById("T_ambient").value.trim();
  const sVa = document.getElementById("V_analyte").value.trim();
  const srho = document.getElementById("rho_analyte").value.trim();
  const sP  = document.getElementById("P_ambient").value.trim();
  const sVm = document.getElementById("V_matrix").value.trim();
  const sMW = document.getElementById("MW_analyte").value.trim();

  const resultValue = document.getElementById("resultValue");
  const placeholder = document.getElementById("placeholder");
  const errorBox = document.getElementById("resultError");
  const concEl = document.getElementById("concentrationValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = (v) => Number.isFinite(v) && !Number.isNaN(v);

  // Parse inputs
  const T = parseFloat(sT);
  const Va = parseFloat(sVa);
  const rho = parseFloat(srho);
  const P = parseFloat(sP);
  const Vm = parseFloat(sVm);
  const MW = parseFloat(sMW);

  // Validations
  if (!isFiniteNum(T) || T <= 0) errors.push("👉 Temperature must be >0 K.");
  else if (T < 150 || T > 350) warnings.push("⚠️ T outside typical lab range (150–350 K).");

  if (!isFiniteNum(Va) || Va <= 0) errors.push("👉 Analyte volume must be >0 µL.");
  else if (Va > 1000) warnings.push("⚠️ Very large analyte volume (>1000 µL). May exceed matrix capacity.");

  if (!isFiniteNum(rho) || rho <= 0) errors.push("👉 Density must be >0 g/cm³.");
  else if (rho < 0.2 || rho > 2.0) warnings.push("⚠️ Density outside normal liquid range (0.2–2.0 g/cm³).");

  if (!isFiniteNum(P) || P <= 0) errors.push("👉 Pressure must be >0 mmHg.");
  else if (P < 300 || P > 800) warnings.push("⚠️ Ambient pressure unusual (typical 300–800 mmHg).");

  if (!isFiniteNum(Vm) || Vm <= 0) errors.push("👉 Matrix gas volume must be >0 L.");
  else if (Vm > 100) warnings.push("⚠️ Very large bag volume (>100 L). Check units.");

  if (!isFiniteNum(MW) || MW <= 0) errors.push("👉 Molecular weight must be >0 g/mol.");
  else if (MW < 2 || MW > 500) warnings.push("⚠️ MW outside expected range (2–500 g/mol).");

  if (errors.length) return showErrors(errors);

  // Calculation
  const numerator = T * Va * rho;
  const denominator = 16.036 * (P * Vm * MW) + numerator;
  if (denominator === 0) return showErrors(["⚠️ Invalid denominator. Check inputs."]);

  const concentration = (numerator / denominator) * 1e6;

  // Output
  concEl.textContent = concentration.toFixed(2);

  let assess = "";
  if (concentration < 1) assess = "Trace level (<1 ppm)";
  else if (concentration < 100) assess = "Low concentration (1–100 ppm)";
  else if (concentration < 1000) assess = "Elevated concentration (100–1000 ppm)";
  else assess = "⚠️ High concentration (>1000 ppm) — check safety compliance.";

  feedbackEl.innerHTML = assess + (warnings.length ? "<br>" + warnings.join(" | ") : "");

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
}
</script>

<script src="{% static 'js/print.js' %}"></script>



</body>
</html>
{% endblock %}


<!-- 
📌 Gas Concentration Calculator

Formula:
 concentration = (T × V_analyte × ρ_analyte) 
                 / [16.036 × (P × V_matrix × MW) + (T × V_analyte × ρ_analyte)] × 1e6
 → Units: ppm

Inputs:
 - T_ambient → Temperature [K]
 - V_analyte → Analyte volume [µL]
 - ρ_analyte → Analyte density [g/cm³]
 - P_ambient → Ambient pressure [mmHg]
 - V_matrix → Matrix gas volume [L]
 - MW_analyte → Molecular weight [g/mol]

Input Validations:
 - Temperature: must be >0 K  
   ⚠️ Warning if <150 or >350 K  
 - Analyte Volume: must be >0 µL  
   ⚠️ Warning if >1000 µL  
 - Density: must be >0 g/cm³  
   ⚠️ Warning if <0.2 or >2.0 g/cm³  
 - Pressure: must be >0 mmHg  
   ⚠️ Warning if <300 or >800 mmHg  
 - Matrix Volume: must be >0 L  
   ⚠️ Warning if >100 L  
 - Molecular Weight: must be >0 g/mol  
   ⚠️ Warning if <2 or >500 g/mol  

Output:
 - Concentration [ppm]
 - Assessment message (Trace, Low, Elevated, High)
 - Warnings (if inputs are outside typical ranges)

Output Validations:
 - Denominator must not equal 0  
 - Concentration must be ≥ 0 ppm  
 - Assessment ranges:  
     • <1 ppm → Trace  
     • 1–100 ppm → Low  
     • 100–1000 ppm → Elevated  
     • >1000 ppm → High (safety check required)
-->
