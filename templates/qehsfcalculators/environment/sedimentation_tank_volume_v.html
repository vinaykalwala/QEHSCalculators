{% extends 'base.html' %}
{% block title %}Sedimentation Tank Volume (V) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sedimentation Tank Volume (V) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Sedimentation Tank Volume (V) Calculator</h1>
        <p>Calculate the required tank volume for sedimentation processes in water treatment systems.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="flow_rate">Flow Rate (Q, m³/s)</label>
                <input type="number" id="flow_rate" class="form-input" step="any" min="0" placeholder="e.g., 2.5">
            </div>
            
            <div class="form-group">
                <label for="detention_time">Detention Time (td, hours)</label>
                <input type="number" id="detention_time" class="form-input" step="any" min="0" placeholder="e.g., 4">
            </div>

            <button class="calculate-btn" onclick="calculateTankVolume()">Calculate Tank Volume</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Water treatment illustration">
                <p>This tool calculates sedimentation tank volume for water treatment optimization.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Sedimentation Tank Volume (V)</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="tankVolumeValue">0.000</div>
                    <div class="rate-unit">m³</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes -->
    <div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Sedimentation Tank Volume (V) Calculator</strong> determines the required volume for sedimentation tanks in water and wastewater treatment systems. Proper tank sizing is essential for ensuring adequate detention time, allowing suspended solids to settle effectively before the water moves to the next treatment stage.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Q (Flow Rate):</strong> The volumetric flow rate of water entering the treatment system (m³/s).</li>
            <li><strong>td (Detention Time):</strong> The theoretical time water remains in the sedimentation tank (hours).</li>
        </ul>
    </div>


    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Flow Rate (Q):</strong> Must be > 0 m³/s (typical range: 0.01-100 m³/s).</li>
            <li><strong>Detention Time (td):</strong> Must be > 0 hours (typical range: 1-8 hours for sedimentation).</li>
            <li><strong>Maximum Detention Time:</strong> Should not exceed 12 hours to prevent septic conditions.</li>
            <li><strong>Minimum Detention Time:</strong> Should be at least 1 hour for effective sedimentation.</li>
            <li><strong>Unit Consistency:</strong> Flow rate must be in m³/s and detention time in hours.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>V must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>V > 10,000 m³:</strong> ⚠️ Very large tank →  Suitable for high capacity treatment plants.</li>
            <li><strong>500 m³ ≤ V ≤ 10,000 m³:</strong> ✅ Appropriate Size → Tank volume is within typical range for municipal applications.</li>
            <li><strong>V < 500 m³:</strong> ⚠️ Small tank → May not provide sufficient detention time for effective sedimentation.</li>
            <li><strong>V = 0:</strong> ❌ Impossible scenario → Check input values.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📏Standards & Compliance </h3>
        <ul class="note-list">
            <li>✔️ Design parameters follow <strong>EPA and WHO guidelines</strong> for water treatment facilities.</li>
            <li>✔️ Detention time ranges align with <strong>ASCE standards</strong> for sedimentation processes.</li>
            <li>✔️ All values use <strong>standard water engineering units</strong> (m³/s, hours, m³).</li>
            <li>✔️ Calculations support <strong>environmental compliance</strong> for water quality standards.</li>
            <li>✔️ Validations based on <strong>industry best practices</strong> for water treatment design.</li>
        </ul>
    </div>
<div class="note-card">
    <h3>📌 Conclusion</h3>
    <p>
        The Sedimentation Tank Volume (V) Calculator ensures correct sizing of tanks by validating inputs, applying the standard
        design formula, and classifying results. This helps in achieving effective sedimentation, compliance with engineering
        standards, and optimal water treatment performance.
    </p>
</div>

</div>
<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateTankVolume() {
    // Read values
    const Q = parseFloat(document.getElementById("flow_rate").value);
    const td = parseFloat(document.getElementById("detention_time").value);

    const tankVolumeValueEl = document.getElementById("tankVolumeValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![Q, td].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    if (Q <= 0) errors.push("👉 Flow rate (Q) must be > 0 m³/s.");
    if (td <= 0) errors.push("👉 Detention time (td) must be > 0 hours.");
    
    // Warning for unusual values
    if (Q > 100) warnings.push("⚠️ Flow rate unusually high (>100 m³/s).");
    if (Q < 0.01) warnings.push("⚠️ Flow rate unusually low (<0.01 m³/s).");
    if (td > 12) warnings.push("⚠️ Detention time exceeds recommended maximum (>12 hours).");
    if (td < 1) warnings.push("⚠️ Detention time below recommended minimum (<1 hour).");

    if (errors.length) return showErrors(errors);

    // Formula: V = Q × 3600 × td
    const V = Q * 3600 * td;

    if (!Number.isFinite(V)) {
        return showErrors(["⚠️ Computed tank volume is invalid (possible calculation error)."]);
    }

    if (V <= 0) {
        return showErrors(["❌ Tank volume must be greater than zero."]);
    }

    // Classification
    let classification, suggestion, color;
    if (V > 10000) {
        classification = "Very Large Tank";
        suggestion = "⚠️ Suitable for high capacity treatment plants.";
        color = "#e65100";
    } else if (V >= 500) {
        classification = "Appropriate Size";
        suggestion = "✅ Tank volume is within typical range for municipal applications.";
        color = "#2e7d32";
    } else {
        classification = "Small Tank";
        suggestion = "⚠️ May not provide sufficient detention time for effective sedimentation.";
        color = "#c62828";
    }

    // Display result
    tankVolumeValueEl.textContent = V.toFixed(2);
    feedbackEl.innerHTML = `
        <div>V = <b>${V.toFixed(2)}</b> m³</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

Input Validations:

Flow Rate (Q) must be > 0 m³/s (typical range: 0.01-100 m³/s)

Detention Time (td) must be > 0 hours (typical range: 1-8 hours)

Maximum detention time should not exceed 12 hours

Minimum detention time should be at least 1 hour
-----------------------------------------------------------------------------
Output Validations:

V > 10,000 m³: Very large tank (warning)

500 m³ ≤ V ≤ 10,000 m³: Appropriate size

V < 500 m³: Small tank (warning)

V must be finite and positive
----------------------------------------------------------------------------------------------
Formula
Tank Volume (V) = Flow Rate (Q) × 3600 × Detention Time (td)

Where:

Q is the flow rate in m³/s

td is the detention time in hours

3600 is the conversion factor from seconds to hours (since 1 hour = 3600 seconds)
-->