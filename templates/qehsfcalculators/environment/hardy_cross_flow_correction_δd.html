{% extends 'base.html' %}
{% block title %}Hardy Cross Flow Correction Calculator (Δd){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardy Cross Flow Correction Calculator (Δd)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        
.result-card::-webkit-scrollbar {
    width: 8px;
}

.result-card::-webkit-scrollbar-thumb {
    background: #1560bd;
    border-radius: 6px;
}

.result-card::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.result-card {
    justify-content: flex-start; /* align from top */
    align-items: stretch;
    min-height: 420px;
    text-align: center;
    overflow-y: auto;       /* Enable vertical scrolling */
    max-height: 450px;      /* Set max height to control output size */
    padding: 20px;          /* keep spacing */
}

        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}



<div class="calculator-header">
  <h1>Hardy Cross Flow Correction (Δd) Calculator</h1>
  <p>Compute the flow correction <strong>Δd</strong> for a loop using the Hardy Cross method.
</div>

<div class="calc-content">
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="sumHL"><strong>ΣHL (algebraic sum of head losses around loop)</strong> — m or ft *</label>
      <input type="number" id="sumHL" class="form-input" step="any" placeholder="e.g., -2.5">
    </div>

    <div class="form-group">
      <label for="sumHLQa"><strong>Σ|HL/Qa| (sum of |head loss / assumed flow|)</strong> — (m per m³/s) or (ft per gpm) *</label>
      <input type="number" id="sumHLQa" class="form-input" step="any" placeholder="e.g., 1200">
    </div>

    <div class="form-group">
      <label for="exponent"><strong>Exponent (x)</strong> — 1.85 (Hazen-Williams) or 2 (Darcy-Weisbach) *</label>
      <input type="number" id="exponent" class="form-input" step="any" placeholder="e.g., 1.85">
    </div>

    <button class="calculate-btn" onclick="calculateCorrosionRate()">Calculate Flow Correction</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Network loop illustration">
      <p>This tool computes the Hardy-Cross flow correction (Δd) and provides QEHS-oriented guidance and warnings.</p>
    </div>

    <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue" aria-live="polite">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Flow Correction Result</h2>
      </div>

      <div class="rate-display" style="display:flex; gap:24px; align-items:center;">
        <div>
          <div class="rate-label" style="font-size:14px; color:#2980b9;">Correction (Δd)</div>
          <div class="rate-value" id="rateValue">0.000000</div>
          <div class="rate-label" id="unitLabel" style="font-size:12px; color:#666;">same units as Qa (e.g., m³/s)</div>
        </div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>

      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes tuned for Hardy Cross -->
<div class="note-section">
  <div class="note-card">
    <h3>🔎 About This Calculator</h3>
    <p>
      This calculator applies the classical Hardy Cross loop-balancing step. Provide the algebraic sum of head losses
      around a closed loop (ΣHL), the sum of absolute <em>head-loss-per-assumed-flow</em> terms (Σ|HL/Qa|) built from your current
      assumed flows, and the exponent.
      The output <strong>Δd</strong> is a flow correction to be added to each branch in the loop according to its sign convention.
    </p>
  </div>
  <div class="note-card">
  <h3>❓ Parameters</h3>
  <ul class="note-list">
    <li><b>ΣHL (Head-loss sum, m or ft):</b> algebraic sum of head losses; may be positive or negative; practical limit |ΣHL| ≤ 1e6.</li>
    <li><b>Σ|HL/Qa|:</b> sum of absolute head-loss-per-flow terms; must be > 0; practical range 1e−12 – 1e12.</li>
    <li><b>Exponent (x):</b> usually 1.85 (Hazen–Williams) or 2.0 (Darcy–Weisbach); must be > 0; acceptable range 1.5 – 2.5.</li>
  </ul>
</div>


  <div class="note-card">
    <h3>📌 Input validations</h3>
    <ul class="note-list">
      <li><b>ΣHL (m or ft):</b> required; numeric; may be positive or negative; reject if = 0 (no correction needed) only after checks; practical magnitude |ΣHL| ≤ 1e6.</li>
      <li><b>Σ|HL/Qa|:</b> required; numeric; <b>&gt; 0</b>; practical range 1e-12 – 1e12 in chosen units; reject if near zero to avoid huge Δd.</li>
      <li><b>x (exponent):</b> required; prefer <b>1.85</b> (H-W) or <b>2</b> (D-W). Allow 1.7–2.1 with warning; reject outside 1.5–2.5.</li>
      <li><b>Precision:</b> accept up to 6 decimals; outputs rounded to 6 decimals (or exponential if extreme).</li>
      <li><b>Consistency:</b> Units used to build ΣHL and Σ|HL/Qa| must be consistent; Δd will be in the same flow units used for Qa.</li>
    </ul>
  </div>

  <div class="note-card">
  <h3>✅ Output Validations</h3>
  <ul class="note-list">
    <li><b>Denominator (x·Σ|HL/Qa|):</b> must be finite and non-zero; error if &lt; 1e−12 (ill-conditioned loop).</li>
    <li><b>Δd (Flow correction):</b> must be finite; error if |Δd| &gt; 1×10⁹ (likely unit/scale error); rounded to 6 decimals or exponential form if extreme.</li>
    <li><b>Classification:</b>
      <ul>
        <li>ΣHL = 0 → Balanced → no correction required.</li>
        <li>|Δd| &lt; 1e−9 → Effectively balanced </li>
        <li>Δd &gt; 0 → Increase assumed loop flow by Δd (sign per your loop convention).</li>
        <li>Δd &lt; 0 → Reduce assumed loop flow by  |Δd| (sign per your loop convention)</li>
      </ul>
    </li>
  </ul>
</div>
<div class="note-card ">
    <h3>📐  Governing Principle</h3>
    <p>
The Hardy Cross method itself is not governed by a single, universal standard like a manufacturing or quality standard; rather, it is a fundamental engineering method for analyzing pipe networks, particularly water distribution systems, and is used in conjunction with established engineering principles and formulas, such as the Hazen-Williams formula. Engineering colleges teach the method, and various improved versions and software implementations exist, demonstrating its wide application rather than adherence to a specific, unified standard.  
</p>
<h3 style="margin-top:12px; color:#1976d2;"> Key Aspects:</h4>
  <ul class="note-list">
<li><b>Engineering Method:</b>
The Hardy Cross method is a widely taught and used engineering principle for analyzing hydraulic networks like water or gas distribution systems.</li> 
<li><b>No Single "Standard":</b>
Unlike standardized tests or manufactured products, the Hardy Cross method is a procedure, not a product that adheres to a specific governing body's standard. 
</li>
<li><b>Application of Principles:,</b>
The method relies on core fluid mechanics principles, such as conservation of mass at junctions (total inflow equals total outflow) and energy balance in closed loops (sum of head losses is zero). 
</li>

<li><b>Use with Other Formulas:</b>
For calculating head losses within the network, engineers often use formulas developed under established hydraulics practices, such as the Hazen-Williams formula. 
</li>
<li><b>Evolution of the Method:</b>
The original method has been modified over time to be more efficient, often incorporated into software, further indicating its status as a dynamic engineering approach rather than a rigid standard. 
</li></p></div>

<div class="note-card">
  <h3>💡 Conclusion</h3>
  <p>
    The calculator applies the Hardy–Cross formula.
    The correction <b>Δd</b> has the same units as the assumed flow Qa.  
    Small Δd values mean the loop is nearly balanced, while extreme results indicate possible unit or scale errors.  
    Ensure consistent units (m vs ft, m³/s vs gpm) for reliable results.
  </p>
</div>



</div>

<script>/* Reuse showErrors pattern */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Main calculator — name preserved to keep existing wiring */
function calculateCorrosionRate() {
  const sHL = document.getElementById("sumHL").value.trim();
  const sHLQa = document.getElementById("sumHLQa").value.trim();
  const sExp = document.getElementById("exponent").value.trim();

  const placeholder = document.getElementById("placeholder");
  const errorBox = document.getElementById("resultError");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");
  const unitLabel = document.getElementById("unitLabel");

  errorBox.classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = v => Number.isFinite(v) && !Number.isNaN(v);
  const decLen = s => (s && s.includes('.')) ? s.split('.')[1].length : 0;

  // Presence
  if (sHL === "") errors.push("👉 Enter ΣHL (algebraic sum of head losses) in m or ft.");
  if (sHLQa === "") errors.push("👉 Enter Σ|HL/Qa| (sum of absolute head-loss-per-flow terms).");
  if (sExp === "") errors.push("👉 Enter exponent x (1.85 or 2).");
  if (errors.length) return showErrors(errors);

  // Parse
  const sumHL = parseFloat(sHL);
  const sumHLQa = parseFloat(sHLQa);
  const x = parseFloat(sExp);

  if (!isFiniteNum(sumHL)) errors.push("👉 ΣHL must be numeric.");
  if (!isFiniteNum(sumHLQa)) errors.push("👉 Σ|HL/Qa| must be numeric.");
  if (!isFiniteNum(x)) errors.push("👉 Exponent x must be numeric.");
  if (errors.length) return showErrors(errors);

  // Basic checks
  // ΣHL can be positive or negative; if exactly 0, Δd = 0 (balanced). We treat that as an info case below.
  if (!(sumHLQa > 0)) errors.push("👉 Σ|HL/Qa| must be > 0 to avoid division by zero.");
  // Exponent sanity
  if (x <= 0) errors.push("👉 Exponent x must be > 0.");
  if (x < 1.5 || x > 2.5) errors.push("👉 Exponent x out of acceptable range (1.5–2.5). Use 1.85 (H-W) or 2 (D-W).");

  // Practical magnitude checks (catch unit errors)
  if (Math.abs(sumHL) > 1e6) warnings.push("⚠️ |ΣHL| is extremely large — verify your head units and loop sum.");
  if (sumHLQa < 1e-12 || sumHLQa > 1e12) warnings.push("⚠️ Σ|HL/Qa| is outside practical range — check flow/head units.");
  if (x >= 1.7 && x <= 2.1 && x !== 1.85 && x !== 2.0) warnings.push("ℹ️ Non-standard exponent — ensure consistency with the equation used to form HL.");

  if (errors.length) return showErrors(errors);

  // Decimal precision warnings
  if (decLen(sHL) > 6) warnings.push("⚠️ ΣHL has >6 decimals; results will be rounded.");
  if (decLen(sHLQa) > 6) warnings.push("⚠️ Σ|HL/Qa| has >6 decimals; results will be rounded.");
  if (decLen(sExp) > 6) warnings.push("⚠️ x has >6 decimals; results will be rounded.");

  // Denominator safety (x * Σ|HL/Qa|)
  const denom = x * sumHLQa;
  if (!isFiniteNum(denom) || denom === 0) return showErrors(["⚠️ Invalid denominator x·Σ|HL/Qa| (zero or non-finite)."]);
  if (Math.abs(denom) < 1e-12) return showErrors(["⚠️ Denominator too small (<1e-12). Adjust assumptions; current loop is ill-conditioned."]);

  // Compute (standard Hardy-Cross correction):
  // Δd = - ΣHL / (x · Σ|HL/Qa|)
  const delta = -sumHL / denom;

  if (!isFiniteNum(delta)) return showErrors(["⚠️ Computed correction is invalid (non-finite). Check inputs."]);
  if (Math.abs(delta) > 1e9) return showErrors(["⚠️ |Δd| > 1×10⁹ (flow units) — likely unit or scale error."]);

  // Classification (small threshold considered balanced)
  const absDelta = Math.abs(delta);
  let classification = "";
  let color = "#2c7a7b";
  if (sumHL === 0) {
    classification = "Balanced: ΣHL = 0 → no correction required.";
    color = "#006400";
  } else if (absDelta < 1e-9) {
    classification = "Effectively balanced (|Δd| < 1e-9).";
    color = "#006400";
  } else if (delta > 0) {
    classification = "Increase assumed loop flow by Δd (sign per your loop convention).";
    color = "#155724";
  } else {
    classification = "Reduce assumed loop flow by |Δd| (sign per your loop convention).";
    color = "#b35d00";
  }

  // Formatting helper
  const fmt = v => {
    const a = Math.abs(v);
    if (a === 0) return "0.000000";
    if (a >= 1e-3 && a < 1e6) return v.toFixed(6);
    return v.toExponential(6);
  };

  // Render - ONLY update the rate value and assessment (classification removed)
  rateEl.textContent = fmt(delta);
  document.getElementById("unitLabel").textContent = "same units as Qa (e.g., m³/s)";

  let details = `<div><b>Δd (flow correction):</b> ${fmt(delta)} (same units as Qa)</div>`;
  details += `<div style="margin-top:6px;"><b>Classification:</b> <span style="color:${color}; font-weight:600">${classification}</span></div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = details;

  // Show results
  document.getElementById("placeholder").classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

/* Print helper */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) el.textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  window.print();
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /**
=======================================================
 Hardy–Cross Loop Flow Correction Calculator
=======================================================

 Formula:
   Δd = - ΣHL / (x · Σ|HL/Qa|)

 Where:
   Δd      = Flow correction (same units as Qa, e.g. m³/s)
   ΣHL     = Algebraic sum of head losses around loop (m or ft)
   Σ|HL/Qa|= Sum of absolute (head-loss / flow) terms
   x       = Exponent (≈1.85 for Hazen–Williams, 2 for Darcy–Weisbach)

-------------------------------------------------------
 Input Validations
-------------------------------------------------------
 • ΣHL (head-loss sum)
   - Must be numeric
   - Can be positive or negative
   - Warning if |ΣHL| > 1e6 → unit/scale error

 • Σ|HL/Qa|
   - Must be numeric
   - Must be > 0 (avoids division by zero)
   - Warning if < 1e−12 or > 1e12 → suspicious values

 • Exponent x
   - Must be numeric
   - Must be > 0
   - Must be within 1.5–2.5
   - Recommended: 1.85 (Hazen–Williams) or 2.0 (Darcy–Weisbach)

 • Decimal precision
   - Warn if inputs >6 decimals (rounded internally)

-------------------------------------------------------
 Output Validations
-------------------------------------------------------
 • Denominator (x·Σ|HL/Qa|) 
   - Must be finite and not zero
   - Error if < 1e−12 → loop ill-conditioned

 • Δd (flow correction)
   - Must be finite
   - Error if |Δd| > 1e9 (likely unit/scale error)

-------------------------------------------------------
 Output Classification
-------------------------------------------------------
 • ΣHL = 0 → Balanced (no correction needed)
 • |Δd| < 1e−9 → Effectively balanced
 • Δd > 0 → Increase assumed loop flow by Δd
 • Δd < 0 → Reduce assumed loop flow by |Δd|

-------------------------------------------------------
 Notes
-------------------------------------------------------
 • Output Δd has same units as Qa (your assumed flow).
 • Warnings catch common mistakes like wrong units, 
   mis-specified exponents, or numerical instabilities.
*/ -->


