{% extends 'base.html' %}
{% block title %}Incineration DRE Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incineration DRE Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
  <h1>Incineration DRE Calculator</h1>
  <p>Estimate <strong>Destruction & Removal Efficiency (DRE, %)</strong> from feed and emission rates of the same compound, measured over the same averaging period.</p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="units">Units (use the same for both W<sub>in</sub> and W<sub>out</sub>)</label>
      <select id="units" class="form-input" aria-label="Units">
        <option value="kg/h">kg/h</option>
        <option value="lb/h">lb/h</option>
      </select>
    </div>

    <div class="form-group">
      <label for="massFeedRate">Mass Feed Rate W<sub>in</sub></label>
      <input type="number" id="massFeedRate" class="form-input" min="0.0000001" step="any" placeholder="e.g., 12.5">
    </div>

    <div class="form-group">
      <label for="massEmissionRate">Mass Emission Rate W<sub>out</sub></label>
      <input type="number" id="massEmissionRate" class="form-input" min="0" step="any" placeholder="e.g., 0.0003">
    </div>

    <button class="calculate-btn" onclick="calculateDRE()">Calculate DRE</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="DRE illustration">
      <p>This tool calculates <strong>DRE (%)</strong> from mass feed and emission rates of the same POHC/compound.</p>
    </div>

    <div class="result-error hidden" id="resultError">
      <div class="error-icon">‚ùå</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Calculated DRE</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="rateValue">0.0000</div>
        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">%</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      This calculator estimates the Destruction & Removal Efficiency (DRE) for a target compound in an incinerator or thermal oxidizer,
      using its measured mass feed rate and stack emission rate. Use the <em>same compound</em>, <em>same averaging period</em>, and <em>same units</em> for both values.
      Results support compliance checks and performance optimization.
    </p>
  </div>
  <div class="note-card">
    <h3>‚ùì Parameters</h3>
    <ul class="note-list">
        <li><b>Mass Feed Rate W<sub>in</sub>:</b> Input mass flow rate of target compound; must be > 0; units: kg/h or lb/h.</li>
        <li><b>Mass Emission Rate W<sub>out</sub>:</b> Output mass flow rate of same compound; must be ‚â• 0; same units as W<sub>in</sub>.</li>
        <li><b>Units:</b> Consistent mass/time units (kg/h or lb/h) applied to both input and output rates.</li>
        <li><b>DRE Formula:</b> DRE (%) = [(W<sub>in</sub> - W<sub>out</sub>) √∑ W<sub>in</sub>] √ó 100</li>
    </ul>
</div>


  <div class="note-card">
    <h3>‚úÖ Input Validations </h3>
    <ul>
      <li>Units: choose kg/h or lb/h (applied to both inputs).</li>
      <li>W<sub>in</sub> &gt; 0 (required, numeric). Recommended reporting ‚â§ 6 decimals.</li>
      <li>W<sub>out</sub> ‚â• 0 (required, numeric). Recommended reporting ‚â§ 6 decimals.</li>
      <li>Logical consistency: W<sub>out</sub> ‚â§ W<sub>in</sub>.</li>
      <li>Sanity warnings (advisory): very small W<sub>in</sub> (&lt; 1e-6) or very large W<sub>in</sub> (&gt; 1e5) for a single compound.</li>
      <li>Reject non-finite results or DRE outside [0, 100].</li>
      <li>If W<sub>out</sub> is zero or near zero, DRE will approach 100% (consider detection limits).</li>
    </ul>
  </div>
    <div class="note-card">
    <h3>‚úÖ Output Validations</h3>
    <ul class="note-list">
      <li>DRE &lt; 90% ‚Üí üî¥ Low efficiency ‚Äî fails most standards; investigate burner, temperature, turbulence, and oxygen.</li>
      <li>90% ‚â§ DRE &lt; 99% ‚Üí ‚ö†Ô∏è Moderate efficiency ‚Äî review combustion conditions and residence time.</li>
      <li>99% ‚â§ DRE &lt; 99.99% ‚Üí ‚ö†Ô∏è High efficiency ‚Äî often acceptable, confirm permit conditions.</li>
      <li>DRE ‚â• 99.99% ‚Üí ‚úÖ Excellent efficiency ‚Äî typically meets hazardous waste requirements.</li>
    </ul>
  </div>
<div class="note-card formula-card">
    <h3>üìê Governing Principle</h3>
    <p>
        An <strong>Incineration DRE (Destruction and Removal Efficiency) Calculator</strong> is primarily based on standards set by the 
        <strong>U.S. Environmental Protection Agency (EPA)</strong>, specifically its 40 CFR Part 63, which mandates a 99.99% DRE for 
        Principal Organic Hazardous Constituents (POHCs) in hazardous waste incineration. 
        Other regulatory bodies and standards, such as those by the <strong>Central Pollution Control Board (CPCB)</strong> in India, 
        also employ DRE calculations for their respective waste types, but the EPA standard is the most well-known benchmark 
        for industrial incineration DRE calculators.
    </p>

    <h3> Key Aspects of EPA DRE Standards:</h3>
    <ul>
        <li><strong>99.99% DRE:</strong> The most common requirement is a 99.99% DRE for all designated Principal Organic Hazardous Constituents (POHCs).</li>
        <li><strong>Calculation:</strong> DRE is calculated using the formula: DRE = [1 - (Wout / Win)] x 100%, 
            where Win is the mass feed rate of the POHC in the waste feed, and Wout is the mass feed rate of the POHC in the stack gas.</li>
        <li><strong>Trial Burns:</strong> Facilities must often conduct trial burns to demonstrate that they can consistently meet these performance standards under operating conditions.</li>
        <li><strong>40 CFR Part 63:</strong> This specific section of the EPA's regulations outlines the performance standards for hazardous waste incinerators, including the DRE requirement.</li>
    </ul>

    <h3>Other Applicable Standards:</h3>
    <p>While the EPA's standard is a primary reference, the definition of a DRE calculator can also be applied to other regulatory frameworks:</p>
    <ul>
        <li><strong>CPCB Guidelines:</strong> In India, the CPCB sets standards for incinerators, including for bio-medical waste, involving performance criteria and emission control.</li>
        <li><strong>ASTM International:</strong> Professional organizations like ASTM provide methods and guidance for establishing Destruction Efficiency, which includes DRE.</li>
    </ul>
</div>

<div class="note-card">
    <h3>üí° Conclusion</h3>
    <p>
        This calculator determines the <strong>Destruction and Removal Efficiency (DRE)</strong> of incineration systems, 
        a critical parameter for regulatory compliance and environmental performance assessment. DRE values ‚â•99.99% 
        typically meet hazardous waste incineration standards, while lower values indicate the need for operational 
        optimization. Ensure measurements represent the same compound, averaging period, and units for accurate results. 
        Regular DRE monitoring helps maintain combustion efficiency and demonstrates environmental stewardship.
    </p>
</div>
</div>

<script>
/* Show error messages (preserves your UX flow) */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Core validation + calculation for DRE */
function calculateDRE() {
  const units = (document.getElementById("units").value || "").trim();
  const WinRaw = (document.getElementById("massFeedRate").value || "").trim();
  const WoutRaw = (document.getElementById("massEmissionRate").value || "").trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required checks
  if (!units) errors.push("üëâ Please select units (kg/h or lb/h).");
  if (!WinRaw) errors.push("üëâ Please enter Mass Feed Rate W_in.");
  if (!WoutRaw) errors.push("üëâ Please enter Mass Emission Rate W_out.");
  if (errors.length) return showErrors(errors);

  // Parse
  const Win = parseFloat(WinRaw);
  const Wout = parseFloat(WoutRaw);

  // Numeric + sign checks
  if (!Number.isFinite(Win) || Win <= 0) errors.push("üëâ W_in must be a positive number.");
  if (!Number.isFinite(Wout) || Wout < 0) errors.push("üëâ W_out cannot be negative.");
  if (errors.length) return showErrors(errors);

  // Cross-field logic
  if (Wout > Win) {
    return showErrors(["üëâ W_out cannot exceed W_in. Ensure the same compound, period, and units were used."]);
  }

  // Precision guidance (reporting consistency)
  const inDec = (String(Win).split('.')[1] || '').length;
  const outDec = (String(Wout).split('.')[1] || '').length;
  if (inDec > 6 || outDec > 6) {
    warnings.push("‚ö†Ô∏è High decimal precision ‚Äî round to ‚â§ 6 decimals for reporting consistency.");
  }

  // Soft plausibility (advisory only; unit-aware)
  // Thresholds are broad because POHC feed can vary widely.
  if (units === "kg/h") {
    if (Win < 1e-6) warnings.push("‚ö†Ô∏è Very small W_in (< 1e-6 kg/h) ‚Äî verify units and detection limits.");
    if (Win > 1e5) warnings.push("‚ö†Ô∏è Very large W_in (> 1e5 kg/h) for a single compound ‚Äî verify units and scope.");
  } else if (units === "lb/h") {
    if (Win < 2.2e-6) warnings.push("‚ö†Ô∏è Very small W_in (< 2.2e-6 lb/h) ‚Äî verify units and detection limits.");
    if (Win > 2.2e5) warnings.push("‚ö†Ô∏è Very large W_in (> 2.2e5 lb/h) for a single compound ‚Äî verify units and scope.");
  }

  // Compute DRE
  const DRE = ((Win - Wout) / Win) * 100;

  // Derived checks
  if (!Number.isFinite(DRE)) {
    return showErrors(["‚ö†Ô∏è Computed DRE is invalid. Check inputs and units."]);
  }
  // Numeric noise/edge handling
  if (DRE < -1e-9 || DRE > 100 + 1e-9) {
    return showErrors([`üëâ Computed DRE = ${DRE.toFixed(6)}% is outside [0, 100]. Verify data, averaging periods, and lab QA/QC.`]);
  }

  // Clamp tiny numerical drift into bounds for display
  const DREclamped = Math.min(100, Math.max(0, DRE));

  // Classification + advisories
  let statusMsg = "";
  if (DREclamped >= 99.99) {
    statusMsg = "‚úÖ Excellent efficiency ‚Äî typically meets hazardous waste requirements.";
  } else if (DREclamped >= 99.0) {
    statusMsg = "‚ö†Ô∏è High efficiency ‚Äî often acceptable, confirm permit conditions.";
  } else if (DREclamped >= 90.0) {
    statusMsg = "‚ö†Ô∏è Moderate efficiency ‚Äî review combustion conditions and residence time.";
  } else {
    statusMsg = "üî¥ Low efficiency ‚Äî fails most standards; investigate burner, temperature, turbulence, and oxygen.";
  }

  if (Wout === 0) {
    warnings.push("‚ÑπÔ∏è W_out entered as 0 ‚Äî result may reflect instrument detection limit; report MDL/LOQ if applicable.");
  }
  if (Win > 0 && (Wout / Win) > 0.5) {
    warnings.push("‚ö†Ô∏è Emissions exceed 50% of feed ‚Äî very poor destruction; verify sampling durations and analyte consistency.");
  }

  // Build details (no explicit formula printed)
  let details = `<div>DRE: <b>${DREclamped.toFixed(4)}</b>%</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }

  // Update UI
  document.getElementById("rateValue").textContent = DREclamped.toFixed(4);
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}




<!-- /* 
==============================================
 Formula:
   DRE (%) = ((W_in ‚Äì W_out) / W_in) √ó 100
   where:
     W_in  = Mass Feed Rate (kg/h or lb/h)
     W_out = Mass Emission Rate (kg/h or lb/h)
   Output = DRE in percentage
==============================================

 Input Validations:
   1. Required:
      - Units must be selected (kg/h or lb/h).
      - W_in must be provided.
      - W_out must be provided.
   2. Numeric & Sign Checks:
      - W_in must be > 0 (positive number).
      - W_out must be ‚â• 0 (cannot be negative).
   3. Cross-field Logic:
      - W_out ‚â§ W_in (emission cannot exceed feed).
   4. Precision:
      - Warn if > 6 decimal places in inputs.
   5. Plausibility (unit-aware ranges):
      - For kg/h:
          W_in < 1e-6 ‚Üí very small, verify units.
          W_in > 1e5 ‚Üí very large, verify scope.
      - For lb/h:
          W_in < 2.2e-6 ‚Üí very small.
          W_in > 2.2e5 ‚Üí very large.

 Output Validations:
   1. Computed DRE must be finite (no NaN/Infinity).
   2. Range Check:
      - Must be within 0% ‚â§ DRE ‚â§ 100%.
   3. Clamp:
      - Clamp tiny floating drift into [0, 100].
   4. Classification:
      - ‚â• 99.99% ‚Üí Excellent efficiency.
      - ‚â• 99.0%  ‚Üí High efficiency.
      - ‚â• 90.0%  ‚Üí Moderate efficiency.
      - < 90.0%  ‚Üí Low efficiency.
   5. Special Advisories:
      - If W_out = 0 ‚Üí flag as detection limit reporting.
      - If W_out / W_in > 0.5 ‚Üí warn about very poor destruction.
==============================================
*/ -->
