{% extends 'base.html' %}
{% block title %}Latent Heat Gain from Infiltration Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latent Heat Gain from Infiltration Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Latent Heat Gain from Air Infiltration Calculator</h1>
    <p>
        Calculate the <strong>Total Latent Heat Gain</strong> (BTU/hr or Watts) due to airflow and humidity differences, essential for HVAC design and indoor air quality control.
    </p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="airflow">Airflow</label>
            <input type="number" id="airflow" class="form-input" min="0.1" step="any" placeholder="CFM (Imperial) or m³/s (SI)">
        </div>

        <div class="form-group">
            <label for="deltaW">Humidity Ratio Difference (ΔW)</label>
            <input type="number" id="deltaW" class="form-input" min="0.001" step="any" placeholder="e.g., 0.005">
        </div>

        <button class="calculate-btn" onclick="calculateHeatGain()">Calculate Heat Gain</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="https://cdn-icons-png.flaticon.com/512/4727/4727260.png" alt="Latent heat illustration">
            <p>This tool will calculate <strong>Total Latent Heat Gain</strong>.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Latent Heat Gain</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValueImperial">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">BTU/hr (Imperial)</div>
                <div class="rate-value" id="rateValueSI">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:16px; font-weight:bold;">Watts (SI)</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator estimates the latent heat gain caused by moisture in the incoming air due to airflow and humidity differences.
            Critical for HVAC design, indoor climate control, and fire safety (preventing condensation and mold growth in buildings).
        </p>
    </div>

    <div class="note-card">
        <h3>⚠️ Input Validations</h3>
        <ul>
            <li>✔️ Airflow: Must be a positive number. Imperial typical range: 0.1–50,000 CFM. SI typical range: 0.001–25 m³/s.</li>
            <li>✔️ Humidity Ratio Difference (ΔW): Must be positive. Typical range: 0.001–0.03 kg/kg (dimensionless ratio).</li>
            <li>❌ Non-numeric, zero, or negative inputs are invalid.</li>
            <li>⚠️ Extremely high latent heat gain (>50,000 BTU/hr or 15,000 W) triggers a warning for potential HVAC overloading.</li>
            <li>⚠️ Very low latent heat gain (<50 BTU/hr or <15 W) may indicate negligible impact or input error.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🌍 Key Applications</h3>
        <ul class="note-list">
            <li><strong>HVAC System Design:</strong> Properly size dehumidification and cooling equipment</li>
            <li><strong>Indoor Air Quality:</strong> Maintain humidity and temperature within safe ranges</li>
            <li><strong>Industrial Workspaces:</strong> Prevent condensation, mold, and safety hazards</li>
            <li><strong>Energy Efficiency:</strong> Optimize system operation by accounting for latent heat loads</li>
        </ul>
    </div>
</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateHeatGain() {
    const airflowRaw = document.getElementById("airflow").value.trim();
    const deltaWRaw = document.getElementById("deltaW").value.trim();

    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");
    const rateElImperial = document.getElementById("rateValueImperial");
    const rateElSI = document.getElementById("rateValueSI");
    const feedbackEl = document.getElementById("feedbackContent");

    errorBox.classList.add("hidden");
    errorMessage.innerHTML = "";
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    if (airflowRaw === "") errors.push("👉 Please enter the Airflow.");
    if (deltaWRaw === "") errors.push("👉 Please enter Humidity Ratio Difference (ΔW).");
    if (errors.length) return showErrors(errors);

    const airflow = parseFloat(airflowRaw);
    const deltaW = parseFloat(deltaWRaw);

    // Input validation
    if (!Number.isFinite(airflow) || airflow <= 0 || airflow > 50000) errors.push("👉 Airflow must be between 0.1–50,000 CFM (Imperial) or 0.001–25 m³/s (SI).");
    if (!Number.isFinite(deltaW) || deltaW <= 0 || deltaW > 0.03) errors.push("👉 Humidity Ratio Difference (ΔW) must be between 0.001–0.03 kg/kg.");
    if (errors.length) return showErrors(errors);

    // Latent heat calculations
    const Q_latent_Imperial = 0.7 * airflow * deltaW;
    const Q_latent_SI = 3010 * airflow * deltaW;

    // Warnings
    if (Q_latent_Imperial > 50000 || Q_latent_SI > 15000) warnings.push("⚠️ High latent heat gain – may require enhanced HVAC or dehumidification.");
    if (Q_latent_Imperial < 50 || Q_latent_SI < 15) warnings.push("⚠️ Low latent heat gain – may indicate negligible impact or input error.");

    // Assessment
    let statusMsg = "";
    if (Q_latent_Imperial <= 10000) {
        statusMsg = "✅ Latent heat gain is within a manageable range.";
    } else if (Q_latent_Imperial <= 50000) {
        statusMsg = "⚠️ Moderate latent heat gain – monitor HVAC system carefully.";
    } else {
        statusMsg = "🔴 High latent heat gain – action required to ensure indoor comfort and safety.";
    }

    // Display results
    rateElImperial.textContent = Q_latent_Imperial.toFixed(2);
    rateElSI.textContent = Q_latent_SI.toFixed(2);

    let details = `<div>Total Latent Heat Gain: <b>${Q_latent_Imperial.toFixed(2)}</b> BTU/hr (Imperial)</div>`;
    details += `<div>Total Latent Heat Gain: <b>${Q_latent_SI.toFixed(2)}</b> Watts (SI)</div>`;
    details += `<div>Airflow: <b>${airflow}</b></div>`;
    details += `<div>Humidity Ratio Difference (ΔW): <b>${deltaW}</b></div>`;
    if (warnings.length) {
        details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
    }

    feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;
    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
    errorBox.classList.add("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) {
        el.textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }
    window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /*
===========================================
Latent Heat Gain from Airflow & Humidity Calculator
===========================================

📌 Formulas:

1. Imperial units (BTU/hr):
   Q_latent_Imperial = 0.7 × Airflow × ΔW

2. SI units (Watts):
   Q_latent_SI = 3010 × Airflow × ΔW

    where:
      Airflow = volumetric airflow (CFM for Imperial, m³/s for SI)
      ΔW = Humidity Ratio Difference (kg water/kg dry air)
      Q_latent = Total latent heat gain

-------------------------------------------
✅ Input Validations:

1. Required:
   - Airflow
   - Humidity Ratio Difference (ΔW)

2. Numeric & range checks:
   - Airflow: >0 and ≤50,000 CFM (Imperial) or 0.001–25 m³/s (SI)
   - ΔW: >0 and ≤0.03 kg/kg

-------------------------------------------
⚠️ Warnings / Output Guidance:

1. High latent heat gain:
   - Q_latent_Imperial > 50,000 BTU/hr or Q_latent_SI > 15,000 W → may require enhanced HVAC or dehumidification

2. Low latent heat gain:
   - Q_latent_Imperial < 50 BTU/hr or Q_latent_SI < 15 W → negligible impact or input error

3. Classification:
   - Q_latent_Imperial ≤ 10,000 → ✅ manageable
   - 10,000 < Q_latent_Imperial ≤ 50,000 → ⚠️ moderate, monitor system
   - Q_latent_Imperial > 50,000 → 🔴 high, action required

4. Displayed outputs:
   - Total latent heat gain (Imperial BTU/hr and SI Watts)
   - Airflow
   - Humidity Ratio Difference ΔW
   - Optional warnings

===========================================
*/ -->
