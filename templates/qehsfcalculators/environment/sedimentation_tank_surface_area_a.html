{% extends 'base.html' %}
{% block title %}Sedimentation Tank Surface Area (A) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sedimentation Tank Surface Area (A) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Sedimentation Tank Surface Area (A) Calculator</h1>
        <p>Calculate the surface area required for effective sedimentation in water and wastewater treatment systems.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="tank_volume">Tank Volume (V, m³)</label>
                <input type="number" id="tank_volume" class="form-input" step="any" min="0" placeholder="e.g., 1000">
            </div>
            
            <div class="form-group">
                <label for="depth">Tank Depth (D, m)</label>
                <input type="number" id="depth" class="form-input" step="any" min="0" placeholder="e.g., 3.5">
            </div>

            <button class="calculate-btn" onclick="calculateSurfaceArea()">Calculate Surface Area</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Wastewater treatment illustration">
                <p>This tool calculates surface area for sedimentation tank design optimization.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Surface Area (A)</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="surfaceAreaValue">0.000</div>
                    <div class="rate-unit">m²</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes -->
    <div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Sedimentation Tank Surface Area (A) Calculator</strong> determines the horizontal area 
            required for effective solid settling in water and wastewater treatment systems. Proper surface area 
            is essential for achieving efficient sedimentation, ensuring adequate detention time, and maintaining 
            regulatory compliance for effluent quality.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Tank Volume (V):</strong> Total capacity of the sedimentation tank (m³).</li>
            <li><strong>Tank Depth (D):</strong> Vertical depth of the sedimentation tank (m).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li><strong>Tank Volume (V):</strong> Must be > 0 m³ (typical range: 50-10,000 m³).</li>
            <li><strong>Tank Depth (D):</strong> Must be > 0 m (typical range: 2-5 m for sedimentation tanks).</li>
            <li><strong>Depth Maximum:</strong> Should not exceed 6 m without special design considerations.</li>
            <li><strong>Realistic Ratios:</strong> V/D ratio should typically result in practical surface areas.</li>
            <li><strong>Unit Consistency:</strong> Both inputs must use consistent units (meters).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>A must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>A > 200 m²:</strong> ✅ Large surface area → Suitable for high-capacity treatment plants.</li>
            <li><strong>50 m² ≤ A ≤ 200 m²:</strong> ⚠️ Moderate surface area → Standard for municipal water treatment.</li>
            <li><strong>A < 50 m²:</strong> ❌ Small surface area → May not be sufficient for effective sedimentation.</li>
            <li><strong>A = 0:</strong> ℹ️ No surface area (theoretical case when V = 0).</li>
            <li><strong>Negative A:</strong> ❌ Impossible scenario → Both V and D must be positive.</li>
        </ul>
    </div>

<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A sedimentation tank's surface area is not governed by a single universal standard but is determined by the Surface Overflow Rate (SOR) or Surface Loading Rate, which is specific to the water or wastewater treatment application. The SOR, a key design parameter, represents the volume of water treated per unit surface area per day (e.g., L/d/m² or m³/d/m²) and is calculated as the total discharge (Q) divided by the tank's surface area (A), or:
    </p>
    <p><strong>A = Q / SOR</strong></p>

    <h3>The Standard is the Surface Overflow Rate (SOR)</h3>
    <ul class="note-list">
        <li><strong>What it is:</strong> The SOR is the volume of water that flows over the tank's surface area per day.</li>
        <li><strong>Its role:</strong> It ensures that particles with a settling velocity equal to or less than the overflow rate will settle out of the water within the tank.</li>
    </ul>

    <h3>Typical Values</h3>
    <ul class="note-list">
        <li><strong>Plain sedimentation:</strong> SOR is typically 12,000 to 18,000 L/d/m².</li>
        <li><strong>Chemically coagulated sedimentation (flocculated water):</strong> SOR values can be higher, up to 24,000 to 30,000 L/d/m².</li>
    </ul>

    <h3>Calculation</h3>
    <p>
        The required surface area is found by rearranging the formula:
    </p>
    <p><strong>A = Q / SOR</strong></p>
    <ul class="note-list">
        <li><strong>A</strong> = Surface Area (m²)</li>
        <li><strong>Q</strong> = Discharge or flow rate (L/d or m³/d)</li>
        <li><strong>SOR</strong> = Surface Overflow Rate (L/d/m² or m³/d/m²)</li>
    </ul>
</div>
<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines the <strong>surface area of sedimentation tanks</strong>, a critical parameter 
        for effective solid-liquid separation in water and wastewater treatment. Proper surface area ensures 
        adequate detention time, optimal settling efficiency, and compliance with regulatory standards. 
        The calculated area should align with typical design ranges (50-200 m² for municipal applications) 
        and be verified against site-specific requirements, flow rates, and sedimentation objectives 
        to ensure optimal treatment performance and operational efficiency.
    </p>
</div>

</div>
<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateSurfaceArea() {
    // Read values
    const V = parseFloat(document.getElementById("tank_volume").value);
    const D = parseFloat(document.getElementById("depth").value);

    const surfaceAreaValueEl = document.getElementById("surfaceAreaValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![V, D].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    if (V <= 0) errors.push("👉 Tank volume (V) must be > 0 m³.");
    if (D <= 0) errors.push("👉 Tank depth (D) must be > 0 m.");
    
    // Warning for unusual values
    if (V > 10000) warnings.push("⚠️ Tank volume unusually large (>10,000 m³).");
    if (D > 6) warnings.push("⚠️ Tank depth unusually deep (>6 m). May require special design.");
    if (D < 2) warnings.push("⚠️ Tank depth unusually shallow (<2 m). May not provide sufficient detention time.");
    if (V/D > 500) warnings.push("⚠️ V/D ratio unusually high. Check if depth is too shallow.");
    if (V/D < 10) warnings.push("⚠️ V/D ratio unusually low. Check if depth is too deep.");

    if (errors.length) return showErrors(errors);

    // Formula: A = V / D
    const A = V / D;

    if (!Number.isFinite(A)) {
        return showErrors(["⚠️ Computed surface area is invalid (possible division error)."]);
    }

    if (A < 0) {
        return showErrors(["❌ Negative surface area calculated. Both V and D must be positive."]);
    }

    // Classification
    let classification, suggestion, color;
    if (A > 200) {
        classification = "Large Surface Area";
        suggestion = "✅ Suitable for high-capacity treatment plants with significant flow rates.";
        color = "#2e7d32";
    } else if (A >= 50) {
        classification = "Moderate Surface Area";
        suggestion = "⚠️ Standard size for municipal water treatment facilities.";
        color = "#f9a825";
    } else {
        classification = "Small Surface Area";
        suggestion = "❌ May not be sufficient for effective sedimentation. Consider increasing tank volume or reducing depth.";
        color = "#c62828";
    }

    // Display result
    surfaceAreaValueEl.textContent = A.toFixed(2);
    feedbackEl.innerHTML = `
        <div>A = <b>${A.toFixed(2)}</b> m²</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Input Validations:
Tank Volume (V): Must be > 0 m³ (typical range: 50-10,000 m³)

Tank Depth (D): Must be > 0 m (typical range: 2-5 m)

Depth Maximum: Should not exceed 6 m without special design

Realistic Ratios: V/D ratio should result in practical surface areas

Unit Consistency: Both inputs must use consistent units (meters)
----------------------------------------------------------------------------------------
Output Validations:
A must be finite: NaN or Infinity indicates invalid inputs

A > 200 m²: Large surface area - suitable for high-capacity plants

50 m² ≤ A ≤ 200 m²: Moderate surface area - standard for municipal treatment

A < 50 m²: Small surface area - may not be sufficient

A = 0: No surface area (theoretical when V=0)

Negative A: Impossible scenario (error)
--------------------------------------------------------------------------------------------------
Edge Cases:
Division by Zero Prevention: D=0 is invalid (must be >0)

Extremely Small Volume: V approaching 0 produces very small surface area

Extremely Large Volume: V very large produces very large surface area

Extremely Shallow Depth: D very small produces very large surface area

Extremely Deep Depth: D very large produces very small surface area

Negative Values: V < 0 or D < 0 produce errors
-------------------------------------------------------------------------------------------------------
Formula:

A = V / D
Where:
A = Surface Area (m²)
V = Tank Volume (m³)
D = Tank Depth (m)
-->