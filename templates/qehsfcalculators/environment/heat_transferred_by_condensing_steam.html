{% extends 'base.html' %}
{% block title %}Heat transferred by condensing steam{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat transferred by condensing steam</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
  <h1>Heat transferred by condensing steam</h1>
  <p>Calculate the <strong>Quantity of Heat (Q)</strong> released when steam condenses using <strong>Q = m<sub>s</sub> √ó h<sub>fg</sub></strong>. Use consistent SI units.</p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="massSteam">Mass of Steam (m<sub>s</sub>) ‚Äî <strong>kg</strong></label>
      <input type="number" id="massSteam" class="form-input" min="0.000001" step="any" placeholder="e.g., 250">
    </div>

    <div class="form-group">
      <label for="enthalpyEvap">Specific Enthalpy of Evaporation (h<sub>fg</sub>) ‚Äî <strong>kJ/kg</strong></label>
      <input type="number" id="enthalpyEvap" class="form-input" min="0.1" step="any" placeholder="e.g., 2257">
    </div>
    
    <button class="calculate-btn" onclick="calculateCorrosionRate()">Calculate Heat (Q)</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="https://cdn-icons-png.flaticon.com/512/4727/4727260.png" alt="Steam condensation illustration">
      <p>This tool calculates heat using <strong>Q = m<sub>s</sub> √ó h<sub>fg</sub></strong> and provides QEHS-oriented guidance.</p>
    </div>
    
    <div class="result-error hidden" id="resultError">
      <div class="error-icon">‚ùå</div>
      <div class="error-message" id="errorMessage"></div>
    </div>
     
    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Calculated Heat</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="rateValue">0.00</div>
        <div class="rate-label" id="unitLabel" style="color:#2980b9; font-size:20px; font-weight:bold;">kJ</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
        <p>
        This tool estimates the total heat released when steam changes phase from vapor to liquid. 
        You only need to provide the mass of steam (in kilograms) and the specific enthalpy of evaporation (in kJ/kg). 
        The output is the total heat released, expressed in kilojoules (kJ) with convenient audit-friendly conversions such as megajoules (MJ), kilowatt-hours (kWh), and MMBtu. 
        Widely used in energy audits, boiler efficiency checks, and QEHS/fire-safety reviews.
        </p>

  </div>
  
  <div class="note-card">
    <h3>üìä Interpretation (QEHS)</h3>
    <ul class="note-list">
      <li><b>&lt; 0.1 MJ</b> ‚Üí Very low heat ‚Äî minimal thermal risk.</li>
      <li><b>0.1‚Äì100 MJ</b> ‚Üí Normal process duty ‚Äî standard precautions.</li>
      <li><b>100‚Äì1000 MJ</b> ‚Üí High heat ‚Äî assess burn protection & relief capacity.</li>
      <li><b>&ge; 1000 MJ (‚â• 1 GJ)</b> ‚Üí Very high heat ‚Äî verify controls (relief, isolation, LOTO, condensate handling).</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>‚ö†Ô∏èInput Validations</h3>
    <ul>
      <li><b>Mass (kg):</b> required, numeric, &gt; 0. Typical 0.1‚Äì1e5; acceptable 1e-6‚Äì1e7 (warn outside typical).</li>
      <li><b>h<sub>fg</sub> (kJ/kg):</b> required, numeric, &gt; 0. Typical for water/steam: <b>1800‚Äì2600</b>; acceptable 100‚Äì3500. Warn if &gt;10,000 (likely J/kg).</li>
      <li><b>Precision:</b> up to 6 decimals accepted; warn if more (rounded in report).</li>
      <li><b>Consistency:</b> Units must be kg and kJ/kg. (Common mistakes: grams for mass, J/kg for h<sub>fg</sub>.)</li>
      <li><b>Output sanity:</b> reject if Q ‚â§ 0 or Q &gt; 1e12 kJ (likely unit error).</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üåç Key Applications</h3>
    <ul class="note-list">
      <li>Boiler balance sheets & heat-recovery (economizers, feedwater preheat).</li>
      <li>Batch heating/sterilization energy planning; condensate return sizing.</li>
      <li>Environmental reporting (energy savings, fuel offset) and fire-safety risk reviews.</li>
    </ul>
  </div>
</div>

<script>
/* Show error messages (unchanged) */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Renamed inputs but kept function name to preserve wiring */
function calculateCorrosionRate() {
  const massSteamRaw = document.getElementById("massSteam")?.value.trim() ?? "";
  const hfgRaw = document.getElementById("enthalpyEvap")?.value.trim() ?? "";

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");
  const unitLabel = document.getElementById("unitLabel");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = v => Number.isFinite(v) && !Number.isNaN(v);
  const decLen = s => (s && s.includes('.')) ? s.split('.')[1].length : 0;
  const fmt = v => {
    const a = Math.abs(v);
    if (a === 0) return "0.00";
    if (a >= 1e-2 && a < 1e7) return v.toFixed(2);
    return v.toExponential(4);
  };

  // Presence
  if (massSteamRaw === "") errors.push("üëâ Enter mass of steam (kg).");
  if (hfgRaw === "") errors.push("üëâ Enter specific enthalpy of evaporation h_fg (kJ/kg).");
  if (errors.length) return showErrors(errors);

  // Parse
  const m = parseFloat(massSteamRaw);
  const hfg = parseFloat(hfgRaw);

  if (!isFiniteNum(m)) errors.push("üëâ Mass must be numeric (kg).");
  if (!isFiniteNum(hfg)) errors.push("üëâ h_fg must be numeric (kJ/kg).");
  if (errors.length) return showErrors(errors);

  // Basic > 0
  if (!(m > 0)) errors.push("üëâ Mass must be > 0 kg.");
  if (!(hfg > 0)) errors.push("üëâ h_fg must be > 0 kJ/kg.");
  if (errors.length) return showErrors(errors);

  // Practical ranges (unit traps)
  if (m < 1e-6 || m > 1e7) warnings.push("‚ö†Ô∏è Mass outside practical range (1e-6‚Äì1e7 kg) ‚Äî verify units (g‚Üîkg?).");
  if (hfg < 100 || hfg > 3500) warnings.push("‚ö†Ô∏è h_fg outside acceptable range (100‚Äì3500 kJ/kg) ‚Äî verify fluid/units.");
  if (hfg > 10000) warnings.push("‚ö†Ô∏è h_fg looks like J/kg. Convert to kJ/kg by dividing by 1000.");
  if (m > 1e5) warnings.push("‚ö†Ô∏è Very large mass ‚Äî confirm batch size vs instantaneous inventory.");

  // Typical steam latent heat band
  if (hfg < 1800 || hfg > 2600) {
    warnings.push("‚ÑπÔ∏è Typical water/steam h_fg ‚âà 1800‚Äì2600 kJ/kg depending on pressure.");
  }

  // Decimal precision
  if (decLen(massSteamRaw) > 6) warnings.push("‚ö†Ô∏è Mass has >6 decimals; results will be rounded.");
  if (decLen(hfgRaw) > 6) warnings.push("‚ö†Ô∏è h_fg has >6 decimals; results will be rounded.");

  // Compute Q = m_s * h_fg
  const Q_kJ = m * hfg;

  // Output sanity
  if (!isFiniteNum(Q_kJ) || Q_kJ <= 0) {
    return showErrors(["‚ö†Ô∏è Computed heat is invalid or non-positive. Check inputs and units."]);
  }
  if (Q_kJ > 1e12) {
    return showErrors(["‚ö†Ô∏è Q > 1√ó10¬π¬≤ kJ ‚Äî beyond practical scale. Likely unit error (J vs kJ, g vs kg)."]);
  }

  // Conversions
  const Q_MJ = Q_kJ / 1000;
  const Q_kWh = Q_MJ / 3.6;        // 1 kWh = 3.6 MJ
  const Q_MMBtu = Q_MJ / 1055.056; // 1 MMBtu ‚âà 1055.056 MJ

  // QEHS classification by energy magnitude
  let classification = "";
  let color = "#2c7a7b";
  if (Q_MJ < 0.1) {
    classification = "Very low heat ‚Äî minimal thermal risk.";
    color = "#006400";
  } else if (Q_MJ < 100) {
    classification = "Normal process duty.";
    color = "#1560bd";
  } else if (Q_MJ < 1000) {
    classification = "High heat ‚Äî assess burn protection & relief capacity.";
    color = "#b35d00";
  } else {
    classification = "Very high heat ‚Äî verify controls (relief, isolation, LOTO).";
    color = "#b00020";
  }

  // Render
  document.getElementById("unitLabel").textContent = "kJ";
  document.getElementById("rateValue").textContent = fmt(Q_kJ);

  let details = `<div><b>Q:</b> ${fmt(Q_kJ)} kJ</div>`;
  details += `<div style="margin-top:6px;"><b>Conversions:</b> ${fmt(Q_MJ)} MJ | ${fmt(Q_kWh)} kWh | ${fmt(Q_MMBtu)} MMBtu</div>`;
  details += `<div style="margin-top:6px; color:${color}; font-weight:600;">${classification}</div>`;
  details += `<div style="margin-top:6px; font-size:0.95em;">Inputs ‚Üí m<sub>s</sub>: <b>${fmt(m)}</b> kg, h<sub>fg</sub>: <b>${fmt(hfg)}</b> kJ/kg</div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = details;

  // Show result
  document.getElementById("placeholder").classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}



<!-- /**
=======================================================
 Heat transferred by condensing steam
=======================================================

 Formula:
   Q = m_s ¬∑ h_fg
   where:
     Q    = heat duty (kJ)
     m_s  = mass of steam (kg)
     h_fg = specific enthalpy of evaporation (kJ/kg)

-------------------------------------------------------
 Input Validations
-------------------------------------------------------
 ‚Ä¢ Mass of steam (m_s)
   - Must be numeric
   - Must be > 0
   - Practical: 1e‚àí6 ‚Äì 1e7 kg
   - Warn if too many decimals (>6)

 ‚Ä¢ h_fg (specific enthalpy of evaporation)
   - Must be numeric
   - Must be > 0
   - Acceptable: 100 ‚Äì 3500 kJ/kg
   - Typical: 1800 ‚Äì 2600 kJ/kg (for water/steam)
   - Warn if >10000 (likely entered in J/kg)

-------------------------------------------------------
 Output Validations
-------------------------------------------------------
 ‚Ä¢ Q (heat duty)
   - Must be positive and finite
   - Error if Q > 1e12 kJ (likely unit error)
   - Converted also to MJ, kWh, and MMBtu

-------------------------------------------------------
 QEHS Classification
-------------------------------------------------------
 ‚Ä¢ Q < 0.1 MJ ‚Üí Very low heat ‚Äî minimal thermal risk
 ‚Ä¢ 0.1‚Äì100 MJ ‚Üí Normal process duty
 ‚Ä¢ 100‚Äì1000 MJ ‚Üí High heat ‚Äî assess burn protection & relief capacity
 ‚Ä¢ > 1000 MJ ‚Üí Very high heat ‚Äî verify controls (relief, isolation, LOTO)

=======================================================
**/ -->