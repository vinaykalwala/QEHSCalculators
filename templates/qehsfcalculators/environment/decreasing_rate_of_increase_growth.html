{% extends 'base.html' %}
{% block title %}Decreasing-Rate-of-Increase Growth Calculator'{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decreasing-Rate-of-Increase Growth Calculator'</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Decreasing-Rate-of-Increase Growth Calculator</h1>
    <p>Calculate population growth with decreasing rate of increase as it approaches saturation (result shown in population units).</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="P0">Initial Population (P₀)</label>
                <input type="number" id="P0" class="form-input" step="any" min="0" placeholder="e.g., 10000" aria-label="Initial population">
            </div>

            <div class="form-group">
                <label for="S">Saturation Population (S)</label>
                <input type="number" id="S" class="form-input" step="any" min="0" placeholder="e.g., 50000" aria-label="Saturation population">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="k">Growth Rate Constant (k, 1/time)</label>
                <input type="number" id="k" class="form-input" step="any" min="0" placeholder="e.g., 0.05" aria-label="Growth rate constant">
            </div>

            <div class="form-group">
                <label for="t">Time Period (t)</label>
                <input type="number" id="t" class="form-input" step="any" min="0" placeholder="e.g., 10" aria-label="Time period">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="w">Weight Factor (w, optional)</label>
                <input type="number" id="w" class="form-input" step="any" min="0.0001" value="1" placeholder="e.g., 1" aria-label="Weight factor">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculatePopulationGrowth()">Calculate Future Population</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Population growth illustration">
            <p>This tool calculates population growth with decreasing rate of increase as it approaches saturation.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Future Population</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="futurePopulation">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">population units</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Growth Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">

    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator determines population growth with decreasing rate of increase, which models scenarios 
            where growth slows as it approaches a saturation limit. Such models are crucial for urban planning, 
            resource management, demographic studies, and forecasting long-term population dynamics. 
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>P₀ (Initial Population):</strong> The starting population value.</li>
            <li><strong>S (Saturation Population):</strong> The maximum sustainable population or carrying capacity.</li>
            <li><strong>k (Growth Rate Constant):</strong> Defines the rate of population increase (per time unit).</li>
            <li><strong>t (Time Period):</strong> The future period for which population is projected.</li>
            <li><strong>w (Weight Factor):</strong> Calibration factor (default = 1) used to adjust projections.</li>
        </ul>
    </div>

    <!-- Input Validations -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Initial Population (P₀):</strong> Must be greater than 0 and ≤ 10,000,000.</li>
            <li><strong>Saturation Population (S):</strong> Must be greater than P₀ and ≤ 100,000,000.</li>
            <li><strong>Growth Rate Constant (k):</strong> Must be > 0 and ≤ 2.0 (typical range 0.01–1.0).</li>
            <li><strong>Time Period (t):</strong> Must be ≥ 0 and ≤ 200 time units.</li>
            <li><strong>Weight Factor (w):</strong> Must be > 0 and ≤ 10.</li>
            <li><strong>Saturation Constraint:</strong> S must be greater than P₀ for meaningful growth.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>✅ Output Validations</h3>
        <ul class="note-list">
            <li>Computed population (Pₜ) must be finite, ≥ 0, and ≤ S.</li>
            <li>Warning shown if population is > 99.9% of saturation (nearly saturated condition).</li>
            <li><strong>Growth Classification with Feedback:</strong></li>
            <ul>
                <li><strong>Early Growth (&lt; 25% of saturation):</strong> ✅ Anticipate rapid expansion, plan infrastructure.</li>
                <li><strong>Mid Growth (25–75%):</strong> ⚠️ Monitor resources and safety requirements.</li>
                <li><strong>Late Growth (75–95%):</strong> ⚠️ Focus on optimization, nearing limits.</li>
                <li><strong>Near Saturation (&gt; 95%):</strong> 🏁 Minimal growth left, ensure compliance at full load.</li>
            </ul>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            A Decreasing-Rate-of-Increase growth calculator is not a specific standard but a method for population forecasting, 
            often applied in civil engineering to predict future populations by calculating the average decrease in the 
            growth rate of previous decades. It doesn't follow a universal standard but uses a defined formula to forecast 
            populations based on observed past trends of a declining rate of increase.
            <br><br>
            The principle reflects real-world demographic behavior where growth slows due to resource limitations, 
            infrastructure capacity, and carrying capacity of ecosystems. By applying this principle, planners can estimate 
            sustainable future populations while accounting for natural slowing in growth rates.
        </p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            This calculator provides a practical tool for forecasting populations under decreasing growth conditions. 
            While it offers valuable insights for planning and decision-making, it assumes constant parameters and does not 
            consider sudden changes like migration, policies, or disasters. For best results, it should be used alongside 
            updated demographic and environmental data. 
        </p>
    </div>

</div>


<script>
/* Helper: show errors consistently */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

/* Main Population Growth calculation with enhanced validations */
function calculatePopulationGrowth() {
  const P0 = parseFloat(document.getElementById("P0")?.value.trim());
  const S  = parseFloat(document.getElementById("S")?.value.trim());
  const k  = parseFloat(document.getElementById("k")?.value.trim());
  const t  = parseFloat(document.getElementById("t")?.value.trim());
  const w  = parseFloat(document.getElementById("w")?.value.trim()) || 1;

  const populationEl = document.getElementById("futurePopulation");
  const feedbackEl   = document.getElementById("feedbackContent");

  // Reset UI
  document.getElementById("resultError").classList.add("hidden");
  if (feedbackEl) feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // ✅ Required numeric checks
  if (![P0, S, k, t, w].every(Number.isFinite)) {
    showErrors(["👉 All inputs must be numeric and provided."]);
    return;
  }

  // ✅ Threshold validations
  if (P0 <= 0 || P0 > 10000000) errors.push("👉 Initial population (P₀) must be >0 and ≤10,000,000.");
  if (S <= 0 || S > 100000000) errors.push("👉 Saturation population (S) must be >0 and ≤100,000,000.");
  if (k <= 0 || k > 2.0) errors.push("👉 Growth rate constant (k) must be >0 and ≤2.0.");
  if (t < 0 || t > 200) errors.push("👉 Time period (t) must be ≥0 and ≤200.");
  if (w <= 0 || w > 10) errors.push("👉 Weight factor (w) must be >0 and ≤10.");
  if (S <= P0) errors.push("👉 Saturation population (S) must be greater than initial population (P₀).");

  if (errors.length) { showErrors(errors); return; }

  // ✅ Warning checks (plausibility ranges)
  if (P0 > 1e6) warnings.push("⚠️ Very large initial population – check units.");
  if (S > 1e7) warnings.push("⚠️ Very large saturation population – check units.");
  if (k > 1.0) warnings.push("⚠️ High growth constant – typical range is 0.01–1.0.");
  if (t > 50) warnings.push("⚠️ Long projection – model accuracy decreases.");
  if (w !== 1) warnings.push("⚠️ Non-standard weight factor – ensure proper calibration.");

  // ✅ Compute future population using decreasing-rate formula
  // Pₜ = P₀ + (S - P₀) × (1 - e^(-k × t × w))
  const exponent = -k * t * w;
  const Pt = P0 + (S - P0) * (1 - Math.exp(exponent));

  if (!Number.isFinite(Pt) || Pt < 0 || Pt > S) {
    showErrors(["⚠️ Computed population is invalid. Check input values."]);
    return;
  }

  // ✅ Growth percentage achieved
  const growthAchieved = ((Pt - P0) / (S - P0)) * 100;

  // ✅ Classification based on growth stage
  let classification, suggestion;
  if (growthAchieved < 25) {
    classification = "Early Growth";
    suggestion = "✅ Anticipate rapid expansion, plan infrastructure.";
  } else if (growthAchieved < 75) {
    classification = "Mid Growth";
    suggestion = "⚠️ Monitor resources and safety requirements.";
  } else if (growthAchieved < 95) {
    classification = "Late Growth";
    suggestion = "⚠️ Focus on optimization, nearing limits.";
  } else {
    classification = "Near Saturation";
    suggestion = "🏁 Minimal growth left, ensure compliance at full load.";
  }

  // ✅ Warning for near saturation
  if (Pt > S * 0.999) warnings.push("⚠️ Population nearly saturated – results less reliable.");

  // ✅ Build feedback
  let details = `<div>Future population = <b>${Pt.toFixed(2)}</b> units</div>`;
  details += `<div>Growth stage: <b>${classification}</b></div>`;
  details += `<div style="margin-top:6px;">${suggestion}</div>`;
  details += `<div style="margin-top:8px; font-size:14px;">Saturation progress: ${growthAchieved.toFixed(2)}%</div>`;
  details += `<div style="font-size:14px;">Growth from initial: ${((Pt - P0)/P0 * 100).toFixed(2)}%</div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  // ✅ Update UI
  populationEl.textContent = Pt.toFixed(2);
  feedbackEl.innerHTML = details;

  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

/* Safe print guard */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    el.textContent = now.toLocaleDateString('en-US', options);
  }
  window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}

<!-- 
==============================================
POPULATION GROWTH CALCULATOR - DOCUMENTATION
==============================================

📌 Formula Used (Decreasing-Rate Growth Model):
  Pₜ = P₀ + (S − P₀) × (1 − e^(−k × t × w))

  where:
    Pₜ = Future population at time t
    P₀ = Initial population
    S  = Saturation (maximum) population
    k  = Growth rate constant
    t  = Time period
    w  = Weight factor (default = 1, calibration parameter)

📌 Input Validations:
  - Initial Population (P₀):
      • Required, numeric
      • Must be > 0 and ≤ 10,000,000
      • Warning if > 1,000,000

  - Saturation Population (S):
      • Required, numeric
      • Must be > 0 and ≤ 100,000,000
      • Must be greater than P₀
      • Warning if > 10,000,000

  - Growth Rate Constant (k):
      • Required, numeric
      • Must be > 0 and ≤ 2.0
      • Warning if > 1.0 (typical range = 0.01–1.0)

  - Time Period (t):
      • Required, numeric
      • Must be ≥ 0 and ≤ 200
      • Warning if > 50 (long projections reduce accuracy)

  - Weight Factor (w):
      • Required, numeric (default = 1)
      • Must be > 0 and ≤ 10
      • Warning if ≠ 1 (non-standard calibration)

📌 Output Validations:
  - Computed Pₜ must be finite
  - Must be ≥ 0 and ≤ S
  - Warning if Pₜ > 99.9% of S (nearly saturated)

📌 Growth Stage Classification:
  - Growth < 25% of (S − P₀) → Early Growth 
        ✅ Anticipate rapid expansion, plan infrastructure
  - 25% ≤ Growth < 75% → Mid Growth 
        ⚠️ Monitor resources and safety
  - 75% ≤ Growth < 95% → Late Growth 
        ⚠️ Approaching limits, optimize resources
  - ≥ 95% → Near Saturation 
        🏁 Minimal growth left, ensure compliance at full load

-->



