{% extends 'base.html' %}
{% block title %}Boiler Efficiency Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boiler Efficiency Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


    <div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Boiler Efficiency Calculator</h1>
        <p>Calculate the <strong>Boiler Efficiency (%)</strong> to measure how effectively a boiler converts fuel energy into useful steam energy.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="form-group">
                <label for="heatExported">Heat Exported in Steam (BTU/hr)</label>
                <input type="number" id="heatExported" class="form-input" min="1" step="any" placeholder="e.g., 50000">
            </div>

            <div class="form-group">
                <label for="heatProvided">Heat Provided by Fuel (BTU/hr)</label>
                <input type="number" id="heatProvided" class="form-input" min="1" step="any" placeholder="e.g., 60000">
            </div>
            
            <button class="calculate-btn" onclick="calculateEfficiency()">Calculate Efficiency</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Boiler efficiency illustration">
                <p>This tool will calculate the <strong>Boiler Efficiency (%)</strong>.</p>
            </div>
            
            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>
             
            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Calculated Boiler Efficiency</h2>
                </div>

                <div class="rate-display">
                <div class="rate-value" id="rateValue">0.00<div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">%</div></div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">%</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
<div class="note-section">

    <!-- 1️⃣ About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Boiler Efficiency Calculator</strong> determines how effectively a boiler converts 
            <strong>fuel energy</strong> into useful <strong>steam energy</strong>, helping reduce energy waste,
            optimize fuel usage, and minimize operating costs while ensuring proper boiler performance.
        </p>
    </div>

    <!-- 2️⃣ Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Q_out (Heat Exported in Steam):</strong> Energy carried away by the steam (BTU/hr or same units).</li>
            <li><strong>Q_in (Heat Provided by Fuel):</strong> Energy supplied by the fuel (BTU/hr or same units).</li>
        </ul>
    </div>

    <!-- 3️⃣ Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <p>
            ✔️ Heat Exported in Steam must be a non-negative value.<br>
            ✔️ Heat Provided by Fuel must be positive (>0).<br>
            ❌ Zero, negative, or non-numeric values are invalid.<br>
            ⚠️ Heat Exported should not exceed Heat Provided by more than 5%; otherwise, check measurement units.<br>
            ⚠️ Extremely large or small values may indicate unit mismatches or input errors.
        </p>
    </div>

    <!-- 4️⃣ Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <p>
            ✅ Assessment/feedback is displayed along with the calculated efficiency exactly as it appears in the result:<br>
            <ul>
            <li>&nbsp;-If Boiler Efficiency &lt; 60% 🔴 Poor efficiency (High energy loss) <br></li>
            <li>&nbsp;&nbsp;-60% ≤ If Boiler  Efficiency ≤ 85% ⚠️ Moderate efficiency (Needs optimization) <br>
            <li>&nbsp;&nbsp;- If Boiler Efficiency &gt; 85% ✅ High efficiency (Good fuel utilization) <br></li>
            </ul>
            ⚠️ Warnings appear for extreme efficiencies (&lt;5% or &gt;120%) or if Heat Exported exceeds Heat Provided by >5%.
        </p>
    </div>

    <!-- 5️⃣ Governing Principle -->
    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            Boiler efficiency calculation is based on standards like the Indian Standard <strong> IS 8753 and British Standard BS 845 </strong> for industrial boilers, the American Society of Mechanical Engineers<strong> (ASME)</strong> PTC 4.1 for power station boilers, and the European <strong> EN 12952-15</strong> standard.
        </p>
    </div>


    <!-- 6️⃣ Conclusion -->
    <div class="note-card">
        <h3>📝 Conclusion</h3>
        <p>
            Proper calculation of boiler efficiency enables optimal fuel utilization, reduces energy loss, and improves overall boiler performance. 
            Using this calculator, engineers can quickly determine efficiency, evaluate heat losses, and receive immediate feedback 
            on performance classification (Poor, Moderate, High) to guide operational decisions and energy management.
        </p>
    </div>

</div>


<script>
/* Helper: show errors consistently */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

/* Helper: parse numeric tolerant (strip commas) */
function parseNumeric(id) {
  const el = document.getElementById(id);
  if (!el) return null;
  const raw = (el.value ?? "").toString().trim().replace(/,/g, "");
  if (raw === "") return null;
  const n = parseFloat(raw);
  return Number.isFinite(n) ? n : null;
}

/* Main calculation with robust validations */
function calculateEfficiency() {
  // Read inputs safely
  const heatExported = parseNumeric("heatExported"); // Q_out
  const heatProvided = parseNumeric("heatProvided"); // Q_in

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  if (errorBox) errorBox.classList.add("hidden");
  if (errorMessage) errorMessage.innerHTML = "";
  if (feedbackEl) feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required presence checks
  if (heatExported === null) errors.push("👉 Please enter Heat Exported in steam (same units as Heat Provided).");
  if (heatProvided === null) errors.push("👉 Please enter Heat Provided by fuel (same units as Heat Exported).");

  if (errors.length > 0) {
    showErrors(errors);
    return;
  }

  // Numeric & sign checks
  if (!(heatExported >= 0)) errors.push("👉 Heat Exported must be a non-negative number.");
  if (!(heatProvided > 0)) errors.push("👉 Heat Provided must be a positive number (cannot be zero).");

  if (errors.length > 0) {
    showErrors(errors);
    return;
  }

  // Tiny denominator guard
  const EPS = 1e-12;
  if (Math.abs(heatProvided) < EPS) {
    showErrors(["⚠️ Heat Provided is too small or zero — check units and input value."]);
    return;
  }

  // Logical consistency: HeatExported must not exceed HeatProvided by large margin
  const ratio = heatExported / heatProvided;
  if (ratio > 1.05) {
    showErrors(["❌ Invalid input: Heat Exported exceeds Heat Provided by more than 5% — check units and measurements."]);
    return;
  } else if (ratio > 1.0) {
    warnings.push("⚠️ Heat Exported slightly greater than Heat Provided (≤5%): possible measurement or rounding differences.");
  }

  // Reasonableness warnings for magnitudes
  if (heatProvided > 1e9 || heatExported > 1e9) warnings.push("⚠️ Very large energy values — verify units (BTU/hr vs kW etc.).");
  if (heatProvided < 1e-6) warnings.push("⚠️ Very small Heat Provided — check units.");
  // Compute efficiency
  const efficiency = (heatExported / heatProvided) * 100; // percentage
  const heatLoss = heatProvided - heatExported;
  const heatLossPercent = (heatLoss / heatProvided) * 100;

  // Post computation sanity checks
  if (!Number.isFinite(efficiency)) {
    showErrors(["⚠️ Calculation produced invalid efficiency. Check inputs."]);
    return;
  }

  if (efficiency > 120) warnings.push("⚠️ Efficiency > 120% — likely unit mismatch or measurement error.");
  if (efficiency < 5) warnings.push("⚠️ Extremely low efficiency (<5%) — verify instrumentation and energy accounting.");

  // Feedback categorization (industry-generic)
  let statusMsg = "";
  if (efficiency < 60) {
    statusMsg = "🔴 Poor efficiency (High energy loss).";
  } else if (efficiency >= 60 && efficiency <= 85) {
    statusMsg = "⚠️ Moderate efficiency (Needs optimization).";
  } else {
    statusMsg = "✅ High efficiency (Good fuel utilization).";
  }

  // Build details HTML
  let details = `<div>Efficiency: <b>${efficiency.toFixed(2)}%</b></div>`;
  details += `<div>Heat loss: <b>${heatLoss.toFixed(3)}</b> (same units as inputs)</div>`;
  details += `<div>Heat loss (%): <b>${heatLossPercent.toFixed(2)}%</b></div>`;

  if (warnings.length) details += `<div style="margin-top:6px; color:#b35d00;">Note: ${warnings.join(" | ")}</div>`;

  // Update UI
  if (rateEl) rateEl.textContent = efficiency.toFixed(2);
  if (feedbackEl) feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.remove("hidden");
  if (errorBox) errorBox.classList.add("hidden");
}

/* printReport - safe guard for print label */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    el.textContent = now.toLocaleDateString('en-IN', options);
  }
  window.print();
}
</script>


<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


<!-- /*  
========================================================
📘 BOILER EFFICIENCY CALCULATOR FORMULA & VALIDATIONS
========================================================

🔹 Formula Used:
   Efficiency (%) = ( Q_out / Q_in ) × 100
   where,
     Q_out = Heat Exported in Steam (BTU/hr or same units)
     Q_in  = Heat Provided by Fuel (BTU/hr or same units)

   Heat Loss = Q_in - Q_out  
   Heat Loss (%) = ( Heat Loss / Q_in ) × 100  

--------------------------------------------------------
🔹 Input Validations:
1. Required Checks:
   - Heat Exported must be entered.
   - Heat Provided must be entered.

2. Numeric & Sign Checks:
   - Heat Exported ≥ 0 (non-negative).
   - Heat Provided > 0 (strictly positive, cannot be zero).
   - Non-numeric entries → invalid.

3. Division Safety:
   - Guard against denominator ≈ 0 (Heat Provided very small).

4. Logical Consistency:
   - Heat Exported cannot exceed Heat Provided by large margin.
     • If Q_out > Q_in × 1.05 → ❌ Invalid (units/measurement error).
     • If Q_out > Q_in but within 5% → ⚠️ Warning (possible rounding error).

5. Range / Sanity Checks:
   - Very large values ( > 1e9 ) → ⚠️ Check units (BTU/hr vs kW etc.).
   - Very small values ( < 1e-6 ) → ⚠️ Likely unit error.
   - Efficiency > 120% → ⚠️ Likely measurement or unit mismatch.
   - Efficiency < 5% → ⚠️ Extremely low, check instrumentation.

--------------------------------------------------------
🔹 Efficiency Assessment:
   - Efficiency < 60%  → 🔴 Poor efficiency (High energy loss).
   - 60% ≤ Efficiency ≤ 85% → ⚠️ Moderate efficiency (Needs optimization).
   - Efficiency > 85%  → ✅ High efficiency (Good fuel utilization).

--------------------------------------------------------
🌍 Key Applications:
   - Power Plants → Efficiency monitoring.
   - Industrial Boilers → Reduce fuel cost, track performance.
   - Energy Audits → Compliance with energy standards.

========================================================
*/ -->
