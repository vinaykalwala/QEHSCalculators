{% extends 'base.html' %}
{% block title %}Energy Intensity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Intensity Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

<!-- ====== HEADER ====== -->
<div class="calculator-header">
  <h1>Energy Intensity Calculator</h1>
  <p>Calculate <strong>Energy Intensity (kWh per unit of production)</strong> for industrial processes.</p>
</div>

<div class="calc-content">
  <!-- ====== Calculator ====== -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="energyConsumption">Total Energy Consumption (kWh)</label>
      <input type="number" id="energyConsumption" class="form-input"
             min="0.1" step="any" placeholder="e.g., 50000">
    </div>

    <div class="form-group">
      <label for="productionOutput">Production Output (tons/units)</label>
      <input type="number" id="productionOutput" class="form-input"
             min="0.001" step="any" placeholder="e.g., 2000">
    </div>

    <button class="calculate-btn" onclick="calculateEnergyIntensity()">Calculate Energy Intensity</button>
  </div>

  <!-- ====== Result Section ====== -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Energy intensity illustration">
      <p>This tool will calculate the <strong>Energy Intensity (kWh per unit)</strong>.</p>
    </div>

    <div class="result-error hidden" id="resultError">
      <div class="error-icon">‚ùå</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:20px;">
        <h2>Calculated Energy Intensity</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="intensityValue">0.00</div>
        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;" id="intensityUnit">kWh/unit</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- ====== Notes Section ====== -->
<div class="note-section">

  <!-- About -->
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      The <strong>Energy Intensity Calculator</strong> measures the amount of energy consumed per unit of production output. 
      This metric is crucial for industrial energy management, helping identify efficiency improvements, 
      track performance over time, and benchmark against industry standards. Lower energy intensity indicates 
      more efficient production processes.
    </p>
  </div>

  <!-- Parameters -->
  <div class="note-card">
    <h3>‚öô Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Total Energy Consumption (kWh):</strong> Total energy used during the production period.</li>
      <li><strong>Production Output (tons/units):</strong> Total quantity of products manufactured.</li>
    </ul>
  </div>

  <!-- Input Validation -->
  <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul>
      <li> Energy Consumption must be ‚â• 0.1 kWh</li>
      <li> Production Output must be ‚â• 0.001 units</li>
      <li> At most 2 decimal places for both inputs</li>
      <li> Non-numeric, negative, or empty entries are invalid</li>
      <li> Energy Consumption > 1,000,000 kWh ‚Üí very high industrial consumption</li>
      <li> Production Output < 1 unit with high energy ‚Üí inefficient process</li>
    </ul>
  </div>

  <!-- Output Validation -->
  <div class="note-card">
    <h3>üìä Output Validations</h3>
    <ul>
   <li> <strong> < 10 kWh/unit</strong> ‚Üí ‚úÖ Good energy efficiency (typical for efficient processes).</li>
    <li><strong> 10‚Äì50 kWh/unit </strong>‚Üí ‚ö†Ô∏è Moderate energy efficiency‚Äîconsider process optimization opportunities.</li>
    <li><strong> > 50 kWh/unit</strong> ‚Üí üî¥ High energy intensity‚Äîsignificant efficiency improvements needed.</li>
  </div>
<div class="note-card">
  <h3>‚öñÔ∏è Governing Principle</h3>
  <p>
    The <strong>Energy Intensity Calculator</strong> operates on the <strong>Law of Conservation of Energy</strong>, 
    which states that energy cannot be created or destroyed, only transformed from one form to another. 
    In industrial systems, this principle ensures that the total energy input is either used for productive 
    work or lost as heat, vibration, or other forms of energy.
  </p>
  <ul class="note-list">
    <li><strong>ISO 50001:2018 ‚Äì Energy Management Systems:</strong> Specifies requirements for establishing, implementing, maintaining, and improving energy management systems.</li>
    <li><strong>ISO 50006:2014 ‚Äì Energy Baselines and Performance Indicators:</strong> Provides guidelines for defining and using Energy Performance Indicators (EnPIs) and energy baselines.</li>
    <li><strong>Bureau of Energy Efficiency (BEE) ‚Äì India:</strong> Recommends methods for energy efficiency monitoring and benchmarking across industrial sectors.</li>
    <li><strong>UNIDO Energy Efficiency Guidelines:</strong> Promote global best practices in industrial energy performance assessment and improvement.</li>
  </ul>
  <p>
    Adhering to these standards helps industries ensure data accuracy, improve energy efficiency,
    reduce greenhouse gas emissions, and align with sustainable development goals.
  </p>
</div>

  

  <!-- Conclusion -->
  <div class="note-card">
    <h3>üîé Conclusion</h3>
    <p>
      The Energy Intensity Calculator is an essential tool for industrial energy management, 
      providing a clear metric to evaluate production efficiency. By monitoring energy intensity 
      over time and comparing it to industry benchmarks, organizations can identify opportunities 
      for improvement, reduce operational costs, and minimize environmental impact.
    </p>
  </div>

</div>


<script>
/* ===== Helpers ===== */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

function countDecimals(numStr) {
  if (!numStr || !numStr.includes(".")) return 0;
  return numStr.split(".")[1].length;
}

/* ===== Main Calculation ===== */
function calculateEnergyIntensity() {
  const energyConsumptionRaw = document.getElementById("energyConsumption").value.trim();
  const productionOutputRaw = document.getElementById("productionOutput").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMsgEl = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultCard = document.getElementById("resultValue");
  const feedbackEl = document.getElementById("feedbackContent");
  const intensityValue = document.getElementById("intensityValue");
  const intensityUnit = document.getElementById("intensityUnit");

  // reset state
  errorBox.classList.add("hidden");
  errorMsgEl.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required fields
  if (energyConsumptionRaw === "") errors.push("üëâ Please enter Total Energy Consumption in kWh.");
  if (productionOutputRaw === "") errors.push("üëâ Please enter Production Output in tons/units.");
  if (errors.length) return showErrors(errors);

  // Decimals (max 2) and numeric checks
  if (countDecimals(energyConsumptionRaw) > 2) errors.push("üëâ Energy Consumption: max 2 decimal places.");
  if (countDecimals(productionOutputRaw) > 2) errors.push("üëâ Production Output: max 2 decimal places.");

  const energy = parseFloat(energyConsumptionRaw);
  const output = parseFloat(productionOutputRaw);

  if (!Number.isFinite(energy)) errors.push("üëâ Energy Consumption must be a valid number.");
  if (!Number.isFinite(output)) errors.push("üëâ Production Output must be a valid number.");
  if (Number.isFinite(energy) && energy < 0.1) errors.push("üëâ Energy Consumption must be ‚â• 0.1 kWh.");
  if (Number.isFinite(output) && output < 0.001) errors.push("üëâ Production Output must be ‚â• 0.001 units.");
  if (Number.isFinite(energy) && energy > 10000000) errors.push("üëâ Energy Consumption exceeds allowed limit (>10,000,000 kWh).");
  if (errors.length) return showErrors(errors);

  // Soft checks / warnings
  if (energy > 1000000) warnings.push("‚ö†Ô∏è Very high energy consumption (>1,000,000 kWh).");
  if (output < 1 && energy > 1000) warnings.push("‚ö†Ô∏è Low production with high energy consumption‚Äîinefficient process.");
  if (output > 100000) warnings.push("‚ö†Ô∏è Very high production output‚Äîverify measurement.");

  // Compute energy intensity
  const intensity = energy / output;

  if (!Number.isFinite(intensity) || intensity < 0) return showErrors(["‚ö†Ô∏è Computed energy intensity value is invalid."]);

  if (intensity > 100) warnings.push("‚ö†Ô∏è Extremely high energy intensity (>100 kWh/unit).");
  else if (intensity > 50) warnings.push("‚ö†Ô∏è Very high energy intensity (>50 kWh/unit).");
  else if (intensity < 0.01) warnings.push("‚ö†Ô∏è Extremely low energy intensity‚Äîverify measurements.");

  // Classification
  let statusMsg = "";
  if (intensity < 10) statusMsg = "‚úÖ Good energy efficiency (typical for efficient processes).";
  else if (intensity <= 50) statusMsg = "‚ö†Ô∏è Moderate energy efficiency‚Äîconsider process optimization opportunities.";
  else statusMsg = "üî¥ High energy intensity‚Äîsignificant efficiency improvements needed.";

  // Determine appropriate unit
  const unitLabel = output >= 1000 ? "kWh/1000 units" : "kWh/unit";
  const displayValue = output >= 1000 ? (intensity * 1000).toFixed(2) : intensity.toFixed(2);

  // Present results
  let details = `<div>${statusMsg}</div>`;
  if (warnings.length) details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = details;
  intensityValue.textContent = displayValue;
  intensityUnit.textContent = unitLabel;

  // Toggle display
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

/* Safe print */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}