{% extends 'base.html' %}
{% block title %}Hazardous Waste Ratio Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hazardous Waste Ratio Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

<!-- ====== HEADER ====== -->
<div class="calculator-header">
  <h1>Hazardous Waste Ratio Calculator</h1>
  <p>Calculate <strong>Hazardous Waste Ratio (%)</strong> for environmental compliance reporting.</p>
</div>

<div class="calc-content">
  <!-- ====== Calculator ====== -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="hazardousWaste">Hazardous Waste (tons)</label>
      <input type="number" id="hazardousWaste" class="form-input"
             min="0" step="0.001" placeholder="e.g., 20">
    </div>

    <div class="form-group">
      <label for="totalWaste">Total Waste Generated (tons)</label>
      <input type="number" id="totalWaste" class="form-input"
             min="0.001" step="0.001" placeholder="e.g., 200">
    </div>

    <button class="calculate-btn" onclick="calculateHazardousWasteRatio()">Calculate Hazardous Waste Ratio</button>
  </div>

  <!-- ====== Result Section ====== -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Hazardous waste illustration">
      <p>This tool will calculate the <strong>Hazardous Waste Ratio (%)</strong>.</p>
    </div>

    <div class="result-error hidden" id="resultError">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:20px;">
        <h2>Calculated Hazardous Waste Ratio</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="ratioValue">0.00</div>
        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">%</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- ====== Notes Section ====== -->
<div class="note-section">

  <!-- About -->
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      The <strong>Hazardous Waste Ratio Calculator</strong> determines the percentage of hazardous waste 
      in your total waste stream. This metric is critical for environmental compliance, waste management 
      planning, and sustainability reporting. Lower ratios indicate better waste segregation and 
      minimization of hazardous materials.
    </p>
  </div>

  <!-- Parameters -->
  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Hazardous Waste (tons):</strong> Total weight of hazardous waste as classified by RCRA/EPA standards.</li>
      <li><strong>Total Waste Generated (tons):</strong> Combined weight of all waste streams (hazardous + non-hazardous).</li>
    </ul>
  </div>

  <!-- Input Validation -->
  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul>
      <li> Hazardous Waste must be ≥ 0 tons (can be 0 if no hazardous waste)</li>
      <li> Total Waste must be ≥ 0.001 tons (minimum measurable quantity)</li>
      <li> Hazardous Waste cannot exceed Total Waste (logical consistency)</li>
      <li> At most 3 decimal places for precision in waste measurement</li>
      <li> Non-numeric or negative entries are invalid</li>
      <li> Hazardous Waste > 1000 tons → verify measurement and reporting period</li>
      <li> Total Waste > 10,000 tons → verify measurement and reporting period</li>
      <li> Ratio > 50% → high hazardous waste proportion; review waste management practices</li>
    </ul>
  </div>

  <!-- Output Validation -->
  <div class="note-card">
    <h3>📊 Output Validations</h3>
    <ul>
      <li>✅ < 5% → Excellent waste management (minimal hazardous waste proportion)</li>
      <li>  ⚠️ 5–15% → ⚠️ Moderate hazardous waste ratio—opportunities for waste minimization.</li>
      <li>🔴 > 15% → High ratio (requires immediate waste minimization actions)</li>
    </ul>
  </div>

  <!-- Governing Principle -->
  <div class="note-card">
    <h3>⚖️ Governing Principle</h3>
    <p>
      The <strong>Hazardous Waste Ratio Calculator</strong> operates on the <strong>Resource Conservation and Recovery Act (RCRA)</strong> framework, 
      which establishes the "cradle-to-grave" system for hazardous waste management in the United States. 
      This framework ensures proper identification, tracking, and disposal of hazardous materials to protect 
      human health and the environment.
    </p>
    <ul class="note-list">
      <li><strong>EPA 40 CFR Parts 260-273:</strong> Defines hazardous waste characteristics and management standards</li>
      <li><strong>OSHA 29 CFR 1910.120:</strong> Hazardous Waste Operations and Emergency Response (HAZWOPER)</li>
      <li><strong>ISO 14001:2015:</strong> Environmental Management Systems requirements</li>
      <li><strong>EU Waste Framework Directive 2008/98/EC:</strong> European hazardous waste classification</li>
    </ul>
    <p>
      Adhering to these standards ensures regulatory compliance, minimizes environmental liability, 
      and promotes sustainable waste management practices aligned with circular economy principles.
    </p>
  </div>


  <!-- Conclusion -->
  <div class="note-card">
    <h3>🔎 Conclusion</h3>
    <p>
      The Hazardous Waste Ratio Calculator is an essential tool for environmental compliance and 
      waste management optimization. By tracking this metric regularly, organizations can identify 
      trends, implement waste reduction strategies, demonstrate regulatory compliance, and reduce 
      disposal costs while minimizing environmental impact.
    </p>
  </div>

</div>


<script>
/* ===== Helpers ===== */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

function countDecimals(numStr) {
  if (!numStr || !numStr.includes(".")) return 0;
  return numStr.split(".")[1].length;
}

/* ===== Main Calculation ===== */
function calculateHazardousWasteRatio() {
  const hazardousWasteRaw = document.getElementById("hazardousWaste").value.trim();
  const totalWasteRaw = document.getElementById("totalWaste").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMsgEl = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultCard = document.getElementById("resultValue");
  const feedbackEl = document.getElementById("feedbackContent");
  const ratioValue = document.getElementById("ratioValue");

  // reset state
  errorBox.classList.add("hidden");
  errorMsgEl.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required fields
  if (hazardousWasteRaw === "") errors.push("👉 Please enter Hazardous Waste quantity in tons.");
  if (totalWasteRaw === "") errors.push("👉 Please enter Total Waste Generated in tons.");
  if (errors.length) return showErrors(errors);

  // Decimals (max 3) and numeric checks
  if (countDecimals(hazardousWasteRaw) > 3) errors.push("👉 Hazardous Waste: max 3 decimal places.");
  if (countDecimals(totalWasteRaw) > 3) errors.push("👉 Total Waste: max 3 decimal places.");

  const hazardous = parseFloat(hazardousWasteRaw);
  const total = parseFloat(totalWasteRaw);

  if (!Number.isFinite(hazardous)) errors.push("👉 Hazardous Waste must be a valid number.");
  if (!Number.isFinite(total)) errors.push("👉 Total Waste must be a valid number.");
  if (Number.isFinite(hazardous) && hazardous < 0) errors.push("👉 Hazardous Waste cannot be negative.");
  if (Number.isFinite(total) && total < 0.001) errors.push("👉 Total Waste must be ≥ 0.001 tons.");
  if (Number.isFinite(hazardous) && hazardous > 1000) errors.push("👉 Hazardous Waste exceeds typical limit (>1000 tons).");
  if (Number.isFinite(total) && total > 10000) errors.push("👉 Total Waste exceeds typical limit (>10,000 tons).");
  
  // Cross-field validation
  if (Number.isFinite(hazardous) && Number.isFinite(total) && hazardous > total) {
    errors.push("👉 Hazardous Waste cannot exceed Total Waste Generated.");
  }
  
  if (errors.length) return showErrors(errors);

  // Edge case: Division by zero (already prevented by total >= 0.001 validation)
  
  // Compute hazardous waste ratio
  const ratio = (hazardous / total) * 100;

  if (!Number.isFinite(ratio) || ratio < 0) return showErrors(["⚠️ Computed ratio value is invalid."]);

  // Soft checks / warnings
  if (hazardous > 500) warnings.push("⚠️ Very high hazardous waste quantity (>500 tons)—verify measurement.");
  if (total > 5000) warnings.push("⚠️ Very high total waste quantity (>5000 tons)—verify measurement.");
  if (ratio > 50) warnings.push("⚠️ Extremely high hazardous waste ratio (>50%)—immediate action required.");
  else if (ratio > 25) warnings.push("⚠️ High hazardous waste ratio (>25%)—regulatory scrutiny likely.");
  else if (ratio < 1) warnings.push("✅ Excellent performance—maintain current waste management practices.");

  // Classification based on industry benchmarks
  let statusMsg = "";
  if (ratio < 5) statusMsg = "✅ Excellent waste management (minimal hazardous waste proportion).";
  else if (ratio <= 15) statusMsg = "⚠️ Moderate hazardous waste ratio—opportunities for waste minimization.";
  else statusMsg = "🔴 High hazardous waste ratio—requires immediate waste minimization actions.";

  // Present results
  let details = `<div>${statusMsg}</div>`;
  if (warnings.length) details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = details;
  ratioValue.textContent = ratio.toFixed(2);

  // Toggle display
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

/* Safe print */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}