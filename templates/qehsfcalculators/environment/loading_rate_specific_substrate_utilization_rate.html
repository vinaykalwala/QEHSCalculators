{% extends 'base.html' %}
{% block title %}Loading Rate Specific Substrate Utilization Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Rate Specific Substrate Utilization Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Loading Rate Specific Substrate Utilization Rate Calculator</h1>
    <p>
        Estimate the <strong>characteristic time (days)</strong> required for microorganisms to consume
        available substrate in biological treatment systems.
    </p>

</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="Q">Sewage Inflow Rate (Q) - m³/day</label>
                <input type="number" id="Q" class="form-input" step="any" min="0.0001" placeholder="e.g., 1000">
            </div>

            <div class="form-group">
                <label for="So">Influent Substrate Concentration (S₀) - mg/L</label>
                <input type="number" id="So" class="form-input" step="any" min="0.1" placeholder="e.g., 300">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="Se">Effluent Substrate Concentration (Sₑ) - mg/L</label>
                <input type="number" id="Se" class="form-input" step="any" min="0" placeholder="e.g., 20">
            </div>

            <div class="form-group">
                <label for="V">Volume of Aeration Tank (V) - m³</label>
                <input type="number" id="V" class="form-input" step="any" min="0.01" placeholder="e.g., 500">
            </div>
        </div>

        <div class="form-group">
            <label for="X">MLSS Concentration (X) - mg/L</label>
            <input type="number" id="X" class="form-input" step="any" min="10" placeholder="e.g., 3000">
        </div>

        <button class="calculate-btn" onclick="calculateSpecificTime()">Calculate</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="substrate illustration">
            <p>This tool calculates the characteristic time (days) for substrate consumption and the specific utilization rate (day⁻¹).</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Results</h2>
            </div>

            <div class="rate-display">
                
                    <div class="rate-value">
                        <strong>Characteristic time (q_days):</strong> <span id="qDays">0.0000</span> days
                    </div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;" >
                        <strong>Specific substrate utilization (q_rate):</strong> <span id="qRate">0.0000</span> day⁻¹
                    </div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator estimates the <strong>characteristic time</strong> required for microorganisms to
            consume organic substrate in biological treatment systems, expressed in <em>days</em>.
            It also provides the reciprocal value, known as the
            <strong>specific substrate utilization rate</strong>, expressed in <em>day⁻¹</em>.
        </p>

    </div>
    <div class="note-card">
        <h3>📌 Parameters</h3>
        <ul class="note-list">
            <li><strong>Q (Sewage Inflow Rate)</strong> – m³/day: Flow of wastewater entering the aeration tank.</li>
            <li><strong>S₀ (Influent Substrate Concentration)</strong> – mg/L: Concentration of substrate in incoming sewage.</li>
            <li><strong>Sₑ (Effluent Substrate Concentration)</strong> – mg/L: Concentration of substrate in treated water leaving the tank.</li>
            <li><strong>V (Volume of Aeration Tank)</strong> – m³: Total working volume of the biological tank.</li>
            <li><strong>X (MLSS Concentration)</strong> – mg/L: Mixed liquor suspended solids, representing biomass concentration.</li>
            <li><strong>ΔS = S₀ − Sₑ</strong> – mg/L: Substrate removed in the tank; must be > 0.</li>
        </ul>
    </div>


    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li><strong>Q (m³/day):</strong> Required, numeric, &gt; 0. Typical: 0.001 – 1,000,000 m³/day. Hard limits applied: 0.0001 – 1,000,000.</li>
            <li><strong>S₀ (mg/L):</strong> Required, numeric, &gt; 0. Typical influent: 10 – 10,000 mg/L. Hard limits: 0.1 – 50,000.</li>
            <li><strong>Sₑ (mg/L):</strong> Required, numeric, ≥ 0 and strictly &lt; S₀. Typical effluent: 0 – 5000 mg/L.</li>
            <li><strong>V (m³):</strong> Required, numeric, &gt; 0. Typical: 0.01 – 1,000,000 m³. Hard limits: 0.001 – 10,000,000.</li>
            <li><strong>X (mg/L):</strong> Required, numeric, &gt; 0. Typical activated sludge: 500 – 8,000 mg/L. Hard limits: 10 – 100,000.</li>
            <li><strong>ΔS = S₀ − Sₑ:</strong> Must be ≥ 0.01 mg/L (tiny ΔS leads to numerical instability and unrealistic q_days).</li>
            <li>✔️ Recommended input precision: ≤ 3 decimals for reporting consistency.</li>
            <li>❌ Non-numeric, negative, zero where not allowed, or Sₑ ≥ S₀ → hard error.</li>
        </ul>
    </div>
    <div class="note-card">
        <h3>✅  Output Validations</h3>
        <ul class="note-list">
            <li><strong>q_days &lt; 0.1:</strong> 🔴 Very short characteristic time — very rapid consumption (check for unit errors or very active biomass).</li>
            <li><strong>0.1 ≤ q_days ≤ 2:</strong> ✅Typical: good turnover — reasonable biomass activity for many activated sludge processes.</li>
            <li><strong>2 &lt; q_days ≤ 30:</strong> ⚠️ Slow turnover — may indicate underloaded biomass or poor substrate availability.</li>
            <li><strong>q_days &gt; 30:</strong> ⚠️Very slow — likely process or data issue; investigate solids, concentration units, and sampling.</li>
            <li><strong>Displayed Outputs:</strong> Characteristic time (q_days), Specific substrate utilization rate (q_rate), Substrate removed (kg/day), Biomass in tank (kg), Input recap, Optional warnings.</li>
        </ul>
    </div>
    <div class="note-card">
    <h3>📌 Governing Principle: 
        Loading Rate Specific Substrate Utilization Rate (U)</h3>
    <p>
        A loading rate specific substrate utilization rate (U) is not tied to a single, universal standard but is a key parameter in biological process kinetics, particularly within wastewater treatment and biotechnology, and is calculated using equations based on kinetic models such as the Monod equation and the Stover-Kincannon model. These models provide the framework for defining and calculating these rates based on parameters like influent substrate concentration, effluent substrate concentration, and biomass concentration.
    </p>
    <h3>What it is:</h3>
    <p>
        The specific substrate utilization rate (U) quantifies how much organic matter microorganisms consume per unit of biomass per day. 
        It's a critical factor in designing and operating biological treatment systems, as it helps determine the efficiency of microbial processes.
    </p>
    <h3>How it's determined:</h3>
    <ul class="note-list">
        <li><strong>Kinetic Models:</strong> The calculation relies on established kinetic models, such as the Monod equation, which describes microbial growth in relation to substrate concentration, and the Stover-Kincannon model, often used for biofilm reactors.</li>
        <li><strong>Parameters:</strong> The specific utilization rate is calculated using parameters defined in these models:
            <ul class="note-list">
                <li>Influent Substrate Concentration (Sᵢ): The initial concentration of the organic matter in the wastewater or feedstock.</li>
                <li>Effluent Substrate Concentration (S): The concentration of organic matter remaining in the treated water.</li>
                <li>Biomass Concentration (X): The concentration of microorganisms (MLSS) in the system.</li>
            </ul>
        </li>
        <li><strong>Equations:</strong> The specific substrate utilization rate (U) is derived from these parameters using equations like the one found in the 2008 report from the Ministry of Housing and Urban Affairs (MoHUA), which expresses U as <code>(Sᵢ - S) / (V * X)</code>.</li>
    </ul>
</div>


<div class="note-card">
    <h3>📝 Conclusion</h3>
    <p>
        The <strong>Loading Rate Specific Substrate Utilization Rate Calculator</strong> provides a
        quick and reliable estimate of the <strong>characteristic time (q_days)</strong> for
        substrate consumption in biological treatment systems and its reciprocal, the
        <strong>specific substrate utilization rate (q_rate)</strong>.
    </p>
   </div>
</div>

<script>
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

function countDecimals(value) {
  const s = String(value);
  if (s.indexOf('.') >= 0) return s.split('.')[1].length;
  return 0;
}

function calculateSpecificTime() {
  const Qraw = (document.getElementById("Q").value || "").toString().trim();
  const S0raw = (document.getElementById("So").value || "").toString().trim();
  const Seraw = (document.getElementById("Se").value || "").toString().trim();
  const Vraw = (document.getElementById("V").value || "").toString().trim();
  const Xraw = (document.getElementById("X").value || "").toString().trim();

  const rateElDays = document.getElementById("qDays");
  const rateElRate = document.getElementById("qRate");
  const feedbackEl = document.getElementById("feedbackContent");
  document.getElementById("resultError").classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required checks
  if (!Qraw) errors.push("👉 Please enter Sewage Inflow Rate (Q) in m³/day.");
  if (!S0raw) errors.push("👉 Please enter Influent substrate concentration (S₀) in mg/L.");
  if (!Seraw) errors.push("👉 Please enter Effluent substrate concentration (Sₑ) in mg/L.");
  if (!Vraw) errors.push("👉 Please enter Tank Volume (V) in m³.");
  if (!Xraw) errors.push("👉 Please enter MLSS concentration (X) in mg/L.");
  if (errors.length) return showErrors(errors);

  // Parse
  const Q = parseFloat(Qraw);
  const S0 = parseFloat(S0raw);
  const Se = parseFloat(Seraw);
  const V = parseFloat(Vraw);
  const X = parseFloat(Xraw);

  // Basic numeric + sign checks
  if (!Number.isFinite(Q) || Q <= 0 || Q > 1e6) errors.push("👉 Q must be a positive number (m³/day). Typical range 0.0001–1,000,000.");
  if (!Number.isFinite(S0) || S0 <= 0 || S0 > 50000) errors.push("👉 S₀ must be a positive concentration (mg/L). Typical range 0.1–50,000.");
  if (!Number.isFinite(Se) || Se < 0 || Se >= S0) errors.push("👉 Sₑ must be ≥ 0 and strictly less than S₀ (mg/L).");
  if (!Number.isFinite(V) || V <= 0 || V > 1e7) errors.push("👉 V must be a positive volume (m³). Typical range 0.001–10,000,000.");
  if (!Number.isFinite(X) || X <= 0 || X > 100000) errors.push("👉 X must be a positive MLSS concentration (mg/L). Typical range 10–100,000.");
  if (errors.length) return showErrors(errors);

  // Delta S small check (numerical stability)
  const deltaS = S0 - Se;
  if (deltaS <= 0) {
    return showErrors(["👉 Delta S (S₀ − Sₑ) must be > 0."]);
  }
  if (deltaS < 0.01) {
    return showErrors([
      "⚠️ ΔS (S₀ − Sₑ) is extremely small (< 0.01 mg/L) which causes numerical instability.",
      "👉 Ensure concentrations are correct and reported in mg/L (not g/L or other units)."
    ]);
  }

  // Precision guidance
  if (countDecimals(Q) > 3 || countDecimals(S0) > 3 || countDecimals(Se) > 3 || countDecimals(V) > 3 || countDecimals(X) > 3) {
    warnings.push("⚠️ High decimal precision detected — round inputs to ≤ 3 decimals for reporting consistency.");
  }

  // Plausibility warnings
  if (Q < 0.0001) warnings.push("⚠️ Very small flow — verify units (m³/day) and measurement method.");
  if (Q > 5e5) warnings.push("⚠️ Very large flow — confirm plant-scale and units.");
  if (S0 > 20000) warnings.push("⚠️ Very high influent concentration — check units and sample source.");
  if (X < 100) warnings.push("⚠️ Low MLSS — may indicate dilute biomass or mis-sampling.");
  if (X > 20000) warnings.push("⚠️ Very high MLSS — risk of oxygen transfer and sludge handling issues.");

  // Compute q_days using requested formula
  const q_days = (V * X) / (Q * deltaS); // units: days

  if (!Number.isFinite(q_days) || q_days <= 0) {
    return showErrors(["⚠️ Computed q is invalid. Check inputs and units."]);
  }

  // Reciprocal = specific substrate utilization rate (day^-1)
  const q_rate = 1 / q_days;

  // Edge case / audit warnings based on results
  if (q_days > 365) warnings.push("⚠️ q_days > 365 days — implausible for routine treatment; check units and inputs.");
  if (q_days < 1e-4) warnings.push("⚠️ q_days extremely small — verify mass/units (possible wrong scale).");
  if (q_rate > 10) warnings.push("⚠️ q_rate > 10 day⁻¹ — unusually high uptake; verify inputs.");

  // Assessment guidance (practical)
  let statusMsg = "";
  if (q_days < 0.1) {
    statusMsg = "🔴 Very short characteristic time — very rapid consumption (check for unit errors or very active biomass).";
  } else if (q_days <= 2) {
    statusMsg = "✅ Typical: good turnover — reasonable biomass activity for many activated sludge processes.";
  } else if (q_days <= 30) {
    statusMsg = "⚠️ Slow turnover — may indicate underloaded biomass or poor substrate availability.";
  } else {
    statusMsg = "⚠️ Very slow — likely process or data issue; investigate solids, concentration units, and sampling.";
  }

  // Additional helpful derived values for audits
  // substrate removed per day (kg/day): Q [m3/day] * deltaS [mg/L]  -> kg/day = Q*(deltaS)/1000
  const substrateRemoved_kg_day = (Q * deltaS) / 1000; // kg/day
  // biomass mass on tank (kg): V [m3] * X [mg/L] -> kg = V*X/1000
  const biomass_kg = (V * X) / 1000; // kg

  // Build details
  let details = `<div>Characteristic time (q_days): <b>${q_days.toFixed(4)}</b> days</div>`;
  details += `<div>Specific substrate utilization (q_rate): <b>${q_rate.toFixed(4)}</b> day⁻¹</div>`;
  details += `<div>Substrate removed: <b>${substrateRemoved_kg_day.toFixed(4)}</b> kg/day</div>`;
  details += `<div>Biomass in tank: <b>${biomass_kg.toFixed(4)}</b> kg (approx.)</div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  // Update UI
  rateElDays.textContent = q_days.toFixed(4);
  rateElRate.textContent = q_rate.toFixed(4);
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  // Show/Hide
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>

<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /*
======================================================
Specific Substrate Utilization / Characteristic Time Calculator
======================================================

📌 Core Formula:
    q_days = (V × X) / (Q × (S₀ − Sₑ))    [days]

    where:
      Q   = Sewage inflow rate (m³/day)
      S₀  = Influent substrate concentration (mg/L)
      Sₑ  = Effluent substrate concentration (mg/L)
      V   = Tank volume (m³)
      X   = MLSS concentration (mg/L)
      ΔS  = S₀ − Sₑ (mg/L)
      q_days = Characteristic time (days)
      q_rate = 1 / q_days (day⁻¹), specific substrate utilization rate

📌 Additional Derived Values:
    - Substrate removed per day (kg/day) = (Q × ΔS) / 1000
    - Biomass mass in tank (kg) = (V × X) / 1000

------------------------------------------------------
✅ Input Validations:

1. Required inputs:
   - Q, S₀, Sₑ, V, X

2. Ranges & rules:
   - Q > 0, ≤ 1,000,000 (m³/day)
   - S₀ > 0, ≤ 50,000 (mg/L)
   - Sₑ ≥ 0 and strictly < S₀ (mg/L)
   - V > 0, ≤ 10,000,000 (m³)
   - X > 0, ≤ 100,000 (mg/L)
   - ΔS (S₀ − Sₑ) must be > 0

3. Precision guidance:
   - Warn if > 3 decimals (suggest rounding inputs)

------------------------------------------------------
⚠️ Warnings / Output Guidance:

- Very small ΔS (<0.01 mg/L) → numerical instability
- Implausible ranges:
  - Q < 0.0001 → very small flow
  - Q > 500,000 → very large flow
  - S₀ > 20,000 → unusually high influent concentration
  - X < 100 → dilute biomass
  - X > 20,000 → excessive MLSS

- Edge case results:
  - q_days > 365 → implausibly long
  - q_days < 1e-4 → extremely short (unit error likely)
  - q_rate > 10 day⁻¹ → unusually high

------------------------------------------------------
📊 Classification / Feedback:

- q_days < 0.1 → 🔴 very short, rapid consumption (possible unit errors)
- 0.1 ≤ q_days ≤ 2 → ✅ typical activated sludge turnover
- 2 < q_days ≤ 30 → ⚠️ slow, possible underloaded biomass
- q_days > 30 → ⚠️ very slow, likely process/data issue

------------------------------------------------------
📤 Displayed Outputs:
   - Characteristic time (q_days) [days]
   - Specific substrate utilization rate (q_rate) [day⁻¹]
   - Substrate removed (kg/day)
   - Biomass in tank (kg)
   - Input values recap
   - Optional warnings

======================================================
*/ -->
