{% extends 'base.html' %}
{% block title %}Sedimentation Tank Dimensions Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sedimentation Tank Dimensions Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
            color: #1560bd;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        
.result-card::-webkit-scrollbar {
    width: 8px;
}

.result-card::-webkit-scrollbar-thumb {
    background: #1560bd;
    border-radius: 6px;
}

.result-card::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.result-card {
    justify-content: flex-start; /* align from top */
    align-items: stretch;
    min-height: 420px;
    text-align: center;
    overflow-y: auto;       /* Enable vertical scrolling */
    max-height: 450px;      /* Set max height to control output size */
    padding: 20px;          /* keep spacing */
}

        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .dimension-results {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .dimension-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            min-width: 120px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        
        .dimension-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .dimension-value {
            font-size: 24px;
            font-weight: bold;
            color: #2980b9;
        }
        
        .dimension-unit {
            font-size: 14px;
            color: #6c757d;
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Sedimentation Tank Dimensions Calculator</h1>
        <p>Calculate the optimal dimensions for sedimentation tanks in water and wastewater treatment systems.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="surface_area">Surface Area (A, m²)</label>
                <input type="number" id="surface_area" class="form-input" step="any" min="0" placeholder="e.g., 500">
            </div>

            <button class="calculate-btn" onclick="calculateTankDimensions()">Calculate Dimensions</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Wastewater treatment illustration">
                <p>This tool calculates optimal sedimentation tank dimensions based on surface area.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Sedimentation Tank Dimensions</h2>
                </div>

                <div class="dimension-results">
                    <div class="dimension-box">
                        <div class="dimension-label">Width (B)</div>
                        <div class="dimension-value" id="widthValue">0.00</div>
                        <div class="dimension-unit">meters</div>
                    </div>
                    <div class="dimension-box">
                        <div class="dimension-label">Length (L)</div>
                        <div class="dimension-value" id="lengthValue">0.00</div>
                        <div class="dimension-unit">meters</div>
                    </div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes -->
    <div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Sedimentation Tank Dimensions Calculator</strong> determines the optimal length and width 
            for rectangular sedimentation tanks based on the required surface area. Using the standard design 
            practice that length (L) is typically three times the width (B), this calculator ensures proper 
            hydraulic characteristics for effective solid settling in water and wastewater treatment systems.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Surface Area (A):</strong> The horizontal area required for effective sedimentation (m²).</li>
        </ul>
    </div>


    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Surface Area (A):</strong> Must be > 0 m² (typical range: 10-5,000 m²).</li>
            <li><strong>Realistic Values:</strong> Very small areas (&lt;1 m²) may indicate input error.</li>
            <li><strong>Extreme Values:</strong> Areas > 10,000 m² may require special design considerations.</li>
            <li><strong>Unit Consistency:</strong> Input must be in square meters (m²).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Dimensions must be finite:</strong> NaN or Infinity indicates invalid inputs.</li>
            <li><strong>L > 50m or B > 20m:</strong> ✅ Large tank → Suitable for high-capacity treatment plants with significant flow rates.</li>
            <li><strong>15m ≤ L ≤ 50m and 5m ≤ B ≤ 20m:</strong> ⚠️ Moderate tank → Standard size for municipal water treatment.</li>
            <li><strong>L < 15m or B < 5m:</strong> ❌ Small tank → May not be sufficient for effective sedimentation.</li>
            <li><strong>Negative Dimensions:</strong> ❌ Impossible scenario → Surface area must be positive.</li>
            <li><strong>L:B Ratio:</strong> Should be exactly 3:1 as per design standard.</li>
        </ul>
    </div>

    <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A sedimentation tank dimensions calculator is not based on one universal standard, but rather on various engineering guidelines and design criteria that vary depending on factors like the type of water treatment, desired overflow rate, detention time, and flow conditions. Design parameters like the length-to-width ratio (often around 4:1), recommended overflow rates (e.g., 12,000–18,000 L/d/m²), and minimum depths are used to calculate dimensions.
    </p>

    <h3>Key Factors and Standards</h3>
    <ul class="note-list">
        <li><strong>Overflow Rate:</strong> A crucial criterion, indicating the volume of water that can be processed per unit of surface area per day. For plain sedimentation, 12,000 to 18,000 L/d/m² (or gallons/day/ft²) is common.</li>
        <li><strong>Detention Time:</strong> The period water remains in the tank, typically ranging from 4 to 8 hours, influencing overall tank size.</li>
        <li><strong>Flow-Through Velocity:</strong> The horizontal speed of water moving through the tank should be kept low, generally below 0.5 ft/min (0.3 m/min), to allow adequate settling.</li>
        <li><strong>Length-to-Width Ratio:</strong> For rectangular tanks, a ratio of at least 4:1 is a common design guideline.</li>
        <li><strong>Depth:</strong> The depth often ranges from 7 to 16 ft (2.15 to 4.5 m), depending on whether sludge removal is mechanical or manual.</li>
        <li><strong>Sludge Removal:</strong> Design may include a sloped bottom toward a sludge hopper or mechanical scrapers, which affect depth and geometry.</li>
        <li><strong>Baffles:</strong> Influent baffles are often incorporated to reduce momentum of incoming flow and improve settling efficiency.</li>
    </ul>
</div>

<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines <strong>optimal sedimentation tank dimensions</strong> based on required surface area, 
        following the standard design practice of a 3:1 length-to-width ratio. Proper dimensioning ensures 
        effective hydraulic flow patterns, optimal settling efficiency, and compliance with engineering 
        design standards. The calculated dimensions should be verified against site-specific requirements, 
        flow characteristics, and sedimentation objectives to ensure optimal treatment performance 
        and operational reliability in water and wastewater treatment systems.
    </p>
</div>
</div>
<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateTankDimensions() {
    // Read values
    const A = parseFloat(document.getElementById("surface_area").value);

    const widthValueEl = document.getElementById("widthValue");
    const lengthValueEl = document.getElementById("lengthValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (!Number.isFinite(A)) {
        return showErrors(["👉 Please enter surface area value (numeric)."]);
    }
    
    if (A <= 0) errors.push("👉 Surface area (A) must be > 0 m².");
    if (A > 10000) warnings.push("⚠️ Surface area unusually large (>10,000 m²). May require special design.");
    if (A < 1) warnings.push("⚠️ Surface area unusually small (<1 m²). Check input value.");

    if (errors.length) return showErrors(errors);

    // Formulas: B = √(A / 3), L = 3 × B
    const B = Math.sqrt(A / 3);
    const L = 3 * B;

    if (!Number.isFinite(B) || !Number.isFinite(L)) {
        return showErrors(["⚠️ Computed dimensions are invalid (possible calculation error)."]);
    }

    if (B < 0 || L < 0) {
        return showErrors(["❌ Negative dimensions calculated. Surface area must be positive."]);
    }

    // Classification
    let classification, suggestion, color;
    if (L > 50 || B > 20) {
        classification = "Large Tank";
        suggestion = "✅ Suitable for high-capacity treatment plants with significant flow rates.";
        color = "#2e7d32";
    } else if (L >= 15 && B >= 5) {
        classification = "Moderate Tank";
        suggestion = "⚠️ Standard size for municipal water treatment facilities.";
        color = "#f9a825";
    } else {
        classification = "Small Tank";
        suggestion = "❌ May not be sufficient for effective sedimentation. Consider increasing surface area.";
        color = "#c62828";
    }

    // Check L:B ratio
    const ratio = (L / B).toFixed(2);
    if (Math.abs(ratio - 3) > 0.01) {
        warnings.push(`⚠️ L:B ratio is ${ratio}:1 (should be 3:1).`);
    }

    // Display result
    widthValueEl.textContent = B.toFixed(2);
    lengthValueEl.textContent = L.toFixed(2);
    feedbackEl.innerHTML = `
        <div>Width (B) = <b>${B.toFixed(2)}</b> m</div>
        <div>Length (L) = <b>${L.toFixed(2)}</b> m</div>
        <div>L:B Ratio = <b>${ratio}:1</b></div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Input Validations:
Surface Area (A): Must be > 0 m² (typical range: 10-5,000 m²)

Realistic Values: Very small areas (<1 m²) may indicate input error

Extreme Values: Areas > 10,000 m² may require special design considerations

Unit Consistency: Input must be in square meters (m²)
------------------------------------------------------------------------------------------
Output Validations:
Dimensions must be finite: NaN or Infinity indicates invalid inputs

L > 50m or B > 20m: Large tank - suitable for high-capacity plants

15m ≤ L ≤ 50m and 5m ≤ B ≤ 20m: Moderate tank - standard for municipal treatment

L < 15m or B < 5m: Small tank - may not be sufficient for effective sedimentation

Negative Dimensions: Impossible scenario (error)

L:B Ratio: Should be exactly 3:1 as per design standard
-------------------------------------------------------------------------------
Edge Cases:
Division by Zero Prevention: A=0 is invalid (must be >0)

Extremely Small Areas: A approaching 0 produces very small dimensions

Extremely Large Areas: A very large produces very large dimensions

Negative Areas: A < 0 produces error

Non-numeric Input: Text or special characters produce error
------------------------------------------------------------------------------------
Formula:
B = √(A / 3)
L = 3 × B
Where:
A = Surface Area (m²)
B = Width (m)
L = Length (m)
L:B Ratio = 3:1 (Standard design practice)
-->