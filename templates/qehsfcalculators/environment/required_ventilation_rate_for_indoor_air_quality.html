{% extends 'base.html' %}
{% block title %}Required Ventilation Rate Calculator For Indoor Air Quality{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Required Ventilation Rate Calculator For Indoor Air Quality</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Required Ventilation Rate Calculator For Indoor Air Quality</h1>
    <p>Estimate the fresh air supply needed to maintain indoor air quality based on occupant count and per-person ventilation rate.</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="occupants">Number of Occupants (N)</label>
            <input type="number" id="occupants" class="form-input" min="1" step="any" placeholder="e.g., 25">
        </div>

        <div class="form-group">
            <label for="ventilationRate">Ventilation Rate per Person (R) [L/s per person]</label>
            <input type="number" id="ventilationRate" class="form-input" min="0.1" step="any" placeholder="e.g., 10">
            <small style="display:block; color:#fff; margin-top:4px;">Typical ranges: offices ~10‚Äì15, industrial ~20‚Äì30, labs ~30‚Äì50 (L/s per person).</small>
        </div>

        <button class="calculate-btn" onclick="calculateVentilationRate()">Calculate Required Ventilation Rate</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Ventilation illustration">
            <p>This tool will calculate the total required ventilation flow for indoor air quality (displayed in L/s and m¬≥/h).</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">‚ùå</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Required Ventilation</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:18px; font-weight:bold;">L/s</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>
            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes -->
<!-- Notes Section -->
<div class="note-section">

    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            This tool estimates the total fresh air supply needed to maintain indoor air quality based on the number of occupants and the per-person ventilation rate.
            Results are displayed in liters per second (L/s) and cubic metres per hour (m¬≥/h) for practical HVAC design and QEHS review.
        </p>
    </div>

  <div class="note-card">
    <h3>‚öô Parameters Used</h3>
    <ul class="note-list">
      <li><strong>N:</strong> Number of occupants.</li>
      <li><strong>R (L/s per person):</strong> Per-person ventilation rate.</li>
      <li><strong>Total Ventilation Rate:</strong> Calculated in L/s and m¬≥/h.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>N:</strong> Required, numeric, ‚â• 1; decimals rounded to nearest whole number; > 100,000 triggers warning.</li>
      <li><strong>R (L/s per person):</strong> Required, numeric, ‚â• 0.1; typical: 5‚Äì50; extreme values (< 0.1 or > 100) trigger warnings.</li>
      <li><strong>Constraints:</strong> Both inputs must be finite numbers; non-numeric or negative values invalid.</li>
      <li><strong>Advisories:</strong> Warnings for very large occupant counts or extreme ventilation rates to check for unit/data-entry errors.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üìè Output Validations</h3>
    <ul class="note-list">
      <li><strong>Total Ventilation Rate:</strong> Displayed in L/s (2 decimals) and m¬≥/h (2 decimals).</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>R ‚â• 30: High per-person ventilation ‚Äî Suitable for laboratories or high-risk spaces.</li>
          <li>R 20‚Äì30: Above-typical ventilation ‚Äî Industrial / heavy processes.</li>
          <li>R 10‚Äì20: Typical ventilation for offices / general areas.</li>
          <li>R 6‚Äì10: Low-moderate ventilation ‚Äî May be acceptable with additional controls.</li>
          <li>R < 6: Low ventilation ‚Äî Likely insufficient for offices; review IAQ requirements.</li>
        </ul>
      </li>
      <li>Warnings triggered for extreme total ventilation (> 100,000 L/s or > 360,000 m¬≥/h) to check system feasibility.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üìñ Governing Principle</h3>
    <p>
      A Required Ventilation Rate Calculator for Indoor Air Quality is based on the ASHRAE Standard 62.1 (Ventilation for Acceptable Indoor Air Quality), which sets the minimum ventilation rates and methods for achieving acceptable IAQ in non-residential buildings, or ASHRAE Standard 62.2, which applies to residential buildings. These standards specify procedures for calculating ventilation airflow to minimize health effects from contaminants.
    </p>
    <p><b>Key Standards</b></p>
    <p><b>ANSI/ASHRAE Standard 62.1:</b> This standard applies to non-residential buildings and provides procedures for designers and engineers to determine the required ventilation rates to maintain acceptable indoor air quality.</p>
    <p><b>ANSI/ASHRAE Standard 62.2:</b> This standard is for residential buildings, specifying the required whole-building ventilation airflow rates to meet IAQ requirements.</p>
    <p><b>Purpose of These Standards</b></p>
    <p><b>Define Minimum Rates:</b> The standards establish minimum ventilation rates for various spaces and activities to ensure adequate fresh air.</p>
    <p><b>Health and Comfort:</b> The goal is to control contaminants and minimize adverse health effects for occupants.</p>
    <p><b>Design Procedures:</b> They provide calculation methods, including the Ventilation Rate Procedure and Indoor Air Quality Procedure, for calculating outdoor air requirements.</p>
  </div>

    <div class="note-card">
        <h3>üìå Conclusion</h3>
        <p>
            Recommended references include ASHRAE Standard 62.1, ISO 16890 for indoor air quality assessment, and internal plant SOPs for HVAC design, airflow distribution, and safety audits. 
            Following these standards ensures the ventilation system delivers sufficient fresh air to maintain IAQ, occupant health, and energy efficiency.
        </p>
    </div>

</div>



<script>
/* Show error messages */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Main calculation & validations */
function calculateVentilationRate() {
  const occRaw = document.getElementById("occupants").value.trim();
  const rateRaw = document.getElementById("ventilationRate").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required fields
  if (occRaw === "") errors.push("üëâ Please enter the number of occupants.");
  if (rateRaw === "") errors.push("üëâ Please enter the ventilation rate per person (L/s).");
  if (errors.length) return showErrors(errors);

  // Parse inputs
  const occupants = parseFloat(occRaw);
  const perPersonRate = parseFloat(rateRaw);

  // Numeric checks
  if (!Number.isFinite(occupants) || occupants <= 0) errors.push("üëâ Number of occupants must be a positive number (‚â• 1).");
  if (!Number.isFinite(perPersonRate) || perPersonRate <= 0) errors.push("üëâ Ventilation rate per person must be a positive number (‚â• 0.1 L/s).");
  if (errors.length) return showErrors(errors);

  // Reasonable ranges & warnings
  if (occupants < 1) errors.push("üëâ Occupant count must be at least 1.");
  if (occupants > 100000) warnings.push("‚ö†Ô∏è Very large occupant count ‚Äî verify this is not a units or data-entry error.");
  if (!Number.isInteger(occupants)) warnings.push("‚ö†Ô∏è Occupant value is not a whole number ‚Äî it will be rounded to the nearest person for calculations.");

  if (perPersonRate < 0.1) warnings.push("‚ö†Ô∏è Per-person ventilation < 0.1 L/s ‚Äî extremely low; verify units.");
  if (perPersonRate > 100) warnings.push("‚ö†Ô∏è Per-person ventilation > 100 L/s ‚Äî unusually high; verify units or special environment.");

  // Stop if definite errors
  if (errors.length) return showErrors(errors);

  // Round occupants to nearest whole number
  const occupantsRounded = Math.round(occupants);

  // Compute total ventilation (L/s and m¬≥/h)
  const totalLps = occupantsRounded * perPersonRate;
  const totalM3h = totalLps * 3.6; // 1 L/s = 3.6 m¬≥/h

  // Total ventilation warnings
  if (totalLps > 100000) warnings.push("‚ö†Ô∏è Total ventilation extremely large ‚Äî consider staged ventilation or multiple AHUs.");
  if (totalM3h > 360000) warnings.push("‚ö†Ô∏è Total volumetric flow extremely large ‚Äî check ductwork and fan capacity.");

  // Classification feedback (matches notes wording)
  let classification = "";
  if (perPersonRate >= 30) classification = "R(Per-person ventilation rate) ‚â• 30 ‚Üí High per-person ventilation ‚Äî suitable for labs or critical spaces.";
  else if (perPersonRate >= 20) classification = "R(Per-person ventilation rate) 20‚Äì30 ‚Üí Above-typical ventilation ‚Äî industrial / heavy processes.";
  else if (perPersonRate >= 10) classification = "R(Per-person ventilation rate) 10‚Äì20 ‚Üí Typical ventilation for offices / general areas.";
  else if (perPersonRate >= 6) classification = "R(Per-person ventilation rate) 6‚Äì10 ‚Üí Low-moderate ventilation ‚Äî may be acceptable with additional controls.";
  else classification = "R(Per-person ventilation rate) < 6 ‚Üí Low ventilation ‚Äî likely insufficient for offices; review IAQ requirements.";

  // Prepare feedback details
  let details = `<div><strong>Total ventilation (L/s):</strong> ${totalLps.toFixed(2)}</div>`;
  details += `<div><strong>Total ventilation (m¬≥/h):</strong> ${totalM3h.toFixed(2)}</div>`;
  details += `<div style="margin-top:8px; color:green;"><strong>Assessment:</strong> ${classification}</div>`;

  // Display warnings in red/orange
  if (warnings.length) details += `<div style="margin-top:8px; color:orange;"><strong>Warnings:</strong> ${warnings.join(" | ")}</div>`;

  // Display results
  rateEl.textContent = totalLps.toFixed(2);
  feedbackEl.innerHTML = details;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

/* Print helper */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 
üìå Ventilation Rate Calculator (Essentials)

üîπ Formula:
    ‚Ä¢ Total ventilation (L/s) = Number of occupants √ó Per-person ventilation rate
    ‚Ä¢ Total ventilation (m¬≥/h) = Total ventilation (L/s) √ó 3.6

üîπ Input Validations:
    ‚Ä¢ Occupants:
        - Must be numeric
        - ‚â• 1
        - If not integer ‚Üí rounded to nearest whole number
        - > 100,000 ‚Üí warning (unrealistic large)
    ‚Ä¢ Per-person ventilation rate (L/s per person):
        - Must be numeric
        - ‚â• 0.1
        - > 100 ‚Üí warning (too high)
        - < 0.1 ‚Üí warning (too low)

üîπ Output Validations:
    ‚Ä¢ Total ventilation (L/s):
        - > 100,000 ‚Üí warning (system too large)
    ‚Ä¢ Total ventilation (m¬≥/h):
        - > 360,000 ‚Üí warning (ductwork/fan capacity issue)

-->
