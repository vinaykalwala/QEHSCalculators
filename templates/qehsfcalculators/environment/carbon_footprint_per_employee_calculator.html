{% extends 'base.html' %}
{% block title %}Carbon Footprint per Employee Calculator{% endblock %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Footprint per Employee Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            transform: scale(1.05);
        }

        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            overflow-y: auto;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder {
            width: 100%;
        }

        .result-placeholder img {
            max-width: 280px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
            margin-top: 20px;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
            line-height: 1.6;
        }

        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 36px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .error-message {
            font-size: 16px;
            line-height: 1.6;
        }

        .hidden { 
            display: none; 
        }

        .note-section {
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }

        .formula-display {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .formula-display h3 {
            color: #0d47a1;
            margin-bottom: 15px;
        }

        .formula {
            font-size: 18px;
            color: #0d47a1;
            font-weight: 600;
            margin: 10px 0;
        }

        .formula-note {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

    <div class="calculator-container" id="printArea">
        <div class="calculator-header">
            <h1>Carbon Footprint per Employee Calculator</h1>
            <p>Measure emissions intensity per employee to assess organizational environmental impact.</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>

                <div class="form-group">
                    <label for="totalEmissions">Total CO₂ Emissions (kg)</label>
                    <input type="number" id="totalEmissions" class="form-input" step="any" min="0" placeholder="e.g., 50000" aria-label="Total CO₂ emissions in kg">
                </div>

                <div class="form-group">
                    <label for="totalEmployees">Total Employees</label>
                    <input type="number" id="totalEmployees" class="form-input" step="1" min="1" placeholder="e.g., 250" aria-label="Total number of employees">
                </div>

                <button class="calculate-btn" onclick="calculateFootprint()">Calculate CO₂ per Employee</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <svg width="280" height="200" viewBox="0 0 280 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="140" cy="100" r="80" fill="#e3f2fd" opacity="0.5"/>
                        <path d="M140 40 L140 160 M80 100 L200 100" stroke="#1560bd" stroke-width="4" stroke-linecap="round"/>
                        <circle cx="140" cy="100" r="12" fill="#1560bd"/>
                        <path d="M100 70 Q140 50 180 70" stroke="#2e7d32" stroke-width="3" fill="none"/>
                        <path d="M90 130 Q140 150 190 130" stroke="#2e7d32" stroke-width="3" fill="none"/>
                        <text x="140" y="190" text-anchor="middle" fill="#1560bd" font-size="16" font-weight="600">CO₂ / Employee</text>
                    </svg>
                    <p>Calculate the carbon footprint per employee to understand your organization's emissions intensity.</p>
                </div>

                <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>

                <div class="result-value hidden" id="resultValue" aria-live="polite">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>CO₂ per Employee</h2>
                    </div>

                    <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                        <div class="rate-value" id="footprintResult">0.00</div>
                        <div class="rate-label" style="font-size:16px; color: #2980b9;">kg/employee</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Assessment & Suggestions</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>

                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <div class="note-card">
                <h3>📘 About</h3>
                <p>
                    This calculator measures carbon footprint per employee, a key metric for understanding organizational 
                    emissions intensity. It helps businesses benchmark environmental performance, set reduction targets, 
                    and track progress over time. Lower values indicate better per-capita environmental efficiency.
                </p>
            </div>

            <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>Total CO₂ Emissions</strong>: Measured in kilograms (kg). Represents total carbon dioxide emissions from organizational activities.</li>
                    <li><strong>Total Employees</strong>: Number of employees in the organization (headcount).</li>
                    <li><strong>CO₂ per Employee</strong>: Result in kg/employee. Indicates emissions intensity per person.</li>
                    <li><em>Note: Include all Scope 1, 2, and relevant Scope 3 emissions for comprehensive assessment.</em></li>
                </ul>
            </div>

            <div class="note-card">
                <h3>✅ Input Validation Rules</h3>
                <ul class="note-list">
                    <li>Both CO₂ emissions and employee count are required and must be numeric.</li>
                    <li>CO₂ emissions must be ≥ 0 kg (cannot be negative).</li>
                    <li>Employee count must be ≥ 1 (at least one employee required).</li>
                    <li>Emissions above 100,000,000 kg (100,000 tons) trigger a warning to verify units.</li>
                    <li>Employee count above 1,000,000 triggers a verification prompt.</li>
                    <li>Result above 100,000 kg/employee is flagged as potentially incorrect.</li>
                </ul>
            </div>

            <div class="note-card">
                <h3>🔎 Output Classifications</h3>
                <ul class="note-list">
                    <li><strong>Excellent (&lt; 1,000 kg/employee):</strong> Low emissions intensity. Strong environmental performance.</li>
                    <li><strong>Good (1,000 - 5,000 kg/employee):</strong> Moderate emissions. Room for improvement.</li>
                    <li><strong>Average (5,000 - 10,000 kg/employee):</strong> Industry typical. Consider reduction initiatives.</li>
                    <li><strong>High (&gt; 10,000 kg/employee):</strong> Elevated emissions intensity. Prioritize sustainability programs.</li>
                    <li><em>Classifications vary by industry sector and should be compared with industry benchmarks.</em></li>
                </ul>
            </div>

            <div class="note-card">
                <h3>📏 Governing Standards</h3>
                <p>
                    This calculator aligns with widely recognized frameworks including the <strong>GHG Protocol</strong> 
                    for corporate emissions accounting, <strong>ISO 14064</strong> series for organizational greenhouse gas 
                    quantification, and <strong>ISO 14067</strong> for carbon footprint of products. It helps organizations 
                    comply with reporting requirements and sustainability goals.
                </p>
            </div>

            <div class="note-card">
                <h3>🔚 Conclusion</h3>
                <p>
                    CO₂ per employee is a valuable metric for tracking organizational environmental performance and 
                    comparing against industry peers. While useful for benchmarking, it should be considered alongside 
                    absolute emissions, revenue intensity, and other sustainability indicators. Regular monitoring helps 
                    identify trends and measure the effectiveness of emissions reduction initiatives.
                </p>
            </div>
        </div>
    </div>

    <script>
        function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
    if (errorBox) errorBox.classList.remove("hidden");
    if (placeholder) placeholder.classList.add("hidden");
    if (resultValue) resultValue.classList.add("hidden");
}

function calculateFootprint() {
    const emissionsRaw = document.getElementById("totalEmissions")?.value.trim() ?? "";
    const employeesRaw = document.getElementById("totalEmployees")?.value.trim() ?? "";

    const resultEl = document.getElementById("footprintResult");
    const feedbackEl = document.getElementById("feedbackContent");

    // Reset previous messages
    document.getElementById("resultError").classList.add("hidden");
    if (feedbackEl) feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Required field validation
    if (!emissionsRaw) errors.push("👉 Enter total CO₂ emissions in kg.");
    if (!employeesRaw) errors.push("👉 Enter total number of employees.");
    if (errors.length > 0) { showErrors(errors); return; }

    const emissions = parseFloat(emissionsRaw);
    const employees = parseFloat(employeesRaw);

    // Numeric & logical validations
    if (!Number.isFinite(emissions) || emissions < 0) {
        errors.push("👉 CO₂ emissions must be a non-negative finite number (kg).");
    }
    if (!Number.isFinite(employees) || employees < 1) {
        errors.push("👉 Employee count must be at least 1.");
    }
    if (!Number.isInteger(employees)) {
        warnings.push("⚠️ Employee count should be a whole number.");
    }
    if (errors.length > 0) { showErrors(errors); return; }

    // High-value warnings
    if (emissions > 100000000) warnings.push("⚠️ CO₂ emissions value seems unusually high (>100,000 tons) - verify units.");
    if (employees > 1000000) warnings.push("⚠️ Employee count seems unusually high (>1,000,000) - verify input.");

    // Compute CO₂ per employee
    const footprintPerEmployee = emissions / employees;

    if (!Number.isFinite(footprintPerEmployee) || footprintPerEmployee < 0) {
        showErrors(["⚠️ Computed result is invalid. Check input values."]);
        return;
    }
    if (footprintPerEmployee > 100000) {
        warnings.push("⚠️ Extremely high carbon footprint per employee (>100,000 kg) - likely input error.");
    }

    // Classification
    let classification = "";
    let suggestion = "";
    if (footprintPerEmployee < 1000) {
        classification = "Excellent Performance";
        suggestion = "✅ Outstanding environmental efficiency with very low emissions per employee.";
    } else if (footprintPerEmployee < 5000) {
        classification = "Good Performance";
        suggestion = "✅ Solid environmental performance. Continue monitoring and optimization efforts.";
    } else if (footprintPerEmployee < 10000) {
        classification = "Average Performance";
        suggestion = "⚠️ Industry typical emissions. Consider implementing reduction initiatives.";
    } else {
        classification = "High Emissions";
        suggestion = "❌ Elevated emissions intensity. Prioritize sustainability programs and reduction strategies.";
    }

    // Display details
    let details = `<div>Carbon footprint = <b>${footprintPerEmployee.toFixed(2)}</b> kg CO₂/employee</div>`;
    details += `<div>Classification: <b>${classification}</b></div>`;
    details += `<div style="margin-top:6px;">${suggestion}</div>`;
    if (warnings.length) {
        details += `<div style="margin-top:8px; color:#b35d00;">Note: ${warnings.join(" | ")}</div>`;
    }

    if (resultEl) resultEl.textContent = footprintPerEmployee.toFixed(2);
    if (feedbackEl) feedbackEl.innerHTML = details;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
    document.getElementById("resultError").classList.add("hidden");
}
       
function printReport() {
    window.print();
}
    </script>
</body>
</html>

{% endblock %}
<!-- 
1️⃣ Detailed Input Validation Rules (QEHS-Compliant)
Input Field	Type & Units	Acceptable Range	Decimals	Logical Rules / Cross-Field Checks	Compliance Justification
Total CO₂ Emissions	kg (Scope 1+2+3)	0 – 100,000,000 kg (100,000 tons)	Up to 2 decimals	Must be numeric and non-negative; extremely high values trigger a warning	Avoid reporting errors, ensures proper unit usage, aligns with ISO 14064.
Total Employees	Count (headcount)	1 – 1,000,000	Must be integer (decimals not meaningful)	Must be numeric and ≥1; warn if unusually high (>1M); cross-check if emissions per employee > 100,000 kg	Ensures meaningful per-employee metrics and avoids division by zero.
Cross-Field	–	–	–	CO₂ per employee = Total CO₂ ÷ Employees; if result >100,000 kg/employee → flag	Prevents unrealistic reporting, ensures KPI is credible.

Notes:

Inputs should never be negative, as CO₂ emissions and employees cannot be negative.

Large numbers may indicate unit misentry (e.g., tons entered as kg).

Decimals are allowed for CO₂ (kg precision), but employee count must be integer.

2️⃣ Output Validation Logic & Thresholds

Computed Metric: CO₂ per Employee = Total Emissions ÷ Total Employees

Threshold Classifications:

KPI (kg/employee)	Classification	Feedback
< 1,000	Excellent	Very low emissions; outstanding environmental efficiency
1,000 – 4,999	Good	Moderate emissions; continue monitoring
5,000 – 9,999	Average	Typical industry emissions; consider reduction initiatives
≥ 10,000	High	Elevated emissions; implement mitigation programs
>100,000	Error / Flag	Likely input error; verify emissions/employee data

Validation Considerations:

Check division by zero: Employee count ≥1.

Check result realism: Values >100,000 kg/employee are extremely rare in any organization.

3️⃣ Edge Case Validations
Case	Handling
Employees = 0	Reject input; show error “Employee count must be ≥1”
CO₂ = 0	Acceptable; result = 0 kg/employee (green KPI)
Extremely high CO₂ (>100,000 tons)	Warning: “Verify units; unusually high emissions”
Employees >1,000,000	Warning: “Verify employee count; unusually high”
Non-integer employee values	Warning: “Employee count should be a whole number”
Negative values	Reject with error
Empty fields	Reject with error
Non-numeric input	Reject with error
-->