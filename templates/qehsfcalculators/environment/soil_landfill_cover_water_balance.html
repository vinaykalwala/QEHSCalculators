{% extends 'base.html' %}
{% block title %}Soil Landfill Cover Water Balance Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soil Landfill Cover Water Balance Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
/* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex; 
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto; 
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        {% comment %} /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        } {% endcomment %}

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Soil Landfill Cover Water Balance Calculator</h1>
        <p>Calculate the change in water storage (ΔSLC) for landfill cover management and environmental compliance.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>
             <div class="input-row">
            <div class="form-group">
                <label for="precipitation">Precipitation (P) [inches]</label>
                <input type="number" id="precipitation" class="form-input" step="any" min="0" placeholder="e.g., 45.5">
            </div>

            <div class="form-group">
                <label for="runoff">Runoff (R) [inches]</label>
                <input type="number" id="runoff" class="form-input" step="any" min="0" placeholder="e.g., 15.2">
            </div>
                  </div>
                  <div class="input-row">
            <div class="form-group">
                <label for="evapotranspiration">Evapotranspiration (ET) [inches]</label>
                <input type="number" id="evapotranspiration" class="form-input" step="any" min="0" placeholder="e.g., 22.8">
            </div>

            <div class="form-group">
                <label for="percolation">Percolation (PERsw) [inches]</label>
                <input type="number" id="percolation" class="form-input" step="any" min="0" placeholder="e.g., 5.5">
            </div>
                 </div>
            <button class="calculate-btn" onclick="calculateWaterBalance()">Calculate Water Balance</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Water balance illustration">
                <p>This tool calculates the change in water storage for landfill cover management.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Change in Water Storage (ΔSLC)</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="waterBalanceValue">0.000</div>
                    <div class="rate-unit">inches</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Soil Landfill Cover Water Balance Calculator</strong> determines the change in water storage (ΔSLC) 
            in a landfill cover system. This is crucial for assessing water balance, predicting leachate formation, 
            ensuring cover stability, and maintaining environmental compliance. It allows engineers and environmental 
            professionals to monitor water inputs and outputs to design and manage effective landfill cover systems.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>P (Precipitation):</strong> Total water input from rainfall and other sources (inches).</li>
            <li><strong>R (Runoff):</strong> Water that flows over the surface without infiltrating (inches).</li>
            <li><strong>ET (Evapotranspiration):</strong> Water lost to atmosphere through evaporation and plant transpiration (inches).</li>
            <li><strong>PERsw (Percolation):</strong> Water that infiltrates through the cover into underlying waste (inches).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>All values must be non-negative numbers ≥ 0.</strong></li>
            <li><strong>Precipitation (P):</strong> Typical range: 0-100 inches/year.</li>
            <li><strong>Runoff (R):</strong> Must be ≤ Precipitation (P), typically 0-70% of P.</li>
            <li><strong>Evapotranspiration (ET):</strong> Must be ≤ Precipitation (P), typically 0-80% of P.</li>
            <li><strong>Percolation (PERsw):</strong> Must be ≤ Precipitation (P), typically 0-30% of P.</li>
            <li><strong>Sum of R, ET, and PERsw:</strong> Cannot exceed P (R + ET + PERsw ≤ P).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>ΔSLC = Precipitation  - Runoff - Evapotranspiration - Percolation</strong> (must be a finite number).</li>
            <li><strong>ΔSLC > 0:</strong> ✅ Net water gain - There is a net gain of water in the landfill cover system.</li>
            <li><strong>ΔSLC = 0:</strong> ℹ️ Neutral balance - The water balance is neutral (no change in storage).</li>
            <li><strong>ΔSLC < 0:</strong> ⚠️ Net water loss - There is a net loss of water from the landfill cover system.</li>
            <li><strong>Extreme ΔSLC values:</strong> Values outside typical range (-20 to +20 inches) trigger warnings.</li>
            <li><strong>Assessment/Feedback:</strong> The classification and suggestion displayed with the result reflect the actual water balance status and guide environmental management decisions.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📚 Governing Principle</h3>
        <p>
            The calculation of a soil landfill cover's water balance is commonly assessed using models like the 
            <strong>Hydrologic Evaluation of Landfill Performance (HELP)</strong> model, which is widely recognized as an industry standard for landfill cover and liner water balance calculations. 
            Other models, such as the <strong>USGS Soil-Water-Balance (SWB)</strong> model, can also be applied to estimate components of water balance.
        </p>
        <p>
            <strong style="color: #1976d2;">Key Models and Approaches:</strong>
        </p>
        <ul class="note-list">
            <li><strong>HELP Model:</strong> Evaluates water balance of landfill cover and liner systems using a detailed daily-step hydrologic simulation. Widely used in environmental engineering and regulatory compliance.</li>
            <li><strong>SWB Model:</strong> Estimates infiltration, evapotranspiration, and percolation at a daily time-step using modified Thornthwaite-Mather equations.</li>
            <li><strong>Custom Water Balance Equations:</strong> For specific landfill projects, customized equations can be used to model site-specific conditions and predict leachate formation accurately.</li>
        </ul>
        <p>
            <strong>Water Balance Components:</strong> Includes precipitation (P), runoff (R), evapotranspiration (ET), percolation (PERsw), and storage (ΔSLC). Accurate tracking of these components ensures effective landfill cover design, minimizes leachate generation, and maintains compliance with environmental standards.
        </p>
        <p>
            <strong>Importance:</strong> Water balance calculations inform cover design, environmental planning, and regulatory compliance. The feedback/assessment from the calculator (Net Gain, Net Loss, Neutral) provides actionable guidance for environmental engineers to manage landfill cover water storage effectively.
        </p>
    </div>

    <div class="note-card">
        <h3>📝 Conclusion</h3>
        <p>
            The <strong>Soil Landfill Cover Water Balance Calculator</strong> provides a precise assessment of net water storage change (ΔSLC) in landfill cover systems. 
            This helps predict leachate generation, maintain cover stability, and prevent environmental contamination. 
            Incorporating assessment/feedback ensures practical guidance for engineers and environmental professionals, aiding in the design of effective covers and supporting regulatory compliance.
        </p>
    </div>

</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateWaterBalance() {
    // Read values
    const precipitation = parseFloat(document.getElementById("precipitation").value);
    const runoff = parseFloat(document.getElementById("runoff").value);
    const evapotranspiration = parseFloat(document.getElementById("evapotranspiration").value);
    const percolation = parseFloat(document.getElementById("percolation").value);

    const waterBalanceValueEl = document.getElementById("waterBalanceValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation - Check if all inputs are numbers
    if (![precipitation, runoff, evapotranspiration, percolation].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }

    // Validation - Non-negative values
    if (precipitation < 0) errors.push("👉 Precipitation must be ≥ 0.");
    if (runoff < 0) errors.push("👉 Runoff must be ≥ 0.");
    if (evapotranspiration < 0) errors.push("👉 Evapotranspiration must be ≥ 0.");
    if (percolation < 0) errors.push("👉 Percolation must be ≥ 0.");

    // Validation - Individual parameters cannot exceed precipitation
    if (runoff > precipitation) errors.push("👉 Runoff cannot exceed precipitation.");
    if (evapotranspiration > precipitation) errors.push("👉 Evapotranspiration cannot exceed precipitation.");
    if (percolation > precipitation) errors.push("👉 Percolation cannot exceed precipitation.");
    
    // Validation - Sum of outputs cannot exceed precipitation
    const sumOutputs = runoff + evapotranspiration + percolation;
    if (sumOutputs > precipitation) {
        errors.push("👉 Sum of runoff, evapotranspiration, and percolation cannot exceed precipitation.");
    }

    // Warning for unusual values
    if (precipitation > 100) warnings.push("⚠️ Precipitation unusually high (>100 inches).");
    if (runoff > 0.7 * precipitation) warnings.push("⚠️ Runoff unusually high (>70% of precipitation).");
    if (evapotranspiration > 0.8 * precipitation) warnings.push("⚠️ Evapotranspiration unusually high (>80% of precipitation).");
    if (percolation > 0.3 * precipitation) warnings.push("⚠️ Percolation unusually high (>30% of precipitation).");

    if (errors.length) return showErrors(errors);

    // Formula: ΔSLC = P - R - ET - PERsw
    const waterBalance = precipitation - runoff - evapotranspiration - percolation;

    if (!Number.isFinite(waterBalance)) {
        return showErrors(["⚠️ Computed water balance is invalid (possible calculation error)."]);
    }

    // Warning for extreme water balance values
    if (waterBalance > 20) warnings.push("⚠️ Water balance unusually high (>20 inches).");
    if (waterBalance < -20) warnings.push("⚠️ Water balance unusually low (<-20 inches).");

    // Classification
    let classification, suggestion, color;
    if (waterBalance > 0) {
        classification = "Net Water Gain";
        suggestion = "✅ There is a net gain of water in the landfill cover system.";
        color = "#2e7d32";
    } else if (waterBalance < 0) {
        classification = "Net Water Loss";
        suggestion = "⚠️ There is a net loss of water from the landfill cover system.";
        color = "#c62828";
    } else {
        classification = "Neutral Balance";
        suggestion = "ℹ️ The water balance is neutral (no change in storage).";
        color = "#1560bd";
    }

    // Format the value for display
    let displayValue;
    if (Math.abs(waterBalance) < 0.01 && waterBalance !== 0) {
        displayValue = waterBalance.toExponential(4);
    } else {
        displayValue = waterBalance.toFixed(4);
    }

    // Display result
    waterBalanceValueEl.textContent = displayValue;
    feedbackEl.innerHTML = `
        <div>ΔSLC = <b>${displayValue}</b> inches</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

Input Validations:
All inputs must be numeric values

All inputs must be non-negative (≥ 0)

Runoff, evapotranspiration, and percolation cannot individually exceed precipitation

Sum of runoff, evapotranspiration, and percolation cannot exceed precipitation
-------------------------------------------------------------------------------------------------
Output Validations:
ΔSLC must be a finite number

ΔSLC > 0: Net water gain (positive result)

ΔSLC = 0: Neutral water balance

ΔSLC < 0: Net water loss (negative result)
--------------------------------------------------------------------------------------------------
Edge Cases:
Zero precipitation with positive other values (should show error)

Extreme values that exceed typical ranges (trigger warnings)

All zero inputs (result should be zero)

Non-numeric inputs (should show error)





-->