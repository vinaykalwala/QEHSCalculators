{% extends 'base.html' %}
{% block title %}Elevation Head Loss Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elevation Head Loss Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

<div class="calculator-header">
  <h1>Elevation Head Loss Calculator</h1>
  <p>
    Estimate pressure change caused purely by elevation (static head). Useful for pump sizing,
    sprinkler zoning, hydro storage, and QEHS/fire-safety reviews.
  </p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="fluidDensity">Fluid Density (ρ) <span>[kg/m³]</span></label>
      <input type="number" id="fluidDensity" class="form-input" min="0.01" max="20000" step="0.01" placeholder="e.g., 1000.00 for water">
    </div>

    <div class="form-group">
      <label for="elevationChange">Elevation Change (h) <span>[m]</span></label>
      <input type="number" id="elevationChange" class="form-input" min="-10000" max="10000" step="0.001" placeholder="Positive for upward lift; negative for drop">
    </div>

    <div class="form-group">
      <label for="gravity">Gravity (g) <span>[m/s²]</span></label>
      <input type="number" id="gravity" class="form-input" min="0.1" max="30" step="0.001" value="9.81" placeholder="9.81 on Earth">
    </div>

    <button class="calculate-btn" onclick="calculateElevationHead()">Calculate Pressure Change</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Elevation head illustration">
      <p>This tool calculates <strong>pressure change</strong> due to elevation (static head).</p>
    </div>

    <div class="result-error hidden" id="resultError">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Calculated Pressure Change</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="rateValue">0.00</div>
        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">
          Pa (ΔP; + = loss for upflow, − = gain for downflow)
        </div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      Computes the static pressure change from a vertical elevation difference for a given fluid.
      Positive height means lifting the fluid (pressure loss), negative height means descending (pressure gain).
      Use for pump head checks, gravity supply, and verifying sprinkler zone pressures.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>ρ (kg/m³):</strong> Fluid density.</li>
      <li><strong>g (m/s²):</strong> Gravitational acceleration.</li>
      <li><strong>h (m):</strong> Elevation change (positive for upward lift, negative for drop).</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>ρ (kg/m³):</strong> Required, > 0, allowed 0.01–20,000 (typical: gases < 5; water ≈ 1,000; brines/oils 800–1,400; slurries > 1,400).</li>
      <li><strong>g (m/s²):</strong> Required, > 0, allowed 0.1–30 (Earth ≈ 9.81).</li>
      <li><strong>h (m):</strong> Required, −10,000 to +10,000 (positive for upward lift; negative for drop).</li>
      <li><strong>Reporting precision:</strong> ≤ 0.001 for inputs; ΔP displayed in Pa with kPa/bar/psi context.</li>
      <li><strong>Constraints:</strong> Zeros/negatives for ρ or g not allowed; non-numeric values rejected.</li>
      <li><strong>Advisories:</strong> If |ΔP| > 5 MPa, flag mechanical design/over-pressure risk for review.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📏 Output Validations</h3>
    <ul class="note-list">
      <li><strong>Pressure Change (ΔP):</strong> Displayed in Pa with 2 decimals, with kPa/bar/psi context.</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>h > 0: Upflow — Static pressure loss (pump must add this head).</li>
          <li>h < 0: Downflow — Static pressure gain (consider PRVs/relief to avoid over-pressure).</li>
          <li>h = 0: No elevation difference — No static head change.</li>
        </ul>
      </li>
      <li>Warnings are triggered for extreme conditions: high |ΔP|, low/high density, non-standard gravity, or excessive decimals.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      An elevation head loss calculator is not governed by a single, specific standard but uses equations found in fluid dynamics handbooks, such as the Darcy-Weisbach equation and the Hazen-Williams equation, which are themselves based on empirical data, experimental results, and various established engineering standards for pipe flow and fluid mechanics.
    </p>
    <p><b>Underlying Principles and Equations</b></p>
    <p><b>Darcy-Weisbach Equation:</b> This is considered the most accurate and universally applicable formula for calculating the head loss in a pipe due to friction. It considers the fluid's properties, pipe dimensions, and flow characteristics.</p>
    <p><b>Hazen-Williams Equation:</b> An older, more empirical formula often used for water flow in pipes, particularly for relatively short pipe systems or when a simpler, less accurate calculation is sufficient.</p>
    <p><b>k-Value Method:</b> Used to calculate minor losses caused by fittings (like bends, valves, and tees) by using characteristic resistance coefficients (k-values) found in engineering handbooks.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides reliable estimates of static pressure change due to elevation, supporting <strong>pump sizing</strong>, <strong>sprinkler zoning</strong>, and <strong>gravity feed system design</strong>. Ensure input values (ρ, g, h) are accurate and use consistent SI units, validating with field data or fluid dynamics handbooks for critical applications to ensure safe and efficient system performance.
    </p>
  </div>
</div>
</div>
<script>
/* Reusable error display */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Elevation head (static) pressure change with robust, domain-aware validations */
function calculateElevationHead() {
  const rhoRaw = (document.getElementById("fluidDensity").value || "").trim();
  const gRaw   = (document.getElementById("gravity").value || "").trim();
  const hRaw   = (document.getElementById("elevationChange").value || "").trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // reset UI
  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // presence
  if (!rhoRaw) errors.push("👉 Please enter Fluid Density (ρ) in kg/m³.");
  if (!gRaw)   errors.push("👉 Please enter Gravity (g) in m/s².");
  if (!hRaw)   errors.push("👉 Please enter Elevation Change (h) in meters (positive up, negative down).");
  if (errors.length) return showErrors(errors);

  // parse
  const rho = Number(rhoRaw);
  const g   = Number(gRaw);
  const h   = Number(hRaw);

  // numeric checks
  if (!Number.isFinite(rho)) errors.push("👉 ρ must be a valid number (kg/m³).");
  if (!Number.isFinite(g))   errors.push("👉 g must be a valid number (m/s²).");
  if (!Number.isFinite(h))   errors.push("👉 h must be a valid number (m).");
  if (errors.length) return showErrors(errors);

  // hard ranges
  const RHO_MIN = 0.01, RHO_MAX = 20000;    // kg/m³
  const G_MIN = 0.1,   G_MAX = 30;          // m/s²
  const H_MIN = -10000, H_MAX = 10000;      // m

  if (rho <= 0 || rho < RHO_MIN || rho > RHO_MAX) {
    errors.push(`👉 ρ must be > 0 and within ${RHO_MIN} to ${RHO_MAX} kg/m³.`);
  }
  if (g <= 0 || g < G_MIN || g > G_MAX) {
    errors.push(`👉 g must be > 0 and within ${G_MIN} to ${G_MAX} m/s².`);
  }
  if (h < H_MIN || h > H_MAX) {
    errors.push(`👉 h must be between ${H_MIN} and ${H_MAX} meters.`);
  }
  if (errors.length) return showErrors(errors);

  // advisories & sanity checks
  const decimals = s => (String(s).split(".")[1] || "").length;
  if (decimals(rhoRaw) > 3) warnings.push("⚠️ ρ has more than 3 decimals – consider rounding for reporting.");
  if (decimals(gRaw) > 3)   warnings.push("⚠️ g has more than 3 decimals – consider rounding for reporting.");
  if (decimals(hRaw) > 3)   warnings.push("⚠️ h has more than 3 decimals – consider rounding for reporting.");

  if (Math.abs(h) < 0.001) warnings.push("⚠️ Elevation change is ~0 → negligible static head.");
  if (rho < 5) warnings.push("⚠️ Very low density suggests gas; incompressible static-head approximation may be less accurate.");
  if (rho > 3000) warnings.push("⚠️ Very high density (heavy slurry/metal) – verify material and units.");
  if (Math.abs((g - 9.81) / 9.81) > 0.1) warnings.push("⚠️ g deviates >10% from Earth standard – verify units/context.");

  // compute ΔP = ρ g h (Pa); sign follows h
  const deltaP = rho * g * h;

  if (!Number.isFinite(deltaP)) {
    return showErrors(["⚠️ Computation overflow/underflow. Check input magnitudes."]);
  }

  // flag extreme pressures for design checks
  if (Math.abs(deltaP) > 5e6) {
    warnings.push("⚠️ |ΔP| > 5 MPa – verify mechanical design limits, PRVs, and zoning.");
  }

  // interpretation
  let statusMsg = "";
  if (h > 0) {
    statusMsg = "⬆️ Upflow: static pressure loss (pump must add this head).";
  } else if (h < 0) {
    statusMsg = "⬇️ Downflow: static pressure gain (consider PRVs/relief to avoid over-pressure).";
  } else {
    statusMsg = "ℹ️ No elevation difference: no static head change.";
  }

  // derived/context values
  const kPa = deltaP / 1000;
  const bar = deltaP / 100000;
  const psi = deltaP * 0.0001450377377;        // Pa → psi
  const gradPaPerM = rho * g;                  // pressure gradient per meter

  const fmt = (n, d=2) => Number(n).toLocaleString(undefined,{minimumFractionDigits:d, maximumFractionDigits:d});
  const sign = deltaP >= 0 ? "+" : "−";

  // update UI
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");

  // main big number (Pa)
  rateEl.textContent = fmt(deltaP, 2);
  document.querySelector(".rate-label").textContent = "Pa (ΔP; + = loss for upflow, − = gain for downflow)";

  // details & feedback
  let details = `
    <div>Pressure gradient ρ·g: <b>${fmt(gradPaPerM, 2)}</b> Pa/m</div>
    <div>ΔP context: <b>${fmt(kPa, 3)}</b> kPa &nbsp; | &nbsp; <b>${fmt(bar, 5)}</b> bar &nbsp; | &nbsp; <b>${fmt(psi, 3)}</b> psi</div>
  `;
  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- 
=============================================
📘 Elevation Head (Static Pressure) Calculator
=============================================

📌 Formula:
-----------
ΔP = ρ × g × h

Where:
- ΔP = Static pressure difference [Pa]
- ρ   = Fluid density [kg/m³]
- g   = Gravitational acceleration [m/s²]
- h   = Elevation change [m] 
        (positive upflow → pressure loss; negative downflow → pressure gain)

Conversions & derived values:
- kPa = ΔP / 1000
- bar = ΔP / 100000
- psi = ΔP × 0.0001450377
- Pressure gradient = ρ·g [Pa/m]

---

✅ Input Validations:
---------------------
1. Presence:
   • Fluid Density (ρ), Gravity (g), and Elevation Change (h) are required.

2. Data type:
   • All inputs must be valid numbers.

3. Ranges:
   • ρ: 0.01 ≤ ρ ≤ 20000 kg/m³  
   • g: 0.1 ≤ g ≤ 30 m/s²  
   • h: −10000 ≤ h ≤ +10000 m  

4. Logic checks:
   • ρ and g must be > 0.  
   • If |h| < 0.001 → treated as negligible head difference.  

---

⚠️ Warnings / Advisories:
--------------------------
• More than 3 decimals → consider rounding for reporting.  
• ρ < 5 → Gas density; incompressible assumption less accurate.  
• ρ > 3000 → Very high density; verify units/material.  
• g deviates >10% from 9.81 → check units/context.  
• |ΔP| > 5 MPa → Design alert; verify pressure relief and equipment limits.  

---

📊 Outputs:
-----------
• Static pressure change ΔP [Pa] (signed; + = loss/upflow, − = gain/downflow).  
• Same ΔP in kPa, bar, and psi.  
• Pressure gradient (ρ·g) [Pa/m].  
• Input summary: ρ, g, h.  
• Status message:  
   - Upflow → pressure loss.  
   - Downflow → pressure gain.  
   - Zero h → no head change.  
• Warnings/advisories shown if applicable.  

=============================================
-->
