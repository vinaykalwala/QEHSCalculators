{% extends 'base.html' %}
{% block title %}Thermal transmittance (U) from the individual thermal resistances Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermal transmittance (U) from the individual thermal resistances Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">

{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Thermal Transmittance (U) From The Individual Thermal Resistances Calculator</h1>
    <p>Calculate the overall thermal transmittance (U-value) from individual thermal resistances.</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Thermal Resistances</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="R1">Resistance R₁ (m²·°C/W)</label>
                <input type="number" id="R1" class="form-input" step="0.0001" min="0" placeholder="e.g., 0.04" aria-label="Resistance R1">
            </div>

            <div class="form-group">
                <label for="R2">Resistance R₂ (m²·°C/W)</label>
                <input type="number" id="R2" class="form-input" step="0.0001" min="0" placeholder="e.g., 0.13" aria-label="Resistance R2">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="R3">Resistance R₃ (m²·°C/W)</label>
                <input type="number" id="R3" class="form-input" step="0.0001" min="0" placeholder="e.g., 0.08" aria-label="Resistance R3">
            </div>

            <div class="form-group">
                <label for="R4">Resistance R₄ (m²·°C/W)</label>
                <input type="number" id="R4" class="form-input" step="0.0001" min="0" placeholder="e.g., 0.02" aria-label="Resistance R4">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="R5">Resistance R₅ (m²·°C/W)</label>
                <input type="number" id="R5" class="form-input" step="0.0001" min="0" placeholder="e.g., 0.11" aria-label="Resistance R5">
            </div>

            <div class="form-group">
                <label for="R6">Resistance R₆ (m²·°C/W)</label>
                <input type="number" id="R6" class="form-input" step="0.0001" min="0" placeholder="e.g., 0.04" aria-label="Resistance R6">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateThermalTransmittance()">Calculate Thermal Transmittance</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Thermal resistance illustration">
            <p>This tool calculates the overall thermal transmittance (U-value) from individual thermal resistances.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Thermal Transmittance</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="UValue">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">W/(m²·°C)</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title"> Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>📘 About</h3>
        <p>
            This calculator determines the overall thermal transmittance (U-value) of a multi-layer structure by summing the individual thermal resistances of each layer and taking the reciprocal. The U-value indicates how well a building element conducts heat, with lower values indicating better insulation.
        </p>
    </div>
    <div class="note-card">
    <h3>📊 Parameters</h3>
    <ul class="note-list">
        <li><strong>R₁ to R₆ (Thermal Resistances):</strong> Individual resistance values of layers in a building element, measured in <b>m²·°C/W</b>.</li>
        <li><strong>R<sub>total</sub>:</strong> Sum of all input resistances (R₁ + R₂ + ... + R₆).</li>
        <li><strong>U-value:</strong> Overall thermal transmittance.</li>
    </ul>
</div>


    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li><strong>Thermal Resistances (R-values):</strong> Must be <em>non-negative numbers</em> (≥ 0).</li>
            <li><strong>Typical Range:</strong> Individual R-values typically range from 0.01 to 5.0 m²·°C/W.</li>
            <li><strong>Decimal Precision:</strong> Values can be entered with up to 4 decimal places.</li>
            <li><strong>Zero Values:</strong> Blank inputs are treated as 0 (no resistance).</li>
            <li><strong>Total Resistance:</strong> Must be greater than 0 to avoid division by zero.</li>
            <li><strong>Realistic Values:</strong> Warning for unusually high (> 10 m²·°C/W) or low (< 0.001 m²·°C/W) resistances.</li>
        </ul>
    </div>
    <div class="note-card">
    <h3>✅ Output Validations</h3>
    <ul class="note-list">
        <li><strong>U-value must be ≥ 0</strong> (cannot be negative or undefined).</li>
        
        <ul>
            <li>U < 0.2 → Excellent Insulation ✅High-performance building envelope with minimal heat loss</li>
            <li>0.2 ≤ U < 0.5 → Good Insulation 👍Well-insulated structure meeting modern energy standards.</li>
            <li>0.5 ≤ U < 1.0 → Moderate Insulation ⚖️Average insulation performance; consider improvements for better energy efficiency.</li>
            <li>1.0 ≤ U < 2.0 → Poor Insulation ⚠️Significant heat loss; insulation upgrade recommended.</li>
            <li>U ≥ 2.0 → Very Poor Insulation ❌Minimal insulation; urgent upgrade needed to meet basic standards.</li>
        </ul>
         </ul>
</div>


<div class="note-card">
  <h3>📐 Governing Principle</h3>
  <p>
    The standard for calculating thermal transmittance (<b>U-value</b>) from individual thermal 
    resistances is primarily <b>ISO 6946</b>, which provides the analytical method for building 
    components like walls and roofs without thermal bridges. For elements with thermal bridges, 
    <b>ISO 10211</b> is used. Other relevant ISO standards include <b>ISO 9869-1</b> for experimental 
    measurement and <b>ISO 7345</b> for the fundamental definition of thermal transmittance.
  </p>

  <h3 style="margin-top:12px; color:#1976d2;">Key ISO Standards for U-value Calculation</h3>
  <ul class="note-list">
    <li><b>ISO 6946:</b> Used to calculate the thermal transmittance of building components, such as 
        walls and roofs, by summing the thermal resistances of individual layers and accounting for 
        surface resistances.</li>
    <li><b>ISO 10211:</b> Deals with calculating thermal bridges, applicable to complex geometries 
        where ISO 6946 is insufficient.</li>
    <li><b>ISO 9869-1:</b> Describes how to measure the thermal transmittance of a building element 
        experimentally under steady-state conditions using methods like heat flow meters.</li>
    <li><b>ISO 7345:</b> Defines the fundamental principles of thermal transmittance, setting the 
        definition of the U-value.</li>
  </ul>

  <h3 style="margin-top:12px; color:#1976d2;">Understanding the Calculation</h3>
  <ul class="note-list">
    <li><b>Thermal Resistance (R):</b> The R-value is the resistance of a material to heat flow, 
        calculated from its thickness and thermal conductivity (λ).</li>
    <li><b>Summing Resistances:</b> For a building component, the thermal resistance of each layer is 
        added together, along with the internal and external surface resistances, to get the total 
        thermal resistance (R<sub>tot</sub>).</li>
    <li><b>Inverse Relationship:</b> The thermal transmittance (U-value) is the inverse of the total 
        thermal resistance (U = 1/R<sub>tot</sub>), with a lower U-value indicating better thermal 
        performance.</li>
  </ul>
</div>

<div class="note-card">
    <h3>📝 Conclusion</h3>
    <p>
        The U-value is a key indicator of a building element’s insulation quality. Lower U-values correspond to better insulation and reduced heat loss, contributing to improved energy efficiency and comfort.  
        This calculator helps assess compliance with international standards and supports informed decisions on material selection and insulation upgrades.
    </p>
</div>



</div>

<script>
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

function calculateThermalTransmittance() {
  // Get input values, treating empty inputs as 0
  const R1 = parseFloat(document.getElementById("R1")?.value.trim()) || 0;
  const R2 = parseFloat(document.getElementById("R2")?.value.trim()) || 0;
  const R3 = parseFloat(document.getElementById("R3")?.value.trim()) || 0;
  const R4 = parseFloat(document.getElementById("R4")?.value.trim()) || 0;
  const R5 = parseFloat(document.getElementById("R5")?.value.trim()) || 0;
  const R6 = parseFloat(document.getElementById("R6")?.value.trim()) || 0;

  const UValueEl = document.getElementById("UValue");
  const feedbackEl = document.getElementById("feedbackContent");
  document.getElementById("resultError").classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Input validation
  const resistances = [R1, R2, R3, R4, R5, R6];
  const resistanceNames = ["R₁", "R₂", "R₃", "R₄", "R₅", "R₆"];
  
  resistances.forEach((res, index) => {
    if (res < 0) {
      errors.push(`👉 ${resistanceNames[index]} cannot be negative.`);
    }
    if (res > 10) {
      warnings.push(`⚠️ ${resistanceNames[index]} is unusually high (>10 m²·°C/W).`);
    }
    if (res > 0 && res < 0.001) {
      warnings.push(`⚠️ ${resistanceNames[index]} is very low (<0.001 m²·°C/W).`);
    }
  });

  if (errors.length) return showErrors(errors);

  // Calculate total resistance
  const totalResistance = R1 + R2 + R3 + R4 + R5 + R6;
  
  // Check for division by zero
  if (totalResistance <= 0) {
    return showErrors(["👉 Total resistance must be greater than zero."]);
  }

  // Calculate U-value
  const U = 1 / totalResistance;
  
  if (!Number.isFinite(U) || U < 0) {
    return showErrors(["⚠️ Computed U-value is invalid. Check inputs."]);
  }

  // Classification and feedback
  let classification, suggestion, energyEfficiency;
  
  if (U < 0.2) {
    classification = "Excellent Insulation";
    suggestion = "✅ High-performance building envelope with minimal heat loss.";
    energyEfficiency = "Very High";
  } else if (U < 0.5) {
    classification = "Good Insulation";
    suggestion = "✅ Well-insulated structure meeting modern energy standards.";
    energyEfficiency = "High";
  } else if (U < 1.0) {
    classification = "Moderate Insulation";
    suggestion = "⚠️ Average insulation performance; consider improvements for better energy efficiency.";
    energyEfficiency = "Moderate";
  } else if (U < 2.0) {
    classification = "Poor Insulation";
    suggestion = "❌ Significant heat loss; insulation upgrade recommended.";
    energyEfficiency = "Low";
  } else {
    classification = "Very Poor Insulation";
    suggestion = "❌ Minimal insulation; urgent upgrade needed to meet basic standards.";
    energyEfficiency = "Very Low";
  }

  // Add warnings for extreme U-values
  if (U > 5) warnings.push("⚠️ Extremely high U-value - verify input values.");
  if (U < 0.05) warnings.push("⚠️ Extremely low U-value - verify input values.");

  // Prepare feedback content
  let details = `<div>U-value = <b>${U.toFixed(4)}</b> W/(m²·°C)</div>`;
  details += `<div>Total Resistance (R<sub>total</sub>) = <b>${totalResistance.toFixed(4)}</b> m²·°C/W</div>`;
  details += `<div>Classification: <b>${classification}</b></div>`;
  details += `<div>Energy Efficiency: <b>${energyEfficiency}</b></div>`;
  details += `<div style="margin-top:8px;">${suggestion}</div>`;
  
  if (warnings.length) {
    details += `<div style="margin-top:12px; color:#b35d00; font-size:14px;"><strong>Notes:</strong> ${warnings.join(" | ")}</div>`;
  }

  // Update UI
  UValueEl.textContent = U.toFixed(4);
  feedbackEl.innerHTML = details;
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

------------------------------------------------------------------
Input Validations:
All resistance values must be non-negative (≥ 0)

Individual resistance values should typically be between 0.01-5.0 m²·°C/W

Warning for values >10 m²·°C/W (unusually high)

Warning for values <0.001 m²·°C/W (unusually low)

Total resistance must be >0 to avoid division by zero
-------------------------------------------------------------------------------------------------
Output Validations:
U-value must be finite and non-negative

Warning for U-value >5 W/(m²·°C) (extremely high)

Warning for U-value <0.05 W/(m²·°C) (extremely low)

Classification based on standard building insulation categories
-------------------------------------------------------------------------------------------------
Edge Cases:
Division by zero when total resistance is 0

Extremely small U-values (<0.05) that might indicate calculation errors

Extremely large U-values (>5) that might indicate missing insulation layers

Mixed valid/invalid inputs

Decimal precision handling (up to 4 decimal places)
--------------------------------------------------------------------------------------------------
Formula:
Total Thermal Resistance: R_total = R₁ + R₂ + R₃ + R₄ + R₅ + R₆

Thermal Transmittance: U = 1 / R_total
-->