{% extends 'base.html' %}
{% block title %}Shaded Wall Heat Conduction Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaded Wall Heat Conduction Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Shaded Wall Heat Conduction Calculator</h1>
        <p>Calculate heat transfer through walls for energy efficiency analysis and fire safety assessment.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="u_value">U-Value</label>
                <input type="number" id="u_value" class="form-input" step="any" min="0" placeholder="Enter U-Value">
            </div>
            
            <div class="form-group">
                <label for="area">Surface Area</label>
                <input type="number" id="area" class="form-input" step="any" min="0" placeholder="Enter Surface Area">
            </div>
            
            <div class="form-group">
                <label for="temp_diff">Temperature Difference</label>
                <input type="number" id="temp_diff" class="form-input" step="any" min="0" placeholder="Enter Temperature Difference">
            </div>

            <button class="calculate-btn" onclick="calculateHeatTransfer()">Calculate Heat Transfer</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Heat transfer illustration">
                <p>This tool calculates heat conduction through walls for energy efficiency and fire safety analysis.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Heat Transfer Rate</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="heatTransferValue">0.00</div>
                    <div class="rate-unit">Watts</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Shaded Wall Heat Conduction Calculator</strong> computes the rate of heat transfer (Q) through walls 
            of buildings. It is a crucial tool for evaluating energy efficiency, thermal comfort, and fire safety in both 
            residential and commercial construction. By understanding how heat moves through building envelopes, engineers 
            and designers can make informed decisions regarding insulation, material selection, and overall thermal performance.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>U-Value:</strong> Overall heat transfer coefficient (W/m²K). Lower values indicate better insulation.</li>
            <li><strong>Surface Area (A):</strong> Wall area through which heat transfer occurs (m²).</li>
            <li><strong>Temperature Difference (ΔT):</strong> Difference between internal and external temperatures (°C).</li>
            <li><strong>Heat Transfer Rate (Q):</strong> Rate of energy transfer through the wall (Watts).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>U-Value:</strong> Must be > 0 (typical range: 0.1-5.0 W/m²K).</li>
            <li><strong>Surface Area:</strong> Must be > 0 (typical range: 1-1000 m²).</li>
            <li><strong>Temperature Difference:</strong> Must be > 0 (typical range: 1-50°C).</li>
            <li><strong>All inputs:</strong> Must be numeric and realistic for standard building applications.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Heat Transfer Rate (Q) must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>Heat Transfer Rate (Q) &lt; 500 W:</strong> ✅ Low heat transfer → Excellent insulation. Minimal heat transfer.</li>
            <li><strong>Heat Transfer Rate (Q) 500-2000 W:</strong> ✅ Moderate → Typical for standard construction. Acceptable performance.</li>
            <li><strong>Heat Transfer Rate (Q) 2000-5000 W:</strong> ⚠️ High → Significant heat transfer. Consider insulation improvements.</li>
            <li><strong>Heat Transfer Rate (Q) &gt; 5000 W:</strong> ❌ Very high → Excessive heat transfer. Urgent insulation upgrades needed.</li>
            <li><strong>Assessment/Feedback:</strong> The classification and suggestion displayed with the result reflect the actual heat transfer status and guide insulation and energy efficiency decisions.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📚 Governing Principle</h3>
        <p>
            A <strong>Shaded Wall Heat Conduction Calculator</strong> is based on principles of heat transfer and conduction, primarily described by 
            <strong>Fourier's law</strong>. It is not tied to a single standard but incorporates methodologies from international and regional standards, 
            ensuring accurate and realistic evaluations for building energy performance.
        </p>
        <p><strong style="color: #1976d2;">Key Standards and Principles:</strong></p>
        <ul class="note-list">
            <li><strong>ISO 6946:</strong> Methods for calculating thermal resistance of building components, especially for composite walls.</li>
            <li><strong>ISO 13786:</strong> Guidelines for calculating thermal mass and dynamic component behaviors under periodic temperature variations.</li>
            <li><strong>National Building Codes:</strong> UK’s Approved Documents L1A/L2A/L1B/L2B with BR 443, Singapore’s ETTV/RETV, etc., define U-value calculation conventions.</li>
            <li><strong>ASHRAE Standards:</strong> Provides methods to evaluate building energy performance and informs heat transfer calculations.</li>
            <li><strong>Fundamental Principle:</strong> Heat conduction through a wall is proportional to the U-value, surface area, and temperature difference (Q = U × A × ΔT).</li>
        </ul>
        <p>
            The specific standard applied depends on the intended market and regulatory requirements. By combining these principles with Fourier's law, 
            the calculator provides reliable estimates for energy efficiency, thermal comfort, and fire safety.
        </p>
        <p>
            Output feedback (Low, Moderate, High, Very High) reflects practical assessment and guides design decisions regarding insulation improvements, 
            energy efficiency, and compliance with building regulations.
        </p>
    </div>

    <div class="note-card">
        <h3>📝 Conclusion</h3>
        <p>
            The <strong>Shaded Wall Heat Conduction Calculator</strong> offers precise evaluation of heat transfer rates through walls. 
            With inputs such as U-value, surface area, and temperature difference, it determines the heat transfer rate in <b>Watts</b>. 
            The calculator provides actionable assessment/feedback to guide insulation upgrades, improve energy efficiency, ensure thermal comfort, 
            and maintain compliance with relevant international and national standards such as ISO, ASHRAE, and local building codes.
        </p>
    </div>

</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateHeatTransfer() {
    // Read values
    const U = parseFloat(document.getElementById("u_value").value);
    const A = parseFloat(document.getElementById("area").value);
    const deltaT = parseFloat(document.getElementById("temp_diff").value);

    const heatTransferValueEl = document.getElementById("heatTransferValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![U, A, deltaT].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    if (U <= 0) errors.push("👉 U-Value must be > 0.");
    if (A <= 0) errors.push("👉 Surface Area must be > 0.");
    if (deltaT <= 0) errors.push("👉 Temperature Difference must be > 0.");
    
    // Warning for unusual values
    if (U > 5.0) warnings.push("⚠️ U-Value unusually high (>5.0 W/m²K) - poor insulation.");
    if (U < 0.1) warnings.push("⚠️ U-Value unusually low (<0.1 W/m²K) - exceptional insulation.");
    if (A > 1000) warnings.push("⚠️ Surface area unusually large (>1000 m²).");
    if (A < 1) warnings.push("⚠️ Surface area unusually small (<1 m²).");
    if (deltaT > 50) warnings.push("⚠️ Temperature difference unusually high (>50°C).");
    if (deltaT < 1) warnings.push("⚠️ Temperature difference unusually low (<1°C).");

    if (errors.length) return showErrors(errors);

    // Formula: Q = U × A × ΔT (in Watts)
    const Q = U * A * deltaT;

    if (!Number.isFinite(Q)) {
        return showErrors(["⚠️ Computed heat transfer rate is invalid (possible calculation error)."]);
    }

    // Classification based on heat transfer rate (industry standard)
    let classification, suggestion, color;
    
    if (Q < 500) {
        classification = "Low";
        suggestion = "✅ Excellent insulation. Minimal heat transfer.";
        color = "#2e7d32";
    } else if (Q <= 2000) {
        classification = "Moderate";
        suggestion = "✅ Typical for standard construction. Acceptable performance.";
        color = "#2e7d32";
    } else if (Q <= 5000) {
        classification = "High";
        suggestion = "⚠️ Significant heat transfer. Consider insulation improvements.";
        color = "#f9a825";
    } else {
        classification = "Very High";
        suggestion = "❌ Excessive heat transfer. Urgent insulation upgrades needed.";
        color = "#c62828";
    }

    // Display result
    heatTransferValueEl.textContent = Q.toFixed(2);
    
    feedbackEl.innerHTML = `
        <div>Q = <b>${Q.toFixed(2)}</b> Watts</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--


Input Validations:
U-Value: Must be > 0 (typical range: 0.1-5.0 W/m²K)

Surface Area: Must be > 0 (typical range: 1-1000 m²)

Temperature Difference: Must be > 0 (typical range: 1-50°C)

All inputs must be numeric and finite numbers

Output Validations:
Q < 500 W: Low heat transfer (excellent insulation)

500-2000 W: Moderate heat transfer (typical construction)

2000-5000 W: High heat transfer (needs improvement)

Q > 5000 W: Very high heat transfer (urgent action needed)

Result must be finite: No NaN or Infinity values
Edge Cases:
Zero values: Any input = 0 → Error (values must be > 0)

Negative values: Any input negative → Error

Extremely large values: A=5000 → Warning

Extremely small values: U=0.001 → Warning

Non-numeric inputs: Text instead of numbers → Error

Extreme temperature difference: ΔT=100 → Warning




-->