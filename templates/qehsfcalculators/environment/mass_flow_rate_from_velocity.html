{% extends 'base.html' %}
{% block title %}Mass Flow Rate From Velocity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mass Flow Rate From Velocity Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover¬†effect¬†*/
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Mass Flow Rate From Velocity Calculator</h1>
    <p>
        Calculate the <strong>mass flow rate (kg/s)</strong> from cross-sectional area, velocity and either density (œÅ, kg/m¬≥)
        or specific volume (v, m¬≥/kg). Useful for ventilation, process piping, fire/smoke movement and leak-rate calculations.
    </p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="input-row">
        <div class="form-group">
            <label for="area"><strong>Cross-sectional Area (A) (m¬≤):</strong></label>
            <input type="number" id="area" class="form-input" step="any" min="0.000001" placeholder="e.g., 0.02">
        </div>

        <div class="form-group">
            <label for="velocity"><strong>Velocity (u) (m/s):</strong></label>
            <input type="number" id="velocity" class="form-input" step="any" min="0.0001" placeholder="e.g., 3.5">
        </div>
        </div>

        <div class="input-row">
        <div class="form-group">
            <label id="propertyLabel" for="propertyValue"><strong>Density (œÅ) (kg/m¬≥):</strong></label>
            <input type="number" id="propertyValue" class="form-input" step="any" min="0.0001" placeholder="e.g., 1.225 (air) or 1000 (water)">
        </div>
        
        <div class="form-group">
            <label for="inputMode"><strong>Property Type:</strong></label>
            <select id="inputMode" class="form-input" onchange="updatePropertyLabel()">
                <option value="density">Density (œÅ, kg/m¬≥)</option>
                <option value="specificVolume">Specific Volume (v, m¬≥/kg)</option>
            </select>
        </div>
    </div>
        <button class="calculate-btn" onclick="calculateMassFlow()">Calculate Mass Flow</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Mass flow illustration">
            <p>This tool calculates <strong>mass flow rate (kg/s)</strong> and provides basic safety/operational guidance.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">‚ùå</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Mass Flow</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.000</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">kg/s</div>
            </div>

            <div style="margin-top:8px;">
                <div><strong>Equivalent:</strong> <span id="ratePerHour">0.00</span> kg/hr</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            Mass flow rate is fundamental for ventilation design, duct/pipeline sizing, fire and smoke transport analysis,
            and leak-rate assessment. Use density (œÅ) for direct mass-based inputs (kg/m¬≥) or specific volume (v = m¬≥/kg)
            if your data source provides that instead. The calculator accepts either convention and validates units.
        </p>
    </div>

    <!-- Parameters Card -->
<div class="note-card">
    <h3>‚ùì  Parameters</h3>
    <ul class="note-list">
        <li><strong>Cross-sectional Area (A):</strong> Must be positive (m¬≤). Typical range: 0.00001 m¬≤ (small tube) to 100 m¬≤ (large duct).</li>
        <li><strong>Velocity (u):</strong> Must be positive (m/s). Typical range: 0.0001 m/s (very slow) to 200 m/s (high velocity).</li>
        <li><strong>Density (œÅ):</strong> Required if density mode selected (kg/m¬≥). Typical: air ‚âà 1.2, water ‚âà 1000. Range: 0.1-20,000 kg/m¬≥.</li>
        <li><strong>Specific Volume (v):</strong> Required if specific volume mode selected (m¬≥/kg). Typical: water ‚âà 0.001. Range: 0.00001-100 m¬≥/kg.</li>
        <li><strong>Property Type:</strong> Toggle between density (œÅ) and specific volume (v) modes based on available data.</li>
    </ul>
</div>
<div class="note-card">
    <h3>‚úÖ Input Validations </h3>
    <ul class="note-list">
        <li><strong>Area (A, m¬≤)</strong>: Positive, 0.00001 ‚Äì 100. Typical: 0.005‚Äì1.0</li>
        <li><strong>Velocity (u, m/s)</strong>: Positive, 0.0001 ‚Äì 200. Typical: 0.1‚Äì30</li>
        <li><strong>Density (œÅ, kg/m¬≥)</strong>: Positive, 0.1 ‚Äì 20000. Typical: air ~1.2, water ~1000</li>
        <li><strong>Specific Volume (v, m¬≥/kg)</strong>: Positive, 0.00001 ‚Äì 100. Liquids ~0.001</li>
        <li>Decimal precision ‚â§ 4 recommended; cross-check unusual combinations (large area + high velocity, very small v or œÅ)</li>
    </ul>
</div>


<!-- Output Validations Card -->
<div class="note-card">
    <h3>‚úÖ Output Validations</h3>
    <ul class="note-list">
        <li><strong>Mass Flow Rate (mÃá):</strong> Must be finite and positive (kg/s). Error if result ‚â§ 0 or non-finite.</li>
        <li><strong>Plausibility Check:</strong> Error if mÃá > 1,000,000 kg/s (likely unit error).</li>
        <li><strong>Range Assessment:</strong>
            <ul>
                <li>mÃá &lt; 0.001 kg/s ‚Üí Very low flow (leakage/error suspected)</li>
                <li>0.001 ‚â§ mÃá &lt; 10 kg/s ‚Üí Normal/small-system flow</li>
                <li>10 ‚â§ mÃá &lt; 1000 kg/s ‚Üí Large industrial flow</li>
                <li>mÃá ‚â• 1000 kg/s ‚Üí Extremely large flow</li>
            </ul>
        </li>
        <li><strong>Unit Consistency:</strong> Output in kg/s with equivalent kg/hr provided.</li>
        <li><strong>Input Echo:</strong> Results display includes all input values for verification.</li>
    </ul>
</div>
<div class="note-card">
    <h3>üìê Governing Principle</h3>
    <p>A Mass Flow Rate From Velocity Calculator isn't bound to a single specific standard but operates under the principles of fluid dynamics and uses the SI system of units, which defines mass flow rate in kilograms per second (kg/s). The calculation itself is a standard formula: Mass Flow Rate = Density √ó Velocity √ó Area.</p>
    <ul class="note-list">
        <h3>Here's a breakdown of the "standard" aspects:</h3>
        <li><strong>Units:</strong> The standard system for these calculations is the International System of Units (SI), where the unit for mass flow rate is kg/s.</li>
        <li><strong>Application:</strong> You can use this calculator in various fields, like fluid mechanics and engineering, to measure the rate of mass movement through a specific area.</li>
        <li><strong>Formula:</strong>The underlying principle is the fundamental fluid dynamics equation, which states that mass flow rate is the product of fluid density, cross-sectional area, and fluid velocity.</li>
        <h3>How it works:</h3>
            <ul>
                <li><strong>Density (œÅ):</strong> This is the mass of the fluid per unit volume, crucial for converting between volumetric and mass flow.</li>
                <li><strong>Velocity (u):</strong>The speed at which the fluid is moving through the area.</li>
                <li><strong>Area (A):</strong>The cross-sectional area of the pipe or channel through which the fluid is flowing.</li>
            </ul>
        </li>
    </ul>
</div>

<!-- Conclusion Card -->
<div class="note-card">
    <h3>üí° Conclusion</h3>
    <p>
        This calculator provides reliable mass flow rate calculations for various engineering applications including 
        ventilation design, pipeline sizing, and leak assessment. The tool validates inputs against practical ranges 
        and provides safety warnings for extreme values. Always verify that your units are consistent (m¬≤ for area, 
        m/s for velocity, and either kg/m¬≥ for density or m¬≥/kg for specific volume) to ensure accurate results. 
        For critical applications, cross-verify results with manual calculations or specialized software.
    </p>
</div>

</div>


<script>
/* Keep showErrors signature so UI behavior is consistent */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Update label for property input when mode changes */
function updatePropertyLabel() {
  const mode = document.getElementById("inputMode").value;
  const label = document.getElementById("propertyLabel");
  const input = document.getElementById("propertyValue");
  if (mode === "density") {
    label.innerHTML = '<strong>Density (œÅ) (kg/m¬≥):</strong>';
    input.placeholder = "e.g., 1.225 (air) or 1000 (water)";
    input.min = "0.0001";
  } else {
    label.innerHTML = '<strong>Specific Volume (v) (m¬≥/kg):</strong>';
    input.placeholder = "e.g., 0.001 (water) or 0.8 (gas - example)";
    input.min = "0.000001";
  }
}

/* Main calculation + validation */
function calculateMassFlow() {
  const areaRaw = (document.getElementById("area").value || "").trim();
  const velocityRaw = (document.getElementById("velocity").value || "").trim();
  const propRaw = (document.getElementById("propertyValue").value || "").trim();
  const mode = document.getElementById("inputMode").value;

  const placeholder = document.getElementById("placeholder");
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const rateHourEl = document.getElementById("ratePerHour");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required checks
  if (areaRaw === "") errors.push("üëâ Please enter Cross-sectional Area (A) in m¬≤.");
  if (velocityRaw === "") errors.push("üëâ Please enter Velocity (u) in m/s.");
  if (propRaw === "") {
    if (mode === "density") errors.push("üëâ Please enter Density (œÅ) in kg/m¬≥.");
    else errors.push("üëâ Please enter Specific Volume (v) in m¬≥/kg.");
  }
  if (errors.length) return showErrors(errors);

  // Parse numbers
  const area = parseFloat(areaRaw);
  const velocity = parseFloat(velocityRaw);
  const propVal = parseFloat(propRaw);

  // Basic numeric validation
  if (!Number.isFinite(area) || area <= 0) {
    errors.push("üëâ Cross-sectional Area must be a positive number (m¬≤). Example: 0.02 for a 16 cm diameter pipe.");
  }
  if (!Number.isFinite(velocity) || velocity <= 0) {
    errors.push("üëâ Velocity must be a positive number (m/s). Example: 3.5 m/s is common for HVAC ducts.");
  }
  if (!Number.isFinite(propVal) || propVal <= 0) {
    if (mode === "density") errors.push("üëâ Density must be a positive number in kg/m¬≥. Example: 1.225 (air) or 1000 (water).");
    else errors.push("üëâ Specific volume must be a positive number in m¬≥/kg. Example: 0.001 for water.");
  }
  if (errors.length) return showErrors(errors);

  // Range (hard limits) validation with friendly wording
  if (area < 0.00001 || area > 100) {
    errors.push("üëâ Area appears out of expected range. Enter area between 0.00001 m¬≤ (very small tube) and 100 m¬≤ (very large duct).");
  }
  if (velocity < 0.0001 || velocity > 200) {
    errors.push("üëâ Velocity appears out of expected range. Enter velocity between 0.0001 m/s and 200 m/s.");
  }
  if (mode === "density") {
    if (propVal < 0.1 || propVal > 20000) {
      errors.push("üëâ Density seems out of range. Typical densities: air ~1.2 kg/m¬≥, water ~1000 kg/m¬≥. Enter density between 0.1 and 20000 kg/m¬≥.");
    }
  } else {
    // specific volume mode
    if (propVal < 0.00001 || propVal > 100) {
      errors.push("üëâ Specific volume seems out of range. Typical liquid values ~0.001 m¬≥/kg. Enter specific volume between 0.00001 and 100 m¬≥/kg.");
    }
  }
  if (errors.length) return showErrors(errors);

  // Decimal precision warning
  const decimals = (s) => ((String(s).split('.')[1] || '').length);
  if (decimals(area) > 4 || decimals(velocity) > 4 || decimals(propVal) > 4) {
    warnings.push("‚ö†Ô∏è High decimal precision detected ‚Äî round inputs to ‚â§ 4 decimals for reporting consistency.");
  }

  // Cross-field logical checks
  if (mode === "specificVolume" && propVal < 0.0001) {
    warnings.push("‚ö†Ô∏è Specific volume is very small ‚Äî did you intend to enter density (kg/m¬≥) instead?");
  }
  if (mode === "density" && propVal < 5) {
    // œÅ < 5 kg/m¬≥ is extremely low (vacuum/very light gas)
    warnings.push("‚ö†Ô∏è Density is unusually low ‚Äî confirm that units are kg/m¬≥ (air ‚âà 1.2, typical gases 1-2, liquids ~1000).");
  }
  if (area > 10 && velocity > 20) {
    warnings.push("‚ö†Ô∏è Combined very large area and high velocity ‚Äî resulting mass flow may be extremely large; confirm units and intent.");
  }

  // Compute mass flow
  let massFlow = NaN; // kg/s
  if (mode === "density") {
    const rho = propVal; // kg/m¬≥
    massFlow = area * velocity * rho;
  } else {
    const v = propVal; // m¬≥/kg
    if (v === 0) {
      return showErrors(["üëâ Specific volume cannot be zero. Enter a positive number in m¬≥/kg."]);
    }
    massFlow = (area * velocity) / v;
  }

  if (!Number.isFinite(massFlow) || massFlow <= 0) {
    return showErrors(["‚ö†Ô∏è Computed mass flow is invalid. Please re-check your inputs and units."]);
  }

  // Plausibility checks on result
  if (massFlow > 1e6) {
    return showErrors([
      "‚ö†Ô∏è Computed mass flow is implausibly large for typical systems.",
      "üëâ Double-check units (area in m¬≤, velocity in m/s, density in kg/m¬≥ or specific volume in m¬≥/kg)."
    ]);
  }
  if (massFlow > 1000) warnings.push("‚ö†Ô∏è Very large mass flow (>1000 kg/s) ‚Äî likely industrial-scale; confirm system design and safety controls.");
  if (massFlow < 0.0001) warnings.push("‚ö†Ô∏è Very small mass flow (<0.0001 kg/s) ‚Äî may indicate leakage or unit mismatch.");

  // Assessment text
  let status = "";
  if (massFlow < 0.001) status = "üîé Very low mass flow ‚Äî check for leaks or measurement error.";
  else if (massFlow < 10) status = "‚úÖ Normal / small-system flow (typical for HVAC and small pipes).";
  else if (massFlow < 1000) status = "‚ö†Ô∏è Large industrial flow ‚Äî confirm pipe sizing, pumps, and safety controls.";
  else status = "üî¥ Extremely large flow ‚Äî urgently verify units and system design.";

  // Prepare details
  const massFlowPerHour = massFlow * 3600;
  rateEl.textContent = massFlow.toFixed(4);
  rateHourEl.textContent = massFlowPerHour.toFixed(2);

  let details = `<div>Mass Flow: <b>${massFlow.toFixed(4)}</b> kg/s</div>`;
  details += `<div>Equivalent: <b>${massFlowPerHour.toFixed(2)}</b> kg/hr</div>`;

  details += (mode === "density") ? `Density: <b>${propVal}</b> kg/m¬≥</div>` : `Specific volume: <b>${propVal}</b> m¬≥/kg</div>`;

  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }

  feedbackEl.innerHTML = `<div>${status}</div>${details}`;
  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

/* Print helper - kept for parity with design */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}

/* initialize label on load */
updatePropertyLabel();
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /*
===========================================
Mass Flow Rate from Velocity Calculator
===========================================

üìå Formulae:
    Mode 1 ‚Äî Using Density:
        mÃá = A √ó u √ó œÅ

    Mode 2 ‚Äî Using Specific Volume:
        mÃá = (A √ó u) / v

    where:
      mÃá = Mass Flow Rate (kg/s)
      A  = Cross-sectional Area (m¬≤)
      u  = Velocity (m/s)
      œÅ  = Density (kg/m¬≥)
      v  = Specific Volume (m¬≥/kg)

-------------------------------------------
‚úÖ Input Requirements & Validations:

1. Required inputs:
   - Cross-sectional Area (A, m¬≤)
   - Velocity (u, m/s)
   - Either:
       ‚Ä¢ Density (œÅ, kg/m¬≥), OR
       ‚Ä¢ Specific Volume (v, m¬≥/kg)

2. Numeric checks:
   - All inputs must be positive numbers.

3. Hard range checks:
   - Area: 0.00001 ‚Äì 100 m¬≤
   - Velocity: 0.0001 ‚Äì 200 m/s
   - Density: 0.1 ‚Äì 20,000 kg/m¬≥
   - Specific Volume: 0.00001 ‚Äì 100 m¬≥/kg

4. Precision guidance:
   - Warn if > 4 decimals entered.

-------------------------------------------
‚ö†Ô∏è Warnings / Plausibility Checks:

- Input warnings:
  ‚Ä¢ Very small v (<0.0001) in specific-volume mode ‚Üí may be mistaken for density.  
  ‚Ä¢ Density < 5 ‚Üí unusually low, likely light gases or vacuum.  
  ‚Ä¢ Very large area (>10 m¬≤) with high velocity (>20 m/s) ‚Üí may cause unrealistic flows.  

- Result warnings:
  ‚Ä¢ Mass flow > 1000 kg/s ‚Üí large industrial scale.  
  ‚Ä¢ Mass flow < 0.0001 kg/s ‚Üí may indicate leakage or wrong units.  
  ‚Ä¢ Implausible if > 1,000,000 kg/s (error triggered).  

-------------------------------------------
üìä Output:

- Mass Flow Rate (kg/s)  
- Equivalent Mass Flow Rate (kg/hr)  
- Input summary (A, u, œÅ or v)  
- Warning messages (if any)  
- System assessment / interpretation:

    ‚Ä¢ < 0.001 ‚Üí üîé Very low (leakage / error suspected)  
    ‚Ä¢ 0.001 ‚Äì 10 ‚Üí ‚úÖ Normal / small-system flows (HVAC, small pipes)  
    ‚Ä¢ 10 ‚Äì 1000 ‚Üí ‚ö†Ô∏è Large industrial flow (check equipment sizing)  
    ‚Ä¢ > 1000 ‚Üí üî¥ Extremely large (verify units, safety concerns)  

-------------------------------------------
*/ -->
