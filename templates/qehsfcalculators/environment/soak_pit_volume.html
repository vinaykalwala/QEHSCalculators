{% extends 'base.html' %}
{% block title %}Soak Pit Volume Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soak Pit Volume Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
            justify-content:center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Soak Pit Volume Calculator</h1>
        <p>Calculate the required soak pit volume for transformer oil containment in electrical substations.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="oil_volume">Oil Volume of Largest Transformer (litres)</label>
                <input type="number" id="oil_volume" class="form-input" step="any" min="0" placeholder="e.g., 1000">
            </div>

            <button class="calculate-btn" onclick="calculateSoakPitVolume()">Calculate Soak Pit Volume</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Environmental protection illustration">
                <p>This tool calculates soak pit volume for transformer oil containment and environmental protection.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Soak Pit Volume (V)</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="soakPitVolumeValue">0.000</div>
                    <div class="rate-unit">litres</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Soak Pit Volume Calculator</strong> determines the required containment volume for transformer oil in electrical substations. 
            Soak pits are essential safety features designed to contain potential oil leaks from transformers, preventing environmental contamination, 
            fire hazards, and ensuring compliance with safety regulations. Proper sizing is critical for effective containment and environmental protection.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Oil Volume:</strong> The total oil capacity of the largest transformer in the substation (litres). This serves as the baseline for containment design.</li>
            <li><strong>Safety Factor:</strong> A 25% additional capacity (factor = 1.25) applied to ensure adequate containment.</li>
          
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Oil Volume:</strong> Must be greater than 0 litres.</li>
            <li><strong>Minimum Volume:</strong> At least 100 litres for small distribution transformers.</li>
            <li><strong>Maximum Volume:</strong> Should not exceed 100,000 litres without special engineering design.</li>
            <li><strong>Realistic Values:</strong> Input should reflect actual transformer specifications.</li>
            <li><strong>Unit Consistency:</strong> Volume must be in litres.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Soak Pit Volume (V) must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>Soak Pit Volume (V) > 50,000 litres:</strong> ⚠️ Large Containment → Suitable for large power transformers. Verify engineering requirements.</li>
            <li><strong>1,000 litres ≤ Soak Pit Volume (V) ≤ 50,000 litres:</strong> ✅ Typical Range → Appropriate for most substation transformers.</li>
            <li><strong>Soak Pit Volume (V) < 1,000 litres:</strong> ⚠️ Small Containment → Suitable for distribution transformers.</li>
            <li><strong>Soak Pit Volume (V) = 0:</strong> ❌ Impossible scenario → Check input values.</li>
        </ul>
        <p>
            <strong style="color: #1976d2;">Assessment Feedback (as shown in results):</strong><br>
            – <b>Large Containment</b>: ⚠️ Suitable for large power transformers. Verify engineering requirements.<br>
            – <b>Typical Range</b>: ✅ Appropriate for most substation transformers.<br>
            – <b>Small Containment</b>: ⚠️ Suitable for distribution transformers.<br>
            – <b>Safety Factor:</b> 25% additional capacity is applied in all cases.
        </p>
    </div>

    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            A <strong>Soak Pit Volume Calculator</strong> is not tied to one single universal standard; instead, its standard depends on the type of soak pit and local regulations, 
            with designs often following guidelines for septic tanks as seen in IS codes in India for domestic use or specific industrial safety standards for electrical applications. 
            The volume calculation involves a safety factor, typically holding a percentage of the largest transformer's oil volume (e.g., 125%), to ensure effective containment and environmental protection.
        </p>
        <p>
            <b><strong style="color: #1976d2;">Standards and Guidelines</strong></b><br>
            – <strong>Bureau of Indian Standards (BIS):</strong> For domestic soak pits, the design and sizing often align with Indian Standards, particularly IS 2470-1985 (Parts 1 and 2) for septic tanks, which provides guidelines for sizing and construction based on population or wastewater volume.<br>
            – <strong>Industrial Safety Regulations:</strong> In industrial contexts, such as for electrical transformers, soak pit volume is determined by a percentage of the largest transformer's oil capacity, a common safety practice to contain potential leaks (e.g., 125%).<br>
        </p>
        <p>
            <b><strong style="color: #1976d2;">Key Factors in Calculation</strong></b><br>
            – <strong>Oil/Wastewater Volume:</strong> Based on transformer oil or wastewater generation.<br>
            – <strong>Safety Factor:</strong> Margin applied (commonly 25%) for unexpected variations.<br>
            – <strong>Environmental & Safety Compliance:</strong> Ensures protection of soil, groundwater, and compliance with fire safety/environmental laws.<br>
        </p>
        <p>
            <b><strong style="color: #1976d2;">How it Works</strong></b><br>
            1. Identify the source volume (oil/wastewater).<br>
            2. Apply the safety factor (e.g., 1.25).<br>
            3. Calculate pit dimensions (L×W×D) to hold the volume safely.<br>
        </p>
        <p>
            In essence, the specific standard for a soak pit volume calculator depends on its intended application—whether it's a domestic soak pit following general building codes and septic tank standards, 
            or an industrial soak pit designed to meet specific safety and environmental guidelines.
        </p>
    </div>

    <div class="note-card">
        <h3>📝 Conclusion</h3>
        <p>
            The <strong>Soak Pit Volume Calculator</strong> provides a critical tool for designing effective oil containment systems in electrical substations. 
            By applying a 25% safety factor to the largest transformer's oil volume, it ensures adequate capacity for spill containment, environmental protection, 
            and regulatory compliance.  
        </p>
        <p>
            Proper soak pit design prevents soil and groundwater contamination, reduces fire risks, and maintains safe and reliable operation of electrical infrastructure. 
            This calculation represents a fundamental requirement in power system design that balances operational safety with environmental responsibility.
        </p>
    </div>

</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateSoakPitVolume() {
    // Read values
    const oilVolume = parseFloat(document.getElementById("oil_volume").value);

    const soakPitVolumeValueEl = document.getElementById("soakPitVolumeValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (!Number.isFinite(oilVolume)) {
        return showErrors(["👉 Please enter a valid oil volume (numeric)."]);
    }
    
    if (oilVolume <= 0) errors.push("👉 Oil volume must be > 0 litres.");
    
    // Warning for unusual values
    if (oilVolume > 50000) warnings.push("⚠️ Oil volume unusually high (>50,000 litres).");
    if (oilVolume < 100) warnings.push("⚠️ Oil volume unusually low (<100 litres).");

    if (errors.length) return showErrors(errors);

    // Formula: V = 1.25 × Oil Volume
    const V = 1.25 * oilVolume;

    if (!Number.isFinite(V)) {
        return showErrors(["⚠️ Computed soak pit volume is invalid (possible calculation error)."]);
    }

    if (V <= 0) {
        return showErrors(["❌ Soak pit volume must be greater than zero."]);
    }

    // Classification
    let classification, suggestion, color;
    if (V > 50000) {
        classification = "Large Containment";
        suggestion = "⚠️ Suitable for large power transformers. Verify engineering requirements.";
        color = "#e65100";
    } else if (V >= 1000) {
        classification = "Typical Range";
        suggestion = "✅ Appropriate for most substation transformers.";
        color = "#2e7d32";
    } else {
        classification = "Small Containment";
        suggestion = "⚠️ Suitable for distribution transformers.";
        color = "#f9a825";
    }

    // Display result
    soakPitVolumeValueEl.textContent = V.toFixed(2);
    feedbackEl.innerHTML = `
        <div>V = <b>${V.toFixed(2)}</b> litres</div>
        <div>Safety Factor: <b>25%</b> additional capacity</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

Input Validations:

Oil Volume must be > 0 litres (typical range: 100-50,000 litres)

Minimum volume: At least 100 litres for small transformers

Maximum volume: Should not exceed 100,000 litres without special design
-------------------------------------------------------------------------------------------
Output Validations:

V > 50,000 litres: Large containment (warning)

1,000-50,000 litres: Typical range

V < 1,000 litres: Small containment (warning)

Results must be finite and positive

---------------------------------------------------------------------------------------------------
Soak Pit Volume (V) = 1.25 × Oil Volume of Largest Transformer

Where:

Oil Volume is the volume of oil in the largest transformer (in litres)

1.25 is the safety factor (25% buffer)



-->