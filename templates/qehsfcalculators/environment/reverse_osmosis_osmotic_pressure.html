{% extends 'base.html' %}
{% block title %}Reverse Osmosis (Osmotic Pressure Calculator){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reverse Osmosis (Osmotic Pressure Calculator)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Osmotic Pressure Calculator (RO System)</h1>
    <p>Calculate osmotic pressure in reverse osmosis systems to assess membrane performance (result shown in Pa & MPa).</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="osmoticCoefficient">Osmotic Coefficient (φ)</label>
                <input type="number" id="osmoticCoefficient" class="form-input" step="0.01" min="0.1" max="2.0" placeholder="e.g., 1.0" aria-label="Osmotic coefficient">
            </div>

            <div class="form-group">
                <label for="ionNumber">Ions per Molecule (v)</label>
                <input type="number" id="ionNumber" class="form-input" step="1" min="1" placeholder="e.g., 2 for NaCl" aria-label="Ions per molecule">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="moles">Moles of Electrolyte (n, kmol)</label>
                <input type="number" id="moles" class="form-input" step="0.0001" min="0" placeholder="e.g., 0.1" aria-label="Moles of electrolyte">
            </div>

            <div class="form-group">
                <label for="volume">Solvent Volume (V, m³/kmol)</label>
                <input type="number" id="volume" class="form-input" step="0.001" min="0" placeholder="e.g., 1.0" aria-label="Solvent volume">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="temperature">Temperature (T, K)</label>
                <input type="number" id="temperature" class="form-input" step="0.1" min="273" placeholder="e.g., 298" aria-label="Temperature">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateOsmoticPressure()">Calculate</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="reverse osmosis">
            <p>This tool calculates osmotic pressure in RO systems based on entered parameters.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Osmotic Pressure</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="pressureValue">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">Pa</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">System Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator determines the osmotic pressure (Π) in reverse osmosis systems based on electrolyte concentration, temperature, and solution properties. It helps evaluate RO membrane performance, energy requirements, and operational feasibility.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>φ (dimensionless):</strong> Osmotic coefficient, accounts for non-ideal solution behavior.</li>
      <li><strong>v:</strong> Number of ions per molecule.</li>
      <li><strong>n (kmol):</strong> Moles of electrolyte.</li>
      <li><strong>V (m³/kmol):</strong> Solvent volume.</li>
      <li><strong>T (K):</strong> Absolute temperature.</li>
      <li><strong>R (Pa·m³/(kmol·K)):</strong> Gas constant, fixed at 8.314.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>φ:</strong> Required, 0.1 ≤ φ ≤ 2.0 (typical: 0.9–1.1 for dilute solutions).</li>
      <li><strong>v:</strong> Required, ≥ 1, whole number (typical: 2 for NaCl, 3 for CaCl₂).</li>
      <li><strong>n (kmol):</strong> Required, > 0 (typical: 0.001–10).</li>
      <li><strong>V (m³/kmol):</strong> Required, > 0 (typical: 0.01–100).</li>
      <li><strong>T (K):</strong> Required, 273 ≤ T ≤ 373 (typical: 283–303 for water treatment).</li>
      <li><strong>Constraints:</strong> All inputs must be numeric and finite; negatives invalid for v, n, V, or T.</li>
      <li><strong>Advisories:</strong> Extreme values (e.g., φ > 1.5, T > 333 K) flagged for solution complexity or operating condition verification.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📏 Output Validations</h3>
    <ul class="note-list">
      <li><strong>Osmotic Pressure (Π):</strong> Displayed in Pa (exponential) and MPa with 3 decimals.</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>Π < 0.5 MPa: Low Pressure — Brackish water RO, low energy consumption.</li>
          <li>0.5 ≤ Π ≤ 2.5 MPa: Moderate Pressure — Drinking water RO, standard membranes.</li>
          <li>2.5 < Π ≤ 5.0 MPa: High Pressure — Seawater desalination, robust membranes required.</li>
          <li>Π > 5.0 MPa: Very High Pressure — Industrial or extreme RO, pre-treatment recommended.</li>
        </ul>
      </li>
      <li>Warnings triggered for extreme input values or non-physical results.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      Reverse osmosis (RO) osmotic pressure is calculated using various standards and methods, including the Van't Hoff equation (π = CRT) and more complex models like the Pitzer equation for real-world conditions. Industry standards often involve empirical formulas and lookup tables provided by membrane manufacturers, which incorporate specific test conditions and performance data to determine operational pressure requirements, as RO pressure must exceed the calculated osmotic pressure to function.
    </p>
    <p><b>Standard Equations and Models</b></p>
    <p><b>Van't Hoff Equation:</b> A fundamental chemical equation, π = CRT, where π is osmotic pressure, C is molar concentration, R is the ideal gas constant, and T is absolute temperature. This provides a theoretical basis but doesn't fully account for real-world complexities.</p>
    <p><b>Pitzer Equation:</b> A more advanced model used for accurate prediction of osmotic coefficients in complex solutions, often employed in research settings and for high-salinity water.</p>
    <p><b>Industry-Specific Standards</b></p>
    <p><b>Manufacturer-Specific Data:</b> RO system manufacturers typically provide detailed specifications and performance warranties based on their computer projection programs and testing conditions.</p>
    <p><b>Empirical Formulas:</b> Formulas that relate water properties like conductivity to osmotic pressure, such as those found on water treatment websites like Lenntech, provide practical tools for estimating osmotic pressure in specific applications.</p>
    <p><b>Practical Considerations for RO System Design</b></p>
    <p><b>Operational Pressure:</b> The operating pressure in an RO system must be greater than the calculated osmotic pressure to overcome the osmotic gradient and drive water through the membrane.</p>
    <p><b>Factors Influencing Osmotic Pressure:</b> Osmotic pressure is influenced by the concentration of dissolved salts (TDS) and temperature. Manufacturers often provide charts or tools to adjust these calculations for specific operating conditions.</p>
    <p><b>Membrane Performance Data:</b> Membrane element specification sheets from manufacturers include crucial data like nominal operating pressure, temperature (often 25 °C), and performance at specific feed concentrations, which are essential for accurate system design.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides reliable estimates of osmotic pressure for reverse osmosis systems, supporting <strong>membrane performance evaluation</strong>, <strong>energy requirement analysis</strong>, and <strong>system design</strong>. Ensure input values (φ, v, n, V, T) are accurate and validate with manufacturer data, Van't Hoff or Pitzer models, or field measurements for critical applications to ensure efficient and compliant RO operations.
    </p>
  </div>
</div>


<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateOsmoticPressure() {
    const phi = parseFloat(document.getElementById("osmoticCoefficient")?.value.trim());
    const v = parseInt(document.getElementById("ionNumber")?.value.trim());
    const n = parseFloat(document.getElementById("moles")?.value.trim());
    const V = parseFloat(document.getElementById("volume")?.value.trim());
    const T = parseFloat(document.getElementById("temperature")?.value.trim());
    const R = 8.314; // Pa·m³/(kmol·K)

    const errors = [];
    const warnings = [];
    const pressureEl = document.getElementById("pressureValue");
    const feedbackEl = document.getElementById("feedbackContent");

    // Reset previous results
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    // Input Validations
    if (![phi, v, n, V, T].every(Number.isFinite)) {
        errors.push("All inputs must be numeric.");
    }
    if (phi < 0.1 || phi > 2.0) errors.push("Osmotic Coefficient φ must be between 0.1 and 2.0.");
    if (v < 1) errors.push("Ions per molecule (v) must be ≥1.");
    if (n <= 0) errors.push("Moles of electrolyte (n) must be >0.");
    if (V <= 0) errors.push("Solvent volume (V) must be >0.");
    if (T < 273 || T > 373) errors.push("Temperature (T) must be between 273K and 373K.");
    if (errors.length) return showErrors(errors);

    // Osmotic Pressure Calculation
    const Pi = phi * v * (n / V) * R * T; // in Pa
    const PiMPa = Pi / 1e6;               // in MPa

    // Feedback messages based on pressure
    let feedbackMsg = "";
    let feedbackColor = "black";

    if (PiMPa < 0.5) {
        feedbackMsg = `🔹 Low Pressure (${PiMPa.toFixed(2)} MPa): Brackish water RO, low energy.`;
        feedbackColor = "blue";
    } else if (PiMPa >= 0.5 && PiMPa <= 2.5) {
        feedbackMsg = `✅ Moderate Pressure (${PiMPa.toFixed(2)} MPa): Drinking water RO, standard membranes.`;
        feedbackColor = "green";
    } else if (PiMPa > 2.5 && PiMPa <= 5.0) {
        feedbackMsg = `⚠️ High Pressure (${PiMPa.toFixed(2)} MPa): Seawater desalination, robust membranes required.`;
        feedbackColor = "orange";
    } else {
        feedbackMsg = `❗ Very High Pressure (${PiMPa.toFixed(2)} MPa): Industrial or extreme RO; pre-treatment recommended.`;
        feedbackColor = "red";
    }

    // Display both Pa and MPa
    pressureEl.innerHTML = `${Pi.toExponential(2)} Pa <br> (${PiMPa.toFixed(3)} MPa)`;
    feedbackEl.innerHTML = feedbackMsg;
    feedbackEl.style.color = feedbackColor;

    // Show result section
    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
    document.getElementById("resultError").classList.add("hidden");
}

// Print helper
function printReport() {
    const el = document.getElementById('printDate');
    if (el) {
        el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
    }
    window.print();
}
</script>



<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}



<!-- 
📌 Osmotic Pressure Calculator Notes

🔹 Purpose:
    Compute osmotic pressure (Π) of an electrolyte solution using the van’t Hoff relation, adjusted with osmotic coefficient.

🔹 Inputs:
    • φ (phi) → Osmotic coefficient (dimensionless, accounts for non-ideal behavior)
    • v       → Number of ions produced per molecule of solute
    • n       → Moles of electrolyte (kmol)
    • V       → Solvent volume (m³)
    • T       → Absolute temperature (K)
    • R       → Gas constant = 8.314 Pa·m³/(kmol·K)

🔹 Input Validations:
    • All inputs must be numeric
    • Osmotic coefficient: 0.1 ≤ φ ≤ 2.0
    • Ion number: v ≥ 1
    • Moles: n > 0
    • Volume: V > 0
    • Temperature: 273K ≤ T ≤ 373K
    • Errors stop calculation and display message

🔹 Core Calculation:
    • Osmotic Pressure: 
        Π = φ × v × (n / V) × R × T   (in Pascals)
    • Convert to MPa: Π(MPa) = Π / 1e6

🔹 Output Classification:
    • Π < 0.5 MPa → 🔹 Low pressure — brackish water RO, low energy
    • 0.5 ≤ Π ≤ 2.5 MPa → ✅ Moderate pressure — drinking water RO, standard membranes
    • 2.5 < Π ≤ 5.0 MPa → ⚠️ High pressure — seawater desalination, robust membranes needed
    • Π > 5.0 MPa → ❗ Very high pressure — industrial RO, pre-treatment recommended

🔹 Display:
    • Shows osmotic pressure in scientific notation
    • Provides color-coded feedback (blue, green, orange, red)
    • Displays input warnings if values are out of normal range
    • Printable report with date

-->
