{% extends 'base.html' %}
{% block title %}Arithmetic Mean Temperature Difference (AMTD) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arithmetic Mean Temperature Difference (AMTD) Calculatorr</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
      

        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover¬†effect¬†*/
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

       
    </style>
</head>
<body>

      <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

<div class="calculator-container printable" id="printArea">

  {% include "includes/print_header_footer.html" %}

<div class="calculator-header">
  <h1>Arithmetic Mean Temperature Difference (AMTD) Calculator</h1>
  <p>Calculate the temperature difference between steam and secondary fluid in a heat exchanger.</p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Data</h2>
    <div class="form-group">
      <label for="steamTemperature">Steam Temperature (¬∞C) <sub>Ts</sub></label>
      <input type="number" id="steamTemperature" class="form-input" min="0" placeholder="e.g., 150">
    </div>
    <div class="form-group">
      <label for="secondaryFluidIn">Secondary Fluid Inlet Temperature (¬∞C) <sub>T‚ÇÅ</sub></label>
      <input type="number" id="secondaryFluidIn" class="form-input" min="0" placeholder="e.g., 30">
    </div>
    <div class="form-group">
      <label for="secondaryFluidOut">Secondary Fluid Outlet Temperature (¬∞C) <sub>T‚ÇÇ</sub></label>
      <input type="number" id="secondaryFluidOut" class="form-input" min="0" placeholder="e.g., 40">
    </div>
    
    <button class="calculate-btn" onclick="calculateAMTD()">Calculate AMTD</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <!-- Placeholder -->
    <div class="result-placeholder" id="placeholder">
      <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="AMTD illustration">
      <p>This tool will calculate the <strong>Arithmetic Mean Temperature Difference (AMTD)</strong>. Enter your data to see results here.</p>
    </div>

    <!-- Error Box -->
    <div class="result-error hidden" id="resultError">
      <div class="error-icon">‚ùå</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <!-- Result Output -->
    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>AMTD Result</h2>
      </div>

      <div class="rate-display">
      <div class="rate-value" id="rateValue">0.00</div>
      <div class="rate-label" style="color:#2980b9; font-size:18px; font-weight:bold;">¬∞C</div>
      </div> 
      
      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>

      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      The <strong>Arithmetic Mean Temperature Difference (AMTD)</strong> is used to approximate the 
      average temperature driving force in heat exchangers. It is a simplified method compared 
      to LMTD and is useful for basic analysis.
    </p>
  </div>

  <div class="note-card">
    <h3>‚öôÔ∏è Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Steam Temperature (Ts):</strong> The temperature of the steam in the exchanger.</li>
      <li><strong>Secondary Fluid Inlet (T‚ÇÅ):</strong> Temperature of the fluid entering.</li>
      <li><strong>Secondary Fluid Outlet (T‚ÇÇ):</strong> Temperature of the fluid leaving.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üìè Input Validations</h3>
    <ul class="note-list">
      <li>All temperatures must be <strong>positive numbers</strong> (¬∞C).</li>
      <li>Steam temperature (Ts) should typically be between <strong>50¬∞C and 500¬∞C</strong>.</li>
      <li>Secondary fluid inlet/outlet temperatures should be between <strong>0¬∞C and 300¬∞C</strong>.</li>
      <li>Steam temperature (Ts) must be higher than both T‚ÇÅ and T‚ÇÇ.</li>
      <li>For heating applications: <strong>T‚ÇÇ must be greater than T‚ÇÅ</strong>.</li>
      <li>AMTD should not be negative or zero; if so, recheck input values.</li>
      <li>Decimal values allowed up to <strong>2 places</strong>.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üî• Importance</h3>
    <p>
      AMTD helps engineers estimate the efficiency of heat exchangers. 
      Higher AMTD values indicate greater driving force for heat transfer, while lower 
      values may suggest reduced efficiency or fouling in the system.
    </p>
  </div>
</div>

<script>
function calculateAMTD() {
  const steamTemperatureInput = document.getElementById('steamTemperature')?.value.trim() ?? "";
  const secondaryFluidInInput = document.getElementById('secondaryFluidIn')?.value.trim() ?? "";
  const secondaryFluidOutInput = document.getElementById('secondaryFluidOut')?.value.trim() ?? "";

  const errorBox = document.getElementById('resultError');
  const errorMessage = document.getElementById('errorMessage');
  const placeholder = document.getElementById('placeholder');
  const resultValue = document.getElementById('resultValue');

  if (errorBox) errorBox.classList.add('hidden');
  if (errorMessage) errorMessage.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required fields
  if (steamTemperatureInput === "") errors.push("üëâ Please enter the steam temperature.");
  if (secondaryFluidInInput === "") errors.push("üëâ Please enter the inlet temperature.");
  if (secondaryFluidOutInput === "") errors.push("üëâ Please enter the outlet temperature.");

  if (errors.length > 0) {
    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    return;
  }

  // Parse numbers
  const Ts = parseFloat(steamTemperatureInput);
  const T1 = parseFloat(secondaryFluidInInput);
  const T2 = parseFloat(secondaryFluidOutInput);

  if (!Number.isFinite(Ts) || !Number.isFinite(T1) || !Number.isFinite(T2)) {
    errorMessage.innerHTML = "‚ö†Ô∏è Please enter valid numeric values.";
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    return;
  }

  // Range validations
  if (Ts < 50 || Ts > 500) {
    errors.push("‚ö†Ô∏è Steam temperature must be between 50¬∞C and 500¬∞C.");
  }
  if (T1 < 0 || T1 > 300) {
    errors.push("‚ö†Ô∏è Inlet temperature must be between 0¬∞C and 300¬∞C.");
  }
  if (T2 < 0 || T2 > 300) {
    errors.push("‚ö†Ô∏è Outlet temperature must be between 0¬∞C and 300¬∞C.");
  }

  if (errors.length > 0) {
    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    return;
  }

  // Logical checks
  if (!(Ts > T1 && Ts > T2)) {
    errorMessage.innerHTML = "‚ö†Ô∏è Steam temperature must be higher than both inlet and outlet fluid temperatures.";
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    return;
  }

  if (!(T2 > T1)) {
    errorMessage.innerHTML = "‚ö†Ô∏è For heating, outlet (T‚ÇÇ) must be greater than inlet (T‚ÇÅ).";
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    return;
  }

  // Calculate AMTD
  const AMTD = Ts - ((T1 + T2) / 2);
  if (AMTD <= 0) {
    errorMessage.innerHTML = "‚ö†Ô∏è Invalid AMTD result. Check your input values.";
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    return;
  }

  const AMTD_display = AMTD.toFixed(2);

  // Feedback
  let feedback = "";
  if (AMTD < 5) feedback = "‚ö†Ô∏è Very low AMTD. Heat transfer efficiency may be poor.";
  else if (AMTD <= 15) feedback = "‚úÖ Moderate AMTD. Acceptable for many applications.";
  else feedback = "üåü High AMTD. Good driving force for heat transfer.";

  // Show results
  document.getElementById('rateValue').textContent = AMTD_display;
  document.getElementById('feedbackContent').innerHTML = feedback;
  errorBox.classList.add("hidden");
  placeholder.classList.add('hidden');
  resultValue.classList.remove('hidden');
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    el.textContent = now.toLocaleDateString('en-IN', options);
  }
  window.print();
}
</script>



<script src="{% static 'js/print.js' %}"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
{% endblock %}




<!--
AMTD (Average Minimum Travel Distance) Calculator ‚Äì QEHS / Fire Safety Reference

Formula:
---------
AMTD = A / P

Where:
- A = Total area of the floor (m¬≤)
- P = Perimeter of the floor (m)

Units:
- AMTD result is expressed in meters (m).

Validations:
-------------
1. Area (A):
   ‚úî Must be a positive number
   ‚úî Cannot be zero or negative
   ‚úî Input unit: square meters (m¬≤)

2. Perimeter (P):
   ‚úî Must be a positive number
   ‚úî Cannot be zero (division by zero error)
   ‚úî Input unit: meters (m)

3. Output (AMTD):
   ‚úî Must be a finite, non-negative number
   ‚úî Display result rounded to 2 decimal places
   ‚úî If inputs are invalid, show error message

Usage / Applications:
----------------------
- Fire Safety Design ‚Üí Estimating average minimum travel distance for evacuation
- Risk Assessment ‚Üí Ensuring compliance with NBC (National Building Code) & NFPA guidelines
- QEHS ‚Üí Emergency route planning and audits
- Building Layouts ‚Üí Optimizing escape routes and ensuring safety standards

Compliance Notes:
------------------
- AMTD is typically compared against allowable maximum travel distances (e.g., 30m‚Äì45m depending on occupancy type as per NBC/NFPA).
- If AMTD > allowable limit ‚Üí redesign of escape routes may be required.
-->
