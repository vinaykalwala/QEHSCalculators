{% extends 'base.html' %}
{% block title %}Plume Rise Height (ΔH) Calculator Under Stable & Calm Conditions{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plume Rise Height (ΔH) Calculator Under Stable & Calm Conditions</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Plume Rise Height (ΔH) Calculator Under Stable & Calm Conditions</h1>
    <p>Calculate the <strong>Plume Rise Height (ΔH in meters)</strong> from a stack or chimney under stable and calm atmospheric conditions.</p>
</div>

<div class="calc-content">
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="F">Buoyancy Flux Parameter (F in m⁴/s²)</label>
            <input type="number" id="F" class="form-input" min="0.0001" step="any" placeholder="e.g., 0.5">
        </div>

        <div class="form-group">
            <label for="S">Atmospheric Stability Parameter (S, dimensionless)</label>
            <input type="number" id="S" class="form-input" min="0.0001" step="any" placeholder="e.g., 0.02">
        </div>

        <button class="calculate-btn" onclick="calculatePlumeRise()">Calculate Plume Rise</button>
    </div>

    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Plume rise illustration">
            <p>This tool will calculate the <strong>Plume Rise Height (ΔH in meters)</strong>.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Plume Rise Height</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">meters</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<div class="note-section">

    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            Estimates the <strong>Plume Rise Height (ΔH)</strong> in meters based on stack buoyancy and atmospheric stability under stable and calm conditions. 
            This is important for environmental impact assessments, air pollution modeling, and safety analysis.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><b>F (Buoyancy Flux Parameter):</b> m⁴/s² — represents the buoyant force of the stack emissions</li>
            <li><b>S (Atmospheric Stability Parameter):</b> dimensionless — represents atmospheric stability</li>
            <li><b>ΔH (Plume Rise Height):</b> meters — calculated using the empirical formula</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>F must be positive (≥ 0.0001 m⁴/s²) and physically realistic. Typical industrial range: 0.001–1000.</li>
            <li>S must be positive (≥ 0.0001) and representative of atmospheric stability.</li>
            <li>Zero or negative values are invalid.</li>
            <li>Extremely high F or low S may result in ΔH &gt; 500 m — verify inputs.</li>
            <li>Extremely low F or high S may result in ΔH &lt; 1 m — may indicate poor dispersion.</li>
            <li>Formula valid only for stable, calm, neutral-to-inversion atmospheric conditions.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>ΔH (Plume Rise Height) displayed in meters</li>
            <li>Result must be finite and physically realistic</li>
            <li>Example assessment/feedback along with result:
                <ul>
                    <li>ΔH (Plume Rise Height) &gt; 200 m → ✅ High Plume Rise — strong buoyancy or low stability</li>
                    <li>50 ≤ ΔH (Plume Rise Height) ≤ 200 m → ⚠️ Moderate Plume Rise — likely mild stability</li>
                    <li>ΔH (Plume Rise Height) &lt; 50 m → ❌ Low Plume Rise — may indicate poor dispersion</li>
                </ul>
            </li>
            <li>Buoyancy Flux (F) and Atmospheric Stability (S) values are displayed along with ΔH</li>
            <li>Warnings displayed for extreme ΔH &lt; 1 m or ΔH &gt; 500 m</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            The plume rise calculator, particularly for stable and calm conditions, is not associated with a single universal standard but is based on G. A. Briggs's empirical equations, widely adopted and integrated into various regulatory guidelines and software. Different variations exist for different atmospheric conditions (stable, unstable, neutral), and for calm conditions specifically, a separate equation is used.
        </p>
        <p><b>Key Aspects:</b></p>
        <ul class="note-list">
            <li>G. A. Briggs's Work: Empirical equations derived from experimental data and theoretical analysis.</li>
            <li>Atmospheric Stability Categories: Equations categorized by stability (unstable, neutral, stable) and wind speed.</li>
            <li>Calm Conditions: Special equations for very low wind speeds, adjusting for lack of horizontal wind.</li>
            <li>Regulatory Use: Briggs's equations are referenced or incorporated into air quality regulations and guidelines worldwide.</li>
        </ul>
        <p><b>How the Calculator Works:</b></p>
        <ul class="note-list">
            <li>Inputting Data: Source parameters (stack height, exit velocity, exit temperature) and atmospheric parameters (wind speed, temperature, stability class).</li>
            <li>Applying the Appropriate Equation: Calculator selects formula based on wind speed and atmospheric stability, including calm conditions.</li>
            <li>Calculating Plume Rise (ΔH): Output is additional height the plume rises above the stack, added to stack height for effective stack height.</li>
        </ul>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>🔎 Conclusion</h3>
        <p>
            This calculator provides the plume rise height ΔH for given buoyancy flux and atmospheric stability under calm, stable conditions. Results include ΔH, input values (F and S), and a feedback/assessment message indicating whether the plume rise is low, moderate, or high. Warnings are shown for extreme values, ensuring results are physically realistic and useful for environmental modeling and compliance purposes.
        </p>
    </div>

</div>


<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculatePlumeRise() {
    const Fraw = document.getElementById("F").value.trim();
    const Sraw = document.getElementById("S").value.trim();

    const errorBox = document.getElementById("resultError");
    const resultValue = document.getElementById("resultValue");
    const rateEl = document.getElementById("rateValue");
    const feedbackEl = document.getElementById("feedbackContent");
    const placeholder = document.getElementById("placeholder");

    errorBox.classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Required inputs
    if (Fraw === "") errors.push("👉 Please enter the Buoyancy Flux Parameter (F).");
    if (Sraw === "") errors.push("👉 Please enter the Atmospheric Stability Parameter (S).");
    if (errors.length) return showErrors(errors);

    const F = parseFloat(Fraw);
    const S = parseFloat(Sraw);

    // Input validations
    if (!Number.isFinite(F) || F < 0.0001) errors.push("👉 F must be ≥ 0.0001 m⁴/s².");
    if (!Number.isFinite(S) || S < 0.0001) errors.push("👉 S must be ≥ 0.0001.");
    if (F > 1000) warnings.push("⚠️ F is unusually high; check industrial realism.");
    if (S > 10) warnings.push("⚠️ S is unusually high; verify atmospheric stability units.");

    if (errors.length) return showErrors(errors);

    // ΔH calculation
    const deltaH = 5 * Math.pow(F, 0.25) * Math.pow(S, -0.375);

    // Output assessment
    let statusMsg = "";
    if (deltaH > 200) statusMsg = "✅ High Plume Rise — strong buoyancy or low stability.";
    else if (deltaH >= 50) statusMsg = "⚠️ Moderate Plume Rise — likely mild stability.";
    else statusMsg = "❌ Low Plume Rise — may indicate poor dispersion.";

    // Edge case warnings
    if (deltaH < 1) warnings.push("⚠️ ΔH < 1 m — negligible plume rise.");
    if (deltaH > 500) warnings.push("⚠️ ΔH > 500 m — unusually high plume rise; check inputs.");

    let details = `<div>Plume Rise Height (ΔH): <b>${deltaH.toFixed(2)}</b> meters</div>`;
    if (warnings.length) details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;

    rateEl.textContent = deltaH.toFixed(2);
    feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
    errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 
📌 Plume Rise Calculator (F / S method) Notes

🔹 Formula Used:
    ΔH = 5 × F^0.25 × S^-0.375
    where:
      ΔH = plume rise height (m)
      F   = buoyancy flux parameter (m⁴/s²)
      S   = atmospheric stability parameter (dimensionless)

🔹 Input Validations:
    • F (Buoyancy Flux):
        - Must be numeric
        - F ≥ 0.0001 m⁴/s²
        - F > 1000 → warning: unusually high, check realism
    • S (Atmospheric Stability):
        - Must be numeric
        - S ≥ 0.0001
        - S > 10 → warning: unusually high, verify units

🔹 Output Validations / Classification:
    • ΔH displayed in meters (2 decimal places)
    • Warnings:
        - ΔH < 1 → negligible plume rise
        - ΔH > 500 → unusually high, check inputs
    • Assessment:
        - ΔH > 200 → ✅ High Plume Rise — strong buoyancy or low stability
        - 50 ≤ ΔH ≤ 200 → ⚠️ Moderate Plume Rise — likely mild stability
        - ΔH < 50 → ❌ Low Plume Rise — may indicate poor dispersion
    • Display includes input values (F, S) and any warnings
-->
