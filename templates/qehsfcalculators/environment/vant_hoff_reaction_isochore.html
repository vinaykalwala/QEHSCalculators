{% extends 'base.html' %}
{% block title %}Van't Hoff Reaction Isochore Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Van't Hoff Reaction Isochore Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">

{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Van't Hoff Reaction Isochore Calculator</h1>
    <p>Calculate temperature dependence of equilibrium constants using the Van't Hoff equation.</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="k1">Equilibrium Constant at T₁ (K₁)</label>
                <input type="number" id="k1" class="form-input" step="any" min="0" placeholder="e.g., 0.5" aria-label="Equilibrium constant at T1">
            </div>

            <div class="form-group">
                <label for="k2">Equilibrium Constant at T₂ (K₂)</label>
                <input type="number" id="k2" class="form-input" step="any" min="0" placeholder="e.g., 2.0" aria-label="Equilibrium constant at T2">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="t1">Initial Temperature (T₁, K)</label>
                <input type="number" id="t1" class="form-input" step="any" min="0" placeholder="e.g., 298" aria-label="Initial temperature">
            </div>

            <div class="form-group">
                <label for="t2">Final Temperature (T₂, K)</label>
                <input type="number" id="t2" class="form-input" step="any" min="0" placeholder="e.g., 350" aria-label="Final temperature">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="enthalpy">Enthalpy Change (ΔH, J/mol)</label>
                <input type="number" id="enthalpy" class="form-input" step="any" placeholder="e.g., 50000" aria-label="Enthalpy change">
            </div>

            <div class="form-group">
                <label for="tolerance">Tolerance</label>
                <input type="number" id="tolerance" class="form-input" step="any" min="0.0001" value="0.01" placeholder="e.g., 0.01" aria-label="Tolerance">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateVanTHoff()">Calculate</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Chemical equilibrium illustration">
            <p>This tool calculates temperature dependence of equilibrium constants using the Van't Hoff equation.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Van't Hoff Equation Results</h2>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Calculation Results</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator determines the temperature dependence of equilibrium constants using the Van't Hoff equation. 
            It's essential for predicting how chemical equilibria shift with temperature changes, which is crucial in environmental chemistry, industrial processes, and safety assessments.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>K₁:</strong> Equilibrium constant at initial temperature T₁.</li>
            <li><strong>K₂:</strong> Equilibrium constant at final temperature T₂.</li>
            <li><strong>T₁, T₂:</strong> Initial and final temperatures in Kelvin (K).</li>
            <li><strong>ΔH:</strong> Enthalpy change of the reaction (J/mol), heat absorbed or released.</li>
            <li><strong>R:</strong> Universal gas constant (8.314 J/mol·K).</li>
            <li><strong>Tolerance:</strong> Acceptable margin of error when comparing calculated vs expected values.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Equilibrium Constants (K₁, K₂):</strong> Must be <em>greater than 0</em> (typical range: 1e-10 to 1e10).</li>
            <li><strong>Temperatures (T₁, T₂):</strong> Must be <em>greater than 0</em> and realistic for chemical systems (typically 200-2000 K).</li>
            <li><strong>Enthalpy Change (ΔH):</strong> Typically ranges from -200,000 to 200,000 J/mol for most reactions.</li>
            <li><strong>Tolerance:</strong> Must be <em>greater than 0</em>; typically 0.001 to 0.1 for validation.</li>
            <li><strong>Temperature Difference:</strong> T₁ and T₂ cannot be equal (division by zero prevention).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li><strong>ln(K₂/K₁):</strong> Shows how much the equilibrium constant changes with temperature.</li>
            <li><strong>Expected Change:</strong> Value predicted by the Van’t Hoff equation using ΔH.</li>
            <li><strong>Difference (Δ):</strong> Gap between actual and expected values.
                <ul>
                    <li>✅ If Δ ≤ tolerance → Equation is satisfied (inputs are consistent).</li>
                    <li>❌ If Δ > tolerance → Inputs don’t match the equation (check data).</li>
                </ul>
            </li>
            <li><strong>Estimated ΔH:</strong> Heat energy calculated directly from K₁, K₂, T₁, and T₂.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            A Van't Hoff Reaction Isochore Calculator relates to the thermodynamic standard state, as it relies on the standard enthalpy change (ΔH°) and the relationship between the equilibrium constant (Keq) and temperature. The isochore specifically describes the temperature dependence of the equilibrium constant, which is defined under standard conditions.
        </p>
        <ul class="note-list">
            <li><strong>Standard Enthalpy Change (ΔH°):</strong> Derived using the standard enthalpy change of the reaction, where the degree symbol (°) indicates a standard state.</li>
            <li><strong>Equilibrium Constant (Keq):</strong> Relates the change in the equilibrium constant to temperature, defined under standard state conditions.</li>
            <li><strong>Thermodynamic System:</strong> Involves the standard Gibbs free energy (ΔG°) and the Gibbs-Helmholtz equation, both defined using standard thermodynamic properties.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔚 Conclusion</h3>
        <p>
            The <strong>Van’t Hoff Reaction Isochore Calculator</strong> helps predict how chemical reactions shift with temperature. 
            A positive ΔH indicates an <em>endothermic</em> reaction (favored at high temperatures), while a negative ΔH indicates an <em>exothermic</em> reaction (favored at low temperatures).  
            By checking if the equation is satisfied within tolerance, users can verify whether their equilibrium data and enthalpy values are consistent.  
            This tool is valuable for <strong>reaction optimization, safety checks, and process efficiency improvements</strong>.
        </p>
    </div>

</div>


<script>
    function calculateVanTHoff() {
        // Get input values
        const k1 = parseFloat(document.getElementById('k1').value);
        const k2 = parseFloat(document.getElementById('k2').value);
        const t1 = parseFloat(document.getElementById('t1').value);
        const t2 = parseFloat(document.getElementById('t2').value);
        const enthalpy = parseFloat(document.getElementById('enthalpy').value);
        const tolerance = parseFloat(document.getElementById('tolerance').value);
    
        // Get display elements
        const placeholder = document.getElementById('placeholder');
        const resultError = document.getElementById('resultError');
        const resultValue = document.getElementById('resultValue');
        const errorMessage = document.getElementById('errorMessage');
        const feedbackContent = document.getElementById('feedbackContent');
    
        // Hide all result sections initially
        placeholder.classList.add('hidden');
        resultError.classList.add('hidden');
        resultValue.classList.add('hidden');
    
        // Validate inputs
        if (isNaN(k1) || k1 <= 0) {
            showError('Equilibrium Constant at T₁ (K₁) must be greater than 0 — a rate constant cannot be zero or negative.');
            return;
        }
        if (isNaN(k2) || k2 <= 0) {
            showError('Equilibrium Constant at T₂ (K₂) must be greater than 0 — rate constants represent reaction speed and must be positive.');
            return;
        }
        if (isNaN(t1) || t1 <= 0) {
            showError('Initial Temperature T₁ must be greater than 0 — absolute temperature in Kelvin must be a positive value.');
            return;
        }
        if (isNaN(t2) || t2 <= 0) {
            showError('Final Temperature T₂ must be greater than 0 — Kelvin scale starts at absolute zero.');
            return;
        }
        if (t1 === t2) {
            showError('T₁ and T₂ cannot be equal — no change in temperature means the Van\'t Hoff equation has no effect.');
            return;
        }
        if (isNaN(enthalpy)) {
            showError('Enthalpy Change ΔH must be a number — enthalpy is required to evaluate temperature dependence.');
            return;
        }
        if (isNaN(tolerance) || tolerance <= 0) {
            showError('Tolerance must be a positive number.');
            return;
        }
        
        // Validate realistic ranges
        if (k1 > 1e10 || k1 < 1e-10) {
            showError('K₁ value appears to be outside typical equilibrium constant range (1e-10 to 1e10). Please verify your input.');
            return;
        }
        
        if (k2 > 1e10 || k2 < 1e-10) {
            showError('K₂ value appears to be outside typical equilibrium constant range (1e-10 to 1e10). Please verify your input.');
            return;
        }
        
        if (t1 < 200 || t1 > 2000) {
            showError('T₁ value appears to be outside typical temperature range for chemical systems (200-2000 K). Please verify your input.');
            return;
        }
        
        if (t2 < 200 || t2 > 2000) {
            showError('T₂ value appears to be outside typical temperature range for chemical systems (200-2000 K). Please verify your input.');
            return;
        }
        
        if (Math.abs(enthalpy) > 500000) {
            showError('ΔH value appears to be unusually large. Most reactions have enthalpy changes between -200,000 and 200,000 J/mol. Please verify your input.');
            return;
        }

        const R = 8.314; // J/mol·K

        // Van't Hoff calculation
        const lnKRatio = Math.log(k2 / k1);
        const deltaInvT = (1 / t2) - (1 / t1);
        const expectedLnKRatio = -(enthalpy / R) * deltaInvT;
        const calculatedDeltaH = -(lnKRatio / deltaInvT) * R;

        const difference = Math.abs(lnKRatio - expectedLnKRatio);

        // Format helper
        function formatScientific(num) {
            if (num === 0) return "0";
            const exponent = Math.floor(Math.log10(Math.abs(num)));
            const base = (num / Math.pow(10, exponent)).toFixed(4);
            return `${base} × 10<sup>${exponent}</sup>`;
        }

        // Display results
        feedbackContent.innerHTML = `
            <ul style="margin-top: 0; padding-left: 20px;">
                <li><strong>Change in Equilibrium (ln(K₂ / K₁)):</strong> ${lnKRatio.toFixed(4)} — This shows how the equilibrium constant changed with temperature.</li>
                <li><strong>Expected Change Based on ΔH:</strong> ${expectedLnKRatio.toFixed(4)} — This is what the Van't Hoff equation predicts for the same temperature change and enthalpy.</li>
                <li><strong>Difference (Δ):</strong> ${formatScientific(difference)} — The smaller this value, the closer your inputs are to satisfying the equation.</li>
                <li><strong>Estimated Enthalpy Change (ΔH):</strong> ${calculatedDeltaH.toFixed(2)} J/mol — This is the heat energy change calculated from your data.</li>
            </ul>
        `;
        
        if (difference <= tolerance) {
            feedbackContent.innerHTML += `<p style="color: green; font-weight: bold; margin-top: 10px;">✅ The Van't Hoff equation is satisfied within the given tolerance.</p>`;
        } else {
            feedbackContent.innerHTML += `<p style="color: red; font-weight: bold; margin-top: 10px;">❌ The Van't Hoff equation is NOT satisfied within the given tolerance.</p>`;
        }
        
        // Show result section
        resultValue.classList.remove('hidden');
        
        function showError(message) {
            errorMessage.textContent = message;
            resultError.classList.remove('hidden');
        }
    }
    
    function printReport() {
        window.print();
    }
</script>

  <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
------------------------------------------------------------------------------------------
Input Validations:

All inputs must be valid numbers

Equilibrium constants must be > 0

Temperatures must be > 0 and realistic (200-2000 K)

T₁ and T₂ cannot be equal (prevents division by zero)

Tolerance must be > 0

Enthalpy values are checked for realistic ranges
----------------------------------------------------------------------------------
Output Validations:

Calculates ln(K₂/K₁) ratio

Compares with expected value from Van't Hoff equation

Shows difference between calculated and expected values

Estimates ΔH from the input data

Validates if the equation is satisfied within tolerance
----------------------------------------------------------------------------------------------------
Edge Cases:

Division by zero when T₁ = T₂

Extremely large or small equilibrium constants

Unrealistic temperature values

Unusually large enthalpy values
-----------------------------------------------------------------------------------------------
Formula Implementation:

Uses the core Van't Hoff equation: ln(K₂/K₁) = - (ΔH/R) * (1/T₂ - 1/T₁)

Calculates expected ratio based on input ΔH

Calculates ΔH based on equilibrium constants

Compares results with tolerance for validation

From the provided code, the core formula being used is the Van't Hoff Equation (Reaction Isochore).
--------------------------------------------------------------------------------------------------------
Core Van't Hoff Equation
The formula that relates the equilibrium constants at two different temperatures to the enthalpy change is:

ln(K₂ / K₁) = - (ΔH / R) * (1/T₂ - 1/T₁)

Rearranged Formulas from the Code
The code also calculates other values based on rearrangements of this core formula:

1. Expected Ratio (for validation):
expectedLnKRatio = - (ΔH / R) * ( (1/T₂) - (1/T₁) )

2. Calculated Enthalpy (if solving for ΔH):
calculatedΔH = - ( ln(K₂ / K₁) / ( (1/T₂) - (1/T₁) ) ) * R



-->