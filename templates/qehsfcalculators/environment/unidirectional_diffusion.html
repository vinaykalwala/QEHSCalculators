{% extends 'base.html' %}
{% block title %}Unidirectional Diffusion Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unidirectional Diffusion Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
                .btn-container {
    display: flex;
    justify-content: center; /* Horizontally center */
    margin: 30px 0;
}

.back-btn {
    background:linear-gradient(#1560bd,#000040); /* Dark navy background */
    color: #ffffff; /* White text */
    border: 2px solid #1560bd; /* Highlight border */
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    text-decoration: none; /* Remove underline for link */
    transition: all 0.3s ease;
    cursor: pointer;
}

.back-btn:hover {
    background-color: #1560bd; /* Highlight on hover */
    color: #ffffff;
    border-color: #000040;
    transform: scale(1.05); /* Subtle hover effect */
}

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            {% comment %} max-width: 700px; {% endcomment %}
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            {% comment %} display: flex; {% endcomment %}
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            {% comment %} overflow-y: auto; {% endcomment %}
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        /* Input rows for side-by-side fields */
         .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
            {% comment %} margin-bottom: 15px; {% endcomment %}
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
       
    </style>
</head>
<body>
    <div class="btn-container">
    <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
</div>
   <div class="calculator-container printable" id="printArea">

    <!-- Include header/footer for print -->
    {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Unidirectional Diffusion Calculator</h1>
            <p>Calculate the molar flux for unidirectional diffusion through a stagnant medium</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="diffusivity">Diffusion Coefficient (D) [m²/s]</label>
                        <input type="number" id="diffusivity" class="form-input" min="0.00000001" step="any" placeholder="e.g., 0.000025">
                    </div>
                    <div class="form-group">
                        <label for="totalPressure">Total Pressure (P) [Pa]</label>
                        <input type="number" id="totalPressure" class="form-input" min="0.0001" step="any" placeholder="e.g., 101325">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="pressure1">Partial Pressure at Point 1 (p<sub>A₁</sub>) [Pa]</label>
                        <input type="number" id="pressure1" class="form-input" step="any" placeholder="e.g., 50000">
                    </div>
                    <div class="form-group">
                        <label for="pressure2">Partial Pressure at Point 2 (p<sub>A₂</sub>) [Pa]</label>
                        <input type="number" id="pressure2" class="form-input" step="any" placeholder="e.g., 10000">
                    </div>
                </div>
                <div class="input-row">
                    <div class="form-group">
                        <label for="position1">Position 1 (x₁) [m]</label>
                        <input type="number" id="position1" class="form-input" step="any" placeholder="e.g., 0.1">
                    </div>
                    <div class="form-group">
                        <label for="position2">Position 2 (x₂) [m]</label>
                        <input type="number" id="position2" class="form-input" step="any" placeholder="e.g., 0.5">
                    </div>
                </div>
                <div class="form-group">
                    <label for="temperature">Temperature (T) [K]</label>
                    <input type="number" id="temperature" class="form-input" min="0.1" step="any" placeholder="e.g., 298">
                </div>
                
                <button class="calculate-btn" onclick="calculateDiffusion()">Calculate Diffusion Flux</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Diffusion illustration">
                    <p>This tool will calculate the <strong>Molar Flux</strong> for unidirectional diffusion. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Molar Flux</h2>
                    </div>
                    <div class="rate-display">
                    <div class="rate-value" id="rateValue">0.00</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">mol/m²·s</div></div>

                    <div class="safety-meter">
                        <div class="meter-fill" id="meterFill"></div>
                    </div>
                    <div class="meter-labels">
                        <span>Slow</span><span>Moderate</span><span>Significant</span><span>High</span><span>Very High</span>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Diffusion Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

 <div class="note-section">

    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Unidirectional Diffusion Calculator</strong> determines the molar flux for 
            steady-state diffusion of one component through a stagnant, non-diffusing second component. 
            This is essential for environmental systems where gases diffuse through stationary media, 
            such as in soil vapor extraction, landfill gas management, and air pollution control systems.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>D (Diffusion Coefficient):</strong> Measure of molecular mobility [m²/s].</li>
            <li><strong>P (Total Pressure):</strong> System pressure [Pa].</li>
            <li><strong>p<sub>A₁</sub>, p<sub>A₂</sub> (Partial Pressures):</strong> Component pressures at two positions [Pa].</li>
            <li><strong>x₁, x₂ (Positions):</strong> Distance points [m] defining the diffusion path length.</li>
            <li><strong>T (Temperature):</strong> Absolute temperature [K] affecting molecular motion.</li>
        </ul>
    </div>

   <!-- Input Validation Rules -->
<div class="note-card">
    <h3>✅ <strong>Input Validation Rules</strong></h3>
    <ul class="note-list">
        <li><strong>D (Diffusion Coefficient):</strong> Must be &gt; 0. Typical: 1×10⁻¹⁰ – 1×10⁻⁴ m²/s. Warn if &lt; 1×10⁻¹⁰ or &gt; 1×10⁻³.</li>
        <li><strong>P (Total Pressure):</strong> Must be &gt; 0 Pa. Safe range: 1000 – 1,000,000 Pa.</li>
        <li><strong>p<sub>A₁</sub>, p<sub>A₂</sub> (Partial Pressures):</strong> Must be ≥ 0 and ≤ P. Both cannot equal P.</li>
        <li><strong>x₁, x₂ (Positions):</strong> Must be ≥ 0, not equal, and path length ≥ 0.0001 m.</li>
        <li><strong>T (Temperature):</strong> Must be &gt; 0 K. Typical: 250 – 350 K. Warn if &lt; 200 K or &gt; 2000 K.</li>
        <li><strong>Decimals:</strong> Up to 8 places for D, 4 for pressures, 2 for T.</li>
    </ul>
</div>

<!-- Output Validation Rules -->
<div class="note-card">
    <h3>✅ <strong>Output Validation Rules</strong></h3>
    <ul class="note-list">
        <li><strong>&lt; 0.000001 mol/m²·s:</strong> Very slow diffusion.</li>
        <li><strong>0.000001 – 0.0001 mol/m²·s:</strong> Moderate diffusion.</li>
        <li><strong>0.0001 – 0.001 mol/m²·s:</strong> Significant diffusion.</li>
        <li><strong>0.001 – 0.01 mol/m²·s:</strong> High diffusion.</li>
        <li><strong>&gt; 0.01 mol/m²·s:</strong> Very high diffusion, verify inputs.</li>
    </ul>
    <p><i>Typical diffusion flux range: 0.00000001 – 0.01 mol/m²·s. Results outside this range should be reviewed.</i></p>
</div>

    <!-- Standards -->
    <div class="note-card">
        <h3>📏 Standards</h3>
        <p>
            This calculator is based on Fick's Law of Diffusion and follows principles from 
            <strong>ASTM E2603</strong> (Standard Practice for Air Channel Evaluation), 
            <strong>EPA's Soil Vapor Extraction Guidance</strong>, and <strong>ISO 12219-3</strong> 
            (Interior air of road vehicles). It aligns with environmental engineering practices 
            for accurate assessment of gas transport in remediation and pollution control systems.
        </p>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>📝 Conclusion</h3>
        <p>
            The unidirectional diffusion equation is essential for environmental engineers analyzing 
            gas transport through stagnant media. Understanding this process enables better design 
            of remediation systems, pollution control equipment, and assessment of environmental 
            contamination risks, ensuring compliance with safety and environmental regulations.
        </p>
    </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });
function calculateDiffusion() {
    const D = parseFloat(document.getElementById('diffusivity').value.trim());
    const P = parseFloat(document.getElementById('totalPressure').value.trim());
    const pA1 = parseFloat(document.getElementById('pressure1').value.trim());
    const pA2 = parseFloat(document.getElementById('pressure2').value.trim());
    const x1 = parseFloat(document.getElementById('position1').value.trim());
    const x2 = parseFloat(document.getElementById('position2').value.trim());
    const T = parseFloat(document.getElementById('temperature').value.trim());

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');
    let errors = [];
    let warnings = [];

    // Validate Diffusion Coefficient
    if (isNaN(D) || D <= 0) {
        errors.push("👉 Diffusion coefficient (D) must be greater than 0.");
    } else if (D < 1e-10) {
        warnings.push("Diffusion coefficient is extremely small. Verify input value.");
    } else if (D > 1e-3) {
        warnings.push("Diffusion coefficient is very high, check unit conversion.");
    }

    // Validate Pressure
    if (isNaN(P) || P <= 0) {
        errors.push("👉 Total pressure (P) must be greater than 0 Pa.");
    } else if (P < 1000 || P > 1e6) {
        warnings.push("Total pressure is outside typical environmental system range (1000–1,000,000 Pa).");
    }

    // Validate Partial Pressures
    if (isNaN(pA1) || pA1 < 0) errors.push("👉 Partial pressure pA₁ must be ≥ 0.");
    if (isNaN(pA2) || pA2 < 0) errors.push("👉 Partial pressure pA₂ must be ≥ 0.");
    if (!isNaN(P) && !isNaN(pA1) && pA1 > P) errors.push("👉 Partial pressure pA₁ cannot exceed total pressure.");
    if (!isNaN(P) && !isNaN(pA2) && pA2 > P) errors.push("👉 Partial pressure pA₂ cannot exceed total pressure.");
    if (pA1 === P && pA2 === P) errors.push("👉 Both partial pressures cannot equal total pressure (no stagnant medium).");

    // Validate Positions
    if (isNaN(x1)) errors.push("👉 Position x₁ must be a valid number.");
    if (isNaN(x2)) errors.push("👉 Position x₂ must be a valid number.");
    if (!isNaN(x1) && !isNaN(x2)) {
        if (x1 === x2) errors.push("👉 Positions x₁ and x₂ must be different.");
        if (Math.abs(x2 - x1) < 0.0001) errors.push("👉 Path length (|x₂ - x₁|) is too small for calculation.");
    }

    // Validate Temperature
    if (isNaN(T) || T <= 0) {
        errors.push("👉 Temperature must be greater than 0 K.");
    } else if (T < 200 || T > 2000) {
        warnings.push("Temperature is outside typical engineering range (200–2000 K).");
    }

    // Handle errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Perform calculation
    const R = 8.314;
    const pB1 = P - pA1;
    const pB2 = P - pA2;
    if (pB1 <= 0 || pB2 <= 0) {
        errorMessage.innerHTML = "👉 Non-diffusing component partial pressure must be > 0.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    const pB_lm = (pB2 - pB1) / Math.log(pB2 / pB1);
    const deltaX = x2 - x1;
    const deltaPA = pA2 - pA1;
    const NA = (-D * P / (R * T * pB_lm)) * (deltaPA / deltaX);
    const absNA = Math.abs(NA);

    if (!isFinite(absNA) || isNaN(absNA)) {
        errorMessage.innerHTML = "👉 Calculation error: check inputs (possible division by zero).";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Output validation
    if (absNA < 1e-8 || absNA > 1e-2) {
        warnings.push("⚠️ Calculated flux is outside typical range (1×10⁻⁸ – 1×10⁻² mol/m²·s). Please verify inputs.");
    }

    // Show result (fixed, not exponential)
    document.getElementById('rateValue').textContent = absNA.toFixed(8);

    // Meter feedback
    const meterFill = document.getElementById('meterFill');
    let meterWidth, meterColor, feedback;

    if (absNA < 1e-6) {
        meterWidth = '20%'; meterColor = '#2ecc71';
        feedback = 'Very slow diffusion: likely negligible for most systems.';
    } else if (absNA <= 1e-4) {
        meterWidth = '40%'; meterColor = '#27ae60';
        feedback = 'Moderate diffusion: noticeable impact over time.';
    } else if (absNA <= 1e-3) {
        meterWidth = '60%'; meterColor = '#f39c12';
        feedback = 'Significant diffusion: important for environmental systems.';
    } else if (absNA <= 1e-2) {
        meterWidth = '80%'; meterColor = '#e67e22';
        feedback = 'High diffusion: can cause significant environmental effects.';
    } else {
        meterWidth = '95%'; meterColor = '#e74c3c';
        feedback = 'Very high diffusion: review inputs for potential errors.';
    }

    meterFill.style.width = meterWidth;
    meterFill.style.backgroundColor = meterColor;
    document.getElementById('feedbackContent').textContent = feedback + (warnings.length ? " " + warnings.join(" ") : "");

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


{% comment %} 
/* 
Formula Reference:
Molar Flux (NA) = [ -D * P / (R * T * pB_lm) ] * [ (pA2 - pA1) / (x2 - x1) ]

Where:
D = Diffusion coefficient [m²/s] (typical 1e-10 – 1e-4)
P = Total pressure [Pa] (1000 – 1e6)
pA1, pA2 = Partial pressures [Pa] (0 ≤ pA ≤ P)
x1, x2 = Positions [m] (0.001 – 10, x1 ≠ x2)
T = Temperature [K] (250 – 350 typical, must > 0)
R = Universal gas constant (8.314 J/mol·K)

Validation Rules:
- D > 0, warn if < 1e-10 or > 1e-3
- P > 0, valid range 1000 – 1e6
- pA1, pA2 ≥ 0 and ≤ P
- pA1 ≠ P or pA2 ≠ P (need stagnant medium)
- x1 ≠ x2, path length > 0.0001
- T > 0 K, realistic range 200 – 2000
Output:
- Flux < 1e-6 → Very slow
- 1e-6 to 1e-4 → Moderate
- 1e-4 to 1e-3 → Significant
- 1e-3 to 1e-2 → High
- > 1e-2 → Very High
*/ {% endcomment %}
