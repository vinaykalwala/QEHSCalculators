{% extends 'base.html' %}
{% block title %}Stall Load For A Variable Flow Secondary Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stall Load For A Variable Flow Secondary Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Stall Load For A Variable Flow Secondary Calculator</h1>
    <p>Estimate the stall load percentage in steam systems under variable secondary flow conditions. Useful for QEHS and fire safety assessments to prevent steam stall and ensure efficient heat transfer.</p>
</div>

<div class="calc-content">
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="A">Steam Temperature at Full Load (A) [°C]</label>
                <input type="number" id="A" class="form-input" step="any" placeholder="e.g., 160" min="0" max="1000">
            </div>

            <div class="form-group">
                <label for="B">Secondary Fluid Outlet Temperature (B) [°C]</label>
                <input type="number" id="B" class="form-input" step="any" placeholder="e.g., 80" min="-50" max="500">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="C">Secondary Fluid Inlet Temperature (C) [°C]</label>
                <input type="number" id="C" class="form-input" step="any" placeholder="e.g., 60" min="-50" max="500">
            </div>

            <div class="form-group">
                <label for="D">Backpressure Equivalent Saturated Steam Temperature (D) [°C]</label>
                <input type="number" id="D" class="form-input" step="any" placeholder="e.g., 100" min="0" max="1000">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateStallLoad()">Calculate Stall Load</button>
    </div>

    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Steam system illustration">
            <p>This tool calculates the stall load percentage to support QEHS and fire safety compliance.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Stall Load Percentage</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="stallLoad">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">%</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator evaluates the stall load percentage in steam or heat transfer systems. It helps engineers monitor stability, prevent stall conditions, optimize heat transfer, and ensure safe operation of industrial systems.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>A (°C):</strong> Reference temperature / design point.</li>
      <li><strong>B (°C):</strong> Lower operational temperature.</li>
      <li><strong>C (°C):</strong> Upper operational temperature.</li>
      <li><strong>D (°C):</strong> Measured or operating temperature.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>A:</strong> Required, numeric, 0 < A ≤ 1,000°C, must be > average of B and C.</li>
      <li><strong>B, C:</strong> Required, numeric, -50°C ≤ B, C ≤ 500°C.</li>
      <li><strong>D:</strong> Required, numeric, 0 ≤ D ≤ 1,000°C, must be ≥ average of B and C.</li>
      <li><strong>Advisories:</strong> Warnings for negative stall load or >100%.</li>
      <li><strong>Constraints:</strong> All inputs must be numeric, non-empty; prevent division by zero.</li>
      <li>Decimals allowed up to 4 places.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📊 Output Validation / Assessment</h3>
    <ul class="note-list">
      <li><strong>Stall Load (%):</strong> Displayed with 4 decimal places, must be finite.</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>0–100%: Valid calculation — Stall load is within normal operating range.</li>
          <li>>100%: Warning — Indicates extreme system condition or unusual inputs.</li>
          <li><0%: Error — Negative stall load is physically invalid; check inputs.</li>
        </ul>
      </li>
      <li>Warnings triggered for: non-finite results, negative stall load, or stall load >100%.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      The term "Stall Load For A Variable Flow Secondary Calculator" does not refer to a single, universally defined standard but rather a concept within the steam heating systems industry, with suppliers like Spirax Sarco providing calculation methods and charts, such as their Stall Chart, to predict stall conditions and determine stall load for variable inlet temperatures and constant flow secondary systems. There isn't a specific ISO, ANSI, or other broad industry-wide standard for this term; instead, manufacturers and engineers use specific internal calculation methods, often detailed in technical manuals, to define and address stall load in their systems.
    </p>
    <p><b>Understanding the Concept</b></p>
    <p><b>Stall Load:</b> This refers to the minimum load condition at which a steam system, particularly a constant flow secondary system, will fail to function correctly due to insufficient steam flow.</p>
    <p><b>Variable Flow:</b> In the context of secondary systems, variable flow often refers to the control of water flow through the secondary side, while steam flow to the primary coil might be constant or controlled.</p>
    <p><b>Stall Chart:</b> Suppliers such as Spirax Sarco provide charts and calculation methods, like the one described in their technical literature, to help engineers predict when a system will stall under varying inlet steam temperatures and other conditions.</p>
    <p><b>Key Considerations</b></p>
    <p><b>Steam Trap Sizing:</b> Engineers use this information to correctly size steam traps for both the full-load and minimum-load conditions to prevent stalls.</p>
    <p><b>Manufacturer-Specific Methods:</b> Calculation methods for stall load are typically developed by individual manufacturers and can vary from system to system.</p>
    <p><b>Industry Best Practices:</b> While there isn't a universal standard, engineers follow industry best practices for system design and operation to prevent stall conditions.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides reliable estimates of stall load percentage, supporting <strong>system stability</strong>, <strong>heat transfer optimization</strong>, and <strong>QEHS compliance</strong>. Ensure input values (A, B, C, D) are accurate and validate with manufacturer methods (e.g., Spirax Sarco Stall Chart) or field measurements for critical applications to ensure safe and efficient steam system performance.
    </p>
  </div>
</div>


<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateStallLoad() {
    const A = parseFloat(document.getElementById("A")?.value.trim());
    const B = parseFloat(document.getElementById("B")?.value.trim());
    const C = parseFloat(document.getElementById("C")?.value.trim());
    const D = parseFloat(document.getElementById("D")?.value.trim());

    const errors = [];
    const warnings = [];
    const headEl = document.getElementById("stallLoad");
    const feedbackEl = document.getElementById("feedbackContent");

    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    // Numeric validation
    if (![A, B, C, D].every(Number.isFinite)) {
        errors.push("👉 All inputs are required and must be numeric.");
        return showErrors(errors);
    }

    // Range validations
    if (A <= 0 || A > 1000) errors.push("👉 A must be >0°C and ≤1000°C.");
    if (B < -50 || B > 500) errors.push("👉 B must be between -50°C and 500°C.");
    if (C < -50 || C > 500) errors.push("👉 C must be between -50°C and 500°C.");
    if (D < 0 || D > 1000) errors.push("👉 D must be ≥0°C and ≤1000°C.");

    const avgBC = (B + C) / 2;

    // Logical consistency
    if (A <= avgBC) errors.push("👉 A must be greater than the average of B and C to avoid division by zero.");
    if (D < avgBC) errors.push("👉 D must be greater than or equal to the average of B and C.");

    if (errors.length) return showErrors(errors);

    // Stall load calculation
    const stallLoad = ((D - avgBC) / (A - avgBC)) * 100;

    // Feedback and classification
    let feedbackMessage = "";
    let feedbackColor = "black";

    if (stallLoad >= 0 && stallLoad <= 100) {
        feedbackMessage = "✅ Valid calculation: Stall load is within normal operating range.";
        feedbackColor = "green";
    } else if (stallLoad > 100) {
        feedbackMessage = "⚠️ Warning: Stall load >100%, indicates extreme system condition or unusual inputs.";
        feedbackColor = "orange";
    } else {
        feedbackMessage = "❌ Error: Negative stall load is not physically meaningful.";
        feedbackColor = "red";
    }

    headEl.textContent = stallLoad.toFixed(4);
    feedbackEl.innerHTML = `<div style="color:${feedbackColor}">${feedbackMessage}</div>`;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>


<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}



<!-- 
📌 Stall Load Calculator

🔹 Formula (internal, not displayed):
    • Stall Load (%) = ((D − (B+C)/2) / (A − (B+C)/2)) × 100
      - A = Reference temperature / design point [°C]
      - B = Lower operational temperature [°C]
      - C = Upper operational temperature [°C]
      - D = Measured or operating temperature [°C]

🔹 Input Validations:
    • A: Required, numeric, >0°C and ≤1000°C
    • B: Required, numeric, −50°C to 500°C
    • C: Required, numeric, −50°C to 500°C
    • D: Required, numeric, ≥0°C and ≤1000°C
    • Logical Checks:
        - A must be greater than the average of B and C to avoid division by zero.
        - D must be greater than or equal to the average of B and C.

🔹 Warnings / Edge Cases:
    • Stall load > 100% → ⚠️ indicates extreme system condition or unusual inputs.
    • Negative stall load → ❌ physically invalid, check input combination.
    • Non-numeric or missing inputs → ❌ error, inputs required.

🔹 Output & Feedback:
    • Stall Load displayed with 4 decimals (%)
    • Status / Assessment:
        - 0–100% → ✅ Valid, normal operating range.
        - >100% → ⚠️ High, check system condition.
        - <0% → ❌ Invalid, physically impossible.

-->
