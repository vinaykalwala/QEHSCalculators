{% extends 'base.html' %}
{% block title %}Heat Transfer Thermo Flow Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Transfer Thermo Flow Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<!-- ===== Heat Transfer Calculator (replaces previous Gas Phase UI) ===== -->
<div class="calculator-header">
  <h1>Heat Transfer Thermo Flow Calculator</h1>
  <p>
    Calculates steady-state one-dimensional conductive heat flow across a barrier.
    Result shown as <strong>total heat transfer Q (W)</strong> and <strong>heat flux q (W/m²)</strong>.
  </p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Parameters</h2>

    <div class="input-row">
      <div class="form-group">
        <label for="A"><strong>Heat transfer area A — m² *</strong></label>
        <input type="number" id="A" class="form-input" step="any" min="0" placeholder="e.g., 2.5">
      </div>

      <div class="form-group">
        <label for="deltaT"><strong>Temperature difference ΔT — °C or K *</strong></label>
        <input type="number" id="deltaT" class="form-input" step="any" min="0" placeholder="e.g., 40">
      </div>
    </div>

    <div class="input-row">
      <div class="form-group">
        <label for="x"><strong>Barrier thickness x — m *</strong></label>
        <input type="number" id="x" class="form-input" step="any" min="0.000001" placeholder="e.g., 0.05">
      </div>

      <div class="form-group">
        <label for="k"><strong>Thermal conductivity k — W/m·K *</strong></label>
        <input type="number" id="k" class="form-input" step="any" min="0.0001" placeholder="e.g., 0.35">
      </div>
    </div>

    <button class="calculate-btn" onclick="calculateConcentration()">Calculate Heat Transfer</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Heat transfer illustration">
      <p>This tool computes conductive heat transfer: <strong>Q = k·A·ΔT / x</strong>. Use for insulation, exchanger and safety checks.</p>
    </div>

    <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue" aria-live="polite">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Heat Transfer Result</h2>
      </div>

      <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
        <div>
          <div class="rate-label" style="font-size:14px; color:#2980b9;">Total heat transfer</div>
          <div class="rate-value" id="concentrationValue">0.00</div>
          <div class="rate-label" style="font-size:12px; color:#666;">W</div>
        </div>
        <div style="margin-left:20px;">
          <div class="rate-label" style="font-size:14px; color:#2980b9;">Heat flux</div>
          <div class="rate-value" id="fluxValue">0.00</div>
          <div class="rate-label" style="font-size:12px; color:#666;">W/m²</div>
        </div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>

      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section (updated to match Q = k·A·ΔT / x) -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About</h3>
        <p>
        This calculator estimates the rate of heat transfer through a solid barrier under steady-state
        conditions. It considers the material’s thermal conductivity, the surface area available for
        heat flow, the temperature difference across the barrier, and its thickness.  The output is provided in watts (W),
        representing the amount of heat energy transferred per unit time.
        </p>

  </div>

  <div class="note-card">
    <h3>✅ Input validations (summary)</h3>
    <ul class="note-list">
      <li><b>A (m²):</b> required; numeric; allowed range <b>0.0001 – 100000</b> (0.0001 m² = 1 cm²). Warn if outside typical range.</li>
      <li><b>ΔT (K or °C):</b> required; numeric; allowed range <b>0 – 2000</b>. Zero is allowed but yields Q = 0 (warn).</li>
      <li><b>x (m):</b> required; numeric; allowed range <b>0.000001 – 100</b> (1 µm – 100 m). Must be &gt; 0 to avoid divide by zero.</li>
      <li><b>k (W/m·K):</b> required; numeric; allowed range <b>0.0001 – 500</b>. Typical insulators 0.02–1; metals up to ~400.</li>
      <li><b>Decimals:</b> up to 6 decimals accepted; output Q shown to 2 decimals (W) and q to 2 decimals (W/m²).</li>
      <li><b>Cross-checks:</b> Very small x with large k and/or ΔT → extremely large Q — guardrail will flag likely unit errors.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>🔧 Applications</h3>
        <ul>
        <li><strong>Building Insulation:</strong> Evaluating wall, roof, and window efficiency to minimize energy loss.</li>
        <li><strong>HVAC Systems:</strong> Designing heating, cooling, and ventilation systems for optimal thermal comfort.</li>
        <li><strong>Industrial Equipment:</strong> Improving heat exchanger performance and cooling system design.</li>
        <li><strong>Electronics:</strong> Managing heat in processors, batteries, and circuit boards to prevent overheating.</li>
        <li><strong>Food & Refrigeration:</strong> Ensuring proper thermal control in storage, cooking, and preservation.</li>
        <li><strong>Energy Systems:</strong> Optimizing thermal management in solar panels, power plants, and boilers.</li>
        </ul>
  </div>

  <div class="note-card">
    <h3>🛑 Limitations</h3>
    <ul class="note-list">
      <li>1-D, steady conduction only — convective/radiative losses not included.</li>
      <li>Assumes constant k and uniform thickness; layered or temperature-dependent k need composite or numerical methods.</li>
    </ul>
  </div>
</div>

<script>
/* Shared UI helpers */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* calculateConcentration intentionally kept as button-wired name */
function calculateConcentration() {
  // raw string inputs
  const sA = document.getElementById("A").value.trim();
  const sDT = document.getElementById("deltaT").value.trim();
  const sx = document.getElementById("x").value.trim();
  const sk = document.getElementById("k").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const Qel = document.getElementById("concentrationValue");
  const qAreaEl = document.getElementById("fluxValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = v => Number.isFinite(v) && !Number.isNaN(v);
  const decLen = s => (s && s.includes(".")) ? s.split(".")[1].length : 0;

  // Presence checks
  if (!sA) errors.push("👉 Enter heat transfer area A (m²).");
  if (!sDT) errors.push("👉 Enter temperature difference ΔT (°C or K).");
  if (!sx) errors.push("👉 Enter barrier thickness x (m).");
  if (!sk) errors.push("👉 Enter thermal conductivity k (W/m·K).");
  if (errors.length) return showErrors(errors);

  // Parse numbers
  const A = parseFloat(sA);
  const dT = parseFloat(sDT);
  const x = parseFloat(sx);
  const k = parseFloat(sk);

  if (!isFiniteNum(A)) errors.push("👉 A must be numeric (m²).");
  if (!isFiniteNum(dT)) errors.push("👉 ΔT must be numeric (°C or K).");
  if (!isFiniteNum(x)) errors.push("👉 x must be numeric (m).");
  if (!isFiniteNum(k)) errors.push("👉 k must be numeric (W/m·K).");
  if (errors.length) return showErrors(errors);

  // Basic range / logical checks (errors)
  if (A <= 0) errors.push("👉 A must be greater than 0 m².");
  if (A < 0.0001 || A > 100000) errors.push("👉 A should be between 0.0001 and 100000 m² (check units).");

  if (dT < 0) errors.push("👉 ΔT must be ≥ 0 (use absolute temperature difference).");
  if (dT > 2000) errors.push("👉 ΔT unusually large (>2000). Check units or inputs.");

  if (x <= 0) errors.push("👉 x must be greater than 0 m (non-zero thickness).");
  if (x < 0.000001 || x > 100) errors.push("👉 x should be between 1e-6 and 100 m (check units).");

  if (k <= 0) errors.push("👉 k must be greater than 0 W/m·K.");
  if (k < 0.0001 || k > 500) errors.push("👉 k out of expected range 0.0001–500 W/m·K (check units/material).");

  if (errors.length) return showErrors(errors);

  // Precision warnings
  if (decLen(sA) > 6) warnings.push("⚠️ A has >6 decimals; results will be rounded.");
  if (decLen(sDT) > 6) warnings.push("⚠️ ΔT has >6 decimals; results will be rounded.");
  if (decLen(sx) > 6) warnings.push("⚠️ x has >6 decimals; results will be rounded.");
  if (decLen(sk) > 6) warnings.push("⚠️ k has >6 decimals; results will be rounded.");

  // Reasonableness warnings
  if (k < 0.02) warnings.push("⚠️ Very low k — highly insulating material.");
  if (k > 200) warnings.push("⚠️ Very high k — likely metal (check units).");
  if (x < 0.001) warnings.push("⚠️ Very thin barrier (<1 mm) — conduction may be limited by contact resistance.");
  if (x > 5) warnings.push("⚠️ Very thick barrier (>5 m) — unlikely for typical building/process elements.");

  // Compute heat transfer using extracted formula
  // Q = k * A * dT / x  (W)
  const Q = (k * A * dT) / x;

  // Derived per-area flux and U-value
  const qArea = (Q / A);      // W/m²  (also equals k*dT/x)
  const Uval = k / x;         // W/m²K

  // Guardrails to catch unit errors or unrealistic results
  if (!isFiniteNum(Q)) return showErrors(["⚠️ Computed heat transfer invalid. Check inputs."]);
  if (Math.abs(Q) > 1e9) {
    return showErrors(["⚠️ Computed Q exceeds 1×10⁹ W — likely unit/scale error. Please re-check inputs."]);
  }
  if (Math.abs(qArea) > 1e7) {
    return showErrors(["⚠️ Computed heat flux > 1×10⁷ W/m² — likely incorrect units or inputs."]);
  }

  // Classification (practical guidance)
  let perf = "";
  if (qArea < 10) {
    perf = "Low flux — good insulation/low heat loss (typical building envelope).";
  } else if (qArea < 100) {
    perf = "Moderate flux — ordinary industrial heat transfer or heating loads.";
  } else if (qArea < 1000) {
    perf = "High flux — significant heat flow; check equipment and safety.";
  } else {
    perf = "Very high flux — extreme conditions; review design and safety procedures.";
  }

  // Output formatting
  Qel.textContent = Q.toFixed(2);
  qAreaEl.textContent = qArea.toFixed(2);

  let details = `<div>Total heat transfer Q: <b>${Q.toFixed(2)} W</b></div>`;
  details += `<div>Heat flux q (= Q/A): <b>${qArea.toFixed(2)} W/m²</b> (U = <b>${Uval.toFixed(3)}</b> W/m²·K)</div>`;
  details += `<div style="margin-top:6px;">Classification: <b>${perf}</b></div>`;
  details += `<div style="margin-top:6px; font-size:0.95em;">Inputs → A: <b>${A}</b> m², ΔT: <b>${dT}</b> °C, x: <b>${x}</b> m, k: <b>${k}</b> W/m·K</div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = details;

  // show/hide elements
  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

/* Print helper retained */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>



<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


<!-- 
📌 Heat Transfer Through Conduction Calculator

Formula:
 Q = (k × A × ΔT) / x
 → Units: Watts (W)

Derived:
 q = Q / A = k × ΔT / x  → Heat flux [W/m²]
 U = k / x               → U-value [W/m²·K]

Inputs:
 - A → Heat transfer area [m²]
 - ΔT → Temperature difference [°C or K]
 - x → Barrier thickness [m]
 - k → Thermal conductivity [W/m·K]

Input Validations:
 - A: >0, valid range 1e-4 to 1e5 m²  
 - ΔT: ≥0, valid range 0–2000 K  
 - x: >0, valid range 1e-6 to 100 m  
 - k: >0, valid range 0.0001–500 W/m·K  
 - Decimal precision: warn if >6 decimals  
 - Context warnings:  
   • k <0.02 → very insulating material  
   • k >200 → metallic conductor  
   • x <0.001 m → very thin barrier  
   • x >5 m → unusually thick  

Outputs:
 - Q → Total heat transfer [W]  
 - q → Heat flux [W/m²]  
 - U → Overall heat transfer coefficient [W/m²·K]  
 - Performance classification (Low / Moderate / High / Very High flux)  
 - Context warnings (insulating, metallic, extreme thickness, etc.)

Output Validations:
 - Q must be finite and non-negative  
 - Guardrail: |Q| > 1e9 W → error (unit/scale issue)  
 - Guardrail: |q| > 1e7 W/m² → error (likely wrong units or inputs)  
-->

