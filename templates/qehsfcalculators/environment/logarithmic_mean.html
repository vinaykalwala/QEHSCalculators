{% extends 'base.html' %}
{% block title %}Logarithmic Mean Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logarithmic Mean Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Logarithmic Mean Calculator</h1>
            <p>Calculate the logarithmic mean for values with exponential relationships</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="valueA">First Value (a)</label>
                    <input type="number" id="valueA" class="form-input" placeholder="e.g., 25" step="any">
                </div>
                <div class="form-group">
                    <label for="valueB">Second Value (b)</label>
                    <input type="number" id="valueB" class="form-input" placeholder="e.g., 75" step="any">
                </div>
                
                <button class="calculate-btn" onclick="calculateLogMean()">Calculate Logarithmic Mean</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Calculation illustration">
                    <p>This tool will calculate the <strong>Logarithmic Mean</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:30px;">
                        <h2>Logarithmic Mean</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Calculation Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <!-- About -->
            <div class="note-card">
                <h3>üìò About This Calculator</h3>
                <p>
                    The <strong>Logarithmic Mean Calculator</strong> determines the average value that accounts for exponential relationships, 
                    particularly useful when dealing with quantities that change multiplicatively rather than additively. 
                    It's essential in environmental engineering, heat transfer calculations, and pollution control systems.
                </p>
            </div>

            <!-- Parameters Used -->
            <div class="note-card">
                <h3>‚öô Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>First Value (a):</strong> A positive measured value (temperature, concentration, etc.)</li>
                    <li><strong>Second Value (b):</strong> A positive measured value (must be same units as 'a')</li>
                </ul>
            </div>

            <!-- Input Validation Rules -->
            <!-- Input Validation Rules -->
<div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
        <li><b>Positive values only:</b> a, b > 0 (log undefined at zero/negative).</li>
        <li><b>Valid range:</b> 0.0001 ‚â§ a, b ‚â§ 1,000,000 (engineering-safe).</li>
        <li><b>Equal inputs:</b> If a = b ‚Üí log mean = a.</li>
        <li><b>Extreme ratios:</b> Warn if a/b > 1e6 or < 1e-6 (unrealistic gradients).</li>
        <li><b>Consistency check:</b> Log mean must always lie between a and b.</li>
        <li><b>Units:</b> Inputs must be in the same unit (temperature, flow, etc.).</li>
    </ul>
</div>


            <!-- Output Validations -->
            <div class="note-card">
                <h3>üìä Output Validations</h3>
                <p>
                    The <strong>Logarithmic Mean</strong> is interpreted with the following feedback:
                </p>
                <ul class="note-list">
                    <li><strong>a = b:</strong> ‚úÖ Both values are the same, so the log mean equals that value.</li>
                <li><b>Range Rule:</b> Logarithmic mean must always lie between the two input values (min ‚â§ L ‚â§ max).</li>
        <li><b>Equal Values:</b> If a = b, log mean = that value (avoids division by zero).</li>
        <li><b>Close Values:</b> If |a-b| is very small, approximation (arithmetic mean) is used to prevent errors.</li>
        <li><b>Numerical Stability:</b> Denominator ln(a/b) must not approach zero ‚Äî handled by approximation.</li>
        <li><b>Extreme Values:</b> Log mean < 0.0001 or > 1,000,000 flagged as unrealistic for physical systems.</li>
        <li><b>Error Handling:</b> If result is NaN or infinite, calculator will show an error message.</li>
    </ul>
                <p>
                    The logarithmic mean always falls between the two input values and provides a more accurate average for exponential relationships.
                </p>
            </div>

            <!-- Standards -->
            <div class="note-card">
                <h3>üìã Standards</h3>
                <p>
                    Logarithmic mean calculations align with:  
                    ‚Ä¢ <strong>ASME</strong> (American Society of Mechanical Engineers) Heat Exchanger Standards  
                    ‚Ä¢ <strong>EPA</strong> Pollution Control Guidelines  
                    ‚Ä¢ <strong>ISO 14000</strong> Environmental Management Systems  
                    ‚Ä¢ Industry standards for thermal efficiency calculations
                </p>
            </div>

            <!-- Conclusion -->
            <div class="note-card">
                <h3>üéØ Conclusion</h3>
                <p>
                    The logarithmic mean is a fundamental calculation in environmental engineering and heat transfer applications, 
                    providing more accurate averages for exponential relationships than arithmetic means. It's essential for designing 
                    efficient environmental control systems, heat exchangers, and ensuring regulatory compliance in pollution control.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateLogMean() {
    const valueA = document.getElementById('valueA').value.trim();
    const valueB = document.getElementById('valueB').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];
    let warnings = [];

    // --- Validation Rules ---
    // First Value
    if (valueA === "" || isNaN(valueA)) {
        errors.push("üëâ Please enter the first value.");
    } else if (parseFloat(valueA) <= 0) {
        errors.push("üëâ First value must be > 0. Logarithm undefined at zero/negative.");
    } else if (parseFloat(valueA) > 1000000) {
        warnings.push("‚ö†Ô∏è First value is unusually high. Verify units.");
    } else if (parseFloat(valueA) < 0.0001) {
        warnings.push("‚ö†Ô∏è First value is very small. Check measurement precision.");
    }

    // Second Value
    if (valueB === "" || isNaN(valueB)) {
        errors.push("üëâ Please enter the second value.");
    } else if (parseFloat(valueB) <= 0) {
        errors.push("üëâ Second value must be > 0. Logarithm undefined at zero/negative.");
    } else if (parseFloat(valueB) > 1000000) {
        warnings.push("‚ö†Ô∏è Second value is unusually high. Verify units.");
    } else if (parseFloat(valueB) < 0.0001) {
        warnings.push("‚ö†Ô∏è Second value is very small. Check measurement precision.");
    }

    // Error Handling
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    const a = parseFloat(valueA);
    const b = parseFloat(valueB);

    // Special case: equal values
    if (a === b) {
        document.getElementById('rateValue').textContent = a.toFixed(4);
        document.getElementById('feedbackContent').innerHTML = '‚úÖ Both values equal ‚Üí Log mean equals that value.';
        placeholder.classList.add('hidden');
        resultValue.classList.remove('hidden');
        return;
    }

    // Extreme ratio warning
    const ratio = a / b;
    if (ratio > 1e6 || ratio < 1e-6) {
        warnings.push("‚ö†Ô∏è Large gradient detected. Review system stability.");
    }

    // --- Safe Calculation ---
    const logMean = (a - b) / Math.log(a / b);

    // Validation: log mean must be between a and b
    if (!(logMean > Math.min(a, b) && logMean < Math.max(a, b))) {
        errorMessage.innerHTML = "üëâ Calculation error: Logarithmic mean not between input values.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    document.getElementById('rateValue').textContent = logMean.toFixed(4);
    document.getElementById('feedbackContent').innerHTML = 
        '‚úÖ Log mean is valid and lies between inputs.' + 
        (warnings.length ? " " + warnings.join(" ") : "");

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
{% comment %} 
/* 
Logarithmic Mean Calculator Validations
---------------------------------------
Formula: L = (a - b) / ln(a/b), with L = a if a = b
Validation Rules:
- a, b > 0 (log undefined at zero or negative)
- 0.0001 ‚â§ a, b ‚â§ 1,000,000 (engineering-safe window)
- Same units required
- a ‚â† b (special case handled)
- Extreme ratios flagged as warnings
*/ {% endcomment %}