{% extends 'base.html' %}
{% block title %}Logarithmic Mean Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logarithmic Mean Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Logarithmic Mean Calculator</h1>
            <p>Calculate the logarithmic mean for values with exponential relationships</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="valueA">First Value (a)</label>
                    <input type="number" id="valueA" class="form-input" placeholder="e.g., 25" step="any">
                </div>
                <div class="form-group">
                    <label for="valueB">Second Value (b)</label>
                    <input type="number" id="valueB" class="form-input" placeholder="e.g., 75" step="any">
                </div>
                
                <button class="calculate-btn" onclick="calculateLogMean()">Calculate Logarithmic Mean</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="/static/images/mlc_environment_result.png" alt="Calculation illustration">
                    <p>This tool will calculate the <strong>Logarithmic Mean</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:30px;">
                        <h2>Logarithmic Mean</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Calculation Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">

    <!-- ‚úÖ ABOUT -->
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            The <strong>Logarithmic Mean Calculator</strong> provides an average that accounts for
            multiplicative or exponential relationships. It is widely used in environmental engineering,
            heat transfer systems, pollution control, and anywhere gradients vary exponentially rather than
            linearly. It offers a more accurate representation than the arithmetic mean for such systems.
        </p>
    </div>

    <!-- ‚úÖ PARAMETERS USED -->
    <div class="note-card">
        <h3>‚öô Parameters Used</h3>
        <ul class="note-list">
            <li><strong>First Value (a):</strong> A positive measured value (temperature, concentration, flow, etc.).</li>
            <li><strong>Second Value (b):</strong> A positive measured value in the same unit as <strong>a</strong>.</li>
            <li><strong>Logarithmic Mean (L):</strong> The exponential-weighted average between a and b.</li>
        </ul>
    </div>

    <!-- ‚úÖ INPUT VALIDATION RULES -->
    <div class="note-card">
        <h3>‚úÖ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Positive values only:</strong> a, b must be greater than 0.</li>
            <li><strong>Engineering-safe range:</strong> 0.0001 ‚â§ a, b ‚â§ 1,000,000.</li>
            <li><strong>Equal values:</strong> If a = b, the log mean equals that same value.</li>
            <li><strong>Extreme ratios:</strong> Warnings shown if a/b > 1e6 or a/b < 1e-6.</li>
            <li><strong>Consistency:</strong> Inputs must be in the same units.</li>
            <li><strong>Numerical stability:</strong> Very small differences trigger an approximation to avoid instability.</li>
        </ul>
    </div>

    <!-- ‚úÖ OUTPUT VALIDATIONS (MUST MATCH JS FEEDBACK EXACTLY) -->
    <div class="note-card">
        <h3>üìè Output Validations</h3>
        <p>The calculator uses the following validation and interpretation rules:</p>

        <ul class="note-list">
            <li><strong>If a = b:</strong> ‚úÖ <em>‚ÄúBoth values equal ‚Üí Log mean equals that value.‚Äù</em></li>

            <li><strong>Range rule:</strong> Log mean must always lie between the two input values.</li>

            <li><strong>Primary assessment displayed:</strong>  
                ‚úÖ <em>‚ÄúLog mean is valid and lies between inputs.‚Äù</em>
            </li>

            <li><strong>Gradient warning:</strong>  
                ‚ö†Ô∏è <em>‚ÄúLarge gradient detected. Review system stability.‚Äù</em>
            </li>

            <li><strong>Stability checks:</strong>  
                Very small |a ‚àí b| values automatically use a safe arithmetic approximation.
            </li>

            <li><strong>Extreme results:</strong>  
                Values < 0.0001 or > 1,000,000 are flagged as unrealistic in physical systems.</li>

            <li><strong>Error handling:</strong>  
                If computed mean is not between a and b ‚Üí error message displayed.</li>
        </ul>
    </div>

    <!-- ‚úÖ GOVERNING PRINCIPLE (YOUR EXACT TEXT ‚Äî NO FORMULA DISPLAYED) -->
    <div class="note-card">
        <h3>üìñ Governing Principle</h3>
        <p>
            The logarithmic mean arises from the mathematical principles used when dealing with exponential gradients
            or multiplicative changes. It is commonly applied in thermal engineering, environmental systems, and 
            pollution control, where values change proportionally rather than linearly.
        </p>
        <p>
            The method is recognized in heat exchanger design, environmental modelling, and process engineering. 
            It aligns with engineering practices adopted in international standards such as ASME, EPA guidelines,
            ISO 14000 environmental management systems, and various industry-specific thermal design methodologies.
        </p>
        <p>
            It reflects the natural behavior of systems where rates depend on ratios rather than absolute differences.
            Although widely used, the logarithmic mean is an engineering construct rather than a ‚Äústandardized‚Äù tool,
            and is applied whenever exponential relationships need accurate representation.
        </p>
    </div>

    <!-- ‚úÖ CONCLUSION -->
    <div class="note-card">
        <h3>üîö Conclusion</h3>
        <p>
            The logarithmic mean provides a more accurate evaluation than simple averages when values vary 
            multiplicatively. This calculator ensures accurate, validated results for environmental engineering,
            heat transfer design, pollutant control assessments, and QEHS documentation. Always verify units,
            check gradients, and interpret results using the assessment rules provided.
        </p>
    </div>

</div>


    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateLogMean() {
    const valueA = document.getElementById('valueA').value.trim();
    const valueB = document.getElementById('valueB').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];
    let warnings = [];

    // --- Validation Rules ---
    // First Value
    if (valueA === "" || isNaN(valueA)) {
        errors.push("üëâ Please enter the first value.");
    } else if (parseFloat(valueA) <= 0) {
        errors.push("üëâ First value must be > 0. Logarithm undefined at zero/negative.");
    } else if (parseFloat(valueA) > 1000000) {
        warnings.push("‚ö†Ô∏è First value is unusually high. Verify units.");
    } else if (parseFloat(valueA) < 0.0001) {
        warnings.push("‚ö†Ô∏è First value is very small. Check measurement precision.");
    }

    // Second Value
    if (valueB === "" || isNaN(valueB)) {
        errors.push("üëâ Please enter the second value.");
    } else if (parseFloat(valueB) <= 0) {
        errors.push("üëâ Second value must be > 0. Logarithm undefined at zero/negative.");
    } else if (parseFloat(valueB) > 1000000) {
        warnings.push("‚ö†Ô∏è Second value is unusually high. Verify units.");
    } else if (parseFloat(valueB) < 0.0001) {
        warnings.push("‚ö†Ô∏è Second value is very small. Check measurement precision.");
    }

    // Error Handling
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    const a = parseFloat(valueA);
    const b = parseFloat(valueB);

    // Special case: equal values
    if (a === b) {
        document.getElementById('rateValue').textContent = a.toFixed(4);
        document.getElementById('feedbackContent').innerHTML = '‚úÖ Both values equal ‚Üí Log mean equals that value.';
        placeholder.classList.add('hidden');
        resultValue.classList.remove('hidden');
        return;
    }

    // Extreme ratio warning
    const ratio = a / b;
    if (ratio > 1e6 || ratio < 1e-6) {
        warnings.push("‚ö†Ô∏è Large gradient detected. Review system stability.");
    }

    // --- Safe Calculation ---
    const logMean = (a - b) / Math.log(a / b);

    // Validation: log mean must be between a and b
    if (!(logMean > Math.min(a, b) && logMean < Math.max(a, b))) {
        errorMessage.innerHTML = "üëâ Calculation error: Logarithmic mean not between input values.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    document.getElementById('rateValue').textContent = logMean.toFixed(4);
    document.getElementById('feedbackContent').innerHTML = 
        '‚úÖ Log mean is valid and lies between inputs.' + 
        (warnings.length ? " " + warnings.join(" ") : "");

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}

        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
{% comment %} 
<!-- /* 
Logarithmic Mean Calculator Validations
---------------------------------------
Formula: L = (a - b) / ln(a/b), with L = a if a = b
Validation Rules:
- a, b > 0 (log undefined at zero or negative)
- 0.0001 ‚â§ a, b ‚â§ 1,000,000 (engineering-safe window)
- Same units required
- a ‚â† b (special case handled)
- Extreme ratios flagged as warnings
*/ {% endcomment %} -->