{% extends 'base.html' %}
{% block title %}Sedimentation Overflow Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sedimentation Overflow Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Sedimentation Overflow Rate Calculator</h1>
        <p>Calculate the overflow rate for sedimentation tanks in water and wastewater treatment systems.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="flow_rate">Flow Rate (Q, m³/day)</label>
                <input type="number" id="flow_rate" class="form-input" step="any" min="0" placeholder="e.g., 10000">
            </div>
            
            <div class="form-group">
                <label for="surface_area">Surface Area (A, m²)</label>
                <input type="number" id="surface_area" class="form-input" step="any" min="0" placeholder="e.g., 500">
            </div>

            <button class="calculate-btn" onclick="calculateOverflowRate()">Calculate Overflow Rate</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Wastewater treatment illustration">
                <p>This tool calculates sedimentation overflow rate for water treatment optimization.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Overflow Rate</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="overflowValue">0.000</div>
                    <div class="rate-unit">m³/m²/day</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes -->
    <div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Sedimentation Overflow Rate Calculator</strong> determines the rate at which water flows over 
            the surface area of a sedimentation tank. This critical parameter affects the efficiency of solid settling 
            in water and wastewater treatment systems. Proper overflow rate ensures effective sedimentation while 
            preventing solids from escaping with the treated water.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Flow Rate (Q):</strong> Volume of water flowing into the tank per day (m³/day).</li>
            <li><strong>Surface Area (A):</strong> Horizontal area of the sedimentation tank (m²).</li>
        </ul>
    </div>


    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li><strong>Flow Rate (Q):</strong> Must be > 0 m³/day (typical range: 100-100,000 m³/day).</li>
            <li><strong>Surface Area (A):</strong> Must be > 0 m² (typical range: 10-5,000 m²).</li>
            <li><strong>Realistic Ratios:</strong> Q/A ratio should typically be between 10-100 m³/m²/day.</li>
            <li><strong>Extreme Values:</strong> Very small surface areas (&lt;1 m²) may indicate input error.</li>
            <li><strong>Unit Consistency:</strong> Both inputs must use consistent units (m³/day and m²).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Overflow Rate must be finite:</strong> NaN or Infinity indicates invalid inputs.</li>
            <li><strong>Overflow Rate > 60 m³/m²/day:</strong> ⚠️ High overflow rate → May lead to poor solid settling.</li>
            <li><strong>20 ≤ Overflow Rate ≤ 60 m³/m²/day:</strong> ✅ Optimal range → Suitable for effective sedimentation.</li>
            <li><strong>Overflow Rate &lt; 20 m³/m²/day:</strong> ⚠️ Low overflow rate → Could cause excessive sedimentation time.</li>
            <li><strong>Overflow Rate = 0:</strong> ℹ️ No flow or infinite surface area (theoretical).</li>
            <li><strong>Negative Overflow Rate:</strong> ❌ Impossible scenario → Both Q and A must be positive.</li>
        </ul>
    </div>
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A Sedimentation Overflow Rate Calculator is based on engineering standards and formulas derived from physical principles, such as Stokes' Law and the gravitational theory of sedimentation, to ensure that the rate of water applied per unit surface area is less than the settling velocity of the particles to be removed. These standards vary based on the type of sedimentation (e.g., plain vs. flocculated), but generally fall within specific ranges, such as 12,000 to 18,000 L/d/m² for plain sedimentation or 24,000 to 30,000 L/d/m² for flocculated water.
    </p>

    <h3>Underlying Principles and Standards</h3>
    <ul class="note-list">
        <li><strong>Gravitational Theory and Stokes' Law:</strong> Rooted in the fundamental principles of sedimentation, where particles settle due to gravity. Stokes' Law describes the relationship between a particle's settling velocity, its size, density, and the viscosity of the liquid.</li>
        <li><strong>Surface Overflow Rate (SOR):</strong> Also called surface loading rate, it represents the volume of water applied per unit time per unit horizontal surface area of the sedimentation tank.</li>
        <li><strong>Settling Velocity:</strong> The SOR must be less than the settling velocity of the target particles, ensuring they settle instead of being carried out with treated water.</li>
    </ul>

    <h3>Typical Standard Values</h3>
    <ul class="note-list">
        <li><strong>Plain Sedimentation:</strong> 12,000–18,000 L/d/m² of tank area.</li>
        <li><strong>Flocculated Water:</strong> With coagulants, 24,000–30,000 L/d/m².</li>
    </ul>

    <h3>How it Works</h3>
    <p>
        The calculator relates the tank’s surface area to the incoming flow rate to check design adequacy. The formula is:
    </p>
    <p><strong>SOR = Q / A</strong></p>
    <ul class="note-list">
        <li><strong>SOR:</strong> Surface Overflow Rate</li>
        <li><strong>Q:</strong> Discharge (flow rate)</li>
        <li><strong>A:</strong> Tank surface area</li>
    </ul>
    <p>
        By calculating the SOR, designers can verify that the tank dimensions meet efficiency standards for particle removal.
    </p>
</div>

<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines the <strong>sedimentation overflow rate</strong>, a critical design parameter 
        that ensures optimal particle settling efficiency in water treatment systems. Maintaining overflow rates 
        within the recommended range (20-60 m³/m²/day) balances treatment effectiveness with operational efficiency. 
        The calculated rate should be verified against specific treatment objectives, particle characteristics, 
        and regulatory standards to ensure proper sedimentation tank performance and compliance with water quality requirements.
    </p>
</div>
</div>
<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateOverflowRate() {
    // Read values
    const Q = parseFloat(document.getElementById("flow_rate").value);
    const A = parseFloat(document.getElementById("surface_area").value);

    const overflowValueEl = document.getElementById("overflowValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![Q, A].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    if (Q <= 0) errors.push("👉 Flow rate (Q) must be > 0 m³/day.");
    if (A <= 0) errors.push("👉 Surface area (A) must be > 0 m².");
    
    // Warning for unusual values
    if (Q > 100000) warnings.push("⚠️ Flow rate unusually high (>100,000 m³/day).");
    if (A > 5000) warnings.push("⚠️ Surface area unusually large (>5,000 m²).");
    if (A < 1) warnings.push("⚠️ Surface area unusually small (<1 m²).");
    if (Q/A > 100) warnings.push("⚠️ Q/A ratio unusually high (>100 m³/m²/day).");
    if (Q/A < 10) warnings.push("⚠️ Q/A ratio unusually low (<10 m³/m²/day).");

    if (errors.length) return showErrors(errors);

    // Formula: Overflow Rate = Q / A
    const overflowRate = Q / A;

    if (!Number.isFinite(overflowRate)) {
        return showErrors(["⚠️ Computed overflow rate is invalid (possible division error)."]);
    }

    if (overflowRate < 0) {
        return showErrors(["❌ Negative overflow rate calculated. Both Q and A must be positive."]);
    }

    // Classification
    let classification, suggestion, color;
    if (overflowRate > 60) {
        classification = "High Overflow Rate";
        suggestion = "⚠️ May lead to poor solid settling. Consider increasing surface area or reducing flow.";
        color = "#e65100";
    } else if (overflowRate >= 20) {
        classification = "Optimal Overflow Rate";
        suggestion = "✅ Suitable for effective sedimentation. Good operational range.";
        color = "#2e7d32";
    } else {
        classification = "Low Overflow Rate";
        suggestion = "⚠️ Could cause excessive sedimentation time. Consider reducing surface area or increasing flow.";
        color = "#c62828";
    }

    // Display result
    overflowValueEl.textContent = overflowRate.toFixed(2);
    feedbackEl.innerHTML = `
        <div>Overflow Rate = <b>${overflowRate.toFixed(2)}</b> m³/m²/day</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
-------------------------------------------------------------------------------------------
Input Validations:
Flow Rate (Q): Must be > 0 m³/day (typical range: 100-100,000 m³/day)

Surface Area (A): Must be > 0 m² (typical range: 10-5,000 m²)

Realistic Ratios: Q/A ratio should typically be between 10-100 m³/m²/day

Extreme Values: Very small surface areas (<1 m²) may indicate input error

Unit Consistency: Both inputs must use consistent units (m³/day and m²)
-------------------------------------------------------------------------------------------
Output Validations:
Overflow Rate must be finite: NaN or Infinity indicates invalid inputs

Overflow Rate > 60 m³/m²/day: High overflow rate (warning)

20 ≤ Overflow Rate ≤ 60 m³/m²/day: Optimal range

Overflow Rate < 20 m³/m²/day: Low overflow rate (warning)

Overflow Rate = 0: No flow or infinite surface area (theoretical)

Negative Overflow Rate: Impossible scenario (error)
------------------------------------------------------------------------------------------
Edge Cases:
Division by Zero Prevention: A=0 is invalid (must be >0)

Extremely Small Surface Areas: A approaching 0 produces very high overflow rates

Extremely Large Surface Areas: A very large produces very low overflow rates

Extremely High Flow Rates: Q very large produces very high overflow rates

Extremely Low Flow Rates: Q very small produces very low overflow rates
----------------------------------------------------------------------------------------
Formula:

Overflow Rate = Q / A
Where:
Q = Flow Rate (m³/day)
A = Surface Area (m²)
Overflow Rate = Result (m³/m²/day)

-->