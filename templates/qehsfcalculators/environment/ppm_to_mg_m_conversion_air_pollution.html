{% extends 'base.html' %}
{% block title %}PPM to mg/m³ Conversion Calculator (Air Pollution){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPM to mg/m³ Conversion Calculator (Air Pollution)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>PPM to mg/m³ Conversion Calculator (Air Pollution)</h1>
    <p>Convert volumetric concentration (PPM) to mass concentration (mg/m³) using the ideal gas relation. Result shown in <strong>mg/m³</strong> (and µg/m³)</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="ppm">Concentration (PPM)</label>
                <input type="number" id="ppm" class="form-input" step="any" min="0" placeholder="e.g., 5" aria-label="PPM">
            </div>

            <div class="form-group">
                <label for="mw">Molecular Weight (MW, g/mol)</label>
                <input type="number" id="mw" class="form-input" step="any" min="0" placeholder="e.g., 44.01" aria-label="Molecular weight">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="pressure">Pressure (atm)</label>
                <input type="number" id="pressure" class="form-input" step="any" min="0" placeholder="e.g., 1.00" aria-label="Pressure">
            </div>

            <div class="form-group">
                <label for="temp">Temperature (K)</label>
                <input type="number" id="temp" class="form-input" step="any" min="0" placeholder="e.g., 298.15" aria-label="Temperature in Kelvin">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculatePPMtoMG()">Convert</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Air quality illustration">
            <p>This tool converts <strong>PPM</strong> to <strong>mg/m³</strong> (and µg/m³) using gas law adjustments for temperature and pressure.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Converted Concentration</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="concentrationValue">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">mg/m³</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  
  <!-- About -->
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator converts volumetric gas concentration (PPM, by volume) into mass concentration (mg/m³). 
      It is commonly used in occupational health, safety, and environmental compliance to compare field 
      measurements with regulatory exposure limits that are specified in mg/m³ or µg/m³.
    </p>
  </div>

  <!-- Parameters Used -->
  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><b>PPM:</b> Concentration in parts per million (v/v).</li>
      <li><b>MW:</b> Molecular weight of gas (g/mol).</li>
      <li><b>P:</b> Pressure (atm).</li>
      <li><b>T:</b> Temperature (K).</li>
    </ul>
  </div>

  <!-- Input Validation Rules -->
  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>PPM:</b> must be &gt; 0. Typical environmental range 0.0001–1,000,000 ppm.</li>
      <li><b>Molecular Weight (MW):</b> ≥ 2 and ≤ 500 g/mol (warn if outside).</li>
      <li><b>Pressure (atm):</b> &gt; 0. Typical 0.5–2.0 atm (warn outside).</li>
      <li><b>Temperature (K):</b> &gt; 0. Typical 273–313 K (0–40°C). Reject 0 K; warn if &lt;150 K or &gt;1000 K.</li>
    </ul>
  </div>

  <!-- Output Validations -->
  <div class="note-card">
    <h3>📊 Output Validations</h3>
    <ul class="note-list">
      <li>Converted concentration is displayed in both <b>mg/m³</b> and <b>µg/m³</b>.</li>
      <li>Result must be finite and ≥ 0.</li>
      <li>Warnings are given for very high (&gt;1000 mg/m³) or unrealistic values.</li>
      <li>Classification is shown: 
        <ul>
          <li>&lt; 0.05 mg/m³ → ✅ Low (generic) — compare with substance OELs</li>
          <li>0.05 – 1 mg/m³ → ⚠️ Moderate (generic) — check pollutant-specific limits and exposure duration.</li>
          <li>≥ 1 mg/m³ → ❌ High (generic) — immediate review and controls recommended</li>
        </ul>
      </li>
      <li><b>Assessment (Feedback):</b> Along with result, detailed evaluation including warnings and safety suggestions is displayed.</li>
    </ul>
  </div>

  <!-- Governing Principle -->
  <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
      The conversion of parts per million (ppm) to milligrams per cubic meter (mg/m³) for air pollution measurements 
      is based on fundamental gas laws and chemical principles, rather than a single, universally adopted standard. 
      The conversion formula is derived from the ideal gas law and depends on the molecular weight of the specific gas, 
      as well as the temperature and pressure conditions.
    </p>
    <p><b>Standard Conditions:</b></p>
    <ul class="note-list">
      <li><b>STP:</b> 0°C (273.15 K), 1 atm → Vm ≈ 22.4 L/mol</li>
      <li><b>NTP:</b> 20°C (293.15 K), 1 atm → Vm ≈ 24.45 L/mol</li>
    </ul>
    <p>
      It is crucial to specify the temperature and pressure conditions when performing this conversion, 
      as molar volume changes accordingly.
    </p>
  </div>

  <!-- Conclusion -->
  <div class="note-card">
    <h3>🔎 Conclusion</h3>
    <p>
      The ppm to mg/m³ conversion is not based on a single universal standard but rather on the application of the 
      ideal gas law. Accurate conversion requires the molecular weight of the gas and clearly defined temperature and 
      pressure conditions. Always compare calculated results with pollutant-specific occupational exposure limits (OELs).
    </p>
  </div>

</div>


<script>
/* Re-used error display (keeps original UI behavior) */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Main conversion function implementing:
   mg/m³ = (273 * PPM * MW * P) / (22.4 * T)
*/
function calculatePPMtoMG() {
  const ppmRaw = document.getElementById("ppm").value.trim();
  const mwRaw = document.getElementById("mw").value.trim();
  const pressureRaw = document.getElementById("pressure").value.trim();
  const tempRaw = document.getElementById("temp").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const concEl = document.getElementById("concentrationValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required fields
  if (ppmRaw === "") errors.push("👉 Please enter Concentration (PPM).");
  if (mwRaw === "") errors.push("👉 Please enter Molecular Weight (g/mol).");
  if (pressureRaw === "") errors.push("👉 Please enter Pressure (atm).");
  if (tempRaw === "") errors.push("👉 Please enter Temperature (K).");
  if (errors.length) return showErrors(errors);

  // Parse
  const ppm = parseFloat(ppmRaw);
  const mw = parseFloat(mwRaw);
  const pressure = parseFloat(pressureRaw);
  const temp = parseFloat(tempRaw);

  // Basic numeric checks
  if (!Number.isFinite(ppm) || ppm <= 0) errors.push("👉 PPM must be a positive number.");
  if (!Number.isFinite(mw) || mw <= 0) errors.push("👉 Molecular weight must be a positive number (g/mol).");
  if (!Number.isFinite(pressure) || pressure <= 0) errors.push("👉 Pressure must be a positive number (atm).");
  if (!Number.isFinite(temp) || temp <= 0) errors.push("👉 Temperature must be a positive number (K).");

  if (errors.length) return showErrors(errors);

  // Domain-specific validations & warnings
  // PPM: realistic limits (soft)
  if (ppm > 1e6) warnings.push("⚠️ Extremely high PPM — verify units (ppm vs mg/m³ or %).");
  if (ppm < 1e-6) warnings.push("⚠️ Very low PPM — may be below instrument detection limits.");

  // MW reasonable range (H2 ~2, heavy organics < ~500)
  if (mw < 2) warnings.push("⚠️ MW < 2 g/mol — verify gas identity.");
  if (mw > 500) warnings.push("⚠️ MW unusually high — verify units or input.");

  // Pressure typical ambient range
  if (pressure < 0.1) warnings.push("⚠️ Very low pressure — check if vacuum conditions apply.");
  if (pressure > 5) warnings.push("⚠️ High pressure — ideal gas assumption may be less accurate.");

  // Temperature checks
  if (temp < 150) warnings.push("⚠️ Very low temperature (<150 K) — check units/conditions.");
  if (temp < 200) warnings.push("⚠️ Low temperature — density conversions may be sensitive.");
  if (temp > 1000) warnings.push("⚠️ Very high temperature — verify units.");

  // Cross-field sanity
  // Note: formula divides by temp; ensure not near zero
  if (Math.abs(temp) < 1e-9) return showErrors(["⚠️ Temperature too small — division by zero risk."]);

  // Calculation
  // Using mg/m^3 = (273 * ppm * MW * P) / (22.4 * T)
  const mg_m3 = (273 * ppm * mw * pressure) / (22.4 * temp);

  if (!Number.isFinite(mg_m3) || mg_m3 < 0) {
    return showErrors(["⚠️ Computed concentration is invalid. Check inputs."]);
  }

  // Display formatting
  let mgDisplay;
  const absVal = Math.abs(mg_m3);
  if (absVal === 0) {
    mgDisplay = "0.0000";
  } else if (absVal < 0.001) {
    mgDisplay = mg_m3.toExponential(4);
  } else if (absVal > 1e6) {
    mgDisplay = mg_m3.toExponential(4);
  } else {
    mgDisplay = mg_m3.toFixed(4);
  }

  const ug_m3 = mg_m3 * 1000; // µg/m³
  let ugDisplay;
  if (Math.abs(ug_m3) < 1) ugDisplay = ug_m3.toExponential(3);
  else ugDisplay = ug_m3.toFixed(2);

  // Basic classification (generic; pollutant-specific limits vary)
  let classification = "—";
  let suggestion = "";
  // Choose generic thresholds (only illustrative). Always recommend comparing to pollutant-specific OELs.
  if (mg_m3 < 0.05) {
    classification = "Low (generic)";
    suggestion = "✅ Typical low mass concentration — compare with substance OELs.";
  } else if (mg_m3 < 1) {
    classification = "Moderate (generic)";
    suggestion = "⚠️ Moderate — check pollutant-specific limits and exposure duration.";
  } else {
    classification = "High (generic)";
    suggestion = "❌ High mass concentration — immediate review and controls recommended.";
  }

  // Warnings for very large mass conc.
  if (mg_m3 > 1000) warnings.push("⚠️ Extremely high mg/m³ — verify units and sampling method.");

  // Prepare details
  let details = `<div>Converted: <b>${mgDisplay}</b> mg/m³ (<b>${ugDisplay}</b> µg/m³)</div>`;
  details += `<div>PPM: <b>${ppm}</b></div>`;
  details += `<div>Classification: <b>${classification}</b></div>`;
  details += `<div style="margin-top:6px;">${suggestion}</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;
  }

  // Update UI
  concEl.textContent = mgDisplay;
  feedbackEl.innerHTML = details;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

/* Print helper (keeps your original behavior) */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>


<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


<!-- 
📌 PPM to mg/m³ Conversion Notes

🔹 Formula Used:
    mg/m³ = (273 × PPM × MW × P) / (22.4 × T)
    where:
      PPM = concentration in parts per million
      MW = molecular weight (g/mol)
      P = pressure (atm)
      T = temperature (K)

🔹 Input Validations:
    • Concentration (PPM):
        - Must be > 0
        - Warning if > 1,000,000 (possible unit mix-up)
        - Warning if < 1e-6 (below instrument detection limit)

    • Molecular Weight (MW):
        - Must be > 0 g/mol
        - Warning if < 2 g/mol (verify gas identity)
        - Warning if > 500 g/mol (unusually high for gases)

    • Pressure (P):
        - Must be > 0 atm
        - Warning if < 0.1 atm (near vacuum)
        - Warning if > 5 atm (ideal gas law less accurate)

    • Temperature (T):
        - Must be > 0 K
        - Error if near zero (division by zero risk)
        - Warning if < 150 K (very low, check units)
        - Warning if < 200 K (sensitive results)
        - Warning if > 1000 K (very high, check input)

🔹 Output Validations:
    • Converted concentration (mg/m³):
        - Must be finite and ≥ 0
        - Warning if > 1000 mg/m³ (extremely high, check units/sampling)

    • µg/m³ conversion also displayed (mg/m³ × 1000).

    • Classification (generic, pollutant-specific OELs must be checked):
        - < 0.05 mg/m³ → ✅ Low (generic) — typically safe
        - 0.05 – 1 mg/m³ → ⚠️ Moderate (generic) — review exposure duration
        - ≥ 1 mg/m³ → ❌ High (generic) — immediate review/controls needed
-->
