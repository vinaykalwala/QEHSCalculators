{% extends 'base.html' %}
{% block title %}Stefan's Law of Molecular Diffusion Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stefan's Law of Molecular Diffusion Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }
        
        /* Input rows for side-by-side fields */
        .input-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        @media (min-width: 480px) {
            .input-row {
                flex-direction: row;
            }
        }
        
        .input-row .form-group {
            flex: 1;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
       
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'safetycategory_calculators' %}" class="back-btn">Back To Safety Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Stefan's Law of Molecular Diffusion Calculator</h1>
            <p>Calculate molecular diffusion flux based on Stefan's Law for environmental and industrial applications</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="input-row">
                    <div class="form-group">
                        <label for="partialPressure">Partial Pressure of A (p<sub>A</sub>) [Pa]</label>
                        <input type="number" id="partialPressure" class="form-input" min="0" step="any" placeholder="e.g., 1013">
                    </div>
                    <div class="form-group">
                        <label for="totalPressure">Total Pressure (P) [Pa]</label>
                        <input type="number" id="totalPressure" class="form-input" min="100" step="any" placeholder="e.g., 101325">
                    </div>
                </div>
                
                <div class="input-row">
                    <div class="form-group">
                        <label for="fluxA">Molar Flux of A (N<sub>A</sub>/A) [mol/m²s]</label>
                        <input type="number" id="fluxA" class="form-input" step="0.001" placeholder="e.g., 0.001">
                    </div>
                    <div class="form-group">
                        <label for="fluxB">Molar Flux of B (N<sub>B</sub>/A) [mol/m²s]</label>
                        <input type="number" id="fluxB" class="form-input" step="0.001" placeholder="e.g., 0.0005">
                    </div>
                </div>
                
                <div class="input-row">
                    <div class="form-group">
                        <label for="diffusivity">Diffusion Coefficient (D) [m²/s]</label>
                        <input type="number" id="diffusivity" class="form-input" min="0.00000001" step="any" placeholder="e.g., 0.0000001">
                    </div>
                    <div class="form-group">
                        <label for="temp">Temperature (T) [K]</label>
                        <input type="number" id="temp" class="form-input" min="0.1" step="any" placeholder="e.g., 298">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pressureGradient">Pressure Gradient (∂p<sub>A</sub>/∂z) [Pa/m]</label>
                    <input type="number" id="pressureGradient" class="form-input" step="any" placeholder="e.g., -1000">
                </div>
                
                <button class="calculate-btn" onclick="calculateDiffusion()">Calculate Diffusion Flux</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Diffusion illustration">
                    <p>This tool will calculate the <strong>Molecular Diffusion Flux</strong> based on Stefan's Law. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" id="calculationType" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                        <h2>Molecular Diffusion Flux</h2>
                    </div>
                    <div class="rate-display">
                        <div class="rate-value" id="rateValue">0.00</div>
                        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">mol/m²·s</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Diffusion Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-section">
            <!-- About -->
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Stefan's Law of Molecular Diffusion Calculator</strong> determines the molecular diffusion flux 
                    based on Stefan's Law, which describes how molecules move from regions of high concentration to low concentration. 
                    This equation accounts for both bulk flow and diffusive components of mass transfer, essential for environmental 
                    and industrial applications.
                </p>
            </div>

            <!-- Parameters Used -->
            <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>p<sub>A</sub> (Partial Pressure of A):</strong> Partial pressure of component A (Pa).</li>
                    <li><strong>P (Total Pressure):</strong> Total system pressure (Pa).</li>
                    <li><strong>N<sub>A</sub>/A (Molar Flux of A):</strong> Mass transfer rate of A per unit area (mol/m²s).</li>
                    <li><strong>N<sub>B</sub>/A (Molar Flux of B):</strong> Mass transfer rate of B per unit area (mol/m²s).</li>
                    <li><strong>D (Diffusion Coefficient):</strong> Measure of how easily molecules diffuse (m²/s).</li>
                    <li><strong>T (Temperature):</strong> Absolute temperature (K).</li>
                    <li><strong>∂p<sub>A</sub>/∂z (Pressure Gradient):</strong> Driving force for diffusion (Pa/m).</li>
                </ul>
            </div>

            <!-- Input Validation Rules -->
            <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
        <li><strong>pA (Partial Pressure of A):</strong> 0 ≤ pA ≤ P, decimals ≤ 6.</li>
        <li><strong>P (Total Pressure):</strong> 1,000 ≤ P ≤ 20,000,000 Pa, P > pA.</li>
        <li><strong>NA, NB (Molar Flux):</strong> 0 ≤ Flux ≤ 1 mol/m²·s, decimals ≤ 10.</li>
        <li><strong>D (Diffusion Coefficient):</strong> 1×10⁻¹² ≤ D ≤ 1×10⁻⁴ m²/s.</li>
        <li><strong>T (Temperature):</strong> 200 ≤ T ≤ 2000 K, decimals ≤ 2.</li>
        <li><strong>∂pA/∂z (Pressure Gradient):</strong> -1×10⁶ ≤ ∂pA/∂z ≤ 1×10⁶ Pa/m.</li>
    </ul>
</div>

<div class="note-card">
    <h3>✅ Output Validation Rules</h3>
    <ul class="note-list">
        <li><strong>|Flux| &lt; 1×10⁻¹⁰ mol/m²·s:</strong> Very low flux → near equilibrium.</li>
        <li><strong>1×10⁻¹⁰ ≤ |Flux| ≤ 1×10⁻² mol/m²·s:</strong> Normal diffusion range.</li>
        <li><strong>|Flux| > 1×10⁻² mol/m²·s:</strong> Verify inputs → unusually high flux.</li>
        <li><strong>Positive Flux:</strong> Bulk flow dominant.</li>
        <li><strong>Negative Flux:</strong> Diffusion dominant.</li>
    </ul>
</div>


            <!-- Standards -->
            <div class="note-card">
                <h3>📏 Standards</h3>
                <p>
                    This calculator is based on <strong>Stefan's Law of Molecular Diffusion</strong> and aligns with 
                    <strong>EPA's SCREEN3 and AERMOD models</strong> for environmental diffusion calculations. 
                    It follows <strong>ASTM E741</strong> standard test method for measuring air change rates using 
                    tracer gas dilution principles.
                </p>
            </div>

            <!-- Conclusion -->
            <div class="note-card">
                <h3>📋 Conclusion</h3>
                <p>
                    Molecular diffusion calculations are fundamental to understanding and predicting mass transfer 
                    in environmental systems. These principles help engineers design effective pollution control systems, 
                    assess exposure risks, and model natural transport processes in air, water, and industrial applications.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateDiffusion() {
    const pA = parseFloat(document.getElementById('partialPressure').value.trim());
    const P = parseFloat(document.getElementById('totalPressure').value.trim());
    const NA = parseFloat(document.getElementById('fluxA').value.trim());
    const NB = parseFloat(document.getElementById('fluxB').value.trim());
    const D = parseFloat(document.getElementById('diffusivity').value.trim());
    const T = parseFloat(document.getElementById('temp').value.trim());
    const dpdz = parseFloat(document.getElementById('pressureGradient').value.trim());

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];
    let warnings = [];

    // Partial Pressure validation
    if (isNaN(pA) || pA < 0) {
        errors.push("👉 <strong>Partial Pressure (pA)</strong> must be ≥ 0 Pa.");
    }

    // Total Pressure validation
    if (isNaN(P) || P < 1000 || P > 2e7) {
        errors.push("👉 <strong>Total Pressure (P)</strong> must be between 1,000 Pa and 20,000,000 Pa.");
    } else if (pA > P) {
        errors.push("👉 <strong>Total Pressure</strong> must be greater than Partial Pressure.");
    }

    // Molar Flux validation
    if (isNaN(NA) || NA < 0 || NA > 1) {
        errors.push("👉 <strong>Molar Flux of A</strong> must be between 0 and 1 mol/m²·s.");
    }
    if (isNaN(NB) || NB < 0 || NB > 1) {
        errors.push("👉 <strong>Molar Flux of B</strong> must be between 0 and 1 mol/m²·s.");
    }

    // Diffusion Coefficient validation
    if (isNaN(D) || D < 0.000000000001 || D > 0.0001) {
        errors.push("👉 <strong>Diffusion Coefficient (D)</strong> must be between 0.000000000001 and 0.0001 m²/s.");
    }


    // Temperature validation
    if (isNaN(T) || T < 200 || T > 2000) {
        errors.push("👉 <strong>Temperature (T)</strong> must be between 200 K and 2000 K.");
    }

    // Pressure Gradient validation
    if (isNaN(dpdz) || dpdz < -1e6 || dpdz > 1e6) {
        errors.push("👉 <strong>Pressure Gradient</strong> must be between -1,000,000 and 1,000,000 Pa/m.");
    }

    // Handle errors
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    // Calculation
    const R = 8.314;
    const bulkFlowTerm = (pA / P) * (NA + NB);
    const diffusiveTerm = (D / (R * T)) * dpdz;
    const totalFlux = bulkFlowTerm - diffusiveTerm;

    if (!isFinite(totalFlux) || isNaN(totalFlux)) {
        errorMessage.innerHTML = "👉 <strong>Calculation error</strong>: invalid input combination.";
        errorBox.classList.remove("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Output Validation
    if (Math.abs(totalFlux) < 1e-10) {
        warnings.push("<strong>Very low flux</strong>: System may be at equilibrium.");
    } else if (Math.abs(totalFlux) > 1e-2) {
        warnings.push("<strong>Unusually high flux</strong>: Verify input values.");
    }

    document.getElementById('rateValue').textContent = totalFlux.toFixed(10);;

    let feedback = (totalFlux > 0) 
        ? "Net flux is positive: <strong>Bulk flow dominant</strong>." 
        : "Net flux is negative: <strong>Diffusion dominant</strong>.";

    document.getElementById('feedbackContent').innerHTML = feedback + (warnings.length ? " " + warnings.join(" ") : "");

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

{% comment %} 
/* 
Formula used:
Total Flux (N_A) = (pA / P) * (NA + NB) - (D / (R * T)) * (∂pA/∂z)

Validation Ranges:
- 0 ≤ pA ≤ P
- 1,000 ≤ P ≤ 2e7 Pa
- 0 ≤ Flux (NA, NB) ≤ 1 mol/m²·s
- 1e-12 ≤ D ≤ 1e-4 m²/s
- 200 ≤ T ≤ 2000 K
- -1e6 ≤ ∂pA/∂z ≤ 1e6 Pa/m
Output Ranges:
- Typical Flux: 1e-10 to 1e-2 mol/m²·s
- Positive = Bulk flow dominant
- Negative = Diffusion dominant
*/ {% endcomment %}