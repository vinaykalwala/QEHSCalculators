{% extends 'base.html' %}
{% block title %}Corrosion Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrosion Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}



    <div class="calculator-header">
        <h1>Corrosion Rate Calculator</h1>
        <p>Calculate the <strong>Corrosion Rate (inches/year)</strong> to measure material degradation over time in industrial applications.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="form-group">
                <label for="metalLoss">Metal Loss (inches)</label>
                <input type="number" id="metalLoss" class="form-input" min="0.001" step="any" placeholder="e.g., 0.05">
            </div>

            <div class="form-group">
                <label for="timePeriod">Time Period (years)</label>
                <input type="number" id="timePeriod" class="form-input" min="0.01" step="any" placeholder="e.g., 2.5">
            </div>
            
            <button class="calculate-btn" onclick="calculateCorrosionRate()">Calculate Corrosion Rate</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Corrosion rate illustration">
                <p>This tool will calculate the <strong>Corrosion Rate (inches/year)</strong>.</p>
            </div>
            
            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>
             
            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Calculated Corrosion Rate</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="rateValue">0.0000</div>
                    <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">inches/year</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
<div class="note-section">

    <!-- About This Calculator -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Corrosion Rate Calculator</strong> determines the rate at which materials degrade over time. 
            It helps predict equipment lifespan, schedule maintenance, and optimize operational safety in industrial applications. 
            This tool provides rapid insights into metal loss over specified time periods and allows engineers to identify components at risk of failure.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Metal Loss (ML)</strong>: Measured in inches. Represents cumulative degradation of the material surface.</li>
            <li><strong>Time Period (T)</strong>: Measured in years. Duration over which metal loss is recorded.</li>
            <li><strong>Corrosion Rate (CR)</strong>: Inches/year, calculated as ML ÷ T.</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>All inputs are required and must be numeric.</li>
            <li>Metal Loss must be ≥ 0.001 in (instrument resolution) and ≤ 1.0 in (warning for unrealistic values).</li>
            <li>Time Period must be ≥ 0.01 years (~3.65 days) and ≤ 50 years (warn if unusually long).</li>
            <li>Zero or negative values are rejected.</li>
            <li>Corrosion rate calculations are blocked if inputs are invalid, non-numeric, or out of range.</li>
            <li>Precision beyond reasonable decimals triggers a warning.</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>Computed corrosion rate (CR) must be ≥ 0 and finite.</li>
            <li>Classification & feedback message (matches UI feedback):
                <ul>
                    <li>Corrosion Rate &lt; 0.01 in/year → ✅ Low corrosion (Excellent condition)</li>
                    <li>0.01 ≤ Corrosion Rate ≤ 0.05 in/year → ⚠️ Moderate corrosion (Monitor regularly)</li>
                    <li>Corrosion Rate &gt; 0.05 in/year → 🔴 High corrosion (Immediate maintenance required)</li>
                </ul>
            </li>
            <li>Warnings for unrealistic or extreme values are displayed alongside computed results.</li>
            <li>Results outside typical ranges prompt review of input data.</li>
            <li>Any NaN, infinite, or negative CR is flagged as invalid.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            A corrosion rate calculator uses principles and methodologies from standards such as<strong> ASTM G102</strong> , which provides standard practices for calculating corrosion rates and related information from electrochemical measurements. Other standards, like<strong> ASTM G59 and D2688</strong>, and specific industry guidelines such as API Standards and NORSOK standards, also provide frameworks or specific methods for corrosion rate assessment and calculation.
        </p>
    </div>


    <!-- Conclusion -->
    <div class="note-card">
        <h3>📝 Conclusion</h3>
        <ul class="note-list">
            <li>This calculator predicts corrosion rate and classifies severity based on standard thresholds.</li>
            <li>Output feedback directly matches the computed corrosion rate and includes actionable assessment.</li>
            <li>Input validation and warnings prevent unrealistic or erroneous results.</li>
            <li>Useful for pipeline integrity, industrial machinery, marine structures, and infrastructure monitoring.</li>
            <li>Ensures consistency with ASTM, API, and NORSOK standards, supporting maintenance and safety planning.</li>
        </ul>
    </div>

</div>


<script>
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

function calculateCorrosionRate() {
  const metalLossRaw = document.getElementById("metalLoss").value.trim();
  const timePeriodRaw = document.getElementById("timePeriod").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required inputs
  if (metalLossRaw === "") errors.push("👉 Enter Metal Loss (in inches).");
  if (timePeriodRaw === "") errors.push("👉 Enter Time Period (in years).");
  if (errors.length) return showErrors(errors);

  const metalLoss = parseFloat(metalLossRaw);
  const timePeriod = parseFloat(timePeriodRaw);

  // Basic numeric validation
  if (!Number.isFinite(metalLoss) || metalLoss < 0.001)
    errors.push("👉 Metal Loss must be ≥ 0.001 inches.");
  if (!Number.isFinite(timePeriod) || timePeriod < 0.01)
    errors.push("👉 Time Period must be ≥ 0.01 years.");
  if (errors.length) return showErrors(errors);

  // Logical consistency checks
  if (timePeriod === 0) errors.push("👉 Time Period cannot be zero.");
  if (metalLoss > 1.0) warnings.push("⚠️ Metal loss > 1 inch: unrealistic, verify measurements.");
  if (timePeriod > 50) warnings.push("⚠️ Time period > 50 years: verify historical data.");
  if (timePeriod < 0.1) warnings.push("⚠️ Very short time period - may not reflect true corrosion behavior.");

  // Calculate rate
  const corrosionRate = metalLoss / timePeriod;
  if (!Number.isFinite(corrosionRate) || corrosionRate < 0) {
    return showErrors(["⚠️ Computed corrosion rate is invalid."]);
  }

  // Output warnings
  if (corrosionRate > 1.0)
    warnings.push("⚠️ Extremely high corrosion rate (>1 in/year) - verify input values.");
  if (corrosionRate < 0.0001)
    warnings.push("⚠️ Extremely low corrosion rate - may be within instrument error.");

  // Assessment classification
  let statusMsg = "";
  if (corrosionRate < 0.01) {
    statusMsg = "✅ Low corrosion rate (Excellent condition)";
  } else if (corrosionRate <= 0.05) {
    statusMsg = "⚠️ Moderate corrosion rate (Monitor regularly)";
  } else {
    statusMsg = "🔴 High corrosion rate (Immediate maintenance required)";
  }

  // Compose feedback
  let details = `<div>Corrosion Rate: <b>${corrosionRate.toFixed(6)}</b> in/year</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }

  rateEl.textContent = corrosionRate.toFixed(4);
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!--
==============================================
⚙️ Corrosion Rate Calculator – Documentation
==============================================

📌 Formula:
-----------
Corrosion Rate (in/year) = Metal Loss (in) ÷ Time Period (years)

   CR = ML / T

   where:
     • ML = Metal Loss in inches
     • T  = Time Period in years

📥 Input Validations:
---------------------
Required fields:
  - Metal Loss (inches)
  - Time Period (years)

Hard checks (errors):
  - Metal Loss must be ≥ 0.001 in
  - Time Period must be ≥ 0.01 years
  - Inputs must be numeric and finite
  - Time Period ≠ 0

Soft checks (warnings):
  - Metal Loss > 1 in → unrealistic, verify data
  - Time Period > 50 years → unusual, verify historical data
  - Time Period < 0.1 years → too short, may not reflect long-term corrosion
  - Corrosion Rate > 1 in/year → extremely high, check values
  - Corrosion Rate < 0.0001 in/year → very low, may be within instrument error

📤 Output Validations:
----------------------
- Reject calculation if computed corrosion rate is NaN, infinite, or negative

Classification:
  - CR < 0.01 in/year → ✅ Low corrosion (Excellent condition)
  - 0.01 ≤ CR ≤ 0.05 in/year → ⚠️ Moderate corrosion (Monitor regularly)
  - CR > 0.05 in/year → 🔴 High corrosion (Immediate maintenance required)
==============================================
-->
