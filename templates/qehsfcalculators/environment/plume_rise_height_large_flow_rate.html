{% extends 'base.html' %}
{% block title %}Plume Rise Height (ŒîH) Calculator In Large Flow Rate{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plume Rise Height (ŒîH) Calculator In Large Flow Rate</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Plume Rise Height (ŒîH) Calculator In Large Flow Rate</h1>
    <p>
        Calculate the <strong>Plume Rise Height (ŒîH, meters)</strong> for buoyancy-dominated stacks.
    </p>
</div>

<div class="calc-content">
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="form-group">
            <label for="F">Buoyancy Flux Parameter (F) (m‚Å¥/s¬≤)</label>
            <input type="number" id="F" class="form-input" min="0.001" step="any" placeholder="e.g., 500">
        </div>

        <div class="form-group">
            <label for="Ustar">Friction Velocity (U<sup>*</sup>) (m/s)</label>
            <input type="number" id="Ustar" class="form-input" min="0.001" step="any" placeholder="e.g., 2.5">
        </div>

        <button class="calculate-btn" onclick="calculatePlumeRise()">Calculate Plume Rise</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Plume Rise Illustration">
            <p>This tool will calculate the <strong>Plume Rise Height (ŒîH)</strong> in meters.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">‚ùå</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Plume Rise Height</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">meters</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">

    <!-- About This Calculator -->
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
        <p>
            Estimates the vertical rise of plumes from industrial stacks using buoyancy flux (F) and friction velocity (U*). 
            Useful for air quality management, regulatory compliance, and industrial design.
        </p>
    </div>

    <!-- Parameters Used -->
    <div class="note-card">
        <h3>‚öô Parameters Used</h3>
        <ul class="note-list">
            <li><b>F (Buoyancy Flux Parameter):</b> m‚Å¥/s¬≤ ‚Äî represents buoyant energy of stack emissions</li>
            <li><b>U* (Friction Velocity):</b> m/s ‚Äî represents wind shear at stack height affecting plume rise</li>
            <li><b>ŒîH (Plume Rise Height):</b> meters ‚Äî calculated using ŒîH = 150 √ó F / (U*¬≥)</li>
        </ul>
    </div>

    <!-- Input Validation Rules -->
    <div class="note-card">
        <h3>‚úÖ Input Validation Rules</h3>
        <ul class="note-list">
            <li>F must be numeric and &gt; 0; typical range: 0.001 ‚Äì 1,000,000 m‚Å¥/s¬≤</li>
            <li>U* must numeric and &gt; 0; typical range: 0.01 ‚Äì 20 m/s</li>
            <li>Zero, negative, or non-numeric values are invalid</li>
            <li>Ensure units are SI: F in m‚Å¥/s¬≤, U* in m/s, ŒîH in meters</li>
            <li>ŒîH &gt; 500 m may indicate unrealistic inputs</li>
            <li>ŒîH &lt; 10 m may indicate poor dispersion or very calm conditions</li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>üìä Output Validations</h3>
        <ul class="note-list">
            <li>ŒîH displayed in meters (2 decimal places)</li>
            <li>Assessment/feedback displayed along with result:
                <ul>
                    <li>ŒîH &gt; 100 ‚Üí ‚úÖ High Plume Rise: Effective dispersion expected</li>
                    <li>30 ‚â§ ŒîH ‚â§ 100 ‚Üí ‚ö†Ô∏è Moderate Plume Rise: Acceptable under normal conditions</li>
                    <li>ŒîH &lt; 30 ‚Üí ‚ùå Low Plume Rise: Pollutants may stay close to ground</li>
                </ul>
            </li>
            <li>Input values F and U* displayed alongside ŒîH</li>
            <li>Warnings displayed for extreme ŒîH &lt; 10 m or &gt; 500 m</li>
        </ul>
    </div>

    <!-- Governing Principle -->
    <div class="note-card">
        <h3>üìê Governing Principle</h3>
        <p>
            A plume rise calculator is not based on a single standard but typically employs methods like the Briggs parameterization to estimate plume rise, 
            which calculates the height based on different formulas depending on atmospheric stability and wind conditions, and can vary for large flow rates. 
            These methods are often used in atmospheric dispersion models for regulatory and environmental purposes.
        </p>
        <p><b>Key Concepts:</b></p>
        <ul class="note-list">
            <li><b>Briggs Parameterization:</b> Empirical approach developed by G.A. Briggs in the 1970s, using different formulations for neutral, stable, and unstable conditions</li>
            <li><b>Atmospheric Stability:</b> Tendency of the atmosphere to resist or enhance vertical mixing, significantly affecting plume rise</li>
            <li><b>Flow Rate:</b> Large emission rates may trigger different formulas within Briggs framework; not a standalone standard</li>
            <li><b>Effective Stack Height:</b> Calculated plume rise added to physical stack height</li>
            <li><b>Atmospheric Dispersion Models:</b> Plume rise used to predict pollutant dispersion in the atmosphere</li>
        </ul>
        <p><b>Where to find these calculations:</b></p>
        <ul class="note-list">
            <li>Academic and Research Papers ‚Äî compare formulations based on atmospheric conditions</li>
            <li>Software Libraries ‚Äî some modeling software implements Briggs parameterization</li>
            <li>Regulatory Guidelines ‚Äî environmental agencies may specify preferred methods for regulatory purposes</li>
        </ul>
    </div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>üîé Conclusion</h3>
        <p>
            This calculator provides ŒîH for given F and U* inputs, displaying results along with assessment/feedback and warnings for extreme values. 
            It allows environmental engineers and designers to evaluate plume dispersion, ensuring compliance with air quality standards and effective pollutant dilution.
        </p>
    </div>

</div>


<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculatePlumeRise() {
    const F_raw = document.getElementById("F").value.trim();
    const Ustar_raw = document.getElementById("Ustar").value.trim();
    const errorBox = document.getElementById("resultError");
    const resultValue = document.getElementById("resultValue");
    const placeholder = document.getElementById("placeholder");
    const rateEl = document.getElementById("rateValue");
    const feedbackEl = document.getElementById("feedbackContent");

    errorBox.classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    if (F_raw === "") errors.push("üëâ Please enter F.");
    if (Ustar_raw === "") errors.push("üëâ Please enter U*.");

    if (errors.length) return showErrors(errors);

    const F = parseFloat(F_raw);
    const Ustar = parseFloat(Ustar_raw);

    if (!Number.isFinite(F) || F <= 0) errors.push("üëâ F must be a positive number.");
    if (!Number.isFinite(Ustar) || Ustar <= 0) errors.push("üëâ U* must be a positive number.");

    if (errors.length) return showErrors(errors);

    // Compute ŒîH = 150 * F / U*^3
    const deltaH = 150 * F / Math.pow(Ustar, 3);

    if (deltaH > 500) warnings.push("‚ö†Ô∏è ŒîH unusually high ‚Äî check input values.");
    if (deltaH < 10) warnings.push("‚ö†Ô∏è ŒîH very low ‚Äî dispersion may be limited.");

    rateEl.textContent = deltaH.toFixed(2);

    let statusMsg = "";
    if (deltaH > 100) statusMsg = "‚úÖ High Plume Rise: Effective dispersion expected.";
    else if (deltaH >= 30) statusMsg = "‚ö†Ô∏è Moderate Plume Rise: Acceptable under normal conditions.";
    else statusMsg = "‚ùå Low Plume Rise: Pollutants may stay close to ground.";

    let details = `<div>ŒîH: <b>${deltaH.toFixed(2)}</b> meters</div>`;
    if (warnings.length) details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;

    feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 
üìå Plume Rise Calculator (F / U* method) Notes

üîπ Formula Used:
    ŒîH = 150 √ó F / (U*¬≥)
    where:
      ŒîH   = plume rise (m)
      F    = buoyancy flux parameter (m‚Å¥/s¬≤)
      U*   = friction velocity (m/s)

üîπ Input Validations:
    ‚Ä¢ F (Buoyancy Flux):
        - Must be numeric
        - Must be > 0
    ‚Ä¢ U* (Friction Velocity):
        - Must be numeric
        - Must be > 0

üîπ Output Validations / Classification:
    ‚Ä¢ ŒîH displayed in meters (to 2 decimal places)
    ‚Ä¢ Warnings:
        - ŒîH > 500 ‚Üí unusually high, check inputs
        - ŒîH < 10 ‚Üí very low, limited dispersion expected
    ‚Ä¢ Assessment:
        - ŒîH > 100 ‚Üí ‚úÖ High Plume Rise: Effective dispersion
        - 30 ‚â§ ŒîH ‚â§ 100 ‚Üí ‚ö†Ô∏è Moderate Plume Rise: Acceptable
        - ŒîH < 30 ‚Üí ‚ùå Low Plume Rise: Pollutants may stay close to ground
    ‚Ä¢ Display includes input values (F, U*) and any warnings
-->
