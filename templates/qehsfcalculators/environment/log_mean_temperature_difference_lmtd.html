{% extends 'base.html' %}
{% block title %}Log Mean Temperature Difference (LMTD) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Mean Temperature Difference (LMTD) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Log Mean Temperature Difference (LMTD) Calculator</h1>
    <p>Calculate the <strong>LMTD (°C)</strong> for heat exchanger design with safety and operational validations.</p>
</div>

<div class="calc-content">
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="T1">Secondary Fluid In Temperature (T₁) (°C)</label>
            <input type="number" id="T1" class="form-input" step="any" placeholder="e.g., 40">
        </div>

        <div class="form-group">
            <label for="T2">Secondary Fluid Out Temperature (T₂) (°C)</label>
            <input type="number" id="T2" class="form-input" step="any" placeholder="e.g., 60">
        </div>

        <div class="form-group">
            <label for="TT">Steam / Hot Fluid Temperature (T) (°C)</label>
            <input type="number" id="TT" class="form-input" step="any" placeholder="e.g., 120">
        </div>

        <button class="calculate-btn" onclick="calculateLMTD()">Calculate LMTD</button>
    </div>

    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="LMTD illustration">
            <p>This tool will calculate the <strong>LMTD (°C)</strong>.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated LMTD</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">°C</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>The LMTD Calculator determines the effective temperature difference for heat exchangers, ensuring accurate process and safety evaluations.</p>
    </div>
    
    <div class="note-card">
        <h3>📌 Parameters</h3>
        <ul class="note-list">
            <li><strong>T₁</strong>: Secondary Fluid Inlet Temperature (°C) – numeric, &gt; 0</li>
            <li><strong>T₂</strong>: Secondary Fluid Outlet Temperature (°C) – numeric, &gt; 0</li>
            <li><strong>T</strong> (TT): Steam / Hot Fluid Temperature (°C) – numeric, &gt; 0</li>
        </ul>
    </div>


    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li>T₁, T₂ > 0 °C, T > 0 °C</li>
            <li>T₁, T₂ &lt; T (Steam/Hot Fluid)</li>
            <li>ΔT₁ = T − T₁ &gt; 0, ΔT₂ = T − T₂ &gt; 0</li>
            <li>ΔT₁ ≈ ΔT₂ (diff &lt; 0.1 °C) → warning (numerical instability)</li>
            <li>T₁, T₂ typical range 5–200 °C, T: 40–600 °C</li>
            <li>Non-numeric, negative, zero, or unrealistic combinations are invalid</li>
        </ul>
    </div>
    <div class="note-card">
        <h3>✅ Output Validations</h3>
        <ul class="note-list">
            <li>Computed LMTD must be finite and &gt; 0.</li>
            <li>LMTD classification:
                <ul class="note-list">
                    <li>LMTD &lt; 10 °C → ⚠️ LMTD is Very small, inefficient heat transfer.</li>
                    <li>10 ≤ LMTD ≤ 100 °C → ✅ LMTD is within normal range.</li>
                    <li>LMTD &gt; 100 °C → ⚠️LMTD Very high, check process temperatures.</li>
                </ul>
            </li>
            <li>Warnings for nearly equal ΔT values are displayed for numerical stability awareness.</li>
        </ul>
    </div>
    <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
    There isn't a single "standard" that the LMTD calculator adheres to, but rather it is a fundamental concept and method used in established heat transfer engineering standards and practices, particularly those for designing and analyzing heat exchangers. Standards like those from the Tubular Exchanger Manufacturers Association (TEMA) or various American Society of Mechanical Engineers (ASME) publications would incorporate LMTD as a core principle for defining the necessary heat transfer area and evaluating heat exchanger performance.</p>
    <p>
        <h3>Why LMTD is a Standard Practice, Not a Standard:</h3>
        <ul class="note-list">
            <li><strong>Foundation of Heat Exchanger Design:</strong>The LMTD method is a cornerstone for heat transfer calculations, allowing engineers to determine the effective temperature difference that drives heat exchange in various configurations like shell-and-tube, cross-flow, and parallel-flow exchangers.</li>
            <li><strong>Application in Industry Standards:</strong>Professional organizations and publishers of engineering handbooks incorporate LMTD in their guidelines for heat exchanger design and operation. For example, the Heat Exchanger Design Handbook and TEMA standards are built upon the principles of LMTD.</li>
            <li><strong>Used Alongside Other Methods:</strong>In some cases, LMTD is used alongside other methodologies, such as the effectiveness-NTU method, especially for more complex designs or specific conditions like those involving phase changes.</li>
            <li><strong>No Specific LMTD "Standard":</strong> Instead of a single standard, the method is integrated into the broader engineering discipline of thermal engineering, which has various established standards and recommended practices.</li>
        </ul>
    </p>
</div>

    <div class="note-card">
        <h3>✅ Conclusion</h3>
        <ul class="note-list">
            <li>LMTD is a critical parameter for heat exchanger design, representing the effective temperature driving force.</li>
            <li>Values within 10–100 °C are safe and efficient for standard operations.</li>
            <li>Extremely low LMTD indicates inefficient heat transfer; very high LMTD suggests possible design or input issues.</li>
            <li>Warnings should be heeded for numerical instability or nearly equal ΔT values to avoid computational errors.</li>
            <li>Ensures process safety and proper thermal performance evaluation.</li>
        </ul>
    </div>



</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateLMTD() {
    const T1Raw = document.getElementById("T1").value.trim();
    const T2Raw = document.getElementById("T2").value.trim();
    const TTRaw = document.getElementById("TT").value.trim();

    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");
    const rateEl = document.getElementById("rateValue");
    const feedbackEl = document.getElementById("feedbackContent");

    errorBox.classList.add("hidden");
    errorMessage.innerHTML = "";
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    if (T1Raw === "") errors.push("👉 Please enter Secondary In Temperature (T₁).");
    if (T2Raw === "") errors.push("👉 Please enter Secondary Out Temperature (T₂).");
    if (TTRaw === "") errors.push("👉 Please enter Steam/Hot Fluid Temperature (T).");
    if (errors.length) return showErrors(errors);

    const T1 = parseFloat(T1Raw);
    const T2 = parseFloat(T2Raw);
    const TT = parseFloat(TTRaw);

    if (!Number.isFinite(T1) || T1 <= 0) errors.push("👉 T₁ must be > 0.");
    if (!Number.isFinite(T2) || T2 <= 0) errors.push("👉 T₂ must be > 0.");
    if (!Number.isFinite(TT) || TT <= 0) errors.push("👉 T must be > 0.");
    if (errors.length) return showErrors(errors);

    if (T1 >= TT) errors.push("👉 T₁ must be less than T.");
    if (T2 >= TT) errors.push("👉 T₂ must be less than T.");
    if (errors.length) return showErrors(errors);

    const deltaT1 = TT - T1;
    const deltaT2 = TT - T2;

    if (deltaT1 <= 0 || deltaT2 <= 0) return showErrors(["👉 ΔT values must be positive."]);
    if (Math.abs(deltaT1 - deltaT2) < 0.1) warnings.push("⚠️ ΔT₁ and ΔT₂ nearly equal – numerical instability.");

    const LMTD = (deltaT1 - deltaT2) / Math.log(deltaT1 / deltaT2);
    if (!Number.isFinite(LMTD) || LMTD <= 0) return showErrors(["⚠️ Computed LMTD invalid."]);

    // Feedback based on LMTD
    let statusMsg = "";
    if (LMTD < 10) statusMsg = "⚠️ LMTD is very small – inefficient heat transfer.";
    else if (LMTD <= 100) statusMsg = "✅ LMTD is within normal range.";
    else statusMsg = "⚠️ LMTD is very high – check process temperatures.";

    let details = `<div>LMTD: <b>${LMTD.toFixed(2)}</b> °C</div>`;
    if (warnings.length) details += `<div style="margin-top:6px;color:#b35d00;font-size:0.95em;">${warnings.join(" | ")}</div>`;

    rateEl.textContent = LMTD.toFixed(2);
    feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
    errorBox.classList.add("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
    window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /*
===========================================
Log Mean Temperature Difference (LMTD) Calculator
===========================================

📌 Formula:
    LMTD = (ΔT1 - ΔT2) / ln(ΔT1 / ΔT2)

    where:
      ΔT1 = T_hot - T_cold,in  (TT - T1)
      ΔT2 = T_hot - T_cold,out (TT - T2)
      T1   = Secondary fluid inlet temperature (°C)
      T2   = Secondary fluid outlet temperature (°C)
      TT   = Hot fluid / steam temperature (°C)
      LMTD = Log Mean Temperature Difference (°C)

-------------------------------------------
✅ Input Validations:

1. Required:
   - T1, T2, TT must be provided and numeric.

2. Numeric & Positive:
   - T1 > 0, T2 > 0, TT > 0

3. Temperature relationships:
   - T1 < TT
   - T2 < TT

4. ΔT checks:
   - ΔT1 = TT - T1 > 0
   - ΔT2 = TT - T2 > 0
   - Warn if ΔT1 ≈ ΔT2 (numerical instability)

-------------------------------------------
⚠️ Output Validations:

1. Computed LMTD must be:
   - Finite
   - > 0

2. Classification based on LMTD:
   - LMTD < 10 °C → ⚠️ Very small, inefficient heat transfer
   - 10 ≤ LMTD ≤ 100 °C → ✅ Normal range
   - LMTD > 100 °C → ⚠️ Very high, check process temperatures

===========================================
*/ -->
