{% extends 'base.html' %}
{% block title %}Hardy Cross Head Loss Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardy Cross Head Loss Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        
.result-card::-webkit-scrollbar {
    width: 8px;
}

.result-card::-webkit-scrollbar-thumb {
    background: #1560bd;
    border-radius: 6px;
}

.result-card::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.result-card {
    justify-content: flex-start; /* align from top */
    align-items: stretch;
    min-height: 420px;
    text-align: center;
    overflow-y: auto;       /* Enable vertical scrolling */
    max-height: 450px;      /* Set max height to control output size */
    padding: 20px;          /* keep spacing */
}

        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}



<div class="calculator-header">
  <h1>Hardy Cross Head Loss Calculator</h1>
  <p>
    Compute friction head loss <strong>HL</strong> for a single path/pipe using an empirical form:
    choose <strong>Hazen–Williams</strong> (n = 1.85) or <strong>Darcy–Weisbach</strong> (n = 2).
    Use consistent units; output is reported as <strong>head</strong> (e.g., m of water).
  </p>
</div>

<div class="calc-content">
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="flowRate"><strong>Flow Rate (Q)</strong> — m³/s *</label>
      <input type="number" id="flowRate" class="form-input" step="any" placeholder="e.g., 0.035">
    </div>

    <div class="form-group">
      <label for="constantK"><strong>Pipe Constant (K)</strong> — consistent with units & method *</label>
      <input type="number" id="constantK" class="form-input" step="any" placeholder="e.g., 1200">
    </div>

    <div class="form-group">
      <label for="method"><strong>Method *</strong></label>
      <select id="method" class="form-input">
        <option value="hazen-williams">Hazen–Williams (n = 1.85)</option>
        <option value="darcy-weisbach">Darcy–Weisbach (n = 2)</option>
      </select>
    </div>

    <button class="calculate-btn" onclick="calculateCorrosionRate()">Calculate Head Loss</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Pipe/flow illustration">
      <p>This tool computes friction head loss (HL) using Hazen–Williams or Darcy–Weisbach forms and provides QEHS-oriented checks.</p>
    </div>

    <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue" aria-live="polite">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Head Loss Result</h2>
      </div>

      <div class="rate-display" style="display:flex; gap:24px; align-items:center;">
        <div>
          <div class="rate-label" style="font-size:14px; color:#2980b9;">Head Loss (HL)</div>
          <div class="rate-value" id="rateValue">0.000000</div>
          <div class="rate-label" id="unitLabel" style="font-size:12px; color:#666;">m of head</div>
        </div>

      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>

      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes tuned for head loss -->
<div class="note-section">
  <div class="note-card">
    <h3>🔎 About This Calculator</h3>
    <p>
    This calculator estimates friction <strong>head loss (HL)</strong> in a pipe path using standard empirical methods. 
    The method can be based on either <strong>Hazen–Williams</strong> or a <strong>Darcy–Weisbach surrogate</strong>, depending on the selection. 
    Enter the flow rate (<strong>Q</strong>) in m³/s and a pipe constant (<strong>K</strong>) consistent with your chosen method and units. 
    The result is provided as <strong>head loss (HL)</strong> in meters, assuming SI-consistent inputs.
    </p>

  </div>
  <div class="note-card">
  <h3>❓  Parameters</h3>
  <ul class="note-list">
    <li><b>Flow Rate (Q):</b> in m³/s (must be ≥ 0). Typical water branch flows: 1×10⁻⁶ – 10 m³/s.</li>
    <li><b>Pipe Constant (K):</b> depends on length, diameter, roughness, and units. Must be > 0. Practical range: 1×10⁻¹² – 1×10¹².</li>
  
</div>


  <div class="note-card">
    <h3>📌 Input validations</h3>
    <ul class="note-list">
      <li><b>Q (m³/s):</b> required; numeric; ≥ 0; typical water branch flows 1×10⁻⁵–5 m³/s. Warn outside 1×10⁻⁶–10 m³/s.</li>
      <li><b>K:</b> required; numeric; &gt; 0; represents all constants/length. Accept 1×10⁻¹²–1×10¹² (warn near bounds).</li>
      <li><b>Method:</b> required; Hazen–Williams (n=1.85) or Darcy–Weisbach (n=2). Enforces exponent accordingly.</li>
      <li><b>Precision:</b> up to 6 decimals accepted; outputs rounded to 6 decimals or exponential for extremes.</li>
      <li><b>Consistency:</b> Units used to construct <b>K</b> must match <b>Q</b>. If your design uses U.S. customary (ft, gpm), rebuild <b>K</b> or convert to SI.</li>
    </ul>
  </div>
  <div class="note-card">
  <h3>⚖️ Output Validations</h3>
  <ul class="note-list">
    
      <ul>
        <li>Q = 0 → HL = 0 → No-flow condition</li>
        <li>HL(Head Loss) &lt; 1 m → Low head loss — minimal friction losses.</li>
        <li>1–10 m → Moderate head loss — typical range.</li>
        <li>10–50 m → High head loss —check pipe size/material and length.</li>
        <li>&gt; 50 m → Very high head loss — risk of inadequate residual pressures (QEHS/Fire)</li>
      </ul>
</div>
<div class="note-card">
  <h3>📐 Governing Principle</h3>
  <p>
    A Hardy Cross head loss calculator does not follow one specific standard but uses different head
    loss equations, such as the Darcy–Weisbach equation or Hazen–Williams formula, to iteratively
    balance flow and head losses in a pipe network. The method itself is a standard hydraulic analysis
    technique for complex pipe networks, but the choice of the head loss equation depends on the
    specific fluid and conditions, with the Darcy–Weisbach equation being a common choice for general
    fluid flow.
  </p>

  <h3 style="margin-top:12px; color:#1976d2;">How the Hardy Cross Method Works</h4>
  <ul class="note-list">
    <li><b>Assumptions and Principles:</b> Total inflow equals total outflow at each junction, and the algebraic sum of head losses around any closed loop is zero.</li>
    <li><b>Iterative Correction:</b> An initial flow distribution is assumed, and head losses are calculated using a chosen head loss equation.</li>
    <li><b>Balancing the Network:</b> The method iteratively adjusts the flow in the pipes until the network is hydraulically balanced.</li>
  </ul>

  <h3 style="margin-top:12px; color:#1976d2;">Head Loss Equations</h4>
  <ul class="note-list">
    <li><b>Darcy–Weisbach Equation:</b> A fundamental and widely used equation for head loss, applicable to a variety of fluids. It allows Reynolds number calculation and is suited for general hydraulic analysis.</li>
    <li><b>Hazen–Williams Formula:</b> An empirical formula used specifically for water distribution systems; valid for velocities below ~10 ft/s.</li>
  </ul>

  <h3 style="margin-top:12px; color:#1976d2;">Key Considerations</h4>
  <ul class="note-list">
    <li><b>Fluid:</b> Choice of head loss equation depends on the fluid (e.g., water, gas) and its flow characteristics.</li>
    <li><b>Complexity:</b> Particularly useful for analyzing complex pipe networks that are difficult to solve manually.</li>
    <li><b>Application:</b> Provides a framework for analysis, while the specific formula for head loss may vary with application and problem characteristics.</li>
  </ul>
</div>

<div class="note-card">
  <h3>💡 Conclusion</h3>
  <p>
    The calculator determines the head loss based on the selected method and input values.  
    The result is expressed as <i>head loss</i> (e.g., meters of water), consistent with the input units.  
    <br>
    A small head loss indicates efficient flow with minimal friction, while a large head loss suggests
    excessive energy loss, possible undersized pipes, or inconsistent inputs.  
    Maintaining <b>unit consistency</b> between flow rate and pipe constants is essential for accurate and
    reliable results.
  </p>
</div>



</div>

<script>/* Reusable error UI helper */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Main calculator — name preserved for wiring compatibility */
function calculateCorrosionRate() {
  const sQ = document.getElementById("flowRate").value.trim();
  const sK = document.getElementById("constantK").value.trim();
  const method = document.getElementById("method").value;

  const placeholder = document.getElementById("placeholder");
  const errorBox = document.getElementById("resultError");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");
  const unitLabel = document.getElementById("unitLabel");

  errorBox.classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = v => Number.isFinite(v) && !Number.isNaN(v);
  const decLen = s => (s && s.includes('.')) ? s.split('.')[1].length : 0;

  // presence
  if (sQ === "") errors.push("👉 Enter flow rate Q (m³/s).");
  if (sK === "") errors.push("👉 Enter pipe constant K (consistent units).");
  if (!method) errors.push("👉 Select a method (Hazen–Williams or Darcy–Weisbach).");
  if (errors.length) return showErrors(errors);

  // parse
  const Q = parseFloat(sQ);
  const K = parseFloat(sK);

  if (!isFiniteNum(Q)) errors.push("👉 Q must be numeric (m³/s).");
  if (!isFiniteNum(K)) errors.push("👉 K must be numeric (consistent units).");
  if (errors.length) return showErrors(errors);

  // base checks
  if (Q < 0) errors.push("👉 Q must be ≥ 0 (no-flow is allowed, returns HL = 0).");
  if (K <= 0) errors.push("👉 K must be > 0.");
  if (errors.length) return showErrors(errors);

  // method → exponent
  let n;
  if (method === "hazen-williams") n = 1.85;
  else if (method === "darcy-weisbach") n = 2.0;
  else errors.push("👉 Invalid method selected.");
  if (errors.length) return showErrors(errors);

  // practical ranges (warnings)
  if (Q < 1e-6 || Q > 10) warnings.push("⚠️ Q outside typical range (1e-6–10 m³/s). Verify units (e.g., gpm vs m³/s).");
  if (K < 1e-12 || K > 1e12) warnings.push("⚠️ K outside practical range (1e-12–1e12). Check how K was built.");
  if (decLen(sQ) > 6) warnings.push("⚠️ Q has >6 decimals; results will be rounded.");
  if (decLen(sK) > 6) warnings.push("⚠️ K has >6 decimals; results will be rounded.");

  // compute HL = K * Q^n
  let HL = K * Math.pow(Q, n);

  // numeric checks
  if (!isFiniteNum(HL)) return showErrors(["⚠️ Computed HL is invalid (non-finite). Check inputs."]);
  if (HL < 0) return showErrors(["⚠️ Computed HL < 0 — impossible with positive Q and K."]);
  if (HL > 1e12) return showErrors(["⚠️ HL > 1×10¹² (head units). Likely unit or scale error."]);

  // classifications (for SI head; adjust as needed if using ft-based K)
  let classification = "";
  let color = "#2c7a7b";
  if (Q === 0) {
    classification = "No-flow condition (HL = 0).";
    color = "#0c5460";
  } else if (HL < 1) {
    classification = "Low head loss (<1 m) — minimal friction losses.";
    color = "#006400";
  } else if (HL <= 10) {
    classification = "Moderate head loss (1–10 m) — typical range.";
    color = "#b35d00";
  } else if (HL <= 50) {
    classification = "High head loss (10–50 m) — check pipe size/material and length.";
    color = "#b35d00";
  } else {
    classification = "Very high head loss (>50 m) — risk of inadequate residual pressures (QEHS/Fire).";
    color = "#b00020";
  }

  // heuristics for unit mismatch
  if (Q > 0 && HL < 1e-6) warnings.push("⚠️ HL extremely small — confirm K or unit system (SI vs US customary).");
  if (Q > 0 && HL > 1e5) warnings.push("⚠️ HL very large — likely unit mismatch or unrealistic K/length.");

  // formatter
  const fmt = v => {
    const a = Math.abs(v);
    if (a === 0) return "0.000000";
    if (a >= 1e-3 && a < 1e6) return v.toFixed(6);
    return v.toExponential(6);
  };

  // render - ONLY update the rate value and assessment (classification removed)
  rateEl.textContent = fmt(HL);
  unitLabel.textContent = "m of head (ensure K is SI-consistent)";

  let details = `<div><b>HL:</b> ${fmt(HL)} (head units)</div>`;
  details += `<div style="margin-top:6px;"><b>Classification:</b> <span style="color:${color}; font-weight:600">${classification}</span></div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = details;

  // show UI
  document.getElementById("placeholder").classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

/* Print helper (unchanged) */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) el.textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  window.print();
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /**
=======================================================
 Head Loss Calculator (HL = K·Qⁿ)
=======================================================

 Formula:
   HL = K · Qⁿ

 Where:
   HL = Head loss (m of fluid, or ft if consistent with K)
   Q  = Flow rate (m³/s, or consistent units)
   K  = Pipe constant (depends on length, diameter, roughness, units)
   n  = Exponent (method-dependent):
        • Hazen–Williams → n = 1.85
        • Darcy–Weisbach → n = 2.0

-------------------------------------------------------
 Input Validations
-------------------------------------------------------
 • Flow rate Q
   - Must be numeric
   - Must be ≥ 0 (0 → HL = 0 allowed)
   - Warning if outside typical 1e−6 – 10 m³/s

 • Pipe constant K
   - Must be numeric
   - Must be > 0
   - Warning if outside 1e−12 – 1e12

 • Method
   - Must be "hazen-williams" (n = 1.85) or "darcy-weisbach" (n = 2)

 • Decimal precision
   - Warn if Q or K have >6 decimals (rounded internally)

-------------------------------------------------------
 Output Validations
-------------------------------------------------------
 • HL must be:
   - Finite
   - ≥ 0
   - < 1e12 (otherwise flagged as unrealistic)

-------------------------------------------------------
 Output Classification
-------------------------------------------------------
 • Q = 0 → HL = 0 (no-flow condition)
 • HL < 1 m → Low head loss (minimal friction losses)
 • 1–10 m → Moderate head loss (typical range)
 • 10–50 m → High head loss (check pipe size/material/length)
 • > 50 m → Very high head loss (possible QEHS/fire-safety issue)

-------------------------------------------------------
 Heuristic Warnings
-------------------------------------------------------
 • HL ≪ 1 (with Q > 0) → Likely wrong K or unit system
 • HL ≫ 1e5 → Likely unit mismatch or unrealistic input
*/ -->
