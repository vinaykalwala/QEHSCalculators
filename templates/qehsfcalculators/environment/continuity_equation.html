{% extends 'base.html' %}
{% block title %}Continuity Equation Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continuity Equation Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>


    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
    
<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}



    <div class="calculator-header">
        <h1>Continuity Equation Calculator</h1>
        <p>Compute the <strong>Volumetric Flow Rate</strong> from fluid velocity and cross-sectional area. Result primary unit: <strong>m³/s</strong>. Converted values shown for readability.</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="form-group">
                <label for="velocity">Velocity (v) [m/s]</label>
                <input type="number" id="velocity" class="form-input" step="any" placeholder="e.g., 2.5" aria-label="Velocity in meters per second">
            </div>

            <div class="form-group">
                <label for="area">Cross-sectional Area (A) [m²]</label>
                <input type="number" id="area" class="form-input" step="any" placeholder="e.g., 0.05" aria-label="Cross-sectional area in square meters">
            </div>
            
            <button class="calculate-btn" onclick="calculateFlowRate()">Calculate Flow Rate</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Flow icon">
                <p>Enter velocity and area to compute the flow rate (displayed in multiple units).</p>
            </div>
            
            <div class="result-error hidden" id="resultError" role="alert" aria-live="assertive">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>
             
            <div class="result-value hidden" id="resultValue" aria-live="polite">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:8px; color:#1560bd;">
                    <h2>Volumetric Flow Rate Result</h2>
                </div>

                <div class="rate-display" style="flex-direction:column; gap:8px; align-items:center;">
                    <div style="display:flex; gap:8px; align-items:baseline;">
                        <div class="rate-value" id="rateValue">0.0000</div>
                        <div class="rate-label" style="color:#2980b9; font-size:18px; font-weight:bold;" id="rateUnit">m³/s</div>
                    </div>

                    <div id="convertedValues" style="font-size:0.95rem; color:#333;"></div>
                </div>

                <div class="result-feedback" style="margin-top:12px;">
                    <div class="feedback-title">Assessment & Notes</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>
                <div class="btn-wrapper" style="margin-top:12px;">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<div class="note-section">
    <!-- About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This Continuity Equation Calculator computes volumetric flow rate using the principle of conservation of mass. 
            It helps engineers, students, and professionals estimate flow through ducts, pipes, and open channels 
            based on velocity and cross-sectional area.
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Velocity (v):</strong> Flow speed in meters per second [m/s].</li>
            <li><strong>Area (A):</strong> Cross-sectional area through which the fluid flows [m²].</li>
            <li><strong>Flow Rate (Q):</strong> result in cubic meters per second [m³/s].</li>
            <li><strong>Converted Units:</strong> Additional readability in L/s and m³/h.</li>
        </ul>
    </div>

    <!-- Input Validations -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Required fields:</strong> Both velocity and area must be entered.</li>
            <li><strong>Numeric check:</strong> Only finite numbers allowed (no text, NaN, or infinity).</li>
            <li><strong>Area validation:</strong> Area &gt; 0 (zero or negative blocked).</li>
            <li><strong>Velocity range:</strong> -200 ≤ Velocity ≤ +200 m/s. Negative values mean reverse flow.</li>
            <li><strong>Warnings:</strong> 
                - |Velocity| &gt; 200 → implausible for incompressible flow.  
                - Area &lt; 0.000001 m² or &gt; 100 m² → unusual values, check units.  
                - Very high velocity with large area → unrealistic, check inputs.
            </li>
        </ul>
    </div>

    <!-- Output Validations -->
    <div class="note-card">
        <h3>🎯 Output Validations</h3>
        <ul class="note-list">
            <li>Volumetric Flow Rate must be finite; invalid results are blocked.</li>
            <li>Volumetric Flow Rate may be negative → indicates reverse flow.</li>
            <li>Volumetric Flow Rate = 0 → stagnant flow or resolution issue.</li>
            <li>|Volumetric Flow Rate| &lt; 0.000001 m³/s → extremely small, check units.</li>
            <li>|Volumetric Flow Rate| &gt; 1000000 m³/s → extremely large, likely input/unit error.</li>
            <li><strong>Flow classifications (also shown in result feedback):</strong></li>
            <ul>
                <li>Low flow: Volumetric Flow Rate &lt; 0.001 m³/s (too small for some applications).</li>
                <li>Moderate flow: 0.001 ≤ Volumetric Flow Rate &lt; 0.1 m³/s (typical for many systems).</li>
                <li>High flow: 0.1 ≤ Volumetric Flow Rate &lt; 10 m³/s (industrial applications).</li>
                <li>Very high flow: Volumetric Flow Rate ≥ 10 m³/s (verify capacity and inputs).</li>
            </ul>
            <li><strong>Direction note:</strong> Velocity &lt; 0 → reverse flow; Velocity ≥ 0 → forward flow.</li>
        </ul>
    </div>

    <!-- Governing Principle -->
<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>A "Continuity Equation Calculator" doesn't belong to a single standard but is rather an application of the principle of conservation of mass. 
        Different calculators exist for specific fields, using the continuity equation as a foundation, such as in fluid mechanics (e.g., for pipes) or 
        echocardiography (for calculating aortic valve area). These calculators are based on the idea that mass flow rate remains constant from one cross-section of a system to another. They allow engineers and clinicians to predict flow behavior under varying conditions. Proper understanding ensures accurate measurements, aids in system design, and helps diagnose potential issues. Such tools are essential in both educational and professional contexts for demonstrating mass conservation principles. They also provide a framework for simulating scenarios, validating experimental data, and optimizing processes efficiently.
</p>
</div>


    <!-- Conclusion -->
    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            The Continuity Equation Calculator provides a quick, reliable way to estimate volumetric flow rate 
            using velocity and area. Its checks and warnings ensure realistic inputs, and the result classification 
            helps interpret the computed flow in practical terms.
        </p>
    </div>
</div>


    <!-- Hidden fallback print date if print header doesn't include it -->
    <span id="printDate" style="display:none;"></span>
</div>

<script>
/* Consistent error UI */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

/* Utility: normalize commas to dots, trim */
function normalizeNumericInput(s) {
  if (typeof s !== "string") return "";
  return s.trim().replace(/,/g, "."); // allow "2,5" -> "2.5"
}

/* Main continuity calculation: Q = v * A (SI) */
function calculateFlowRate() {
  // safe reads + normalization
  let vRaw = document.getElementById("velocity")?.value ?? "";
  let aRaw = document.getElementById("area")?.value ?? "";
  vRaw = normalizeNumericInput(vRaw);
  aRaw = normalizeNumericInput(aRaw);

  const errorBox = document.getElementById("resultError");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const unitEl = document.getElementById("rateUnit");
  const convertedEl = document.getElementById("convertedValues");
  const feedbackEl = document.getElementById("feedbackContent");

  // reset UI
  if (errorBox) errorBox.classList.add("hidden");
  if (feedbackEl) feedbackEl.innerHTML = "";
  if (rateEl) rateEl.textContent = "0.0000";
  if (unitEl) unitEl.textContent = "m³/s";
  if (convertedEl) convertedEl.textContent = "";

  const errors = [];
  const warnings = [];

  // required
  if (vRaw === "") errors.push("👉 Please enter Velocity (v) in m/s.");
  if (aRaw === "") errors.push("👉 Please enter Cross-sectional Area (A) in m².");
  if (errors.length) { showErrors(errors); return; }

  // parse
  const v = Number(vRaw);
  const A = Number(aRaw);

  // numeric validation
  if (!Number.isFinite(v)) errors.push("👉 Velocity must be a finite number (m/s).");
  if (!Number.isFinite(A)) errors.push("👉 Area must be a finite number (m²).");
  if (errors.length) { showErrors(errors); return; }

  // field rules
  if (A <= 0) { showErrors(["👉 Cross-sectional Area (A) must be > 0 (m²)."]); return; }

  // plausible warnings (non-blocking)
  // Velocity
  if (Math.abs(v) < 0.001) warnings.push("⚠️ Velocity is very low (< 0.001 m/s). Check measurement sensitivity or units.");
  if (Math.abs(v) > 200)   warnings.push("⚠️ Velocity is very high (> 200 m/s). This suggests compressible/high-speed flow or unit error.");

  // Area
  if (A < 1e-6) warnings.push("⚠️ Area is very small (< 1e-6 m²). Check units (mm² vs m²).");
  if (A > 100)  warnings.push("⚠️ Area is very large (> 100 m²). Verify units and geometry.");

  // Cross-field plausibility
  if (Math.abs(v) > 100 && A > 1) {
    warnings.push("⚠️ Very high velocity with large area is unusual for ducts/pipes. Re-check units/inputs.");
  }

  // compute Q
  const Q = v * A; // m³/s
  if (!Number.isFinite(Q)) { showErrors(["⚠️ Computed flow rate is invalid. Check inputs."]); return; }

  const absQ = Math.abs(Q);

  // checks on computed Q
  if (absQ === 0) warnings.push("⚠️ Computed flow is zero. Possible stagnant flow or instrument at/below resolution.");
  if (absQ < 1e-6) warnings.push("⚠️ Flow is extremely small (< 1e-6 m³/s). Verify units and measurement resolution.");
  if (absQ > 1e6) warnings.push("⚠️ Flow is extremely large (> 1×10⁶ m³/s). Likely a unit/input error.");

  // conversions
  const Q_m3s = Q;
  const Q_Ls  = Q_m3s * 1000;   // L/s
  const Q_m3h = Q_m3s * 3600;   // m³/h

  // classification (absolute flow magnitude)
  let classification = "";
  if (absQ < 0.001)      classification = "Low flow (may be too small for some applications).";
  else if (absQ < 0.1)   classification = "Moderate flow (typical for many systems).";
  else if (absQ < 10)    classification = "High flow (industrial applications).";
  else                   classification = "Very high flow — verify system capacity and inputs.";

  // direction note
  const directionNote = (v < 0)
    ? "Direction: reverse flow (negative velocity)."
    : "Direction: forward flow (positive velocity).";

  // Display
  rateEl.textContent = Q_m3s.toFixed(4);
  unitEl.textContent = "m³/s";
  convertedEl.innerHTML = `(${Q_Ls.toFixed(4)} L/s · ${Q_m3h.toFixed(4)} m³/h)`;

  let details = `<div style="font-weight:600;">${classification}</div>`;
  details += `<div style="margin-top:6px;">${directionNote}</div>`;
  details += `<div style="margin-top:8px;">Inputs — Velocity: <b>${v.toFixed(6)} m/s</b>, Area: <b>${A.toExponential(6)} m²</b></div>`;
  if (warnings.length) {
    details += `<div style="margin-top:8px; color:#b35d00;">Note: ${warnings.join(" | ")}</div>`;
  }
  if (feedbackEl) feedbackEl.innerHTML = details;

  // toggle UI
  document.getElementById("placeholder")?.classList.add("hidden");
  resultValue?.classList.remove("hidden");
  errorBox?.classList.add("hidden");
}

/* Safe print helper */
function printReport() {
  let el = document.getElementById('printDate');
  if (!el) {
    el = document.createElement('span');
    el.id = 'printDate';
    el.style.display = 'none';
    document.body.appendChild(el);
  }
  const now = new Date();
  el.textContent = now.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  window.print();
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- ============================================================
📌 Continuity Equation — Volumetric Flow Rate
------------------------------------------------------------
Formula:
    Q = v × A

Where:
    Q = volumetric flow rate (m³/s)  
    v = velocity (m/s)  
    A = cross-sectional area (m²)  

------------------------------------------------------------
✅ Input Validations:

- Velocity (v):  
  • Must be a finite number (m/s)  
  • Warnings:  
    - |v| < 0.001 → very low velocity, check measurement sensitivity  
    - |v| > 200   → very high velocity, suggests compressible/high-speed flow or unit error  

- Area (A):  
  • Must be a finite number (m²)  
  • Must be > 0  
  • Warnings:  
    - A < 1e-6 m² → extremely small, likely unit error (mm² vs m²)  
    - A > 100 m²  → extremely large, check units and geometry  

- Cross-field plausibility:  
  • If |v| > 100 m/s AND A > 1 m² → unusual for ducts/pipes, re-check units  

------------------------------------------------------------
🎯 Output Validations:

- Q must be finite  
- Q may be negative → indicates reverse flow (negative velocity)  
- Checks on Q magnitude:  
  • Q = 0 → stagnant flow  
  • |Q| < 1e-6 m³/s → extremely small, likely unit/measurement issue  
  • |Q| > 1×10⁶ m³/s → extremely large, likely input/unit error  

------------------------------------------------------------
📊 Classification (by |Q| magnitude):
- |Q| < 0.001 → Low flow (may be too small for some applications)  
- 0.001 ≤ |Q| < 0.1 → Moderate flow (typical for many systems)  
- 0.1 ≤ |Q| < 10 → High flow (industrial applications)  
- |Q| ≥ 10 → Very high flow — verify system capacity and inputs  

📌 Direction note:  
- v < 0 → Reverse flow  
- v ≥ 0 → Forward flow  
============================================================ -->
