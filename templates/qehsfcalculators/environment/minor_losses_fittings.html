{% extends 'base.html' %}
{% block title %}Minor Losses (Fittings) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minor Losses (Fittings) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Minor Losses (Fittings) Calculator</h1>
    <p>
        Estimate the pressure loss across pipe fittings based on fluid density, velocity, and resistance coefficient. 
        Useful for pipeline design, fire safety systems, and industrial fluid flow assessments.
    </p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="kValue">Resistance Coefficient (K)</label>
            <input type="number" id="kValue" class="form-input" min="0.1" max="50" step="any" placeholder="e.g., 0.5">
        </div>

        <div class="form-group">
            <label for="density">Fluid Density (kg/m³)</label>
            <input type="number" id="density" class="form-input" min="1" max="2000" step="any" placeholder="e.g., 1000">
        </div>

        <div class="form-group">
            <label for="velocity">Flow Velocity (m/s)</label>
            <input type="number" id="velocity" class="form-input" min="0.01" max="50" step="any" placeholder="e.g., 3.5">
        </div>
        
        <button class="calculate-btn" onclick="calculateMinorLoss()">Calculate Pressure Loss</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Minor Loss illustration">
            <p>This tool will calculate the <strong>Minor Pressure Loss (Pa)</strong>.</p>
        </div>
        
        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>
         
        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Pressure Loss</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="lossValue">0.0000</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Pa</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>
            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<!-- Notes Section -->
<div class="note-section">

  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator estimates pressure losses across fittings and bends in pipelines, 
      supporting safer and more efficient hydraulic design.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>K:</strong> Resistance coefficient of the fitting (dimensionless)</li>
      <li><strong>ρ:</strong> Fluid density (kg/m³)</li>
      <li><strong>v:</strong> Flow velocity (m/s)</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li>K: 0.1 – 50, numeric, required</li>
      <li>ρ: 1 – 2000 kg/m³, numeric, required</li>
      <li>v: 0.01 – 50 m/s, numeric, required</li>
      <li>Zero or negative values are invalid</li>
      <li>v > 20 m/s → warning: high velocity</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📊 Output Validations </h3>
    <ul class="note-list">
        <li>Computed Pressure Loss (ΔP) must be finite and &gt; 0</li>
        <li>Warnings for extreme values:
            <ul>
                <li>v &gt; 20 m/s → ⚠️ Erosion/noise risk</li>
                <li>ΔP &gt; 10,000 Pa → ⚠️ Very high pressure loss; review system design</li>
            </ul>
        </li>
        <li>Assessment messages based on ΔP (displayed along with results):
            <ul>
                <li>ΔP &lt; 100 Pa → ✅ Negligible loss</li>
                <li>100 ≤ ΔP ≤ 1000 Pa → ⚠️ Moderate loss; review system design</li>
                <li>ΔP &gt; 1000 Pa → 🔴 High loss; possible efficiency or safety concern</li>
            </ul>
        </li>
    </ul>
</div>


  <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
      A "Minor Losses (Fittings) Calculator" isn't based on a single, universal standard but relies on various widely accepted engineering standards and empirical data, often cited from sources like the Engineering ToolBox, the SUEZ water handbook, and specific Indian Standards such as IS 2951-2. These standards provide K-values for different fittings, which vary between manufacturers, databases, and standards.
    </p>
    <ul class="note-list">
      <li><strong>Loss Coefficient (K-value):</strong> Empirical value quantifying the resistance of a fitting to flow.</li>
      <li><strong>Engineering ToolBox:</strong> Reliable online reference for K-values of various fittings and pipes.</li>
      <li><strong>Manufacturer Data:</strong> Consult for accurate K-values of specific valves or fittings.</li>
      <li><strong>Hydraulic Standards:</strong> Handbooks like SUEZ water handbook provide comprehensive K-value tables.</li>
      <li><strong>National Standards:</strong> IS 2951-2 (1965) in India gives recommendations for estimating head losses in fittings.</li>
      <li><strong>How Calculators Use These Standards:</strong>
        <ul>
          <li>User selects fitting type (e.g., 90° elbow, gate valve)</li>
          <li>Calculator looks up K-value from database based on selected fitting</li>
          <li>K-value applied in minor loss equation to compute pressure loss</li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="note-card">
    <h3>🔎 Conclusion</h3>
    <p>
      This calculator integrates input validation, computation, classification, and operational feedback. 
      Assessment messages are displayed alongside results, enabling informed hydraulic design decisions and safety checks.
    </p>
  </div>

</div>


<script>
/* Show error messages */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

function calculateMinorLoss() {
  const kRaw = document.getElementById("kValue").value.trim();
  const rhoRaw = document.getElementById("density").value.trim();
  const vRaw = document.getElementById("velocity").value.trim();

  const errorBox = document.getElementById("resultError");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const lossEl = document.getElementById("lossValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  if (kRaw === "") errors.push("👉 Please enter Resistance Coefficient (K).");
  if (rhoRaw === "") errors.push("👉 Please enter Fluid Density (kg/m³).");
  if (vRaw === "") errors.push("👉 Please enter Flow Velocity (m/s).");

  if (errors.length) return showErrors(errors);

  const k = parseFloat(kRaw);
  const rho = parseFloat(rhoRaw);
  const v = parseFloat(vRaw);

  if (!Number.isFinite(k) || k < 0.1 || k > 50) errors.push("👉 Resistance Coefficient (K) must be between 0.1 and 50.");
  if (!Number.isFinite(rho) || rho < 1 || rho > 2000) errors.push("👉 Fluid Density must be between 1 and 2000 kg/m³.");
  if (!Number.isFinite(v) || v < 0.01 || v > 50) errors.push("👉 Flow Velocity must be between 0.01 and 50 m/s.");

  if (errors.length) return showErrors(errors);

  if (v > 20) warnings.push("⚠️ High velocity detected - check for erosion or noise risk.");

  const deltaP = k * (rho * v * v / 2);

  if (!Number.isFinite(deltaP) || deltaP <= 0) {
    return showErrors(["⚠️ Computed pressure loss is invalid."]);
  }

  if (deltaP > 10000) warnings.push("⚠️ Very high pressure loss - review system design.");

  let statusMsg = "";
  if (deltaP < 100) {
    statusMsg = "✅ Negligible pressure loss.";
  } else if (deltaP <= 1000) {
    statusMsg = "⚠️ Moderate pressure loss. Review fitting selections.";
  } else {
    statusMsg = "🔴 High pressure loss - may impact efficiency or safety.";
  }

  let details = `<div>Pressure Loss: <b>${deltaP.toFixed(2)}</b> Pa</div>`;

  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }

  lossEl.textContent = deltaP.toFixed(2);
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!--
---------------------------------------------------------
📌 Formula:
    Minor Pressure Loss (Pa) = K × (ρ × v² / 2)
    where:
      K = Resistance Coefficient of the fitting
      ρ = Fluid density (kg/m³)
      v = Flow velocity (m/s)

---------------------------------------------------------
✅ Input Validation Rules:

1. Resistance Coefficient (K)
   - Required
   - Numeric
   - Range: 0.1 – 50

2. Fluid Density (ρ)
   - Required
   - Numeric
   - Range: 1 – 2000 kg/m³

3. Flow Velocity (v)
   - Required
   - Numeric
   - Range: 0.01 – 50 m/s
   - Warning: v > 20 m/s → high velocity warning

---------------------------------------------------------
📊 Output Validations / Assessment:

- Calculated Pressure Loss (ΔP) in Pa
- Must be > 0 and finite
- Warnings:
    • ΔP > 10,000 Pa → very high pressure loss, review design
- Assessment messages displayed based on ΔP:
    • ΔP < 100 Pa → Negligible loss
    • 100 ≤ ΔP ≤ 1000 Pa → Moderate loss
    • ΔP > 1000 Pa → High loss (possible efficiency/safety concern)

---------------------------------------------------------
-->
