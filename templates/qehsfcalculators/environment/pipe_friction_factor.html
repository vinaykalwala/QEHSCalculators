{% extends 'base.html' %}
{% block title %}Pipe Friction Factor Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipe Friction Factor Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Pipe Friction Factor Calculator</h1>
    <p>Calculate the <strong>Friction Factor (dimensionless)</strong> based on Reynolds number and pipe roughness to evaluate resistance to fluid flow.</p>
</div>

<div class="calc-content">
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="reynolds">Reynolds Number (Re)</label>
            <input type="number" id="reynolds" class="form-input" min="1" step="any" placeholder="e.g., 5000">
        </div>

        <div class="form-group">
            <label for="roughness">Relative Roughness (ε/D)</label>
            <input type="number" id="roughness" class="form-input" min="0" step="any" placeholder="e.g., 0.0002">
        </div>

        <button class="calculate-btn" onclick="calculateFrictionFactor()">Calculate Friction Factor</button>
    </div>

    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Pipe flow illustration">
            <p>This tool calculates <strong>Friction Factor (dimensionless)</strong> for pipe flow.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Friction Factor</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.0000</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">Dimensionless</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Pipe Friction Factor Calculator</strong> helps determine energy losses due to friction in piping systems. Accurate friction factors are crucial in pump sizing, fire protection systems, and water treatment plants to ensure operational efficiency and safety compliance.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li>Reynolds Number (Re): Dimensionless number predicting flow regime</li>
            <li>Relative Roughness (ε/D): Ratio of pipe roughness to pipe diameter</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>Re ≥ 1 (dimensionless)</li>
            <li>Relative roughness ε/D ≥ 0</li>
            <li>Negative or zero values are invalid</li>
            <li>Transitional regime (2000 ≤ Re ≤ 4000) has high uncertainty</li>
            <li>Extremely high Re (>10⁷) or ε/D (>0.05) may indicate unrealistic system parameters</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Output Validations & Assessment</h3>
        <ul class="note-list">
            <li>Friction Factor (f) displayed to 6 decimal places</li>
            <li>Flow Regime Classification & Feedback:
                <ul>
                    <li>Laminar (Re &lt; 2000) → ✅ Friction factor depends only on Re</li>
                    <li>Transitional (2000 ≤ Re ≤ 4000) → ⚠️ Friction factor unstable; monitor carefully</li>
                    <li>Turbulent (Re &gt; 4000) →
                        <ul>
                            <li>ε/D = 0 → ⚠️ Smooth pipe approximation used</li>
                            <li>ε/D &gt; 0 → ⚠️ Calculated considering pipe roughness</li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li>Warnings appear automatically if Re &gt; 1e7 or ε/D &gt; 0.05</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📚 Governing Principle</h3>
        <p>
            A pipe friction factor calculator is based on the principles of fluid dynamics and primarily uses the Darcy-Weisbach equation. This equation relates friction loss to a dimensionless friction factor, which is often determined using the Moody chart or by solving the Colebrook equation. While there is no single global standard, the Darcy-Weisbach method is the widely accepted standard for engineering calculations of friction loss in pipe flow.
        </p>
        <ul>
            <li><strong>Key Standards and Concepts:</strong>
                <ul>
                    <li>Darcy-Weisbach equation: Calculates head loss due to friction using the Darcy friction factor</li>
                    <li>Darcy friction factor (f): Dimensionless value representing friction loss</li>
                    <li>Moody chart: Graphical representation of friction factor versus Reynolds number and roughness</li>
                    <li>Colebrook equation: Implicit formula for turbulent flow friction factor</li>
                    <li>Reynolds Number (Re): Predicts laminar or turbulent flow patterns</li>
                    <li>Relative Roughness (ε/D): Influences the friction factor in turbulent flow</li>
                </ul>
            </li>
            <li><strong>How it Works:</strong>
                <ul>
                    <li>Determine flow conditions using Re to classify laminar or turbulent</li>
                    <li>For laminar flow: friction factor calculated as 64/Re</li>
                    <li>For turbulent flow: friction factor found via Colebrook equation or Moody chart</li>
                    <li>Calculate head loss: friction factor combined with pipe properties and fluid velocity in Darcy-Weisbach equation</li>
                </ul>
            </li>
            <li><strong>Why this standard is used:</strong>
                <ul>
                    <li>Accuracy: Reliable across wide range of flow conditions and pipe types</li>
                    <li>Versatility: Usable for most pipe systems, unlike Hazen-Williams which is limited</li>
                    <li>Industry acceptance: Widely used for reliable pipe system design</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            This calculator provides a precise friction factor, classifies the flow regime, and offers operational feedback to ensure safe, efficient, and QEHS-compliant piping system design.
        </p>
    </div>
</div>


<script>
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

function calculateFrictionFactor() {
  const reynoldsRaw = document.getElementById("reynolds").value.trim();
  const roughnessRaw = document.getElementById("roughness").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  if (reynoldsRaw === "") errors.push("👉 Please enter Reynolds number.");
  if (roughnessRaw === "") errors.push("👉 Please enter Relative Roughness (ε/D).");
  if (errors.length) return showErrors(errors);

  const reynolds = parseFloat(reynoldsRaw);
  const roughness = parseFloat(roughnessRaw);

  if (!Number.isFinite(reynolds) || reynolds < 1) errors.push("👉 Reynolds number must be ≥ 1.");
  if (!Number.isFinite(roughness) || roughness < 0) errors.push("👉 Relative roughness must be ≥ 0.");
  if (errors.length) return showErrors(errors);

  if (reynolds > 1e7) warnings.push("⚠️ Reynolds number unusually high, check inputs.");
  if (roughness > 0.05) warnings.push("⚠️ Relative roughness unusually high, verify pipe data.");

  let frictionFactor, flowRegime;

  if (reynolds < 2000) {
    frictionFactor = 64 / reynolds;
    flowRegime = "laminar";
  } else if (reynolds <= 4000) {
    frictionFactor = 0.032;
    flowRegime = "transitional";
  } else {
    const term1 = Math.pow(roughness / 3.7, 1.11);
    const term2 = 6.9 / reynolds;
    frictionFactor = Math.pow(-1.8 * Math.log10(term1 + term2), -2);
    flowRegime = "turbulent";
  }

  rateEl.textContent = frictionFactor.toFixed(6);

  let statusMsg = "";
  if (flowRegime === "laminar") statusMsg = "✅ Laminar flow: Friction factor depends only on Re.";
  else if (flowRegime === "transitional") statusMsg = "⚠️ Transitional flow: Unstable regime; friction factor may vary.";
  else statusMsg = roughness === 0
      ? "⚠️ Turbulent flow: Smooth pipe approximation used."
      : "⚠️ Turbulent flow: Calculated considering pipe roughness.";

  let details = `<div>Flow Regime: <b>${flowRegime}</b></div>`;
  if (warnings.length) details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!--
  🔹 Friction Factor Calculator - Formula & Validations

  1️⃣ Formula:
      • Laminar Flow (Re < 2000):
          f = 64 / Re
      • Transitional Flow (2000 ≤ Re ≤ 4000):
          f ≈ 0.032  (approximation)
      • Turbulent Flow (Re > 4000, Colebrook-like approximation):
          f = [-1.8 * log10((ε/D / 3.7)^1.11 + 6.9 / Re)]^-2

      where:
        • f = Darcy friction factor (dimensionless)
        • Re = Reynolds number (dimensionless)
        • ε/D = Relative roughness (dimensionless)

  2️⃣ Inputs:
      - Reynolds Number (Re): numeric, ≥ 1
      - Relative Roughness (ε/D): numeric, ≥ 0
      - Warnings:
          • Re > 1e7 → unusually high
          • ε/D > 0.05 → unusually high

  3️⃣ Outputs & Validations:
      - Friction Factor (f), 6 decimal places
      - Flow Regime Classification:
          1. Laminar (Re < 2000) → f depends only on Re
          2. Transitional (2000 ≤ Re ≤ 4000) → unstable regime; f may vary
          3. Turbulent (Re > 4000) → f calculated using roughness; smooth pipe if ε/D = 0
      - Status / Feedback:
          • Laminar: "✅ Laminar flow: Friction factor depends only on Re."
          • Transitional: "⚠️ Transitional flow: Unstable regime; friction factor may vary."
          • Turbulent, smooth: "⚠️ Turbulent flow: Smooth pipe approximation used."
          • Turbulent, rough: "⚠️ Turbulent flow: Calculated considering pipe roughness."
      - Warnings displayed if unusual Re or ε/D
-->
