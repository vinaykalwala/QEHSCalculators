{% extends 'base.html' %}
{% block title %}Solar Heat Gain Through Glass Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Heat Gain Through Glass Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Solar Heat Gain Through Glass Calculator</h1>
        <p>Calculate the solar heat gain through glass surfaces for building energy efficiency and thermal comfort assessment.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="window_area">Window Area</label>
                <input type="number" id="window_area" class="form-input" step="any" min="0" placeholder="Enter Window Area">
            </div>
            
            <div class="form-group">
                <label for="shading_coefficient">Shading Coefficient</label>
                <input type="number" id="shading_coefficient" class="form-input" step="0.01" min="0.1" max="1" placeholder="Enter Shading Coefficient">
            </div>
            
            <div class="form-group">
                <label for="scl_factor">Solar Cooling Load Factor</label>
                <input type="number" id="scl_factor" class="form-input" step="any" min="0" placeholder="Enter Solar Cooling Load Factor">
            </div>

            <button class="calculate-btn" onclick="calculateSolarHeatGain()">Calculate Heat Gain</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Solar heat gain illustration">
                <p>This tool calculates solar heat gain through glass for building energy efficiency analysis.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Solar Heat Gain</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="heatGainValue">0.00</div>
                    <div class="rate-unit">Watts</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Solar Heat Gain Through Glass Calculator</strong> determines the amount of solar heat entering a building through glass surfaces. 
            This parameter directly impacts cooling requirements, energy efficiency, and occupant thermal comfort in residential and commercial buildings. 
            By understanding solar heat gain, designers and engineers can optimize window design, shading strategies, and HVAC sizing.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Window Area (A):</strong> Glass surface area. Unit: m² (typical range: 0.1–100).</li>
            <li><strong>Shading Coefficient (SC):</strong> Efficiency of shading (0.1–1.0, typical 0.25–0.8).</li>
            <li><strong>Solar Cooling Load Factor (SCL):</strong> Solar heat load per unit area. Unit: W/m² (typical range: 100–1000).</li>
            <li><strong>Solar Heat Gain (Q):</strong> Heat gain through glass.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Window Area:</strong> Must be > 0 (typical range: 0.1-100 m²).</li>
            <li><strong>Shading Coefficient:</strong> Must be between 0.1 and 1.0 (typical range: 0.25-0.8).</li>
            <li><strong>Solar Cooling Load Factor:</strong> Must be > 0 (typical range: 100-1000 W/m²).</li>
            <li><strong>All inputs:</strong> Must be numeric and realistic for standard building applications.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Solar Heat Gain (Q) must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>Solar Heat Gain (Q) &lt; 100 W:</strong> ✅ Low heat gain → Minimal cooling required. Good energy efficiency.</li>
            <li><strong>Solar Heat Gain (Q) 100-500 W:</strong> ✅ Moderate → Typical for residential windows. Manageable cooling load.</li>
            <li><strong>Solar Heat Gain (Q) 500-2000 W:</strong> ⚠️ High → Significant cooling load. Consider additional shading strategies.</li>
            <li><strong>Solar Heat Gain (Q) &gt; 2000 W:</strong> ❌ Very high → Excessive cooling requirement. Window redesign recommended.</li>
            <li><strong>Assessment/Feedback:</strong> The classification and suggestion displayed with the result reflect the actual solar heat gain status and guide design decisions for shading, glazing, and energy efficiency.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📚 Governing Principle</h3>
        <p>
            A <strong>Solar Heat Gain Through Glass Calculator</strong> uses international standards to determine the solar energy passing through or absorbed by windows. 
            It is primarily based on calculating the Solar Heat Gain Coefficient (SHGC or g-value), which quantifies the fraction of solar radiation transmitted into the building.
        </p>
        <p><strong style="color: #1976d2;">Relevant Standards:</strong></p>
        <ul class="note-list">
            <li><strong>ISO 9050 / EN 410:</strong> Methods for determining total solar energy transmittance (g-value) for glazing at normal incidence.</li>
            <li><strong>ISO 19467:</strong> Method for measuring SHGC of complete fenestration systems (windows, doors, curtain walls) using a solar simulator.</li>
        </ul>
        <p>
            These standards ensure accurate and comparable results for different glazing types and configurations. They establish calculation conditions including glass orientation, exterior conditions such as solar radiation intensity, wind, and shading.  
            The underlying principle relies on multiplying window area, shading coefficient, and solar cooling load factor to estimate total solar heat gain (Q = A × SC × SCL).
        </p>
        <p>
            Output feedback (Low, Moderate, High, Very High) is incorporated to provide immediate assessment for energy efficiency and cooling requirements. This enables designers to take actionable measures for shading improvements or window redesigns in accordance with ISO, EN, and ASHRAE standards.
        </p>
    </div>

    <div class="note-card">
        <h3>📝 Conclusion</h3>
        <p>
            The <strong>Solar Heat Gain Through Glass Calculator</strong> provides reliable evaluation of solar heat entering a building through glass. 
            By entering window area, shading coefficient, and solar cooling load factor, users can determine solar heat gain in <b>Watts</b>. 
            The calculator provides assessment and feedback to guide glazing and shading design, optimize energy efficiency, maintain occupant comfort, and comply with ISO, EN, and ASHRAE standards.
        </p>
    </div>

</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateSolarHeatGain() {
    // Read values
    const A = parseFloat(document.getElementById("window_area").value);
    const SC = parseFloat(document.getElementById("shading_coefficient").value);
    const SCL = parseFloat(document.getElementById("scl_factor").value);

    const heatGainValueEl = document.getElementById("heatGainValue");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![A, SC, SCL].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    if (A <= 0) errors.push("👉 Window area must be > 0.");
    if (SC < 0.1 || SC > 1.0) errors.push("👉 Shading Coefficient must be between 0.1 and 1.0.");
    if (SCL <= 0) errors.push("👉 Solar Cooling Load Factor must be > 0.");
    
    // Warning for unusual values
    if (A > 100) warnings.push("⚠️ Window area unusually large (>100 m²).");
    if (A < 0.1) warnings.push("⚠️ Window area unusually small (<0.1 m²).");
    if (SCL > 1000) warnings.push("⚠️ SCL factor unusually high (>1000 W/m²).");
    if (SCL < 100) warnings.push("⚠️ SCL factor unusually low (<100 W/m²).");

    if (errors.length) return showErrors(errors);

    // Formula: Q = A × SC × SCL (in Watts)
    const Q = A * SC * SCL;

    if (!Number.isFinite(Q)) {
        return showErrors(["⚠️ Computed heat gain is invalid (possible calculation error)."]);
    }

    // Classification based on heat gain (industry standard)
    let classification, suggestion, color;
    
    if (Q < 100) {
        classification = "Low";
        suggestion = "✅ Minimal cooling required. Good energy efficiency.";
        color = "#2e7d32";
    } else if (Q <= 500) {
        classification = "Moderate";
        suggestion = "✅ Typical for residential applications. Manageable cooling load.";
        color = "#2e7d32";
    } else if (Q <= 2000) {
        classification = "High";
        suggestion = "⚠️ Significant cooling load. Consider additional shading strategies.";
        color = "#f9a825";
    } else {
        classification = "Very High";
        suggestion = "❌ Excessive cooling requirement. Window redesign recommended.";
        color = "#c62828";
    }

    // Display result
    heatGainValueEl.textContent = Q.toFixed(2);
    
    feedbackEl.innerHTML = `
        <div>Q = <b>${Q.toFixed(2)}</b> Watts</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Input Validations:
Window Area (A): Must be > 0 (typical range: 0.1-100 m²)

Shading Coefficient (SC): Must be between 0.1 and 1.0 (typical range: 0.25-0.8)

Solar Cooling Load Factor (SCL): Must be > 0 (typical range: 100-1000 W/m²)

All inputs must be numeric and finite numbers
----------------------------------------------------------------------------
Output Validations:
Q < 100 W: Low heat gain (optimal)

100-500 W: Moderate heat gain (acceptable)

500-2000 W: High heat gain (warning)

Q > 2000 W: Very high heat gain (critical)

Result must be finite: No NaN or Infinity values
--------------------------------------------------------------------------
Edge Cases:
Zero values: All inputs = 0 → Error (values must be > 0)

Negative values: Any input negative → Error

SC out of range: SC=1.1 or SC=0.05 → Error

Extremely large values: A=1000 → Warning

Non-numeric inputs: Text instead of numbers → Error


-->