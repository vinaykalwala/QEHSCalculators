{% extends 'base.html' %}
{% block title %}Head Loss through Fine Screens Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Head Loss through Fine Screens Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Head Loss through Fine Screens Calculator</h1>
    <p>Estimate <strong>Head Loss (m)</strong> across fine/medium screens from discharge (Q), discharge coefficient (C), and submerged open area (A).</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="flowRate">Discharge Q (m¬≥/s)</label>
            <input type="number" id="flowRate" class="form-input" min="0.000001" step="any" placeholder="e.g., 0.25">
        </div>

        <div class="form-group">
            <label for="coefficient">Discharge Coefficient C (‚Äì)</label>
            <input type="number" id="coefficient" class="form-input" min="0.01" max="1" step="any" placeholder="e.g., 0.60">
        </div>

        <div class="form-group">
            <label for="area">Submerged Open Area A (m¬≤)</label>
            <input type="number" id="area" class="form-input" min="0.000001" step="any" placeholder="e.g., 0.50">
        </div>
        
        <button class="calculate-btn" onclick="calculateHeadLoss()">Calculate Head Loss</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="screen headloss illustration">
           <p>
    This tool calculates <strong>Head Loss (m)</strong> across a screen based on the flow rate, effective open area, 
    and discharge coefficient.</p>

        </div>
        
        <div class="result-error hidden" id="resultError">
            <div class="error-icon">‚ùå</div>
            <div class="error-message" id="errorMessage"></div>
        </div>
         
        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Head Loss</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.0000</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">m</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>
            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>üìò About This Calculator</h3>
            <p>
                This calculator estimates the head loss across a screen based on the flow rate, open area, and a discharge
                coefficient. It is commonly applied to water and wastewater intakes, treatment plant headworks, and
                firewater strainers. The results help verify that approach velocities remain within safe limits, prevent
                excessive energy losses, and maintain adequate net positive suction head (NPSH) for pumps.
            </p>

    </div>
    
    <div class="note-card">
        <h3>üìä Interpretation</h3>
        <ul class="note-list">
            <li><span class="average">&lt; 0.10 m</span> ‚Üí ‚úÖ Minimal loss (clean screen / conservative velocities)</li>
            <li><span class="average">0.10‚Äì0.50 m</span> ‚Üí ‚ö†Ô∏è Moderate (monitor Œîh trend; plan cleaning/backwash)</li>
            <li><span class="bad">&gt; 0.50 m</span> ‚Üí üî¥ High (possible clogging/undersizing; check approach velocity & maintenance)</li>
        </ul>
        <p>Guidance is typical for clean-to-lightly-fouled fine screens. Site requirements may specify tighter limits.</p>
    </div>

    <div class="note-card">
        <h3>‚ö†Ô∏è Input Validations </h3>
        <ul>
            <li>Q (m¬≥/s) &gt; 0; typical reporting ‚â§ 3 decimals. Hard reject if Q ‚â§ 0 or non-numeric.</li>
            <li>C (‚Äì) in (0, 1]; warn if C &lt; 0.40 or &gt; 0.80; hard reject if ‚â§ 0 or &gt; 1.</li>
            <li>A (m¬≤) &gt; 0; typical reporting ‚â§ 3 decimals. Hard reject if A ‚â§ 0 or non-numeric.</li>
            <li>Derived approach velocity \(v_{\text{eff}} = Q/(C\,A)\): warn if &lt; 0.20 m/s or &gt; 1.20 m/s; 
                elevated warning if 1.20‚Äì3.00 m/s; hard reject if &gt; 5.00 m/s.</li>
            <li>Reject non-finite results or computed head loss &gt; 5.00 m as implausible for screens.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>üåç Key Applications</h3>
        <ul class="note-list">
            <li><strong>Headworks / WWTP:</strong> Track Œîh to trigger cleaning and avoid upstream surcharging.</li>
            <li><strong>Raw Water / Desal:</strong> Keep approach velocities in spec to limit carry-through of debris.</li>
            <li><strong>Firewater Intakes:</strong> Limit screen losses to protect NPSHa margin for pumps.</li>
        </ul>
    </div>
</div>

<script>
/* Show error messages (kept from original flow) */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Core validation + calculation for Head Loss across screens */
function calculateHeadLoss() {
  const Qraw = (document.getElementById("flowRate").value || "").trim();
  const Craw = (document.getElementById("coefficient").value || "").trim();
  const Araw = (document.getElementById("area").value || "").trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required checks
  if (!Qraw) errors.push("üëâ Please enter Discharge Q (m¬≥/s).");
  if (!Craw) errors.push("üëâ Please enter Discharge Coefficient C (‚Äì).");
  if (!Araw) errors.push("üëâ Please enter Submerged Open Area A (m¬≤).");
  if (errors.length) return showErrors(errors);

  // Parse
  const Q = parseFloat(Qraw);
  const C = parseFloat(Craw);
  const A = parseFloat(Araw);

  // Numeric + sign checks
  if (!Number.isFinite(Q) || Q <= 0) errors.push("üëâ Q must be a positive number in m¬≥/s.");
  if (!Number.isFinite(C) || C <= 0 || C > 1) {
    errors.push("üëâ C must be dimensionless in the range (0, 1]. Typical clean values are ~0.40‚Äì0.80.");
  }
  if (!Number.isFinite(A) || A <= 0) errors.push("üëâ A must be a positive number in m¬≤.");
  if (errors.length) return showErrors(errors);

  // Precision guidance (reporting consistency)
  const qDecimals = (String(Q).split('.')[1] || '').length;
  const cDecimals = (String(C).split('.')[1] || '').length;
  const aDecimals = (String(A).split('.')[1] || '').length;
  if (qDecimals > 3 || aDecimals > 3 || cDecimals > 3) {
    warnings.push("‚ö†Ô∏è High decimal precision detected ‚Äî round inputs to ‚â§ 3 decimals for reporting consistency.");
  }

  // Soft plausibility on raw inputs (site-dependent; advisory only)
  if (Q < 0.001) warnings.push("‚ö†Ô∏è Very small flow ‚Äî readings may be noisy; verify units.");
  if (Q > 50) warnings.push("‚ö†Ô∏è Large flow ‚Äî confirm units (m¬≥/s) and duty conditions.");
  if (A < 0.01) warnings.push("‚ö†Ô∏è Very small open area ‚Äî high fouling risk or incorrect units.");
  if (A > 50) warnings.push("‚ö†Ô∏è Very large area ‚Äî likely an open channel/culvert; verify screen type.");
  if (C < 0.40 || C > 0.80) warnings.push("‚ö†Ô∏è C outside typical clean-screen range (0.40‚Äì0.80).");

  // Derived quantities
  const g = 9.81; // m/s¬≤
  const vEff = Q / (C * A); // effective velocity through openings

  // Derived checks
if (!Number.isFinite(vEff) || vEff <= 0) {
  return showErrors([
    "‚ö†Ô∏è Computed effective velocity is invalid.",
    "üëâ Acceptable range: 0.05 ‚Äì 5.0 m/s for screen applications. Please recheck Flow Rate (Q), Area (A), and Coefficient (C)."
  ]);
}

if (vEff > 5) {
  return showErrors([
    "‚ö†Ô∏è Effective velocity is too high for screen design.",
    "üëâ Acceptable range: 0.05 ‚Äì 5.0 m/s."
  ]);
}


  // Advisory bands on approach/effective velocity
  if (vEff < 0.20) warnings.push("‚ö†Ô∏è Very low approach velocity (<0.20 m/s) ‚Äî debris capture may be poor; sedimentation risk upstream.");
  else if (vEff > 1.20 && vEff <= 3.00) warnings.push("‚ö†Ô∏è Elevated approach velocity (>1.20 m/s) ‚Äî increased head loss and carry-through risk.");
  else if (vEff > 3.00 && vEff <= 5.00) warnings.push("‚ö†Ô∏è High approach velocity (>3.00 m/s) ‚Äî check structural loads, noise, and erosion risk.");

  // Compute head loss
  const h = (1 / (2 * g)) * Math.pow(vEff, 2);

  if (!Number.isFinite(h) || h <= 0) {
    return showErrors(["‚ö†Ô∏è Computed head loss is invalid. Check inputs and units."]);
  }
  if (h > 5) {
    return showErrors([`üëâ Computed head loss h = ${h.toFixed(2)} m is unrealistically high for screens. Verify Q, C, A, and units.`]);
  }

  // Classification by head loss
  let statusMsg = "";
  if (h < 0.10) {
    statusMsg = "‚úÖ Minimal head loss ‚Äî screen likely clean and appropriately sized.";
  } else if (h <= 0.50) {
    statusMsg = "‚ö†Ô∏è Moderate head loss ‚Äî monitor trend; plan cleaning/backwash or confirm duty.";
  } else {
    statusMsg = "üî¥ High head loss ‚Äî potential clogging/undersizing; verify approach velocity and maintenance.";
  }

  // Extra advisories for safety audits (NPSH, overflow risk)
  if (h > 0.30) warnings.push("‚ö†Ô∏è For suction-fed systems (e.g., firewater), re-check NPSHa margin with this head loss.");
  if (h > 0.50) warnings.push("‚ö†Ô∏è Consider alarm/cleaning setpoint review; evaluate bypass or redundancy.");

  // Build details (inputs, derived)
  let details = `<div>Head Loss (h): <b>${h.toFixed(4)}</b> m</div>`;
  details += `<div>Effective Velocity v‚Çëff = Q/(C¬∑A): <b>${vEff.toFixed(4)}</b> m/s</div>`;
  details += `<div>Inputs ‚Äî Q: <b>${Q.toFixed(4)}</b> m¬≥/s, C: <b>${C.toFixed(3)}</b>, A: <b>${A.toFixed(4)}</b> m¬≤</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }

  // Update UI
  rateEl.textContent = h.toFixed(4);
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- /**
=======================================================
 Head Loss Calculator (Screens, Q‚ÄìC‚ÄìA Method)
=======================================================

 Formulae:
   v‚Çëff = Q / (C √ó A)         ‚Üí effective velocity through openings
   h    = v‚Çëff¬≤ / (2¬∑g)       ‚Üí head loss across screen

 where:
   ‚Ä¢ Q (m¬≥/s) = discharge
   ‚Ä¢ C (‚Äì)    = discharge coefficient (0 < C ‚â§ 1)
   ‚Ä¢ A (m¬≤)   = submerged open area
   ‚Ä¢ v‚Çëff (m/s) = effective velocity
   ‚Ä¢ h (m)   = head loss
   ‚Ä¢ g = 9.81 m/s¬≤

-------------------------------------------------------
 Input Validations
-------------------------------------------------------
 ‚Ä¢ Discharge Q (m¬≥/s):
   - Required, must be > 0
   - Error if not numeric
   - Warning if Q < 0.001 ‚Üí very small, noisy readings
   - Warning if Q > 50 ‚Üí very large, confirm units
   - Warning if > 3 decimals ‚Üí suggest rounding

 ‚Ä¢ Coefficient C (‚Äì):
   - Required, must be > 0 and ‚â§ 1
   - Error if outside (0, 1]
   - Warning if outside 0.40‚Äì0.80 ‚Üí atypical for clean screens
   - Warning if > 3 decimals ‚Üí suggest rounding

 ‚Ä¢ Open Area A (m¬≤):
   - Required, must be > 0
   - Error if not numeric
   - Warning if A < 0.01 ‚Üí very small, high fouling risk
   - Warning if A > 50 ‚Üí very large, check if channel/culvert
   - Warning if > 3 decimals ‚Üí suggest rounding

-------------------------------------------------------
 Derived / Relationship Checks
-------------------------------------------------------
 ‚Ä¢ Effective velocity v‚Çëff = Q / (C √ó A):
   - Must be finite and > 0
   - Error if v‚Çëff > 5 m/s (implausibly high for screens)
   - Warning if v‚Çëff < 0.20 ‚Üí very low, poor debris capture
   - Warning if 1.20 < v‚Çëff ‚â§ 3.00 ‚Üí elevated, higher head loss
   - Warning if 3.00 < v‚Çëff ‚â§ 5.00 ‚Üí high, check loads & erosion

-------------------------------------------------------
 Output Validations
-------------------------------------------------------
 ‚Ä¢ Head Loss h (m):
   - Must be finite and > 0
   - Error if h > 5 m ‚Üí unrealistically high for screens
   - Warning if h > 0.30 ‚Üí re-check NPSHa margin (suction systems)
   - Warning if h > 0.50 ‚Üí consider cleaning/bypass setpoints

-------------------------------------------------------
 Classification / Feedback
-------------------------------------------------------
 ‚Ä¢ h < 0.10 ‚Üí ‚úÖ Minimal head loss (clean, well-sized screen)
 ‚Ä¢ 0.10 ‚â§ h ‚â§ 0.50 ‚Üí ‚ö†Ô∏è Moderate head loss (monitor, plan maintenance)
 ‚Ä¢ h > 0.50 ‚Üí üî¥ High head loss (clogging/undersizing risk)

=======================================================
**/ -->


