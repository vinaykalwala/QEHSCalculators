{% extends 'base.html' %}
{% block title %}Rapid Mix & Flocculator Design Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapid Mix & Flocculator Design Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Rapid Mix & Flocculator Gt Calculator</h1>
    <p>Calculate the <strong>Velocity Gradient (G)</strong> and <strong>Gt value</strong> to assess mixing intensity in water/wastewater treatment systems.</p>
</div>

<div class="calc-content">
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="power">Power Input (P) [N·m/s]</label>
                <input type="number" id="power" class="form-input" step="any" min="0.01" placeholder="e.g., 500">
            </div>

            <div class="form-group">
                <label for="viscosity">Dynamic Viscosity (μ) [Pa·s]</label>
                <input type="number" id="viscosity" class="form-input" step="any" min="0.0001" placeholder="e.g., 0.001">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="volume">Tank Volume (V) [m³]</label>
                <input type="number" id="volume" class="form-input" step="any" min="0.01" placeholder="e.g., 10">
            </div>

            <div class="form-group">
                <label for="time">Mixing Time (t) [s]</label>
                <input type="number" id="time" class="form-input" step="any" min="1" placeholder="e.g., 30">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateGt()">Calculate G & Gt</button>
    </div>

    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Mixing illustration">
            <p>This tool calculates Velocity Gradient (G) and Gt for flocculation design.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated Results</h2>
            </div>

            <div class="rate-display" style="font-weight:bold; font-size:20px; margin-bottom:5px; color:#1560bd;">
                <div><b>Velocity Gradient (G):</b> <span id="GValue">0.00</span> s⁻¹</div>
                <div><b>Gt Value:</b> <span id="GtValue">0.00</span></div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator assesses <strong>mixing intensity</strong> in water/wastewater treatment by computing the <strong>velocity gradient (G)</strong> and <strong>Gt value</strong>. It helps engineers optimize coagulant/flocculation performance and ensure safe, compliant operations.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>P (N·m/s):</strong> Power input to the mixer.</li>
      <li><strong>μ (Pa·s):</strong> Fluid dynamic viscosity.</li>
      <li><strong>V (m³):</strong> Tank volume.</li>
      <li><strong>t (s):</strong> Mixing time.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>P (N·m/s):</strong> Required, 0.01 ≤ P ≤ 1,000,000 (typical: 10–10,000).</li>
      <li><strong>μ (Pa·s):</strong> Required, 0.0001 ≤ μ ≤ 1 (typical for water: ~0.001).</li>
      <li><strong>V (m³):</strong> Required, 0.01 ≤ V ≤ 10,000 (typical: 1–1,000).</li>
      <li><strong>t (s):</strong> Required, 1 ≤ t ≤ 3,600 (typical: 10–1,200).</li>
      <li><strong>Constraints:</strong> All inputs must be numeric; zeros or negatives invalid.</li>
      <li><strong>Advisories:</strong>
        <ul>
          <li>G > 1,000 s⁻¹: Risk of floc shear.</li>
          <li>Gt < 10,000: Under-mixing likely.</li>
          <li>Gt > 1,000,000: Excessive mixing risk.</li>
        </ul>
      </li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📏 Output Validations</h3>
    <ul class="note-list">
      <li><strong>Velocity Gradient (G):</strong> Displayed in s⁻¹ with 2 decimals.</li>
      <li><strong>Gt Value:</strong> Displayed in scientific notation with 2 decimal places.</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>Gt 10,000–100,000: Optimal mixing intensity.</li>
          <li>Gt < 10,000: Under-mixed — Increase energy or time.</li>
          <li>Gt > 100,000: Over-mixed — Reduce energy or time.</li>
        </ul>
      </li>
      <li>Warnings are triggered for extreme G or Gt values.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      Rapid mixer and flocculator design calculations adhere to various national and international standards, with the Indian Standard IS 7090 (1985) providing guidelines specifically for rapid mixing devices, and ISO standards and American Water Works Association (AWWA) manuals offering broad guidance for water and wastewater treatment plant design. Design criteria are also available in various national planning documents, such as the NITI for States report, and engineering handbooks like the Handbook of Civil Engineering Calculations.
    </p>
    <p><b>Indian Standards</b></p>
    <p><b>IS 7090 (1985):</b> This standard provides specific guidelines for the design of rapid mixing devices, which are used in the initial stage of water treatment.</p>
    <p><b>International Standards and Guidelines</b></p>
    <p><b>ISO Standards:</b> International Organization for Standardization (ISO) standards also provide guidance for various aspects of water treatment processes.</p>
    <p><b>AWWA Manuals:</b> The American Water Works Association (AWWA) publishes comprehensive manuals that are widely used for the design of water treatment plants.</p>
    <p><b>National and Regional Guidelines</b></p>
    <p><b>NITI for States:</b> The NITI for States report, for example, outlines design criteria for rapid mixing and flocculation units within the context of water treatment facilities, according to the NITI for States website.</p>
    <p><b>Other National Documents:</b> Other national and regional documents, such as the NCR Planning Board guidelines, provide design criteria for these units.</p>
    <p><b>Engineering Handbooks</b></p>
    <p><b>Handbook of Civil Engineering Calculations:</b> This handbook, published by McGraw-Hill Education - Access Engineering, offers calculation procedures and design information for rapid-mix and flocculation basins, according to the handbook.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides reliable estimates of mixing intensity (G and Gt) for rapid mixer and flocculator design, supporting <strong>water treatment optimization</strong>, <strong>compliance</strong>, and <strong>process efficiency</strong>. Ensure input values (P, μ, V, t) are accurate and validate with standards like IS 7090 (1985), AWWA manuals, or field data for critical applications to ensure effective and compliant water treatment.
    </p>
  </div>
</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateGt() {
    const P = parseFloat(document.getElementById("power")?.value.trim());
    const mu = parseFloat(document.getElementById("viscosity")?.value.trim());
    const V = parseFloat(document.getElementById("volume")?.value.trim());
    const t = parseFloat(document.getElementById("time")?.value.trim());

    const errors = [];
    const warnings = [];
    const GValueEl = document.getElementById("GValue");
    const GtValueEl = document.getElementById("GtValue");
    const feedbackEl = document.getElementById("feedbackContent");

    // Reset display
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    // Basic validations
    if (![P, mu, V, t].every(Number.isFinite)) {
        errors.push("All inputs must be numeric.");
    }
    if (P < 0.01 || P > 1e6) errors.push("Power must be ≥0.01 and ≤1,000,000 N·m/s.");
    if (mu < 0.0001 || mu > 1) errors.push("Viscosity must be ≥0.0001 and ≤1 Pa·s.");
    if (V < 0.01 || V > 10000) errors.push("Tank volume must be ≥0.01 and ≤10,000 m³.");
    if (t < 1 || t > 3600) errors.push("Mixing time must be ≥1 s and ≤3600 s.");
    if (errors.length) return showErrors(errors);

    // Compute G and Gt
    const G = Math.sqrt(P / (mu * V));
    const Gt = G * t;

    // Warnings for extremes
    if (G > 1000) warnings.push("⚠️ High G – risk of floc shear.");
    if (Gt < 1e4) warnings.push("⚠️ Low Gt – under-mixing likely.");
    if (Gt > 1e6) warnings.push("⚠️ High Gt – risk of excessive mixing.");

    // Classification
    let statusMsg = "";
    if (Gt >= 1e4 && Gt <= 1e5) {
        statusMsg = "✅ Optimal mixing intensity.";
    } else if (Gt < 1e4) {
        statusMsg = "⚠️ Under-mixed – increase energy or time.";
    } else {
        statusMsg = "⚠️ Over-mixed – reduce energy or time.";
    }

    // Display results with detailed feedback
    GValueEl.textContent = G.toFixed(2);
    GtValueEl.textContent = Gt.toExponential(2);
    feedbackEl.innerHTML = `
        <div style="margin-bottom:6px;"><strong>Status:</strong> ${statusMsg}</div>
        <div style="margin-bottom:4px;"><strong>Computed G:</strong> ${G.toFixed(2)} s⁻¹</div>
        <div style="margin-bottom:4px;"><strong>Computed Gt:</strong> ${Gt.toExponential(2)}</div>
        ${warnings.length ? '<div style="color:#b35d00; margin-top:4px;"><strong>Warnings:</strong> ' + warnings.join(" | ") + '</div>' : ''}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>



<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}

<!-- 
📌 G & Gt (Mixing Intensity) Calculator Notes

🔹 Purpose:
    Calculate the velocity gradient (G) and the product of G and mixing time (Gt) for stirred tanks, to assess mixing efficiency.

🔹 Inputs:
    • P   → Power input to the mixer (N·m/s)
    • μ   → Fluid viscosity (Pa·s)
    • V   → Tank volume (m³)
    • t   → Mixing time (s)

🔹 Input Validations:
    • All inputs must be numeric
    • Power: 0.01 ≤ P ≤ 1,000,000 N·m/s
    • Viscosity: 0.0001 ≤ μ ≤ 1 Pa·s
    • Volume: 0.01 ≤ V ≤ 10,000 m³
    • Time: 1 ≤ t ≤ 3600 s
    • Errors trigger early exit; warnings are shown for extreme but valid values

🔹 Core Calculations:
    • G  = √(P / (μ × V))  → velocity gradient (s⁻¹)
    • Gt = G × t            → mixing intensity over time

🔹 Warnings:
    • High G → risk of floc shear
    • Low Gt → under-mixing
    • High Gt → risk of over-mixing or excessive shear

🔹 Output Assessment:
    • Gt 1×10⁴ – 1×10⁵ → ✅ Optimal mixing intensity
    • Gt < 1×10⁴        → ⚠️ Under-mixed; increase energy or time
    • Gt > 1×10⁵        → ⚠️ Over-mixed; reduce energy or time

🔹 Display:
    • Computed G and Gt values
    • Status message based on Gt
    • Input summary for audit
    • Warnings highlighted in orange if applicable

-->
