{% extends 'base.html' %}
{% block title %}Gas Flux Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Flux Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover¬†effect¬†*/
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
  <h1>Gas Flux (Diffusion) Calculator</h1>
  <p>Compute gas flux across a landfill cover by steady diffusion. Result shown in <strong>g/(cm¬≤¬∑s)</strong> with a companion value in <strong>g/(m¬≤¬∑s)</strong>.</p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Parameters</h2>

    <div class="input-row">
      <div class="form-group">
        <label for="D">Diffusion Coefficient (D) ‚Äî cm¬≤/s *</label>
        <input type="number" id="D" class="form-input" step="any" min="0" placeholder="e.g., 0.05">
      </div>

      <div class="form-group">
        <label for="n">Porosity (n) ‚Äî cm¬≥/cm¬≥ *</label>
        <input type="number" id="n" class="form-input" step="any" min="0" max="0.85" placeholder="e.g., 0.35">
      </div>
    </div>

    <div class="input-row">
      <div class="form-group">
        <label for="Cs">Concentration at Surface (C<sub>surface</sub>) ‚Äî g/cm¬≥ *</label>
        <input type="number" id="Cs" class="form-input" step="any" min="0" placeholder="e.g., 1e-6">
      </div>

      <div class="form-group">
        <label for="Cb">Concentration at Bottom (C<sub>bottom</sub>) ‚Äî g/cm¬≥ *</label>
        <input type="number" id="Cb" class="form-input" step="any" min="0" placeholder="e.g., 5e-6">
      </div>
    </div>

    <div class="input-row">
      <div class="form-group">
        <label for="L">Cover Thickness (L) ‚Äî cm *</label>
        <input type="number" id="L" class="form-input" step="any" min="0" placeholder="e.g., 50">
      </div>
    </div>

    <button class="calculate-btn" onclick="calculateAdsorption()">Calculate Gas Flux</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Diffusion illustration">
      <p>This tool computes diffusive gas flux and reports effective diffusivity and direction (emission vs. ingress).</p>
    </div>

    <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
      <div class="error-icon">‚ùå</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue" aria-live="polite">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Gas Flux</h2>
      </div>

      <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
        <div class="rate-value" id="headLoss">0.00</div>
        <div class="rate-label" style="font-size:16px; color:#2980b9;">g/(cm¬≤¬∑s)</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>

      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      Computes one-dimensional steady diffusive gas flux through a porous landfill cover.
      Useful for emission screening, cap performance checks, fire/explosion risk (methane), and environmental compliance.
    </p>
  </div>

  <div class="note-card">
    <h3>‚öô Parameters Used</h3>
    <ul class="note-list">
      <li><b>D (cm¬≤/s):</b> Diffusion coefficient of the gas.</li>
      <li><b>n (cm¬≥/cm¬≥):</b> Porosity of the landfill cover.</li>
      <li><b>C<sub>surface</sub> (g/cm¬≥):</b> Gas concentration at the surface.</li>
      <li><b>C<sub>bottom</sub> (g/cm¬≥):</b> Gas concentration at the bottom.</li>
      <li><b>L (cm):</b> Thickness of the landfill cover.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
      <li><b>D (cm¬≤/s):</b> Required; 1√ó10‚Åª‚Å∂‚Äì10; warning if &lt;1√ó10‚Åª‚Åµ or &gt;1 (unusual for soils).</li>
      <li><b>n (cm¬≥/cm¬≥):</b> Required; 0.05‚Äì0.85; typical 0.20‚Äì0.60; must be &gt;0 and ‚â§0.85.</li>
      <li><b>C<sub>surface</sub>, C<sub>bottom</sub> (g/cm¬≥):</b> Required; 0‚Äì1√ó10‚Åª¬≤; warning if &gt;1√ó10‚Åª¬≥ (very high for gases).</li>
      <li><b>L (cm):</b> Required; 0.1‚Äì5,000; warning if &lt;5 or &gt;200 (very thin/thick covers).</li>
      <li><b>Decimals:</b> Up to 6 allowed; results rounded (flux to scientific notation and 3 sig-figs).</li>
      <li><b>Cross-checks:</b> If C<sub>surface</sub>=C<sub>bottom</sub> ‚Üí flux = 0; sign indicates direction (positive = emission upward).</li>
      <li><b>Output guardrails:</b> |N<sub>A</sub>| ‚â§ 1√ó10‚Åª¬≤ g/(cm¬≤¬∑s) (beyond this is non-physical for field covers).</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üìè Output Validations</h3>
    <ul class="note-list">
      <li><b>Negligible:</b> &lt; 1√ó10‚Åª‚Å∑ g/(cm¬≤¬∑s) (‚âà&lt; 1√ó10‚Åª¬≥ g/(m¬≤¬∑s)) ‚Äî Classification: Negligible; no significant flux.</li>
      <li><b>Low:</b> 1√ó10‚Åª‚Å∑ ‚Äì 1√ó10‚Åª‚Å∂ g/(cm¬≤¬∑s) ‚Äî Classification: Low; minimal emission or ingress.</li>
      <li><b>Moderate:</b> 1√ó10‚Åª‚Å∂ ‚Äì 1√ó10‚Åª‚Åµ g/(cm¬≤¬∑s) ‚Äî Classification: Moderate; may require monitoring.</li>
      <li><b>High:</b> &gt; 1√ó10‚Åª‚Åµ g/(cm¬≤¬∑s) ‚Äî Classification: High; consider mitigation/cover integrity.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>üìñ Governing Principle</h3>
    <p>
      A "Gas Flux Calculator" doesn't adhere to a single, universal standard, but rather uses various established standards for flow rate, such as Standard Cubic Feet per Minute (SCFM) or Normal Cubic Meters per Hour (Nm¬≥/h), which define specific conditions of temperature and pressure for measurement. The particular standard used depends on the calculator's intended application and the relevant industry or regulatory body, like the National Institute of Standards and Technology (NIST) or the Greenhouse Gas Protocol.
    </p>
    <p><b>Understanding the Standards</b></p>
    <p><b>SCFM:</b> This is a common standard in the U.S. and North America, representing a gas flow rate corrected to specific standard conditions of temperature (e.g., 60¬∞F or 70¬∞F) and pressure (e.g., 14.7 psi).</p>
    <p><b>Nm¬≥/h:</b> This is a metric equivalent, also defining a standard volumetric flow rate but using metric units.</p>
    <p><b>Other Standards:</b> Depending on the context, other standards may apply, such as specific industry guidelines like the SEMI F-32 standard or the greenhouse gas emission standards defined by the GHG Protocol.</p>
    <p><b>Why Standards Matter</b></p>
    <p><b>Consistent Comparison:</b> Standard conditions allow for the consistent comparison of gas flow rates across different systems and environments, regardless of the actual operating conditions.</p>
    <p><b>Precise Design:</b> These standards are crucial for the accurate design, sizing, and optimization of systems involving gas flow.</p>
    <p><b>Compliance:</b> They facilitate compliance with regulations and reporting requirements in various industries, such as process industries and HVAC.</p>
    <p><b>International Cooperation:</b> In multinational projects, standardizing flow measurements ensures clear communication and consistent data across different systems.</p>
  </div>

  <div class="note-card">
    <h3>üîö Conclusion</h3>
    <p>
      This calculator provides a reliable estimate of one-dimensional steady diffusive gas flux through a porous landfill cover, based on the provided parameters and applicable standards (e.g., SCFM or Nm¬≥/h). Ensure input values align with typical ranges and select the appropriate standard for your application to achieve accurate results and compliance with regulatory requirements.
    </p>
  </div>
</div>
</div>
<script>
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Kept name to preserve your button wiring */
function calculateAdsorption() {
  const sD = document.getElementById("D")?.value.trim();
  const sn = document.getElementById("n")?.value.trim();
  const sCs = document.getElementById("Cs")?.value.trim();
  const sCb = document.getElementById("Cb")?.value.trim();
  const sL = document.getElementById("L")?.value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const fluxEl = document.getElementById("headLoss");          // numeric box
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = (v) => Number.isFinite(v) && !Number.isNaN(v);
  const decLen = (s) => (s && s.includes(".")) ? s.split(".")[1].length : 0;

  // Presence & numeric
  if (!sD) errors.push("üëâ Enter D (diffusion coefficient).");
  if (!sn) errors.push("üëâ Enter n (porosity).");
  if (!sCs) errors.push("üëâ Enter C_surface (g/cm¬≥).");
  if (!sCb) errors.push("üëâ Enter C_bottom (g/cm¬≥).");
  if (!sL) errors.push("üëâ Enter L (cover thickness).");
  if (errors.length) return showErrors(errors);

  const D  = parseFloat(sD);
  const n  = parseFloat(sn);
  const Cs = parseFloat(sCs);
  const Cb = parseFloat(sCb);
  const L  = parseFloat(sL);

  if (!isFiniteNum(D))  errors.push("üëâ D must be numeric.");
  if (!isFiniteNum(n))  errors.push("üëâ n must be numeric.");
  if (!isFiniteNum(Cs)) errors.push("üëâ C_surface must be numeric.");
  if (!isFiniteNum(Cb)) errors.push("üëâ C_bottom must be numeric.");
  if (!isFiniteNum(L))  errors.push("üëâ L must be numeric.");
  if (errors.length) return showErrors(errors);

  // Hard limits & logic
if (D <= 0 || D < 0.000001 || D > 10) 
  errors.push("üëâ D must be within 0.000001‚Äì10 cm¬≤/s and > 0.");

if (n <= 0 || n > 0.85) 
  errors.push("üëâ Porosity (n) must be > 0 and ‚â§ 0.85.");

if (Cs < 0 || Cs > 0.01) 
  errors.push("üëâ C_surface must be between 0 and 0.01 g/cm¬≥.");

if (Cb < 0 || Cb > 0.01) 
  errors.push("üëâ C_bottom must be between 0 and 0.01 g/cm¬≥.");

if (L <= 0 || L < 0.1 || L > 5000) 
  errors.push("üëâ L must be within 0.1‚Äì5000 cm and > 0.");


  if (errors.length) return showErrors(errors);

  // QA: decimals
  if (decLen(sD)  > 6) warnings.push("‚ö†Ô∏è D has >6 decimals; results will be rounded.");
  if (decLen(sn)  > 6) warnings.push("‚ö†Ô∏è n has >6 decimals; results will be rounded.");
  if (decLen(sCs) > 6) warnings.push("‚ö†Ô∏è C_surface has >6 decimals; results will be rounded.");
  if (decLen(sCb) > 6) warnings.push("‚ö†Ô∏è C_bottom has >6 decimals; results will be rounded.");
  if (decLen(sL)  > 6) warnings.push("‚ö†Ô∏è L has >6 decimals; results will be rounded.");

  // Reasonableness warnings
  if (D < 1e-5 || D > 1) warnings.push("‚ö†Ô∏è Unusual D for soils (typical effective 1e-5‚Äì1 cm¬≤/s). Verify.");
  if (n < 0.2 || n > 0.6) warnings.push("‚ÑπÔ∏è Porosity outside typical 0.20‚Äì0.60 range.");
  if (Cs > 1e-3 || Cb > 1e-3) warnings.push("‚ö†Ô∏è Very high gas concentrations for field conditions.");
  if (L < 5) warnings.push("‚ö†Ô∏è Very thin cover (<5 cm): cracks/advective flow may dominate.");
  if (L > 200) warnings.push("‚ÑπÔ∏è Very thick cover (>200 cm): check stratification and moisture.");

  // Calculation (extracted formula)
  const deltaC = Cs - Cb;
  const Deff = D * Math.pow(n, 4/3);
  const NA = (Deff * deltaC) / L;            // g/(cm¬≤¬∑s)
  if (!isFiniteNum(NA)) return showErrors(["‚ö†Ô∏è Computed flux is invalid (check inputs)."]);
  if (Math.abs(NA) > 1e-2) return showErrors(["‚ö†Ô∏è |Flux| > 1√ó10‚Åª¬≤ g/(cm¬≤¬∑s) is non-physical for field covers. Recheck units."]);

  // Classification & direction
  const absNA = Math.abs(NA);
  let classTxt = "", color = "#2c7a7b";
  if (absNA < 1e-7) { classTxt = "Negligible"; color = "#006400"; }
  else if (absNA < 1e-6) { classTxt = "Low"; color = "#2c7a7b"; }
  else if (absNA < 1e-5) { classTxt = "Moderate"; color = "#b35d00"; }
  else { classTxt = "High"; color = "#b00020"; }

  const direction = (NA > 0) ? "Upward emission (surface loss)" : (NA < 0) ? "Downward ingress (cover uptake)" : "No net flux";

  // Convert to g/(m¬≤¬∑s)
  const NA_m2 = NA * 1e4;

  // Format small numbers nicely
  const fmtExp = (v, sig=3) => {
    if (v === 0) return "0";
    const abs = Math.abs(v);
    if (abs >= 1e-3 && abs < 1e3) return v.toPrecision(sig);
    return v.toExponential(sig-1);
    };

  // Render
  document.getElementById("headLoss").textContent = fmtExp(NA, 3);
  const details = `
    <div>Classification: <b style="color:${color}">${classTxt}</b> ‚Äî ${direction}</div>
    <div style="margin-top:6px;">Effective diffusivity D¬∑n<sup>4/3</sup>: <b>${fmtExp(Deff,3)}</b> cm¬≤/s</div>
    <div style="margin-top:6px;">ŒîC = C<sub>surface</sub> ‚àí C<sub>bottom</sub> = <b>${fmtExp(deltaC,3)}</b> g/cm¬≥</div>
    <div style="margin-top:6px;">Flux (g/(m¬≤¬∑s)): <b>${fmtExp(NA_m2,3)}</b></div>
    ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
  `;
  feedbackEl.innerHTML = details;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>

<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}

<!-- 
üìå Gas Diffusion Flux Calculator (through soil/cover)

Formulae:
 - ŒîC = C_surface ‚àí C_bottom
 - D_eff = D √ó n^(4/3)      [effective diffusivity]
 - N_A  = (D_eff √ó ŒîC) / L  [g/(cm¬≤¬∑s)]
 - Convert: N_A_m¬≤ = N_A √ó 1e4   [g/(m¬≤¬∑s)]

Inputs:
 - D  ‚Üí Diffusion coefficient [cm¬≤/s]
 - n  ‚Üí Porosity (dimensionless, 0‚Äì1)
 - C_surface (Cs) ‚Üí Gas concentration at surface [g/cm¬≥]
 - C_bottom (Cb) ‚Üí Gas concentration at bottom [g/cm¬≥]
 - L  ‚Üí Cover thickness [cm]

Outputs:
 - N_A ‚Üí Flux [g/(cm¬≤¬∑s)]
 - N_A_m¬≤ ‚Üí Flux [g/(m¬≤¬∑s)]
 - Effective diffusivity (D_eff) [cm¬≤/s]
 - Classification (Negligible / Low / Moderate / High)
 - Direction (Upward emission or Downward ingress)

Validations:
 - D: must be numeric, >0, within 0.000001 ‚Äì 10 cm¬≤/s
 - n: numeric, >0, ‚â§0.85
 - Cs, Cb: numeric, 0 ‚Äì 0.01 g/cm¬≥
 - L: numeric, >0, within 0.1 ‚Äì 5000 cm
 - Flux guardrails:
    ‚Ä¢ |N_A| must not exceed 1√ó10‚Åª¬≤ g/(cm¬≤¬∑s) (non-physical)
-->


