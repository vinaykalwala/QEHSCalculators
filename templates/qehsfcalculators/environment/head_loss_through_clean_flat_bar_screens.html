{% extends 'base.html' %}
{% block title %}Head Loss through Clean Flat Bar Screens Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Head Loss through Clean Flat Bar Screens Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
  <h1>Head Loss Through Clean Flat Bar Screens Calculator</h1>
  <p>Calculate the <strong>Head Loss (meters)</strong> across a clean flat bar screen from approach and through-screen velocities.</p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="v_before">Approach Velocity v (m/s)</label>
      <input type="number" id="v_before" class="form-input" min="0.0001" step="any" placeholder="e.g., 0.6">
    </div>

    <div class="form-group">
      <label for="v_through">Through-screen Velocity V (m/s)</label>
      <input type="number" id="v_through" class="form-input" min="0.0001" step="any" placeholder="e.g., 1.2">
    </div>
    
    <button class="calculate-btn" onclick="calculateHeadLoss()">Calculate Head Loss</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Head loss illustration">
      <p>This tool calculates <strong>Head Loss (m)</strong> across a clean flat bar screen using measured velocities.</p>
    </div>
    
    <div class="result-error hidden" id="resultError">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>
     
    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Calculated Head Loss</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="rateValue">0.000</div>
        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">m</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator estimates head loss across a <em>clean</em> flat bar screen from the approach velocity (before the screen) and
      the increased velocity through the bar openings. It supports hydraulic checks in intake channels, headworks and
      treatment facilities to control energy loss, avoid backwater effects, and maintain screening performance.
    </p>
  </div>
  <div class="note-card">
    <h3>❓ Parameters</h3>
    <ul class="note-list">
        <li><b>Approach Velocity v (m/s):</b> Flow velocity before reaching the screen; must be > 0; typical range 0.2–1.0 m/s for water/wastewater applications.</li>
        <li><b>Through-screen Velocity V (m/s):</b> Flow velocity through bar openings; must be > v; typical range 0.6–2.5 m/s for effective screening.</li>
        <li><b>Head Loss Formula:</b> h = 0.0729 × (V² – v²) - empirical formula for clean flat bar screens.</li>
        <li><b>Velocity Ratio:</b> V/v ratio indicates contraction severity; optimal range 1.05–4.0.</li>
    </ul>
</div>


  <div class="note-card">
    <h3>✅ Input Validations</h3>
    <ul>
      <li>✔️ <b>v</b> and <b>V</b> required, numeric, &gt; 0.</li>
      <li>✔️ <b>V &gt; v</b> for a constricted clean screen (otherwise hydraulically inconsistent).</li>
      <li>✔️ Typical ranges (water/wastewater): v ≈ 0.2–1.0 m/s, V ≈ 0.6–2.5 m/s (warnings outside).</li>
      <li>🛑 Reject if v or V &gt; 5 m/s (implausible for most channels) or non-finite.</li>
      <li>🛑 Reject if computed head loss h &gt; 3 m (sanity cap for screens).</li>
      <li>ℹ️ Precision: report to ≤ 3 decimals; excessive decimals prompt a rounding warning.</li>
      <li>ℹ️ Ratio check: 1.05 ≤ V/v ≤ 4 (warn outside; &gt; 4 suggests extreme contraction).</li>
    </ul>
  </div>
    <div class="note-card">
    <h3>📊 Ouput Validations</h3>
    <ul class="note-list">
      <li>h &lt; 0.30 m → ✅Low head loss — efficient screening and minimal upstream impact.</li>
      <li>0.30 ≤ h ≤ 1.50 m → ⚠️ Moderate head loss — acceptable; ensure adequate upstream freeboard.</li>
      <li>h &gt; 1.50 m → 🔴  High head loss — assess blinding risk, bar spacing, and hydraulic capacity.</li>
    </ul>
  </div>
  <div class="note-card formula-card">
    <h3>📐 Governing Principle</h3>
    <p>
        The Head loss through clean flat bar screens doesn't rely on a single "standard" calculator but is calculated using empirical formulas, most notably the Kirschmer equation or simplified versions based on the Bernoulli principle and continuity equation for a specific flow condition. The American Society of Civil Engineers (ASCE) also provides methods for these calculations, and specific standards like IS 11388 in India may also influence design practices for similar structures like trash racks.
    </p>

    <h3>Key Formulas and Concepts:</h3>
    <ul>
        <li><strong>Kirschmer Equation:</strong> Empirical formula for head loss:
            <br>hL = β * (w/b)^(4/3) * (v² / 2g) * sin θ
            <ul>
                <li>hL = head loss (m)</li>
                <li>β = bar shape factor (constant based on bar geometry)</li>
                <li>w = bar width (m)</li>
                <li>b = clear spacing between bars (m)</li>
                <li>v = approach velocity (m/s)</li>
                <li>g = acceleration due to gravity (9.81 m/s²)</li>
                <li>θ = bar inclination angle from horizontal</li>
            </ul>
        </li>
        <li><strong>Bernoulli & Continuity Principles:</strong> Simplified formulas estimate head loss from velocity changes:
            <ul>
                <li>HL ≈ k * (V² - v²), where V = velocity through screen, v = velocity before screen, k = constant</li>
                <li>Continuity equation Q = VA relates flow rate (Q), velocity (V), and area (A) to determine velocity through the screen</li>
            </ul>
        </li>
    </ul>

    <h3>Relevant Standards and Practices:</h3>
    <ul>
        <li><strong>American Society of Civil Engineers(ASCE):</strong> The ASCE method is another recognized approach for calculating head loss in bar screens.</li>
        <li><strong>Indian Standard (IS) 11388 (2012):</strong> While not a direct "calculator," standards like IS 11388 (2012) Recommendations for Design of Trash Racks for Intakes provide guidance on designing screens for water intakes, which shares similarities with wastewater bar screen design principles.</li>
    </ul>
</div>

<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator estimates <strong>head loss across clean flat bar screens</strong> to ensure proper hydraulic design 
        in intake structures and treatment facilities. Maintaining appropriate head loss (typically < 1.5 m) prevents 
        upstream flooding, ensures efficient debris removal, and minimizes energy consumption. Regular monitoring 
        and cleaning are essential as accumulated debris will significantly increase head loss beyond these clean-screen values. 
        Verify results against local design standards and specific screen manufacturer recommendations.
    </p>
</div>


</div>

<script>
/* Show error messages */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Core validation + calculation for head loss across clean flat bar screens */
function calculateHeadLoss() {
  const vRaw = document.getElementById("v_before").value.trim();
  const VRaw = document.getElementById("v_through").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required checks
  if (vRaw === "") errors.push("👉 Please enter approach velocity v (m/s).");
  if (VRaw === "") errors.push("👉 Please enter through-screen velocity V (m/s).");
  if (errors.length) return showErrors(errors);

  // Parse
  const v = parseFloat(vRaw);
  const V = parseFloat(VRaw);

  // Numeric + sign checks
  if (!Number.isFinite(v) || v <= 0) errors.push("👉 Approach velocity v must be a positive number (m/s).");
  if (!Number.isFinite(V) || V <= 0) errors.push("👉 Through-screen velocity V must be a positive number (m/s).");
  if (errors.length) return showErrors(errors);

  // Plausibility caps (reject)
  if (v > 5 || V > 5) return showErrors(["👉 Velocity exceeds plausible limits for typical channels (≤ 5 m/s). Verify units and inputs."]);

  // Relationship checks
  if (V <= v) return showErrors(["👉 Through-screen velocity must exceed approach velocity for a clean screen (V > v)."]);

  // Precision guidance
  const vDec = (String(v).split('.')[1] || '').length;
  const VDec = (String(V).split('.')[1] || '').length;
  if (vDec > 3 || VDec > 3) warnings.push("⚠️ High decimal precision — round inputs to ≤ 3 decimals for reporting.");

  // Typical range guidance
  if (v < 0.2) warnings.push("⚠️ v is very low for approach flow; confirm measurement and unit (m/s).");
  if (v > 1.0) warnings.push("⚠️ v is high; check for upstream constrictions or unit mismatch.");
  if (V < 0.6) warnings.push("⚠️ V is low for through-screen flow; confirm bar spacing/loading.");
  if (V > 2.5) warnings.push("⚠️ V is high; increased headloss and debris capture risk.");

  // Ratio check (constriction severity)
  const ratio = V / v;
  if (ratio < 1.05) warnings.push("⚠️ V≈v — minimal contraction; head loss should be small on a clean screen.");
  if (ratio > 4) warnings.push("⚠️ V/v ratio very high; indicates extreme contraction or unit error.");

  // Compute head loss (no formula displayed to user)
  const h = 0.0729 * (V * V - v * v);

  // Derived checks
  if (!Number.isFinite(h) || h < 0) {
    return showErrors(["⚠️ Computed head loss is invalid. Check inputs."]);
  }
  if (h > 3) {
    return showErrors([`👉 Computed head loss h = ${h.toFixed(3)} m is implausibly high for a clean bar screen. Verify inputs/units.`]);
  }

  // Classification
  let statusMsg = "";
  if (h < 0.30) {
    statusMsg = "✅ Low head loss — efficient screening and minimal upstream impact.";
  } else if (h <= 1.50) {
    statusMsg = "⚠️ Moderate head loss — acceptable; ensure adequate upstream freeboard.";
  } else {
    statusMsg = "🔴 High head loss — assess blinding risk, bar spacing, and hydraulic capacity.";
  }

  // Extra warnings based on result
  if (h < 0.01) warnings.push("⚠️ Head loss is near zero — ensure measurements were taken with a clean screen and stable flow.");

  // Build details (no formula display)
  let details = `<div>Head Loss (h): <b>${h.toFixed(3)}</b> m</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }

  // Update UI
  rateEl.textContent = h.toFixed(3);
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /**
=======================================================
 Head Loss Calculator (Clean Flat Bar Screens)
=======================================================

 Formula:
   h = 0.0729 × (V² – v²)

 where:
   • h (m) = head loss across the screen
   • v (m/s) = approach velocity
   • V (m/s) = through-screen velocity

-------------------------------------------------------
 Input Validations
-------------------------------------------------------
 • Approach velocity v (m/s):
   - Required (cannot be blank)
   - Must be numeric and > 0
   - Error if v > 5 (implausible for channels)
   - Warning if v < 0.2 → very low for approach flow
   - Warning if v > 1.0 → high, check constrictions/units
   - Warning if > 3 decimals → suggest rounding

 • Through-screen velocity V (m/s):
   - Required (cannot be blank)
   - Must be numeric and > 0
   - Error if V > 5 (implausible for channels)
   - Must satisfy V > v (clean screen assumption)
   - Warning if V < 0.6 → unusually low
   - Warning if V > 2.5 → high, increased headloss/debris risk
   - Warning if > 3 decimals → suggest rounding

-------------------------------------------------------
 Derived / Relationship Checks
-------------------------------------------------------
 • Velocity ratio (V/v):
   - Warning if < 1.05 → minimal contraction, low head loss
   - Warning if > 4 → extreme contraction, possible unit error

-------------------------------------------------------
 Output Validations
-------------------------------------------------------
 • Head Loss h (m):
   - Must be finite and ≥ 0
   - Error if h > 3 m → implausibly high for a clean screen
   - Warning if h < 0.01 → near zero, check clean screen and flow stability

-------------------------------------------------------
 Classification / Feedback
-------------------------------------------------------
 • h < 0.30 → ✅ Low head loss (efficient, minimal impact)
 • 0.30 ≤ h ≤ 1.50 → ⚠️ Moderate head loss (acceptable, check freeboard)
 • h > 1.50 → 🔴 High head loss (blinding risk, assess bar spacing & hydraulics)

=======================================================
**/ -->
