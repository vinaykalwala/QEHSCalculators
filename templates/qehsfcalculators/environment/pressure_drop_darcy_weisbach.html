{% extends 'base.html' %}
{% block title %}Pressure Drop Calculator (Darcy-Weisbach){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pressure Drop Calculator (Darcy-Weisbach)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Darcy-Weisbach Pressure Drop Calculator</h1>
    <p>Calculate pressure drop in pipes using the Darcy-Weisbach equation (result in Pascals).</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="frictionFactor">Friction Factor (f)</label>
                <input type="number" id="frictionFactor" class="form-input" step="0.001" min="0.005" placeholder="e.g., 0.02" aria-label="Friction factor">
            </div>

            <div class="form-group">
                <label for="pipeLength">Pipe Length (L, m)</label>
                <input type="number" id="pipeLength" class="form-input" step="any" min="0.1" placeholder="e.g., 100" aria-label="Pipe length">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="diameter">Pipe Diameter (D, m)</label>
                <input type="number" id="diameter" class="form-input" step="any" min="0.01" placeholder="e.g., 0.15" aria-label="Pipe diameter">
            </div>

            <div class="form-group">
                <label for="fluidDensity">Fluid Density (ρ, kg/m³)</label>
                <input type="number" id="fluidDensity" class="form-input" step="any" min="0.1" placeholder="e.g., 1000" aria-label="Fluid density">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="velocity">Flow Velocity (V, m/s)</label>
                <input type="number" id="velocity" class="form-input" step="any" min="0.01" placeholder="e.g., 2.5" aria-label="Flow velocity">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculatePressureDrop()">Calculate Pressure Drop</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Pipe flow illustration">
            <p>This tool calculates pressure drop in pipes using the Darcy-Weisbach equation.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Pressure Drop</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="headLoss">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">Pa</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">System Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<div class="note-section">
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator estimates the pressure drop (ΔP) in a pipe due to friction, which is critical for evaluating energy consumption, system efficiency, and operational safety in fluid transport systems.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li>Friction Factor (f): Dimensionless coefficient representing pipe friction</li>
            <li>Pipe Length (L): Length of the pipe segment (m)</li>
            <li>Pipe Diameter (D): Internal diameter of the pipe (m)</li>
            <li>Fluid Density (ρ): Density of the fluid (kg/m³)</li>
            <li>Flow Velocity (V): Velocity of the fluid (m/s)</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li>Friction Factor (f): 0.005 – 0.1</li>
            <li>Pipe Length (L): 0.1 – 10,000 m</li>
            <li>Pipe Diameter (D): 0.01 – 5 m</li>
            <li>Fluid Density (ρ): 0.1 – 2,000 kg/m³</li>
            <li>Flow Velocity (V): 0.01 – 25 m/s</li>
            <li>L/D ratio should be physically reasonable</li>
            <li>All inputs must be numeric; missing or out-of-range values trigger errors</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Output Validations & Assessment</h3>
        <ul class="note-list">
            <li>Pressure Drop (ΔP) displayed in Pa with 2 decimal places</li>
            <li>Feedback / operational assessment accompanies the result:
                <ul>
                    <li>Energy Efficiency:
                        <ul>
                            <li>ΔP &lt; 100 → ✅ Minimal friction loss; system efficient</li>
                            <li>100 ≤ ΔP &lt; 10,000 → ⚠️ Normal range; minor energy impact</li>
                            <li>10,000 ≤ ΔP &lt; 50,000 → ❌ High friction loss; higher energy use</li>
                            <li>ΔP ≥ 50,000 → ❌ Very high friction loss; energy use excessive</li>
                        </ul>
                    </li>
                    <li>Pipe Integrity & Safety:
                        <ul>
                            <li>ΔP &lt; 10,000 → ✅ Safe; low stress</li>
                            <li>10,000 ≤ ΔP &lt; 50,000 → ⚠️ Moderate stress; monitor long-term</li>
                            <li>ΔP ≥ 50,000 → ❌ High stress; potential for damage or failure</li>
                        </ul>
                    </li>
                    <li>Operational Risk:
                        <ul>
                            <li>ΔP &lt; 10,000 → ✅ Low risk; stable system</li>
                            <li>10,000 ≤ ΔP &lt; 50,000 → ⚠️ Medium risk; check pump capacity/flow</li>
                            <li>ΔP ≥ 50,000 → ❌ High risk; possible system failure</li>
                        </ul>
                    </li>
                    <li>Audit Compliance / QEHS:
                        <ul>
                            <li>ΔP ≤ 50,000 → ✅ Within recommended limits; compliant</li>
                            <li>ΔP &gt; 50,000 → ⚠️ Exceeds recommended friction loss; non-compliant</li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📚 Governing Principle</h3>
        <p>
            The Darcy-Weisbach equation itself is not tied to a single formal standard but is considered a universal, accurate, and standard method in fluid dynamics for calculating pressure and head loss, particularly when supplemented by the Moody chart or the Colebrook equation. While various organizations, like the NFPA, may specify its use in certain contexts, its underlying principle is a widely accepted scientific and engineering standard.
        </p>
        <ul>
            <li><strong>What it is:</strong> Empirical formula to calculate head/pressure loss in pipes due to viscous shear and fluid flow.</li>
            <li><strong>Key Components:</strong> Requires a friction factor based on Reynolds number and pipe roughness (Moody chart or Colebrook equation).</li>
            <li><strong>Accuracy:</strong> Most accurate and universally applicable formula for hydraulic engineers.</li>
            <li><strong>Standards & Application:</strong> Widely accepted in fluid mechanics; specific organizations like NFPA may specify its use.</li>
            <li><strong>Supplemented by Charts:</strong> Friction factor often obtained using Moody chart or Colebrook function for turbulent flow.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🏁 Conclusion</h3>
        <p>
            This calculator provides reliable pressure drop estimates in pipes, along with operational feedback and risk assessment.
            Including energy efficiency, pipe integrity, operational risk, and QEHS compliance ensures the system is evaluated holistically and safely.
        </p>
    </div>
</div>


<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculatePressureDrop() {
    const f = parseFloat(document.getElementById("frictionFactor")?.value.trim());
    const L = parseFloat(document.getElementById("pipeLength")?.value.trim());
    const D = parseFloat(document.getElementById("diameter")?.value.trim());
    const rho = parseFloat(document.getElementById("fluidDensity")?.value.trim());
    const V = parseFloat(document.getElementById("velocity")?.value.trim());

    const headLossEl = document.getElementById("headLoss");
    const feedbackEl = document.getElementById("feedbackContent");
    const errors = [];
    const feedback = [];

    feedbackEl.innerHTML = "";
    document.getElementById("resultError").classList.add("hidden");

    // Input Validations
    if (![f, L, D, rho, V].every(Number.isFinite)) errors.push("All inputs are required and must be numeric.");
    if (f < 0.005 || f > 0.1) errors.push("Friction factor (f) must be 0.005 – 0.1.");
    if (L < 0.1 || L > 10000) errors.push("Pipe length (L) must be 0.1 – 10,000 m.");
    if (D < 0.01 || D > 5) errors.push("Pipe diameter (D) must be 0.01 – 5 m.");
    if (rho < 0.1 || rho > 2000) errors.push("Fluid density (ρ) must be 0.1 – 2,000 kg/m³.");
    if (V < 0.01 || V > 25) errors.push("Flow velocity (V) must be 0.01 – 25 m/s.");
    if (errors.length) return showErrors(errors);

    // Pressure drop calculation
    const deltaP = f * (L / D) * (rho * V * V / 2);
    headLossEl.textContent = deltaP.toFixed(2);

    // Feedback assessments
    // 1. Energy Efficiency
    if (deltaP < 100) feedback.push("✅ Energy Efficiency: Minimal friction loss; system operates efficiently.");
    else if (deltaP < 10000) feedback.push("⚠️ Energy Efficiency: Normal range; minor energy impact expected.");
    else if (deltaP < 50000) feedback.push("❌ Energy Efficiency: High friction loss; may increase energy consumption.");
    else feedback.push("❌ Energy Efficiency: Very high friction loss; energy use likely excessive.");

    // 2. Pipe Integrity & Safety
    if (deltaP < 10000) feedback.push("✅ Pipe Integrity: Safe operating pressures; low risk of stress.");
    else if (deltaP < 50000) feedback.push("⚠️ Pipe Integrity: Moderate stress; monitor for long-term wear.");
    else feedback.push("❌ Pipe Integrity: High stress; potential for damage or failure, review urgently.");

    // 3. Operational Risk
    if (deltaP < 10000) feedback.push("✅ Operational Risk: Low risk; system stable.");
    else if (deltaP < 50000) feedback.push("⚠️ Operational Risk: Medium risk; check pump capacity and flow.");
    else feedback.push("❌ Operational Risk: High risk; system may fail under prolonged operation.");

    // 4. Audit Compliance / QEHS
    if (deltaP > 50000) feedback.push("⚠️ QEHS Note: Exceeds recommended friction loss; non-compliant with safety guidelines.");
    else feedback.push("✅ QEHS Note: Within recommended limits; compliant.");

    // Display feedback
    feedbackEl.innerHTML = `<div><b>Pressure Drop (ΔP):</b> ${deltaP.toFixed(2)} Pa</div>
                            <ul style="margin-top:6px; padding-left:20px;">
                                ${feedback.map(f => `<li>${f}</li>`).join('')}
                            </ul>`;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) {
        const now = new Date();
        el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }
    window.print();
}
</script>
</script>



<script src="{% static 'js/print.js' %}"></script>

</body>
</html>
{% endblock %}


<!--
  🔹 Pipe Friction Pressure Drop Calculator - Formula & Validations

  1️⃣ Formula:
      ΔP = f * (L / D) * (ρ * V² / 2)

      where:
        • ΔP = Pressure drop due to friction (Pa)
        • f = Darcy friction factor (dimensionless)
        • L = Pipe length (m)
        • D = Pipe diameter (m)
        • ρ = Fluid density (kg/m³)
        • V = Flow velocity (m/s)

  2️⃣ Inputs:
      - Friction Factor (f): numeric, 0.005 – 0.1
      - Pipe Length (L): numeric, 0.1 – 10,000 m
      - Pipe Diameter (D): numeric, 0.01 – 5 m
      - Fluid Density (ρ): numeric, 0.1 – 2,000 kg/m³
      - Flow Velocity (V): numeric, 0.01 – 25 m/s
      - All inputs must be numeric; missing or out-of-range values produce an error.

  3️⃣ Outputs & Validations:
      - Pressure Drop (ΔP) in Pa (2 decimal places)
      - Feedback / Operational Assessment:
          1. Energy Efficiency:
              • ΔP < 100 → Minimal friction loss
              • 100 ≤ ΔP < 10,000 → Normal
              • 10,000 ≤ ΔP < 50,000 → High friction loss
              • ΔP ≥ 50,000 → Very high friction loss
          2. Pipe Integrity & Safety:
              • ΔP < 10,000 → Safe
              • 10,000 ≤ ΔP < 50,000 → Moderate stress
              • ΔP ≥ 50,000 → High stress
          3. Operational Risk:
              • ΔP < 10,000 → Low risk
              • 10,000 ≤ ΔP < 50,000 → Medium risk
              • ΔP ≥ 50,000 → High risk
          4. Audit Compliance / QEHS:
              • ΔP ≤ 50,000 → Compliant
              • ΔP > 50,000 → Non-compliant / safety risk
-->
