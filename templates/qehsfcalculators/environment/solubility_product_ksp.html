{% extends 'base.html' %}
{% block title %}Solubility Product (Ksp) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solubility Product (Ksp) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Solubility Product (Ksp) Calculator</h1>
        <p>Calculate the solubility product constant for sparingly soluble salts using ion concentrations and stoichiometric coefficients.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="input-row">
                <div class="form-group">
                    <label for="cationConc">Cation Concentration [A⁺] (mol/L)</label>
                    <input type="number" id="cationConc" class="form-input" step="any" min="0" placeholder="e.g., 0.01">
                </div>
                <div class="form-group">
                    <label for="cationStoich">Cation Stoichiometric Coefficient (a)</label>
                    <input type="number" id="cationStoich" class="form-input" step="1" min="1" placeholder="e.g., 2">
                </div>
            </div>

            <div class="input-row">
                <div class="form-group">
                    <label for="anionConc">Anion Concentration [B⁻] (mol/L)</label>
                    <input type="number" id="anionConc" class="form-input" step="any" min="0" placeholder="e.g., 0.005">
                </div>
                <div class="form-group">
                    <label for="anionStoich">Anion Stoichiometric Coefficient (b)</label>
                    <input type="number" id="anionStoich" class="form-input" step="1" min="1" placeholder="e.g., 3">
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateKsp()">Calculate Ksp</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Chemistry illustration">
                <p>This tool calculates the solubility product constant (Ksp) for environmental and safety applications.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Solubility Product Constant (Ksp)</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="kspValue">0.000</div>
                    <div class="rate-unit">(mol/L)<sup id="totalExponent">a+b</sup></div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes -->
    <div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Solubility Product Constant (Ksp) Calculator</strong> evaluates the equilibrium between a sparingly soluble salt and its ions in solution. 
            Ksp is a critical parameter in environmental chemistry, water treatment, and pollution control, helping predict scaling potential, 
            heavy metal mobility, and treatment efficiency.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>[A⁺] (Cation Concentration):</strong> Equilibrium concentration of the positive ion in mol/L.</li>
            <li><strong>[B⁻] (Anion Concentration):</strong> Equilibrium concentration of the negative ion in mol/L.</li>
            <li><strong>a (Cation Coefficient):</strong> Stoichiometric coefficient from the balanced dissolution equation (must be ≥ 1).</li>
            <li><strong>b (Anion Coefficient):</strong> Stoichiometric coefficient from the balanced dissolution equation (must be ≥ 1).</li>
        </ul>
    </div>


    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li><strong>Cation Concentration:</strong> Must be ≥ 0 mol/L (realistic concentration range: 0 to 10 mol/L).</li>
            <li><strong>Anion Concentration:</strong> Must be ≥ 0 mol/L (realistic concentration range: 0 to 10 mol/L).</li>
            <li><strong>Stoichiometric Coefficients:</strong> Must be integers ≥ 1 (typical range: 1-4).</li>
            <li><strong>Non-Zero Requirement:</strong> At least one ion concentration must be > 0.</li>
            <li><strong>Numeric Checks:</strong> All fields are required and must be valid numbers.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Ksp must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>Ksp > 1:</strong> ✅ Highly soluble, compound readily dissolves (e.g., NaCl, KNO₃).</li>
            <li><strong>1e-5 < Ksp ≤ 1:</strong> ⚠️ Moderately soluble, Moderate dissolution(e.g., CaSO₄, Ag₂SO₄).</li>
            <li><strong>1e-10 < Ksp ≤ 1e-5:</strong> ⚠️ Sparingly soluble, Limited dissolution (e.g., CaCO₃, BaSO₄).</li>
            <li><strong>Ksp ≤ 1e-10:</strong> ❌ Very insoluble, Minimal dissolution (e.g., PbS, HgS) — may require strong chelators.</li>
            <li><strong>Ksp = 0:</strong> ℹ️ No ions in solution (both concentrations zero).</li>
        </ul>
    </div>

<div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
        A solubility product (Ksp) calculator uses the standard definition of the solubility product constant, which is the equilibrium constant for the dissociation of a sparingly soluble salt in a saturated aqueous solution. It is based on the concept of solubility equilibrium, which holds for a specific temperature, most commonly at the standard temperature of 298 K (25°C). Therefore, a Ksp calculator functions according to the standard definition of equilibrium constants, rather than a specific "standard" in terms of quality or measurement.
    </p>

    <h3>What it Means for a Ksp Calculator to be "Standard"</h3>
    <ul class="note-list">
        <li><strong>Standard Definition:</strong> The value it calculates is the solubility product constant, a standard thermodynamic quantity defined as the product of the concentrations of the ions in a saturated solution.</li>
        <li><strong>Standard Conditions (Temperature):</strong> Ksp values are highly dependent on temperature. Unless specified otherwise, a calculator is typically designed for the standard conditions of 298 K (25°C).</li>
        <li><strong>Equilibrium:</strong> The calculator determines Ksp by using the principle of solubility equilibrium, where the rate of dissolution equals the rate of precipitation.</li>
    </ul>

    <h3>How it's Applied</h3>
    <p>
        When using a Ksp calculator, the user provides either the solubility of the salt or the ionic concentrations at equilibrium. The calculator then applies the formula:
    </p>
    <p><strong>Ksp = [ion₁] × [ion₂]</strong> (for a 1:1 salt), or a similar expression for more complex salts, to determine the solubility product.</p>
</div>
<div class="note-card">
    <h3>💡 Conclusion</h3>
    <p>
        This calculator determines the <strong>solubility product constant (Ksp)</strong>, a fundamental parameter 
        for predicting salt dissolution behavior in environmental systems. Ksp values help assess scaling potential, 
        heavy metal mobility, and treatment efficiency in water and wastewater applications. The calculated constant 
        should be interpreted within the context of specific environmental conditions, temperature effects, and 
        regulatory guidelines to ensure accurate predictions of solubility behavior and effective pollution control.
    </p>
</div>
</div>
<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateKsp() {
    // Read values
    const cationConc = parseFloat(document.getElementById("cationConc").value);
    const anionConc = parseFloat(document.getElementById("anionConc").value);
    const cationStoich = parseInt(document.getElementById("cationStoich").value);
    const anionStoich = parseInt(document.getElementById("anionStoich").value);

    const kspValueEl = document.getElementById("kspValue");
    const totalExponentEl = document.getElementById("totalExponent");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![cationConc, anionConc, cationStoich, anionStoich].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    if (cationConc < 0) errors.push("👉 Cation concentration must be ≥ 0 mol/L.");
    if (anionConc < 0) errors.push("👉 Anion concentration must be ≥ 0 mol/L.");
    if (cationConc === 0 && anionConc === 0) errors.push("👉 At least one ion concentration must be > 0.");
    if (cationStoich < 1) errors.push("👉 Cation coefficient must be ≥ 1.");
    if (anionStoich < 1) errors.push("👉 Anion coefficient must be ≥ 1.");
    
    // Warning for unusually high concentrations
    if (cationConc > 10) warnings.push("⚠️ Cation concentration unusually high (>10 mol/L).");
    if (anionConc > 10) warnings.push("⚠️ Anion concentration unusually high (>10 mol/L).");
    
    // Warning for high stoichiometric coefficients
    if (cationStoich > 4) warnings.push("⚠️ Cation coefficient unusually high (>4).");
    if (anionStoich > 4) warnings.push("⚠️ Anion coefficient unusually high (>4).");

    if (errors.length) return showErrors(errors);

    // Formula: Ksp = [A⁺]ᵃ × [B⁻]ᵇ
    const ksp = Math.pow(cationConc, cationStoich) * Math.pow(anionConc, anionStoich);
    const totalExponent = cationStoich + anionStoich;

    if (!Number.isFinite(ksp)) {
        return showErrors(["⚠️ Computed Ksp value is invalid (possible overflow)."]);
    }

    // Format Ksp output
    let formattedKsp;
    if (ksp === 0) {
        formattedKsp = '0';
    } else if (ksp < 1e-4 || ksp >= 1e6) {
        formattedKsp = ksp.toExponential(4);
    } else {
        formattedKsp = parseFloat(ksp.toFixed(6)).toString();
    }

    // Classification
    let classification, suggestion, color;
    if (ksp > 1) {
        classification = "Highly Soluble";
        suggestion = "✅ Compound readily dissolves (e.g., NaCl, KNO₃).";
        color = "#2e7d32";
    } else if (ksp > 1e-5) {
        classification = "Moderately Soluble";
        suggestion = "⚠️ Moderate dissolution (e.g., CaSO₄, Ag₂SO₄).";
        color = "#f9a825";
    } else if (ksp > 1e-10) {
        classification = "Sparingly Soluble";
        suggestion = "⚠️ Limited dissolution (e.g., CaCO₃, BaSO₄).";
        color = "#e65100";
    } else {
        classification = "Very Insoluble";
        suggestion = "❌ Minimal dissolution (e.g., PbS, HgS) — may require strong chelators.";
        color = "#c62828";
    }

    // Display result
    kspValueEl.textContent = formattedKsp;
    totalExponentEl.textContent = totalExponent;
    feedbackEl.innerHTML = `
        <div>K<sub>sp</sub> = <b>${formattedKsp}</b> (mol/L)<sup>${totalExponent}</sup></div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

Input Validations:
Cation Concentration: Must be ≥ 0 mol/L (realistic range: 0-10 mol/L)

Anion Concentration: Must be ≥ 0 mol/L (realistic range: 0-10 mol/L)

Stoichiometric Coefficients: Must be integers ≥ 1 (typical range: 1-4)

Non-Zero Requirement: At least one ion concentration must be > 0

Numeric Checks: All fields must contain valid numbers
-----------------------------------------------------------------------
Output Validations:
Ksp must be finite: NaN or Infinity indicates invalid inputs

Ksp > 1: Highly soluble compound

1e-5 < Ksp ≤ 1: Moderately soluble

1e-10 < Ksp ≤ 1e-5: Sparingly soluble

Ksp ≤ 1e-10: Very insoluble

Ksp = 0: No ions in solution
-------------------------------------------------------------------------
Edge Cases:
Extremely low concentrations (near zero)

Extremely high concentrations (>10 mol/L)

Large stoichiometric coefficients (>4)

Very small Ksp values (<1e-30)

Combination leading to numerical overflow
--------------------------------------------------------------------------------
The code calculates the Solubility Product Constant (Ksp) using the standard equilibrium expression for sparingly soluble salts:

Formula
text
Ksp = [A⁺]ᵃ × [B⁻]ᵇ
Variables
[A⁺] = Cation concentration (in mol/L)

[B⁻] = Anion concentration (in mol/L)

a = Cation stoichiometric coefficient (from the balanced dissolution equation)

b = Anion stoichiometric coefficient (from the balanced dissolution equation)


-->