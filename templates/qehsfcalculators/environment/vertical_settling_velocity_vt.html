{% extends 'base.html' %}
{% block title %}Vertical Settling Velocity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertical Settling Velocity Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">

{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Vertical Settling Velocity Calculator</h1>
    <p>Calculate the settling velocity of particles in a fluid using Stokes' Law (result shown in meters per second).</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="particleDensity">Particle Density (ρₚ, kg/m³)</label>
                <input type="number" id="particleDensity" class="form-input" step="any" min="0" placeholder="e.g., 2650" aria-label="Particle density">
            </div>

            <div class="form-group">
                <label for="fluidDensity">Fluid Density (ρ, kg/m³)</label>
                <input type="number" id="fluidDensity" class="form-input" step="any" min="0" placeholder="e.g., 1000" aria-label="Fluid density">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="gravity">Gravity (g, m/s²)</label>
                <input type="number" id="gravity" class="form-input" step="any" min="0" value="9.81" placeholder="e.g., 9.81" aria-label="Gravity">
            </div>

            <div class="form-group">
                <label for="particleDiameter">Particle Diameter (d, m)</label>
                <input type="number" id="particleDiameter" class="form-input" step="any" min="0" placeholder="e.g., 0.0001" aria-label="Particle diameter">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="viscosity">Dynamic Viscosity (μ, Pa·s)</label>
                <input type="number" id="viscosity" class="form-input" step="any" min="0" value="0.001" placeholder="e.g., 0.001" aria-label="Dynamic viscosity">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateSettlingVelocity()">Calculate Settling Velocity</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Particle settling illustration">
            <p>This tool calculates the settling velocity of particles in a fluid using Stokes' Law.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Settling Velocity</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="settlingVelocity">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">m/s</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator determines the settling velocity of particles in a fluid using Stokes' Law principles and related methods. 
            It calculates the terminal velocity at which a particle settles under gravity, which is essential for designing sedimentation systems, wastewater treatment processes, and environmental impact assessments.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Particle Density (ρₚ):</strong> Mass per unit volume of the particle (kg/m³), e.g., sand ≈ 2650.</li>
            <li><strong>Fluid Density (ρ):</strong> Mass per unit volume of the fluid (kg/m³), e.g., water ≈ 1000.</li>
            <li><strong>Gravity (g):</strong> Acceleration due to gravity (m/s²), standard ≈ 9.81.</li>
            <li><strong>Particle Diameter (d):</strong> Size of the particle (m), e.g., 1×10⁻⁶–0.005 m.</li>
            <li><strong>Dynamic Viscosity (μ):</strong> Fluid’s resistance to flow (Pa·s), e.g., water ≈ 0.001.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Particle Density (ρₚ):</strong> Must be <em>greater than 0</em> and ≤ 20,000 kg/m³ (typical range: 800–8,000 kg/m³).</li>
            <li><strong>Fluid Density (ρ):</strong> Must be <em>greater than 0</em> and ≤ 20,000 kg/m³ (typical range: 800–1,300 kg/m³).</li>
            <li><strong>Gravity (g):</strong> Must be <em>greater than 0</em>; typically 9.81 m/s² for Earth.</li>
            <li><strong>Particle Diameter (d):</strong> Must be <em>greater than 0</em> and ≤ 0.01 m (typical range: 1×10⁻⁶ to 0.005 m).</li>
            <li><strong>Dynamic Viscosity (μ):</strong> Must be <em>greater than 0</em> and ≤ 100 Pa·s (typical range: 0.00089–1.5 Pa·s).</li>
            <li><strong>Particle density must be greater than fluid density</strong> for settling to occur.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📊 Output Validations</h3>
        <ul class="note-list">
            <li>Settling velocity (vₜ) is shown in <strong>m/s</strong> with 6 decimal precision.</li>
            <li><strong>Feedback based on velocity:</strong>
                <ul>
                    <li><span class="good">Fast Settling (vₜ > 0.1 m/s):</span> ✅ The particle settles quickly, ideal for separation in sedimentation tanks and clarifiers.</li>
                    <li><span class="average">Moderate Settling (0.001 ≤ vₜ ≤ 0.1 m/s):</span> ⚠️ The particle settles at a moderate rate, which may require longer retention times in sedimentation systems.</li>
                    <li><span class="bad">Slow Settling (vₜ < 0.001 m/s):</span> 🔴 The particle may remain suspended for extended periods. Consider coagulation, flocculation, or filtration for removal.</li>
                </ul>
            </li>
            <li>Errors are displayed if inputs are missing, negative, unrealistic, or if ρₚ ≤ ρ (no settling possible).</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            Calculating vertical settling velocity does not rely on a single standard but applies physical laws based on particle size, fluid properties, and the particle Reynolds number (Reₚ). 
            The calculator selects the appropriate law (Stokes, Intermediate, or Newton) according to the flow regime:
        </p>
        <ul class="note-list">
            <li><strong>Stokes' Law:</strong> For small, spherical particles at low Reₚ (&lt;1). Drag is dominated by viscous forces.</li>
            <li><strong>Intermediate Law:</strong> For Reₚ between ~1 and 1000; drag coefficient determined empirically, accounting for viscous and inertial forces.</li>
            <li><strong>Newton's Law:</strong> For large particles at high Reₚ (&gt;1000); inertial forces dominate, drag coefficient ~0.44.</li>
            <li><strong>Hindered Settling:</strong> For concentrated suspensions, the settling velocity is reduced based on solid volume fraction.</li>
            <li>The calculator applies conditional logic using Reₚ to select the correct regime and provide an accurate settling velocity.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔚 Conclusion</h3>
        <p>
            The <strong>Vertical Settling Velocity Calculator</strong> predicts how fast particles settle in a fluid. 
            Higher velocities indicate easier separation, while lower velocities suggest additional treatment (coagulation, flocculation, filtration). 
            This tool is essential for <strong>environmental engineering, wastewater treatment, and process design</strong>, helping ensure accurate predictions and improved system efficiency.
        </p>
    </div>

</div>


<script>
    function calculateSettlingVelocity() {
        // Get input values
        const rho_p = parseFloat(document.getElementById("particleDensity").value);
        const rho = parseFloat(document.getElementById("fluidDensity").value);
        const g = parseFloat(document.getElementById("gravity").value);
        const d = parseFloat(document.getElementById("particleDiameter").value);
        const mu = parseFloat(document.getElementById("viscosity").value);
        
        // Get result elements
        const placeholder = document.getElementById("placeholder");
        const resultError = document.getElementById("resultError");
        const resultValue = document.getElementById("resultValue");
        const errorMessage = document.getElementById("errorMessage");
        const settlingVelocity = document.getElementById("settlingVelocity");
        const feedbackContent = document.getElementById("feedbackContent");
        
        // Hide previous results
        placeholder.classList.add("hidden");
        resultError.classList.add("hidden");
        resultValue.classList.add("hidden");
        
        // Validate inputs
        if (isNaN(rho_p) || isNaN(rho) || isNaN(g) || isNaN(d) || isNaN(mu)) {
            showError("Please enter valid numbers for all fields.");
            return;
        }
        
        // Validate positive values
        if (rho_p <= 0 || rho <= 0 || g <= 0 || d <= 0 || mu <= 0) {
            showError("All values must be positive numbers greater than zero.");
            return;
        }
        
        // Validate particle density > fluid density
        if (rho_p <= rho) {
            showError("Particle density must be greater than fluid density for settling to occur.");
            return;
        }
        
        // Validate realistic ranges
        if (rho_p > 20000) {
            showError("Particle density is unrealistically high. Maximum allowed is 20,000 kg/m³.");
            return;
        }
        
        if (rho > 20000) {
            showError("Fluid density is unrealistically high. Maximum allowed is 20,000 kg/m³.");
            return;
        }
        
        if (d > 0.01) {
            showError("Particle diameter is too large for Stokes' Law. Maximum allowed is 0.01 m (10 mm).");
            return;
        }
        
        if (mu > 100) {
            showError("Dynamic viscosity is unrealistically high. Maximum allowed is 100 Pa·s.");
            return;
        }
        
        // Calculate settling velocity
        const numerator = (rho_p - rho) * g * Math.pow(d, 2);
        const denominator = 18 * mu;
        
        if (denominator === 0) {
            showError("Dynamic viscosity cannot be zero.");
            return;
        }
        
        const vt = numerator / denominator;
        
        // Display result
        settlingVelocity.textContent = vt.toFixed(6);
        
        // Provide feedback based on settling velocity
        if (vt > 0.1) {
            feedbackContent.innerHTML = `<span class="good">Fast Settling:</span> The particle settles quickly, which is ideal for separation processes in sedimentation tanks and clarifiers.`;
        } else if (vt >= 0.001) {
            feedbackContent.innerHTML = `<span class="average">Moderate Settling:</span> The particle settles at a moderate rate. This may require longer retention times in sedimentation systems.`;
        } else {
            feedbackContent.innerHTML = `<span class="bad">Slow Settling:</span> The particle may stay suspended for extended periods. Consider coagulation/flocculation or filtration for removal.`;
        }
        
        resultValue.classList.remove("hidden");
    }
    
    function showError(message) {
        const errorMessage = document.getElementById("errorMessage");
        const resultError = document.getElementById("resultError");
        const placeholder = document.getElementById("placeholder");
        
        errorMessage.textContent = message;
        placeholder.classList.add("hidden");
        resultError.classList.remove("hidden");
    }
    
    function printReport() {
        window.print();
    }
</script>

  <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
------------------------------------------------------------------------------
Updated Formula: Implemented the Stokes' Law 
formula: vₜ = [(ρₚ - ρ) × g × d²] / (18 × μ)
------------------------------------------------------------------------
Enhanced Validations:

All inputs must be positive numbers

Particle density must be greater than fluid density

Realistic range checks for all parameters

Division by zero prevention for viscosity

Improved Result Display:

Settling velocity shown with appropriate precision (6 decimal places)

Contextual feedback based on settling speed (fast, moderate, slow)

Error messages with specific guidance



-->