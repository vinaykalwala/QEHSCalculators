{% extends 'base.html' %}
{% block title %}Sensible Heat Gain from People Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensible Heat Gain from People Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        /* Unit selector styles */
        .unit-selector {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div class="btn-container">
    <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
</div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>Sensible Heat Gain from People Calculator</h1>
        <p>Calculate the sensible heat gain from people in indoor environments for HVAC system design and energy optimization.</p>
    </div>

    <div class="calc-content">
        <!-- Input Card -->
        <div class="calc-card">
            <h2>Enter Parameters</h2>

            <div class="form-group">
                <label for="num_people">Number of People</label>
                <input type="number" id="num_people" class="form-input" step="1" min="1" placeholder="e.g., 25">
            </div>
            
            <div class="form-group">
                <label for="heat_gain">Sensible Heat Gain per Person (Btu/hr)</label>
                <input type="number" id="heat_gain" class="form-input" step="any" min="200" max="800" placeholder="e.g., 250">
            </div>
            
            <div class="form-group">
                <label for="clf">Cooling Load Factor (CLF)</label>
                <input type="number" id="clf" class="form-input" step="0.01" min="0.1" max="1.0" placeholder="e.g., 0.85">
                <small style="color: #f1f5f9;">Range: 0.1 to 1.0 (dimensionless)</small>
            </div>

            <button class="calculate-btn" onclick="calculateHeatGain()">Calculate Sensible Heat Gain</button>
        </div>

        <!-- Result Card -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="Heat gain illustration">
                <p>This tool calculates sensible heat gain from people for HVAC system design optimization.</p>
            </div>

            <div class="result-error hidden" id="resultError">
                <div class="error-icon">❌</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Sensible Heat Gain (Q_sensible)</h2>
                </div>

                <div class="rate-display">
                    <div class="rate-value" id="heatGainValue">0</div>
                    <div class="rate-unit" id="heatGainUnit">Btu/hr</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title"> Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

<!-- Notes -->
<div class="note-section">

    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            The <strong>Sensible Heat Gain from People Calculator</strong> determines the heat load generated by occupants in indoor environments. 
            This is critical for designing HVAC systems, optimizing energy use, and maintaining thermal comfort in residential, commercial, and industrial spaces.
        </p>
    </div>

    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Number of People (N):</strong> Total occupants in the indoor space (≥ 1, typically up to 10,000).</li>
            <li><strong>Sensible Heat Gain per Person (q):</strong> Heat given off per person depending on activity level, usually 200–800 Btu/hr.</li>
            <li><strong>Cooling Load Factor (CLF):</strong> Dimensionless factor (0.1–1.0) representing the effect of occupancy pattern and timing.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Number of People:</strong> Must be ≥ 1 (typical range: 1-10,000).</li>
            <li><strong>Sensible Heat Gain per Person:</strong> Must be between 200-800 Btu/hr (typical range based on activity level).</li>
            <li><strong>Cooling Load Factor (CLF):</strong> Must be between 0.1-1.0 (dimensionless).</li>
            <li><strong>Non-zero & realistic values:</strong> All inputs must be greater than zero and within practical ranges.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Output Validations</h3>
        <ul class="note-list">
            <li><strong>Q_sensible must be finite:</strong> If result is NaN or Infinity → ❌ Invalid result, check inputs.</li>
            <li><strong>Q_sensible &lt; 5,000 Btu/hr:</strong> ✅ Low Heat Load → Suitable for small spaces or residential applications. (Assessment: Low Heat Load)</li>
            <li><strong>Q_sensible 5,000–20,000 Btu/hr:</strong> ✅ Moderate Heat Load → Typical for offices and commercial spaces. (Assessment: Moderate Heat Load)</li>
            <li><strong>Q_sensible 20,000–50,000 Btu/hr:</strong> ⚠️ High Heat Load → Requires dedicated cooling systems. (Assessment: High Heat Load)</li>
            <li><strong>Q_sensible &gt; 50,000 Btu/hr:</strong> ❌ Very High Heat Load → Industrial/commercial applications requiring specialized HVAC design. (Assessment: Very High Heat Load)</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>📏 Governing Principle</h3>
        <p>
            A sensible heat gain from people calculator typically follows the methodology and data presented in the ASHRAE Fundamentals Handbook and ASHRAE Standards, 
            particularly referencing ASHRAE Standard 55 for human thermal comfort, for the values and factors used. Other relevant standards, such as CIBSE TM59 in the UK, 
            also provide guidelines that align with these principles for internal heat gain calculations. 

            Key Standards and Resources:
            <ul>
                <li><strong>ASHRAE:</strong> Fundamentals Handbook provides detailed information on internal heat gains, including sensible and latent heat fractions.</li>
                <li><strong>ASHRAE Standard 55:</strong> Defines conditions for human thermal comfort, forming the basis for these calculations.</li>
                <li><strong>ASHRAE Standard 62:</strong> Specifies minimum ventilation rates for indoor air quality, interacting with internal gains.</li>
                <li><strong>CIBSE TM59:</strong> UK guideline outlining approaches for estimating internal gains from occupants, referencing sensible heat values (~75 W/person).</li>
            </ul>

            <strong style="color: #1976d2;">What the Calculator Does:</strong>
            <ul>
                <li>Determines the number of occupants (N) in a zone.</li>
                <li>Considers activity levels affecting heat output per person.</li>
                <li>Applies the Cooling Load Factor (CLF) to adjust heat gain based on occupancy pattern and timing.</li>
            </ul>

            By applying these established principles, this calculator helps engineers and designers accurately estimate and manage the internal thermal loads within a building, 
            ensuring thermal comfort, energy efficiency, and compliance with building standards.
        </p>
    </div>

    <div class="note-card">
        <h3>📌 Conclusion</h3>
        <p>
            The <b>Sensible Heat Gain from People</b> calculation helps design efficient HVAC systems and maintain comfortable indoor environments. 
            Input validations ensure realistic design values, and results are automatically checked against industry standards.
        </p>
        <p>
            ✅ Use this calculator to design or evaluate HVAC systems while staying compliant with <b>ASHRAE standards and building codes</b>. 
            Assessment or feedback (as displayed in output validations) is included alongside the calculated result to guide design decisions.
        </p>
    </div>

</div>

<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateHeatGain() {
    // Read values
    const numPeople = parseFloat(document.getElementById("num_people").value);
    const heatGainPerPerson = parseFloat(document.getElementById("heat_gain").value);
    const clf = parseFloat(document.getElementById("clf").value);

    const heatGainValueEl = document.getElementById("heatGainValue");
    const heatGainUnitEl = document.getElementById("heatGainUnit");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Validation
    if (![numPeople, heatGainPerPerson, clf].every(Number.isFinite)) {
        return showErrors(["👉 Please enter all values (numeric)."]);
    }
    
    // Input validations
    if (numPeople < 1) errors.push("👉 Number of people must be at least 1.");
    if (numPeople > 10000) warnings.push("⚠️ Number of people unusually high (>10,000).");
    
    if (heatGainPerPerson < 200) errors.push("👉 Sensible heat gain per person must be at least 200 Btu/hr.");
    if (heatGainPerPerson > 800) errors.push("👉 Sensible heat gain per person should not exceed 800 Btu/hr.");
    
    if (clf < 0.1) errors.push("👉 Cooling Load Factor (CLF) must be at least 0.1.");
    if (clf > 1.0) errors.push("👉 Cooling Load Factor (CLF) cannot exceed 1.0.");
    
    if (errors.length) return showErrors(errors);

    // Formula: Q_sensible = Number of People × Sensible Heat Gain per Person × CLF
    const Q_sensible = numPeople * heatGainPerPerson * clf;

    if (!Number.isFinite(Q_sensible)) {
        return showErrors(["⚠️ Computed heat gain is invalid (possible calculation error)."]);
    }

    // Classification based on industry standards
    let classification, suggestion, color;
    
    if (Q_sensible < 5000) {
        classification = "Low Heat Load";
        suggestion = "✅ Suitable for small spaces or residential applications.";
        color = "#2e7d32";
    } else if (Q_sensible <= 20000) {
        classification = "Moderate Heat Load";
        suggestion = "✅ Typical for offices and commercial spaces.";
        color = "#2e7d32";
    } else if (Q_sensible <= 50000) {
        classification = "High Heat Load";
        suggestion = "⚠️ Requires dedicated cooling systems for proper temperature control.";
        color = "#f9a825";
    } else {
        classification = "Very High Heat Load";
        suggestion = "❌ Industrial/commercial applications requiring specialized HVAC design.";
        color = "#c62828";
    }

    // Display result
    heatGainValueEl.textContent = Q_sensible.toLocaleString(undefined, {maximumFractionDigits: 0});
    heatGainUnitEl.textContent = "Btu/hr";
    
    feedbackEl.innerHTML = `
        <div>Q_sensible = <b>${Q_sensible.toLocaleString(undefined, {maximumFractionDigits: 0})}</b> Btu/hr</div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}

</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--
Input Validations:
All inputs must be numeric and finite

Number of People: Minimum 1, maximum 10,000 (with warning)

Sensible Heat Gain: 200-800 Btu/hr (ASHRAE typical range)

CLF: 0.1-1.0 (dimensionless multiplier)
-------------------------------------------------------------------------------------
Output Validations:
Results checked for finite values

Classification based on industry-standard ranges

Appropriate warnings for extreme values
--------------------------------------------------------------------------------------
Edge Cases:
Division by zero prevention

Extreme input values detection

Non-numeric input handling

Realistic range checking


-->