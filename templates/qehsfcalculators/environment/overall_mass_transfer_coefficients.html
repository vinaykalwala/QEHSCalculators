{% extends 'base.html' %}
{% block title %}Overall Mass Transfer Coefficients Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overall Mass Transfer Coefficients Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding:0 20px;
            border-radius: 12px;
        }
        
        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            height: 420px;
            overflow-y: auto;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        .rate-display {
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
      
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
        
        .coefficient-display {
            margin-bottom: 15px;
            text-align: left;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .coefficient-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .coefficient-value {
            font-size: 20px;
            color: #2980b9;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="btn-container">
        <a href="{% url 'environment_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
    
    <div class="calculator-container printable" id="printArea">
        <!-- Include header/footer for print -->
        {% include "includes/print_header_footer.html" %}

        <div class="calculator-header">
            <h1>Overall Mass Transfer Coefficients Calculator</h1>
            <p>Calculate the overall mass transfer coefficients for gas-liquid systems</p>
        </div>

        <div class="calc-content">
            <!-- Calculator -->
            <div class="calc-card">
                <h2>Enter Data</h2>
                <div class="form-group">
                    <label for="kG">Individual Gas Phase Coefficient (k<sub>G</sub>)</label>
                    <input type="number" id="kG" class="form-input" min="0" step="0.000001" placeholder="Enter k_G value (mol/m²·s·Pa)">
                </div>
                <div class="form-group">
                    <label for="kL">Individual Liquid Phase Coefficient (k<sub>L</sub>)</label>
                    <input type="number" id="kL" class="form-input" min="0" step="0.000001" placeholder="Enter k_L value (m/s)">
                </div>
                <div class="form-group">
                    <label for="H">Henry's Law Constant (H)</label>
                    <input type="number" id="H" class="form-input" min="0" step="0.000001" placeholder="Enter H value (Pa·m³/mol)">
                </div>
                
                <button class="calculate-btn" onclick="calculateCoefficients()">Calculate Coefficients</button>
            </div>

            <!-- Result Section -->
            <div class="result-card">
                <div class="result-placeholder" id="placeholder">
                    <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Mass transfer illustration">
                    <p>This tool will calculate the <strong>Overall Mass Transfer Coefficients</strong>. Enter your data to see results and insights here.</p>
                </div>
                
                <div class="result-error hidden" id="resultError">
                    <div class="error-icon">❌</div>
                    <div class="error-message" id="errorMessage"></div>
                </div>
                 
                <div class="result-value hidden" id="resultValue">
                    <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd; margin-top:30px;">
                        <h2>Overall Mass Transfer Coefficients</h2>
                    </div>
                    
                    <div class="coefficient-display">
                        <div class="coefficient-label">Overall Gas Phase Coefficient (K<sub>G</sub>):</div>
                        <div class="coefficient-value" id="KGValue">0.00 mol/m²·s·Pa</div>
                    </div>
                    
                    <div class="coefficient-display">
                        <div class="coefficient-label">Overall Liquid Phase Coefficient (K<sub>L</sub>):</div>
                        <div class="coefficient-value" id="KLValue">0.00 m/s</div>
                    </div>

                    <div class="result-feedback">
                        <div class="feedback-title">Mass Transfer Assessment</div>
                        <div class="feedback-content" id="feedbackContent"></div>
                    </div>
                    <div class="btn-wrapper">
                        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="note-section">
            <!-- About -->
            <div class="note-card">
                <h3>📘 About This Calculator</h3>
                <p>
                    The <strong>Overall Mass Transfer Coefficients Calculator</strong> determines the combined resistance to mass transfer across gas and liquid phases in separation processes. These coefficients are essential for designing and optimizing gas-liquid contactors like absorbers, strippers, and scrubbers used in environmental engineering to remove pollutants from air or water.
                </p>
            </div>

            <!-- Parameters Used -->
            <div class="note-card">
                <h3>⚙ Parameters Used</h3>
                <ul class="note-list">
                    <li><strong>k<sub>G</sub>:</strong> Individual gas phase mass transfer coefficient (mol/m²·s·Pa)</li>
                    <li><strong>k<sub>L</sub>:</strong> Individual liquid phase mass transfer coefficient (m/s)</li>
                    <li><strong>H:</strong> Henry's Law constant (Pa·m³/mol), describes gas solubility in liquid</li>
                    <li><strong>K<sub>G</sub>:</strong> Overall gas phase coefficient (mol/m²·s·Pa)</li>
                    <li><strong>K<sub>L</sub>:</strong> Overall liquid phase coefficient (m/s)</li>
                </ul>
            </div>

            <!-- Input Validation Rules -->
            <!-- Input & Output Validation Rules -->
<div class="note-card">
    <h3>✅ Validation Rules</h3>
    <ul class="note-list">
        <li><b>kG (gas phase):</b> Must be between 0.000001 and 1,000,000 mol/m²·s·Pa</li>
        <li><b>kL (liquid phase):</b> Must be between 0.000001 and 1,000,000 m/s</li>
        <li><b>H (Henry’s constant):</b> Must be between 1 and 1,000,000 Pa·m³/mol</li>
        <li><b>All values:</b> Must be positive numbers, decimals allowed up to 6 places</li>
        <li><b>Division safety:</b> Denominators must not approach zero</li>
        <li><b>Output checks:</b> KG &lt; 0.000001 → gas-side resistance dominates</li>
        <li><b>Output checks:</b> KL &lt; 0.00001 → liquid-side resistance dominates</li>
        <li><b>Output checks:</b> Values &gt; 1,000,000 → flagged as unrealistic</li>
    </ul>
</div>


            <!-- Output Validations -->
            <div class="note-card">
    <h3>📊 Output Validations</h3>
    <p>
        The <strong>Overall Mass Transfer Coefficients</strong> are interpreted using these thresholds:
    </p>
    <ul class="note-list">
        <li><b>K<sub>G</sub> &lt; 0.000001:</b> ⚠️ Very low gas phase coefficient — gas-side resistance dominates. Consider improving mixing or increasing gas velocity.</li>
        <li><b>K<sub>L</sub> &lt; 0.00001:</b> ⚠️ Very low liquid phase coefficient — liquid-side resistance dominates. Check for high viscosity, fouling, or poor agitation.</li>
        <li><b>K<sub>G</sub>, K<sub>L</sub> within range:</b> ✅ Balanced transfer — both gas and liquid phases support efficient mass movement.</li>
        <li><b>K<sub>G</sub> or K<sub>L</sub> &gt; 1,000,000:</b> ⚠️ Unrealistic result — check input data and unit consistency.</li>
    </ul>
</div>


            <!-- Standards -->
            <div class="note-card">
                <h3>📋 Standards</h3>
                <p>
                    Calculations and methodology align with:  
                    • <strong>EPA's Air Pollution Control Technology</strong> manuals  
                    • <strong>AIChE</strong> design guidelines for mass transfer equipment  
                    • <strong>ASME</strong> standards for process equipment design  
                    • Industry-standard two-resistance theory for mass transfer
                </p>
            </div>

            <!-- Conclusion -->
            <div class="note-card">
                <h3>📝 Conclusion</h3>
                <p>
                    Understanding overall mass transfer coefficients is essential for environmental engineers designing systems to remove gaseous pollutants or transfer beneficial gases (like oxygen) into liquids. These calculations help optimize equipment size and operating conditions for efficient mass transfer in applications such as air pollution control, wastewater treatment, chemical processing, and carbon capture.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Set current date for print header
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
        });

        function calculateCoefficients() {
    const kG = document.getElementById('kG').value.trim();
    const kL = document.getElementById('kL').value.trim();
    const H = document.getElementById('H').value.trim();

    const errorBox = document.getElementById('resultError');
    const errorMessage = document.getElementById('errorMessage');
    const placeholder = document.getElementById('placeholder');
    const resultValue = document.getElementById('resultValue');

    let errors = [];

    /*
    VALIDATION RULES:
    - All values must be numeric and > 0
    - Ranges:
        kG: 0.000001 – 1,000,000
        kL: 0.000001 – 1,000,000
        H : 1 – 1,000,000
    - Avoid division by zero in denominator
    */

    // Gas phase coefficient
    if (kG === "" || isNaN(kG)) {
        errors.push("👉 Please enter the gas phase coefficient (kG).");
    } else if (parseFloat(kG) <= 0) {
        errors.push("👉 Gas phase coefficient must be greater than 0.");
    } else if (parseFloat(kG) < 0.000001) {
        errors.push("👉 Gas phase coefficient cannot be less than 0.000001 (out of range).");
    } else if (parseFloat(kG) > 1000000) {
        errors.push("👉 Gas phase coefficient cannot exceed 1,000,000 (check units).");
    }

    // Liquid phase coefficient
    if (kL === "" || isNaN(kL)) {
        errors.push("👉 Please enter the liquid phase coefficient (kL).");
    } else if (parseFloat(kL) <= 0) {
        errors.push("👉 Liquid phase coefficient must be greater than 0.");
    } else if (parseFloat(kL) < 0.000001) {
        errors.push("👉 Liquid phase coefficient cannot be less than 0.000001 (out of range).");
    } else if (parseFloat(kL) > 1000000) {
        errors.push("👉 Liquid phase coefficient cannot exceed 1,000,000 (check units).");
    }

    // Henry's Law constant
    if (H === "" || isNaN(H)) {
        errors.push("👉 Please enter Henry's Law constant (H).");
    } else if (parseFloat(H) <= 0) {
        errors.push("👉 Henry's constant must be greater than 0.");
    } else if (parseFloat(H) < 1) {
        errors.push("👉 Henry's constant cannot be less than 1 (unrealistic in SI).");
    } else if (parseFloat(H) > 1000000) {
        errors.push("👉 Henry's constant cannot exceed 1,000,000 (check units).");
    }

    // Show errors if any
    if (errors.length > 0) {
        errorMessage.innerHTML = errors.join("<br>");
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    } else {
        errorBox.classList.add("hidden");
    }

    const kG_val = parseFloat(kG);
    const kL_val = parseFloat(kL);
    const H_val = parseFloat(H);

    // Denominator safety checks
    if (kG_val === 0 || kL_val === 0 || H_val === 0) {
        errorMessage.innerHTML = "❌ Calculation failed: division by zero risk.";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Perform calculations
    const KG = 1 / ((1 / kG_val) + (H_val / kL_val));
    const KL = 1 / ((1 / (H_val * kG_val)) + (1 / kL_val));

    if (!isFinite(KG) || !isFinite(KL)) {
        errorMessage.innerHTML = "❌ Invalid calculation result. Please check your inputs.";
        errorBox.classList.remove("hidden");
        placeholder.classList.add("hidden");
        resultValue.classList.add("hidden");
        return;
    }

    // Display results
    document.getElementById('KGValue').textContent = KG.toFixed(8) + ' mol/m²·s·Pa';
    document.getElementById('KLValue').textContent = KL.toFixed(8) + ' m/s';

    // Feedback
    let feedback = '';
    if (KG < 0.000001) {
        feedback = '⚠️ Very low gas phase coefficient — gas-side resistance dominates.';
    } else if (KL < 0.00001) {
        feedback = '⚠️ Very low liquid phase coefficient — liquid-side resistance dominates.';
    } else if (KG > 1000000 || KL > 1000000) {
        feedback = '⚠️ Result exceeds physical limits. Check if units are correct.';
    } else {
        feedback = '✅ Balanced transfer — both gas and liquid phases support efficient mass movement.';
    }

    document.getElementById('feedbackContent').innerHTML = feedback;

    placeholder.classList.add('hidden');
    resultValue.classList.remove('hidden');
}


        function printReport() {
            // Update date just before printing
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('printDate').textContent = now.toLocaleDateString('en-US', options);
            
            window.print();
        }
    </script>
    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
{% comment %} 
/*
FORMULAS USED:
-----------------------------------
Overall gas phase coefficient:
   KG = 1 / [ (1 / kG) + (H / kL) ]
   Units: mol/m²·s·Pa

Overall liquid phase coefficient:
   KL = 1 / [ (1 / (H × kG)) + (1 / kL) ]
   Units: m/s
*/ {% endcomment %}