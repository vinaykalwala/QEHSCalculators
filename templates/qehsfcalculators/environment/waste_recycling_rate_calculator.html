{% extends 'base.html' %}
{% block title %}Waste Recycling Rate Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waste Recycling Rate Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<!-- INPUTS: changed to Recycling Rate fields -->
<div class="calculator-header">
    <h1>Waste Recycling Rate Calculator</h1>
    <p>Estimate percentage of waste recycled/ recovered from total waste generated (tons).</p>
</div>

<div class="calc-content">
    <!-- Input Card -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="form-group">
            <label for="recycled_waste">Recycled Waste (tons)</label>
            <input type="number" id="recycled_waste" class="form-input" step="any" min="0" placeholder="e.g., 80">
        </div>

        <div class="form-group">
            <label for="total_waste">Total Waste Generated (tons)</label>
            <input type="number" id="total_waste" class="form-input" step="any" min="0.0001" placeholder="e.g., 200">
        </div>

        <button class="calculate-btn" onclick="calculateRecyclingRate()">Calculate Recycling Rate</button>
    </div>

    <!-- Result Card (kept ids used in JS) -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Environment illustration">
            <p>This tool calculates the percentage of waste recycled for audits and KPI tracking.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Waste Recycling Rate </h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0</div>
                <div class="rate-unit" id="rateUnit">%</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title"> Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes: Keep descriptive notes but DO NOT show the formula anywhere -->
<div class="note-section">

    <!-- 1️⃣ About -->
    <div class="note-card">
        <h3>📘 About This Calculator</h3>
        <p>
            This calculator determines the <strong>Waste Recycling Rate (%)</strong>, indicating how much of the total waste generated 
            has been recycled or recovered during a reporting period.  
            It supports <strong>environmental KPIs</strong> and <strong>waste management audits</strong> for tracking performance improvement.
        </p>
    </div>

    <!-- 2️⃣ Parameters Used -->
    <div class="note-card">
        <h3>⚙️ Parameters Used</h3>
        <ul class="note-list">
            <li><strong>Recycled Waste (tons):</strong> Quantity of waste material that was recycled or recovered.</li>
            <li><strong>Total Waste Generated (tons):</strong> Total waste produced within the same reporting period.</li>
        </ul>
    </div>

    <!-- 3️⃣ Input Validation Rules -->
    <div class="note-card">
        <h3>✅ Input Validation Rules</h3>
        <ul class="note-list">
            <li><strong>Recycled Waste:</strong> Numeric value, must be ≥ 0 and ≤ Total Waste.</li>
            <li><strong>Total Waste:</strong> Numeric value, must be &gt; 0 (cannot be zero).</li>
            <li><strong>Units:</strong> Both fields must use the same unit — <strong>tons</strong>.</li>
            <li><strong>Decimals:</strong> Allowed; results are rounded to two decimal places.</li>
            <li><strong>Input Logic:</strong> Recycled waste cannot exceed total waste generated.</li>
        </ul>
    </div>

    <!-- 4️⃣ Output Validations (Feedback / Assessment) -->
    <div class="note-card">
        <h3>🧮 Output Validations & Feedback</h3>
        <ul class="note-list">
            <li><strong>Result must be finite:</strong> If invalid → check input data.</li>
            <li><strong>Assessment Categories:</strong></li>
            <ul>
                <li> <strong> None (0%)</strong></b> – Immediate corrective measures needed. Implement segregation and recycling programs.</li>
                <li> <strong>Very Poor (0–10%)</strong></b> – Increase source segregation, engage recycling vendors and review waste plan.</li>
                <li> <strong> Poor (10–30%) </strong></b> – Implement improvement actions: training, segregation, and monitoring.</li>
                <li> <strong>Moderate (30–60%)</strong></b> – Continue improvements; target process changes for better recovery.</li>
                <li> <strong>Good (60–90%)</strong></b> – Maintain current practices; look for incremental improvements.</li>
                <li> <strong>Excellent (&gt;90%)</strong></b> – Exceptional rate — verify data quality and reporting methodology.</li>
            </ul>
            <li><strong>Warnings:</strong> Alerts appear for unusually high or low values to ensure realistic data entry.</li>
        </ul>
    </div>

    <!-- 5️⃣ Governing Principle -->
    <div class="note-card">
        <h3>📐 Governing Principle</h3>
        <p>
            A <b>"Waste Recycling Rate Calculator"</b> is not defined by a single universal standard but follows 
            established environmental performance assessment practices derived from <b>ISO 14031</b> 
            (Environmental Performance Evaluation) and waste management frameworks such as 
            <b>ISO 14001</b> and <b>OECD Waste Indicators</b>.  
            The concept reflects the proportion of waste material that is recovered or recycled from the total 
            waste generated within a reporting period.
        </p>
        <p>
            The classification scale used in this calculator aligns with general sustainability audit 
            methodologies — categorizing recycling performance as <b>None</b>, <b>Very Poor</b>, 
            <b>Poor</b>, <b>Moderate</b>, <b>Good</b>, or <b>Excellent</b> — to provide actionable insight 
            and promote continuous improvement.  
            The underlying principle is universal: it evaluates efficiency in resource recovery and waste minimization, 
            independent of local reporting standards or regulatory systems.
        </p>
    </div>


    <!-- 6️⃣ Conclusion -->
    <div class="note-card">
        <h3>🧾 Conclusion</h3>
        <p>
            The recycling rate calculator serves as a key environmental performance indicator.  
            It helps organizations measure and monitor their progress toward sustainable waste management.  
            Use the feedback and classification guidance to plan targeted improvement actions and maintain compliance 
            with environmental standards and audit expectations.
        </p>
    </div>

</div>


<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
    // scroll to error if needed
    errorBox.scrollIntoView({ behavior: "smooth", block: "center" });
}

function calculateRecyclingRate() {
    // Read values
    const recycledRaw = document.getElementById("recycled_waste").value;
    const totalRaw = document.getElementById("total_waste").value;

    // Parse floats carefully (trim)
    const recycled = recycledRaw === "" ? NaN : parseFloat(recycledRaw);
    const total = totalRaw === "" ? NaN : parseFloat(totalRaw);

    const rateValueEl = document.getElementById("rateValue");
    const rateUnitEl = document.getElementById("rateUnit");
    const feedbackEl = document.getElementById("feedbackContent");
    document.getElementById("resultError").classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Basic numeric validation
    if (!Number.isFinite(recycled) || !Number.isFinite(total)) {
        return showErrors(["👉 Please enter valid numeric values for both fields (in tons)."]);
    }

    // Range checks and logical validations
    if (total <= 0) errors.push("👉 Total waste must be greater than 0 tons (cannot divide by zero).");
    if (recycled < 0) errors.push("👉 Recycled waste cannot be negative.");
    if (recycled > total) errors.push("👉 Recycled waste cannot exceed total waste generated.");
    // Upper bound sanity checks (practical limits)
    const MAX_TOTAL = 1e8; // 100 million tons - adjust if needed
    const MAX_RECYCLED = 1e8;
    if (total > MAX_TOTAL) warnings.push("⚠️ Total waste unusually large - verify units and reporting period.");
    if (recycled > MAX_RECYCLED) warnings.push("⚠️ Recycled waste unusually large - verify units and reporting period.");

    // Practical/soft warnings
    if (total < 0.1) warnings.push("⚠️ Total waste is very small (<0.1 tons) - verify reporting period or units.");
    if (recycled === total && total > 0) warnings.push("⚠️ 100% recycling reported - validate measurement and rounding.");
    if (recycled / total > 0.95 && recycled / total < 1.0) warnings.push("⚠️ Recycling rate > 95% - exceptional, please verify data.");
    if (recycled / total < 0.01) warnings.push("⚠️ Recycling rate < 1% - very low recycling performance.");

    if (errors.length) return showErrors(errors);

    // Calculation (do not display formula anywhere)
    const rate = (recycled / total) * 100; // internal calc

    if (!Number.isFinite(rate)) {
        return showErrors(["⚠️ Computed rate is invalid. Check inputs."]);
    }

    // Classification (audit-friendly)
    let classification = "";
    let suggestion = "";
    let color = "#000";

    if (rate === 0) {
        classification = "None";
        suggestion = "Immediate corrective measures needed. Implement segregation and recycling programs.";
        color = "#c62828";
    } else if (rate > 0 && rate < 10) {
        classification = "Very Poor";
        suggestion = "Increase source segregation, engage recycling vendors and review waste management plan.";
        color = "#e65100";
    } else if (rate >= 10 && rate < 30) {
        classification = "Poor";
        suggestion = "Implement improvement actions: training, segregation, and tracking.";
        color = "#f57c00";
    } else if (rate >= 30 && rate < 60) {
        classification = "Moderate";
        suggestion = "Continue improvement; target process changes to increase recoverable waste stream.";
        color = "#2e7d32";
    } else if (rate >= 60 && rate <= 90) {
        classification = "Good";
        suggestion = "Maintain current practices and look for incremental improvements.";
        color = "#1b5e20";
    } else { // > 90
        classification = "Excellent";
        suggestion = "Exceptional rate — verify data quality and reporting methodology.";
        color = "#1565c0";
    }

    // Display
    rateValueEl.textContent = rate.toFixed(2);
    rateUnitEl.textContent = "%";

    feedbackEl.innerHTML = `
        <div>Waste Recycling Rate = <b>${rate.toFixed(2)}%</b></div>
        <div>Classification: <b style="color:${color};">${classification}</b></div>
        <div style="margin-top:6px;">${suggestion}</div>
        ${warnings.length ? `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>` : ""}
    `;

    document.getElementById("placeholder").classList.add("hidden");
    document.getElementById("resultError").classList.add("hidden");
    document.getElementById("resultValue").classList.remove("hidden");
    document.getElementById("resultValue").scrollIntoView({ behavior: "smooth", block: "center" });
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) el.textContent = new Date().toLocaleDateString();
    window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}

<!-- /*
=========================
🔹 FORMULA USED
=========================
Recycling Rate (%) = (Recycled Waste / Total Waste) × 100


=========================
🔹 INPUT VALIDATIONS
=========================

1️⃣ Numeric Validation:
   - Both inputs (Recycled Waste and Total Waste) must be valid numbers.
   - If either is missing or invalid → show error: 
     "👉 Please enter valid numeric values for both fields (in tons)."

2️⃣ Logical & Range Checks:
   - Total Waste must be > 0 → prevents division by zero.
   - Recycled Waste cannot be negative.
   - Recycled Waste cannot exceed Total Waste.

3️⃣ Sanity / Upper Bound Limits:
   - Total Waste > 100 million tons → warning to verify units.
   - Recycled Waste > 100 million tons → warning to verify units.

4️⃣ Practical / Soft Warnings:
   - Total Waste < 0.1 tons → very small value warning.
   - Recycled Waste = Total Waste → 100% recycling warning.
   - Recycling Rate > 95% and < 100% → very high rate warning.
   - Recycling Rate < 1% → very low performance warning.


=========================
🔹 OUTPUT VALIDATIONS
=========================

1️⃣ Computed Rate Check:
   - If calculated rate is NaN or invalid → show error:
     "⚠️ Computed rate is invalid. Check inputs."

2️⃣ Classification by Rate:
   - 0% → None (Immediate corrective measures needed)
   - >0–10% → Very Poor (Need segregation & vendor engagement)
   - 10–30% → Poor (Improvement actions required)
   - 30–60% → Moderate (Continue improvements)
   - 60–90% → Good (Maintain and improve)
   - >90% → Excellent (Exceptional — verify data quality)

3️⃣ Output Display:
   - Displays calculated percentage, classification (color-coded),
     suggestion message, input summary, and warnings.
*/ -->

