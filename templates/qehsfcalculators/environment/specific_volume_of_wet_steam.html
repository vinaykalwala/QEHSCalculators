{% extends 'base.html' %}
{% block title %}Specific volume of wet steam calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Specific volume of wet steam calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<!-- Specific Volume of Wet Steam Calculator (replaces previous corrosion calculator UI) -->
<div class="calculator-header">
    <h1>Specific Volume of Wet Steam Calculator</h1>
    <p>Compute the specific volume of wet steam (result shown in m³/kg) and receive QEHS-oriented guidance.</p>
</div>

<div class="calc-content">
    <div class="calc-card">
        <h2>Enter Data</h2>

        <div class="form-group">
            <label for="vg">Specific Volume of Dry Steam (v<sub>g</sub>) [m³/kg]</label>
            <input type="number" id="vg" class="form-input" min="0.000001" step="any" placeholder="e.g., 1.673">
        </div>

        <div class="form-group">
            <label for="x">Dryness Fraction (x) (0–1)</label>
            <input type="number" id="x" class="form-input" min="0" max="1" step="0.0001" placeholder="e.g., 0.98">
        </div>

        <button class="calculate-btn" onclick="calculateSpecificVolume()">Calculate Specific Volume</button>
    </div>

    <!-- Result Section (keeps original layout) -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="steam illustration">
            <p>This tool calculates the specific volume of wet steam and provides safety/operational guidance.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Specific Volume</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="rateValue">0.000000</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">m³/kg</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>
            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes container with the required 6 sections -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator estimates the <strong>specific volume of wet steam</strong> (m³/kg) using dryness fraction and
      dry steam volume data. It helps in steam quality checks, separator design, condensate management, and QEHS risk audits.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>v<sub>g</sub> (m³/kg):</strong> Specific volume of dry saturated steam (from steam tables).</li>
      <li><strong>x (dimensionless):</strong> Dryness fraction (0 = saturated liquid, 1 = saturated vapor).</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>v<sub>g</sub>:</strong> Required, numeric, > 0 m³/kg; < 0.01 or > 100 m³/kg triggers warning; > 1,000,000 m³/kg is invalid.</li>
      <li><strong>x:</strong> Required, numeric, 0 ≤ x ≤ 1; > 4 decimal places triggers warning.</li>
      <li><strong>Boundary Checks:</strong> x = 0 (saturated liquid) or x = 1 (dry steam) triggers advisory to verify with steam tables.</li>
      <li><strong>Constraints:</strong> All inputs must be finite and numeric; negative v<sub>g</sub> invalid.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📏 Output Validations</h3>
    <ul class="note-list">
      <li><strong>Specific Volume:</strong> Displayed in m³/kg, rounded to 6 decimal places.</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>x ≥ 0.95: Mostly dry steam — Low moisture risk, continue routine monitoring.</li>
          <li>0.80 ≤ x < 0.95: Minor moisture present — Check separators occasionally.</li>
          <li>0.50 ≤ x < 0.80: Wet steam (moderate) — Risk of erosion/carryover, inspect separators.</li>
          <li>x < 0.50: Very wet steam — High risk of water hammer/corrosion, immediate action required.</li>
        </ul>
      </li>
      <li>Warnings triggered for: non-finite or ≤ 0 results, specific volume < 1e-6 m³/kg, or > 1,000 m³/kg.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      A calculator for the specific volume of wet steam isn't based on a single specific standard, but rather relies on steam tables and the fundamental thermodynamic formula v = v<sub>f</sub> + x(v<sub>g</sub> - v<sub>f</sub>) or v = v<sub>f</sub> + x * v<sub>fg</sub>. This formula uses property values (v<sub>f</sub> and v<sub>g</sub>) found in established steam tables and the steam's dryness fraction (x), which are standard thermodynamic concepts. The calculation itself is a direct application of these standard thermodynamic principles and tables, rather than a separate standard for the calculator itself.
    </p>
    <p><b>Key Components of the Calculation:</b></p>
    <p><b>Steam Tables:</b> These are comprehensive tables of thermodynamic properties of water and steam, such as specific volume (v) and enthalpy (h), at different temperatures and pressures. They are based on extensive experimental data and form a universal reference for steam calculations.</p>
    <p><b>Formula:</b> The standard formula for calculating the specific volume of wet steam is:</p>
    <p>v = v<sub>f</sub> + x * v<sub>fg</sub></p>
    <p>Where:</p>
    <ul class="note-list">
      <li><b>v</b> is the specific volume of the wet steam.</li>
      <li><b>v<sub>f</sub></b> is the specific volume of saturated liquid water.</li>
      <li><b>x</b> is the dryness fraction (or quality) of the steam.</li>
      <li><b>v<sub>fg</sub></b> is the change in specific volume during vaporization (v<sub>g</sub> - v<sub>f</sub>).</li>
    </ul>
    <p><b>Dryness Fraction (x):</b> This is a dimensionless quantity (0 to 1) that represents the ratio of the mass of dry steam to the total mass of the mixture.</p>
    <p><b>How It Works:</b></p>
    <p><b>Determine Conditions:</b> Identify the pressure or temperature of the steam.</p>
    <p><b>Consult Steam Tables:</b> Find the corresponding v<sub>f</sub> and v<sub>g</sub> values for the given conditions in a reliable steam table.</p>
    <p><b>Apply the Formula:</b> Plug the values of v<sub>f</sub>, v<sub>g</sub>, and the dryness fraction x into the formula v = v<sub>f</sub> + x(v<sub>g</sub> - v<sub>f</sub>) to find the specific volume of the wet steam.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides reliable estimates of the specific volume of wet steam, supporting <strong>steam quality checks</strong>, <strong>separator design</strong>, and <strong>QEHS compliance</strong>. Ensure input values (v<sub>g</sub>, x) are accurate and validate with steam tables (e.g., ASME or IAPWS) or field measurements for critical applications to ensure safe and efficient steam system performance.
    </p>
  </div>
</div>


<script>
/* showErrors: identical UX to previous */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Main calculation and QEHS-aware validations */
function calculateSpecificVolume() {
  const vgRaw = document.getElementById("vg").value.trim();
  const xRaw = document.getElementById("x").value.trim();

  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const errorBox = document.getElementById("resultError");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  errorBox.classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Presence checks
  if (vgRaw === "") errors.push("👉 Please enter the specific volume of dry steam (v_g) in m³/kg.");
  if (xRaw === "") errors.push("👉 Please enter the dryness fraction (x) between 0 and 1.");
  if (errors.length) return showErrors(errors);

  // Parse numbers
  const vg = parseFloat(vgRaw);
  const x = parseFloat(xRaw);

  // Numeric & basic validations
  if (!Number.isFinite(vg) || vg <= 0) errors.push("👉 v_g must be a positive finite number (m³/kg).");
  if (!Number.isFinite(x) || x < 0 || x > 1) errors.push("👉 x must be a finite number between 0 and 1 (inclusive).");

  if (errors.length) return showErrors(errors);

  // Typical-range soft checks
  if (vg < 0.01) warnings.push("⚠️ v_g is very small (<0.01 m³/kg) — verify pressure/units or that this is a high-pressure condition.");
  if (vg > 100) warnings.push("⚠️ v_g is large (>100 m³/kg) — verify units or extremely low-pressure conditions.");
  if (vg > 1e6) return showErrors(["👉 v_g is unrealistically large — likely a units or data entry error."]);

  // Precision check for x
  const xDecimals = (xRaw.indexOf('.') >= 0) ? xRaw.split('.')[1].length : 0;
  if (xDecimals > 4) warnings.push("⚠️ Dryness fraction (x) has high decimal precision — consider rounding to 4 places.");

  // Boundary warnings
  if (x === 0) warnings.push("⚠️ x = 0 (saturated liquid). Tool's simplified indicator may not represent saturated-liquid specific volume; use steam tables for liquid properties.");
  if (x === 1) warnings.push("ℹ️ x = 1 (dry steam). Good — no liquid phase present.");

  // Compute specific volume (internal; not displayed as formula)
  const specificVolume = vg * x;

  if (!Number.isFinite(specificVolume) || specificVolume <= 0) {
    return showErrors(["⚠️ Computed specific volume invalid. Check inputs."]);
  }

  // Output sanity warnings
  if (specificVolume < 1e-6) warnings.push("⚠️ Computed specific volume is extremely small — check v_g units or x value.");
  if (specificVolume > 1000) warnings.push("⚠️ Computed specific volume is very large — possible units mismatch or data error.");

  // Classification based on dryness fraction (QEHS-focused)
  let classification = "";
  let advice = "";
  if (x >= 0.95) {
    classification = " ✅ Mostly dry steam";
    advice = "Low moisture risk. Continue routine monitoring for condensate traps and separators.";
  } else if (x >= 0.80) {
    classification = "⚠️ Minor moisture present";
    advice = "Small moisture fraction — check separators and checkpoints for occasional carryover.";
  } else if (x >= 0.50) {
    classification = "⚠️ Wet steam — moderate moisture";
    advice = "Risk of water carryover, erosion and reduced heat transfer. Inspect separators and consider drying measures.";
  } else {
    classification = "🔴 Very wet steam — high moisture";
    advice = "Immediate attention required: high risk of water hammer, corrosion and equipment damage. Stop, inspect and correct steam quality.";
  }

  // Prepare output details (audit-friendly). NOTE: do not include the formula in notes/UI.
  let details = `<div style="font-weight:bold; margin-bottom:6px;">${classification}</div>`;
  details += `<div>${advice}</div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  // Display
  rateEl.textContent = specificVolume.toFixed(6);
  feedbackEl.innerHTML = details;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

/* Print helper */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 
📌 Specific Volume of Wet Steam Calculator (Essentials)

🔹 Formula:
    • Specific Volume (v) = v_g × x
      - v_g = Specific volume of dry steam (m³/kg)
      - x   = Dryness fraction (0 ≤ x ≤ 1)

🔹 Input Validations:
    • Specific volume of dry steam (v_g):
        - Required
        - Must be numeric
        - Must be > 0
        - Warning if:
            - v_g < 0.01 m³/kg → very small (high-pressure or unit issue)
            - v_g > 100 m³/kg → very large (low-pressure or unit issue)
        - Error if v_g > 1,000,000 → unrealistic (likely unit/data entry error)

    • Dryness fraction (x):
        - Required
        - Must be numeric
        - Must be between 0 and 1 (inclusive)
        - Warning if:
            - More than 4 decimal places → suggest rounding
            - x = 0 → saturated liquid (tool may not represent correctly, use steam tables)
            - x = 1 → dry steam (no liquid present, acceptable)

🔹 Output Validations:
    • Specific volume (v):
        - Must be finite and > 0
        - Error if invalid (NaN, ≤ 0)
        - Warning if:
            - v < 1e-6 → extremely small, check inputs/units
            - v > 1000 → very large, possible mismatch or error

    • Classification by dryness fraction:
        - x ≥ 0.95 → Mostly dry steam (low moisture risk)
        - 0.80 ≤ x < 0.95 → Minor moisture present (check separators occasionally)
        - 0.50 ≤ x < 0.80 → Wet steam — moderate moisture (erosion/carryover risk)
        - x < 0.50 → Very wet steam — high moisture (risk of water hammer & equipment damage)

    • Advice:
        - Each classification includes preventive/inspection recommendations
-->
