{% extends 'base.html' %}
{% block title %}Daughter Product Activity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daughter Product Activity Calculator'</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

<div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>
<div class="calculator-container printable" id="printArea">


{% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Daughter Product Activity Calculator</h1>
    <p>Calculate the activity of daughter products in radioactive decay chains (result shown in Curies).</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="initialActivity">Initial Parent Activity (N₁₀, Curies)</label>
                <input type="number" id="initialActivity" class="form-input" step="any" min="0" placeholder="e.g., 1000" aria-label="Initial parent activity">
            </div>

            <div class="form-group">
                <label for="lambda1">Parent Decay Constant (λ₁, time⁻¹)</label>
                <input type="number" id="lambda1" class="form-input" step="any" min="0" placeholder="e.g., 0.05" aria-label="Parent decay constant">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="lambda2">Daughter Decay Constant (λ₂, time⁻¹)</label>
                <input type="number" id="lambda2" class="form-input" step="any" min="0" placeholder="e.g., 0.1" aria-label="Daughter decay constant">
            </div>

            <div class="form-group">
                <label for="timeElapsed">Time Elapsed (t, time units)</label>
                <input type="number" id="timeElapsed" class="form-input" step="any" min="0" placeholder="e.g., 10" aria-label="Time elapsed">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateDaughterActivity()">Calculate Daughter Activity</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Radioactive decay illustration">
            <p>This tool calculates the activity of daughter products in radioactive decay chains.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Daughter Activity</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="daughterActivity">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">Curies</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Decay Chain Assessment</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
    <div class="note-card">
        <h3>📘 About</h3>
        <p>
            This calculator determines the activity of daughter products in radioactive decay chains using the Bateman equations. It models how radioactive parent nuclei decay to daughter products, which is essential for radiation safety, nuclear medicine, and environmental monitoring.
        </p>
    </div>

    <div class="note-card">
        <h3>✅ Input Validations</h3>
        <ul class="note-list">
            <li><strong>Initial Parent Activity (N₁₀):</strong> Must be <em>non-negative</em> and ≤ 1,000,000 Curies.</li>
            <li><strong>Parent Decay Constant (λ₁):</strong> Must be <em>greater than 0</em> and ≤ 10 time⁻¹.</li>
            <li><strong>Daughter Decay Constant (λ₂):</strong> Must be <em>greater than 0</em> and ≤ 10 time⁻¹.</li>
            <li><strong>Time Elapsed (t):</strong> Must be <em>non-negative</em> and ≤ 100 time units.</li>
            <li><strong>Decay Constant Comparison:</strong> λ₁ and λ₂ cannot be equal (within 0.0001 precision).</li>
            <li><strong>Physical Constraints:</strong> Daughter activity cannot exceed parent activity in equilibrium conditions.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🔎 Decay Chain Classification</h3>
        <ul class="note-list">
            <li><strong>Transient Equilibrium (λ₂ > λ₁):</strong> Daughter activity peaks then decays with parent's half-life.</li>
            <li><strong>Secular Equilibrium (λ₂ >> λ₁):</strong> Daughter activity approaches and maintains equilibrium with parent.</li>
            <li><strong>No Equilibrium (λ₂ < λ₁):</strong> Daughter activity grows and eventually decays independently.</li>
            <li><strong>Early Growth Phase:</strong> Daughter activity increasing toward maximum.</li>
            <li><strong>Decay Phase:</strong> Daughter activity decreasing after reaching peak.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>☢️ Applications</h3>
        <ul class="note-list">
            <li><strong>Nuclear Medicine:</strong> Calculating radiation doses for diagnostic imaging and therapy.</li>
            <li><strong>Radiation Safety:</strong> Monitoring radioactive material storage and handling.</li>
            <li><strong>Environmental Monitoring:</strong> Tracking radioactive contaminant breakdown in ecosystems.</li>
            <li><strong>Archaeological Dating:</strong> Using radioactive decay chains for age determination.</li>
            <li><strong>Nuclear Power:</strong> Managing fuel cycles and waste products.</li>
            <li><strong>Scientific Research:</strong> Studying nuclear reactions and decay processes.</li>
        </ul>
    </div>

    <div class="note-card">
        <h3>🛑 Limitations</h3>
        <ul class="note-list">
            <li>Assumes simple two-nuclide decay chain (parent → daughter).</li>
            <li>Does not account for more complex decay chains with multiple daughters.</li>
            <li>Assumes constant decay constants (no external influences).</li>
            <li>May not account for branching decays or isomeric transitions.</li>
            <li>Time units must be consistent across all parameters.</li>
            <li>Not valid for λ₁ = λ₂ (requires special secular equilibrium formula).</li>
        </ul>
    </div>
</div>

<script>
/* Helper: show errors consistently */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

/* Main Daughter Activity calculation with QEHS-compliant validations */
function calculateDaughterActivity() {
  const N10 = parseFloat(document.getElementById("initialActivity")?.value.trim());
  const lambda1 = parseFloat(document.getElementById("lambda1")?.value.trim());
  const lambda2 = parseFloat(document.getElementById("lambda2")?.value.trim());
  const t = parseFloat(document.getElementById("timeElapsed")?.value.trim());

  const activityEl = document.getElementById("daughterActivity");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  document.getElementById("resultError").classList.add("hidden");
  if (feedbackEl) feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required numeric checks
  if (![N10, lambda1, lambda2, t].every(Number.isFinite)) {
    errors.push("👉 All inputs are required and must be numeric.");
    showErrors(errors); return;
  }

  // Threshold validations
  if (N10 < 0 || N10 > 1e6) errors.push("👉 Initial activity must be ≥0 and ≤1,000,000 Ci.");
  if (lambda1 <= 0 || lambda1 > 10) errors.push("👉 Parent decay constant (λ₁) must be >0 and ≤10.");
  if (lambda2 <= 0 || lambda2 > 10) errors.push("👉 Daughter decay constant (λ₂) must be >0 and ≤10.");
  if (t < 0 || t > 100) errors.push("👉 Time elapsed must be ≥0 and ≤100 units.");

  if (errors.length) { showErrors(errors); return; }

  // Cross-field: λ₁ ≠ λ₂
  if (Math.abs(lambda1 - lambda2) < 0.0001) {
    errors.push("👉 λ₁ and λ₂ too close. Use secular equilibrium formula.");
    showErrors(errors); return;
  }

  // Plausibility warnings
  if (N10 > 1e4) warnings.push("⚠️ High initial activity – shielding & PPE must be verified.");
  if (lambda1 > 5) warnings.push("⚠️ Very rapid parent decay – short-lived isotope.");
  if (lambda2 > 5) warnings.push("⚠️ Very rapid daughter decay – short-lived isotope.");
  if (t > 50) warnings.push("⚠️ Long elapsed time – multiple half-lives considered.");

  // Bateman calculation
  const numerator = lambda1 * N10;
  const denominator = lambda2 - lambda1;
  const exp1 = Math.exp(-lambda1 * t);
  const exp2 = Math.exp(-lambda2 * t);
  const daughterActivity = (numerator / denominator) * (exp1 - exp2);

  if (!Number.isFinite(daughterActivity) || daughterActivity < 0) {
    showErrors(["⚠️ Computed activity is invalid. Check inputs."]);
    return;
  }

  // Peak analysis
  let peakTime = null, equilibriumType = "";
  if (lambda2 > lambda1) {
    peakTime = Math.log(lambda2 / lambda1) / (lambda2 - lambda1);
    equilibriumType = "Transient Equilibrium";
  } else if (lambda2 < lambda1) {
    equilibriumType = "No Equilibrium";
  }

  // Classification
  let classification, suggestion;
  if (t === 0) {
    classification = "Initial State"; suggestion = "⏱️ Daughter activity = 0 at start.";
  } else if (daughterActivity < 0.01 * N10) {
    classification = "Low Activity"; suggestion = "📉 Daughter nearly decayed.";
  } else if (peakTime && Math.abs(t - peakTime) < 0.1 * peakTime) {
    classification = "Peak Activity"; suggestion = "📈 Daughter at max concentration.";
  } else if (lambda2 > lambda1 && t > peakTime) {
    classification = "Decay Phase"; suggestion = "📊 Daughter decaying after peak.";
  } else {
    classification = "Growth Phase"; suggestion = "📈 Daughter growing toward equilibrium.";
  }

  // Output guardrails
  if (daughterActivity > N10 * 1.05) {
    warnings.push("⚠️ Daughter exceeds parent – verify decay constants.");
  }

  // Build feedback
  let details = `<div>Daughter Activity = <b>${daughterActivity.toExponential(4)}</b> Ci</div>`;
  details += `<div>Classification: <b>${classification}</b></div>`;
  details += `<div style="margin-top:6px;">${suggestion}</div>`;
  details += `<div style="margin-top:8px; font-size:14px;">Fraction of parent: ${(daughterActivity / N10 * 100).toFixed(2)}%</div>`;
  if (peakTime) details += `<div style="font-size:14px;">Peak time: ${peakTime.toFixed(4)} units (${equilibriumType})</div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  // Update UI
  activityEl.textContent = daughterActivity.toExponential(4);
  feedbackEl.innerHTML = details;

  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

/* Print handler */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
  }
  window.print();
}
</script>



</body>
</html>
{% endblock %}




<!-- 
==============================================
DAUGHTER ACTIVITY CALCULATOR - DOCUMENTATION
==============================================

📌 Formula Used (Bateman Equation for a Two-Stage Decay):
  A₂(t) = (λ₁ × N₁₀) / (λ₂ − λ₁) × (e^(−λ₁t) − e^(−λ₂t))

  where:
    A₂(t)   = Daughter activity at time t (Ci)
    N₁₀     = Initial parent activity (Ci)
    λ₁      = Parent decay constant (per time unit)
    λ₂      = Daughter decay constant (per time unit)
    t       = Elapsed time

📌 Input Validations:
  - Initial Activity (N₁₀):
      • Required, numeric
      • Must be ≥ 0 and ≤ 1,000,000 Ci
      • Warning if > 10,000 Ci (high radiation, shielding needed)

  - Parent Decay Constant (λ₁):
      • Required, numeric
      • Must be > 0 and ≤ 10
      • Warning if > 5 (very short-lived parent)

  - Daughter Decay Constant (λ₂):
      • Required, numeric
      • Must be > 0 and ≤ 10
      • Warning if > 5 (very short-lived daughter)

  - Time (t):
      • Required, numeric
      • Must be ≥ 0 and ≤ 100 units
      • Warning if > 50 (multiple half-lives considered)

  - Cross-field Rule:
      • λ₁ ≠ λ₂ (otherwise use secular equilibrium formula)

📌 Output Validations:
  - Computed daughter activity must be finite and ≥ 0
  - Warning if daughter activity > parent activity (unrealistic)
  - Negative results corrected to 0
  - High elapsed time may reduce accuracy

📌 Classification Rules:
  - t = 0 → Initial State (daughter activity = 0)
  - Daughter < 1% of parent → Low Activity (nearly decayed)
  - Near peak time → Peak Activity (maximum daughter buildup)
  - After peak (λ₂ > λ₁, t > peak time) → Decay Phase
  - Otherwise → Growth Phase (daughter building toward equilibrium)

📌 Additional Notes:
  - Peak Time (if λ₂ > λ₁): 
        t_peak = ln(λ₂ / λ₁) / (λ₂ − λ₁)
        Indicates Transient Equilibrium
  - If λ₂ < λ₁ → No Equilibrium (daughter decays faster than parent)

-->

