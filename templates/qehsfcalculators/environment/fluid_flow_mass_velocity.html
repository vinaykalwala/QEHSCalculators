{% extends 'base.html' %}
{% block title %}Fluid Flow Mass Velocity Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluid Flow Mass Velocity Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
  <h1>Fluid Flow Mass Velocity Calculator</h1>
  <p>Calculate the <strong>Mass Velocity (kg/m²·s)</strong> to assess flow loading, erosion/noise risk, and operability of fire-water and process systems.</p>
</div>

<div class="calc-content">
  <!-- Calculator -->
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="velocity">Average Velocity (m/s)</label>
      <input type="number" id="velocity" class="form-input" min="0" step="any" placeholder="e.g., 2.5">
    </div>

    <div class="form-group">
      <label for="density">Fluid Density (kg/m³)</label>
      <input type="number" id="density" class="form-input" min="0.001" step="any" placeholder="e.g., 1000 (water), 1.2 (air)">
    </div>

    <button class="calculate-btn" onclick="calculateCorrosionRate()">Calculate Mass Velocity</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="/static/images/mlc_environment_result.png" alt="Flow illustration">
      <p>This tool calculates <strong>Mass Velocity (kg/m²·s)</strong> and provides safety-focused guidance.</p>
    </div>

    <div class="result-error hidden" id="resultError">
      <div class="error-icon">❌</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue">
      <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Calculated Mass Velocity</h2>
      </div>

      <div class="rate-display">
        <div class="rate-value" id="rateValue">0.0000</div>
        <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">kg/m²·s</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
      <div class="btn-wrapper">
        <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
      </div>
    </div>
  </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      Computes <strong>mass velocity</strong> to characterize flow intensity through pipes/ducts. 
      Useful for <strong>fire-water networks</strong> (ensuring hydrant/sprinkler operability), 
      <strong>industrial ventilation</strong> (fume/toxic control), and <strong>process lines</strong>
      (minimizing erosion, noise, and vibration).
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Velocity (U):</strong> Fluid velocity in m/s.</li>
      <li><strong>Density (ρ):</strong> Fluid density in kg/m³.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>Velocity (m/s):</strong> Required; 0 ≤ U ≤ 100. Warnings if U &gt; 30 (liquids) or U &gt; 50 with gas-like density.</li>
      <li><strong>Density (kg/m³):</strong> Required; 0.001 ≤ ρ ≤ 20,000. Warnings if ρ &lt; 0.3 (light gases) or ρ &gt; 3,000 (slurries/cryogenics).</li>
      <li><strong>Decimals:</strong> Up to 6 allowed; outputs rounded to 4 decimals.</li>
      <li><strong>Output guardrails:</strong> 0 ≤ G ≤ 1,000,000 kg/m²·s (beyond this is non-typical/unsafe; flagged).</li>
      <li><strong>Cross-field checks:</strong> If ρ &lt; 5 and U &gt; 50 → warn about compressible high-speed gas regime; if ρ ≥ 500 and U &gt; 10 → warn about erosion/noise in liquids.</li>
      <li><strong>Invalid inputs:</strong> Negative or non-numeric values are invalid.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📏 Output Validations</h3>
    <ul class="note-list">
      <li><strong>Mass Velocity (G):</strong> Displayed in kg/m²·s with 4 decimals.</li>
      <li><strong>Assessment:</strong>
        <ul>
          <li>G = 0 kg/m²·s: Neutral: Static fluid (no flow).</li>
          <li>0 &lt; G &lt; 1 kg/m²·s: Low mass velocity — natural convection / stagnant risk zones.</li>
          <li>1–5 kg/m²·s: Moderate mass velocity — suitable for many HVAC applications.</li>
          <li>5–50 kg/m²·s: High mass velocity — typical for industrial ventilation and low-flow liquids.</li>
          <li>50–500 kg/m²·s: Very high mass velocity — check erosion/noise and support design.</li>
          <li>&gt; 500 kg/m²·s: Extreme mass velocity — verify mechanical limits and safety margins.</li>
        </ul>
      </li>
      <li>Warnings are triggered for extreme conditions: very low density, high velocity, or unusually high mass velocity.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>📖 Governing Principle</h3>
    <p>
      A Fluid Flow Mass Velocity Calculator is not based on a single, universal standard, but rather uses the general formula for mass flow rate (m = ρVA, where m is mass flow rate, ρ is fluid density, V is fluid velocity, and A is cross-sectional area) which is a fundamental principle in fluid mechanics and physics. However, specific applications and industries may adhere to various established standards for defining conditions like standard temperature and pressure (STP) for volume flow calculations, which indirectly affect mass flow values.
    </p>
    <p><b>Fundamental Principle</b></p>
    <p><b>Mass Flow Rate Formula:</b> The most common basis for such calculators is the fundamental equation: Mass Flow Rate (m) = Fluid Density (ρ) x Fluid Velocity (V) x Cross-sectional Area (A).</p>
    <p><b>SI Units:</b> The standard SI unit for mass flow rate is kilograms per second (kg/s).</p>
    <p><b>Influence of Industry Standards</b></p>
    <p><b>Standardized Volumetric Flow:</b> For gases, calculations often involve converting volumetric flow to a standardized volume (e.g., standard cubic feet, SCFM) at specific temperatures and pressures.</p>
    <p><b>Examples of Standards:</b></p>
    <ul class="note-list">
      <li>API (American Petroleum Institute), PNEUROP, and CAGI (Compressed Air and Gas Institute) often use 14.5 PSIA and 68°F (0% humidity).</li>
      <li>ASME (American Society of Mechanical Engineers): may use 14.7 PSIA and 68°F.</li>
    </ul>
    <p><b>Impact on Mass Flow:</b> These standards are applied to volumetric flow rates, and the density (ρ) in the mass flow rate formula would be determined under these standard conditions to derive standardized mass flow rates.</p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides reliable estimates of mass velocity based on the fundamental fluid mechanics formula (m = ρVA), supporting applications in <strong>fire-water networks</strong>, <strong>industrial ventilation</strong>, and <strong>process lines</strong>. Ensure input values align with realistic ranges and consider applicable industry standards (e.g., API, ASME) for accurate results and compliance with regulatory requirements.
    </p>
  </div>
</div>
</div>
<script>
/* Show error messages */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Kept the original name for wiring, now calculates Mass Velocity (G) */
function calculateCorrosionRate() {
  const velRaw = document.getElementById("velocity").value.trim();
  const rhoRaw = document.getElementById("density").value.trim();

  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("rateValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  errorMessage.innerHTML = "";
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Presence checks
  if (velRaw === "") errors.push("👉 Please enter Average Velocity (m/s).");
  if (rhoRaw === "") errors.push("👉 Please enter Fluid Density (kg/m³).");
  if (errors.length) return showErrors(errors);

  // Numeric parsing
  const U = parseFloat(velRaw);
  const rho = parseFloat(rhoRaw);
  const isFiniteNum = (v) => Number.isFinite(v) && !Number.isNaN(v);

  if (!isFiniteNum(U)) errors.push("👉 Velocity must be numeric.");
  if (!isFiniteNum(rho)) errors.push("👉 Density must be numeric.");
  if (errors.length) return showErrors(errors);

  // Range validations
  if (U < 0 || U > 100) errors.push("👉 Velocity must be between 0 and 100 m/s.");
  if (rho < 0.001 || rho > 20000) errors.push("👉 Density must be between 0.001 and 20,000 kg/m³.");

  // Decimal warnings
  const countDecimals = (s) => (s.includes(".") ? s.split(".")[1].length : 0);
  if (countDecimals(velRaw) > 6) warnings.push("⚠️ Velocity has >6 decimals; results will be rounded.");
  if (countDecimals(rhoRaw) > 6) warnings.push("⚠️ Density has >6 decimals; results will be rounded.");

  // Cross-field context warnings
  if (rho < 0.3) warnings.push("ℹ️ Very low density — gas-like regime.");
  if (rho > 3000) warnings.push("ℹ️ Very high density — slurry/cryogenic or unit mismatch?");

  if (rho < 5 && U > 50) warnings.push("⚠️ High-speed gas flow — compressibility/shock noise likely; verify design.");
  if (rho >= 500 && U > 10) warnings.push("⚠️ High-energy liquid flow — erosion/vibration risk; check materials and supports.");

  if (errors.length) return showErrors(errors);

  // Core calculation
  const G = rho * U; // kg/m²·s

  if (!isFiniteNum(G) || G < 0) return showErrors(["⚠️ Computed mass velocity is invalid."]);
  if (G > 1_000_000) warnings.push("⚠️ Mass velocity exceeds typical engineering limits; verify inputs/units.");

  // Classification
  let statusMsg = "";
  if (G === 0) {
    statusMsg = "Neutral: Static fluid (no flow).";
  } else if (G < 1) {
    statusMsg = "Low mass velocity — natural convection / stagnant risk zones.";
  } else if (G < 5) {
    statusMsg = "Moderate mass velocity — suitable for many HVAC applications.";
  } else if (G < 50) {
    statusMsg = "High mass velocity — typical for industrial ventilation and low-flow liquids.";
  } else if (G < 500) {
    statusMsg = "Very high mass velocity — check erosion/noise and support design.";
  } else {
    statusMsg = "Extreme mass velocity — verify mechanical limits and safety margins.";
  }

  // Details
  let details = `<div>Mass Velocity G: <b>${G.toFixed(4)}</b> kg/m²·s</div>`;
  details += `<div>Inputs → Velocity: <b>${U.toFixed(4)}</b> m/s, Density: <b>${rho.toFixed(4)}</b> kg/m³</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:6px; color:#b35d00; font-size:0.95em;">${warnings.join(" | ")}</div>`;
  }

  // Render
  rateEl.textContent = G.toFixed(4);
  feedbackEl.innerHTML = `<div>${statusMsg}</div>${details}`;

  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}

function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    el.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
  }
  window.print();
}
</script>


    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 
📌 Mass Velocity (G) Calculator

Formula:
 - G = ρ × U   [kg/m²·s]

Inputs:
 - U → Average Velocity [m/s]
 - ρ → Fluid Density [kg/m³]

Outputs:
 - G → Mass Velocity [kg/m²·s]
 - Classification message (flow regime)

Validations:
 - U must be numeric, 0 ≤ U ≤ 100 m/s
 - ρ must be numeric, 0.001 ≤ ρ ≤ 20,000 kg/m³
 - G must be ≥ 0
 - Guardrail: G ≤ 1,000,000 (else unrealistic)
-->
