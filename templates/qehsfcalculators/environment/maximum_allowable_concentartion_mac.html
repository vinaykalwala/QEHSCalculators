{% extends 'base.html' %}
{% block title %}Maximum allowable concentartion (MAC) calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maximum allowable concentartion (MAC) calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}


<div class="calculator-header">
    <h1>Maximum allowable concentartion (MAC) calculator</h1>
    <p>Determine cumulative exposure to a substance over time, expressed in <strong>ppm¬∑hours</strong>. Ensures occupational safety and compliance with exposure limits.</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="form-group">
            <label for="exposureLimit"><strong>Exposure Limit (ppm):</strong></label>
            <input type="number" id="exposureLimit" class="form-input" step="any" min="0" placeholder="e.g., 25">
        </div>

        <div class="form-group">
            <label for="timeDuration"><strong>Time Duration (hours):</strong></label>
            <input type="number" id="timeDuration" class="form-input" step="any" min="0" placeholder="e.g., 8">
        </div>

        <button class="calculate-btn" onclick="calculateMAC()">Calculate MAC</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Steam illustration">
            <p>Enter values above and click <strong>Calculate MAC</strong> to determine cumulative exposure.</p>
        </div>

        <div class="result-error hidden" id="resultError">
            <div class="error-icon">‚ùå</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Calculated MAC</h2>
            </div>

            <div class="rate-display">
                <div class="rate-value" id="macValue">0.00</div>
                <div class="rate-label" style="color:#2980b9; font-size:20px; font-weight:bold;">ppm¬∑hours</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment</div>
                <div class="feedback-content" id="feedback"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">
  <!-- About -->
  <div class="note-card">
    <h3>üìò About This Calculator</h3>
    <p>
      This <strong>MAC Calculator</strong> determines cumulative exposure of a substance over time.  
      It is useful for occupational safety, laboratory monitoring, and industrial workplace assessments.
    </p>
  </div>

  <!-- Parameters Used -->
  <div class="note-card">
    <h3>‚öô Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Exposure Limit (ppm)</strong> ‚Äî concentration of substance in air.</li>
      <li><strong>Time Duration (hours)</strong> ‚Äî length of exposure period.</li>
      <li><strong>MAC (ppm¬∑h)</strong> = Exposure Limit √ó Time Duration.</li>
    </ul>
  </div>

  <!-- Input Validation Rules -->
  <div class="note-card">
    <h3>‚úÖ Input Validation Rules</h3>
    <ul class="note-list">
      <li>‚úîÔ∏è Exposure Limit ‚â• 0.01 ppm (positive number required).</li>
      <li>‚úîÔ∏è Time Duration ‚â• 0.01 h (positive number required).</li>
      <li>‚úîÔ∏è Reasonable max values: Exposure Limit ‚â§ 1000 ppm, Time ‚â§ 8760 h (1 year).</li>
      <li>‚ùå Zero, negative, or non-numeric values are invalid.</li>
      <li>‚ö†Ô∏è Exposure > 1000 ppm ‚Üí unit/regulation check required.</li>
      <li>‚ö†Ô∏è Time > 8760 h ‚Üí unrealistic (over one year of continuous exposure).</li>
      <li>‚ö†Ô∏è Extremely high MAC (>10,000 ppm¬∑h) ‚Üí unsafe or unit mismatch.</li>
      <li>‚ö†Ô∏è Extremely low MAC (<0.01 ppm¬∑h) ‚Üí rounding/measurement issue.</li>
    </ul>
  </div>

  <!-- Output Validations -->
  <div class="note-card">
    <h3>üìä Output Validations</h3>
    <ul class="note-list">
      <li>‚úÖ Cumulative exposure within safe limits (MAC ‚â§ 50 ppm¬∑h).</li>
      <li>‚ö†Ô∏è Cumulative exposure elevated, monitor closely (50 < MAC ‚â§ 100 ppm¬∑h).</li>
      <li>üî¥ Cumulative exposure hazardous, immediate mitigation required (MAC > 100 ppm¬∑h).</li>
    </ul>
  </div>

  <!-- Governing Principle -->
  <div class="note-card">
    <h3>üìê Governing Principle</h3>
    <p>
      A "Maximum Allowable Concentration (MAC)" is not tied to a single, universal standard; rather, MAC calculators are context-specific, applied in industries such as 
      environmental protection (air/water pollutants), pharmaceuticals (Maximum Allowable Carryover), and indoor air quality.  
      Standards such as those from ISPE, ISO, ASHRAE, and EU regulatory bodies define calculation methods and acceptable exposure limits.  
    </p>
    <ul class="note-list">
      <li><strong>Pharmaceutical Industry:</strong> MACO calculators determine acceptable residue between drug batches. ISPE standards define exposure methods.</li>
      <li><strong>Environmental & Occupational Health:</strong> MAC values for air/water pollutants are based on ISO/ASHRAE guidelines to protect health and environment.</li>
      <li><strong>Radiation:</strong> MAC for radioactive contaminants is based on maximum permissible dose rates by regulatory authorities.</li>
    </ul>
  </div>

  <!-- Conclusion -->
  <div class="note-card">
    <h3>üîé Conclusion</h3>
    <p>
      The MAC Calculator provides a straightforward way to estimate cumulative exposure risk.  
      By combining exposure concentration with duration, it helps assess compliance with health and safety standards, guiding safe work practices and regulatory alignment.  
      Interpretation of results (safe, elevated, hazardous) is displayed alongside the calculation for immediate decision support.
    </p>
  </div>
</div>


<script>
function showErrors(errors) {
    const errorBox = document.getElementById("resultError");
    const errorMessage = document.getElementById("errorMessage");
    const placeholder = document.getElementById("placeholder");
    const resultValue = document.getElementById("resultValue");

    errorMessage.innerHTML = errors.join("<br>");
    errorBox.classList.remove("hidden");
    placeholder.classList.add("hidden");
    resultValue.classList.add("hidden");
}

function calculateMAC() {
    const exposureRaw = document.getElementById("exposureLimit").value.trim();
    const timeRaw = document.getElementById("timeDuration").value.trim();

    const errorBox = document.getElementById("resultError");
    const resultValue = document.getElementById("resultValue");
    const placeholder = document.getElementById("placeholder");
    const macEl = document.getElementById("macValue");
    const feedbackEl = document.getElementById("feedback");

    errorBox.classList.add("hidden");
    feedbackEl.innerHTML = "";

    const errors = [];
    const warnings = [];

    // Required field validation
    if (exposureRaw === "") errors.push("üëâ Please enter Exposure Limit (ppm).");
    if (timeRaw === "") errors.push("üëâ Please enter Time Duration (hours).");
    if (errors.length) return showErrors(errors);

    const exposure = parseFloat(exposureRaw);
    const time = parseFloat(timeRaw);

    // Numeric & range validations
    if (!Number.isFinite(exposure) || exposure < 0.01) errors.push("üëâ Exposure Limit must be ‚â• 0.01 ppm.");
    if (!Number.isFinite(time) || time < 0.01) errors.push("üëâ Time Duration must be ‚â• 0.01 hours.");
    if (exposure > 1000) warnings.push("‚ö†Ô∏è Exposure Limit is unusually high - check units and safety regulations.");
    if (time > 8760) warnings.push("‚ö†Ô∏è Time Duration exceeds one year - check input.");
    if (errors.length) return showErrors(errors);

    // Compute MAC
    const mac = exposure * time;

    if (mac > 10000) warnings.push("‚ö†Ô∏è MAC exceeds typical safety thresholds (>10,000 ppm¬∑h).");
    if (mac < 0.01) warnings.push("‚ö†Ô∏è MAC is extremely low (<0.01 ppm¬∑h) - verify input precision.");

    macEl.textContent = mac.toFixed(2);

    // Status messages based on MAC
    let status = "";
    if (mac <= 50) status = "‚úÖ Cumulative exposure within safe limits.";
    else if (mac <= 100) status = "‚ö†Ô∏è Cumulative exposure elevated. Monitor closely.";
    else status = "üî¥ Cumulative exposure hazardous. Immediate mitigation required.";

    let details = `<div>MAC: <b>${mac.toFixed(2)}</b> ppm¬∑hours</div>`;
    if (warnings.length) details += `<div style="margin-top:6px; color:#b35d00;">${warnings.join(" | ")}</div>`;

    feedbackEl.innerHTML = `<div>${status}</div>${details}`;

    placeholder.classList.add("hidden");
    resultValue.classList.remove("hidden");
    errorBox.classList.add("hidden");
}

function printReport() {
    const el = document.getElementById('printDate');
    if (el) {
        el.textContent = new Date().toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
    }
    window.print();
}
</script>

    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- /*
===========================================================
Maximum Allowable Concentration (MAC) Calculator
===========================================================

üìå Formula:
    MAC (ppm¬∑h) = Exposure Limit (ppm) √ó Time Duration (hours)

-------------------------------------------
‚úÖ Input Requirements & Validations:

1. Required inputs:
   - Exposure Limit (ppm)
   - Time Duration (hours)

2. Numeric & range checks:
   - Exposure Limit ‚â• 0.01 ppm
   - Time Duration ‚â• 0.01 hours
   - Exposure Limit > 1000 ppm ‚Üí warning (check units/regulations)
   - Time Duration > 8760 h ‚Üí warning (input exceeds 1 year)

-------------------------------------------
‚ö†Ô∏è Warnings / Plausibility Checks:

- MAC > 10,000 ppm¬∑h ‚Üí warning: exceeds typical safety thresholds
- MAC < 0.01 ppm¬∑h ‚Üí warning: extremely low, verify input precision

-------------------------------------------
üìä Output:

- MAC value (ppm¬∑h)
- Inputs summary (Exposure Limit, Time Duration)
- Warnings (if any)
- Status interpretation:
    ‚Ä¢ MAC ‚â§ 50 ‚Üí ‚úÖ Safe cumulative exposure
    ‚Ä¢ 50 < MAC ‚â§ 100 ‚Üí ‚ö†Ô∏è Elevated exposure, monitor closely
    ‚Ä¢ MAC > 100 ‚Üí üî¥ Hazardous cumulative exposure, immediate mitigation required

-------------------------------------------
*/ -->
