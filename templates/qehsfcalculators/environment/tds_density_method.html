{% extends 'base.html' %}
{% block title %}TDS Calculator (Density Method){% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDS Calculator (Density Method)</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
       
    <style>
    .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            overflow-y: auto;
            justify-content: center;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
      .btn-wrapper {
    text-align: center; /* centers inline-block buttons */
    margin-top: 20px;
  }

   .btn-wrapper {
    text-align: center; /* centers the button */
    margin-top: 20px;
  }

  .print-btn {
    display: inline-block;
    background:linear-gradient(#1560bd,#000040);
    color: white;
    padding: 8px 18px;   /* control button size */
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    width: auto !important; /* prevent full width */
  }

  .print-btn:hover {
    background: #1560bd;
  }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center; 
        }
        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .rate-label { 
            color: #7f8c8d; 
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }

       
    </style>
</head>
<body>

        <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

    <div class="calculator-container printable" id="printArea">

    {% include "includes/print_header_footer.html" %}

    <div class="calculator-header">
        <h1>TDS Calculator (Density Method)</h1>
        <p>Estimate Total Dissolved Solids (TDS) in water based on relative density at 15.5¬∞C (result shown in ppm).</p>
    </div>

    <div class="calc-content">
        <!-- Calculator -->
        <div class="calc-card">
            <h2>Enter Data</h2>

            <div class="input-row">
                <div class="form-group">
                    <label for="density">Relative Density at 15.5¬∞C</label>
                    <input type="number" id="density" class="form-input" step="any" min="0.9" max="1.2" placeholder="e.g., 1.005" aria-label="Relative Density">
                    <small style="color: #e0e0e0; font-size: 12px;">Must be measured at exactly 15.5¬∞C</small>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateTDS()">Calculate TDS</button>
        </div>

        <!-- Result Section -->
        <div class="result-card">
            <div class="result-placeholder" id="placeholder">
                <img src="/static/images/mlc_environment_result.png" alt="TDS calculation illustration">
                <p>This tool estimates Total Dissolved Solids (TDS) in water based on relative density measurements at 15.5¬∞C.</p>
            </div>

            <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
                <div class="error-icon">‚ùå</div>
                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="result-value hidden" id="resultValue" aria-live="polite">
                <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                    <h2>Total Dissolved Solids (TDS)</h2>
                </div>

                <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                    
                        <div class="rate-value" id="tdsValue">0.00</div>
                        <div class="rate-label" style="font-size:16px; color: #2980b9; ">ppm</div>
                </div>

                <div class="result-feedback">
                    <div class="feedback-title">Water Quality Assessment</div>
                    <div class="feedback-content" id="feedbackContent"></div>
                </div>

                <div class="btn-wrapper">
                    <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Section -->
    <div class="note-section">
        <div class="note-card">
        <h3>‚ÑπÔ∏è About this Calculator</h3>
        <p>
            The <b>TDS (Total Dissolved Solids) Calculator ‚Äì Density Method</b> estimates the concentration 
            of dissolved substances in water by using <b>relative density at 15.5¬∞C</b>.  
            It is a quick estimation method for assessing <b>water quality</b> when conductivity-based 
            measurements are not available.  
        </p>
    </div>

    <!-- Parameters -->
    <div class="note-card">
        <h3>üìä Parameters</h3>
        <ul class="note-list">
            <li><b>Relative Density (15.5¬∞C):</b> Ratio of water sample density to pure water density at 15.5¬∞C.  
                ‚Ä¢ Unit: Dimensionless (no unit)  
                ‚Ä¢ Valid range: 0.90 ‚Äì 1.20  
                ‚Ä¢ Typical drinking water: 0.99 ‚Äì 1.05</li>
        </ul>
    </div>

        

        <div class="note-card">
        <h3>‚úÖ Input Validations</h3>
        <ul class="note-list">
            <li>Relative Density is <b>required</b> ‚Äî cannot be left blank</li>
            <li>Must be a <b>positive finite number</b></li>
            <li>Minimum value: <b>0.90</b> (highly improbable for aqueous solutions)</li>
            <li>Maximum value: <b>1.20</b> (saturated brine solutions)</li>
            <li>Values outside typical ranges (0.99-1.05) trigger warnings</li>
            <li>Must be measured at <b>exactly 15.5¬∞C</b> for accurate results</li>
        </ul>
        </div>

        <div class="note-card">
            <h3>üìä Output Validations</h3>
            <ul class="note-list">
                <li>TDS &lt; 500 ppm  ‚úÖ Excellent Quality ‚Üí Ideal for drinking water. Low mineral content with good taste.</li>
                <li>500-1000 ppm  ‚ö†Ô∏è Good Quality ‚Üí (Acceptable for drinking. Moderate mineral content.)</li>
                <li>1000-2000 ppm  ‚ö†Ô∏è Fair Quality ‚Üí May affect taste. Consider filtration for drinking purposes.</li>
                <li>2000-3000 ppm  ‚ùå Poor Quality ‚Üí Not recommended for drinking without treatment. High mineral content.</li>
                <li>TDS &gt; 3000 ppm  ‚ùå Unacceptable Quality ‚Üí Unsuitable for drinking. Requires treatment before use.</li>
            </ul>
        </div>
<div class="note-card">
  <h3>üìê Governing Principle</h3>
  <p>
    A <b>"TDS Calculator (Density Method)"</b> doesn't refer to a single, universal standard but rather 
    an approach to estimating Total Dissolved Solids (TDS) based on water density. This differs from the 
    standard gravimetric method (e.g., APHA 2540C). Since the density of water changes with the amount of 
    dissolved solids, it can be used for estimation, though not as definitive as direct measurement methods.
  </p>

  <h3 style="margin-top:12px; color:#1976d2;">Understanding the "Density Method" for TDS</h3>
  <ul class="note-list">
    <li><b>Density and TDS:</b> Total Dissolved Solids (TDS) refers to the total amount of dissolved ions 
        in water. Higher solids increase salinity, which in turn affects water density.</li>
    <li><b>Estimation:</b> By measuring the density of a water sample, an estimate of its TDS concentration 
        can be derived. This method is quicker than gravimetric analysis, but provides an estimate rather 
        than a direct measurement.</li>
  </ul>

  <h3 style="margin-top:12px; color:#1976d2;">Relevant Standards and Methods</h3>
  <ul class="note-list">
    <li><b>Gravimetric Method:</b> The definitive method for TDS (e.g., APHA 2540C), involving filtering 
        and evaporating a water sample to measure the residue weight.</li>
    <li><b>Conductivity-Based Methods:</b> Another estimation approach using conductivity, which is also 
        linked to ion concentration and thus TDS.</li>
    <li><b>No Single "Density Method" Standard:</b> Density-based estimation is a principle applied in 
        different contexts, not a standardized method.</li>
  </ul>

  <h3 style="margin-top:12px; color:#1976d2;">What to Look For in a Density-Based TDS Tool</h3>
  <ul class="note-list">
    <li><b>Underlying Principles:</b> The tool uses the known relationship between density and dissolved solids.</li>
    <li><b>Limitations:</b> Results are estimates, not precise measurements like those from the gravimetric method.</li>
  </ul>
</div>

    <!-- Conclusion -->
    <div class="note-card">
        <h3>‚úÖ Conclusion</h3>
        <p>
            This calculator provides a <b>scientific estimation</b> of TDS in water samples using density 
            readings at 15.5¬∞C. While useful for quick assessments, it is <b>less precise than laboratory 
            methods</b> (e.g., gravimetric or conductivity-based).  
            Results help classify water as <span class="good">Excellent</span>, 
            <span class="average">Good/Fair</span>, or <span class="bad">Poor/Unacceptable</span> 
            based on international drinking water guidelines.
        </p>
    </div>


        

</div>

<script>
/* Helper: show errors consistently */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

/* Main TDS calculation with strong validations */
function calculateTDS() {
  // Safe reads
  const densityRaw = document.getElementById("density")?.value.trim() ?? "";

  const tdsEl = document.getElementById("tdsValue");
  const feedbackEl = document.getElementById("feedbackContent");

  // Reset UI
  document.getElementById("resultError").classList.add("hidden");
  if (feedbackEl) feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // Required input check
  if (densityRaw === "") errors.push("üëâ Enter Relative Density value measured at 15.5¬∞C.");

  if (errors.length > 0) { showErrors(errors); return; }

  // Parse number
  const density = parseFloat(densityRaw);

  // Numeric & range checks
  if (!Number.isFinite(density)) errors.push("üëâ Relative Density must be a valid number.");
  if (density < 0.9) errors.push("üëâ Relative Density cannot be less than 0.9 (highly improbable for aqueous solutions).");
  if (density > 1.2) errors.push("üëâ Relative Density cannot be greater than 1.2 (saturated brine solutions).");
  
  // Warning checks for unusual but possible values
  if (density < 0.99) warnings.push("‚ö†Ô∏è Very low density value - verify measurement and temperature (15.5¬∞C).");
  if (density > 1.05) warnings.push("‚ö†Ô∏è Very high density value - may indicate measurement error or unusual water composition.");
  if (density < 1.0) warnings.push("‚ö†Ô∏è Density less than pure water - verify measurement accuracy.");

  if (errors.length > 0) { showErrors(errors); return; }

  // Compute TDS (ppm) = (Relative Density at 15.5¬∞C - 1) √ó 1.1 √ó 10‚Å∂
  const tds = (density - 1) * 1.1 * 1000000;

  // Check for valid result
  if (!Number.isFinite(tds)) {
    showErrors(["‚ö†Ô∏è Computed TDS value is invalid. Check density input."]);
    return;
  }

  // Negative TDS result check (theoretically impossible with valid density > 0.9)
  if (tds < 0) {
    warnings.push("Note: Negative TDS value calculated. This suggests density < 1.0, which is unusual for aqueous solutions.");
  }

  // Extreme results warning
  if (tds > 100000) {
    warnings.push("‚ö†Ô∏è Extremely high TDS value - verify density measurement and temperature.");
  }

  // Water quality classification based on TDS values
  let classification = "";
  let suggestion = "";
  
  if (tds < 500) {
    classification = "Excellent Quality";
    suggestion = "‚úÖ Ideal for drinking water. Low mineral content with good taste.";
  } else if (tds >= 500 && tds < 1000) {
    classification = "Good Quality";
    suggestion = "‚úÖ Acceptable for drinking. Moderate mineral content.";
  } else if (tds >= 1000 && tds < 2000) {
    classification = "Fair Quality";
    suggestion = "‚ö†Ô∏è May affect taste. Consider filtration for drinking purposes.";
  } else if (tds >= 2000 && tds < 3000) {
    classification = "Poor Quality";
    suggestion = "‚ùå Not recommended for drinking without treatment. High mineral content.";
  } else {
    classification = "Unacceptable Quality";
    suggestion = "‚ùå Unsuitable for drinking. Requires treatment before use.";
  }

  // Compose feedback content
  let details = `<div>TDS = <b>${tds.toFixed(2)}</b> ppm</div>`;
  details += `<div>Water Quality: <b>${classification}</b></div>`;
  details += `<div style="margin-top:6px;">${suggestion}</div>`;
  if (warnings.length) {
    details += `<div style="margin-top:8px; color:#b35d00;">Note: ${warnings.join(" | ")}</div>`;
  }

  // Update UI
  if (tdsEl) tdsEl.textContent = tds.toFixed(2);
  if (feedbackEl) feedbackEl.innerHTML = details;

  // Toggle display
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

/* Print-safe report with date */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    el.textContent = now.toLocaleDateString('en-US', options);
  }
  window.print();
}

// Add event listeners for Enter key
document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById("density");
  if (input) {
    input.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        calculateTDS();
      }
    });
  }
});
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}
<!--

Input Validations
Relative Density: Must be between 0.9 and 1.2 (physically plausible range)

Numeric validation: Ensures input is a valid number

Temperature requirement: Emphasizes measurement at exactly 15.5¬∞C

Edge case handling: Warnings for unusual but possible values

-------------------------------------------------------------------------------
Output Validations
Calculates TDS = (Density - 1) √ó 1.1 √ó 10‚Å∂ (the correct formula)

Provides water quality classification based on TDS levels

Shows warnings for extreme but valid inputs

Handles negative TDS results (theoretically impossible with valid inputs)
---------------------------------------------------------------------------------------------------------
 Edge Cases
Density values less than 1.0 (theoretically unusual for aqueous solutions)

Extremely high density values (>1.05) indicating measurement errors

Negative TDS results (handled with appropriate warnings)
----------------------------------------------------------------------------------------------
TDS Calculation Formula (Density Method)
TDS (ppm) = (Relative Density at 15.5¬∞C - 1) √ó 1.1 √ó 10‚Å∂

-->