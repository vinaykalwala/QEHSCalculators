{% extends 'base.html' %}
{% block title %}Heat Exchanger Temperature Design Constant Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat Exchanger Temperature Design Constant Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
    <style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .back-btn {
            background: linear-gradient(#1560bd, #000040);
            color: #ffffff;
            border: 2px solid #1560bd;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd;
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05);
        }

        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: 420px;
            overflow-y: auto;
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd, #000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: 420px;
            text-align: center;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .result-value { 
            width: 100%; 
        }
        
        .rate-display {
            display: flex;
            gap: 6px;
            align-items: center;  
            justify-content: center;
            flex-wrap: wrap;
        }

        .rate-value {
            font-size: 42px;
            font-weight: 700;
            color: #2980b9;
            margin-bottom: 10px;
            line-height: 1.1;
        }

        .rate-label { 
            color: #7f8c8d;
            font-size: 20px;
            font-weight: bold;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .rate-value {
                font-size: 38px;
            }
            .rate-label {
                font-size: 18px;
            }
        }
        
        @media (max-width: 992px) {
            .rate-value {
                font-size: 34px;
            }
            .rate-label {
                font-size: 17px;
            }
        }
        
        @media (max-width: 768px) {
            .rate-value {
                font-size: 30px;
                margin-bottom: 8px;
            }
            .rate-label {
                font-size: 16px;
            }
        }
        
        @media (max-width: 576px) {
            .rate-value {
                font-size: 28px;
                margin-bottom: 6px;
            }
            .rate-label {
                font-size: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .rate-display {
                flex-direction: column;
                gap: 2px;
                text-align: center;
            }
            .rate-value {
                font-size: 24px;
                margin-bottom: 4px;
            }
            .rate-label {
                font-size: 14px;
            }
        }

        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
        .result-feedback {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 18px;
            border-left: 4px solid #3498db;
            text-align: left;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .feedback-content { 
            color: #34495e; 
        }

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>

    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>


<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

<!-- Replace your existing calculator block with this (keeps layout & IDs similar) -->
<div class="calculator-header">
  <h1>Heat Exchanger Temperature Design Constant Calculator</h1>
  <p>Compute a dimensionless Temperature Design Constant to assess how closely the warmed fluid approaches the steam temperature. Result is <strong>dimensionless</strong>.</p>
</div>

<div class="calc-content">
  <div class="calc-card">
    <h2>Enter Data</h2>

    <div class="form-group">
      <label for="Ts"><strong>Steam Temperature (Ts) ‚Äî ¬∞C *</strong></label>
      <input type="number" id="Ts" class="form-input" step="any" placeholder="e.g., 180">
    </div>

    <div class="form-group">
      <label for="T1"><strong>Secondary Fluid Inlet (T1) ‚Äî ¬∞C *</strong></label>
      <input type="number" id="T1" class="form-input" step="any" placeholder="e.g., 60">
    </div>

    <div class="form-group">
      <label for="T2"><strong>Secondary Fluid Outlet (T2) ‚Äî ¬∞C *</strong></label>
      <input type="number" id="T2" class="form-input" step="any" placeholder="e.g., 110">
    </div>

    <button class="calculate-btn" onclick="calculateCorrosionRate()">Calculate TDC</button>
  </div>

  <!-- Result Section -->
  <div class="result-card">
    <div class="result-placeholder" id="placeholder">
      <img src="https://cdn-icons-png.flaticon.com/512/2942/2942789.png" alt="Heat exchanger">
      <p>This tool computes a dimensionless temperature design constant (TDC). Enter Ts, T1 and T2 (¬∞C).</p>
    </div>

    <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
      <div class="error-icon">‚ùå</div>
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div class="result-value hidden" id="resultValue" aria-live="polite">
      <div style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
        <h2>Temperature Design Constant (TDC)</h2>
      </div>

      <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
        <div class="rate-value" id="tdcValue">0.000</div>
        <div class="rate-label" style="font-size:16px; color:#2980b9;">dimensionless</div>
      </div>

      <div class="result-feedback">
        <div class="feedback-title">Assessment</div>
        <div class="feedback-content" id="feedbackContent"></div>
      </div>
    </div>
  </div>
</div>

<!-- Updated notes -->
<div class="note-section">
  <div class="note-card">
    <h3>About</h3>
        <p>
        The <strong>Temperature Design Constant (TDC)</strong> is a dimensionless indicator of how closely the heated fluid outlet approaches the steam temperature. 
        It reflects the balance between the inlet and outlet conditions of the secondary fluid relative to the steam supply. 
        Enter all temperatures in <strong>¬∞C</strong> (or K, since only differences matter).  
        Lower TDC values indicate stronger heating effectiveness (outlet temperature closer to steam), while higher values suggest weaker approach or potential heat transfer issues.
        </p>

  </div>

  <div class="note-card">
    <h3>Input validations</h3>
    <ul>
      <li><b>Ts (¬∞C):</b> numeric; required; must be &gt; 0 and ‚â§ 1200. Typical industrial steam: 60‚Äì500 ¬∞C.</li>
      <li><b>T1 (¬∞C):</b> numeric; required; typical ‚àí50‚Äì600 ¬∞C; must be &lt; T2.</li>
      <li><b>T2 (¬∞C):</b> numeric; required; typical ‚àí50‚Äì600 ¬∞C; must be &lt; Ts and &gt; T1.</li>
      <li><b>Denominator safety:</b> Ts ‚àí T2 must be &gt; 0.1 ¬∞C to avoid division by near-zero.</li>
      <li><b>Precision:</b> up to 6 decimals accepted; outputs rounded to 3 decimals.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>Applications</h3>
        <ul>
        <li><strong>Heat exchanger performance monitoring:</strong> Identify whether the secondary fluid is effectively absorbing heat from steam.</li>
        <li><strong>Maintenance & fouling detection:</strong> High TDC values may point to scale buildup, fouling, or undersized equipment.</li>
        <li><strong>Safety assessments:</strong> Very low TDC values indicate the outlet is close to steam temperature, raising risks of overheating, hot surfaces, or thermal stress.</li>
        <li><strong>Energy efficiency audits:</strong> Track and optimize heat recovery efficiency in boilers, process plants, and HVAC systems.</li>
        <li><strong>Compliance & QEHS reporting:</strong> Record inputs and results for audits, incident investigations, and regulatory checks.</li>
        </ul>

  </div>

  <div class="note-card">
    <h3>QEHS considerations</h3>
    <ul>
      <li>Very large TDC ‚Üí outlet close to steam: check for overheating, thermal stress and hot surfaces.</li>
      <li>TDC values unexpectedly low or outside typical range ‚Üí verify instrumentation, units and possible fouling/undersized exchangers.</li>
      <li>Log Ts, T1, T2, computed TDC, units and timestamp for audits and incident investigation.</li>
    </ul>
  </div>
</div>

<script>
/* Reusable error UI helper */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  errorMessage.innerHTML = errors.join("<br>");
  errorBox.classList.remove("hidden");
  placeholder.classList.add("hidden");
  resultValue.classList.add("hidden");
}

/* Main calculator (keeps function name so existing button still works) */
function calculateCorrosionRate() {
  const sTs = document.getElementById("Ts").value.trim();
  const sT1 = document.getElementById("T1").value.trim();
  const sT2 = document.getElementById("T2").value.trim();

  const placeholder = document.getElementById("placeholder");
  const errorBox = document.getElementById("resultError");
  const resultValue = document.getElementById("resultValue");
  const rateEl = document.getElementById("tdcValue");
  const feedbackEl = document.getElementById("feedbackContent");

  errorBox.classList.add("hidden");
  feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  const isFiniteNum = v => Number.isFinite(v) && !Number.isNaN(v);
  const decLen = s => (s && s.includes('.')) ? s.split('.')[1].length : 0;

  // presence
  if (sTs === "") errors.push("üëâ Enter steam temperature (Ts) in ¬∞C.");
  if (sT1 === "") errors.push("üëâ Enter secondary inlet temperature (T1) in ¬∞C.");
  if (sT2 === "") errors.push("üëâ Enter secondary outlet temperature (T2) in ¬∞C.");
  if (errors.length) return showErrors(errors);

  // parse
  const Ts = parseFloat(sTs);
  const T1 = parseFloat(sT1);
  const T2 = parseFloat(sT2);

  if (!isFiniteNum(Ts)) errors.push("üëâ Ts must be numeric (¬∞C).");
  if (!isFiniteNum(T1)) errors.push("üëâ T1 must be numeric (¬∞C).");
  if (!isFiniteNum(T2)) errors.push("üëâ T2 must be numeric (¬∞C).");
  if (errors.length) return showErrors(errors);

  // hard range checks
  if (Ts <= 0 || Ts > 1200) errors.push("üëâ Ts must be > 0 ¬∞C and ‚â§ 1200 ¬∞C (check units).");
  if (T1 < -200 || T1 > 1000) errors.push("üëâ T1 appears out of realistic range (‚àí200 to 1000 ¬∞C).");
  if (T2 < -200 || T2 > 1000) errors.push("üëâ T2 appears out of realistic range (‚àí200 to 1000 ¬∞C).");

  // logical ordering (heating)
  if (!(T1 < T2)) errors.push("üëâ T1 must be less than T2 (fluid should be heated: inlet < outlet).");
  if (!(T2 < Ts)) errors.push("üëâ T2 must be less than Ts (steam must be the hottest source).");

  // denominator safety
  const denom = Ts - T2;
  if (denom <= 0) errors.push("üëâ Denominator Ts ‚àí T2 must be > 0 (prevents division by zero or sign reversal).");
  else if (denom < 0.1) errors.push("üëâ Ts ‚àí T2 is too small (<0.1 ¬∞C). Increase difference or verify readings (risk of division by near-zero).");

  if (errors.length) return showErrors(errors);

  // precision warnings
  if (decLen(sTs) > 6) warnings.push("‚ö†Ô∏è Ts has >6 decimals; results will be rounded.");
  if (decLen(sT1) > 6) warnings.push("‚ö†Ô∏è T1 has >6 decimals; results will be rounded.");
  if (decLen(sT2) > 6) warnings.push("‚ö†Ô∏è T2 has >6 decimals; results will be rounded.");

  if (Ts < 60) warnings.push("‚ö†Ô∏è Ts below ~60 ¬∞C ‚Äî confirm steam phase/pressure (may not be saturated steam).");
  if (Ts > 500) warnings.push("‚ö†Ô∏è Very high steam temperature (>500 ¬∞C) ‚Äî confirm equipment ratings and safety.");

  // compute using requested expression:
  const TDC = (Ts - T1) / (Ts - T2);

  if (!isFiniteNum(TDC)) return showErrors(["‚ö†Ô∏è Computed TDC is invalid. Check inputs."]);

  // plausibility: conventional TDC (alternate form) is between 0‚Äì1;
  // with this formula you will commonly see values >1 when T1<T2<Ts ‚Äî warn if extreme
  if (TDC < 0 || TDC > 1000) warnings.push("‚ö†Ô∏è Computed TDC is outside expected practical bounds ‚Äî verify inputs/units.");

  // interpretive guidance (heuristic)
  let classification = "";
  if (TDC >= 10) classification = "Very high approach (outlet very close to steam) ‚Äî risk of hot surfaces/thermal stress.";
  else if (TDC >= 2) classification = "High approach ‚Äî efficient heating but inspect for hot spots or fouling removal needs.";
  else if (TDC >= 1.2) classification = "Moderate approach.";
  else if (TDC >= 1.0) classification = "Low approach ‚Äî outlet not very close to steam.";
  else classification = "Unusual value (<1) ‚Äî verify temperatures and whether formula choice matches your expected definition.";

  // Render
  rateEl.textContent = TDC.toFixed(3);

  let details = `<div><b>TDC:</b> ${TDC.toFixed(3)} (dimensionless)</div>`;
  details += `<div style="margin-top:6px;"><b>Interpretation:</b> ${classification}</div>`;
  details += `<div style="margin-top:6px; font-size:0.95em;">Inputs ‚Üí Ts: <b>${Ts.toFixed(3)}</b> ¬∞C, T1: <b>${T1.toFixed(3)}</b> ¬∞C, T2: <b>${T2.toFixed(3)}</b> ¬∞C</div>`;
  if (warnings.length) details += `<div style="margin-top:8px; color:#b35d00;">${warnings.join(" | ")}</div>`;

  feedbackEl.innerHTML = details;

  // Show results UI
  placeholder.classList.add("hidden");
  resultValue.classList.remove("hidden");
  errorBox.classList.add("hidden");
}
</script>



    <script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!-- 
=======================================
Heat Exchanger Temperature Design Constant Calculator
=======================================

 Formula:
   TDC = (Ts ‚àí T2) / (Ts ‚àí T1)

 Where:
   Ts = Steam temperature (¬∞C)
   T1 = Secondary fluid inlet temperature (¬∞C)
   T2 = Secondary fluid outlet temperature (¬∞C)

---------------------------------------
 Input Validations
---------------------------------------
 ‚Ä¢ Ts (steam temperature)
   - Must be numeric
   - Must be > 0 ¬∞C and ‚â§ 1200 ¬∞C
   - Should be higher than T2

 ‚Ä¢ T1 (secondary inlet temperature)
   - Must be numeric
   - Must be between ‚àí50 ¬∞C and 600 ¬∞C
   - Must be less than T2

 ‚Ä¢ T2 (secondary outlet temperature)
   - Must be numeric
   - Must be between ‚àí50 ¬∞C and 600 ¬∞C
   - Must be less than Ts
   - Must be greater than T1

 ‚Ä¢ Denominator check
   - Ts ‚àí T1 must be > 0 (to avoid division by zero)
   - Should not be < 0.1 (to avoid unstable results)

---------------------------------------
 Output Validations
---------------------------------------
 ‚Ä¢ TDC should be a finite number
 ‚Ä¢ Plausible range: 0 ‚â§ TDC ‚â§ 1
   - If outside this, inputs/units may be wrong

---------------------------------------
 Output Interpretation
---------------------------------------
 ‚Ä¢ TDC ‚â§ 0.10 ‚Üí Outlet ‚âà steam (high approach) ‚Äî possible thermal stress
 ‚Ä¢ 0.10 < TDC ‚â§ 0.30 ‚Üí Very effective heating
 ‚Ä¢ 0.30 < TDC ‚â§ 0.60 ‚Üí Moderate performance (typical design)
 ‚Ä¢ 0.60 < TDC ‚â§ 0.90 ‚Üí Weak approach (undersized/fouling)
 ‚Ä¢ > 0.90 ‚Üí No effective heating (inlet ‚âà outlet)

 Warnings:
 ‚Ä¢ Too many decimals (>6) ‚Üí will be rounded
 ‚Ä¢ Ts < 60 ¬∞C ‚Üí steam phase doubtful
 ‚Ä¢ Ts > 500 ¬∞C ‚Üí very high, check equipment safety
-->
