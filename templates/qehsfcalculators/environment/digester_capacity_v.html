{% extends 'base.html' %}
{% block title %}Digester Capacity (V) Calculator{% endblock %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digester Capacity (V) Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/print.css' %}">
<style>
        /* Main container */
        .calculator-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0px 20px;
            border-radius: 12px;
        }

        .btn-container {
            display: flex;
            justify-content: center; /* Horizontally center */
            margin: 30px 0;
        }

        .back-btn {
            background:linear-gradient(#1560bd,#000040); /* Dark navy background */
            color: #ffffff; /* White text */
            border: 2px solid #1560bd; /* Highlight border */
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            text-decoration: none; /* Remove underline for link */
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .back-btn:hover {
            background-color: #1560bd; /* Highlight on hover */
            color: #ffffff;
            border-color: #000040;
            transform: scale(1.05); /* Subtle hover effect */
        }
        /* Header */
        .calculator-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .calculator-header h1 {
            color: #1560bd;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .calculator-header p {
            color: #7f8c8d;
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Layout */
        .calc-content {
             /* display: flex;  */
            gap: 30px;
            margin-bottom: 40px;
            align-items: stretch;
        }
        
        @media (max-width: 900px) {
            .calc-content { 
                flex-direction: column; 
            }
        }

        /* Cards */
        .result-card {
            flex: 1;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            padding: 30px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            border: 2px solid #1560bd;
        }
        
        .calc-card {
            flex: 1;
            background: linear-gradient(135deg, #1560bd, #1560bd, #000040);
            color: #fff;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            height: auto;
            /* overflow-y: auto;  */
        }
        
        .calc-card:hover { 
            transform: translateY(-5px); 
        }
        
        .calc-card h2 {
            color: #ffff;
            margin-bottom: 25px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* Input rows for better organization */
        .input-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .input-row .form-group {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Inputs */
        .form-group { 
            margin-bottom: 20px; 
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #fff;
        }
        
        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9fbfd;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }

        /* Button */
        .calculate-btn {
            width: 100%;
            padding: 14px;
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }
        
        .calculate-btn:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-wrapper {
            text-align: center;
            margin-top: 20px;
        }

        .print-btn {
            display: inline-block;
            background: linear-gradient(#1560bd,#000040);
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: auto !important;
        }

        .print-btn:hover {
            background: #1560bd;
        }

        /* Result Card */
        .result-card {
            justify-content: center;
            align-items: center;
            min-height: auto;
            text-align: center;
            margin-top: 20px;
        }
        
        .result-placeholder img {
            max-width: 240px;
            margin-bottom: 20px;
            opacity: 0.85;
        }
        
        .result-placeholder p {
            color: #7f8c8d;
            font-size: 16px;
            line-height: 1.6;
        }

                .rate-display {
                display: flex;
                gap: 20px;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap; /* responsive */
                text-align: center;
            }

            .rate-block {
                display: flex;
                flex-direction: column;
                align-items: center;
                min-width: 120px; /* keeps blocks same width */
            }

            .rate-label {
                font-weight: bold;
                font-size: 16px;
                color: #444;
                margin-bottom: 5px;
            }

            .rate-value {
                font-size: 40px;
                font-weight: 700;
                color: #2980b9;
                line-height: 1.2;
            }

            .rate-unit {
                font-size: 14px;
                color: #777;
                margin-top: 4px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .rate-value { font-size: 32px; }
            }

            @media (max-width: 480px) {
                .rate-value { font-size: 26px; }
                
                .rate-unit { font-size: 12px; }
                
            }



        /* Meter */
        .safety-meter {
            width: 100%; 
            height: 12px;
            background: #f1f5f9;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            border-radius: 6px;
        }
        
        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        /* Feedback */
                .result-feedback {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 18px 20px;
    border-left: 4px solid #3498db;
    text-align: left;
    max-width: 800px; /* keeps it readable on large screens */
    margin: 0 auto;   /* centers it */
}

.feedback-title {
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    font-size: 18px;
}

.feedback-content { 
    color: #34495e; 
    font-size: 16px;
    line-height: 1.5;
}

/* Responsive breakpoints */
@media (max-width: 768px) {
    .result-feedback {
        padding: 15px;
        font-size: 15px;
    }

    .feedback-title {
        font-size: 16px;
    }

    .feedback-content {
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .result-feedback {
        padding: 12px;
        border-left-width: 3px;
    }

    .feedback-title {
        font-size: 15px;
    }

    .feedback-content {
        font-size: 13px;
    }
}

        .note-section {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0faff;
            padding: 15px;
            margin-top: 60px;
            border-radius: 12px;
        }

        .note-card {
            background: #ffffff;
            border-left: 6px solid #1976d2;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
        }
        
        .note-card h3 {
            margin: 0 0 10px;
            font-size: 18px;
            color: #1976d2;
        }
        
        .note-card p, .note-card li {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            text-align: justify;
        }
        
        .note-list {
            margin: 0;
            padding-left: 18px;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 6px solid #0d47a1;
        }
        
        .formula-card code {
            display: inline-block;
            background: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            color: #0d47a1;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .good { 
            color: #2e7d32; 
            font-weight: 600; 
        }
        
        .average { 
            color: #f9a825; 
            font-weight: 600; 
        }
        
        .bad { 
            color: #c62828; 
            font-weight: 600; 
        }

        .result-error {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            color: #c0392b;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            gap: 12px;
            margin-top: 20px;
        }
        
        .error-icon {
            font-size: 76px;
            flex-shrink: 0;
            text-align: center;
        }
        
        .error-message {
            font-size: 24px;
            line-height: 1.6;
        }

        /* Toggle helper */
        .hidden { 
            display: none; 
        }
    </style>
</head>
<body>


    <div class="btn-container">
        <a href="{% url 'environmentcategory_calculators' %}" class="back-btn">Back To Environment Calculators</a>
    </div>

<div class="calculator-container printable" id="printArea">
    {% include "includes/print_header_footer.html" %}

<div class="calculator-header">
    <h1>Digester Capacity Calculator</h1>
    <p>Calculate the required digester volume for wastewater treatment systems (result shown in m³).</p>
</div>

<div class="calc-content">
    <!-- Calculator -->
    <div class="calc-card">
        <h2>Enter Parameters</h2>

        <div class="input-row">
            <div class="form-group">
                <label for="vf">Fresh Sludge Volume (Vf) (m³/day)</label>
                <input type="number" id="vf" class="form-input" step="any" min="0" placeholder="e.g., 100" aria-label="Fresh sludge volume">
            </div>

            <div class="form-group">
                <label for="vd">Digested Sludge Volume (Vd) (m³/day)</label>
                <input type="number" id="vd" class="form-input" step="any" min="0" placeholder="e.g., 30" aria-label="Digested sludge volume">
            </div>
        </div>

        <div class="input-row">
            <div class="form-group">
                <label for="t1">Digestion Time (t₁) (days)</label>
                <input type="number" id="t1" class="form-input" step="any" min="0" placeholder="e.g., 20" aria-label="Digestion time">
            </div>

            <div class="form-group">
                <label for="t2">Storage Period (t₂) (days)</label>
                <input type="number" id="t2" class="form-input" step="any" min="0" placeholder="e.g., 10" aria-label="Storage period">
            </div>
        </div>

        <button class="calculate-btn" onclick="calculateDigesterCapacity()">Calculate Digester Capacity</button>
    </div>

    <!-- Result Section -->
    <div class="result-card">
        <div class="result-placeholder" id="placeholder">
            <img src="/static/images/mlc_environment_result.png" alt="Digester capacity illustration">
            <p>This tool calculates the required digester volume for wastewater treatment systems.</p>
        </div>

        <div class="result-error hidden" id="resultError" role="alert" aria-live="polite">
            <div class="error-icon">❌</div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="result-value hidden" id="resultValue" aria-live="polite">
            <div class="calculation-type" style="font-weight:bold; font-size:16px; margin-bottom:5px; color:#1560bd;">
                <h2>Digester Capacity</h2>
            </div>

            <div class="rate-display" style="gap:12px; align-items:center; justify-content:center;">
                <div class="rate-value" id="digesterCapacity">0.00</div>
                <div class="rate-label" style="font-size:16px; color: #2980b9;">m³</div>
            </div>

            <div class="result-feedback">
                <div class="feedback-title">Assessment & Suggestions</div>
                <div class="feedback-content" id="feedbackContent"></div>
            </div>

            <div class="btn-wrapper">
                <button class="calculate-btn print-btn" onclick="printReport()">Print Report</button>
            </div>
        </div>
    </div>
</div>

<!-- Notes Section -->
<div class="note-section">

  <div class="note-card">
    <h3>📘 About This Calculator</h3>
    <p>
      This calculator determines the required digester capacity for wastewater treatment systems. 
      It calculates the optimal tank volume needed for efficient sludge digestion and storage 
      based on input parameters including fresh sludge volume, digested sludge volume, 
      digestion time, and storage period.
    </p>
  </div>

  <div class="note-card">
    <h3>⚙ Parameters Used</h3>
    <ul class="note-list">
      <li><strong>Vf</strong>: Fresh sludge volume (m³/day)</li>
      <li><strong>Vd</strong>: Digested sludge volume (m³/day)</li>
      <li><strong>t₁</strong>: Digestion time (days)</li>
      <li><strong>t₂</strong>: Storage period (days)</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>✅ Input Validation Rules</h3>
    <ul class="note-list">
      <li><strong>Fresh Sludge Volume (Vf):</strong> Required, must be &gt; 0 m³/day. Typical range: 50–500 (warn if &gt; 1000).</li>
      <li><strong>Digested Sludge Volume (Vd):</strong> Required, must be ≥ 0 and less than Vf. Typical range: 15–150 m³/day.</li>
      <li><strong>Digestion Time (t₁):</strong> Required, must be &gt; 0 days. Typical ≤ 60 (warn if &gt; 60).</li>
      <li><strong>Storage Period (t₂):</strong> Required, must be ≥ 0 days. Typical ≤ 30 (warn if &gt; 30).</li>
      <li><strong>All inputs:</strong> Required, numeric, non-negative, no invalid/blank values.</li>
      <li><strong>Cross-check:</strong> Vd must always be less than Vf.</li>
      <li><strong>Warnings:</strong> Values outside typical ranges flagged to prevent unit errors.</li>
    </ul>
  </div>

  <div class="note-card">
    <h3>🔎 Output Validations / Assessment</h3>
    <ul class="note-list">
      <li><strong>Computed capacity:</strong> Must be finite and ≥ 0. If not, error shown.</li>
      <li><strong>Breakdown:</strong> Total capacity (m³), digestion component, storage component are displayed.</li>
      <li><strong>Warnings:</strong> Triggered for Vf &gt; 1000, t₁ &gt; 60, t₂ &gt; 30, or capacity &gt; 10000 m³.</li>
      <li><strong>Classification & Feedback (displayed with results):</strong></li>
      <ul>
        <li><b>Large Digester Capacity (&gt; 5000 m³):</b> ✅ Suitable for large municipal wastewater treatment plants.</li>
        <li><b>Medium Digester Capacity (1000–5000 m³):</b> ✅ Appropriate for medium-sized treatment facilities.</li>
        <li><b>Small Digester Capacity (&lt; 1000 m³):</b> ⚠️ Suitable for small treatment plants or industrial applications.</li>
      </ul>
    </ul>
  </div>

  <div class="note-card">
    <h3>📐 Governing Principle</h3>
    <p>
      A digester capacity (V) calculator does not belong to a single global standard but instead follows principles 
      of environmental engineering and wastewater treatment design, utilizing parameters like hydraulic retention time (HRT), 
      daily substrate input, and operating temperature to calculate volume based on site-specific requirements and feedstocks. 
      Organizations like CPCB (Central Pollution Control Board) provide guidelines for wastewater parameters, but the specific 
      formula for digester volume is derived from engineering principles and operational data rather than a universally 
      mandated standard. These principles ensure flexibility in application across municipal and industrial treatment systems, 
      and they highlight the importance of balancing digestion efficiency, sludge stabilization, and operational sustainability.
    </p>
  </div>

  <div class="note-card">
    <h3>🔚 Conclusion</h3>
    <p>
      This calculator provides a practical framework for estimating digester capacity in wastewater treatment systems. 
      Results should always be reviewed in the context of site-specific data, operational conditions, and regulatory requirements. 
      The assessment and warnings displayed alongside results serve as guidance to ensure reliability, safety, and design suitability.
    </p>
  </div>

</div>


<script>
/* Helper: show errors consistently */
function showErrors(errors) {
  const errorBox = document.getElementById("resultError");
  const errorMessage = document.getElementById("errorMessage");
  const placeholder = document.getElementById("placeholder");
  const resultValue = document.getElementById("resultValue");

  if (errorMessage) errorMessage.innerHTML = errors.join("<br>");
  if (errorBox) errorBox.classList.remove("hidden");
  if (placeholder) placeholder.classList.add("hidden");
  if (resultValue) resultValue.classList.add("hidden");
}

/* Main Digester Capacity calculation with strong validations */
function calculateDigesterCapacity() {
  // safe reads
  const vfRaw = document.getElementById("vf")?.value.trim() ?? "";
  const vdRaw = document.getElementById("vd")?.value.trim() ?? "";
  const t1Raw = document.getElementById("t1")?.value.trim() ?? "";
  const t2Raw = document.getElementById("t2")?.value.trim() ?? "";

  const capacityEl = document.getElementById("digesterCapacity");
  const feedbackEl = document.getElementById("feedbackContent");

  // reset UI
  document.getElementById("resultError").classList.add("hidden");
  if (feedbackEl) feedbackEl.innerHTML = "";

  const errors = [];
  const warnings = [];

  // required checks
  if (vfRaw === "") errors.push("👉 Enter fresh sludge volume (Vf).");
  if (vdRaw === "") errors.push("👉 Enter digested sludge volume (Vd).");
  if (t1Raw === "") errors.push("👉 Enter digestion time (t₁).");
  if (t2Raw === "") errors.push("👉 Enter storage period (t₂).");

  if (errors.length > 0) { showErrors(errors); return; }

  // parse inputs
  const vf = parseFloat(vfRaw);
  const vd = parseFloat(vdRaw);
  const t1 = parseFloat(t1Raw);
  const t2 = parseFloat(t2Raw);

  // numeric & sign checks
  if (!Number.isFinite(vf) || vf <= 0) errors.push("👉 Fresh sludge volume (Vf) must be a positive number.");
  if (!Number.isFinite(vd) || vd < 0) errors.push("👉 Digested sludge volume (Vd) must be a non-negative number.");
  if (!Number.isFinite(t1) || t1 <= 0) errors.push("👉 Digestion time (t₁) must be a positive number.");
  if (!Number.isFinite(t2) || t2 < 0) errors.push("👉 Storage period (t₂) must be a non-negative number.");

  if (errors.length > 0) { showErrors(errors); return; }

  // cross-field validation
  if (vd >= vf) {
    errors.push("👉 Digested sludge volume (Vd) must be less than fresh sludge volume (Vf).");
    showErrors(errors);
    return;
  }

  // range warnings (based on typical design guidelines)
  if (vf > 1000) warnings.push("⚠️ Fresh sludge volume seems very high – verify units (m³/day).");
  if (t1 > 60) warnings.push("⚠️ Digestion time is unusually long – verify value.");
  if (t2 > 30) warnings.push("⚠️ Storage period is unusually long – verify value.");

  // compute digester capacity (m³)
  // Formula: V = [(Vf - (2/3 × (Vf - Vd))) × t₁] + (Vd × t₂)
  const digestionComponent = (vf - (2/3) * (vf - vd)) * t1;
  const storageComponent = vd * t2;
  const capacity = digestionComponent + storageComponent;

  // output validity check
  if (!Number.isFinite(capacity) || capacity < 0) {
    showErrors(["⚠️ Computed capacity is invalid. Check input values."]);
    return;
  }

  // extreme value warning
  if (capacity > 10000) {
    warnings.push("⚠️ Extremely large digester capacity calculated – verify all input values.");
  }

  // classification logic
  let classification = "";
  let suggestion = "";
  if (capacity > 5000) {
    classification = "Large Digester Capacity";
    suggestion = "✅ Suitable for large municipal wastewater treatment plants.";
  } else if (capacity >= 1000) {
    classification = "Medium Digester Capacity";
    suggestion = "✅ Appropriate for medium-sized treatment facilities.";
  } else {
    classification = "Small Digester Capacity";
    suggestion = "⚠️ Suitable for small treatment plants or industrial applications.";
  }

  // build feedback
  let details = `<div>Digester capacity = <b>${capacity.toFixed(2)}</b> m³</div>`;
  details += `<div>Classification: <b>${classification}</b></div>`;
  details += `<div style="margin-top:6px;">${suggestion}</div>`;
  details += `<div style="margin-top:8px; font-size:14px;">Calculation breakdown:</div>`;
  details += `<div style="margin-top:4px; font-size:13px;">Digestion component: ${digestionComponent.toFixed(2)} m³</div>`;
  details += `<div style="font-size:13px;">Storage component: ${storageComponent.toFixed(2)} m³</div>`;

  if (warnings.length) {
    details += `<div style="margin-top:8px; color:#b35d00;">Note: ${warnings.join(" | ")}</div>`;
  }

  // update UI
  if (capacityEl) capacityEl.textContent = capacity.toFixed(2);
  if (feedbackEl) feedbackEl.innerHTML = details;

  // toggle displays
  document.getElementById("placeholder").classList.add("hidden");
  document.getElementById("resultValue").classList.remove("hidden");
  document.getElementById("resultError").classList.add("hidden");
}

/* Safe print guard */
function printReport() {
  const el = document.getElementById('printDate');
  if (el) {
    const now = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    el.textContent = now.toLocaleDateString('en-US', options);
  }
  window.print();
}
</script>
<script src="{% static 'js/print.js' %}"></script>
</body>
</html>
{% endblock %}


<!--
==========================================================
DIGESTER CAPACITY CALCULATOR - DOCUMENTATION
==========================================================

📌 Formula Used:
  Inputs:
    Vf = Fresh sludge volume (m³/day)
    Vd = Digested sludge volume (m³/day)
    t₁ = Digestion time (days)
    t₂ = Storage period (days)

  Digestion component:
      ( Vf - (2/3 × (Vf - Vd)) ) × t₁

  Storage component:
      Vd × t₂

  Total Digester Capacity:
      V = [(Vf - (2/3 × (Vf - Vd))) × t₁] + (Vd × t₂)

📌 Input Validations:
  - Fresh sludge volume (Vf):
      • Required
      • Positive number
      • Vf > 0
  - Digested sludge volume (Vd):
      • Required
      • Non-negative number
      • Vd ≥ 0
      • Must satisfy Vd < Vf
  - Digestion time (t₁):
      • Required
      • Positive number
      • t₁ > 0
  - Storage period (t₂):
      • Required
      • Non-negative number
      • t₂ ≥ 0

📌 Output Validations:
  - Computed capacity must be finite and ≥ 0
  - If not → error shown: "Computed capacity is invalid"

📌 Warnings (plausibility checks):
  - Vf > 1000 → unusually large sludge volume (verify units)
  - t₁ > 60   → digestion time too long
  - t₂ > 30   → storage period too long
  - Capacity > 10000 m³ → extremely large digester, verify all inputs

📌 Classification (by total digester capacity):
  - < 1000 m³       → ⚠️ Small Digester Capacity
                       (for small plants/industrial use)
  - 1000 – 5000 m³  → ✅ Medium Digester Capacity
                       (medium-sized facilities)
  - > 5000 m³       → ✅ Large Digester Capacity
                       (large municipal plants)

📌 Output Breakdown:
  - Total Digester Capacity (m³)
  - Classification + Suggestion
  - Digestion Component (m³)
  - Storage Component (m³)
  - Warnings (if triggered)

==========================================================
-->
