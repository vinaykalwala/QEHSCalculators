{% extends 'login_base.html' %}
{% load static %}
{% block content %}
<style>
/* ----------------------- General ----------------------- */
.main-content {
    padding: 10px 2%;
}
.dashboard-heading {
        width: 100%;
        background: linear-gradient(135deg,#000040, #1560bd,#1560bd);
        color: white;
        font-size: 2rem;
        font-weight: 600;
        padding: 25px 20px;
        text-align: center;
        border-radius: 12px;
        box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        letter-spacing: 0.5px;
    }

   @media (max-width: 768px) {
    .dashboard-heading {
        font-size: 1.6rem;
        padding: 20px 15px;
    }
}

@media (max-width: 400px) {
    .dashboard-heading {
        font-size: 1.3rem;
        padding: 12px 8px;
    }
}

/* ----------------------- Heading ----------------------- */
 .dashboard-welcome {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #010170;
        color: white;
        border-radius: 20px;
        padding: 50px;
        margin: 20px 0;
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        flex-wrap: wrap;
        position: relative;
        overflow: hidden;
    }

    /* Diagonal background accent */
    .dashboard-welcome::before {
        content: "";
        position: absolute;
        top: 0;
        right: -180px;
        width: 60%;
        height: 100%;
        background: #1560bd;
        transform: skewX(-12deg);
        z-index: 0;
    }

    .welcome-content {
        flex: 1 1 55%;
        position: relative;
        z-index: 2;
    }

    .welcome-content h1 {
        font-size: 2.3rem;
        margin-bottom: 15px;
        font-weight: 700;
    }

    .welcome-content p {
        font-size: 1.1rem;
        opacity: 0.95;
    }

    .welcome-content .extra-info {
        margin-top: 12px;
        font-size: 1rem;
        font-style: italic;
        opacity: 0.9;
    }

    .welcome-actions {
        margin-top: 20px;
    }

    .welcome-actions .btn {
        margin-right: 10px;
        padding: 10px 18px;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .welcome-actions .btn-primary {
        background: #ffc107;
        border: none;
        color: #000;
    }

    .welcome-actions .btn-primary:hover {
        background: #e0a800;
    }

    .welcome-actions .btn-outline-light {
        border: 2px solid #fff;
        color: #fff;
    }

    .welcome-actions .btn-outline-light:hover {
        background: white;
        color: #3F5187;
    }

    .welcome-visual {
        flex: 1 1 35%;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        z-index: 2;
    }

    .image-wrapper {
        background: white;
        padding: 20px;
        border-radius: 50%;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .image-wrapper img {
        width: 220px;
        height: auto;
        border-radius: 50%;
    }

    @media (max-width: 768px) {
        .dashboard-welcome {
            flex-direction: column;
            text-align: center;
        }
        .dashboard-welcome::before {
            display: none; /* remove skew bg on mobile */
        }
        .welcome-visual {
            margin-top: 20px;
        }
    }
    @media (max-width: 400px) {
    .dashboard-welcome {
        padding: 20px;
        border-radius: 12px;
    }

    .welcome-content h1 {
        font-size: 1.6rem;
    }

    .welcome-content p {
        font-size: 0.95rem;
    }

    .welcome-actions .btn {
        display: block;
        margin: 8px auto;
        width: 100%; /* buttons full width for mobile comfort */
        padding: 10px;
    }

    .welcome-visual {
        margin-top: 15px;
    }

    .image-wrapper {
        padding: 12px;
        border-radius: 50%;
    }

    .image-wrapper img {
        width: 160px; /* smaller for tiny screens */
    }
}


/* ----------------------- Category Cards ----------------------- */
.category-card {
    border-radius: 15px;
    overflow: hidden;
    cursor: pointer;
    text-align: center;
    padding: 0; /* padding moved inside image/title for consistency */
    border: 2px dotted #1560bd;
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    transition: all 0.3s ease-in-out;
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* Align content at top */
    align-items: center;
    height: 200px; /* slightly larger to accommodate images + text */
    margin-left: 5px;
}

.category-img {
    width: 100%;
    height: 120px; /* fixed height for all images */
    object-fit: cover;
    border-radius: 10px 10px 0 0;
    transition: transform 0.3s ease-in-out;
}

.category-card:hover .category-img {
    transform: scale(1.05);
    filter: brightness(1.1);
}

.category-title {
    font-size: 1rem;
    font-weight: bold;
    color: #fff;
    border-top: 1px dotted #1560bd;
    border-radius: 0 0 10px 10px;
    width: 100%;
    margin: 0;
    padding: 10px 5px;
    background: linear-gradient(#1560bd,#000040);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    margin:20px 30px;
}
/* Large screens (desktop) - 5 per row */
@media (min-width: 1200px) {
    .category-col { 
        flex: 0 0 20%; 
        max-width: 20%; 
        padding: 10px; 
    }
}

/* Medium screens - 3 per row */
@media (max-width: 992px) {
    .category-col { 
        flex: 0 0 33.33%; 
        max-width: 33.33%; 
        padding: 8px; 
    }
}

/* Small screens / Tablets - 2 per row */
@media (max-width: 768px) {
    .category-col { 
        flex: 0 0 50%; 
        max-width: 50%; 
        padding: 5px; 
    }
    .category-img { height: 120px; }
    .category-title { font-size: 0.95rem; padding: 8px 5px; margin:10px 5px; }
}

/* Mobile - 1 per row, full width minus small gap */
@media (max-width: 576px) {
    .category-col { 
        flex: 0 0 100%; 
        max-width: 100%; 
        padding: 5px 10px; /* small side gap */
    }
    .category-card {
        margin: 0; /* remove extra margin */
    }
    .category-img { height: 140px; }
    .category-title { font-size: 0.9rem; padding: 8px 5px; margin:5px 5px; }
}

/* ----------------------- Subscription Plans ----------------------- */
/* ----------------------- Subscription Plans ----------------------- */
#subscription-plans .row {
    display: flex;
    gap: 20px;
    overflow-x: auto;   /* scroll if needed */
    flex-wrap: nowrap;
    padding: 15px;
    scrollbar-width: thin;
}

/* Hide ugly scrollbar */
#subscription-plans .row::-webkit-scrollbar {
    height: 6px;
}
#subscription-plans .row::-webkit-scrollbar-thumb {
    background: #1560bd;
    border-radius: 10px;
}

/* Card Base */
.pricing-card {
    flex: 0 0 300px;
    background: linear-gradient(145deg, #1560bd, #000040);
    color: #fff;
    border-radius: 18px;
    padding: 25px 20px 35px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.pricing-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 14px 32px rgba(21,96,189,0.7);
}

/* Badge / Ribbon */
.pricing-card::before {
    content: attr(data-badge);
    position: absolute;
    top: 12px;
    right: -40px;
    background: #ff4757;
    color: #fff;
    font-size: 12px;
    font-weight: bold;
    padding: 6px 60px;
    transform: rotate(45deg);
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.pricing-card.active::before {
    background: #28a745; /* Green for current plan */
    content: "Active";
    
}

/* Header */
.pricing-card .card-header {
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 15px;
    text-align: center;
    letter-spacing: 1px;
    color: #ffffff;
    text-align: center;

    /* Border box */
    border: 2px solid #1e90ff;
    padding: 8px 16px;
    border-radius: 8px;

    /* Glow effect */
    box-shadow: 0 0 6px #ffffff,
                0 0 12px #1e90ff,
                0 0 18px #1e90ff;
}


/* Price */
.pricing-card .price {
    font-size: 2.2rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 15px;
    color: #ffd85e;
}

/* Duration / Subtitle */
.pricing-card .text-muted {
    text-align: center;
    font-size: 14px;
    margin-bottom: 15px;
    color: #ddd !important;
}

/* Features */
.pricing-card ul {
    margin-top: 15px;
    padding-left: 0;
}
.pricing-card li {
    list-style: none;
    padding: 8px 12px;
    font-size: 14px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
    gap: 8px;

    /* Transparent white background */
    background: rgba(255, 255, 255, 0.08);
    border-radius: 6px; /* smooth corners */
    margin-bottom: 6px; /* spacing between items */
    transition: background 0.3s ease;
}

.pricing-card li:hover {
    background: rgba(255, 255, 255, 0.15); /* brighter on hover */
}

.pricing-card li i {
    color: #ffd85e;
}

/* Footer buttons */
.pricing-card .card-footer {
    margin-top: 25px;
    text-align: center;
}
.pricing-card .btn {
    border-radius: 12px;
    font-weight: 600;
    padding: 10px 15px;
}

/* Highlight current plan with glow */
/* Glow effect for current plan - Blue Shine */
.pricing-card.active {
    border: 2px solid #00c3ff;
    background: linear-gradient(145deg, #001848, #003080);
    animation: pulse-glow-blue 2.5s infinite;
}

@keyframes pulse-glow-blue {
    0% {
        box-shadow: 
            0 0 12px #00c3ff,
            0 0 25px #00aaff,
            0 0 40px #00c3ff;
    }
    50% {
        box-shadow: 
            0 0 25px #00c3ff,
            0 0 50px #00aaff,
            0 0 80px #00c3ff,
            inset 0 0 15px rgba(0,195,255,0.4);
    }
    100% {
        box-shadow: 
            0 0 12px #00c3ff,
            0 0 25px #00aaff,
            0 0 40px #00c3ff;
    }
}


/* Responsive adjustments */
@media (max-width: 1024px) {
    .pricing-card { flex: 0 0 280px; }
}
@media (max-width: 600px) {
    .pricing-card { flex: 0 0 240px; }
}
/* Tablets & below */
@media (max-width: 1110px) {
    #subscription-plans .row {
        flex-wrap: wrap;      
        justify-content: center;
        gap: 15px;
        overflow-x: hidden;   /* disable horizontal scroll */
    }

    .pricing-card {
        flex: 1 1 300px;
        max-width: 100%;
    }
}


/* Below 768px (phones) */
@media (max-width: 768px) {
    #subscription-plans .row {
        padding: 10px;
        gap: 12px;
    }

    .pricing-card {
        flex: 1 1 100%;   /* take full width */
        max-width: 100%;
        margin: 0 auto;   /* center the card */
        padding: 20px 15px 25px;
        border-radius: 14px;
    }

    .pricing-card .card-header {
        font-size: 1.3rem;
    }

    .pricing-card .price {
        font-size: 1.6rem;
    }
}

/* Small phones */
@media (max-width: 480px) {
    .pricing-card {
        flex: 1 1 100%;
        max-width: 100%;
        padding: 18px 12px 22px;
        margin: 0 auto 12px;
    }

    .pricing-card .card-header {
        font-size: 1.2rem;
    }

    .pricing-card .price {
        font-size: 1.5rem;
    }

    .pricing-card ul li {
        font-size: 13px;
        padding: 6px 10px;
    }
}

/* Wrapper fixed to corner */
.messages-wrapper {
    position: fixed;
    top: 20px;
    right: 20px;
    width: auto;
    max-width: 400px;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* One-line glowing alert */
.custom-alert {
    display: flex;
    align-items: center;
    gap: 10px; /* space between icon + text */
    border-radius: 12px;
    padding: 10px 16px;
    font-size: 0.95rem;
    font-weight: 500;
    color: #fff;
    backdrop-filter: blur(8px);
    background: rgba(21, 96, 189, 0.25);
    box-shadow: 0 0 12px rgba(21, 96, 189, 0.8),
                0 0 20px rgba(0, 0, 64, 0.6);
    animation: slideIn 0.4s ease-out;
}

/* Icon (always left) */
.alert-icon {
    font-size: 1.2rem;
    flex-shrink: 0;
}

/* Text (middle, expands) */
.alert-text {
    flex: 1;
    white-space: normal;
}

/* Fix overlap */
.alert {
    position: relative;
    padding-right: 4rem !important; /* leave space for close button */
    color: #fff; /* make text white */
}
.alert .btn-close {
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    filter: invert(1); /* makes the close icon white */
    opacity: 0.9;
}
.alert .btn-close:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.1);
}



/* Variants with subtle border glow */
.alert-success.custom-alert { border-left: 4px solid #28a745; }
.alert-warning.custom-alert { border-left: 4px solid #ffc107; }
.alert-danger.custom-alert,
.alert-error.custom-alert { border-left: 4px solid #dc3545; }
.alert-info.custom-alert { border-left: 4px solid #0dcaf0; }

/* Slide animation */
@keyframes slideIn {
    from { transform: translateX(120%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
.section-heading {
    font-size: 2.2rem;
    font-weight: 700;
    color: #1560bd;
   
    position: relative;
    display: inline-block;
    margin-top: 20px;
}


.section-subtitle {
    font-size: 1rem;
    color: #555;
}

/* Tablet screens (below 768px) */
@media (max-width: 768px) {
    .section-heading {
        font-size: 1.8rem;
        margin-top: 20px;
    }

    .section-subtitle {
        font-size: 0.9rem;
    }
}

/* Small mobile screens (below 480px) */
@media (max-width: 480px) {
    .section-heading {
        font-size: 1.5rem;
        margin-top: 25px;
    }

    .section-subtitle {
        font-size: 0.85rem;
    }
}

/* Extra small screens (below 360px) */
@media (max-width: 360px) {
    .section-heading {
        font-size: 1.3rem;
        margin-top: 15px;
    }

    .section-subtitle {
        font-size: 0.8rem;
    }
}
.subscription-strip {
    display: flex;
    justify-content: space-between;
    align-items: stretch;
    gap: 20px;
    margin: 10px auto;
    padding: 20px;
    border-radius: 14px;
    background: linear-gradient(90deg, #1560bd,#1560bd, #000040);
    color: #fff;
    box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    flex-wrap: wrap;
}

.sub-item {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 200px;
    background: rgba(255,255,255,0.08);
    padding: 15px;
    border-radius: 10px;
    transition: transform 0.3s ease, background 0.3s ease;
}
.sub-item:hover {
    transform: translateY(-5px);
    background: rgba(255,255,255,0.15);
}

.sub-item i {
    font-size: 2rem;
    color: #ffd740;
}

.sub-item h4 {
    margin: 0;
    font-size: 0.9rem;
    font-weight: 600;
    opacity: 0.85;
}
.sub-item p {
    margin: 2px 0 0;
    font-size: 1.1rem;
    font-weight: bold;
}

.pending-note {
    margin-top: 15px;
    text-align: center;
    color: #ff9800;
    font-weight: 600;
    font-size: 1rem;
}

@media (max-width: 768px) {
    .subscription-strip {
        flex-direction: column;
        text-align: center;
    }
    .sub-item {
        justify-content: center;
    }
}

</style>

<div class="main-content">
    <!-- Heading -->
   <div class="dashboard-heading">
    üëã Welcome, {{ request.user.first_name|default:request.user.username }}
</div>



{% if messages %}
<div class="messages-wrapper">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} custom-alert alert-dismissible fade show" role="alert">
        <span class="alert-icon">
            {% if message.tags == "success" %} ‚úÖ
            {% elif message.tags == "warning" %} ‚ö†Ô∏è
            {% elif message.tags == "error" or message.tags == "danger" %} ‚ùå
            {% else %} ‚ÑπÔ∏è
            {% endif %}
        </span>
        <span class="alert-text">{{ message }}</span>
        <button type="button" class="btn-close alert-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
</div>
{% endif %}



    {% if user.is_superuser %}
        <!-- Admin Dashboard Placeholder -->
       <div class="dashboard-welcome">
    <div class="welcome-content">
        <h1>Admin Dashboard</h1>
<p>Here you have full control over your platform. Manage users, respond to contacts, approve requests, and monitor subscriptions ‚Äî all in one place.</p>
        <p class="extra-info">Stay on top of your platform activity and manage everything from one place.</p>

        <div class="welcome-actions">
            <a href="{% url 'user_list' %}" class="btn btn-primary">Go to Users</a>
            <a href="#" class="btn btn-outline-light">View Reports</a>
        </div>
    </div>
    <div class="welcome-visual">
        <div class="image-wrapper">
            <img src="{% static 'images/admin.webp' %}" alt="Admin Dashboard" />
        </div>
    </div>
</div>



   {% else %}
    {% if subscription and subscription.is_active %}
    <div class="subscription-strip">
        
        <!-- Status -->
        <div class="sub-item status">
            <i class="fas fa-check-circle"></i>
            <div>
                                 <h4>  Plan Status</h4>

                <p>Active</p>
            </div>
        </div>

        <!-- Plan -->
        <div class="sub-item plan">
            <i class="fas fa-crown"></i>
            <div>
                <h4> Your Current Plan Is</h4>
                <p>{{ subscription.plan.get_name_display }}</p>
            </div>
        </div>

        <!-- Expiry -->
        <div class="sub-item expiry">
            <i class="fas fa-calendar-alt"></i>
            <div>
                <h4>Expires On</h4>
                <p>{{ subscription.end_date|date:"F j, Y" }}</p>
            </div>
        </div>
        
    </div>

    {% if subscription.status == "pending" %}
    <p class="pending-note">
        <i class="fas fa-clock"></i> Pending admin approval
    </p>
    {% endif %}
    {% endif %}
{% endif %}


     {% if not user.is_superuser %}
<!-- Section Heading -->
<div class="text-center">
    <h2 class="section-heading">Access Free Calculators</h2>
    <p class="section-subtitle">Explore Quality, Environment, Health, Safety & Fire Tools</p>
</div>    <div class="d-flex flex-wrap justify-content-center">
        <div class="category-col">
            <a href="{% url 'quality_basic_calculator' %}" class="text-decoration-none">
                <div class="category-card">
                    <img src="{% static 'images/qualitymainimage.jpg' %}" class="category-img" alt="Quality Calculators">
                    <h3 class="category-title">Quality <br>Calculator</h3>
                </div>
            </a>
        </div>
        <div class="category-col">
            <a href="{% url 'environment_basic_calculator' %}" class="text-decoration-none">
                <div class="category-card">
                    <img src="{% static 'images/environmentmainimage.jpg' %}" class="category-img" alt="Environment Calculators">
                    <h3 class="category-title">Environment <br>Calculator</h3>
                </div>
            </a>
        </div>
        <div class="category-col">
            <a href="{% url 'health_basic_calculator' %}" class="text-decoration-none">
                <div class="category-card">
                    <img src="{% static 'images/healthmainimage1.jpg' %}" class="category-img" alt="Health Calculators">
                    <h3 class="category-title">Health <br>Calculator</h3>
                </div>
            </a>
        </div>
        <div class="category-col">
            <a href="{% url 'safety_basic_calculator' %}" class="text-decoration-none">
                <div class="category-card">
                    <img src="{% static 'images/calsafety.jpg' %}" class="category-img" alt="Safety Calculators">
                    <h3 class="category-title">Safety <br>Calculator</h3>
                </div>
            </a>
        </div>
        <div class="category-col">
            <a href="{% url 'fire_basic_calculator' %}" class="text-decoration-none">
                <div class="category-card">
                    <img src="{% static 'images/firemainimage.jpg' %}" class="category-img" alt="Fire Calculators">
                    <h3 class="category-title">Fire <br>Calculator</h3>
                </div>
            </a>
        </div>
    </div>
{% endif %}


    <!-- Subscription Plans -->
    {% if not user.is_superuser %}
    <div class="row mt-5" id="subscription-plans">
        <div class="col-12 mb-4 text-center">
            <h3 style="color: #1560bd;font-weight: 700;font-size: 2.2rem;margin-bottom: 20px;">
                {% if subscription and subscription.is_active %}
                Upgrade Your Plan
                {% else %}
                Subscription Plans
                {% endif %}
            </h3>
        </div>

        {% for plan in plans %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="pricing-card {% if subscription and subscription.plan.id == plan.id %}active{% endif %}">
                <div class="card-header">
                    {{ plan.get_name_display }}
                </div>
                <div class="card-body">
                    <div class="price">‚Çπ{{ plan.price }}</div>
                    
                    <ul class="list-unstyled">
                        <li><i class="fas fa-desktop me-2"></i> <strong>Device limit:</strong> {{ plan.device_limit }}</li>
                        <li><i class="fas fa-clock me-2"></i> <strong>Duration:</strong> 
                            {% if subscription and subscription.is_active and subscription.is_upgrade %}
                                Same as previous plan
                            {% else %}
                                {{ plan.duration_days }} days
                            {% endif %}
                        </li>
                        <li><i class="fas fa-desktop me-2"></i> <strong>Calculators Per Category:</strong> {{ plan.calculators_per_category }}</li>

                    </ul>
                </div>
                <div class="card-footer">
                    {% if subscription and subscription.is_active %}
                        {% if subscription.plan.id == plan.id %}
                          <button class="btn current-btn" disabled>Current Plan</button>
        {% elif subscription.plan.price >= plan.price %}
            <button class="btn downgrade-btn" disabled>
                <i class="fas fa-lock me-1"></i> Downgrade Not Allowed
            </button>
        {% else %}
                            <a href="{% url 'subscribe_plan' plan.id %}" class="btn btn-warning w-100">
                                <i class="fas fa-arrow-up me-1"></i> Upgrade
                            </a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'subscribe_plan' plan.id %}" class="btn btn-primary w-100">
                            Subscribe Now
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
            <p class="text-muted">No subscription plans available at the moment.</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}
